/**
 * MathQuill v0.10.1, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(){function t(){}function e(t,e){if(!e)throw new Error("prayer failed: "+t)}function n(t){e("a direction was passed",t===se||t===ae)}function r(t,e){var n,r=t[se];if(r&&(n=t[ae]))for(n=n[ae];r!==n&&!1!==e(r);r=r[ae]);}function i(t,e,n){var r,i=t[se];if(!i)return e;if(!(r=t[ae]))return e;for(r=r[ae];i!==r;i=i[ae])e=n(e,i);return e}function o(t,n,r){e("a parent is always present",t),e("leftward is properly set up",function(){return n?n[ae]===r&&n.parent===t:t.ends[se]===r}()),e("rightward is properly set up",function(){return r?r[se]===n&&r.parent===t:t.ends[ae]===n}())}function s(t){return t&&t.prototype instanceof V}function a(t){return z(),ie(t)}function l(e){function n(t,e){var n,r,i;e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s});for(n in e)e.hasOwnProperty(n)&&(r=e[n],i=I[n],t[n]=i?i(r):r)}var r,i,o,s,a;if(!(F<=e&&e<=N))throw"Only interface versions between "+F+" and "+N+" supported. You specified: "+e;r=function(t){var e,n;return t&&t.nodeType?(e=S.getNodeOfElement(q(t).children(".mq-root-block")[0]),n=e&&e.controller,n?new s[n.KIND_OF_MQ](n):null):null},r.L=se,r.R=ae,r.saneKeyboardEvents=G,r.config=function(t){return n(M.prototype,t),this},r.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";E[t]=e},i=function(t){function e(e){var n=t.call(this)||this;return n.__controller=e,n.__options=e.options,n.id=e.id,n.data=e.data,n}return __extends(e,t),e.prototype.__mathquillify=function(t){var e,n=this.__controller,r=n.root,i=n.container;n.createTextarea(),e=i.addClass(t).contents().detach(),r.jQ=q('<span class="mq-root-block"/>').appendTo(i),S.linkElementByBlockId(r.jQ[0],r.id),this.latex(e.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},e.prototype.config=function(t){return n(this.__options,t),this},e.prototype.el=function(){return this.__controller.container[0]},e.prototype.text=function(){return this.__controller.exportText()},e.prototype.mathspeak=function(){return this.__controller.exportMathSpeak()},e.prototype.latex=function(t){if(arguments.length>0){this.__controller.renderLatexMath(t);var e=this.__controller.cursor;return this.__controller.blurred&&e.hide().parent.blur(e),this}return this.__controller.exportLatex()},e.prototype.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},e.prototype.reflow=function(){return this.__controller.root.postOrder(function(t){t.reflow()}),this},e}(R),r.prototype=i.prototype,o=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.__mathquillify=function(t){return e.prototype.__mathquillify.call(this,t),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},n.prototype.focus=function(){return this.__controller.getTextareaOrThrow()[0].focus(),this.__controller.scrollHoriz(),this},n.prototype.blur=function(){return this.__controller.getTextareaOrThrow().blur(),this},n.prototype.write=function(t){this.__controller.writeLatex(t),this.__controller.scrollHoriz();var e=this.__controller.cursor;return this.__controller.blurred&&e.hide().parent.blur(e),this},n.prototype.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.ends[se]=t.ends[ae]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},n.prototype.cmd=function(t){var e,n,r=this.__controller.notify(void 0),i=r.cursor;return/^\\[a-z]+$/i.test(t)&&!i.isTooDeep()?(t=t.slice(1),(e=L[t])&&(n=e.constructor?new e(t):e(t),i.selection&&n.replaces(i.replaceSelection()),n.createLeftOf(i.show()))):i.parent.write(i,t),r.scrollHoriz(),r.blurred&&i.hide().parent.blur(i),this},n.prototype.select=function(){return this.__controller.selectAll(),this},n.prototype.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},n.prototype.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},n.prototype.moveToLeftEnd=function(){return this.moveToDirEnd(se)},n.prototype.moveToRightEnd=function(){return this.moveToDirEnd(ae)},n.prototype.keystroke=function(e,n){var r,i=e.replace(/^\s+|\s+$/g,"").split(/\s+/);for(r=0;r<i.length;r+=1)this.__controller.keystroke(i[r],n||{preventDefault:t});return this},n.prototype.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},n.prototype.dropEmbedded=function(t,e,n){var r,i=t-q(window).scrollLeft(),o=e-q(window).scrollTop(),s=document.elementFromPoint(i,o);this.__controller.seek(q(s),t,e),r=(new re).setOptions(n),r.createLeftOf(this.__controller.cursor)},n.prototype.setAriaLabel=function(t){return this.__controller.setAriaLabel(t),this},n.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},n.prototype.setAriaPostLabel=function(t,e){return this.__controller.setAriaPostLabel(t,e),this},n.prototype.getAriaPostLabel=function(){return this.__controller.getAriaPostLabel()},n.prototype.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var r=this.__controller,i=r.root;return le.contains(i.jQ[0],n)||(n=i.jQ[0]),r.seek(q(n),t+pageXOffset,e+pageYOffset),r.blurred&&this.focus(),this},n.prototype.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this},n}(i),r.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},r.EditableField.prototype=o.prototype,s={AbstractMathQuill:i,EditableField:o};for(a in Q)!function(t,n){var i=s[t]=n(s);r[t]=function(n,o){var s,a=r(n);return a instanceof i||!n||!n.nodeType?a:(s=new nt(new i.RootBlock,q(n),new M),s.KIND_OF_MQ=t,new i(s).__mathquillify(o,e))},r[t].prototype=i.prototype}(a,Q[a]);return r}function p(t){t.moveOutOf=function(t){this.controller.handle("moveOutOf",t)},t.deleteOutOf=function(t){this.controller.handle("deleteOutOf",t)},t.selectOutOf=function(t){this.controller.handle("selectOutOf",t)},t.upOutOf=function(t){this.controller.handle("upOutOf",t)},t.downOutOf=function(t){this.controller.handle("downOutOf",t)},t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function u(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}function c(t,e,n){return function(){return new st(t,e,n)}}function h(t,e,n,r){return function(){return new at(t,e,n,r)}}function f(t){var n,r;if(t.jQ[0].normalize(),n=t.jQ[0].firstChild)return e("only node in TextBlock span is Text node",3===n.nodeType),r=new ct(n.data),r.jQadd(n),t.children().disown(),r.adopt(t,0,0),r}function d(t,e,n,r){return function(i){function o(){var n=null!==i&&i.apply(this,arguments)||this;return n.ctrlSeq=t,n.mathspeakTemplate=["Start"+e,"End"+e],n.ariaLabel=e,n}return __extends(o,i),o.prototype.html=function(){var t="mathquill-command-id="+this.id;return"<"+n+" "+r+" "+t+">"+this.textContents()+"</"+n+">"},o}(ut)}function m(t,e,n){return function(){return new gt(t,e)}}function g(t){if(!t)return!1;var e=t[se];return e?!(e instanceof at||/^(\\ )|[,;:\(\[]$/.test(e.ctrlSeq)):!!(t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock())&&g(t.parent.parent)}function y(t){var e,n,r;if(!t)return"";if(!(e=t.children())||!e.ends[se])return"";for(n="",r=e.ends[se];r&&void 0!==r[ae];r=r[ae])void 0!==r.ctrlSeq&&(n+=r.ctrlSeq);return n}function w(t){var e=this.parent,n=t;do{if(n[ae])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function b(t){var e=t.side,n=t.sides[e];return{ch:Yt[n.ch],ctrlSeq:Yt[n.ctrlSeq]}}function v(t,e,n){var r,i;e=e||t,r=Yt[t],i=Yt[e],T[t]=function(){return new Zt(se,t,r,e,i)},T[r]=function(){return new Zt(ae,t,r,e,i)},Xt[t]=Xt[r]=n}var x,q,k,_,S,O,L,T,C,A,j,D,Q,E,B,I,M,R,z,F,N,P,$,G,H,U,W,V,K,Z,Y,X,J,tt,et,nt,rt,it,ot,st,at,lt,pt,ut,ct,ht,ft,dt,mt,gt,yt,wt,bt,vt,xt,qt,kt,_t,St,Ot,Lt,Tt,Ct,At,jt,Dt,Qt,Et,Bt,It,Mt,Rt,zt,Ft,Nt,Pt,$t,Gt,Ht,Ut,Wt,Vt,Kt,Zt,Yt,Xt,Jt,te,ee,ne,re,ie,oe,se=-1,ae=1,le=window.jQuery,pe=Math.min,ue=Math.max;if(!le)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";x=function(){function t(t){this.jQ=le('<span class="mq-aria-alert" aria-live="assertive" aria-atomic="true"></span>'),this.msg="",this.items=[],this.controller=t}return t.prototype.setContainer=function(t){this.jQ.appendTo(t)},t.prototype.queue=function(t,e){var n,r;return void 0===e&&(e=!1),n="",t instanceof V?(r=t.mathspeak({ignoreShorthand:!0}),e&&(t.parent&&t.parent.ariaLabel&&"block"===t.ariaLabel?n=t.parent.ariaLabel+" "+r:t.ariaLabel&&(n=t.ariaLabel+" "+r)),""===n&&(n=r)):n=t||"",this.items.push(n),this},t.prototype.queueDirOf=function(t){return n(t),this.queue(t===se?"before":"after")},t.prototype.queueDirEndOf=function(t){return n(t),this.queue(t===se?"beginning of":"end of")},t.prototype.alert=function(t){return t&&this.queue(t),this.items.length&&(this.msg=this.items.join(" ").replace(/ +(?= )/g,"").trim(),this.controller.containerHasFocus()&&this.jQ.empty().text(this.msg)),this.clear()},t.prototype.clear=function(){return this.items.length=0,this},t}(),q=le,q.fn.insDirOf=function(t,e){return t===se?this.insertBefore(e.first()):this.insertAfter(e.last())},q.fn.insAtDirEnd=function(t,e){return t===se?this.prependTo(e):this.appendTo(e)},k=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){this.parent=t,this[se]=e,this[ae]=n},t.copy=function(e){return new t(e.parent,e[se],e[ae])},t}(),_=q(),S=function(){function t(){var n;this[e]=0,this[o]=0,this.parent=0,this.ends=(n={},n[se]=0,n[ae]=0,n),this.jQ=_,this.id=t.uniqueNodeId(),t.TempByIdDict[this.id]=this,t.scheduleDictionaryCleaning()}t.uniqueNodeId=function(){return t.idCounter+=1},t.getNodeOfElement=function(t){if(t){if(!t.nodeType)throw new Error("must pass an HTMLElement to NodeBase.getNodeOfElement");var e=t;return e.mqBlockNode||e.mqCmdNode}},t.linkElementByBlockId=function(e,n){t.linkElementByBlockNode(e,t.TempByIdDict[n])},t.linkElementByBlockNode=function(t,e){t.mqBlockNode=e},t.linkElementByCmdNode=function(t,e){t.mqCmdNode=e},t.scheduleDictionaryCleaning=function(){t.cleaningScheduled||(t.cleaningScheduled=!0,setTimeout(t.cleanDictionary))},t.cleanDictionary=function(){t.cleaningScheduled=!1,t.TempByIdDict={}},t.prototype.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.prototype.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.prototype.jQize=function(e){function n(e){var r,i,o,s,a;"getAttribute"in e&&(r=e.getAttribute("mathquill-command-id"),r&&(e.removeAttribute("mathquill-command-id"),i=t.TempByIdDict[r],i.jQadd(e),t.linkElementByCmdNode(e,i)),(o=e.getAttribute("mathquill-block-id"))&&(e.removeAttribute("mathquill-block-id"),s=t.TempByIdDict[o],s.jQadd(e),t.linkElementByBlockNode(e,s)));for(a=e.firstChild;a;a=a.nextSibling)n(a)}var r,i=q(e||this.html());for(r=0;r<i.length;r+=1)n(i[r]);return i},t.prototype.createDir=function(t,e){n(t);var r=this;return r.jQize(),r.jQ.insDirOf(t,e.jQ),e[t]=r.adopt(e.parent,e[se],e[ae]),r},t.prototype.createLeftOf=function(t){this.createDir(se,t)},t.prototype.selectChildren=function(t,e){return new j(t,e)},t.prototype.bubble=function(t){var e,n=this.getSelfNode();for(e=n;e&&!1!==t(e);e=e.parent);return this},t.prototype.postOrder=function(t){var e=this.getSelfNode();return function e(n){return!!n&&(n.eachChild(e),t(n),!0)}(e),e},t.prototype.isEmpty=function(){return 0===this.ends[se]&&0===this.ends[ae]},t.prototype.isQuietEmptyDelimiter=function(t){if(!this.isEmpty())return!1;if(!t)return!1;if(!this.parent||void 0===this.parent.ctrlSeq)return!1;var e=this.parent.ctrlSeq.replace(/^\\(left|right)?/,"");return t.hasOwnProperty(e)},t.prototype.isStyleBlock=function(){return!1},t.prototype.isTextBlock=function(){return!1},t.prototype.children=function(){return new O(this.ends[se],this.ends[ae])},t.prototype.eachChild=function(t){return r(this.ends,t),this},t.prototype.foldChildren=function(t,e){return i(this.ends,t,e)},t.prototype.withDirAdopt=function(t,e,n,r){var i=this.getSelfNode();return new O(i,i).withDirAdopt(t,e,n,r),this},t.prototype.adopt=function(t,e,n){var r=this.getSelfNode();return new O(r,r).adopt(t,e,n),this.getSelfNode()},t.prototype.disown=function(){var t=this.getSelfNode();return new O(t,t).disown(),this},t.prototype.remove=function(){return this.jQ.remove(),this.disown()},t.prototype.shouldIgnoreSubstitutionInSimpleSubscript=function(t){return!!t.disableAutoSubstitutionInSubscripts&&(!!this.parent&&(this.parent.parent instanceof zt&&!!this.parent.jQ.hasClass("mq-sub")))},t.prototype.getSelfNode=function(){return this},t.prototype.parser=function(){},t.prototype.html=function(){return""},t.prototype.text=function(){return""},t.prototype.latex=function(){return""},t.prototype.finalizeTree=function(t,e){},t.prototype.contactWeld=function(t,e){},t.prototype.blur=function(t){},t.prototype.focus=function(){},t.prototype.intentionalBlur=function(){},t.prototype.reflow=function(){},t.prototype.registerInnerField=function(t,e){},t.prototype.chToCmd=function(t,e){},t.prototype.mathspeak=function(t){return""},t.prototype.seek=function(t,e){},t.prototype.siblingDeleted=function(t,e){},t.prototype.siblingCreated=function(t,e){},t.prototype.finalizeInsert=function(t,e){},t.prototype.fixDigitGrouping=function(t){},t.prototype.writeLatex=function(t,e){},t.prototype.write=function(t,e){};var e,o;return e=se,o=ae,t.idCounter=0,t.TempByIdDict={},t.cleaningScheduled=!1,t}(),O=function(){function t(t,r,i){if(this.jQ=_,this.disowned=!1,void 0===i&&(i=se),n(i),e("no half-empty fragments",!t==!r),this.ends={},t&&r){e("withDir is passed to Fragment",t instanceof V),e("oppDir is passed to Fragment",r instanceof V),e("withDir and oppDir have the same parent",t.parent===r.parent),this.ends[i]=t,this.ends[-i]=r;var o=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(o)}}return t.prototype.withDirAdopt=function(t,e,n,r){return t===se?this.adopt(e,n,r):this.adopt(e,r,n)},t.prototype.adopt=function(t,e,n){var r,i,s;return o(t,e,n),r=this,this.disowned=!1,(i=r.ends[se])&&(s=r.ends[ae])?(e||(t.ends[se]=i),n?n[se]=s:t.ends[ae]=s,s[ae]=n,r.each(function(n){return n[se]=e,n.parent=t,e&&(e[ae]=n),e=n,!0}),r):this},t.prototype.disown=function(){var t,e,n,r,i=this,s=i.ends[se];return!s||i.disowned?i:(this.disowned=!0,(t=i.ends[ae])?(e=s.parent,o(e,s[se],s),o(e,t,t[ae]),s[se]?(n=s[se],n[ae]=t[ae]):e.ends[se]=t[ae],t[ae]?(r=t[ae],r[se]=s[se]):e.ends[ae]=s[se],i):i)},t.prototype.remove=function(){return this.jQ.remove(),this.disown()},t.prototype.each=function(t){return r(this.ends,t),this},t.prototype.fold=function(t,e){return i(this.ends,t,e)},t}(),L={},T={},C=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return i.ancestors={},i}return __extends(e,t),e.fromCursor=function(t){return new e(t.parent,t[se],t[ae])},e}(k),A=function(t){function r(e,n,r){var i,o=t.call(this,e)||this;return o.upDownCache={},o.controller=r,o.options=n,i=o.jQ=o._jQ=q('<span class="mq-cursor">&#8203;</span>'),o.blink=function(){i.toggleClass("mq-blink")},o}return __extends(r,t),r.prototype.show=function(){if(this.jQ=this._jQ.removeClass("mq-blink"),this.intervalId)clearInterval(this.intervalId);else{if(this[ae]){var t=this.selection;t&&t.ends[se][se]===this[se]?this.jQ.insertBefore(t.jQ):this.jQ.insertBefore(this[ae].jQ.first())}else this.jQ.appendTo(this.parent.jQ);this.parent.focus()}return this.intervalId=setInterval(this.blink,500),this},r.prototype.hide=function(){return this.intervalId&&clearInterval(this.intervalId),this.intervalId=0,this.jQ.detach(),this.jQ=q(),this},r.prototype.withDirInsertAt=function(t,e,n,r){var i=this.parent;this.parent=e,this[t]=n,this[-t]=r,i!==e&&i.blur&&i.blur(this)},r.prototype.insDirOf=function(t,e){return n(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},r.prototype.insLeftOf=function(t){return this.insDirOf(se,t)},r.prototype.insRightOf=function(t){return this.insDirOf(ae,t)},r.prototype.insAtDirEnd=function(t,e){return n(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},r.prototype.insAtLeftEnd=function(t){return this.insAtDirEnd(se,t)},r.prototype.insAtRightEnd=function(t){return this.insAtDirEnd(ae,t)},r.prototype.jumpUpDown=function(t,e){var n,r,i,o=this;o.upDownCache[t.id]=k.copy(o),n=o.upDownCache[e.id],n?(r=n[ae],r?o.insLeftOf(r):o.insAtRightEnd(n.parent)):(i=o.offset().left,e.seek(i,o)),o.controller.aria.queue(e,!0)},r.prototype.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},r.prototype.unwrapGramp=function(){var t,e,n,r,i,o=this.parent.parent,s=o.parent,a=o[ae],l=this,p=o[se];if(o.disown().eachChild(function(t){return!!t.isEmpty()||(t.children().adopt(s,p,a).each(function(t){return t.jQ.insertBefore(o.jQ.first()),!0}),p=t.ends[ae],!0)}),!this[ae])if(t=this[se])this[ae]=t[ae];else for(;!this[ae];){if(!(e=this.parent[ae])){this[ae]=o[ae],this.parent=s;break}this.parent=e,this[ae]=e.ends[se]}n=this[ae],n?this.insLeftOf(n):this.insAtRightEnd(s),o.jQ.remove(),r=o[se],i=o[ae],r&&r.siblingDeleted(l.options,ae),i&&i.siblingDeleted(l.options,se)},r.prototype.startSelection=function(){var t,e=this.anticursor=C.fromCursor(this),n=e.ancestors;for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},r.prototype.endSelection=function(){delete this.anticursor},r.prototype.select=function(){var t,n,r,i,o,s,a,l,p,u=this.anticursor;if(this[se]===u[se]&&this.parent===u.parent)return!1;for(n=this;n.parent;n=n.parent)if(n.parent.id in u.ancestors){t=n.parent;break}if(e("cursor and anticursor in the same tree",t),r=t,i=u.ancestors[r.id],a=ae,n[se]!==i)for(l=n;l;l=l[ae])if(l[ae]===i[ae]){a=se,o=n,s=i;break}return a===ae&&(o=i,s=n),o instanceof k&&(o=o[ae]),s instanceof k&&(s=s[se]),this.hide().selection=r.selectChildren(o,s),p=this.selection.ends[a],this.insDirOf(a,p),this.selectionChanged(),!0},r.prototype.resetToEnd=function(t){this.clearSelection();var e=t.root;this[ae]=0,this[se]=e.ends[ae],this.parent=e},r.prototype.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},r.prototype.deleteSelection=function(){var t=this.selection;t&&(this[se]=t.ends[se][se],this[ae]=t.ends[ae][ae],t.remove(),this.selectionChanged(),delete this.selection)},r.prototype.replaceSelection=function(){var t=this.selection;return t&&(this[se]=t.ends[se][se],this[ae]=t.ends[ae][ae],delete this.selection),t},r.prototype.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof lt?1:0;return e},r.prototype.isTooDeep=function(t){return void 0!==this.options.maxDepth&&this.depth()+(t||0)>this.options.maxDepth},r.prototype.selectionChanged=function(){},r}(k),j=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return i.jQ=i.jQ.wrapAll('<span class="mq-selection"></span>').parent(),i}return __extends(e,t),e.prototype.adopt=function(e,n,r){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.prototype.adopt.call(this,e,n,r)},e.prototype.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},e.prototype.join=function(t,e){return void 0===e&&(e=""),this.fold("",function(n,r){return n+e+r[t]()})},e}(O),D=function(){function t(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,this.aria=new x(this.getControllerSelf()),this.ariaLabel="Math Input",this.ariaPostLabel="",t.controller=this.getControllerSelf(),this.cursor=t.cursor=new A(t,n,this.getControllerSelf())}return t.prototype.getControllerSelf=function(){return this},t.prototype.handle=function(t,e){var n,r=this.options.handlers;r&&r.fns[t]&&(n=new r.APIClasses[this.KIND_OF_MQ](this),e===se||e===ae?r.fns[t](e,n):r.fns[t](n))},t.onNotify=function(e){t.notifyees.push(e)},t.prototype.notify=function(e){for(var n=0;n<t.notifyees.length;n+=1)t.notifyees[n](this.cursor,e);return this},t.prototype.setAriaLabel=function(t){var e=this.getAriaLabel();return t&&"string"==typeof t&&""!==t?this.ariaLabel=t:this.editable?this.ariaLabel="Math Input":this.ariaLabel="",this.ariaLabel===e||this.containerHasFocus()||this.updateMathspeak(),this},t.prototype.getAriaLabel=function(){return"Math Input"!==this.ariaLabel?this.ariaLabel:this.editable?"Math Input":""},t.prototype.setAriaPostLabel=function(t,e){var n=this;return t&&"string"==typeof t&&""!==t?(t!==this.ariaPostLabel&&"number"==typeof e&&(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this._ariaAlertTimeout=setTimeout(function(){n.containerHasFocus()?n.aria.alert(n.root.mathspeak().trim()+" "+t.trim()):n.updateMathspeak()},e)),this.ariaPostLabel=t):(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this.ariaPostLabel=""),this},t.prototype.getAriaPostLabel=function(){return this.ariaPostLabel||""},t.prototype.containerHasFocus=function(){return document.activeElement&&this.container&&this.container[0]&&this.container[0].contains(document.activeElement)},t.prototype.getTextareaOrThrow=function(){var t=this.textarea;if(!t)throw new Error("expected a textarea");return t},t.prototype.getTextareaSpanOrThrow=function(){var t=this.textareaSpan;if(!t)throw new Error("expected a textareaSpan");return t},t.prototype.exportMathSpeak=function(){return this.root.mathspeak()},t.prototype.updateMathspeak=function(){},t.prototype.scrollHoriz=function(){},t.prototype.selectionChanged=function(){},t.prototype.setOverflowClasses=function(){},t.notifyees=[],t}(),Q={},E={},B=function(){function t(){}return t}(),I=new B,M=function(){function t(){}return t}(),R=function(){function t(){}return t}(),z=function(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},a.prototype=R.prototype,a.VERSION="v0.10.1",a.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return z=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},z(),a},a.getInterface=l,F=l.MIN=1,N=l.MAX=2,a.noConflict=function(){return window.MathQuill=P,a},P=window.MathQuill,window.MathQuill=a,$=function(){function t(t){this._=t}return t.prototype.parse=function(e){function n(t,e){return e}return this.skip(t.eof)._(""+e,n,u)},t.prototype.or=function(n){e("or is passed a parser",n instanceof t);var r=this;return new t(function(t,e,i){function o(r){return n._(t,e,i)}return r._(t,e,o)})},t.prototype.then=function(n){var r=this;return new t(function(i,o,s){function a(r,i){var a=n instanceof t?n:n(i);return e("a parser is returned",a instanceof t),a._(r,o,s)}return r._(i,a,s)})},t.prototype.many=function(){var e=this;return new t(function(t,n,r){function i(e,n){return t=e,s.push(n),!0}function o(){return!1}for(var s=[];e._(t,i,o););return n(t,s)})},t.prototype.times=function(e,n){arguments.length<2&&(n=e);var r=this;return new t(function(t,i,o){function s(e,n){return c.push(n),t=e,!0}function a(e,n){return p=n,t=e,!1}function l(t,e){return!1}var p,u,c=[],h=!0;for(u=0;u<e;u+=1)if(!(h=!!r._(t,s,a)))return o(t,p);for(;u<n&&h;u+=1)r._(t,s,l);return i(t,c)})},t.prototype.result=function(e){return this.then(t.succeed(e))},t.prototype.atMost=function(t){return this.times(0,t)},t.prototype.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.prototype.map=function(e){return this.then(function(n){return t.succeed(e(n))})},t.prototype.skip=function(t){return this.then(function(e){return t.result(e)})},t.string=function(e){var n=e.length,r="expected '"+e+"'";return new t(function(t,i,o){var s=t.slice(0,n);return s===e?i(t.slice(n),s):o(t,r)})},t.regex=function(n){e("regexp parser is anchored","^"===n.toString().charAt(1));var r="expected "+n;return new t(function(t,e,i){var o,s=n.exec(t);return s?(o=s[0],e(t.slice(o.length),o)):i(t,r)})},t.succeed=function(e){return new t(function(t,n){return n(t,e)})},t.fail=function(e){return new t(function(t,n,r){return r(t,e)})},t.letter=t.regex(/^[a-z]/i),t.letters=t.regex(/^[a-z]*/i),t.digit=t.regex(/^[0-9]/),t.digits=t.regex(/^[0-9]*/),t.whitespace=t.regex(/^\s+/),t.optWhitespace=t.regex(/^\s*/),t.any=new t(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),t.all=new t(function(t,e,n){return e("",t)}),t.eof=new t(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}),t}(),G=function(){function e(t){var e,n=t.which||t.keyCode,r=i[n],o=[];return t.ctrlKey&&o.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&o.push("Meta"),t.altKey&&o.push("Alt"),t.shiftKey&&o.push("Shift"),e=r||String.fromCharCode(n),o.length||r?(o.push(e),o.join("-")):e}function n(t){var e=t.which||t.keyCode,n=i[e];return!(t.ctrlKey||t.originalEvent&&t.originalEvent.metaKey||t.altKey||t.shiftKey||n)}function r(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}var i={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(i,o){function s(t){A=t,clearTimeout(v),v=setTimeout(t)}function a(e){s(function(n){A=t,clearTimeout(v),e(n)})}function l(){try{T[0].select()}catch(t){}}function p(e){A(),A=t,clearTimeout(v),T.val(e),e&&l(),x=!!e}function u(){var t=T[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function c(){o.options&&o.options.overrideKeystroke?o.options.overrideKeystroke(e(q),q):o.keystroke(e(q),q)}function h(t){t.target===T[0]&&(q=t,k=null,S=null,_=null,O=!1,x&&a(function(t){t&&"focusout"===t.type||l()}),c())}function f(t){if(!t||!t.originalEvent)return!1;switch(t.originalEvent.key){case"ArrowRight":case"ArrowLeft":case"ArrowDown":case"ArrowUp":return!0}return!1}function d(t){t.target===T[0]&&(q&&k&&c(),k=t,f(t)||s(g))}function m(t){t.target===T[0]&&q&&!k&&(f(t)||(_=t,s(g)))}function g(){if(!u()){var t=T.val();1===t.length?(T.val(""),o.options&&o.options.overrideTypedText?o.options.overrideTypedText(t):o.typedText(t)):0===t.length&&L&&!S&&q&&_&&!O&&n(q)?o.typedText(t):t&&l()}}function y(){q=null,k=null,A=t,clearTimeout(v),T.val("")}function w(t){t.target===T[0]&&(document.activeElement!==T[0]&&T[0].focus(),s(b))}function b(){var t=T.val();T.val(""),t&&o.paste(t)}var v,x,q=null,k=null,_=null,S=null,O=!1,L=r(),T=le(i),C=le(o.container||T),A=t;return C.bind("keydown keypress input keyup paste",function(t){A(t)}),x=!1,o.options&&o.options.disableCopyPaste?C.bind({keydown:h,keypress:d,keyup:m,focusout:y,copy:function(t){t.preventDefault()},cut:function(t){t.preventDefault()},paste:function(t){t.preventDefault()}}):C.bind({keydown:h,keypress:d,keyup:m,focusout:y,cut:function(){a(function(){o.cut()})},copy:function(){a(function(){o.copy()})},paste:w}),T.bind({input:function(t){S=t}}),{select:p}}}(),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})},e}(D),D.onNotify(function(t,e){if("edit"===e||"replace"===e||void 0===e){var n=t.controller;if(!n)return;if(!n.options.enableDigitGrouping)return;if(!1!==n.blurred)return;n.disableGroupingForSeconds(1)}}),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.disableGroupingForSeconds=function(t){clearTimeout(this.__disableGroupingTimeout);var e=this.root.jQ;0===t?e.removeClass("mq-suppress-grouping"):(e.addClass("mq-suppress-grouping"),this.__disableGroupingTimeout=setTimeout(function(){e.removeClass("mq-suppress-grouping")},1e3*t))},e.prototype.focusBlurEvents=function(){function t(){clearTimeout(n),o.selection&&o.selection.jQ.addClass("mq-blur"),e(),r.updateMathspeak()}function e(){o.hide().parent.blur(o),r.container.removeClass("mq-focused"),q(window).unbind("blur",t),r.options&&r.options.resetCursorOnBlur&&o.resetToEnd(r)}var n,r=this,i=r.root,o=r.cursor;r.getTextareaOrThrow().focus(function(){r.updateMathspeak(),r.blurred=!1,clearTimeout(n),r.container.addClass("mq-focused"),o.parent||o.insAtRightEnd(i),o.selection?(o.selection.jQ.removeClass("mq-blur"),r.selectionChanged()):o.show(),r.setOverflowClasses()}).blur(function(){r.textareaSelectionTimeout&&(clearTimeout(r.textareaSelectionTimeout),r.textareaSelectionTimeout=0),r.disableGroupingForSeconds(0),r.blurred=!0,n=setTimeout(function(){i.postOrder(function(t){t.intentionalBlur()}),o.clearSelection().endSelection(),e(),r.updateMathspeak(),r.scrollHoriz()}),q(window).bind("blur",t)}),r.blurred=!0,o.hide().parent.blur(o)},e.prototype.unbindFocusBlurEvents=function(){this.getTextareaOrThrow().unbind("focus blur")},e}(H),W=!1,V=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.keystroke=function(t,e,r){var i=r.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":r.ctrlDeleteDir(se);break;case"Shift-Backspace":case"Backspace":r.backspace();break;case"Esc":case"Tab":return void r.escapeDir(ae,t,e);case"Shift-Tab":case"Shift-Esc":return void r.escapeDir(se,t,e);case"End":r.notify("move").cursor.insAtRightEnd(i.parent),r.aria.queue("end of").queue(i.parent,!0);break;case"Ctrl-End":r.notify("move").cursor.insAtRightEnd(r.root),r.aria.queue("end of").queue(r.ariaLabel).queue(r.root).queue(r.ariaPostLabel);break;case"Shift-End":r.selectToBlockEndInDir(ae);break;case"Ctrl-Shift-End":r.selectToRootEndInDir(ae);break;case"Home":r.notify("move").cursor.insAtLeftEnd(i.parent),r.aria.queue("beginning of").queue(i.parent,!0);break;case"Ctrl-Home":r.notify("move").cursor.insAtLeftEnd(r.root),r.aria.queue("beginning of").queue(r.ariaLabel).queue(r.root).queue(r.ariaPostLabel);break;case"Shift-Home":r.selectToBlockEndInDir(se);break;case"Ctrl-Shift-Home":r.selectToRootEndInDir(se);break;case"Left":r.moveLeft();break;case"Shift-Left":r.selectLeft();break;case"Ctrl-Left":break;case"Right":r.moveRight();break;case"Shift-Right":r.selectRight();break;case"Ctrl-Right":break;case"Up":r.moveUp();break;case"Down":r.moveDown();break;case"Shift-Up":r.withIncrementalSelection(function(t){if(i[se])for(;i[se];)t(se);else t(se)});break;case"Shift-Down":r.withIncrementalSelection(function(t){if(i[ae])for(;i[ae];)t(ae);else t(ae)});break;case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":r.ctrlDeleteDir(ae);break;case"Shift-Del":case"Del":r.deleteForward();break;case"Meta-A":case"Ctrl-A":r.selectAll();break;case"Ctrl-Alt-Up":
i.parent.parent&&i.parent.parent instanceof n?r.aria.queue(i.parent.parent):r.aria.queue("nothing above");break;case"Ctrl-Alt-Down":i.parent&&i.parent instanceof n?r.aria.queue(i.parent):r.aria.queue("block is empty");break;case"Ctrl-Alt-Left":i.parent.parent&&i.parent.parent.ends&&i.parent.parent.ends[se]&&i.parent.parent.ends[se]instanceof n?r.aria.queue(i.parent.parent.ends[se]):r.aria.queue("nothing to the left");break;case"Ctrl-Alt-Right":i.parent.parent&&i.parent.parent.ends&&i.parent.parent.ends[ae]&&i.parent.parent.ends[ae]instanceof n?r.aria.queue(i.parent.parent.ends[ae]):r.aria.queue("nothing to the right");break;case"Ctrl-Alt-Shift-Down":i.selection?r.aria.queue(i.selection.join("mathspeak"," ").trim()+" selected"):r.aria.queue("nothing selected");break;case"Ctrl-Alt-=":case"Ctrl-Alt-Shift-Right":r.ariaPostLabel.length?r.aria.queue(r.ariaPostLabel):r.aria.queue("no answer");break;default:return}r.aria.alert(),e.preventDefault(),r.scrollHoriz()},n.prototype.moveOutOf=function(t,n,r){e("overridden or never called on this node")},n.prototype.moveTowards=function(t,n,r){e("overridden or never called on this node")},n.prototype.deleteOutOf=function(t,n){e("overridden or never called on this node")},n.prototype.deleteTowards=function(t,n){e("overridden or never called on this node")},n.prototype.unselectInto=function(t,n){e("overridden or never called on this node")},n.prototype.selectOutOf=function(t,n){e("overridden or never called on this node")},n.prototype.selectTowards=function(t,n){e("overridden or never called on this node")},n}(S),D.onNotify(function(t,e){"move"!==e&&"upDown"!==e||t.show().clearSelection()}),I.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},D.onNotify(function(t,e){"upDown"!==e&&(t.upDownCache={})}),D.onNotify(function(t,e){"edit"===e&&t.show().deleteSelection()}),D.onNotify(function(t,e){"select"!==e&&t.endSelection()}),K=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this.getControllerSelf())},r.prototype.escapeDir=function(t,e,r){n(t);var i=this.cursor;if(i.parent!==this.root&&r.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),i.controller.aria.alert(),this.notify("move")},r.prototype.moveDir=function(t){var e,r,i;return n(t),e=this.cursor,r=e.options.leftRightIntoCmdGoes,i=e[t],e.selection?e.insDirOf(t,e.selection.ends[t]):i?i.moveTowards(t,e,r):e.parent.moveOutOf(t,e,r),this.notify("move")},r.prototype.moveLeft=function(){return this.moveDir(se)},r.prototype.moveRight=function(){return this.moveDir(ae)},r.prototype.moveUp=function(){return this.moveUpDown("up")},r.prototype.moveDown=function(){return this.moveUpDown("down")},r.prototype.moveUpDown=function(t){var e,n,r,i,o,s,a=this,l=a.notify("upDown").cursor;return"up"===t?(e="upInto",n="upOutOf"):(e="downInto",n="downOutOf"),r=l[se],i=l[ae],o=i&&i[e],s=r&&r[e],o?l.insAtLeftEnd(o):s?l.insAtRightEnd(s):l.parent.bubble(function(t){var e=t[n];if(e&&("function"==typeof e&&(e=e.call(t,l)),e instanceof V&&l.jumpUpDown(t,e),!0!==e))return!1}),a},r.prototype.deleteDir=function(t){var e,r,i,o,s,a,l,p,u,c;return n(t),e=this.cursor,r=e[t],i=e.parent.parent,o=e.controller,r&&r instanceof V?r.sides?o.aria.queue(r.parent.chToCmd(r.sides[-t].ch).mathspeak({createdLeftOf:e})):r.blocks||"\\text"===r.parent.ctrlSeq||o.aria.queue(r):i&&i instanceof V&&(i.sides?o.aria.queue(i.parent.chToCmd(i.sides[t].ch).mathspeak({createdLeftOf:e})):i.blocks&&i.mathspeakTemplate?i.upInto&&i.downInto?o.aria.queue(i.mathspeakTemplate[1]):(s=i.mathspeakTemplate,a=t===se?s[0]:s[s.length-1],o.aria.queue(a)):o.aria.queue(i)),l=e.selection,this.notify("edit"),l||(p=e[t],p?p.deleteTowards(t,e):e.parent.deleteOutOf(t,e)),u=e[se],c=e[ae],u.siblingDeleted&&u.siblingDeleted(e.options,ae),c.siblingDeleted&&c.siblingDeleted(e.options,se),e.parent.bubble(function(t){t.reflow()}),this},r.prototype.ctrlDeleteDir=function(t){var e,r,i,o;return n(t),e=this.cursor,!e[t]||e.selection?this.deleteDir(t):(this.notify("edit"),r=t===se?new O(e.parent.ends[se],e[se]):new O(e[ae],e.parent.ends[ae]),e.controller.aria.queue(r),r.remove(),e.insAtDirEnd(t,e.parent),i=e[se],o=e[ae],i&&i.siblingDeleted(e.options,ae),o&&o.siblingDeleted(e.options,se),e.parent.bubble(function(t){t.reflow()}),this)},r.prototype.backspace=function(){return this.deleteDir(se)},r.prototype.deleteForward=function(){return this.deleteDir(ae)},r.prototype.startIncrementalSelection=function(){e("Multiple selections can't be simultaneously open",!W),W=!0,this.notify("select");var t=this.cursor;t.anticursor||t.startSelection()},r.prototype.selectDirIncremental=function(t){var r,i,o;e("A selection is open",W),W=!0,r=this.cursor,i=r.selection,n(t),o=r[t],o?i&&i.ends[t]===o&&r.anticursor[-t]!==o?o.unselectInto(t,r):o.selectTowards(t,r):r.parent.selectOutOf(t,r)},r.prototype.finishIncrementalSelection=function(){var t,n;e("A selection is open",W),t=this.cursor,t.clearSelection(),t.select()||t.show(),n=t.selection,n&&t.controller.aria.clear().queue(n.join("mathspeak"," ").trim()+" selected"),W=!1},r.prototype.withIncrementalSelection=function(t){var e=this;try{this.startIncrementalSelection();try{t(function(t){return e.selectDirIncremental(t)})}finally{this.finishIncrementalSelection()}}finally{W=!1}},r.prototype.selectDir=function(t){this.withIncrementalSelection(function(e){return e(t)})},r.prototype.selectLeft=function(){return this.selectDir(se)},r.prototype.selectRight=function(){return this.selectDir(ae)},r.prototype.selectAll=function(){this.notify("move");var t=this.cursor;t.insAtRightEnd(this.root),this.withIncrementalSelection(function(e){for(;t[se];)e(se)})},r.prototype.selectToBlockEndInDir=function(t){var e=this.cursor;this.withIncrementalSelection(function(n){for(;e[t];)n(t)})},r.prototype.selectToRootEndInDir=function(t){var e=this,n=this.cursor;this.withIncrementalSelection(function(r){for(;n[t]||n.parent!==e.root;)r(t)})},r}(U),function(t){function e(e){return t.call(this)||this}__extends(e,t)}(V),Z=function(){function t(t){var e=new lt;return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||new lt;for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[ae],0);return n}var n=$.string,r=$.regex,i=$.letter,o=$.digit,s=$.any,a=$.optWhitespace,l=$.succeed,p=$.fail,u=i.map(function(t){return new yt(t)}),c=o.map(function(t){return new mt(t)}),h=r(/^[^${}\\_^]/).map(function(t){return new st(t)}),f=r(/^[^\\a-eg-zA-Z]/).or(n("\\").then(r(/^[a-z]+/i).or(r(/^\s+/).result(" ")).or(s))).then(function(t){var e,n,r=L[t];return r?r.constructor?(e=r,new e(t).parser()):(n=r,n(t).parser()):p("unknown command: \\"+t)}),d=f.or(u).or(c).or(h),m=n("{").then(function(){return y}).skip(n("}")),g=a.then(m.or(d.map(t))),y=g.many().map(e).skip(a),w=n("[").then(g.then(function(t){return"]"!==t.join("latex")?l(t):p("")}).many().map(e).skip(a)).skip(n("]")),b=y;return b.block=g,b.optBlock=w,b}(),I.maxDepth=function(t){return"number"==typeof t?t:void 0},Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.cleanLatex=function(t){return t.replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},e.prototype.exportLatex=function(){return this.cleanLatex(this.root.latex())},e.prototype.writeLatex=function(t){var e=this.notify("edit").cursor;return e.parent.writeLatex(e,t),this},e.prototype.classifyLatexForEfficientUpdate=function(t){if("string"==typeof t){var e=t.match(/-?[0-9.]+$/g);return e&&1===e.length?{latex:t,prefix:t.substr(0,t.length-e[0].length),digits:e[0]}:void 0}},e.prototype.renderLatexMathEfficiently=function(t){var e,n,r,i,o,s,a,l,p,u,c,h,f,d,m,g,y,w,b,v,x,k,_=this.root,S=this.exportLatex();if(_.ends[se]&&_.ends[ae]&&S===t)return!0;if(!(n=this.classifyLatexForEfficientUpdate(t)))return!1;if(!(e=this.classifyLatexForEfficientUpdate(S))||e.prefix!==n.prefix)return!1;for(r=e.digits,i=n.digits,o=!1,s=!1,"-"===r[0]&&(o=!0,r=r.substr(1)),"-"===i[0]&&(s=!0,i=i.substr(1)),a=this.root.ends[ae],l=[],p=r.length-1;p>=0;p--){if(!a||a.ctrlSeq!==r[p])return!1;if(a.parent!==_)return!1;l.unshift(a),a=a[se]}if(o&&!s){if(!(u=a))return!1;if("-"!==u.ctrlSeq)return!1;if(u[ae]!==l[0])return!1;if(u.parent!==_)return!1;if((c=u[se])&&c.parent!==_)return!1;l[0][se]=u[se],_.ends[se]===u&&(_.ends[se]=l[0]),c&&(c[ae]=l[0]),u.jQ.remove()}for(!o&&s&&(h=new St("-"),f=document.createElement("span"),f.textContent="-",h.jQ=q(f),d=l[0][se],d&&(d[ae]=h),_.ends[se]===l[0]&&(_.ends[se]=h),h.parent=_,h[se]=l[0][se],h[ae]=l[0],l[0][se]=h,h.contactWeld(this.cursor),h.jQ.insertBefore(l[0].jQ)),m=Math.min(r.length,i.length),p=0;p<m;p++)g=i[p],a=l[p],a.ctrlSeq!==g&&(a.ctrlSeq=g,a.jQ[0].textContent=g,a.mathspeakName=g);if(r.length>i.length)for(a=l[i.length-1],_.ends[ae]=a,a[ae]=0,p=r.length-1;p>=m;p--)l[p].jQ.remove();if(i.length>r.length){for(y=document.createDocumentFragment(),p=m;p<i.length;p++)w=document.createElement("span"),w.className="mq-digit",w.textContent=i[p],b=new mt(i[p]),b.parent=_,b.jQ=q(w),y.appendChild(w),b[se]=_.ends[ae],b[ae]=0,v=b[se],v[ae]=b,_.ends[ae]=b;_.jQ[0].appendChild(y)}return(x=this.exportLatex())!==t?(console.warn("tried updating latex efficiently but did not work. Attempted: "+t+" but wrote: "+x),!1):(this.cursor.resetToEnd(this),k=_.ends[ae],k&&k.fixDigitGrouping(this.cursor.options),!0)},e.prototype.renderLatexMathFromScratch=function(t){var e,n,r=this.root,i=this.cursor,o=$.all,s=$.eof,a=Z.skip(s).or(o.result(!1)).parse(t);r.ends[se]=r.ends[ae]=0,a&&a.children().adopt(r,0,0),e=r.jQ,a?(n=a.join("html"),e.html(n),r.jQize(e.children()),r.finalizeInsert(i.options,i)):e.empty(),this.updateMathspeak(),delete i.selection,i.insAtRightEnd(r)},e.prototype.renderLatexMath=function(t){this.notify("replace"),this.renderLatexMathEfficiently(t)||this.renderLatexMathFromScratch(t)},e.prototype.renderLatexText=function(t){var e,n,r,i,o,s,a,l,p,u,c=this.root,h=this.cursor;if(c.jQ.children().slice(1).remove(),c.ends[se]=c.ends[ae]=0,delete h.selection,h.show().insAtRightEnd(c),e=$.regex,n=$.string,r=$.eof,i=$.all,o=n("$").then(Z).skip(n("$").or(r)).map(function(t){var e,n=new ht(h);return n.createBlocks(),e=n.ends[se],t.children().adopt(e,0,0),n}),s=n("\\$").result("$"),a=s.or(e(/^[^$]/)).map(function(t){return new st(t)}),l=o.or(a).many(),p=l.skip(r).or(i.result(!1)).parse(t)){for(u=0;u<p.length;u+=1)p[u].adopt(c,c.ends[ae],0);c.jQize().appendTo(c.jQ),c.finalizeInsert(h.options,h)}},e}(K),X=function(t){return!1},M.prototype.ignoreNextMousedown=X,function(){D.onNotify(function(t,e){"edit"!==e&&"replace"!==e||J&&J.cursor===t&&J.cb()})}(),tt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function r(t){l=q(t.target)}function i(t){m.anticursor||m.startSelection(),d.seek(l,t.pageX,t.pageY).cursor.select(),m.selection&&m.controller.aria.clear().queue(m.selection.join("mathspeak")+" selected").alert(),l=void 0}function o(t){h.unbind("mousemove",r);var e=t.target;q(e.ownerDocument).unbind("mousemove",i).unbind("mouseup",a),J=void 0}function s(){d.editable?(m.show(),m.controller.aria.queue(m.parent).alert()):y.detach()}function a(t){m.blink=g,m.selection||s(),o(t)}var l,p,u,c=n,h=q(c.target).closest(".mq-root-block"),f=S.getNodeOfElement(h[0])||S.getNodeOfElement(e[0]),d=f.controller,m=d.cursor,g=m.blink,y=d.getTextareaSpanOrThrow(),w=d.getTextareaOrThrow();c.preventDefault(),c.target.unselectable=!0,m.options.ignoreNextMousedown(c)||(m.options.ignoreNextMousedown=X,J={cursor:m,cb:function(){p=!0,m.blink=g,m.clearSelection(),s(),o(c)}},d.blurred&&(d.editable||h.prepend(y),w[0].focus(),p)||(m.blink=t,d.seek(q(c.target),c.pageX,c.pageY).cursor.startSelection(),h.mousemove(r),u=c.target,q(u.ownerDocument).mousemove(i).mouseup(a)))})},n.prototype.seek=function(t,e,n){for(var r,i=this.notify("select").cursor,o=t&&t[0];o&&!(r=S.getNodeOfElement(o));)o=o.parentElement;return r||(r=this.root),i.clearSelection().show(),r.seek(e,i),this.scrollHoriz(),this},n}(Y),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setOverflowClasses=function(){var t,e,n,r=this.root.jQ[0],i=!1,o=!1;this.blurred||(t=r.getBoundingClientRect().width,e=r.scrollWidth,n=r.scrollLeft,i=e>t+n,o=n>0),r.classList.contains("mq-editing-overflow-right")!==i&&r.classList.toggle("mq-editing-overflow-right"),r.classList.contains("mq-editing-overflow-left")!==o&&r.classList.toggle("mq-editing-overflow-left")},e.prototype.scrollHoriz=function(){var t,e,n,r,i,o,s=this,a=this.cursor,l=a.selection,p=this.root.jQ[0].getBoundingClientRect();if(!a.jQ[0]&&!l)return void this.root.jQ.stop().animate({scrollLeft:0},100,function(){s.setOverflowClasses()});if(l)if(n=l.jQ[0].getBoundingClientRect(),r=n.left-(p.left+20),i=n.right-(p.right-20),l.ends[se]===a[ae])if(r<0)e=r;else{if(!(i>0))return;e=n.left-i<p.left+20?r:i}else if(i>0)e=i;else{if(!(r<0))return;e=n.right-r>p.right-20?i:r}else if((t=a.jQ[0].getBoundingClientRect().left)>p.right-20)e=t-(p.right-20);else{if(!(t<p.left+20))return;e=t-(p.left+20)}o=this.root.jQ[0],e<0&&0===o.scrollLeft||e>0&&o.scrollWidth<=o.scrollLeft+p.width||this.root.jQ.stop().animate({scrollLeft:"+="+e},100,function(){s.setOverflowClasses()})},e}(tt),M.prototype.substituteTextarea=function(){return q("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true/>")[0]},M.prototype.substituteKeyboardEvents=G,nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createTextarea=function(){var t,e=this.textareaSpan=q('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;this.textarea=q(n).appendTo(e),this.aria.setContainer(this.textareaSpan),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()}},e.prototype.selectionChanged=function(){var t=this;t.textareaSelectionTimeout||(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},e.prototype.setTextareaSelection=function(){this.textareaSelectionTimeout=0;var t="";this.cursor.selection&&(t=this.cleanLatex(this.cursor.selection.join("latex")),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},e.prototype.staticMathTextareaEvents=function(){function t(){i.detach(),e.blurred=!0}var e=this,n=e.cursor,r=e.getTextareaOrThrow(),i=e.getTextareaSpanOrThrow();this.container.prepend(le('<span aria-hidden="true" class="mq-selectable">').text("$"+e.exportLatex()+"$")),this.mathspeakSpan=q('<span class="mq-mathspeak"></span>'),this.container.prepend(this.mathspeakSpan),e.blurred=!0,r.bind("cut paste",!1),e.options.disableCopyPaste?r.bind("copy",!1):r.bind("copy",function(){e.setTextareaSelection()}),r.focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){r.val(t),t&&r.select()},this.updateMathspeak()},e.prototype.editablesTextareaEvents=function(){var t=this,e=t.getTextareaOrThrow(),n=t.getTextareaSpanOrThrow(),r=this.options.substituteKeyboardEvents(e,this);this.selectFn=function(t){r.select(t)},this.container.prepend(n),this.focusBlurEvents(),this.updateMathspeak()},e.prototype.unbindEditablesEvents=function(){var t=this,e=t.getTextareaOrThrow(),n=t.getTextareaSpanOrThrow();this.selectFn=function(t){e.val(t),t&&e.select()},n.remove(),this.unbindFocusBlurEvents(),t.blurred=!0,e.bind("cut paste",!1)},e.prototype.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify(void 0).cursor;e.parent.write(e,t),this.scrollHoriz()},e.prototype.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble(function(t){t.reflow()}),t.options&&t.options.onCut&&t.options.onCut()})},e.prototype.copy=function(){this.setTextareaSelection()},e.prototype.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show(),this.scrollHoriz(),this.options&&this.options.onPaste&&this.options.onPaste()},e.prototype.updateMathspeak=function(){var t,e=this,n=e.getAriaLabel(),r=/[A-Za-z0-9]$/.test(n)?n+":":n,i=e.root.mathspeak().trim();this.aria.clear(),t=e.getTextareaOrThrow(),e.mathspeakSpan?(t.attr("aria-label",""),e.mathspeakSpan.text((r+" "+i).trim())):t.attr("aria-label",(r+" "+i+" "+e.ariaPostLabel).trim())},e}(et),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.finalizeInsert=function(t,e){var n,r,i=this;i.postOrder(function(e){e.finalizeTree(t)}),i.postOrder(function(t){t.contactWeld(e)}),i.postOrder(function(t){t.blur(e)}),i.postOrder(function(t){t.reflow()}),n=i[ae],r=i[se],n&&n.siblingCreated(t,se),r&&r.siblingCreated(t,ae),i.bubble(function(t){t.reflow()})},e.prototype.prepareInsertionAt=function(t){var e,n=t.options.maxDepth;if(void 0!==n){if((e=t.depth())>n)return!1;this.removeNodesDeeperThan(n-e)}return!0},e.prototype.removeNodesDeeperThan=function(t){for(var e,n,r=0,i=[[this,r]];e=i.shift();)n=e,n[0].children().each(function(e){var o=e instanceof lt?1:0;r=n[1]+o,r<=t?i.push([e,r]):(o?e.children():e).remove()})},e}(V),it=function(t){function n(e,n,r){var i=t.call(this)||this;return i.textTemplate=[""],i.mathspeakTemplate=[""],i.setCtrlSeqHtmlAndText(e,n,r),i}return __extends(n,t),n.prototype.setCtrlSeqHtmlAndText=function(t,e,n){this.ctrlSeq||(this.ctrlSeq=t),e&&(this.htmlTemplate=e),n&&(this.textTemplate=n)},n.prototype.replaces=function(t){t.disown(),this.replacedFragment=t},n.prototype.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},n.prototype.parser=function(){var t=this;return Z.block.times(this.numBlocks()).map(function(e){t.blocks=e;for(var n=0;n<e.length;n+=1)e[n].adopt(t,t.ends[ae],0);return t})},n.prototype.createLeftOf=function(e){var n,r=this,i=r.replacedFragment;r.createBlocks(),t.prototype.createLeftOf.call(this,e),i&&(n=r.ends[se],i.adopt(n,0,0),i.jQ.appendTo(n.jQ),r.placeCursor(e),r.prepareInsertionAt(e)),r.finalizeInsert(e.options,e),r.placeCursor(e)},n.prototype.createBlocks=function(){var t,e,n=this,r=n.numBlocks(),i=n.blocks=Array(r);for(t=0;t<r;t+=1)e=i[t]=new lt,e.adopt(n,n.ends[ae],0)},n.prototype.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[se],function(t,e){return t.isEmpty()?t:e}))},n.prototype.moveTowards=function(t,e,n){var r,i;"up"===n?r=this.upInto:"down"===n&&(r=this.downInto),i=r||this.ends[-t],e.insAtDirEnd(-t,i),e.controller.aria.queueDirEndOf(-t).queue(e.parent,!0)},n.prototype.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e)},n.prototype.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},n.prototype.selectChildren=function(){return new j(this,this)},n.prototype.unselectInto=function(t,e){var n=e.anticursor,r=n.ancestors[this.id];e.insAtDirEnd(-t,r)},n.prototype.seek=function(t,e){function n(t){var e,n=t.jQ.offset().left,r=n+t.jQ.outerWidth();return e={},e[se]=n,e[ae]=r,e}var r,i=this,o=n(i);return t<o[se]?e.insLeftOf(i):t>o[ae]?e.insRightOf(i):(r=o[se],void i.eachChild(function(s){var a=n(s);return t<a[se]?(t-r<a[se]-t?s[se]?e.insAtRightEnd(s[se]):e.insLeftOf(i):e.insAtLeftEnd(s),!1):t>a[ae]?void(s[ae]?r=a[ae]:o[ae]-t<t-a[ae]?e.insRightOf(i):e.insAtRightEnd(s)):(s.seek(t,e),!1)}))},n.prototype.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},n.prototype.html=function(){var t,n,r,i=this,o=i.blocks,s=" mathquill-command-id="+i.id,a=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(e("no unmatched angle brackets",a.join("")===this.htmlTemplate),t=0,n=a[0];n;t+=1,n=a[t])if("/>"===n.slice(-2))a[t]=n.slice(0,-2)+s+' aria-hidden="true"/>';else if("<"===n.charAt(0)){e("not an unmatched top-level close tag","/"!==n.charAt(1)),a[t]=n.slice(0,-1)+s+' aria-hidden="true">',r=1;do{t+=1,n=a[t],e("no missing close tags",n),"</"===n.slice(0,2)?r-=1:"<"===n.charAt(0)&&"/>"!==n.slice(-2)&&(r+=1)}while(r>0)}return a.join("").replace(/>&(\d+)/g,function(t,e){var n=parseInt(e,10);return" mathquill-block-id="+o[n].id+' aria-hidden="true">'+o[n].join("html")})},n.prototype.latex=function(){return this.foldChildren(this.ctrlSeq||"",function(t,e){return t+"{"+(e.latex()||" ")+"}"})},n.prototype.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,r){e+=1;var i=r.text();return n&&"("===t.textTemplate[e]&&"("===i[0]&&")"===i.slice(-1)?n+i.slice(1,-1)+t.textTemplate[e]:n+i+(t.textTemplate[e]||"")})},n.prototype.mathspeak=function(){var t=this,e=0;return t.foldChildren(t.mathspeakTemplate[e]||"Start"+t.ctrlSeq+" ",function(n,r){return e+=1,n+" "+r.mathspeak()+" "+(t.mathspeakTemplate[e]+" "||"End"+t.ctrlSeq+" ")})},n}(rt),ot=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.setCtrlSeqHtmlTextAndMathspeak(e,n,r,i),o}return __extends(e,t),e.prototype.setCtrlSeqHtmlTextAndMathspeak=function(e,n,r,i){!r&&e&&(r=e.replace(/^\\/,"")),this.mathspeakName=i||r,t.prototype.setCtrlSeqHtmlAndText.call(this,e,n,[r||""])},e.prototype.parser=function(){return $.succeed(this)},e.prototype.numBlocks=function(){return 0},e.prototype.replaces=function(t){t.remove()},e.prototype.createBlocks=function(){},e.prototype.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t],e.controller.aria.queue(this)},e.prototype.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.prototype.seek=function(t,e){return t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this),e},e.prototype.latex=function(){return this.ctrlSeq||""},e.prototype.text=function(){return this.textTemplate.join("")},e.prototype.mathspeak=function(t){return this.mathspeakName||""},e.prototype.placeCursor=function(){},e.prototype.isEmpty=function(){return!0},e}(it),st=function(t){function e(e,n,r){return t.call(this,e,"<span>"+(n||e)+"</span>",void 0,r)||this}return __extends(e,t),e}(ot),at=function(t){function e(e,n,r,i,o){return o?t.call(this,e,"<span>"+(n||e)+"</span>",void 0,i)||this:t.call(this,e,'<span class="mq-binary-operator">'+n+"</span>",r,i)||this}return __extends(e,t),e}(ot),lt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ariaLabel="block",e}return __extends(e,t),e.prototype.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},e.prototype.html=function(){return this.join("html")},e.prototype.latex=function(){return this.join("latex")},e.prototype.text=function(){var t=this.ends[se];return t===this.ends[ae]&&0!==t?t.text():this.join("text")},e.prototype.mathspeak=function(){var t="",e={};return this.controller&&(e=this.controller.options.autoOperatorNames),this.foldChildren([],function(n,r){var i,o,s;return r.isPartOfOperator?t+=r.mathspeak():(""!==t&&(e._maxLength>0&&"string"==typeof(i=e[t.toLowerCase()])&&(t=i),n.push(t+" "),t=""),o=r.mathspeak(),s=r.ctrlSeq,!isNaN(s)||"."===s||r.parent&&r.parent.parent&&r.parent.parent.isTextBlock()||(o=" "+o+" "),n.push(o)),n}).join("").replace(/ +(?= )/g,"").replace(/(\.)([0-9]+)/g,function(t,e,n){return e+n.split("").join(" ").trim()})},e.prototype.keystroke=function(e,n,r){return!r.options.spaceBehavesLikeTab||"Spacebar"!==e&&"Shift-Spacebar"!==e?t.prototype.keystroke.call(this,e,n,r):(n.preventDefault(),void r.escapeDir("Shift-Spacebar"===e?se:ae,e,n))},e.prototype.moveOutOf=function(t,e,n){var r,i;"up"===n?r=this.parent.upInto:"down"===n&&(r=this.parent.downInto),!r&&this[t]?(i=-t,e.insAtDirEnd(i,this[t]),e.controller.aria.queueDirEndOf(i).queue(e.parent,!0)):(e.insDirOf(t,this.parent),e.controller.aria.queueDirOf(t).queue(this.parent))},e.prototype.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},e.prototype.deleteOutOf=function(t,e){e.unwrapGramp()},e.prototype.seek=function(t,e){var n,r=this.ends[ae];if(!r||r.jQ.offset().left+r.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(n=this.ends[se],t<n.jQ.offset().left)return e.insAtLeftEnd(this);for(;t<r.jQ.offset().left;)r=r[se];return r.seek(t,e)},e.prototype.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?new yt(t):/^\d$/.test(t)?new mt(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?L["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?L["×"](t):e&&e.typingPercentWritesPercentOf&&"%"===t?L.percentof(t):(n=T[t]||L[t])?n.constructor?new n(t):n(t):new st(t)},e.prototype.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||(n.createLeftOf(t.show()),"/"===e?t.controller.aria.alert("over"):t.controller.aria.alert(n.mathspeak({createdLeftOf:t})))},e.prototype.writeLatex=function(t,e){var n,r,i,o,s,a=$.all,l=$.eof,p=Z.skip(l).or(a.result(!1)).parse(e);p&&!p.isEmpty()&&p.prepareInsertionAt(t)&&(p.children().adopt(t.parent,t[se],t[ae]),n=p.jQize(),n.insertBefore(t.jQ),t[se]=p.ends[ae],p.finalizeInsert(t.options,t),r=p.ends[ae],i=p.ends[se],o=r[ae],s=i[se],o&&o.siblingCreated(t.options,se),s&&s.siblingCreated(t.options,ae),t.parent.bubble(function(t){t.reflow()}))},e.prototype.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},e.prototype.blur=function(t){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&(this.jQ.addClass("mq-empty"),t&&this.isQuietEmptyDelimiter(t.options.quietEmptyDelimiters)&&this.jQ.addClass("mq-quiet-delimiter")),this},e}(rt),M.prototype.mouseEvents=!0,Q.StaticMath=function(t){var e;return e=function(e){function n(n){var r=e.call(this,n)||this,i=r.innerFields=[];return r.__controller.root.postOrder(function(e){e.registerInnerField(i,t.InnerMathField)}),r}return __extends(n,e),n.prototype.__mathquillify=function(t,n){return this.config(t),e.prototype.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},n.prototype.latex=function(){var n,r=e.prototype.latex.apply(this,arguments);return arguments.length>0&&(n=this.innerFields=[],this.__controller.root.postOrder(function(e){e.registerInnerField(n,t.InnerMathField)}),this.__controller.updateMathspeak()),r},n.prototype.setAriaLabel=function(t){return this.__controller.setAriaLabel(t),this},n.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},n}(t.AbstractMathQuill),e.RootBlock=lt,e},pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(lt),p(pt.prototype),Q.MathField=function(e){var n;return n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.__mathquillify=function(n,r){return this.config(n),r>1&&(this.__controller.root.reflow=t),e.prototype.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this},n}(e.EditableField),n.RootBlock=pt,n},Q.InnerMathField=function(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.makeStatic=function(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),this.__controller.container.removeClass("mq-editable-field")},e.prototype.makeEditable=function(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),this.__controller.container.addClass("mq-editable-field")},e}(t.MathField)},ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\text",e.ariaLabel="Text",e.mathspeakTemplate=["StartText","EndText"],e}return __extends(e,t),e.prototype.replaces=function(t){t instanceof O?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},e.prototype.jQadd=function(e){var n,r;return t.prototype.jQadd.call(this,e),n=this.ends[se],n&&(r=this.jQ[0].firstChild)&&n.jQadd(r),this.jQ},e.prototype.createLeftOf=function(e){var n,r,i,o=this;if(t.prototype.createLeftOf.call(this,e),e.insAtRightEnd(o),o.replacedText)for(n=0;n<o.replacedText.length;n+=1)o.write(e,o.replacedText.charAt(n));r=o[ae],r&&r.siblingCreated(e.options,se),i=o[se],i&&i.siblingCreated(e.options,ae),o.bubble(function(t){t.reflow()})},e.prototype.parser=function(){var t=this,e=$.string,n=$.regex;return $.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?new O:(new ct(e).adopt(t,0,0),t)})},e.prototype.textContents=function(){return this.foldChildren("",function(t,e){return t+e.textStr})},e.prototype.text=function(){return'"'+this.textContents()+'"'},e.prototype.latex=function(){var t=this.textContents();return 0===t.length?"":this.ctrlSeq+"{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},e.prototype.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},e.prototype.mathspeak=function(t){return t&&t.ignoreShorthand?this.mathspeakTemplate[0]+", "+this.textContents()+", "+this.mathspeakTemplate[1]:this.textContents()},e.prototype.isTextBlock=function(){return!0},e.prototype.moveTowards=function(t,e){e.insAtDirEnd(-t,this),e.controller.aria.queueDirEndOf(-t).queue(e.parent,!0)},e.prototype.moveOutOf=function(t,e){e.insDirOf(t,this),e.controller.aria.queueDirOf(t).queue(this)},e.prototype.unselectInto=function(t,e){this.moveTowards(t,e)},e.prototype.selectTowards=function(t,e){it.prototype.selectTowards.call(this,t,e)},e.prototype.deleteTowards=function(t,e){it.prototype.deleteTowards.call(this,t,e)},e.prototype.selectOutOf=function(t,e){e.insDirOf(t,this)},e.prototype.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},e.prototype.write=function(n,r){var i,o,s;n.show().deleteSelection(),"$"!==r?(i=n[se],i?i instanceof ct&&i.appendText(r):new ct(r).createLeftOf(n)):this.isEmpty()?(n.insRightOf(this),new st("\\$","$").createLeftOf(n)):n[ae]?n[se]?(o=new e,s=this.ends[se],s&&(s.disown().jQ.detach(),s.adopt(o,0,0)),n.insLeftOf(this),t.prototype.createLeftOf.call(o,n)):n.insLeftOf(this):n.insRightOf(this),this.bubble(function(t){t.reflow()}),n.controller.aria.alert(r)},e.prototype.writeLatex=function(t,e){var n=t[se];n?n instanceof ct&&n.appendText(e):new ct(e).createLeftOf(t),this.bubble(function(t){t.reflow()})},e.prototype.seek=function(t,e){var n,r,i,o,s,a,l,p,u,c;if(e.hide(),n=f(this)){for(r=this.jQ.width()/this.text.length,i=Math.round((t-this.jQ.offset().left)/r),i<=0?e.insAtLeftEnd(this):i>=n.textStr.length?e.insAtRightEnd(this):e.insLeftOf(n.splitRight(i)),o=t-e.show().offset().left,s=o&&o<0?se:ae,a=s;e[s]&&o*a>0;)e[s].moveTowards(s,e),a=o,o=t-e.offset().left;s*o<-s*a&&e[-s].moveTowards(-s,e),e.anticursor?e.anticursor.parent===this&&(l=e[se],p=l&&l.textStr.length,this.anticursorPosition===p?e.anticursor=C.fromCursor(e):(this.anticursorPosition<p?(u=l.splitRight(this.anticursorPosition),e[se]=u):(c=e[ae],u=c.splitRight(this.anticursorPosition-p)),e.anticursor=new C(this,u[se],u))):(l=e[se],this.anticursorPosition=l&&l.textStr.length)}},e.prototype.blur=function(t){lt.prototype.blur.call(this,t),t&&(""===this.textContents()?(this.remove(),t[se]===this?t[se]=this[se]:t[ae]===this&&(t[ae]=this[ae])):f(this))},e.prototype.focus=function(){lt.prototype.focus.call(this)},e}(V),ct=function(t){function e(e){var n=t.call(this)||this;return n.textStr=e,n}return __extends(e,t),e.prototype.jQadd=function(t){return this.dom=t,this.jQ=q(t),this.jQ},e.prototype.jQize=function(){return this.jQadd(document.createTextNode(this.textStr))},e.prototype.appendText=function(t){this.textStr+=t,this.dom.appendData(t)},e.prototype.prependText=function(t){this.textStr=t+this.textStr,this.dom.insertData(0,t)},e.prototype.insTextAtDirEnd=function(t,e){n(e),e===ae?this.appendText(t):this.prependText(t)},e.prototype.splitRight=function(t){var n=new e(this.textStr.slice(t)).adopt(this.parent,this,this[ae]);return n.jQadd(this.dom.splitText(t)),
this.textStr=this.textStr.slice(0,t),n},e.prototype.endChar=function(t,e){return e.charAt(t===se?0:-1+e.length)},e.prototype.moveTowards=function(t,r){var i,o;return n(t),i=this.endChar(-t,this.textStr),o=this[-t],o instanceof e?o.insTextAtDirEnd(i,t):new e(i).createDir(-t,r),this.deleteTowards(t,r)},e.prototype.mathspeak=function(){return this.textStr},e.prototype.latex=function(){return this.textStr},e.prototype.deleteTowards=function(t,e){if(this.textStr.length>1){var n;t===ae?(this.dom.deleteData(0,1),n=this.textStr[0],this.textStr=this.textStr.slice(1)):(this.dom.deleteData(-1+this.textStr.length,1),n=this.textStr[this.textStr.length-1],this.textStr=this.textStr.slice(0,-1)),e.controller.aria.queue(n)}else this.remove(),this.jQ.remove(),e[t]=this[t],e.controller.aria.queue(this.textStr)},e.prototype.selectTowards=function(t,r){var i,o,s,a,l;if(n(t),i=r.anticursor)return o=this.endChar(-t,this.textStr),i[t]===this?(s=new e(o).createDir(t,r),i[t]=s,r.insDirOf(t,s)):(a=this[-t],a instanceof e?a.insTextAtDirEnd(o,t):(s=new e(o).createDir(-t,r),(l=r.selection)&&s.jQ.insDirOf(-t,l.jQ)),1===this.textStr.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,r)},e}(V),L.text=L.textnormal=L.textrm=L.textup=L.textmd=ut,L.em=L.italic=L.italics=L.emph=L.textit=L.textsl=d("\\textit","Italic","i",'class="mq-text-mode"'),L.strong=L.bold=L.textbf=d("\\textbf","Bold","b",'class="mq-text-mode"'),L.sf=L.textsf=d("\\textsf","Sans serif font","span",'class="mq-sans-serif mq-text-mode"'),L.tt=L.texttt=d("\\texttt","Mono space font","span",'class="mq-monospace mq-text-mode"'),L.textsc=d("\\textsc","Variable font","span",'style="font-variant:small-caps" class="mq-text-mode"'),L.uppercase=d("\\uppercase","Uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),L.lowercase=d("\\lowercase","Lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),ht=function(t){function e(e){var n=t.call(this,"$")||this;return n.htmlTemplate='<span class="mq-math-mode">&0</span>',n.cursor=e,n}return __extends(e,t),e.prototype.createBlocks=function(){t.prototype.createBlocks.call(this);var e=this.ends[se];e.cursor=this.cursor,e.write=function(t,e){"$"!==e?lt.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(void 0,t),new st("\\$","$").createLeftOf(t.show())):t[ae]?t[se]?lt.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},e.prototype.latex=function(){return"$"+this.ends[se].latex()+"$"},e}(it),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.keystroke=function(e,n,r){if("Spacebar"!==e&&"Shift-Spacebar"!==e)return t.prototype.keystroke.call(this,e,n,r)},e.prototype.write=function(t,e){if(t.show().deleteSelection(),"$"===e)new ht(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),new st(e,n).createLeftOf(t)}},e}(pt),Q.TextField=function(t){var e;return e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.__mathquillify=function(){return t.prototype.__mathquillify.call(this,"mq-editable-field mq-text-mode")},e.prototype.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},e}(t.EditableField),e.RootBlock=ft,e},L.notin=L.cong=L.equiv=L.oplus=L.otimes=function(t){return new at("\\"+t+" ","&"+t+";")},L["∗"]=L.ast=L.star=L.loast=L.lowast=h("\\ast ","&lowast;","low asterisk"),L.therefor=L.therefore=h("\\therefore ","&there4;","therefore"),L.cuz=L.because=h("\\because ","&#8757;","because"),L.prop=L.propto=h("\\propto ","&prop;","proportional to"),L["≈"]=L.asymp=L.approx=h("\\approx ","&asymp;","approximately equal to"),L.isin=L.in=h("\\in ","&isin;","is in"),L.ni=L.contains=h("\\ni ","&ni;","is not in"),L.notni=L.niton=L.notcontains=L.doesnotcontain=h("\\not\\ni ","&#8716;","does not contain"),L.sub=L.subset=h("\\subset ","&sub;","subset"),L.sup=L.supset=L.superset=h("\\supset ","&sup;","superset"),L.nsub=L.notsub=L.nsubset=L.notsubset=h("\\not\\subset ","&#8836;","not a subset"),L.nsup=L.notsup=L.nsupset=L.notsupset=L.nsuperset=L.notsuperset=h("\\not\\supset ","&#8837;","not a superset"),L.sube=L.subeq=L.subsete=L.subseteq=h("\\subseteq ","&sube;","subset or equal to"),L.supe=L.supeq=L.supsete=L.supseteq=L.supersete=L.superseteq=h("\\supseteq ","&supe;","superset or equal to"),L.nsube=L.nsubeq=L.notsube=L.notsubeq=L.nsubsete=L.nsubseteq=L.notsubsete=L.notsubseteq=h("\\not\\subseteq ","&#8840;","not subset or equal to"),L.nsupe=L.nsupeq=L.notsupe=L.notsupeq=L.nsupsete=L.nsupseteq=L.notsupsete=L.notsupseteq=L.nsupersete=L.nsuperseteq=L.notsupersete=L.notsuperseteq=h("\\not\\supseteq ","&#8841;","not superset or equal to"),L.mathbb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(t){},e.prototype.numBlocks=function(){return 1},e.prototype.parser=function(){var t=$.string,e=$.regex,n=$.optWhitespace;return n.then(t("{")).then(n).then(e(/^[NPZQRCH]/)).skip(n).skip(t("}")).map(function(t){var e=L[t];return s(e)?new e:e()})},e}(it),L.N=L.naturals=L.Naturals=c("\\mathbb{N}","&#8469;","naturals"),L.P=L.primes=L.Primes=L.projective=L.Projective=L.probability=L.Probability=c("\\mathbb{P}","&#8473;","P"),L.Z=L.integers=L.Integers=c("\\mathbb{Z}","&#8484;","integers"),L.Q=L.rationals=L.Rationals=c("\\mathbb{Q}","&#8474;","rationals"),L.R=L.reals=L.Reals=c("\\mathbb{R}","&#8477;","reals"),L.C=L.complex=L.Complex=L.complexes=L.Complexes=L.complexplane=L.Complexplane=L.ComplexPlane=c("\\mathbb{C}","&#8450;","complexes"),L.H=L.Hamiltonian=L.quaternions=L.Quaternions=c("\\mathbb{H}","&#8461;","quaternions"),L.quad=L.emsp=c("\\quad ","    ","4 spaces"),L.qquad=c("\\qquad ","        ","8 spaces"),L.diamond=c("\\diamond ","&#9671;","diamond"),L.bigtriangleup=c("\\bigtriangleup ","&#9651;","triangle up"),L.ominus=c("\\ominus ","&#8854;","o minus"),L.uplus=c("\\uplus ","&#8846;","disjoint union"),L.bigtriangledown=c("\\bigtriangledown ","&#9661;","triangle down"),L.sqcap=c("\\sqcap ","&#8851;","greatest lower bound"),L.triangleleft=c("\\triangleleft ","&#8882;","triangle left"),L.sqcup=c("\\sqcup ","&#8852;","least upper bound"),L.triangleright=c("\\triangleright ","&#8883;","triangle right"),L.odot=L.circledot=c("\\odot ","&#8857;","circle dot"),L.bigcirc=c("\\bigcirc ","&#9711;","circle"),L.dagger=c("\\dagger ","&#0134;","dagger"),L.ddagger=c("\\ddagger ","&#135;","big dagger"),L.wr=c("\\wr ","&#8768;","wreath"),L.amalg=c("\\amalg ","&#8720;","amalgam"),L.models=c("\\models ","&#8872;","models"),L.prec=c("\\prec ","&#8826;","precedes"),L.succ=c("\\succ ","&#8827;","succeeds"),L.preceq=c("\\preceq ","&#8828;","precedes or equals"),L.succeq=c("\\succeq ","&#8829;","succeeds or equals"),L.simeq=c("\\simeq ","&#8771;","similar or equal to"),L.mid=c("\\mid ","&#8739;","divides"),L.ll=c("\\ll ","&#8810;","ll"),L.gg=c("\\gg ","&#8811;","gg"),L.parallel=c("\\parallel ","&#8741;","parallel with"),L.nparallel=c("\\nparallel ","&#8742;","not parallel with"),L.bowtie=c("\\bowtie ","&#8904;","bowtie"),L.sqsubset=c("\\sqsubset ","&#8847;","square subset"),L.sqsupset=c("\\sqsupset ","&#8848;","square superset"),L.smile=c("\\smile ","&#8995;","smile"),L.sqsubseteq=c("\\sqsubseteq ","&#8849;","square subset or equal to"),L.sqsupseteq=c("\\sqsupseteq ","&#8850;","square superset or equal to"),L.doteq=c("\\doteq ","&#8784;","dotted equals"),L.frown=c("\\frown ","&#8994;","frown"),L.vdash=c("\\vdash ","&#8870;","v dash"),L.dashv=c("\\dashv ","&#8867;","dash v"),L.nless=c("\\nless ","&#8814;","not less than"),L.ngtr=c("\\ngtr ","&#8815;","not greater than"),L.longleftarrow=c("\\longleftarrow ","&#8592;","left arrow"),L.longrightarrow=c("\\longrightarrow ","&#8594;","right arrow"),L.Longleftarrow=c("\\Longleftarrow ","&#8656;","left arrow"),L.Longrightarrow=c("\\Longrightarrow ","&#8658;","right arrow"),L.longleftrightarrow=c("\\longleftrightarrow ","&#8596;","left and right arrow"),L.updownarrow=c("\\updownarrow ","&#8597;","up and down arrow"),L.Longleftrightarrow=c("\\Longleftrightarrow ","&#8660;","left and right arrow"),L.Updownarrow=c("\\Updownarrow ","&#8661;","up and down arrow"),L.mapsto=c("\\mapsto ","&#8614;","maps to"),L.nearrow=c("\\nearrow ","&#8599;","northeast arrow"),L.hookleftarrow=c("\\hookleftarrow ","&#8617;","hook left arrow"),L.hookrightarrow=c("\\hookrightarrow ","&#8618;","hook right arrow"),L.searrow=c("\\searrow ","&#8600;","southeast arrow"),L.leftharpoonup=c("\\leftharpoonup ","&#8636;","left harpoon up"),L.rightharpoonup=c("\\rightharpoonup ","&#8640;","right harpoon up"),L.swarrow=c("\\swarrow ","&#8601;","southwest arrow"),L.leftharpoondown=c("\\leftharpoondown ","&#8637;","left harpoon down"),L.rightharpoondown=c("\\rightharpoondown ","&#8641;","right harpoon down"),L.nwarrow=c("\\nwarrow ","&#8598;","northwest arrow"),L.ldots=c("\\ldots ","&#8230;","l dots"),L.cdots=c("\\cdots ","&#8943;","c dots"),L.vdots=c("\\vdots ","&#8942;","v dots"),L.ddots=c("\\ddots ","&#8945;","d dots"),L.surd=c("\\surd ","&#8730;","unresolved root"),L.triangle=c("\\triangle ","&#9651;","triangle"),L.ell=c("\\ell ","&#8467;","ell"),L.top=c("\\top ","&#8868;","top"),L.flat=c("\\flat ","&#9837;","flat"),L.natural=c("\\natural ","&#9838;","natural"),L.sharp=c("\\sharp ","&#9839;","sharp"),L.wp=c("\\wp ","&#8472;","wp"),L.bot=c("\\bot ","&#8869;","bot"),L.clubsuit=c("\\clubsuit ","&#9827;","club suit"),L.diamondsuit=c("\\diamondsuit ","&#9826;","diamond suit"),L.heartsuit=c("\\heartsuit ","&#9825;","heart suit"),L.spadesuit=c("\\spadesuit ","&#9824;","spade suit"),L.parallelogram=c("\\parallelogram ","&#9649;","parallelogram"),L.square=c("\\square ","&#11036;","square"),L.oint=c("\\oint ","&#8750;","o int"),L.bigcap=c("\\bigcap ","&#8745;","big cap"),L.bigcup=c("\\bigcup ","&#8746;","big cup"),L.bigsqcup=c("\\bigsqcup ","&#8852;","big square cup"),L.bigvee=c("\\bigvee ","&#8744;","big vee"),L.bigwedge=c("\\bigwedge ","&#8743;","big wedge"),L.bigodot=c("\\bigodot ","&#8857;","big o dot"),L.bigotimes=c("\\bigotimes ","&#8855;","big o times"),L.bigoplus=c("\\bigoplus ","&#8853;","big o plus"),L.biguplus=c("\\biguplus ","&#8846;","big u plus"),L.lfloor=c("\\lfloor ","&#8970;","left floor"),L.rfloor=c("\\rfloor ","&#8971;","right floor"),L.lceil=c("\\lceil ","&#8968;","left ceiling"),L.rceil=c("\\rceil ","&#8969;","right ceiling"),L.opencurlybrace=L.lbrace=c("\\lbrace ","{","left brace"),L.closecurlybrace=L.rbrace=c("\\rbrace ","}","right brace"),L.lbrack=c("[","left bracket"),L.rbrack=c("]","right bracket"),L.slash=c("/","slash"),L.vert=c("|","vertical bar"),L.perp=L.perpendicular=c("\\perp ","&perp;","perpendicular"),L.nabla=L.del=c("\\nabla ","&nabla;"),L.hbar=c("\\hbar ","&#8463;","horizontal bar"),L.AA=L.Angstrom=L.angstrom=c("\\text\\AA ","&#8491;","AA"),L.ring=L.circ=L.circle=c("\\circ ","&#8728;","circle"),L.bull=L.bullet=c("\\bullet ","&bull;","bullet"),L.setminus=L.smallsetminus=c("\\setminus ","&#8726;","set minus"),L.not=L["¬"]=L.neg=c("\\neg ","&not;","not"),L["…"]=L.dots=L.ellip=L.hellip=L.ellipsis=L.hellipsis=c("\\dots ","&hellip;","ellipsis"),L.converges=L.darr=L.dnarr=L.dnarrow=L.downarrow=c("\\downarrow ","&darr;","converges with"),L.dArr=L.dnArr=L.dnArrow=L.Downarrow=c("\\Downarrow ","&dArr;","down arrow"),L.diverges=L.uarr=L.uparrow=c("\\uparrow ","&uarr;","diverges from"),L.uArr=L.Uparrow=c("\\Uparrow ","&uArr;","up arrow"),L.rarr=L.rightarrow=c("\\rightarrow ","&rarr;","right arrow"),L.implies=h("\\Rightarrow ","&rArr;","implies"),L.rArr=L.Rightarrow=c("\\Rightarrow ","&rArr;","right arrow"),L.gets=h("\\gets ","&larr;","gets"),L.larr=L.leftarrow=c("\\leftarrow ","&larr;","left arrow"),L.impliedby=h("\\Leftarrow ","&lArr;","implied by"),L.lArr=L.Leftarrow=c("\\Leftarrow ","&lArr;","left arrow"),L.harr=L.lrarr=L.leftrightarrow=c("\\leftrightarrow ","&harr;","left and right arrow"),L.iff=h("\\Leftrightarrow ","&hArr;","if and only if"),L.hArr=L.lrArr=L.Leftrightarrow=c("\\Leftrightarrow ","&hArr;","left and right arrow"),L.Re=L.Real=L.real=c("\\Re ","&real;","real"),L.Im=L.imag=L.image=L.imagin=L.imaginary=L.Imaginary=c("\\Im ","&image;","imaginary"),L.part=L.partial=c("\\partial ","&part;","partial"),L.pounds=c("\\pounds ","&pound;"),L.alef=L.alefsym=L.aleph=L.alephsym=c("\\aleph ","&alefsym;","alef sym"),L.xist=L.xists=L.exist=L.exists=c("\\exists ","&exist;","there exists at least 1"),L.nexists=L.nexist=c("\\nexists ","&#8708;","there is no"),L.and=L.land=L.wedge=h("\\wedge ","&and;","and"),L.or=L.lor=L.vee=h("\\vee ","&or;","or"),L.o=L.O=L.empty=L.emptyset=L.oslash=L.Oslash=L.nothing=L.varnothing=h("\\varnothing ","&empty;","nothing"),L.cup=L.union=h("\\cup ","&cup;","union"),L.cap=L.intersect=L.intersection=h("\\cap ","&cap;","intersection"),L.deg=L.degree=c("\\degree ","&deg;","degrees"),L.ang=L.angle=c("\\angle ","&ang;","angle"),L.measuredangle=c("\\measuredangle ","&#8737;","measured angle"),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.finalizeTree=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.sharedSiblingMethod=function(t,n){n!==se&&this[ae]instanceof e||this.fixDigitGrouping(t)},e.prototype.fixDigitGrouping=function(t){var e,n,r,i,o,s,a,l;if(t.enableDigitGrouping){e=this,n=this,r=0,i=[],o="\\ ",s=".",a=e;do{if(/^[0-9]$/.test(a.ctrlSeq))e=a;else if(a.ctrlSeq===o)e=a,r+=1;else{if(a.ctrlSeq!==s)break;e=a,i.push(a)}}while(a=e[se]);for(;a=n[ae];)if(/^[0-9]$/.test(a.ctrlSeq))n=a;else if(a.ctrlSeq===o)n=a,r+=1;else{if(a.ctrlSeq!==s)break;n=a,i.push(a)}for(;n!==e&&e&&e.ctrlSeq===o;)e=e[ae],r-=1;for(;n!==e&&n&&n.ctrlSeq===o;)n=n[se],r-=1;e===n&&e&&e.ctrlSeq===o||(l=r>0||i.length>1,l?this.removeGroupingBetween(e,n):i[0]?(i[0]!==e&&this.addGroupingBetween(i[0][se],e),i[0]!==n&&this.removeGroupingBetween(i[0][ae],n)):this.addGroupingBetween(n,e))}},e.prototype.removeGroupingBetween=function(t,n){var r=t;do{if(r instanceof e&&r.setGroupingClass(void 0),!r||r===n)break}while(r=r[ae])},e.prototype.addGroupingBetween=function(t,n){var r,i,o=t,s=0,a=0;for(o=t;o&&(a+=1,o!==n);)o=o[se];for(r=a%3,0===r&&(r=3),o=t;o&&(s+=1,i=void 0,a>=4&&(s===a?i="mq-group-leading-"+r:s%3==0&&s!==a&&(i="mq-group-start"),i||(i="mq-group-other")),o instanceof e&&o.setGroupingClass(i),o!==n);)o=o[se]},e.prototype.setGroupingClass=function(t){this._groupingClass!==t&&(this._groupingClass&&this.jQ.removeClass(this._groupingClass),t&&this.jQ.addClass(t),this._groupingClass=t)},e}(ot),mt=function(t){function e(e,n,r){return t.call(this,e,'<span class="mq-digit">'+(n||e)+"</span>",void 0,r)||this}return __extends(e,t),e.prototype.createLeftOf=function(e){var n=e[se],r=n&&n[se],i=e.parent.parent instanceof zt?e.parent.parent.sub:void 0;e.options.autoSubscriptNumerals&&e.parent!==i&&(n instanceof gt&&!1!==n.isItalic||n instanceof zt&&r instanceof gt&&!1!==r.isItalic)?((new Ft).createLeftOf(e),t.prototype.createLeftOf.call(this,e),e.insRightOf(e.parent.parent)):t.prototype.createLeftOf.call(this,e)},e.prototype.mathspeak=function(e){var n,r,i,o;return e&&e.createdLeftOf&&(n=e.createdLeftOf,r=n[se],i=r&&r[se],o=n.parent.parent instanceof zt?n.parent.parent.sub:void 0,n.options.autoSubscriptNumerals&&n.parent!==o&&(r instanceof gt&&!1!==r.isItalic||n[se]instanceof zt&&i instanceof gt&&!1!==i.isItalic))?"Subscript "+t.prototype.mathspeak.call(this)+" Baseline":t.prototype.mathspeak.call(this)},e}(dt),gt=function(t){function e(e,n){return t.call(this,e,"<var>"+(n||e)+"</var>")||this}return __extends(e,t),e.prototype.text=function(){var t=this.ctrlSeq||"";return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[se]||this[se]instanceof e||this[se]instanceof at||"\\ "===this[se].ctrlSeq||(t="*"+t),!this[ae]||this[ae]instanceof at||this[ae]instanceof zt||(t+="*")),t},e.prototype.mathspeak=function(){var e=this.ctrlSeq||"";return this.isPartOfOperator||e.length>1||this.parent&&this.parent.parent&&this.parent.parent.isTextBlock()?t.prototype.mathspeak.call(this):'"'+e+'"'},e}(ot),M.prototype.autoCommands={_maxLength:0},I.autoCommands=function(t){var e,n,r,i,o;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},r=0,i=0;i<e.length;i+=1){if(o=e[i],o.length<2)throw'autocommand "'+o+'" not minimum length of 2';if(L[o]===xt)throw'"'+o+'" is a built-in operator name';n[o]=1,r=ue(r,o.length)}return n._maxLength=r,n},M.prototype.quietEmptyDelimiters={},I.quietEmptyDelimiters=function(t){var e,n,r=t.split(" "),i={};for(e=0;e<r.length;e+=1)n=r[e],i[n]=1;return i},M.prototype.autoParenthesizedFunctions={_maxLength:0},I.autoParenthesizedFunctions=function(t){var e,n,r,i,o;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},r=0,i=0;i<e.length;i+=1){if(o=e[i],o.length<2)throw'autocommand "'+o+'" not minimum length of 2';n[o]=1,r=ue(r,o.length)}return n._maxLength=r,n},yt=function(t){function e(e){var n=t.call(this,e)||this;return n.letter=e,n}return __extends(e,t),e.prototype.checkAutoCmds=function(t){var n,r,i,o,a,l,p;if(!this.shouldIgnoreSubstitutionInSimpleSubscript(t.options)&&(n=t.options.autoCommands,(r=n._maxLength||0)>0)){for(i="",o=this,a=0;o instanceof e&&o.ctrlSeq===o.letter&&a<r;)i=o.letter+i,o=o[se],a+=1;for(;i.length;){if(n.hasOwnProperty(i)){for(o=this,a=1;o&&a<i.length;a+=1,o=o[se]);return new O(o,this).remove(),t[se]=o[se],l=L[i],p=s(l)?new l(i):l(i),p.createLeftOf(t)}i=i.slice(1)}}},e.prototype.autoParenthesize=function(t){var n,r,i,o,s,a,l=t.parent.ends[ae];if(!(l&&l instanceof Zt&&"\\left("===l.ctrlSeq||this.shouldIgnoreSubstitutionInSimpleSubscript(t.options))){for(n="",r=this,i=0,o=t.options.autoParenthesizedFunctions,s=o._maxLength||0,a=t.options.autoOperatorNames;r instanceof e&&i<s;)n=r.letter+n,r=r[se],i+=1;for(;n.length;){if(o.hasOwnProperty(n)&&a.hasOwnProperty(n))return t.parent.write(t,"(");n=n.slice(1)}}},e.prototype.createLeftOf=function(e){t.prototype.createLeftOf.call(this,e),this.checkAutoCmds(e),this.autoParenthesize(e)},e.prototype.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},e.prototype.finalizeTree=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.sharedSiblingMethod=function(t,n){n!==se&&this[ae]instanceof e||this.autoUnItalicize(t)},e.prototype.autoUnItalicize=function(t){var n,r,i,o,s,a,l,p,u,c,h,f,d,m,g,y,w,b,v=t.autoOperatorNames;if(0!==v._maxLength&&!this.shouldIgnoreSubstitutionInSimpleSubscript(t)){for(n=this.letter,r=this[se];r instanceof e;r=r[se])n=r.letter+n;for(i=this[ae];i instanceof e;i=i[ae])n+=i.letter;o=r&&r[ae],s=i&&i[se],new O(o||this.parent.ends[se],s||this.parent.ends[ae]).each(function(t){t instanceof e&&(t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter)}),a=v._maxLength||0;t:for(l=0,p=r[ae]||this.parent.ends[se];p&&l<n.length;l+=1,p=p[ae])for(u=pe(a,n.length-l);u>0;u-=1)if(c=n.slice(l,l+u),h=void 0,v.hasOwnProperty(c)){for(f=0,d=p;f<u;f+=1,d=d[ae])d instanceof e&&(d.italicize(!1),h=d);m=wt.hasOwnProperty(c),p.ctrlSeq=(m?"\\":"\\operatorname{")+p.ctrlSeq,h.ctrlSeq+=m?" ":"}",vt.hasOwnProperty(c)&&(g=h[se],y=g&&g[se],w=y&&y[se],w.jQ.addClass("mq-last")),this.shouldOmitPadding(p[se])||p.jQ.addClass("mq-first"),this.shouldOmitPadding(h[ae])||(h[ae]instanceof zt?(b=h[ae],(b.siblingCreated=b.siblingDeleted=function(){b.jQ.toggleClass("mq-after-operator-name",!(b[ae]instanceof Zt))})()):h.jQ.toggleClass("mq-last",!(h[ae]instanceof Zt))),l+=u-1,p=h;continue t}}},e.prototype.shouldOmitPadding=function(t){return!t||("."===t.ctrlSeq||(t instanceof at||t instanceof Nt))},e}(gt),wt={},bt=M.prototype.autoOperatorNames={_maxLength:9},vt={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,r,i="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<i.length;t+=1)wt[i[t]]=bt[i[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)wt[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)bt[n[t]]=bt["arc"+n[t]]=bt[n[t]+"h"]=bt["ar"+n[t]+"h"]=bt["arc"+n[t]+"h"]=1;for(r="gcf hcf lcm proj span".split(" "),t=0;t<r.length;t+=1)bt[r[t]]=1}(),I.autoOperatorNames=function(t){var e,n,r,i,o,s;if("string"!=typeof t)throw'"'+t+'" not a space-delimited list';if(!/^[a-z\|\-]+(?: [a-z\|\-]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of letters or "|"';for(e=t.split(" "),n={},r=0,i=0;i<e.length;i+=1){if(o=e[i],o.length<2)throw'"'+o+'" not minimum length of 2';if(o.indexOf("|")<0)n[o]=o,r=ue(r,o.length);else{if(s=o.split("|"),s.length>2)throw'"'+o+'" has more than 1 mathspeak delimiter';if(s[0].length<2)throw'"'+o[0]+'" not minimum length of 2';n[s[0]]=s[1].replace(/-/g," "),r=ue(r,s[0].length)}}return n._maxLength=r,n},xt=function(t){function e(e){return t.call(this,e||"")||this}return __extends(e,t),e.prototype.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)new yt(n.charAt(e)).createLeftOf(t)},e.prototype.parser=function(){var t,e=this.ctrlSeq,n=new lt;for(t=0;t<e.length;t+=1)new yt(e.charAt(t)).adopt(n,n.ends[ae],0);return $.succeed(n.children())},e}(ot);for(qt in bt)bt.hasOwnProperty(qt)&&(L[qt]=xt);L.operatorname=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(){},e.prototype.numBlocks=function(){return 1},e.prototype.parser=function(){return Z.block.map(function(t){var e=!0,n="",r=t.children();return r.each(function(t){t instanceof yt?n+=t.letter:e=!1}),e&&"ans"===n?Gt():r})},e}(it),L.f=function(t){function e(){var e=this,n="f";return e=t.call(this,n)||this,e.letter=n,e.htmlTemplate='<var class="mq-f">f</var>',e}return __extends(e,t),e.prototype.italicize=function(e){return this.jQ.html("f").toggleClass("mq-f",e),t.prototype.italicize.call(this,e)},e}(yt),L[" "]=L.space=function(){return new dt("\\ ","<span>&nbsp;</span>"," ")},L["."]=function(){return new dt(".",'<span class="mq-digit">.</span>',".")},L["'"]=L.prime=c("'","&prime;","prime"),L["″"]=L.dprime=c("″","&Prime;","double prime"),L.backslash=c("\\backslash ","\\","backslash"),T["\\"]||(T["\\"]=L.backslash),L.$=c("\\$","$","dollar"),L.square=c("\\square ","□","square"),L.mid=c("\\mid ","∣","mid"),kt=function(t){function e(e,n,r){return t.call(this,e,'<span class="mq-nonSymbola">'+(n||e)+"</span>")||this}return __extends(e,t),e}(ot),L["@"]=function(){return new kt("@")},L["&"]=function(){return new kt("\\&","&amp;","and")},L["%"]=function(t){function e(){return t.call(this,"\\%","%","percent")||this}return __extends(e,t),e.prototype.parser=function(){var e=$.optWhitespace,n=$.string;return e.then(n("\\operatorname{of}").map(function(){return Ht()})).or(t.prototype.parser.call(this))},e}(kt),L["∥"]=L.parallel=c("\\parallel ","&#x2225;","parallel"),L["∦"]=L.nparallel=c("\\nparallel ","&#x2226;","not parallel"),L["⟂"]=L.perp=c("\\perp ","&#x27C2;","perpendicular"),L.alpha=L.beta=L.gamma=L.delta=L.zeta=L.eta=L.theta=L.iota=L.kappa=L.mu=L.nu=L.xi=L.rho=L.sigma=L.tau=L.chi=L.psi=L.omega=function(t){return new gt("\\"+t+" ","&"+t+";")},L.phi=m("\\phi ","&#981;","phi"),L.phiv=L.varphi=m("\\varphi ","&phi;","phi"),L.epsilon=m("\\epsilon ","&#1013;","epsilon"),L.epsiv=L.varepsilon=m("\\varepsilon ","&epsilon;","epsilon"),L.piv=L.varpi=m("\\varpi ","&piv;","piv"),L.sigmaf=L.sigmav=L.varsigma=m("\\varsigma ","&sigmaf;","sigma"),L.thetav=L.vartheta=L.thetasym=m("\\vartheta ","&thetasym;","theta"),L.upsilon=L.upsi=m("\\upsilon ","&upsilon;","upsilon"),L.gammad=L.Gammad=L.digamma=m("\\digamma ","&#989;","gamma"),L.kappav=L.varkappa=m("\\varkappa ","&#1008;","kappa"),L.rhov=L.varrho=m("\\varrho ","&#1009;","rho"),L.pi=L["π"]=function(){return new kt("\\pi ","&pi;","pi")},L.lambda=function(){return new kt("\\lambda ","&lambda;","lambda")},L.Upsilon=L.Upsi=L.upsih=L.Upsih=function(){return new ot("\\Upsilon ",'<var style="font-family: serif">&upsih;</var>',"capital upsilon")},L.Gamma=L.Delta=L.Theta=L.Lambda=L.Xi=L.Pi=L.Sigma=L.Phi=L.Psi=L.Omega=L.forall=function(t){return new st("\\"+t+" ","&"+t+";")},_t=function(t){function e(e){var n=t.call(this)||this;return n.latexStr=e,n}return __extends(e,t),e.prototype.createLeftOf=function(t){var e,n,r,i,o=Z.parse(this.latexStr);o.children().adopt(t.parent,t[se],t[ae]),t[se]=o.ends[ae],o.jQize().insertBefore(t.jQ),o.finalizeInsert(t.options,t),e=o.ends[ae],n=e&&e[ae],n&&n.siblingCreated(t.options,se),r=o.ends[se],i=r&&r[se],i&&i.siblingCreated(t.options,ae),t.parent.bubble(function(t){t.reflow()})},e.prototype.mathspeak=function(){return Z.parse(this.latexStr).mathspeak()},e.prototype.parser=function(){var t=Z.parse(this.latexStr).children();return $.succeed(t)},e}(it),L["⁰"]=function(){return new _t("^0")},L["¹"]=function(){return new _t("^1")},L["²"]=function(){return new _t("^2")},L["³"]=function(){return new _t("^3")},L["⁴"]=function(){return new _t("^4")},L["⁵"]=function(){return new _t("^5")},L["⁶"]=function(){return new _t("^6")},L["⁷"]=function(){return new _t("^7")},L["⁸"]=function(){return new _t("^8")},L["⁹"]=function(){return new _t("^9")},L["¼"]=function(){return new _t("\\frac14")},L["½"]=function(){return new _t("\\frac12")},L["¾"]=function(){return new _t("\\frac34")},L["√"]=function(){return new _t("\\sqrt{}")},St=function(t){function e(e,n,r){return t.call(this,e,n,void 0,r,!0)||this}return __extends(e,t),e.prototype.contactWeld=function(t,e){this.sharedSiblingMethod(t.options,e)},e.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},e.prototype.sharedSiblingMethod=function(t,e){if(e!==ae)return this.jQ[0].className=g(this)?"mq-binary-operator":"",this},e}(at),L["+"]=function(t){function e(){return t.call(this,"+","+")||this}return __extends(e,t),e.prototype.mathspeak=function(){return g(this)?"plus":"positive"},e}(St),Ot=function(t){function e(){return t.call(this,"-","&minus;")||this}return __extends(e,t),e.prototype.mathspeak=function(){return g(this)?"minus":"negative"},e}(St),L["−"]=L["—"]=L["–"]=L["-"]=Ot,L["±"]=L.pm=L.plusmn=L.plusminus=function(){return new St("\\pm ","&plusmn;","plus-or-minus")},L.mp=L.mnplus=L.minusplus=function(){return new St("\\mp ","&#8723;","minus-or-plus")},T["*"]=L.sdot=L.cdot=h("\\cdot ","&middot;","*","times"),Lt=function(t){function e(){return t.call(this,"\\to ","&rarr;","to")||this}return __extends(e,t),e.prototype.deleteTowards=function(e,n){if(e===se){var r=n[se];return new O(r,this).remove(),n[se]=r[se],(new Ot).createLeftOf(n),void n[se].bubble(function(t){t.reflow()})}t.prototype.deleteTowards.call(this,e,n)},e}(at),L["→"]=L.to=Lt,Tt=function(t){function e(e,n){var r=this,i=n?"Strict":"";return r=t.call(this,e["ctrlSeq".concat(i)],e["html".concat(i)],e["text".concat(i)],e["mathspeak".concat(i)])||this,r.data=e,r.strict=n,r}return __extends(e,t),e.prototype.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq".concat(e)],this.jQ.html(this.data["html".concat(e)]),this.textTemplate=[this.data["text".concat(e)]],this.mathspeakName=this.data["mathspeak".concat(e)]},e.prototype.deleteTowards=function(e,n){if(e===se&&!this.strict)return this.swap(!0),void this.bubble(function(t){t.reflow()});t.prototype.deleteTowards.call(this,e,n)},e}(at),Ct={ctrlSeq:"\\le ",html:"&le;",text:"≤",mathspeak:"less than or equal to",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<",mathspeakStrict:"less than"},At={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",mathspeak:"greater than or equal to",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">",mathspeakStrict:"greater than"},jt=function(t){function e(){return t.call(this,At,!0)||this}return __extends(e,t),e.prototype.createLeftOf=function(e){var n,r=e[se];if(r instanceof at&&"-"===r.ctrlSeq)return n=r,e[se]=n[se],n.remove(),(new Lt).createLeftOf(e),void e[se].bubble(function(t){t.reflow()});t.prototype.createLeftOf.call(this,e)},e}(Tt),L["<"]=L.lt=function(){return new Tt(Ct,!0)},L[">"]=L.gt=jt,L["≤"]=L.le=L.leq=function(){return new Tt(Ct,!1)},L["≥"]=L.ge=L.geq=function(){return new Tt(At,!1)},L.infty=L.infin=L.infinity=c("\\infty ","&infin;","infinity"),L["≠"]=L.ne=L.neq=h("\\ne ","&ne;","not equal"),Dt=function(t){function e(){return t.call(this,"=","=","=","equals")||this}return __extends(e,t),e.prototype.createLeftOf=function(e){var n=e[se];if(n instanceof Tt&&n.strict)return n.swap(!1),void n.bubble(function(t){t.reflow()});t.prototype.createLeftOf.call(this,e)},e}(at),L["="]=Dt,L["×"]=L.times=h("\\times ","&times;","[x]","times"),L["÷"]=L.div=L.divide=L.divides=h("\\div ","&divide;","[/]","over"),Qt=function(t){function e(){return t.call(this,"\\sim ","~","~","tilde")||this}return __extends(e,t),e.prototype.createLeftOf=function(n){if(n[se]instanceof e){var r=n[se];return n[se]=r[se],r.remove(),(new Et).createLeftOf(n),void n[se].bubble(function(t){t.reflow()})}t.prototype.createLeftOf.call(this,n)},e}(at),Et=function(t){function e(){return t.call(this,"\\approx ","&approx;","≈","approximately equal")||this}return __extends(e,t),e.prototype.deleteTowards=function(e,n){if(e===se){var r=n[se];return new O(r,this).remove(),n[se]=r[se],(new Qt).createLeftOf(n),void n[se].bubble(function(t){t.reflow()})}t.prototype.deleteTowards.call(this,e,n)},e}(at),T["~"]=L.sim=Qt,L["≈"]=L.approx=Et,Bt={sqrt:{width:"",html:'<svg preserveAspectRatio="none" viewBox="0 0 32 54"><path d="M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33" /></svg>'},"|":{width:".4em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M4.4 0 L4.4 54 L5.6 54 L5.6 0" /></svg>'},"[":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 11 24"><path d="M8 0 L3 0 L3 24 L8 24 L8 23 L4 23 L4 1 L8 1" /></svg>'},"]":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 11 24"><path d="M3 0 L8 0 L8 24 L3 24 L3 23 L7 23 L7 1 L3 1" /></svg>'},"(":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="3 0 106 186"><path d="M85 0 A61 101 0 0 0 85 186 L75 186 A75 101 0 0 1 75 0" /></svg>'},")":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="3 0 106 186"><path d="M24 0 A61 101 0 0 1 24 186 L34 186 A75 101 0 0 0 34 0" /></svg>'},"{":{width:".7em",html:'<svg preserveAspectRatio="none" viewBox="10 0 210 350"><path d="M170 0 L170 6 A47 52 0 0 0 123 60 L123 127 A35 48 0 0 1 88 175 A35 48 0 0 1 123 223 L123 290 A47 52 0 0 0 170 344 L170 350 L160 350 A58 49 0 0 1 102 301 L103 220 A45 40 0 0 0 58 180 L58 170 A45 40 0 0 0 103 130 L103 49 A58 49 0 0 1 161 0" /></svg>'},"}":{width:".7em",html:'<svg preserveAspectRatio="none" viewBox="10 0 210 350"><path d="M60 0 L60 6 A47 52 0 0 1 107 60 L107 127 A35 48 0 0 0 142 175 A35 48 0 0 0 107 223 L107 290 A47 52 0 0 1 60 344 L60 350 L70 350 A58 49 0 0 0 128 301 L127 220 A45 40 0 0 1 172 180 L172 170 A45 40 0 0 1 127 130 L127 49 A58 49 0 0 0 70 0" /></svg>'},"&#8741;":{width:".7em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M3.2 0 L3.2 54 L4 54 L4 0 M6.8 0 L6.8 54 L6 54 L6 0" /></svg>'},"&lang;":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M6.8 0 L3.2 27 L6.8 54 L7.8 54 L4.2 27 L7.8 0" /></svg>'},"&rang;":{width:".55em",html:'<svg preserveAspectRatio="none" viewBox="0 0 10 54"><path d="M3.2 0 L6.8 27 L3.2 54 L2.2 54 L5.8 27 L2.2 0" /></svg>'}},It=function(t){function e(e,n,r,i,o){var s=t.call(this,e,"<"+n+" "+r+">&0</"+n+">")||this;return s.ariaLabel=i||e.replace(/^\\/,""),
s.mathspeakTemplate=["Start"+s.ariaLabel+",","End"+s.ariaLabel],s.shouldNotSpeakDelimiters=o&&o.shouldNotSpeakDelimiters,s}return __extends(e,t),e.prototype.mathspeak=function(e){return!this.shouldNotSpeakDelimiters||e&&e.ignoreShorthand?t.prototype.mathspeak.call(this):this.foldChildren("",function(t,n){return t+" "+n.mathspeak(e)}).trim()},e}(it),L.mathrm=function(t){function e(){return t.call(this,"\\mathrm","span",'class="mq-roman mq-font"',"Roman Font",{shouldNotSpeakDelimiters:!0})||this}return __extends(e,t),e.prototype.isTextBlock=function(){return!0},e}(It),L.mathit=function(){return new It("\\mathit","i",'class="mq-font"',"Italic Font")},L.mathbf=function(){return new It("\\mathbf","b",'class="mq-font"',"Bold Font")},L.mathsf=function(){return new It("\\mathsf","span",'class="mq-sans-serif mq-font"',"Serif Font")},L.mathtt=function(){return new It("\\mathtt","span",'class="mq-monospace mq-font"',"Math Text")},L.underline=function(){return new It("\\underline","span",'class="mq-non-leaf mq-underline"',"Underline")},L.overline=L.bar=function(){return new It("\\overline","span",'class="mq-non-leaf mq-overline"',"Overline")},L.overrightarrow=function(){return new It("\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"',"Over Right Arrow")},L.overleftarrow=function(){return new It("\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"',"Over Left Arrow")},L.overleftrightarrow=function(){return new It("\\overleftrightarrow ","span",'class="mq-non-leaf mq-overarrow mq-arrow-leftright"',"Over Left and Right Arrow")},L.overarc=function(){return new It("\\overarc","span",'class="mq-non-leaf mq-overarc"',"Over Arc")},L.dot=function(){return new it("\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')},L.wideparen=function(){return new It("\\wideparen","span",'class="mq-non-leaf mq-wideparen"',"Wideparen")},Mt=function(t){function e(){var e=t.call(this)||this;return e.ctrlSeq="\\stackrel",e.htmlTemplate='<span class="mq-stackrel mq-non-leaf"><span class="mq-top">&0</span><span class="mq-bottom">&1</span></span>',e.textTemplate=["stackrel(",",",")"],e}return __extends(e,t),e.prototype.numBlocks=function(){return 2},e.prototype.parser=function(){var t=this,e=Z.block,n=$.optWhitespace;return n.then(e).then(function(r){return t.blocks=[r],r.adopt(t,0,0),n.then(e).map(function(e){return e.adopt(t,r,0),t.blocks.push(e),t})})},e.prototype.createBlocks=function(){this.blocks=[new lt,new lt],this.blocks[0].adopt(this,0,0),this.blocks[1].adopt(this,this.blocks[0],0)},e.prototype.latex=function(){return"\\stackrel{"+this.blocks[0].latex()+"}{"+this.blocks[1].latex()+"}"},e}(it),L.stackrel=function(){return new Mt},L.textcolor=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>',this.ariaLabel=t.replace(/^\\/,""),this.mathspeakTemplate=["Start "+this.ariaLabel+",","End "+this.ariaLabel]},e.prototype.latex=function(){var t=this.blocks[0];return"\\textcolor{"+this.color+"}{"+t.latex()+"}"},e.prototype.parser=function(){var e=this,n=$.optWhitespace,r=$.string,i=$.regex;return n.then(r("{")).then(i(/^[#\w\s.,()%-]*/)).skip(r("}")).then(function(n){return e.setColor(n),t.prototype.parser.call(e)})},e.prototype.isStyleBlock=function(){return!0},e}(it),L.class=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parser=function(){var e=this,n=$.string,r=$.regex;return $.optWhitespace.then(n("{")).then(r(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return e.cls=n||"",e.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.ariaLabel=n+" class",e.mathspeakTemplate=["Start "+e.ariaLabel+",","End "+e.ariaLabel],t.prototype.parser.call(e)})},e.prototype.latex=function(){var t=this.blocks[0];return"\\class{"+this.cls+"}{"+t.latex()+"}"},e.prototype.isStyleBlock=function(){return!0},e}(it),Rt=/^[\+\-]?[\d]+$/,M.prototype.charsThatBreakOutOfSupSub="",zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="_{...}^{...}",e}return __extends(e,t),e.prototype.createLeftOf=function(e){if(this.replacedFragment||e[se]||!e.options.supSubsRequireOperand)return t.prototype.createLeftOf.call(this,e)},e.prototype.contactWeld=function(t){var n,r,i,o,s,a,l;for(n=se;n;n=n===se&&ae)if(r=this[n],i=void 0,r instanceof e){for(o="sub";o;o="sub"===o&&"sup")s=this[o],a=r[o],s&&(a?s.isEmpty()?i=new k(a,0,a.ends[se]):(s.jQ.children().insAtDirEnd(-n,a.jQ),l=s.children().disown(),i=new k(a,l.ends[ae],a.ends[se]),n===se?l.adopt(a,a.ends[ae],0):l.adopt(a,0,a.ends[se])):r.addBlock(s.disown()),this.placeCursor=function(t,e){return function(r){r.insAtDirEnd(-n,t||e)}}(a,s));this.remove(),t&&t[se]===this&&(n===ae&&i?i[se]?t.insRightOf(i[se]):t.insAtLeftEnd(i.parent):t.insRightOf(r));break}},e.prototype.finalizeTree=function(){this.ends[se].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e,t.options);return n instanceof ot?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show()),void t.controller.aria.queue("Baseline").alert(n.mathspeak({createdLeftOf:t}))}t[se]&&!t[ae]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&(t.insRightOf(this.parent),t.controller.aria.queue("Baseline")),lt.prototype.write.call(this,t,e)}},e.prototype.moveTowards=function(e,n,r){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(e,this):t.prototype.moveTowards.call(this,e,n,r)},e.prototype.deleteTowards=function(e,n){if(n.options.autoSubscriptNumerals&&this.sub){var r=this.sub.ends[-e];r instanceof ot?r.remove():r&&r.deleteTowards(e,n.insAtDirEnd(-e,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(se,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-e,this))}else t.prototype.deleteTowards.call(this,e,n)},e.prototype.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+"{"+(n||" ")+"}":""}return t("_",this.sub)+t("^",this.sup)},e.prototype.text=function(){function t(t,e){var n=e&&e.text()||"";return e?t+(1===n.length?n:"("+(n||" ")+")"):""}return t("_",this.sub)+t("^",this.sup)},e.prototype.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=q('<span class="mq-sup"/>').append(t.jQ.children()).prependTo(this.jQ),S.linkElementByBlockNode(t.jQ[0],t)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=q('<span class="mq-sub"></span>').append(t.jQ.children()).appendTo(this.jQ.removeClass("mq-sup-only")),S.linkElementByBlockNode(t.jQ[0],t),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(t,e,n,r){t[e].deleteOutOf=function(i,o){var s,a;o.insDirOf(this[i]?-i:i,this.parent),this.isEmpty()||(s=this.ends[i],this.children().disown().withDirAdopt(i,o.parent,o[i],o[-i]).jQ.insDirOf(-i,o.jQ),o[-i]=s),t.supsub=n,delete t[e],delete t["".concat(r,"Into")],a=t[n],a["".concat(r,"OutOf")]=w,delete a.deleteOutOf,"sub"===e&&q(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])},e}(it),Ft=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.supsub="sub",e.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["_"],e.mathspeakTemplate=["Subscript,",", Baseline"],e.ariaLabel="subscript",e}return __extends(e,t),e.prototype.finalizeTree=function(){this.downInto=this.sub=this.ends[se],this.sub.upOutOf=w,t.prototype.finalizeTree.call(this)},e}(zt),L.subscript=L._=Ft,L.superscript=L.supscript=L["^"]=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.supsub="sup",e.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',e.textTemplate=["^(",")"],e.ariaLabel="superscript",e.mathspeakTemplate=["Superscript,",", Baseline"],e}return __extends(e,t),e.prototype.mathspeak=function(e){var n,r,i=this.upInto;return void 0===i||(n=y(i),e&&e.ignoreShorthand||!Rt.test(n))?t.prototype.mathspeak.call(this):"0"===n?"to the 0 power":"2"===n?"squared":"3"===n?"cubed":(r="",/^[+-]?\d{1,3}$/.test(n)&&(/(11|12|13|4|5|6|7|8|9|0)$/.test(n)?r="th":/1$/.test(n)?r="st":/2$/.test(n)?r="nd":/3$/.test(n)&&(r="rd")),"to the "+("object"==typeof i?i.mathspeak():n)+r+" power")},e.prototype.finalizeTree=function(){this.upInto=this.sup=this.ends[ae],this.sup.downOutOf=w,t.prototype.finalizeTree.call(this)},e}(zt),Nt=function(t){function e(e,n,r){var i,o=t.call(this)||this;return o.ariaLabel=r||e.replace(/^\\/,""),i='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+n+'</big><span class="mq-from"><span>&0</span></span></span>',ot.prototype.setCtrlSeqHtmlTextAndMathspeak.call(o,e,i),o}return __extends(e,t),e.prototype.createLeftOf=function(e){t.prototype.createLeftOf.call(this,e),e.options.sumStartsWithNEquals&&(new yt("n").createLeftOf(e),(new Dt).createLeftOf(e))},e.prototype.latex=function(){function t(t){return"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[se].latex())+"^"+t(this.ends[ae].latex())},e.prototype.mathspeak=function(){return"Start "+this.ariaLabel+" from "+this.ends[se].mathspeak()+" to "+this.ends[ae].mathspeak()+", end "+this.ariaLabel+", "},e.prototype.parser=function(){var t,e=$.string,n=$.optWhitespace,r=$.succeed,i=Z.block,o=this,s=o.blocks=[new lt,new lt];for(t=0;t<s.length;t+=1)s[t].adopt(o,o.ends[ae],0);return n.then(e("_").or(e("^"))).then(function(t){var e=s["_"===t?0:1];return i.then(function(t){return t.children().adopt(e,e.ends[ae],0),r(o)})}).many().result(o)},e.prototype.finalizeTree=function(){var t=this.ends[se],e=this.ends[ae];t.ariaLabel="lower bound",e.ariaLabel="upper bound",this.downInto=t,this.upInto=e,t.upOutOf=e,e.downOutOf=t},e}(it),L["∑"]=L.sum=L.summation=function(){return new Nt("\\sum ","&sum;","sum")},L["∏"]=L.prod=L.product=function(){return new Nt("\\prod ","&prod;","product")},L.coprod=L.coproduct=function(){return new Nt("\\coprod ","&#8720;","co product")},L["∫"]=L.int=L.integral=function(t){function e(){var e=this;return e=t.call(this,"\\int ","","integral")||this,e.ariaLabel="integral",e.htmlTemplate='<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>',e}return __extends(e,t),e.prototype.createLeftOf=function(t){it.prototype.createLeftOf.call(this,t)},e}(Nt),Pt=L.frac=L.dfrac=L.cfrac=L.fraction=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\frac",e.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',e.textTemplate=["(",")/(",")"],e}return __extends(e,t),e.prototype.finalizeTree=function(){var t=this.ends[se],e=this.ends[ae];this.upInto=e.upOutOf=t,this.downInto=t.downOutOf=e,t.ariaLabel="numerator",e.ariaLabel="denominator",this.getFracDepth()>1?this.mathspeakTemplate=["StartNestedFraction,","NestedOver",", EndNestedFraction"]:this.mathspeakTemplate=["StartFraction,","Over",", EndFraction"]},e.prototype.mathspeak=function(e){var n,r,i,o,s,a,l,p;if(e&&e.createdLeftOf)return n=e.createdLeftOf,n.parent.mathspeak();if(r=y(this.ends[se]),i=y(this.ends[ae]),(!e||!e.ignoreShorthand)&&Rt.test(r)&&Rt.test(i)&&(o="1"===r||"-1"===r,s="","2"===i?s=o?"half":"halves":"3"===i?s=o?"third":"thirds":"4"===i?s=o?"quarter":"quarters":"5"===i?s=o?"fifth":"fifths":"6"===i?s=o?"sixth":"sixths":"7"===i?s=o?"seventh":"sevenths":"8"===i?s=o?"eighth":"eighths":"9"===i&&(s=o?"ninth":"ninths"),""!==s)){for(a="",l=!1,p=this[se];p&&void 0!==p[se];p=p[se])if("\\ "!==p.ctrlSeq){if(!Rt.test(p.ctrlSeq||"")){l=!1;break}l=!0}return l&&(a+="and "),a+=this.ends[se].mathspeak()+" "+s}return t.prototype.mathspeak.call(this)},e.prototype.getFracDepth=function(){var t=function(e,n){return e instanceof V&&e.ctrlSeq&&e.ctrlSeq.toLowerCase().search("frac")>=0&&(n+=1),e&&e.parent?t(e.parent,n):n};return t(this,0)},e}(it),$t=L.over=T["/"]=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.createLeftOf=function(n){var r,i,o;if(!this.replacedFragment){if(r=n[se],!n.options.typingSlashCreatesNewFraction)for(;r&&!(r instanceof at||r instanceof(L.text||t)||r instanceof Nt||"\\ "===r.ctrlSeq||/^[,;:]$/.test(r.ctrlSeq));)r=r[se];r instanceof Nt&&r[ae]instanceof zt&&(r=r[ae],(i=r[ae])instanceof zt&&i.ctrlSeq!=r.ctrlSeq&&(r=r[ae])),r===n[se]||n.isTooDeep(1)||(i=r[ae],o=n[se],this.replaces(new O(i||n.parent.ends[se],o)),n[se]=r)}e.prototype.createLeftOf.call(this,n)},n}(Pt),Gt=function(){return new ot("\\operatorname{ans}",'<span class="mq-ans">ans</span>',"ans")},L.ans=Gt,Ht=function(){return new ot("\\%\\operatorname{of}",'<span class="mq-nonSymbola mq-operator-name">% of </span>',"percent of")},L.percent=L.percentof=Ht,Ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\sqrt",e.htmlTemplate='<span class="mq-non-leaf mq-sqrt-container"><span class="mq-scaled mq-sqrt-prefix">'+Bt.sqrt.html+'</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',e.textTemplate=["sqrt(",")"],e.mathspeakTemplate=["StartRoot,",", EndRoot"],e.ariaLabel="root",e}return __extends(e,t),e.prototype.parser=function(){return Z.optBlock.then(function(t){return Z.block.map(function(e){var n=new Wt;return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(t.prototype.parser.call(this))},e}(it),L.sqrt=Ut,L.hat=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\hat",e.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',e.textTemplate=["hat(",")"],e}return __extends(e,t),e}(it),Wt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.htmlTemplate='<span class="mq-nthroot-container mq-non-leaf"><sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled mq-sqrt-container"><span class="mq-sqrt-prefix mq-scaled">'+Bt.sqrt.html+'</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span></span>',e.textTemplate=["sqrt[","](",")"],e}return __extends(e,t),e.prototype.latex=function(){return"\\sqrt["+this.ends[se].latex()+"]{"+this.ends[ae].latex()+"}"},e.prototype.mathspeak=function(){var t=this.ends[se].mathspeak(),e=this.ends[ae].mathspeak();return this.ends[se].ariaLabel="Index",this.ends[ae].ariaLabel="Radicand","3"===t?"Start Cube Root, "+e+", End Cube Root":"Root Index "+t+", Start Root, "+e+", End Root"},e}(Ut),L.nthroot=Wt,L.cbrt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(e){t.prototype.createLeftOf.call(this,e),new mt("3").createLeftOf(e),e.controller.moveRight()},e}(Wt),Vt=function(t){function e(e,n,r){var i='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+n+'</span><span class="mq-diacritic-stem">&0</span></span>';return t.call(this,e,i,r)||this}return __extends(e,t),e}(it),L.vec=function(){return new Vt("\\vec","&rarr;",["vec(",")"])},L.tilde=function(){return new Vt("\\tilde","~",["tilde(",")"])},Kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.jQadd=function(e){return t.prototype.jQadd.call(this,e),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)"),this.jQ},e}(it),Zt=function(t){function e(e,n,r,i,o){var s,a=t.call(this,"\\left"+i,void 0,[n,r])||this;return a.side=e,a.sides=(s={},s[se]={ch:n,ctrlSeq:i},s[ae]={ch:r,ctrlSeq:o},s),a}return __extends(e,t),e.prototype.numBlocks=function(){return 1},e.prototype.html=function(){var e=this.getSymbol(se),n=this.getSymbol(ae);return this.htmlTemplate='<span class="mq-non-leaf mq-bracket-container"><span style="width:'+e.width+'" class="mq-scaled mq-bracket-l mq-paren'+(this.side===ae?" mq-ghost":"")+'">'+e.html+'</span><span style="margin-left:'+e.width+";margin-right:"+n.width+'" class="mq-bracket-middle mq-non-leaf">&0</span><span style="width:'+n.width+'" class="mq-scaled mq-bracket-r mq-paren'+(this.side===se?" mq-ghost":"")+'">'+n.html+"</span></span>",t.prototype.html.call(this)},e.prototype.getSymbol=function(t){var e=this.sides[t||ae].ch;return Bt[e]||{width:"0",html:""}},e.prototype.latex=function(){return"\\left"+this.sides[se].ctrlSeq+this.ends[se].latex()+"\\right"+this.sides[ae].ctrlSeq},e.prototype.mathspeak=function(e){var n,r=this.sides[se].ch,i=this.sides[ae].ch;if("|"===r&&"|"===i)this.mathspeakTemplate=["StartAbsoluteValue,",", EndAbsoluteValue"],this.ariaLabel="absolute value";else{if(e&&e.createdLeftOf&&this.side)return n="",this.side===se?n=this.textTemplate[0]:this.side===ae&&(n=this.textTemplate[1]),(this.side===se?"left ":"right ")+Xt[n];this.mathspeakTemplate=["left "+Xt[r]+",",", right "+Xt[i]],this.ariaLabel=Xt[r]+" block"}return t.prototype.mathspeak.call(this)},e.prototype.matchBrack=function(t,n,r){return r instanceof e&&r.side&&r.side!==-n&&(!t.restrictMismatchedBrackets||Yt[this.sides[this.side].ch]===r.sides[r.side].ch||{"(":"]","[":")"}[this.sides[se].ch]===r.sides[ae].ch)&&r},e.prototype.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side];var e=t.delimjQs.eq(this.side===se?0:1).removeClass("mq-ghost");this.replaceBracket(e,this.side)},e.prototype.createLeftOf=function(e){var n,r,i;this.replacedFragment||(r=e.options,n="|"===this.sides[se].ch?this.matchBrack(r,ae,e[ae])||this.matchBrack(r,se,e[se])||this.matchBrack(r,0,e.parent.parent):this.matchBrack(r,-this.side,e[-this.side])||this.matchBrack(r,-this.side,e.parent.parent)),n?(i=this.side=-n.side,this.closeOpposing(n),n===e.parent.parent&&e[i]&&new O(e[i],e.parent.ends[i],-i).disown().withDirAdopt(-i,n.parent,n,n[i]).jQ.insDirOf(i,n.jQ),n.bubble(function(t){t.reflow()})):(n=this,i=n.side,n.replacedFragment?n.side=0:e[-i]&&(n.replaces(new O(e[-i],e.parent.ends[-i],i)),e[-i]=0),t.prototype.createLeftOf.call(this,e)),i===se?e.insAtLeftEnd(n.ends[se]):e.insRightOf(n)},e.prototype.placeCursor=function(){},e.prototype.unwrap=function(){this.ends[se].children().disown().adopt(this.parent,this,this[ae]).jQ.insertAfter(this.jQ),this.remove()},e.prototype.deleteSide=function(t,e,n){var r,i,o,s,a=this.parent,l=this[t],p=a.ends[t];if(t===this.side)return this.unwrap(),void(l?n.insDirOf(-t,l):n.insAtDirEnd(t,a));if(r=n.options,i=!this.side,this.side=-t,this.matchBrack(r,t,this.ends[se].ends[this.side]))this.closeOpposing(this.ends[se].ends[this.side]),o=this.ends[se].ends[t],this.unwrap(),o&&o.siblingCreated(n.options,t),l?n.insDirOf(-t,l):n.insAtDirEnd(t,a);else{if(this.matchBrack(r,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&i)return this.unwrap(),void(l?n.insDirOf(-t,l):n.insAtDirEnd(t,a));this.sides[t]=b(this),s=this.delimjQs.removeClass("mq-ghost").eq(t===se?0:1).addClass("mq-ghost"),this.replaceBracket(s,t)}l?(o=this.ends[se].ends[t],new O(l,p,-t).disown().withDirAdopt(-t,this.ends[se],o,0).jQ.insAtDirEnd(t,this.ends[se].jQ.removeClass("mq-empty")),o&&o.siblingCreated(n.options,t),n.insDirOf(-t,l)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[se])}},e.prototype.replaceBracket=function(t,e){var n=this.getSymbol(e);t.html(n.html).css("width",n.width),e===se?t.next().css("margin-left",n.width):t.prev().css("margin-right",n.width)},e.prototype.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.prototype.finalizeTree=function(){this.ends[se].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===se?1:0).removeClass("mq-ghost"),this.side=0}},e.prototype.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()},e}(Kt),Yt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},Xt={"&lang;":"angle-bracket","&rang;":"angle-bracket","|":"pipe"},v("(","","parenthesis"),v("[","","bracket"),v("{","\\{","brace"),L.langle=function(){return new Zt(se,"&lang;","&rang;","\\langle ","\\rangle ")},L.rangle=function(){return new Zt(ae,"&lang;","&rang;","\\langle ","\\rangle ")},T["|"]=function(){return new Zt(se,"|","|","|","|")},L.lVert=function(){return new Zt(se,"&#8741;","&#8741;","\\lVert ","\\rVert ")},L.rVert=function(){return new Zt(ae,"&#8741;","&#8741;","\\lVert ","\\rVert ")},L.left=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parser=function(){var t=$.regex,e=$.string,n=$.optWhitespace;return n.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then(function(r){var i=r.replace(/^\\/,"");return"\\langle"==r&&(i="&lang;",r+=" "),"\\lVert"==r&&(i="&#8741;",r+=" "),Z.then(function(o){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map(function(t){var e,n=t.replace(/^\\/,"");return"\\rangle"==t&&(n="&rang;",t+=" "),"\\rVert"==t&&(n="&#8741;",t+=" "),e=new Zt(0,i,n,r,t),e.blocks=[o],o.adopt(e,0,0),e})})})},e}(it),L.right=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parser=function(){return $.fail("unmatched \\right")},e}(it),Jt=Bt["("],te=Bt[")"],ee=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\binom",e.htmlTemplate='<span class="mq-non-leaf mq-bracket-container"><span style="width:'+Jt.width+'" class="mq-paren mq-bracket-l mq-scaled">'+Jt.html+'</span><span style="margin-left:'+Jt.width+"; margin-right:"+te.width+';" class="mq-non-leaf mq-bracket-middle"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span style="width:'+te.width+'" class="mq-paren mq-bracket-r mq-scaled">'+te.html+"</span></span>",e.textTemplate=["choose(",",",")"],e.mathspeakTemplate=["StartBinomial,","Choose",", EndBinomial"],e.ariaLabel="binomial",e}return __extends(e,t),e}(Kt),L.binom=L.binomial=ee,L.choose=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(t){$t.prototype.createLeftOf(t)},e}(ee),ne=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\MathQuillMathField",e.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',e}return __extends(e,t),e.prototype.parser=function(){var e=this,n=$.string,r=$.regex,i=$.succeed;return n("[").then(r(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(t){e.name=t}).or(i(void 0)).then(t.prototype.parser.call(this))},e.prototype.finalizeTree=function(t){var e=new nt(this.ends[se],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),p(e.root)},e.prototype.registerInnerField=function(t,e){var n=this.ends[se].controller,r=new e(n);t[this.name]=r,t.push(r)},e.prototype.latex=function(){return this.ends[se].latex()},e.prototype.text=function(){return this.ends[se].text()},e}(it),L.editable=L.MathQuillMathField=ne,re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},e.prototype.parser=function(){var t=this,e=$.string,n=$.regex,r=$.succeed;return e("{").then(n(/^[a-z][a-z0-9]*/i)).skip(e("}")).then(function(i){return e("[").then(n(/^[-\w\s]*/)).skip(e("]")).or(r(void 0)).map(function(e){return t.setOptions(E[i](e))})})},e}(ot),L.embed=re,T["\\"]=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ctrlSeq="\\",e.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',e.textTemplate=["\\"],e}return __extends(e,t),e.prototype.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},e.prototype.createBlocks=function(){var e,n;t.prototype.createBlocks.call(this),e=this.ends[se],e.focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},e.blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},e.write=function(t,e){if(t.show().deleteSelection(),e.match(/[a-z]/i))new st(e).createLeftOf(t),t.controller.aria.alert(e);else{var n=this.parent.renderCommand(t);t.controller.aria.queue(n.mathspeak({createdLeftOf:t})),"\\"===e&&this.isEmpty()?t.controller.aria.alert():t.parent.write(t,e)}},n=e.keystroke,e.keystroke=function(t,e,r){if("Tab"===t||"Enter"===t||"Spacebar"===t){var i=this.parent.renderCommand(r.cursor);return r.aria.alert(i.mathspeak({createdLeftOf:r.cursor})),void e.preventDefault()}return n.call(this,t,e,r)}},e.prototype.createLeftOf=function(e){if(t.prototype.createLeftOf.call(this,e),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return t.target=n,q(n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},e.prototype.latex=function(){return"\\"+this.ends[se].latex()+" "},e.prototype.renderCommand=function(t){var e,n,r;return this.jQ=this.jQ.last(),this.remove(),this[ae]?t.insLeftOf(this[ae]):t.insAtRightEnd(this.parent),e=this.ends[se].latex(),e||(e=" "),n=L[e],n?(r=void 0,r=s(n)?new n(e):n(e),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(t),r):(r=new ut,r.replaces(e),r.createLeftOf(t),t.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove(),r)},e}(it),ie=l(1);for(oe in ie)!function(t,e){"function"==typeof e?(a[t]=function(){return z(),e.apply(this,arguments)},a[t].prototype=e.prototype):a[t]=e}(oe,ie[oe])}();
