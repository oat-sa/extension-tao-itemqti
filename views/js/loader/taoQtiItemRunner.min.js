define("taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator",["ui/ckeditor/ckConfigurator"],function(ckConfigurator){"use strict";return{getConfig:function(editor,toolbarType,options){return(options=options||{}).underline=!0,ckConfigurator.getConfig(editor,toolbarType,options)}}}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(_){"use strict";return{buildSerial:function(prefix){for(var id=prefix||"",chars="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<22;i++)id+=chars.charAt(Math.floor(Math.random()*chars.length));return id},buildId:function(item,prefix){var id,usedIds,i=1,suffix="",exists=!1;if(!item)throw new TypeError(
"A item is required to generate a unique identifier");for(usedIds=item.getUsedIds();exists=!1,id=prefix+suffix,_.contains(usedIds,id)&&(exists=!0,suffix="_"+i,i++),exists;);return id},buildIdentifier:function(item,prefix,useSuffix){var id,usedIds,suffix="",i=1,exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");if(!prefix)throw new TypeError("Prefix is required to build an identifier");for(usedIds=item.getUsedIdentifiers(),useSuffix=!!_.isUndefined(useSuffix)||useSuffix,prefix&&(prefix=prefix.replace(/_[0-9]+$/gi,"_").replace(/[^a-zA-Z0-9_]/gi,"_").replace(/(_)+/gi,"_"),useSuffix&&(suffix="_"+i));exists=!1,
usedIds[id=prefix+suffix]&&(exists=!0,suffix="_"+i,i++),exists;);return id},findInCollection:function(element,collectionNames,searchedSerial){var found=null;if(_.isString(collectionNames)&&(collectionNames=[collectionNames]),!_.isArray(collectionNames))throw new Error("invalid argument : collectionNames must be an array or a string");return _.each(collectionNames,function(collectionName){var collection=element;_.each(collectionName.split("."),function(nameToken){collection=collection[nameToken]});var elt=collection[searchedSerial];return elt?!(found={parent:element,element:elt}):(_.each(collection,function(elt){if(_.isFunction(elt.find)&&(found=elt.find(
searchedSerial)))return!1}),!found&&void 0)}),found},addMarkupNamespace:function(markup,ns){return ns?markup=markup.replace(/<(\/)?([a-z:]+)(\s?)([^><]*)>/g,function($0,$1,$2,$3,$4){return 0<$2.indexOf(":")?$0:"<"+($1=$1||"")+ns+":"+$2+($3=$3||"")+$4+">"}):markup},removeMarkupNamespaces:function(markup){return markup.replace(/<(\/)?(\w*):([^>]*)>/g,"<$1$3>")},getMarkupUsedNamespaces:function(markup){var namespaces=[];return markup.replace(/<(\/)?(\w*):([^>]*)>/g,function(original,slash,ns,node){return namespaces.push(ns),"<"+slash+node+">"}),_.uniq(namespaces)}}}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(_,$){
var rendererConfigHelper={getOptionsFromArguments:function(args){var options={data:{},placeholder:null,subclass:"",renderer:null};return _.each(args,function(arg){arg&&(arg.isRenderer?options.renderer=arg:arg instanceof $&&arg.length?options.placeholder=arg:_.isString(arg)?options.subclass=arg:_.isPlainObject(arg)?options.data=arg:console.log("invalid arg",arg,args))}),options}};return rendererConfigHelper}),define("taoQtiItem/qtiItem/core/Element",["jquery","lodash","class","core/logger","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Class,loggerFactory,util,rendererConfig){"use strict";var _instances={},
logger=loggerFactory("taoQtiItem/qtiItem/core/Element"),Element=Class.extend({qtiClass:"",serial:"",rootElement:null,init:function(serial,attributes){if(this.attributes={},this.metaData={},"object"==typeof serial&&(attributes=serial,serial=""),serial||(serial=util.buildSerial(this.qtiClass+"_")),serial&&("string"!=typeof serial||!serial.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+typeof serial+") "+serial;if(_instances[serial])throw"a QTI Element with the same serial already exists "+serial;(_instances[serial]=this).serial=serial,this.setAttributes(attributes||{}),"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),
"function"==typeof this.initObject&&this.initObject()},is:function(qtiClass){return qtiClass===this.qtiClass},placeholder:function(){return"{{"+this.serial+"}}"},getSerial:function(){return this.serial},getUsedIdentifiers:function(){var usedIds={},elts=this.getComposingElements();for(var i in elts){var elt=elts[i],id=elt.attr("identifier");id&&(usedIds[id]=elt)}return usedIds},getUsedIds:function(){var usedIds=[];return _.forEach(this.getComposingElements(),function(elt){var id=elt.attr("id");id&&!_.contains(usedIds,id)&&usedIds.push(id)}),usedIds},attr:function(name,value){if(name)if(void 0!==value)this.attributes[name]=value;else if("object"==typeof name
)for(var prop in name)this.attr(prop,name[prop]);else if("string"==typeof name)return void 0===this.attributes[name]?void 0:this.attributes[name];return this},data:function(name,value){if(name)if(void 0!==value)this.metaData[name]=value,$(document).trigger("metaChange.qti-widget",{element:this,key:name,value:value});else if("object"==typeof name)for(var prop in name)this.data(prop,name[prop]);else if("string"==typeof name)return void 0===this.metaData[name]?void 0:this.metaData[name];return this},removeData:function(name){return delete this.metaData[name],this},removeAttr:function(name){return this.removeAttributes(name)},setAttributes:function(attributes){
return _.isPlainObject(attributes)||logger.warn("attributes should be a plain object"),this.attributes=attributes,this},getAttributes:function(){return _.clone(this.attributes)},removeAttributes:function(attrNames){for(var i in"string"==typeof attrNames&&(attrNames=[attrNames]),attrNames)delete this.attributes[attrNames[i]];return this},getComposingElements:function(){var elts={};function append(element){elts[element.getSerial()]=element,elts=_.extend(elts,element.getComposingElements())}return"function"==typeof this.initContainer&&append(this.getBody()),"function"==typeof this.initObject&&append(this.getObject()),_.each(this.metaData,function(v){
Element.isA(v,"_container")?append(v):_.isArray(v)&&_.each(v,function(v){Element.isA(v,"_container")&&append(v)})}),elts},getUsedClasses:function(){var ret=[this.qtiClass],composingElts=this.getComposingElements();return _.each(composingElts,function(elt){ret.push(elt.qtiClass)}),_.uniq(ret)},find:function(serial){var object,body,found=null;return"function"==typeof this.initObject&&(object=this.getObject()).serial===serial&&(found={parent:this,element:object,location:"object"}),found||"function"!=typeof this.initContainer||(found=(body=this.getBody()).serial===serial?{parent:this,element:body,location:"body"}:this.getBody().find(serial,this)),found},
parent:function(){var item=this.getRootElement();if(item){var found=item.find(this.getSerial());if(found)return found.parent}return null},setRelatedItem:function(item){logger.warn("Deprecated use of setRelatedItem()"),this.setRootElement(item)},setRootElement:function(item){var composingElts,i;if(Element.isA(item,"assessmentItem"))for(i in this.rootElement=item,composingElts=this.getComposingElements())composingElts[i].setRootElement(item)},getRelatedItem:function(){return logger.warn("Deprecated use of getRelatedItem()"),this.getRootElement()},getRootElement:function(){var ret=null;return Element.isA(this.rootElement,"assessmentItem")&&(ret=this.rootElement
),ret},setRenderer:function(renderer){if(!renderer||!renderer.isRenderer)throw"invalid qti rendering engine";this.renderer=renderer;var elts=this.getComposingElements();for(var serial in elts)elts[serial].setRenderer(renderer)},getRenderer:function(){return this.renderer},render:function(){var rendering,args=rendererConfig.getOptionsFromArguments(arguments),_renderer=args.renderer||this.getRenderer(),tplData={},defaultData={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()};if(!_renderer)throw new Error("render: no renderer found for the element "+this.qtiClass+":"+this.serial);return"function"==typeof this.initContainer&&(
defaultData.body=this.getBody().render(args.renderer)),"function"==typeof this.initObject&&(defaultData.object={attributes:this.object.getAttributes()},defaultData.object.attributes.data=_renderer.resolveUrl(this.object.attr("data"))),tplData=_.merge(defaultData,args.data||{}),tplData=_renderer.getData(this,tplData,args.subclass),rendering=_renderer.renderTpl(this,tplData,args.subclass),args.placeholder&&args.placeholder.replaceWith(rendering),rendering},postRender:function(data,altClassName,renderer){var postRenderers=[],_renderer=renderer||this.getRenderer();if("function"==typeof this.initContainer&&(postRenderers=this.getBody().postRender(data,"",renderer
)),!_renderer)throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial;return postRenderers.push(_renderer.postRender(this,data,altClassName)),_.compact(postRenderers)},getContainer:function($scope,subclass){var renderer=this.getRenderer();if(renderer)return renderer.getContainer(this,$scope,subclass);throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function(){var arr={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(arr.body=this.getBody().toArray()),"function"==typeof this.initObject&&(arr.object=this.object.toArray()
),arr},isEmpty:function(){return!1},addClass:function(className){var clazz=this.attr("class")||"";_containClass(clazz,className)||this.attr("class",clazz+(clazz.length?" ":"")+className)},hasClass:function(className){return _containClass(this.attr("class"),className)},removeClass:function(className){var clazz=this.attr("class")||"";if(clazz){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)");(clazz=clazz.replace(regex," ").trim())?this.attr("class",clazz):this.removeAttr("class")}},toggleClass:function(className,state){return"boolean"==typeof state?state?this.addClass(className):this.removeClass(className):this.hasClass(className)?this.removeClass(
className):this.addClass(className)},isset:function(){return Element.issetElement(this.serial)},unset:function(){return Element.unsetElement(this.serial)}}),_containClass=function(allClassStr,className){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)","");return allClassStr&&regex.test(allClassStr)};return Element.isA=function(qtiElement,qtiClass){return qtiElement instanceof Element&&qtiElement.is(qtiClass)},Element.getElementBySerial=function(serial){return _instances[serial]},Element.issetElement=function(serial){return!!_instances[serial]},Element.unsetElement=function(serial){var element=Element.getElementBySerial(serial);if(element){
var composingElements=element.getComposingElements();return _.each(composingElements,function(elt){delete _instances[elt.serial]}),delete _instances[element.serial],!0}return!1},Element}),define("taoQtiItem/qtiCommonRenderer/helpers/container",["lodash","jquery","taoQtiItem/qtiItem/core/Element"],function(_,$,Element){"use strict";var _containers={},_$containerContext=$(),_getSelector=function(element){var selector="[data-serial="+element.getSerial()+"]";return Element.isA(element,"choice")?selector=".qti-choice"+selector:Element.isA(element,"interaction")&&(selector=".qti-interaction"+selector),selector};return{setContext:function($scope){
_$containerContext=$scope},get:function(element,$scope){var serial=element.getSerial();return $scope instanceof $&&$scope.length?$scope.find(_getSelector(element)):_$containerContext instanceof $&&_$containerContext.length?_$containerContext.find(_getSelector(element)):(_containers[serial]&&_containers[serial].length||(_containers[serial]=$(_getSelector(element))),_containers[serial])},reset:function(element){element instanceof Element&&_containers[element.getSerial()]&&(_containers=_.omit(_containers,element.getSerial()))},clear:function(){_containers={},_$containerContext=$()},trigger:function(eventType,element,data){eventType&&(data&&!_.isArray(data)&&(
data=[data]),this.get(element).trigger(eventType,data))},triggerResponseChangeEvent:function(interaction,extraData){this.trigger("responseChange",interaction,[{interaction:interaction,response:interaction.getResponse()},extraData])},targetBlank:function($container){$container.on("click","a",function(e){e.preventDefault();var href=$(this).attr("href");href&&href.match(/^http/i)&&window.open(href,"_blank")})}}}),define("json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json",function(){return{basic:{stroke:"#8D949E","stroke-width":2,"stroke-dasharray":"","stroke-linejoin":"round",fill:"#cccccc","fill-opacity":.5,cursor:"pointer"},hover:{
stroke:"#3E7DA7",fill:"#0E5D91","fill-opacity":.3},selectable:{"stroke-dasharray":"-",stroke:"#3E7DA7",fill:"#cccccc","fill-opacity":.5},active:{stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91","fill-opacity":.5},error:{stroke:"#C74155","stroke-dasharray":"","fill-opacity":.5,fill:"#661728"},success:{stroke:"#C74155","stroke-dasharray":"",fill:"#0E914B","fill-opacity":.5},layer:{fill:"#ffffff",opacity:0,cursor:"pointer"},creator:{"fill-opacity":.5,stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91",cursor:"pointer"},"imageset-rect-stroke":{fill:"#ffffff",stroke:"#666666","stroke-width":1,"stroke-linejoin":"round",cursor:"pointer"},
"imageset-rect-no-stroke":{fill:"#ffffff",stroke:"#ffffff","stroke-width":2,"stroke-linejoin":"round",cursor:"pointer"},"imageset-img":{cursor:"pointer"},"order-text":{fill:"#ffffff",stroke:"#000000","stroke-width":.7,"font-family":"sans-serif","font-weight":"bold","font-size":22,cursor:"pointer"},"score-text-default":{stroke:"#444444","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"score-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"small-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif",
"font-weight":"normal","font-size":16,cursor:"pointer"},"layer-pos-text":{stroke:"#333","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":14},target:{
path:"m 18,8.4143672 -1.882582,0 C 15.801891,4.9747852 13.071059,2.2344961 9.63508,1.9026738 L 9.63508,0 8.2305176,0 l 0,1.9026387 C 4.7947148,2.2343027 2.0637246,4.9746621 1.7481973,8.4143672 l -1.7481973,0 0,1.4045625 1.754877,0 c 0.3460429,3.4066753 3.0632871,6.1119843 6.4756406,6.4413813 l 0,1.739689 1.4045624,0 0,-1.739725 c 3.412547,-0.329537 6.129633,-3.034793 6.475641,-6.4413453 l 1.889279,0 z m -8.36492,6.5188648 0,-4.064673 -1.4045624,0 0,4.063882 C 5.5511016,14.612555 3.4232695,12.494619 3.0864551,9.8189297 l 4.0449512,0 0,-1.4045625 -4.0546368,0 C 3.3788672,5.6984941 5.5228887,3.5393379 8.2305176,3.2161113 l 0,3.9153125 1.4045624,0 0,-3.9160859 c 2.711162,0.3203965 4.858576,2.4808887 5.160955,5.1990293 l -3.927441,0 0,1.4045625 3.917773,0 C 14.449289,12.496957 12.318363,14.616158 9.63508,14.933232 z",
fill:"#0E914B",width:1,"stroke-width":0,cursor:"pointer"},"target-hover":{fill:"#3E7DA7","fill-opacity":1},"target-success":{fill:"#0E914B","fill-opacity":1},assoc:{"stroke-width":2,"stroke-linecap":"round",cursor:"pointer"},"assoc-layer":{"stroke-width":12,cursor:"pointer","stroke-opacity":0},"assoc-bullet":{fill:"#000000"},close:{
path:"m 8.9997236,18.000001 c -4.9703918,0 -8.99972284217367,-4.02901 -8.99972284217367,-9 C 7.5782633e-7,4.029011 4.0293108,9.8531742e-7 8.9997236,9.8531742e-7 13.970691,9.8531742e-7 18.000001,4.029011 18.000001,9.000001 c 0,4.97099 -4.02931,9 -9.0002774,9 z m 0.0045,-16.37151 c -4.06191,0 -7.35492,3.29635 -7.35492,7.36251 0,4.06562 3.292989,7.36255 7.35492,7.36255 4.0630384,0 7.3554334,-3.29693 7.3554334,-7.36255 0,-4.06614 -3.292969,-7.36251 -7.3554334,-7.36251 v 0 z m 3.1314894,9.31167 -1.953823,-1.94014 1.953843,-1.94018 c 0.08964,-0.089 0.134622,-0.19099 0.135073,-0.30584 4.31e-4,-0.11488 -0.04383,-0.21712 -0.132838,-0.30681 l -0.54267,-0.54685 c -0.08898,-0.0897 -0.190903,-0.13473 -0.305719,-0.13514 -0.114837,-4.4e-4 -0.217064,0.0439 -0.306703,0.1329 l -1.9623724,1.94865 -1.962395,-1.94865 c -0.08964,-0.089 -0.191845,-0.13336 -0.306702,-0.1329 -0.114837,4.3e-4 -0.216736,0.0455 -0.305719,0.13514 l -0.54265,0.54685 c -0.08902,0.0897 -0.133269,0.19193 -0.132838,0.30681 4.3e-4,0.11485 0.04543,0.21681 0.135073,0.30584 l 1.953823,1.94018 -1.953782,1.94014 c -0.0896,0.089 -0.134684,0.19094 -0.135114,0.3058 -4.31e-4,0.11486 0.04386,0.21716 0.132838,0.30681 l 0.542671,0.54687 c 0.08896,0.0897 0.190923,0.13467 0.305718,0.13516 0.114857,3.9e-4 0.217105,-0.0439 0.306724,-0.13288 l 1.962332,-1.94863 1.9623324,1.94863 c 0.08962,0.089 0.191886,0.13323 0.306744,0.13288 0.114836,-4.5e-4 0.216736,-0.0455 0.305698,-0.13516 l 0.542691,-0.54687 c 0.089,-0.0897 0.133227,-0.19193 0.132838,-0.30681 -3.9e-4,-0.1149 -0.0455,-0.21683 -0.135073,-0.3058 z",
fill:"#0E5D91",width:1,opacity:0,"stroke-width":0,cursor:"pointer"},"close-bg":{fill:"#ffffff",stroke:"none",cursor:"pointer",opacity:0},"touch-circle":{fill:"none",stroke:"#3E7DA7","stroke-width":2}}}),define("taoQtiItem/qtiCommonRenderer/helpers/Graphic",["jquery","lodash","raphael","scale.raphael","json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json"],function($,_,raphael,scaleRaphael,gstyle){"use strict";var shapeMap={default:"rect",poly:"path"},coordsValidator={rect:4,ellipse:4,circle:3,poly:6,default:0},qti2raphCoordsMapper={rect:function(coords){return[coords[0],coords[1],coords[2]-coords[0],coords[3]-coords[1]]},default:function(paper){
return[0,0,paper.width,paper.height]},poly:function(coords){var a,size=coords.length;for(coords[0]!==coords[size-2]&&coords[1]!==coords[size-1]&&(coords.push(coords[0]),coords.push(coords[1])),coords[0]="M"+coords[0],a=1;a<size;a++)a%2==0&&(coords[a]="L"+coords[a]);return[coords.join(" ")]}},raph2qtiCoordsMapper={rect:function(attr){return[attr.x,attr.y,attr.x+attr.width,attr.y+attr.height]},circle:function(attr){return[attr.cx,attr.cy,attr.r]},ellipse:function(attr){return[attr.cx,attr.cy,attr.rx,attr.ry]},default:function(attr){return this.rect(attr)},path:function(attr){var i,poly=[];if(_.isArray(attr.path))for(i=1;i<attr.path.length;i++
)3===attr.path[i].length&&(poly.push(attr.path[i][1]),poly.push(attr.path[i][2]));return poly}};return{_style:gstyle,setStyle:function(element,name){element&&gstyle[name]&&element.attr(gstyle[name])},responsivePaper:function(id,serial,options){var paper,image,$container=options.container||$("#"+id).parent(),$editor=$(".image-editor",$container),$body=$container.closest(".qti-itemBody"),resizer=_.throttle(function(e,givenWidth){var diff,maxWidth,containerWidth,containerHeight,factor;e&&e.stopPropagation();diff=$editor.outerWidth()-$editor.width()+($container.outerWidth()-$container.width())+1,maxWidth=$body.width(),(0<(containerWidth=$container.innerWidth()
)||0<givenWidth)&&(givenWidth<containerWidth&&givenWidth<maxWidth?containerWidth=givenWidth-diff:maxWidth<containerWidth?containerWidth=maxWidth-diff:containerWidth-=diff,containerHeight=imgHeight*(factor=containerWidth/imgWidth),0<containerWidth&&paper.changeSize(containerWidth,containerHeight,!1,!1),"function"==typeof options.resize&&options.resize(containerWidth,factor),$container.trigger("resized.qti-widget"))},10),imgWidth=options.width||$container.innerWidth(),imgHeight=options.height||$container.innerHeight();return(image=(paper=scaleRaphael(id,imgWidth,imgHeight)).image(options.img,0,0,imgWidth,imgHeight)).id=options.imgId||image.id,paper.setViewBox(
0,0,imgWidth,imgHeight),resizer(),$(image.node).attr("externalResourcesRequired","true").on("load",resizer),"SVG"===raphael.type?($(window).on("resize.qti-widget."+serial,resizer),$container.on("resize.qti-widget."+serial,resizer),$(document).on("customcssloaded.styleeditor",resizer)):($container.find(".main-image-box").width(imgWidth),"function"==typeof options.resize&&options.resize(imgWidth,1)),paper},createElement:function(paper,type,coords,options){var element,self=this,shaper=shapeMap[type]?paper[shapeMap[type]]:paper[type],shapeCoords=!1!==options.qtiCoords?self.raphaelCoords(paper,type,coords):coords;if("function"!=typeof shaper)throw new Error(
"Unable to find method "+type+" on paper");return(element=shaper.apply(paper,shapeCoords))&&(options.id&&(element.id=options.id),options.title&&element.attr("title",options.title),element.attr(gstyle[options.style||"basic"]).toFront(),$(element.node).removeAttr("stroke-dasharray"),!1!==options.hover&&element.hover(function(){element.flashing||self.updateElementState(this,"hover")},function(){element.flashing||self.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")}),!1!==options.touchEffect&&element.touchstart(function(){self.createTouchCircle(paper,element.getBBox())})),element},createTarget:function(paper,options){var count,
factor,hover,layer,point,self,tBBox,targetSize,x,y,target;return self=this,point=(options=options||{}).point||{x:0,y:0},factor=0!==paper.w?paper.width/paper.w:1,hover=void 0===options.hover||!!options.hover,18,9,x=point.x-9,y=point.y-9,targetSize=0!==factor?2/factor:2,target=paper.path(gstyle.target.path).transform("t"+x+","+y+"s"+targetSize).attr(gstyle.target).attr("title",_("Click again to remove")),options.id?target.id=options.id:(count=0,paper.forEach(function(element){element.data("target")&&count++}),target.id="target-"+count),tBBox=target.getBBox(),layer=paper.rect(tBBox.x,tBBox.y,tBBox.width,tBBox.height).attr(gstyle.layer).click(function(){
var id=target.id,p=this.data("point");_.isFunction(options.select)&&options.select(target,p,this),_.isFunction(options.remove)&&(this.remove(),target.remove(),options.remove(id,p))}),hover&&layer.hover(function(){target.flashing||self.setStyle(target,"target-hover")},function(){target.flashing||self.setStyle(target,"target-success")}),layer.id="layer-"+target.id,layer.data("point",point),target.data("target",point),_.isFunction(options.create)&&options.create(target),target},raphaelCoords:function(paper,type,coords){var shapeCoords;if(_.isString(coords)&&(coords=_.map(coords.split(","),function(coord){return parseInt(coord,10)})),!_.isArray(coords
)||coords.length<coordsValidator[type])throw new Error("Invalid coords "+JSON.stringify(coords)+"  for type "+type);switch(type){case"rect":shapeCoords=qti2raphCoordsMapper.rect(coords);break;case"default":shapeCoords=qti2raphCoordsMapper.default.call(null,paper);break;case"poly":shapeCoords=qti2raphCoordsMapper.poly(coords);break;default:shapeCoords=coords}return shapeCoords},qtiCoords:function(element){var mapper=raph2qtiCoordsMapper[element.type],result="";return _.isFunction(mapper)&&(result=_.map(mapper.call(raph2qtiCoordsMapper,element.attr()),function(coord){return _.parseInt(coord)}).join(",")),result},createTouchCircle:function(paper,bbox){
var radius=bbox.width>bbox.height?bbox.width:bbox.height,tCircle=paper.circle(bbox.x+bbox.width/2,bbox.y+bbox.height/2,radius);tCircle.attr(gstyle["touch-circle"]),_.defer(function(){tCircle.animate({r:radius+5,opacity:.7},300,function(){tCircle.remove()})})},createText:function(paper,options){var fontSize,scaledFontSize,text,top=options.top||0,left=options.left||0,content=options.content||"",style=options.style||"small-text",title=options.title||"",factor=1;return paper.width&&paper.w&&(factor=paper.width/paper.w),text=paper.text(left,top,content).toFront(),options.id&&(text.id=options.id),options.hide&&text.hide(),text.attr(gstyle[style]),
void 0!==factor&&1!==factor&&(fontSize=parseInt(text.attr("font-size"),10),scaledFontSize=Math.floor(fontSize/factor)+1,text.attr("font-size",scaledFontSize)),title&&this.updateTitle(text,title),text},createShapeText:function(paper,shape,options){var self=this,bbox=shape.getBBox(),text=this.createText(paper,_.merge({left:bbox.x+bbox.width/2,top:bbox.y+bbox.height/2},options));return options.shapeClick&&text.click(function(){self.trigger(shape,"click")}),text},createBorderedImage:function(paper,options){var padding=0<=options.padding?options.padding:6,halfPad=padding/2,rx=options.left,ry=options.top,rw=options.width+padding,rh=options.height+padding,
ix=options.left+halfPad,iy=options.top+halfPad,iw=options.width,ih=options.height,set=paper.set(),rect=paper.rect(rx,ry,rw,rh).attr(options.border?gstyle["imageset-rect-stroke"]:gstyle["imageset-rect-no-stroke"]),image=paper.image(options.url,ix,iy,iw,ih).attr(gstyle["imageset-img"]);return options.shadow&&set.push(rect.glow({width:2,offsetx:1,offsety:1})),set.push(rect,image),set.move=function(x,y,duration){var animation=raphael.animation({x:x,y:y},duration||400),elt=rect.animate(animation);return image.animateWith(elt,animation,{x:x+halfPad,y:y+halfPad},duration||400),set},set},updateElementState:function(element,state,title){element&&element.animate&&(
element.animate(gstyle[state],200,"linear",function(){element.attr(gstyle[state]),$(element.node).removeAttr("stroke-dasharray")}),title&&this.updateTitle(element,title))},updateTitle:function(element,title){element&&element.node&&(_.forEach(element.node.children,function(child){"title"===child.nodeName.toLowerCase()&&element.node.removeChild(child)}),element.attr("title",title))},highlightError:function(element,restoredState){var self=this;element&&(element.flashing=!0,self.updateElementState(element,"error"),_.delay(function(){self.updateElementState(element,restoredState||"basic"),element.flashing=!1},800))},trigger:function(element,event){
var evt=_.where(element.events,{name:event});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.apply(element,Array.prototype.slice.call(arguments,2))},getPoint:function(event,paper,$container){var point=this.clickPoint($container,event),rect=$container.get(0).getBoundingClientRect(),factor=paper.w/rect.width;return point.x=Math.round(point.x*factor),point.y=Math.round(point.y*factor),point},position:function($container,paper){var pw=parseInt(paper.w||paper.width,10),cw=parseInt($container.width(),10),ph=parseInt(paper.w||paper.width,10);return{left:(cw-pw)/2,top:(parseInt($container.height(),10)-ph)/2}},clickPoint:function($container,event){var x,y,
offset=$container.offset();return event.pageX||event.pageY?(x=event.pageX-offset.left,y=event.pageY-offset.top):(event.clientX||event.clientY)&&(x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-offset.left,y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop-offset.top),{x:x,y:y}}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",
escapeExpression=this.escapeExpression;return buffer+='<div id="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" class="small feedback-info item-instruction"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"]
)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='>\n    <span class="icon-info icon"></span><span class="instruction-message">',stack1=(helper=helpers.message)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.message)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction",["lodash","taoQtiItem/qtiItem/helper/util","tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction"],function(_,util,instructionTpl){var _notificationLevels=["info","warning","error",
"success"],Instruction=function(interaction,message,callback){this.interaction=interaction,this.defaultMessage=message||"",this.currentMessage="",this.level="info",this.serial=util.buildSerial("instruction_"),this.callback=callback,this.$dom=null,this.state=!1};return Instruction.isValidLevel=function(level){return 0<=_.indexOf(_notificationLevels,level)},Instruction.prototype.setState=function(state){this.state=state},Instruction.prototype.checkState=function(state){return this.state===state},Instruction.prototype.getId=function(){return this.serial},Instruction.prototype.create=function($container){$container.append(instructionTpl({
message:this.defaultMessage,serial:this.serial})),this.$dom=$container.find("#"+this.serial)},Instruction.prototype.update=function(options){var level=options&&options.level?options.level:"",message=options&&options.message?options.message:"",timeout=options&&options.timeout?options.timeout:0,start=options&&"function"==typeof options.start?options.start:null,stop=options&&"function"==typeof options.stop?options.stop:null;if(level&&Instruction.isValidLevel(level)&&(this.$dom.removeClass("feedback-"+this.level).addClass("feedback-"+level),this.$dom.find(".icon").removeClass("icon-"+this.level).addClass("icon-"+level),this.level=level),message&&(this.$dom.find(
".instruction-message").html(message),this.currentMessage=message),timeout){var _this=this;start&&start.call(_this),_this.timer=setTimeout(function(){stop&&stop.call(_this),_this.timer=null},timeout)}},Instruction.prototype.setLevel=function(level,timeout){var options={level:level};timeout&&(options.timeout=parseInt(timeout),options.stop=function(){this.setLevel("info")}),this.update(options)},Instruction.prototype.getLevel=function(){return this.level},Instruction.prototype.setMessage=function(message,timeout){this.update({message:message,timeout:timeout})},Instruction.prototype.reset=function(){this.update({level:"info",message:this.defaultMessage}),
this.state=!1},Instruction.prototype.validate=function(data){"function"==typeof this.callback&&this.callback.call(this,data)},Instruction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/notification",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="small feedback-',stack1=(helper=helpers.level)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.level)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+' item-notification"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='>\n    <span class="icon-',stack1=(helper=helpers.level)?helper.call(depth0
,{hash:{},data:data}):typeof(helper=depth0&&depth0.level)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"></span><span class="feedback-message">',stack1=(helper=helpers.message)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.message)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'</span>\n    <span title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options))
)+'" class="icon-close close-trigger"></span>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager",["lodash","jquery","i18n","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction","tpl!taoQtiItem/qtiCommonRenderer/tpl/notification"],function(_,$,__,containerHelper,Instruction,notifTpl){"use strict";var _instructions={};return{validateInstructions:function(element,data){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.validate(data||{})})},appendInstruction:function(element,message,
validateCallback){var serial=element.getSerial(),instruction=new Instruction(element,message,validateCallback);return _instructions[serial]||(_instructions[serial]={}),(_instructions[serial][instruction.getId()]=instruction).create($(".instruction-container",containerHelper.get(element))),instruction},removeInstructions:function(element){_instructions[element.getSerial()]={},containerHelper.get(element).find(".instruction-container").empty()},resetInstructions:function(element){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.reset()})},minMaxChoiceInstructions:function(interaction,options){
var msg,min=options.min||0,max=options.max||0,getResponse=options.getResponse,onError=options.onError||_.noop(),choiceCount=!1!==options.choiceCount&&_.size(interaction.getChoices()),minInstructionSet=!1;if(!_.isFunction(getResponse))throw"invalid parameter getResponse";0<max&&(!1===choiceCount||max<choiceCount)&&(max===min?(minInstructionSet=!0,msg=__(max<=1?"You must select exactly %d choice":"You must select exactly %d choices",max),this.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,
start:function(){onError(data)},stop:function(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):min<max&&(msg=__(max<=1?"You can select maximum %d choice":"You can select maximum %d choices",max),this.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){onError(data)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!minInstructionSet&&0<min&&(!1===choiceCount||min<choiceCount)&&(msg=__(
min<=1?"You must select at least %d choice":"You must select at least %d choices",min),this.appendInstruction(interaction,msg,function(){getResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},appendNotification:function(element,message,level){if(level=level||"info",Instruction.isValidLevel(level)){var $container=containerHelper.get(element);$container.find(".notification-container").prepend(notifTpl({level:level,message:message}));var $notif=$container.find(".item-notification:first"),_remove=function(){$notif.fadeOut()};return $notif.find(".close-trigger").on("click",_remove),setTimeout(_remove,2e3),$notif}},
removeNotifications:function(element){containerHelper.get(element).find(".item-notification").remove()}}}),define("taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler",["jquery","lodash"],function($,_){"use strict";var informLoaded=_.throttle(function(){$(document).trigger("customcssloaded.styleeditor")},10,{leading:!1});return{attach:function(stylesheets){var $head=$("head");$head.length||($head=$("body")),_(stylesheets).forEach(function(stylesheet){var $link,href;stylesheet.attr("href")&&(href=($link=$(stylesheet.render())).attr("href"),$link.removeAttr("href").attr("href",href),$link.one("load",informLoaded).appendTo($head))})},detach:function(
stylesheets){_(stylesheets).forEach(function(stylesheet){stylesheet.serial&&$('link[data-serial="'+stylesheet.serial+'"]').remove()})}}}),define("taoQtiItem/qtiCommonRenderer/helpers/patternMask",[],function(){"use strict";var regexChar=/\^\[\\s\\S\]\{\d+\,(\d+)\}\$/,regexWords=/\^\(\?\:\(\?\:\[\^\\s\\:\\!\\\?\\\;\\\…\\\€\]\+\)\[\\s\\:\\!\\\?\\;\\\…\\\€\]\*\)\{\d+\,(\d+)\}\$/;return{parsePattern:function(pattern,type){return null==pattern?null:"words"!==type?"chars"!==type?null:null!==(result=pattern.match(regexChar))&&1<result.length?result[1]:null:null!==(result=pattern.match(regexWords))&&1<result.length?result[1]:null;var result},
createMaxWordPattern:function(max){return"^(?:(?:[^\\s\\:\\!\\?\\;\\…\\€]+)[\\s\\:\\!\\?\\;\\…\\€]*){0,"+max.toString()+"}$"},createMaxCharPattern:function(max){return"^[\\s\\S]{0,"+max.toString()+"}$"}}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint",["lodash"],function(_){"use strict";var _formatters={boolean:function(value){return value?"true":"false"},integer:function(value){return value},float:function(value){return value},string:function(value){return""===value?"NULL":'"'+value+'"'},point:function(value){return"["+value[0]+", "+value[1]+"]"},pair:function(value){return"["+value[0]+", "+value[1]+"]"},directedPair:function(value){
return"["+value[0]+", "+value[1]+"]"},duration:function(value){return value},file:function(value){return"binary data"},uri:function(value){return value},intOrIdentifier:function(value){return value},identifier:function(value){return value}};return{printBase:function(value,withType){var print="",base=value.base;if(withType=void 0===withType||withType,base)return _.forIn(_formatters,function(formatter,baseType){if(void 0!==base[baseType])return print+=withType?"("+baseType+") ":"",print+=formatter(base[baseType]),!1}),print},printList:function(value,withType){var print="",list=value.list;if(withType=void 0===withType||withType,list)return _.forIn(_formatters,
function(formatter,baseType){if(void 0!==list[baseType])return print+=withType?"("+baseType+") ":"",print+="[",_.each(list[baseType],function(value){print+=formatter(value)+", "}),_.size(list[baseType])&&(print=print.substring(0,print.length-2)),print+="]",!1}),print},printRecord:function(value){return value&&value.record?"(record) "+JSON.stringify(value.record):""}}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciResponse",["lodash","taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint"],function(_,pciPrettyPrint){"use strict";var _qtiModelPciResponseCardinalities={single:"base",multiple:"list",ordered:"list",record:"record"};return{unserialize:function(
response,interaction){var mappedCardinality,ret=[],responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality");if(!_qtiModelPciResponseCardinalities[cardinality])throw"unknown cardinality in the responseDeclaration of the interaction";var responseValues=response[mappedCardinality=_qtiModelPciResponseCardinalities[cardinality]];if(null===responseValues)ret=[];else{if(!_.isObject(responseValues))throw"invalid response cardinality, expected "+cardinality+" ("+mappedCardinality+")";if(void 0===responseValues[baseType])throw"invalid response baseType"
;ret=responseValues[baseType],ret=_.isArray(ret)?ret:[ret]}return ret},serialize:function(responseValues,interaction){if(!_.isArray(responseValues))throw"invalid argument : responseValues must be an Array";var mappedCardinality,response={},responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality");if(responseValues=_.map(responseValues||[],function(v){return"boolean"===baseType?!0===v||"true"===v:v}),!_qtiModelPciResponseCardinalities[cardinality])throw"unknown cardinality in the responseDeclaration of the interaction";return"base"===(
mappedCardinality=_qtiModelPciResponseCardinalities[cardinality])?0===responseValues.length?response.base=null:(response.base={},response.base[baseType]=responseValues[0]):(response[mappedCardinality]={},response[mappedCardinality][baseType]=responseValues),response},isEmpty:function(response){return null===response||_.isEmpty(response)||null===response.base||_.isArray(response.list)&&_.isEmpty(response.list)||_.isArray(response.record)&&_.isEmpty(response.record)},prettyPrint:function(response){var print="";if(void 0!==response.base)print+=pciPrettyPrint.printBase(response,!0);else if(void 0!==response.list)print+=pciPrettyPrint.printList(response,!0);else{
if(void 0===response.record)throw"Not a valid PCI JSON Response";print+=pciPrettyPrint.printRecord(response,!0)}return print}}}),define("taoQtiItem/qtiCommonRenderer/helpers/PortableElement",["jquery"],function($){"use strict";var imgSrcPattern=/(<img[^>]*src=["'])([^"']+)(["'])/gi;return{fixMarkupMediaSources:function(html,renderer){return(html=html||"").replace(imgSrcPattern,function(substr,$1,$2,$3){return $1+(renderer.resolveUrl($2)||$2)+$3})}}}),define("taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter",["jquery","lodash","util/adaptSize","ui/waitForMedia"],function($,_,adaptSize,waitForMedia){"use strict";return{adaptSize:function(target){var $elements,
$container;switch(!0){case void 0!==target.$container:$elements=target.$container.find(".add-option, .result-area .target, .choice-area .qti-choice"),$container=target.$container;break;default:$container=$($elements=target).first().parent()}$container.waitForMedia(function(){adaptSize.height($elements),document.addEventListener("load",function(e){"stylesheet"===e.target.rel&&adaptSize.height($elements)},!0)})}}}),define("taoQtiItem/qtiCommonRenderer/helpers/uploadMime",["lodash","i18n"],function(_,__){"use strict";var uploadMime={getMimeTypes:function(){return[{mime:"application/zip",label:__("ZIP archive"),equivalent:["application/x-zip-compressed"]},{
mime:"text/plain",label:__("Plain text")},{mime:"application/pdf",label:__("PDF file")},{mime:"image/jpeg",label:__("JPEG image")},{mime:"image/png",label:__("PNG image")},{mime:"image/gif",label:__("GIF image")},{mime:"image/svg+xml",label:__("SVG image")},{mime:"audio/mpeg",label:__("MPEG audio"),equivalent:["audio/mp3"]},{mime:"audio/x-ms-wma",label:__("Windows Media audio")},{mime:"audio/x-wav",label:__("WAV audio"),equivalent:["audio/wav"]},{mime:"video/mpeg",label:__("MPEG video")},{mime:"video/mp4",label:__("MP4 video")},{mime:"video/quicktime",label:__("Quicktime video")},{mime:"video/x-ms-wmv",label:__("Windows Media video")},{mime:"video/x-flv",
label:__("Flash video")},{mime:"text/csv",label:__("CSV file")},{mime:"application/msword",label:__("Microsoft Word"),equivalent:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]},{mime:"application/vnd.ms-excel",label:__("Microsoft Excel"),equivalent:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]},{mime:"application/vnd.ms-powerpoint",label:__("Microsoft Powerpoint"),equivalent:["application/vnd.openxmlformats-officedocument.presentationml.presentation"]}]},setExpectedTypes:function(interaction,types){var classes=interaction.attr("class")||"";classes=classes.replace(/x-tao-upload-type-[-_a-zA-Z+.0-9]*/g,""
).trim(),interaction.attr("class",classes),interaction.removeAttr("type"),types&&(1===types.length?"any/kind"!==types[0]&&interaction.attr("type",types[0]):interaction.attr("class",_.reduce(types,function(acc,selectedType){return acc+" x-tao-upload-type-"+selectedType.replace("/","_")},classes).trim()))},getExpectedTypes:function(interaction,includeEquivalents){var mimes,classes=interaction.attr("class")||"",types=[],equivalents=[];return interaction.attr("type")?types.push(interaction.attr("type")):classes.replace(/x-tao-upload-type-([-_a-zA-Z+.0-9]*)/g,function($0,type){types.push(type.replace("_","/").trim())}),!0===includeEquivalents&&(
mimes=uploadMime.getMimeTypes(),_.forEach(types,function(mime){var mimeData=_.find(mimes,{mime:mime});mimeData&&_.isArray(mimeData.equivalent)&&(equivalents=_.union(equivalents,mimeData.equivalent))})),_.union(types,equivalents)}};return uploadMime}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression
;return buffer+='<span class="qti-choice qti-gap" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer=""
;return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='>\r\n    <span data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" class="gapmatch-content">&nbsp;</span>\r\n</span>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap","taoQtiItem/qtiCommonRenderer/helpers/container"],function(
tpl,containerHelper){"use strict";return{qtiClass:"gap",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<li class="qti-choice qti-gapImg selectable" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier
)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),
data:data}))||0===stack1)&&(buffer+=stack1),buffer+='>\n    <img src="'+escapeExpression(typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.object)||!1===stack1?stack1:stack1.attributes)||!1===stack1?stack1:stack1.data)===functionType?stack1.apply(depth0):stack1)+'" \n         width="'+escapeExpression(typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.object)||!1===stack1?stack1:stack1.attributes)||!1===stack1?stack1:stack1.width)===functionType?stack1.apply(depth0):stack1)+'"\n         height="'+escapeExpression(typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.object)||!1===stack1?stack1:stack1.attributes
)||!1===stack1?stack1:stack1.height)===functionType?stack1.apply(depth0):stack1)+'"\n         ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.objectLabel,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+='alt="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.objetLabel)===functionType?stack1.apply(depth0):stack1)+'" '},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    />\n</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",[
"tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"gapImg",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<li class="qti-choice" data-identifier="'+escapeExpression(typeof(stack1=null==(
stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes
)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="\n</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"gapText",getContainer:containerHelper.get,template:tpl}}
),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="qti-choice qti-hottext hottext" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},
data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='>\r\n    <label class="hottext-checkmark">\r\n        <input type="checkbox" value="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'">\r\n        <span class="icon-checkbox small"></span>\r\n    </label>\r\n    <span class="hottext-content">',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</span>\r\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",[
"tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"hottext",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<option data-identifier="'+escapeExpression(typeof(stack1=null==(
stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" value="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,
function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"\n</option>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice",
"taoQtiItem/qtiCommonRenderer/helpers/container"],function(_,tpl,containerHelper){"use strict";return{qtiClass:"inlineChoice",getContainer:containerHelper.get,template:tpl,getData:function(choice,data){return data.body=_.unescape(data.body),data}}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleAssociableChoice.associateInteraction",getContainer:containerHelper.get,template:tpl}}),define(
"tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<th class="qti-choice qti-associableChoice qti-simpleAssociableChoice" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(
helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=(
helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="\n</th>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleAssociableChoice.matchInteraction",getContainer:containerHelper.get,template:tpl}}),define(
"tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<li class="qti-choice qti-simpleChoice" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(
helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='>\n    <div class="pseudo-label-box">\n        <label class="real-label">\n            ',((stack1=helpers.if.call(depth0,depth0&&depth0.unique,{hash:{},inverse:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+='\n            <input type="checkbox" name="response-'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.interaction)||!1===stack1?stack1:stack1.serial)===functionType?stack1.apply(depth0):stack1)+'" value="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1
)+'" tabindex="1">\n            <span class="icon-checkbox"></span>\n            '},data),fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+='\n            <input type="radio" name="response-'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.interaction)||!1===stack1?stack1:stack1.serial)===functionType?stack1.apply(depth0):stack1)+'" value="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'" tabindex="1">\n            <span class="icon-radio"></span>\n            '},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='\n        </label>\n        <div class="label-box">\n            <div class="label-content clear" contenteditable="false">\n                ',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),
buffer+='\n                <svg class="overlay-answer-eliminator">\n                    <line x1="0" y1="100%" x2="100%" y2="0"/>\n                    <line x1="0" y1="0" x2="100%" y2="100%"/>\n                </svg>\n            </div>\n        </div>\n    </div>\n    <label data-eliminable="container" data-label="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Eliminate",options):helperMissing.call(depth0,"__","Eliminate",options)))+'">\n        <span data-eliminable="trigger" class="icon-checkbox"></span>\n    </label>\n</li>\n'})}),define(
"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleChoice.choiceInteraction",getContainer:containerHelper.get,getData:function(choice,data){return data.unique=1===parseInt(data.interaction.attributes.maxChoices),data},template:tpl}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,
containerHelper){"use strict";return{qtiClass:"simpleChoice.orderInteraction",getContainer:containerHelper.get,template:tpl}}),define("taoQtiItem/portableElementRegistry/factory/factory",["lodash","core/promise","core/eventifier"],function(_,Promise,eventifier){"use strict";var _requirejs=window.require,_defaultLoadingOptions={reload:!1},isPortableElementProvider=function(provider){return provider&&_.isFunction(provider.load)};return function(methods){var _loaded=!1,__providers={};return eventifier(_.defaults(methods||{},{_registry:{},get:function(typeIdentifier,version){if(this._registry[typeIdentifier])return version?_.find(this._registry[typeIdentifier],{
version:version}):_.last(this._registry[typeIdentifier])},registerProvider:function(moduleName,provider){return __providers[moduleName]=isPortableElementProvider(provider)?provider:null,_loaded=!1,this},resetProviders:function(){return _loaded=!(__providers={}),this},loadProviders:function(options){var self=this;return _loaded&&!options.reload?Promise.resolve([]):new Promise(function(resolve,reject){var providerLoadingStack=[];_.forIn(__providers,function(provider,id){null===provider&&providerLoadingStack.push(id)}),_requirejs(providerLoadingStack,function(){_.each([].slice.call(arguments),function(provider){isPortableElementProvider(provider)&&(
__providers[providerLoadingStack.shift()]=provider)}),resolve(__providers),_loaded=!0,self.trigger("providersloaded",__providers)},reject)})},getAllVersions:function(){var all={};return _.forIn(this._registry,function(versions,id){all[id]=_.map(versions,"version")}),all},getRuntime:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);if(portableElement)return _.assign(portableElement.runtime,{id:portableElement.typeIdentifier,label:portableElement.label,baseUrl:portableElement.baseUrl,model:portableElement.model});this.trigger("error",{message:"no portable element runtime found",typeIdentifier:typeIdentifier,version:version})
},getCreator:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);if(portableElement&&portableElement.creator)return _.assign(portableElement.creator,{id:portableElement.typeIdentifier,label:portableElement.label,baseUrl:portableElement.baseUrl,response:portableElement.response,model:portableElement.model,xmlns:portableElement.xmlns});this.trigger("error",{message:"no portable element runtime found",typeIdentifier:typeIdentifier,version:version})},getLatestCreators:function(){var all={};return _.forIn(this._registry,function(versions,id){var lastVersion=_.last(versions)
;lastVersion.creator&&lastVersion.creator.hook&&lastVersion.enabled&&(all[id]=lastVersion)}),all},getBaseUrl:function(typeIdentifier,version){var runtime=this.get(typeIdentifier,version);return runtime?runtime.baseUrl:""},loadRuntimes:function(options){var loadPromise,self=this;return options=_.defaults(options||{},_defaultLoadingOptions),(loadPromise=self.loadProviders(options).then(function(providers){var loadStack=[];return _.forEach(providers,function(provider){provider&&loadStack.push(provider.load())}),Promise.all(loadStack).then(function(results){var configLoadingStack=[];return self._registry=_.reduce(results,function(acc,_pcis){return _.merge(acc,
_pcis)},self._registry||{}),_.forIn(self._registry,function(versions,typeIdentifier){if(_.isArray(options.include)&&_.indexOf(options.include,typeIdentifier)<0)return!0;var manifest;configLoadingStack.push((manifest=self.get(typeIdentifier),new Promise(function(resolve,reject){var baseUrl,requireConfigAliases={},reqConfigs=[],modules={};if(!manifest||!manifest.runtime)return reject("invalid manifest");baseUrl=manifest.baseUrl,_.isArray(manifest.runtime.config)&&manifest.runtime.config.length&&_.forEach(manifest.runtime.config,function(pciConfig){_.isString(pciConfig)?reqConfigs.push("json!"+baseUrl+"/"+pciConfig):pciConfig.data?modules=_.defaults(modules,
pciConfig.data.paths||{}):pciConfig.file&&reqConfigs.push("json!"+baseUrl+"/"+pciConfig.file)}),require(reqConfigs,function(){var runtimeModules={};requireConfigAliases[manifest.typeIdentifier]=baseUrl,"IMSPCI"===manifest.model&&(modules=_.reduce(arguments,function(acc,conf){return _.defaults(acc,conf.paths||{})},modules),_.forEach(manifest.runtime.modules||{},function(paths,id){paths&&(_.isString(paths)||_.isArray(paths)&&paths.length)&&(runtimeModules[id]=paths)}),modules=_.merge(modules,runtimeModules),_.forEach(modules,function(paths,id){paths=_.isArray(paths)?paths:[paths],requireConfigAliases[id]=_.map(paths,function(path){
return baseUrl+"/"+path.replace(/\.js$/,"")})})),resolve(requireConfigAliases)},reject)})))}),Promise.all(configLoadingStack).then(function(moduleConfigs){var requireConfigAliases=_.reduce(moduleConfigs,function(acc,paths){return _.merge(acc,paths)},{});_requirejs.config({paths:requireConfigAliases})})})})).then(function(){self.trigger("runtimesloaded")}).catch(function(err){self.trigger("error",err)}),loadPromise},loadCreators:function(options){var loadPromise,self=this;return options=_.defaults(options||{},_defaultLoadingOptions),(loadPromise=self.loadRuntimes(options).then(function(){var requiredCreatorHooks=[];return _.forIn(self._registry,function(
versions,typeIdentifier){var portableElementModel=self.get(typeIdentifier);if(portableElementModel.creator&&portableElementModel.creator.hook){if(portableElementModel.enabled){if(_.isArray(options.include)&&_.indexOf(options.include,typeIdentifier)<0)return!0}else if(!_.isArray(options.include)||_.indexOf(options.include,typeIdentifier)<0)return!0;requiredCreatorHooks.push(portableElementModel.creator.hook.replace(/\.js$/,""))}}),requiredCreatorHooks.length?new Promise(function(resolve,reject){_requirejs(requiredCreatorHooks,function(){var creators={};_.each(arguments,function(creatorHook){var id=creatorHook.getTypeIdentifier(),portableElementModel=self.get(
id),i=_.findIndex(self._registry[id],{version:portableElementModel.version});i<0?self.trigger("error","no creator found for id/version "+id+"/"+portableElementModel.version):(self._registry[id][i].creator.module=creatorHook,creators[id]=creatorHook)}),resolve(creators)},reject)}):Promise.resolve({})})).then(function(creators){return self.trigger("creatorsloaded",creators),creators}).catch(function(err){self.trigger("error",err)}),loadPromise},enable:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&(portableElement.enabled=!0),this},disable:function(typeIdentifier,version){
var portableElement=this.get(typeIdentifier,version);return portableElement&&(portableElement.enabled=!1),this},isEnabled:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&!0===portableElement.enabled}}))}}),define("taoQtiItem/qtiCreator/helper/qtiElements",["jquery","lodash","i18n"],function($,_,__){"use strict";var QtiElements={classes:{itemBody:{parents:["bodyElement"],contains:["block"],abstract:!0},atomicBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["inline"],abstract:!0},atomicInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],abstract:!0},
simpleBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["block"],abstract:!0},simpleInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],abstract:!0},flowStatic:{parents:["flow"],abstract:!0},blockStatic:{parents:["block"],abstract:!0},inlineStatic:{parents:["inline"],abstract:!0},flow:{parents:["objectFlow"],abstract:!0},tableCell:{parents:["bodyElement"],contains:["flow"],abstract:!0},caption:{parents:["bodyElement"],contains:["inline"],xhtml:!0},col:{parents:["bodyElement"],xhtml:!0},colgroup:{parents:["bodyElement"],contains:["col"],xhtml:!0},div:{parents:["blockStatic","bodyElement","flowStatic"],contains:[
"flow"],xhtml:!0},dl:{parents:["blockStatic","bodyElement","flowStatic"],contains:["dlElement"],xhtml:!0},dt:{parents:["dlElement"],contains:["inline"],xhtml:!0},dd:{parents:["dlElement"],contains:["flow"],xhtml:!0},hr:{parents:["blockStatic","bodyElement","flowStatic"],xhtml:!0},math:{parents:["blockStatic","flowStatic","inlineStatic"],xhtml:!0},li:{parents:["bodyElement"],contains:["flow"],xhtml:!0},ol:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},ul:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},object:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["objectFlow"],xhtml:!0},
param:{parents:["objectFlow"],xhtml:!0},table:{parents:["blockStatic","bodyElement","flowStatic"],contains:["caption","col","colgroup","thead","tfoot","tbody"],xhtml:!0},tbody:{parents:["bodyElement"],contains:["tr"],xhtml:!0},tfoot:{parents:["bodyElement"],contains:["tr"],xhtml:!0},thead:{parents:["bodyElement"],contains:["tr"],xhtml:!0},td:{parents:["tableCell"],xhtml:!0},th:{parents:["tableCell"],xhtml:!0},tr:{parents:["bodyElement"],contains:["tableCell"],xhtml:!0},a:{parents:["simpleInline"],xhtml:!0},abbr:{parents:["simpleInline"],xhtml:!0},acronym:{parents:["simpleInline"],xhtml:!0},b:{parents:["simpleInline"],xhtml:!0},big:{parents:["simpleInline"],
xhtml:!0},cite:{parents:["simpleInline"],xhtml:!0},code:{parents:["simpleInline"],xhtml:!0},dfn:{parents:["simpleInline"],xhtml:!0},em:{parents:["simpleInline"],xhtml:!0},i:{parents:["simpleInline"],xhtml:!0},kbd:{parents:["simpleInline"],xhtml:!0},q:{parents:["simpleInline"],xhtml:!0},samp:{parents:["simpleInline"],xhtml:!0},small:{parents:["simpleInline"],xhtml:!0},span:{parents:["simpleInline"],xhtml:!0},strong:{parents:["simpleInline"],xhtml:!0},sub:{parents:["simpleInline"],xhtml:!0},sup:{parents:["simpleInline"],xhtml:!0},tt:{parents:["simpleInline"],xhtml:!0},var:{parents:["simpleInline"],xhtml:!0},blockquote:{parents:["simpleBlock"],xhtml:!0},
address:{parents:["atomicBlock"],xhtml:!0},h1:{parents:["atomicBlock"],xhtml:!0},h2:{parents:["atomicBlock"],xhtml:!0},h3:{parents:["atomicBlock"],xhtml:!0},h4:{parents:["atomicBlock"],xhtml:!0},h5:{parents:["atomicBlock"],xhtml:!0},h6:{parents:["atomicBlock"],xhtml:!0},p:{parents:["atomicBlock"],xhtml:!0},pre:{parents:["atomicBlock"],xhtml:!0},img:{parents:["atomicInline"],xhtml:!0,attributes:["src","alt","longdesc","height","width"]},br:{parents:["atomicInline"],xhtml:!0},infoControl:{parents:["blockStatic","bodyElement","flowStatic"],qti:!0},textRun:{parents:["inlineStatic","flowstatic"],qti:!0},feedbackInline:{parents:["simpleInline","feedbackElement"],
qti:!0},feedbackBlock:{parents:["simpleBlock"],qti:!0},rubricBlock:{parents:["simpleBlock"],qti:!0},blockInteraction:{parents:["block","flow","interaction"],qti:!0},inlineInteraction:{parents:["inline","flow","interaction"],qti:!0},gap:{parents:["inlineStatic"],qti:!0},hottext:{parents:["flowstatic","inlineStatic"],contains:["inlineStatic"],qti:!0},printedVariable:{parents:["bodyElement","flowStatic","inlineStatic","textOrVariable"],qti:!0},prompt:{parents:["bodyElement"],contains:["inlineStatic"],qti:!0},templateElement:{parents:["bodyElement"],qti:!0},templateBlock:{parents:["blockStatic","flowStatic","templateElement"],contains:["blockStatic"],qti:!0},
templateInline:{parents:["inlineStatic","flowStatic","templateElement"],contains:["inlineStatic"],qti:!0},choiceInteraction:{parents:["blockInteraction"],qti:!0},associateInteraction:{parents:["blockInteraction"],qti:!0},orderInteraction:{parents:["blockInteraction"],qti:!0},matchInteraction:{parents:["blockInteraction"],qti:!0},hottextInteraction:{parents:["blockInteraction"],qti:!0},gapMatchInteraction:{parents:["blockInteraction"],qti:!0},mediaInteraction:{parents:["blockInteraction"],qti:!0},sliderInteraction:{parents:["blockInteraction"],qti:!0},uploadInteraction:{parents:["blockInteraction"],qti:!0},drawingInteraction:{parents:["blockInteraction"],
qti:!0},graphicInteraction:{parents:["blockInteraction"],qti:!0},hotspotInteraction:{parents:["graphicInteraction"],qti:!0},graphicAssociateInteraction:{parents:["graphicInteraction"],qti:!0},graphicOrderInteraction:{parents:["graphicInteraction"],qti:!0},graphicGapMatchInteraction:{parents:["graphicInteraction"],qti:!0},selectPointInteraction:{parents:["graphicInteraction"],qti:!0},textEntryInteraction:{parents:["stringInteraction","inlineInteraction"],qti:!0},extendedTextInteraction:{parents:["stringInteraction","blockInteraction"],qti:!0},inlineChoiceInteraction:{parents:["inlineInteraction"],qti:!0},endAttemptInteraction:{parents:["inlineInteraction"],
qti:!0},customInteraction:{parents:["block","flow","interaction"],qti:!0},_container:{parents:["block"],qti:!0}},cache:{containable:{},children:{},parents:{}},getAllowedContainersElements:function(qtiClass,$container){var classes=QtiElements.getAllowedContainers(qtiClass),jqSelector="";for(var i in classes)classes[i].qti||(jqSelector+=classes[i]+", ");return jqSelector&&(jqSelector=jqSelector.substring(0,jqSelector.length-2)),$(jqSelector,$container||$(document)).filter(":not([data-qti-type])")},getAllowedContainers:function(qtiClass){var ret;if(QtiElements.cache.containable[qtiClass])ret=QtiElements.cache.containable[qtiClass];else{ret=[]
;var parents=QtiElements.getParentClasses(qtiClass,!0);for(var aClass in QtiElements.classes){var model=QtiElements.classes[aClass];if(model.contains)_.intersection(model.contains,parents).length&&(model.abstract||ret.push(aClass),ret=_.union(ret,QtiElements.getChildClasses(aClass,!0)))}QtiElements.cache.containable[qtiClass]=ret}return ret},getAllowedContents:function(qtiClass,recursive,checked){var ret=[];checked=checked||{};var model=QtiElements.classes[qtiClass];if(model&&model.contains)for(var i in model.contains){var contain=model.contains[i];if(!checked[contain]){checked[contain]=!0,ret.push(contain);var children=QtiElements.getChildClasses(contain,!0
);for(var i in children){var child=children[i];checked[child]||(checked[child]=!0,ret.push(child),recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(child,!0,checked))))}recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(contain,!0,checked)))}}var parents=QtiElements.getParentClasses(qtiClass,!0);for(var i in parents)ret=_.union(ret,QtiElements.getAllowedContents(parents[i],recursive,checked));return _.uniq(ret,!1)},isAllowedClass:function(qtiContainerClass,qtiContentClass){var allowedClasses=QtiElements.getAllowedContents(qtiContainerClass);return 0<=_.indexOf(allowedClasses,qtiContentClass)},getParentClasses:function(qtiClass,recursive){
var ret;if(recursive&&QtiElements.cache.parents[qtiClass])ret=QtiElements.cache.parents[qtiClass];else{if(ret=[],QtiElements.classes[qtiClass]&&(ret=QtiElements.classes[qtiClass].parents,recursive)){for(var i in ret)ret=_.union(ret,QtiElements.getParentClasses(ret[i],recursive));ret=_.uniq(ret,!1)}QtiElements.cache.parents[qtiClass]=ret}return ret},getChildClasses:function(qtiClass,recursive,type){var ret,cacheType=type||"all";if(recursive&&QtiElements.cache.children[qtiClass]&&QtiElements.cache.children[qtiClass][cacheType])ret=QtiElements.cache.children[qtiClass][cacheType];else{for(var aClass in ret=[],QtiElements.classes){
var model=QtiElements.classes[aClass];0<=_.indexOf(model.parents,qtiClass)&&(type?model[type]&&ret.push(aClass):ret.push(aClass),recursive&&(ret=_.union(ret,QtiElements.getChildClasses(aClass,recursive,type))))}QtiElements.cache.children[qtiClass]||(QtiElements.cache.children[qtiClass]={}),QtiElements.cache.children[qtiClass][cacheType]=ret}return ret},isBlock:function(qtiClass){return QtiElements.is(qtiClass,"block")},isInline:function(qtiClass){return QtiElements.is(qtiClass,"inline")},is:function(qtiClass,topClass){if(qtiClass===topClass)return!0;var parents=QtiElements.getParentClasses(qtiClass,!0);return 0<=_.indexOf(parents,topClass)},
getAvailableAuthoringElements:function(){return{choiceInteraction:{label:__("Choice Interaction"),description:__("Select a single (radio buttons) or multiple (check boxes) responses among a set of choices."),icon:"icon-choice",short:__("Choice"),qtiClass:"choiceInteraction",tags:["Common Interactions","mcq"]},orderInteraction:{label:__("Order Interaction"),icon:"icon-order",description:__("Arrange a list of choices in the correct order."),short:__("Order"),qtiClass:"orderInteraction",tags:["Common Interactions","ordering"]},associateInteraction:{label:__("Associate Interaction"),icon:"icon-associate",description:__("Create pair(s) from a series of choices."
),short:__("Associate"),qtiClass:"associateInteraction",tags:["Common Interactions","association"]},matchInteraction:{label:__("Match Interaction"),icon:"icon-match",description:__("Create association(s) between two sets of choices displayed in a table (row and column)."),short:__("Match"),qtiClass:"matchInteraction",tags:["Common Interactions","association"]},hottextInteraction:{label:__("Hottext Interaction"),icon:"icon-hottext",description:__("Select one or more text parts (hottext) within a text."),short:__("Hottext"),qtiClass:"hottextInteraction",tags:["Common Interactions","text"]},gapMatchInteraction:{label:__("Gap Match Interaction"),
icon:"icon-gap-match",description:__(" Fill in the gaps in a text from a set of choices."),short:__("Gap Match"),qtiClass:"gapMatchInteraction",tags:["Common Interactions","text","association"]},sliderInteraction:{label:__("Slider Interaction"),icon:"icon-slider",description:__("Select a value within a numerical range."),short:__("Slider"),qtiClass:"sliderInteraction",tags:["Common Interactions","special"]},extendedTextInteraction:{label:__("Extended Text Interaction"),icon:"icon-extended-text",description:__("Collect open-ended information in one or more text area(s) (strings or numeric values)."),short:__("Extended Text"),
qtiClass:"extendedTextInteraction",tags:["Common Interactions","text"]},uploadInteraction:{label:__("File Upload Interaction"),icon:"icon-upload",description:__("Upload a file (e.g. document, picture...) as a response."),short:__("File Upload"),qtiClass:"uploadInteraction",tags:["Common Interactions","special"]},mediaInteraction:{label:__("Media Interaction"),icon:"icon-media",description:__("Control the playing parameters (auto-start, loop) of a video or audio file and report the number of time it has been played."),short:__("Media"),qtiClass:"mediaInteraction",tags:["Common Interactions","media"]},_container:{label:__("Text Block"),icon:"icon-font",
description:__("Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions."),short:__("Block"),qtiClass:"_container",tags:["Inline Interactions","text"]},inlineChoiceInteraction:{label:__("Inline Choice Interaction"),icon:"icon-inline-choice",description:__("Select a choice from a drop-down list."),short:__("Inline Choice"),qtiClass:"inlineChoiceInteraction",tags:["Inline Interactions","inline-interactions","mcq"]},textEntryInteraction:{label:__("Text Entry Interaction"),icon:"icon-text-entry",description:__("Collect open-ended information in a short text input (strings or numeric values)."),
short:__("Text Entry"),qtiClass:"textEntryInteraction",tags:["Inline Interactions","inline-interactions","text"]},endAttemptInteraction:{label:__("End Attempt Interaction"),icon:"icon-end-attempt",description:__("Trigger the end of the item attempt."),short:__("End Attempt"),qtiClass:"endAttemptInteraction",tags:["Inline Interactions","inline-interactions","button","submit"]},hotspotInteraction:{label:__("Hotspot Interaction"),icon:"icon-hotspot",description:__("Select one or more areas (hotspots) displayed on an picture."),short:__("Hotspot"),qtiClass:"hotspotInteraction",tags:["Graphic Interactions","mcq"]},graphicOrderInteraction:{label:__(
"Graphic Order Interaction"),icon:"icon-graphic-order",description:__("Order the areas (hotspots) displayed on a picture."),short:__("Order"),qtiClass:"graphicOrderInteraction",tags:["Graphic Interactions","ordering"]},graphicAssociateInteraction:{label:__("Graphic Associate Interaction"),icon:"icon-graphic-associate",description:__("Create association(s) between areas (hotspots) displayed on a picture."),short:__("Associate"),qtiClass:"graphicAssociateInteraction",tags:["Graphic Interactions","association"]},graphicGapMatchInteraction:{label:__("Graphic Gap Match Interaction"),icon:"icon-graphic-gap",description:__(
"Fill in the gaps on a picture with a set of image choices."),short:__("Gap Match"),qtiClass:"graphicGapMatchInteraction",tags:["Graphic Interactions","association"]},selectPointInteraction:{label:__("Select Point Interaction"),icon:"icon-select-point",description:__("Position one or more points on a picture (response areas are not displayed)."),short:__("Select Point"),qtiClass:"selectPointInteraction",tags:["Graphic Interactions"]}}}};return QtiElements}),define("taoQtiItem/portableElementRegistry/factory/ciRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/factory","taoQtiItem/qtiCreator/helper/qtiElements"],function(_,portableElementRegistry
,qtiElements){"use strict";return function(){return portableElementRegistry({getAuthoringData:function(typeIdentifier,options){var pciModel;if(options=_.defaults(options||{},{version:0,enabledOnly:!1}),(pciModel=this.get(typeIdentifier,options.version))&&pciModel.creator&&pciModel.creator.hook&&pciModel.creator.icon&&(pciModel.enabled||!options.enabledOnly))return{label:pciModel.label,icon:pciModel.creator.icon.replace(new RegExp("^"+typeIdentifier+"/"),pciModel.baseUrl),short:pciModel.short,description:pciModel.description,qtiClass:"customInteraction."+pciModel.typeIdentifier,tags:_.union(["Custom Interactions"],pciModel.tags)}}}).on("creatorsloaded",
function(){var creators=this.getLatestCreators();_.forEach(creators,function(creator,typeIdentifier){qtiElements.classes["customInteraction."+typeIdentifier]={parents:["customInteraction"],qti:!0}})})}}),define("taoQtiItem/portableElementRegistry/ciRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/ciRegistry","module"],function(_,ciRegistry,module){"use strict";var registry=ciRegistry(),providers=[],config=module.config();return config&&config.providers&&(providers=config.providers),_.each(providers,function(provider){provider.name&&provider.module&&registry.registerProvider(provider.module)}),registry}),define(
"taoQtiItem/portableElementRegistry/factory/icRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/factory"],function(_,portableElementRegistry){"use strict";return function(){return portableElementRegistry()}}),define("taoQtiItem/portableElementRegistry/icRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/icRegistry","module"],function(_,icRegistry,module){"use strict";var registry=icRegistry(),providers=[],config=module.config();return config&&config.providers&&(providers=config.providers),_.each(providers,function(provider){provider.name&&provider.module&&registry.registerProvider(provider.module)}),registry}),define(
"taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy",["taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/portableElementRegistry/icRegistry"],function(ciRegistry,icRegistry){"use strict";function getBaseUrlByIdentifier(typeIdentifier){return ciRegistry.get(typeIdentifier)?ciRegistry.getBaseUrl(typeIdentifier):icRegistry.get(typeIdentifier)?icRegistry.getBaseUrl(typeIdentifier):typeIdentifier}return{name:"portableElementLocation",handle:function(url){return url.file===url.path?getBaseUrlByIdentifier(url.file):url.source===url.relative?url.relative.replace(/^(\.\/)?([a-z_0-9]+)\/(.*)/i,function(fullmatch,$1,typeIdentifier,relPath){
var runtimeLocation=getBaseUrlByIdentifier(typeIdentifier);return runtimeLocation?runtimeLocation+"/"+relPath:fullmatch}):void 0}}}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","context","ui/themes","taoItems/assets/manager","taoItems/assets/strategies","module","taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy"],function(_,context,themes,assetManagerFactory,assetStrategies,module,portableAssetStrategy){"use strict";var itemThemes=themes.get("items"),moduleConfig=module.config();return{name:"commonRenderer",locations:{assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",
_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,_tooltip:"taoQtiItem/qtiCommonRenderer/renderers/Tooltip",stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",outcomeDeclaration:!1,responseDeclaration:!1,responseProcessing:!1,img:"taoQtiItem/qtiCommonRenderer/renderers/Img",math:"taoQtiItem/qtiCommonRenderer/renderers/Math",object:"taoQtiItem/qtiCommonRenderer/renderers/Object",table:"taoQtiItem/qtiCommonRenderer/renderers/Table",printedVariable:"taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",
modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",
textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",
gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",hotspotChoice:!1,
gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",
graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",associableHotspot:!1,customInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",infoControl:"taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiCommonRenderer/renderers/Include",endAttemptInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction"},options:{assetManager:assetManagerFactory([{name:"theme",handle:function(url){if(itemThemes&&url.path&&(url.path===itemThemes.base||_.contains(_.pluck(itemThemes.available,"path"),url.path))
)return context.root_url+url.toString()}},assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.itemCssNoCache,assetStrategies.baseUrl,portableAssetStrategy],{baseUrl:""}),themes:itemThemes,enableDragAndDrop:{associate:!!moduleConfig.associateDragAndDrop,gapMatch:!!moduleConfig.gapMatchDragAndDrop,graphicGapMatch:!!moduleConfig.graphicGapMatchDragAndDrop,order:!!moduleConfig.orderDragAndDrop},messages:moduleConfig.messages}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/container",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;function program2(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'}return helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(4,function(depth0,data){var stack1,helper,buffer="";return((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer},data),fn:self.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="qti-block"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">",((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(
buffer+=stack1),buffer+="</div>"},data),data:data},(stack1=helper?helper.call(depth0,depth0&&depth0.contentModel,"blockStatic",options):helperMissing.call(depth0,"equal",depth0&&depth0.contentModel,"blockStatic",options))||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Container",["tpl!taoQtiItem/qtiCommonRenderer/tpl/container"],function(tpl){"use strict";return{qtiClass:"_container",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/img",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<img \n    data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" \n    data-qti-class="img" \n    src="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.src)===functionType?stack1.apply(depth0):stack1)+'" \n    alt="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.alt
)===functionType?stack1.apply(depth0):stack1)+'" \n    ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){
var stack1,buffer="";return buffer+='class="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.height,{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+='height="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.height)===functionType?stack1.apply(depth0):stack1)+'" '},data),data:data})
)||0===stack1)&&(buffer+=stack1),buffer+="\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.width,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,buffer="";return buffer+='width="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.width)===functionType?stack1.apply(depth0):stack1)+'" '},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(9,function(depth0,
data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    style="',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.height,{hash:{},inverse:this.noop,fn:this.program(11,function(depth0,data){var stack1,buffer="";return buffer+="height: "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.height)===functionType?stack1.apply(depth0):stack1)+"px; "
},data),data:data}))||0===stack1)&&(buffer+=stack1),((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.width,{hash:{},inverse:this.noop,fn:this.program(13,function(depth0,data){var stack1,buffer="";return buffer+="width: "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.width)===functionType?stack1.apply(depth0):stack1)+"px; "},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"\n    />'})}),define("taoQtiItem/qtiCommonRenderer/renderers/Img",["core/promise","ui/waitForMedia","tpl!taoQtiItem/qtiCommonRenderer/tpl/img",
"taoQtiItem/qtiCommonRenderer/helpers/container"],function(Promise,waitForMedia,tpl,containerHelper){"use strict";return{qtiClass:"img",template:tpl,getContainer:containerHelper.get,render:function(img,data){return new Promise(function(resolve,reject){containerHelper.get(img).waitForMedia(resolve)})}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helper;return(stack1=(helper=(helpers=this.merge(helpers,Handlebars.helpers)).body)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(
helper=depth0&&depth0.body)?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Include",["tpl!taoQtiItem/qtiCommonRenderer/tpl/include"],function(tpl){"use strict";return{qtiClass:"include",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,
blockHelperMissing=helpers.blockHelperMissing;function program9(depth0,data){var stack1;return(stack1=typeof depth0===functionType?depth0.apply(depth0):depth0)||0===stack1?stack1:""}return buffer+="<div\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='\n    class="qti-interaction qti-blockInteraction qti-associateInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"\n    data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(
depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"\n    data-qti-class="associateInteraction"\n    ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,
fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <ul class="choice-area clearfix  none block-listing solid horizontal source">\n        ',options={hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data},stack1=(helper=helpers.choices)?helper.call(depth0,options):typeof(helper=depth0&&depth0.choices)===functionType?helper.call(
depth0,options):helper,helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </ul>\n    <ul class="result-area none target clearfix">\n    </ul>\n    <div class="notification-container"></div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",
escapeExpression=this.escapeExpression;return buffer+='<li class="',((stack1=helpers.if.call(depth0,depth0&&depth0.empty,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){return"incomplete-pair"},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data
),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="target lft"></div>\n    <div class="target rgt"></div>\n</li>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","interact",
"ui/interactUtils"],function($,_,__,Promise,tpl,pairTpl,containerHelper,instructionMgr,pciResponse,sizeAdapter,interact,interactUtils){"use strict";var setChoice=function(interaction,$choice,$target){var $container=containerHelper.get(interaction),choiceSerial=$choice.data("serial"),usage=$choice.data("usage")||0,choice=interaction.getChoice(choiceSerial);if(!choiceSerial)throw"empty choice serial";usage++,$choice.data("usage",usage);var _setChoice=function(){$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&usage>=choice.attr("matchMax")&&$choice.addClass("deactivated")}
;if($target.siblings("div").hasClass("filled")){var $resultArea=$(".result-area",$container),$pair=$target.parent(),thisPairSerial=[$target.siblings("div").data("serial"),choiceSerial],$otherRepeatedPair=$();$resultArea.children().not($pair).each(function(){var $otherPair=$(this).children(".filled");if(2===$otherPair.length){var otherPairSerial=[$($otherPair[0]).data("serial"),$($otherPair[1]).data("serial")];if(2===_.intersection(thisPairSerial,otherPairSerial).length)return $otherRepeatedPair=$otherPair,!1}}),0===$otherRepeatedPair.length?(_setChoice(),containerHelper.triggerResponseChangeEvent(interaction,{type:"added",$pair:$pair,choices:thisPairSerial})
,instructionMgr.validateInstructions(interaction,{choice:$choice,target:$target}),(interaction.responseMappingMode||0===parseInt(interaction.attr("maxAssociations")))&&($pair.removeClass("incomplete-pair"),$resultArea.children(".incomplete-pair").length||($resultArea.append(pairTpl({empty:!0})),$resultArea.children(".incomplete-pair").fadeIn(600,function(){$(this).show()})))):($otherRepeatedPair.css("border","1px solid orange"),$target.html(__("identical pair already exists")).css({color:"orange",border:"1px solid orange"}),setTimeout(function(){$otherRepeatedPair.removeAttr("style"),$target.empty().css({color:"",border:""})},2e3))}else _setChoice()},
unsetChoice=function(interaction,$filledChoice,animate,triggerChange){var $container=containerHelper.get(interaction),choiceSerial=$filledChoice.data("serial"),$choice=$container.find(".choice-area [data-serial="+choiceSerial+"]"),usage=$choice.data("usage")||0,$parent=$filledChoice.parent(),$sibling=$container.find(".choice-area [data-serial="+$filledChoice.siblings(".target").data("serial")+"]");usage--,$choice.data("usage",usage).removeClass("deactivated"),$filledChoice.removeClass("filled").removeData("serial").empty(),interaction.swapping||(!1!==triggerChange&&(containerHelper.triggerResponseChangeEvent(interaction,{type:"removed",
$pair:$filledChoice.parent()}),instructionMgr.validateInstructions(interaction,{choice:$choice})),$sibling.data("usage",$sibling.data("usage")-1).removeClass("deactivated"),$choice.siblings("div").hasClass("filled")||0!==parseInt(interaction.attr("maxAssociations"))&&!interaction.responseMappingMode||$parent.hasClass("incomplete-pair")||(animate?$parent.addClass("removing").fadeOut(500,function(){$(this).remove()}):$parent.remove()))},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction),choice=interaction.getChoiceByIdentifier(identifier);if(!choice)throw new Error("cannot find a choice with the identifier : "+identifier
);return $(".choice-area [data-serial="+choice.getSerial()+"]",$container)},renderEmptyPairs=function(interaction){var $container=containerHelper.get(interaction),max=parseInt(interaction.attr("maxAssociations")),$resultArea=$(".result-area",$container);if(interaction.responseMappingMode||0===max)$resultArea.append(pairTpl({empty:!0})),$resultArea.children(".incomplete-pair").show();else for(var i=0;i<max;i++)$resultArea.append(pairTpl())},_setInstructions=function(interaction){var min=parseInt(interaction.attr("minAssociations"),10),max=parseInt(interaction.attr("maxAssociations"),10);if(0===min)0===max&&instructionMgr.appendInstruction(interaction,__(
"You may make as many association pairs as you want."));else{0===max&&instructionMgr.appendInstruction(interaction,__("The maximum number of association is unlimited."));var msg=__("You need to make")+" ";msg+=1<min?__("at least")+" "+min+" "+__("association pairs"):__("one association pair"),instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()})}},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".result-area>li",$container).each(function(){var pair=[];$(this).find("div").each(function(){var serial=$(this).data(
"serial");serial&&pair.push(interaction.getChoice(serial).id())}),2===pair.length&&response.push(pair)}),response};return{qtiClass:"associateInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve,reject){var isDragAndDropEnabled,dragOptions,dropOptions,$container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$activeChoice=null,$bin=$("<span>",{class:"icon-undo remove-choice",title:__("remove")}),choiceSelector=$choiceArea.selector+" >li",resultSelector=$resultArea.selector+" >li>div",binSelector=$container.selector+" .remove-choice",
_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){setChoice(interaction,$choice,$target),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_resetSelection=function(){$activeChoice&&($resultArea.find(".remove-choice").remove(),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){unsetChoice(interaction,$choice,!0),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_isModeEditing=function(){
return $activeChoice&&!$activeChoice.data("identifier")},_handleChoiceActivate=function($target){$target.hasClass("deactivated")||(_isModeEditing()?(interaction.swapping=!0,_unsetChoice($activeChoice),_setChoice($target,$activeChoice),_resetSelection(),interaction.swapping=!1):$target.hasClass("active")?_resetSelection():_activateChoice($target))},_activateChoice=function($choice){_resetSelection(),($activeChoice=$choice).addClass("active"),$resultArea.find(">li>.target").addClass("empty")},_handleResultActivate=function($target){var choiceSerial,targetSerial=$target.data("serial");$activeChoice&&$activeChoice.data("identifier")?(targetSerial!==(
choiceSerial=$activeChoice.data("serial"))&&($target.hasClass("filled")&&(interaction.swapping=!0),targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target),interaction.swapping=!1),_resetSelection()):_isModeEditing()?(targetSerial!==(choiceSerial=$activeChoice.data("serial"))&&(($target.hasClass("filled")||$activeChoice.siblings("div")[0]===$target[0])&&(interaction.swapping=!0),_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target),interaction.swapping=!1),_resetSelection()):targetSerial&&(_activateResult($target),$target.append($bin))},
_activateResult=function($target){var targetSerial=$target.data("serial");($activeChoice=$target).addClass("active"),$resultArea.find(">li>.target").filter(function(){return $(this).data("serial")!==targetSerial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $(this).data("serial")!==targetSerial}).addClass("empty")};function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){var $activeDrop=$(resultSelector+".dropzone");$activeDrop.length&&interact(resultSelector).fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),($activeDrop=$(choiceSelector+".dropzone")
).length&&interact(choiceSelector+".empty").fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}interact($container.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||_resetSelection()}),interact($choiceArea.selector+" >li").on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_handleChoiceActivate($target),e.preventDefault())}),interact($resultArea.selector+" >li>div").on("tap",function(e){var $target=$(e.currentTarget);$target.closest(
".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_handleResultActivate($target),e.preventDefault())}),interact(binSelector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection(),e.preventDefault())}),interaction.responseMappingMode||_setInstructions(interaction),self.getOption&&self.getOption("enableDragAndDrop")&&self.getOption("enableDragAndDrop").associate&&(isDragAndDropEnabled=self.getOption("enableDragAndDrop").associate),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",
endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector+":not(.deactivated)").draggable(_.defaults({onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_activateChoice($target),_iFrameDragFix(choiceSelector+":not(.deactivated)",e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),_resetSelection(),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}},dragOptions)).styleCursor(!1),interact(resultSelector+".filled").draggable(_.defaults({onstart:function(e){var $target=$(e.target)
;$target.addClass("dragged"),_resetSelection(),_activateResult($target),_iFrameDragFix(resultSelector+".filled",e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),$activeChoice&&_unsetChoice($activeChoice),_resetSelection(),interactUtils.iFrameDragFixOff()}},dragOptions)).styleCursor(!1),dropOptions={overlap:.15,ondragenter:function(e){$(e.target).addClass("dropzone"),$(e.relatedTarget).addClass("droppable")},ondragleave:function(e){$(e.target).removeClass("dropzone"),$(e.relatedTarget).removeClass("droppable")}},
interact(resultSelector).dropzone(_.defaults({ondrop:function(e){this.ondragleave(e),_handleResultActivate($(e.target))}},dropOptions)),interact(choiceSelector+".empty").dropzone(_.defaults({ondrop:function(e){this.ondragleave(e),_handleChoiceActivate($(e.target))}},dropOptions))),renderEmptyPairs(interaction),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",$container)),resolve()})},getContainer:containerHelper.get,setResponse:function(interaction,response){!function(interaction,pairs){var $container=containerHelper.get(interaction),$emptyPair=$(".result-area>li:first",$container);pairs&&"single"===interaction.getResponseDeclaration(
).attr("cardinality")&&pairs.length&&(pairs=[pairs]),_.each(pairs,function(pair){if(!$emptyPair.length)return!1;var $divs=$emptyPair.children("div");setChoice(interaction,getChoice(interaction,pair[0]),$($divs[0])),setChoice(interaction,getChoice(interaction,pair[1]),$($divs[1])),0,$emptyPair=$emptyPair.next("li")})}(interaction,pciResponse.unserialize(response,interaction))},getResponse:function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction);$container.find(".result-area .active").each(function(){interactUtils.tapOn(this)}),$(
".result-area>li>div",$container).each(function(){unsetChoice(interaction,$(this),!1,!1)}),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},destroy:function(interaction){var $container=containerHelper.get(interaction);interact($container.selector).unset(),interact($container.find(".choice-area").selector+" >li").unset(),interact($container.find(".result-area").selector+" >li>div").unset(),interact($container.find(".remove-choice").selector).unset(),instructionMgr.removeInstructions(interaction),$(".result-area",$container).empty(),containerHelper.reset(interaction)},setState:function(interaction,state
){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState:function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),
!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state},renderEmptyPairs:renderEmptyPairs}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,blockHelperMissing=helpers.blockHelperMissing
;function program13(depth0,data){var stack1;return(stack1=typeof depth0===functionType?depth0.apply(depth0):depth0)||0===stack1?stack1:""}return buffer+="<div\n  ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n  class="qti-interaction qti-blockInteraction qti-choiceInteraction',((
stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"\n  data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'"\n  data-qti-class="choiceInteraction"\n  ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n>\n  ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(
helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <ol class="plain block-listing solid choice-area',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.noop,fn:this.program(9,function(depth0,data){return" horizontal"},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=" ",((stack1=helpers.if.call(depth0,depth0&&depth0.listStyle,{hash:{},inverse:this.noop,fn:this.program(11,function(
depth0,data){var stack1,helper;return(stack1=(helper=helpers.listStyle)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.listStyle)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='">\n      ',options={hash:{},inverse:this.noop,fn:this.program(13,program13,data),data:data},stack1=(helper=helpers.choices)?helper.call(depth0,options):typeof(helper=depth0&&depth0.choices)===functionType?helper.call(depth0,options):helper,helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:this.noop,fn:this.program(13,program13,data),
data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  </ol>\n  <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(_,$,__,tpl,containerHelper,instructionMgr,pciResponse,sizeAdapter){"use strict";var _triggerInput=function($choiceBox,state){
var $input=$choiceBox.find("input:radio,input:checkbox").not("[disabled]").not(".disabled"),$choiceBoxes=$choiceBox.add($choiceBox.siblings());$input.length&&(_.isBoolean(state)||(state=!$input.prop("checked")),$input.prop("checked",state),$input.trigger("change"),$choiceBoxes.removeClass("user-selected"),$choiceBoxes.find("input:checked").not("[disabled]").not(".disabled").parents(".qti-choice").addClass("user-selected"))},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $(".real-label > input[name=response-"+interaction.getSerial()+"]:checked",$container).each(function(){values.push($(this).val())}),
values},isEliminable=function(interaction){return/\beliminable\b/.test(interaction.attr("class"))};return{qtiClass:"choiceInteraction",template:tpl,getData:function(interaction,data){var listStyles=(interaction.attr("class")||"").match(/\blist-style-[\w-]+/)||[];return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation"),listStyle:listStyles.pop(),eliminable:isEliminable(interaction)})},render:function(interaction){var $container=containerHelper.get(interaction);!function(interaction,$container){var inputSelector=".qti-choice input:radio:not([disabled]):not(.disabled), .qti-choice input:checkbox:not([disabled]):not(.disabled)"
;$container.off(".commonRenderer"),$container.on("keydown.commonRenderer.keyNavigation",inputSelector,function(e){var $qtiChoice=$(this).closest(".qti-choice"),keyCode=e.keyCode?e.keyCode:e.charCode;38===keyCode||37===keyCode?(e.preventDefault(),e.stopPropagation(),$qtiChoice.prev(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled").focus()):40!==keyCode&&39!==keyCode||(e.preventDefault(),e.stopPropagation(),$qtiChoice.next(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled").focus())}).on("keyup.commonRenderer.keyNavigation",inputSelector,function(e){var keyCode=e.keyCode?e.keyCode:e.charCode
;32!==keyCode&&13!==keyCode||(e.preventDefault(),e.stopPropagation(),_triggerInput($(this).closest(".qti-choice")))}),$container.on("click.commonRenderer",".qti-choice",function(e){var state,$choiceBox=$(this),eliminator=e.target.dataset&&e.target.dataset.eliminable,input=this.querySelector(".real-label > input");e.originalEvent&&$(e.originalEvent.target).is("input")||$choiceBox.closest(".qti-item").hasClass("prevent-click-handler")||(e.preventDefault(),e.stopPropagation(),_.isUndefined(eliminator)||(state=!1,"trigger"===eliminator&&this.classList.toggle("eliminated")),_triggerInput($choiceBox,state),this.classList.contains("eliminated")?input.setAttribute(
"disabled","disabled"):input.removeAttribute("disabled"),instructionMgr.validateInstructions(interaction,{choice:$choiceBox}),containerHelper.triggerResponseChangeEvent(interaction))})}(interaction,$container),function(interaction){var msg,min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),choiceCount=_.size(interaction.getChoices()),minInstructionSet=!1,highlightInvalidInput=function($choice){var $input=$choice.find(".real-label > input"),$li=$choice.css("color","#BA122B"),$icon=$choice.find(".real-label > span").css("color","#BA122B").addClass("cross error"),timeout=interaction.data("__instructionTimeout");timeout&&clearTimeout(timeout),
timeout=setTimeout(function(){$input.prop("checked",!1),$li.removeAttr("style"),$icon.removeAttr("style").removeClass("cross"),$li.toggleClass("user-selected",!1),containerHelper.triggerResponseChangeEvent(interaction)},150),interaction.data("__instructionTimeout",timeout)};1<max&&max<choiceCount&&(max===min?(minInstructionSet=!0,msg=__("You must select exactly %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function(){
data&&data.choice&&highlightInvalidInput(data.choice)},stop:function(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):min<max&&(msg=1===max?__("You can select maximum of 1 choice"):__("You can select maximum of %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){data&&data.choice&&highlightInvalidInput(data.choice)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),
!minInstructionSet&&0<min&&min<choiceCount&&(msg=1===min?__("You must select at least 1 choice"):__("You must select at least %s choices",min),instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))}(interaction),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize($(".add-option, .result-area .target, .choice-area .qti-choice",$container))},getContainer:containerHelper.get,setResponse:function(interaction,response){var $container=containerHelper.get(interaction);try{_.forEach(pciResponse.unserialize(response,interaction),function(identifier){
$container.find('.real-label > input[value="'+identifier+'"]').prop("checked",!0).closest(".qti-choice").toggleClass("user-selected",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},getResponse:function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction);$(".real-label > input",$container).prop("checked",!1)},destroy:function(interaction){var $container=containerHelper.get(interaction),timeout=interaction.data("__instructionTimeout");timeout&&clearTimeout(timeout),
$container.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),$container=containerHelper.get(interaction),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&$(".qti-simpleChoice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(
".choice-area",$container)),isEliminable(interaction)&&_.isArray(state.eliminated)&&state.eliminated.length&&_.forEach(state.eliminated,function(identifier){$container.find(".qti-simpleChoice[data-identifier="+identifier+"]").addClass("eliminated")}))},getState:function(interaction){var $container=containerHelper.get(interaction),state={},response=interaction.getResponse();return response&&(state.response=response),!0===interaction.attr("shuffle")&&(state.order=[],$(".qti-simpleChoice",$container).each(function(){state.order.push($(this).data("identifier"))})),isEliminable(interaction)&&(state.eliminated=[],$container.find(".qti-simpleChoice.eliminated"
).each(function(){state.eliminated.push($(this).data("identifier"))})),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<a class="qti-interaction qti-inlineInteraction qti-endAttemptInteraction btn small btn-info"\n        data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" \n        data-qti-class="endAttemptInteraction"\n        value="false"\n        tabindex="0"\n        ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(
buffer+=stack1),buffer+=">\n        "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.title)===functionType?stack1.apply(depth0):stack1)+"\n</a>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n"],function(_,tpl,containerHelper,pciResponse,__){"use strict";function _setVal(interaction,val){containerHelper.get(interaction).val(val).change()}return{qtiClass:"endAttemptInteraction",
template:tpl,getData:function(interaction,data){return data.attributes.title||(data.attributes.title=__("End Attempt")),data},render:function(interaction,options){var $container=containerHelper.get(interaction);$container.on("click.commonRenderer",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||($container.val(!0),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("endattempt",[interaction.attr("responseIdentifier")]))})},getContainer:containerHelper.get,setResponse:function(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},getResponse:function(
interaction){var val=containerHelper.get(interaction).val();return val=val&&"false"!==val&&"0"!==val,pciResponse.serialize([val],interaction)},resetResponse:function(interaction){_setVal(interaction,!1)},destroy:function(interaction){containerHelper.get(interaction).off(".commonRenderer")},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction",["handlebars"],
function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;function program10(depth0,data){var stack1,buffer="";return buffer+="\n            ",((stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program11(depth0,data){var stack1,buffer=""
;return buffer+='\n                <div class="text-container text-'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format)===functionType?stack1.apply(depth0):stack1)+" solid",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" name="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+"_"+escapeExpression(
typeof depth0===functionType?depth0.apply(depth0):depth0)+'" contenteditable></div>\n            '}function program12(depth0,data){return" attributes.class"}function program14(depth0,data){var stack1,buffer="";return buffer+="\n            ",((stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program15(depth0,data){var stack1,buffer="";return buffer+='\n                <textarea class="text-container text-'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format
)===functionType?stack1.apply(depth0):stack1)+" solid",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" name="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+"_"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'" ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.patternMask,{hash:{},inverse:self.noop,
fn:self.program(16,program16,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n            "}function program16(depth0,data){var stack1,buffer="";return buffer+='pattern="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.patternMask)===functionType?stack1.apply(depth0):stack1)+'"'}function program18(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"of",options
):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.expectedLength)===functionType?stack1.apply(depth0):stack1)+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"recommanded",options):helperMissing.call(depth0,"__","recommanded",options)))+".\n            </div>\n        "}function program20(depth0,data){var stack1,helper,options,
buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",stack1=(helper=helpers.maxLength)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.maxLength)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",
options)))+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        "}function program22(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-words">0</span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",stack1=(helper=helpers.maxWords)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.maxWords)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"words",options):helperMissing.call(depth0,"__","words",options)))+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        "}function program25(depth0,data){var stack1,buffer="";return buffer+='\n            <div class="text-container text-'+escapeExpression(typeof(
stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format)===functionType?stack1.apply(depth0):stack1)+" solid",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" contenteditable></div>\n        '}function program27(depth0,data){var stack1,buffer="";return buffer+='\n            <textarea class="text-container text-'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format)===functionType?stack1.apply(depth0):stack1
)+" solid",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.patternMask,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n        "}function program29(depth0,data){var stack1,helper,options,buffer=""
;return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.expectedLength)===functionType?stack1.apply(depth0):stack1)+" "+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((options={hash:{},data:data},(
helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"recommended",options):helperMissing.call(depth0,"__","recommended",options)))+".\n            </div>\n        "}return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+=' class="qti-interaction qti-blockInteraction qti-extendedTextInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:self.noop,fn:self.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{
hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="extendedTextInteraction"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:self.noop,fn:self.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,
function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    ',((stack1=helpers.if.call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.program(24,function(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n        ",helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(27,program27,data),fn:self.program(25,program25,data),
data:data},((stack1=helper?helper.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format,depth0&&depth0.xhtml,options):helperMissing.call(depth0,"equal",null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format,depth0&&depth0.xhtml,options))||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.expectedLength,{hash:{},inverse:self.noop,fn:self.program(29,program29,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n        ",((stack1=helpers.if.call(depth0,depth0&&depth0.maxLength,{hash:{},
inverse:self.noop,fn:self.program(20,program20,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",((stack1=helpers.if.call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    "},data),fn:self.program(9,function(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n        ",helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(14,program14,data),fn:self.program(10,program10,data),data:data},((stack1=helper?helper.call(depth0,null==(stack1=depth0&&depth0.attributes
)||!1===stack1?stack1:stack1.format,"xhtml",options):helperMissing.call(depth0,"equal",null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.format,"xhtml",options))||0===stack1)&&(buffer+=stack1),buffer+="\n        {!-- If there's an expected length or a max length --}}\n        ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.expectedLength,{hash:{},inverse:self.noop,fn:self.program(18,program18,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n        ",((stack1=helpers.if.call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),
data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",((stack1=helpers.if.call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    "},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",["jquery","lodash","i18n","core/promise","util/strLimiter","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container",
"taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","ckeditor","taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator","taoQtiItem/qtiCommonRenderer/helpers/patternMask","ui/tooltip"],function($,_,__,Promise,strLimiter,tpl,containerHelper,instructionMgr,ckEditor,ckConfigurator,patternMaskHelper,tooltip){"use strict";var inputLimiter=function(interaction){var patternRegEx,$textarea,$charsCounter,$wordsCounter,maxWords,maxLength,$container=containerHelper.get(interaction),expectedLength=interaction.attr("expectedLength"),expectedLines=interaction.attr("expectedLines"),patternMask=interaction.attr("patternMask"),enabled=!1;return(
expectedLength||expectedLines||patternMask)&&(enabled=!0,$textarea=$(".text-container",$container),$charsCounter=$(".count-chars",$container),$wordsCounter=$(".count-words",$container),""!==patternMask&&(maxWords=patternMaskHelper.parsePattern(patternMask,"words"),maxLength=patternMaskHelper.parsePattern(patternMask,"chars"),maxWords=_.isNaN(maxWords)?void 0:maxWords,(maxLength=_.isNaN(maxLength)?void 0:maxLength)||maxWords||(patternRegEx=new RegExp(patternMask)))),{enabled:enabled,listenTextInput:function(){var cke,self=this,ignoreKeyCodes=[8,16,17,46,37,38,39,40,35,36,1114177,3342401,1114181,3342405,2228232,2228261,4456485,2228262,2228263,4456487,2228264,
1114120,1114177,1114202,1114200],triggerKeyCodes=[32,13,2228237],invalidToolip=tooltip.error($container,__("This is not a valid answer"),{position:"bottom",trigger:"manual"}),keyLimitHandler=function(e){var keyCode=e&&e.data?e.data.keyCode:e.which;if(!_.contains(ignoreKeyCodes,keyCode)&&(maxWords&&self.getWordsCount()>=maxWords&&_.contains(triggerKeyCodes,keyCode)||maxLength&&self.getCharsCount()>=maxLength))return e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),!1;_.defer(function(){self.updateCounter()})},nonKeyLimitHandler=function(e){var newValue,oldValue=_getTextareaValue(interaction),isCke="xhtml"===_getFormat(interaction);if(
newValue=isCke?e.data.dataValue:e.originalEvent.clipboardData?e.originalEvent.clipboardData.getData("text"):e.originalEvent.dataTransfer.getData("text")||e.originalEvent.dataTransfer.getData("text/plain")||"",e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),!newValue)return!1;_.isNull(maxWords)?_.isNull(maxLength)||(newValue=strLimiter.limitByCharCount(newValue,maxLength-self.getCharsCount())):newValue=strLimiter.limitByWordCount(newValue,maxWords-self.getWordsCount()),isCke?_getCKEditor(interaction).insertText(newValue):containerHelper.get(interaction).find("textarea").val(oldValue+newValue),_.defer(function(){self.updateCounter()})}
;"xhtml"===_getFormat(interaction)?((cke=_getCKEditor(interaction)).on("key",keyLimitHandler),cke.on("paste",nonKeyLimitHandler)):$textarea.on("keyup.commonRenderer",function(e){var newValue,isCke="xhtml"===_getFormat(interaction);if(patternRegEx){if(!(newValue=isCke?e.getData():e.currentTarget.value))return!1;_.debounce(function(){patternRegEx.test(newValue)?($container.removeClass("invalid"),invalidToolip.dispose()):($container.addClass("invalid"),$container.show(),invalidToolip.show(),containerHelper.triggerResponseChangeEvent(interaction))},400)()}}).on("keydown.commonRenderer",keyLimitHandler).on("paste.commonRenderer drop.commonRenderer",
nonKeyLimitHandler)},getWordsCount:function(){var value=_getTextareaValue(interaction)||"";return _.isEmpty(value)?0:value.trim().replace(/\s+/gi," ").split(" ").length},getCharsCount:function(){return(_getTextareaValue(interaction)||"").length},updateCounter:function(){$charsCounter.text(this.getCharsCount()),$wordsCounter.text(this.getWordsCount())}}},_getTextareaValue=function(interaction,raw){return"xhtml"===_getFormat(interaction)?_ckEditorData(interaction,raw):containerHelper.get(interaction).find("textarea").val()},_setPattern=function($element,pattern){var patt=new RegExp(pattern);$element.on("keyup.commonRenderer",function(){$element.removeClass(
"field-error"),patt.test($element.val())||$element.addClass("field-error")})},_isMultiple=function(interaction){var attributes=interaction.getAttributes(),response=interaction.getResponseDeclaration();return!(!attributes.maxStrings||"multiple"!==response.attr("cardinality")&&"ordered"!==response.attr("cardinality"))},_setUpCKEditor=function(interaction,options){var $container=containerHelper.get(interaction),editor=ckEditor.replace($container.find(".text-container")[0],options||{});if(editor)return $container.data("editor",editor.name),editor},_getCKEditor=function(interaction){var name=containerHelper.get(interaction).data("editor")
;return ckEditor.instances[name]},_ckEditorData=function(interaction,raw){var editor=_getCKEditor(interaction),data=editor&&editor.getData()||"";return raw||(data=_stripTags(data)),data},_stripTags=function(str){var tempNode=document.createElement("div");return tempNode.innerHTML=str,tempNode.textContent},_getFormat=function(interaction){var format=interaction.attr("format");return _.contains(["plain","xhtml","preformatted"],format)?format:"plain"},setText=function(interaction,text){var limiter=inputLimiter(interaction);if("xhtml"===_getFormat(interaction))try{_getCKEditor(interaction).setData(text,function(){limiter.enabled&&limiter.updateCounter()})}catch(
e){console.error("setText error",e)}else containerHelper.get(interaction).find("textarea").val(text),limiter.enabled&&limiter.updateCounter()};return{qtiClass:"extendedTextInteraction",template:tpl,render:function(interaction){return new Promise(function(resolve,reject){var $el,expectedLength,minStrings,patternMask,editor,_styleUpdater,themeLoaded,_getNumStrings,$container=containerHelper.get(interaction),multiple=_isMultiple(interaction),limiter=inputLimiter(interaction),placeholderText=interaction.attr("placeholderText"),ckOptions={extraPlugins:"onchange",language:"en",defaultLanguage:"en",resize_enabled:!0,secure:"https:"===location.protocol,
forceCustomDomain:!0};multiple?($el=$container.find("input"),minStrings=interaction.attr("minStrings"),expectedLength=interaction.attr("expectedLength"),patternMask=interaction.attr("patternMask"),minStrings&&(_getNumStrings=function($element){var num=0;return $element.each(function(){""!==$(this).val()&&num++}),num},0<(minStrings=parseInt(minStrings,10))&&$el.on("blur.commonRenderer",function(){setTimeout(function(){!$el.is(":focus")&&_getNumStrings($el)<minStrings&&instructionMgr.appendNotification(interaction,__("The minimum number of answers is ")+" : "+minStrings,"warning")},100)})),expectedLength&&0<(expectedLength=parseInt(expectedLength,10)
)&&$el.each(function(){$(this).css("width",expectedLength+"em")}),patternMask&&$el.each(function(){_setPattern($(this),patternMask)}),placeholderText&&$el.first().attr("placeholder",placeholderText),resolve()):($el=$container.find("textarea"),placeholderText&&$el.attr("placeholder",placeholderText),"xhtml"===_getFormat(interaction)?(_styleUpdater=function(){var qtiItemStyle,qtiItem;editor.document&&(qtiItemStyle=(qtiItem=$(".qti-item").get(0)).currentStyle||window.getComputedStyle(qtiItem),(editor.document.$&&editor.document.$.body?$(editor.document.$.body):$(editor.document.getBody().$)).css({"background-color":"transparent",color:qtiItemStyle.color}))},
themeLoaded=function(){_styleUpdater()},(editor=_setUpCKEditor(interaction,ckOptions))||reject("Unable to instantiate ckEditor"),editor.on("instanceReady",function(){_styleUpdater(),editor.container&&editor.container.$&&$(editor.container.$).addClass("no-key-navigation"),_.delay(resolve,300)}),"ready"!==editor.status&&"loaded"!==editor.status||_.defer(resolve),editor.on("configLoaded",function(){editor.config=ckConfigurator.getConfig(editor,"extendedText",ckOptions),limiter.enabled&&limiter.listenTextInput()}),editor.on("change",function(){containerHelper.triggerResponseChangeEvent(interaction,{})}),$(document).on("themechange.themeloader",themeLoaded)):(
$el.on("keyup.commonRenderer change.commonRenderer",function(){containerHelper.triggerResponseChangeEvent(interaction,{})}),limiter.enabled&&limiter.listenTextInput(),resolve()))})},getContainer:containerHelper.get,setResponse:function(interaction,response){var identifier,value,baseType=interaction.getResponseDeclaration().attr("baseType");if(response.base&&void 0!==response.base[baseType])setText(interaction,response.base[baseType]);else{if(!response.list||!response.list[baseType])throw new Error("wrong response format in argument.");for(var i in response.list[baseType]){var serial=void 0===response.list.serial?"":response.list.serial[i]
;identifier=serial+"_"+i,value=response.list[baseType][i],interaction.getContainer().find("#"+identifier).val(value)}}},getResponse:function(interaction){var $container=containerHelper.get(interaction),attributes=interaction.getAttributes(),responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),numericBase=attributes.base||10,multiple=!(!attributes.maxStrings||"multiple"!==responseDeclaration.attr("cardinality")&&"ordered"!==responseDeclaration.attr("cardinality")),ret=multiple?{list:{}}:{base:{}};if(multiple){var values=[];$container.find("input").each(function(i){var $el=$(this)
;attributes.placeholderText&&$el.val()===attributes.placeholderText?values[i]="":"integer"===baseType?(values[i]=parseInt($el.val(),numericBase),values[i]=isNaN(values[i])?"":values[i]):"float"===baseType?(values[i]=parseFloat($el.val()),values[i]=isNaN(values[i])?"":values[i]):"string"===baseType&&(values[i]=$el.val())}),ret.list[baseType]=values}else{var value="";attributes.placeholderText&&_getTextareaValue(interaction)===attributes.placeholderText?value="":"integer"===baseType?value=parseInt(_getTextareaValue(interaction),numericBase):"float"===baseType?value=parseFloat(_getTextareaValue(interaction)):"string"===baseType&&(value=_getTextareaValue(
interaction,!0)),ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value}return ret},getData:function(interaction,data){var pattern=interaction.attr("patternMask"),maxWords=parseInt(patternMaskHelper.parsePattern(pattern,"words")),maxLength=parseInt(patternMaskHelper.parsePattern(pattern,"chars")),expectedLength=parseInt(interaction.attr("expectedLines"),10);return _.merge(data||{},{maxWords:isNaN(maxWords)?void 0:maxWords,maxLength:isNaN(maxLength)?void 0:maxLength,attributes:isNaN(expectedLength)?void 0:{expectedLength:72*expectedLength}})},resetResponse:function(interaction){"xhtml"===_getFormat(interaction)?_getCKEditor(interaction).setData(""
):containerHelper.get(interaction).find("input, textarea").val("")},destroy:function(interaction){var $el=containerHelper.get(interaction).find("input, textarea");"xhtml"===_getFormat(interaction)&&function(interaction){var editor,$container=containerHelper.get(interaction),name=$container.data("editor");name&&(editor=ckEditor.instances[name]),editor&&(editor.destroy(),$container.removeData("editor"))}(interaction),$el.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(
state.response=response),state},setState:function(interaction,state){if(_.isObject(state)&&state.response)try{interaction.setResponse(state.response)}catch(e){throw interaction.resetResponse(),e}},enable:function(interaction){var editor;containerHelper.get(interaction).find("input, textarea").removeAttr("disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction))&&("ready"===editor.status?editor.setReadOnly(!1):editor.readOnly=!1)},disable:function(interaction){var editor;containerHelper.get(interaction).find("input, textarea").attr("disabled","disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction))&&(
"ready"===editor.status?editor.setReadOnly(!0):editor.readOnly=!0)},clearText:function(interaction){setText(interaction,"")},setText:setText}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,blockHelperMissing=helpers.blockHelperMissing;function program9(depth0,data){var stack1;return(stack1=typeof depth0===functionType?depth0.apply(depth0
):depth0)||0===stack1?stack1:""}return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-gapMatchInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},
inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="gapMatchInteraction"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes
)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(
depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <ul class="choice-area none block-listing solid horizontal source">\n        ',options={hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data},stack1=(helper=helpers.choices)?helper.call(depth0,options):typeof(helper=depth0&&depth0.choices)===functionType?helper.call(depth0,options):helper,helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='\n    </ul>\n    <div class="instruction-container"></div>\n    <div class="qti-flow-container">',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager",
"taoQtiItem/qtiCommonRenderer/helpers/PciResponse","interact","ui/interactUtils"],function(_,__,$,tpl,containerHelper,instructionMgr,pciResponse,interact,interactUtils){"use strict";var _choiceUsages={},setChoice=function(interaction,$choice,$target){var choiceSerial=$choice.data("serial"),choice=interaction.getChoice(choiceSerial);_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),_choiceUsages[choiceSerial]++,$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&_choiceUsages[choiceSerial]>=choice.attr("matchMax")&&$choice.attr("class","deactivated"),
containerHelper.triggerResponseChangeEvent(interaction)},unsetChoice=function(interaction,$choice){var serial=$choice.data("serial");containerHelper.get(interaction).find(".choice-area [data-serial="+serial+"]").removeClass().addClass("qti-choice"),_choiceUsages[serial]--,$choice.removeClass("filled").removeData("serial").empty(),interaction.swapping||containerHelper.triggerResponseChangeEvent(interaction)},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$(".gapmatch-content.active",$container).removeClass("active"),$(".gapmatch-content",$container).each(function(){unsetChoice(interaction,$(this))})},_setPairs=function(
interaction,pairs){_.each(pairs,function(pair){pair&&setChoice(interaction,function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".choice-area [data-identifier="+identifier+"]",$container)}(interaction,pair[0]),function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".qti-flow-container [data-identifier="+identifier+"]",$container)}(interaction,pair[1]).find(".gapmatch-content"))})};return{qtiClass:"gapMatchInteraction",template:tpl,render:function(interaction){var isDragAndDropEnabled,dragOptions,$container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),
$flowContainer=$container.find(".qti-flow-container"),$activeChoice=null,$activeDrop=null,$bin=$("<span>",{class:"icon-undo remove-choice",title:__("remove")}),choiceSelector=$choiceArea.selector+" .qti-choice",gapSelector=$flowContainer.selector+" .gapmatch-content",filledGapSelector=gapSelector+".filled",binSelector=$container.selector+" .remove-choice",_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){return setChoice(interaction,$choice,$target)},_resetSelection=function(){$activeChoice&&($flowContainer.find(".remove-choice").remove(),$activeChoice.removeClass("deactivated active"),
$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){return unsetChoice(interaction,$choice)},_isInsertionMode=function(){return $activeChoice&&!$activeChoice.hasClass("filled")},_isModeEditing=function(){return $activeChoice&&$activeChoice.hasClass("filled")};function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){$activeDrop&&interact(gapSelector).fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}function _handleChoiceSelect($target){$activeChoice&&$target.hasClass("active")||$target.hasClass(
"deactivated")||(_resetSelection(),$activeChoice=$target.addClass("active"),$(gapSelector).addClass("empty"))}function _handleGapSelect($target){var choiceSerial,targetSerial;_isInsertionMode()?(choiceSerial=$activeChoice.data("serial"),(targetSerial=$target.data("serial"))!==choiceSerial&&(targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target)),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null):_isModeEditing()?(choiceSerial=$activeChoice.data("serial"),(targetSerial=$target.data("serial"))!==choiceSerial&&(_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),_setChoice(
_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target)),_resetSelection()):$target.data("serial")&&$target.hasClass("filled")&&(targetSerial=$target.data("serial"),($activeChoice=$target).addClass("active"),$flowContainer.find(">li>div").filter(function(){return $target.data("serial")!==targetSerial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $target.data("serial")!==targetSerial}).addClass("empty"),$target.append($bin))}this.getOption&&this.getOption("enableDragAndDrop")&&this.getOption("enableDragAndDrop").gapMatch&&(isDragAndDropEnabled=this.getOption("enableDragAndDrop").gapMatch),
isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector).draggable(_.assign({},dragOptions,{onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),_handleChoiceSelect($target),_iFrameDragFix(choiceSelector,e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(filledGapSelector).draggable(_.assign({},dragOptions,{
onstart:function(e){var $target=$(e.target);$target.addClass("dragged"),function($target){$activeChoice=$target,$(gapSelector).addClass("active")}($target),_iFrameDragFix(filledGapSelector,e.target)},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),$activeChoice&&(_unsetChoice($activeChoice),_resetSelection()),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(gapSelector).dropzone({overlap:.05,ondragenter:function(e){var $target=$(e.target),$dragged=$(e.relatedTarget);($activeDrop=$target).addClass("dropzone"),
$dragged.addClass("droppable")},ondrop:function(e){_handleGapSelect($(e.target)),this.ondragleave(e)},ondragleave:function(e){var $target=$(e.target),$dragged=$(e.relatedTarget);$target.removeClass("dropzone"),$dragged.removeClass("droppable"),$activeDrop=null}})),interact($container.selector).on("tap",function(e){e.stopPropagation(),_resetSelection()}),interact(choiceSelector).on("tap",function(e){e.stopPropagation(),_handleChoiceSelect($(e.currentTarget)),e.preventDefault()}),interact(gapSelector).on("tap",function(e){e.stopPropagation(),_handleGapSelect($(e.currentTarget)),e.preventDefault()}),interact(binSelector).on("tap",function(e){e.stopPropagation()
,_unsetChoice($activeChoice),_resetSelection(),e.preventDefault()})},getContainer:containerHelper.get,setResponse:function(interaction,response){resetResponse(interaction),_setPairs(interaction,pciResponse.unserialize(response,interaction))},getResponse:function(interaction){return pciResponse.serialize(function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".gapmatch-content",$container).each(function(){var choiceSerial=$(this).data("serial"),pair=[];choiceSerial&&pair.push(interaction.getChoice(choiceSerial).attr("identifier")),pair.push($(this).data("identifier")),2===pair.length&&response.push(pair)}),response}(
interaction),interaction)},resetResponse:resetResponse,destroy:function(interaction){var $container=containerHelper.get(interaction);interact($container.selector).unset(),interact($container.find(".choice-area").selector+" .qti-choice").unset(),interact($container.find(".qti-flow-container").selector+" .gapmatch-content").unset(),interact($container.find(".remove-choice").selector).unset(),$container.find(".gapmatch-content").empty(),$container.find(".active").removeClass("active"),$container.find(".remove-choice").remove(),$container.find(".empty").removeClass("empty"),containerHelper.reset(interaction)},setState:function(interaction,state){var $container
;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState:function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),!0===interaction.attr("shuffle")&&(
$container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes
)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicAssociateInteraction clearfix',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer=""
;return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer=""
;return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic",
"taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){"use strict";var _renderChoice=function(interaction,choice){var shape=choice.attr("shape"),coords=choice.attr("coords"),maxAssociations=interaction.attr("maxAssociations");graphic.createElement(interaction.paper,shape,coords,{id:choice.serial,title:__("Select this area to start an association")}).data("max",choice.attr("matchMax")).data("matching",0).removeData("assocs").click(function(){var active,assocs,
self=this;if(0<maxAssociations&&_getRawResponse(interaction).length>=maxAssociations)return _shapesUnSelectable(interaction),void instructionMgr.validateInstructions(interaction,{choice:choice,target:this});this.selectable?((active=_getActiveElement(interaction))&&(active.data("matching",active.data("matching")+1),this.data("matching",this.data("matching")+1),(assocs=active.data("assocs")||[]).push(choice.id()),active.data("assocs",assocs),_createPath(interaction,active,this,function(){active.data("matching",active.data("matching")-1),self.data("matching",self.data("matching")-1),active.data("assocs",_.remove(active.data("assocs")||[],choice.id())),
containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:self})})),_shapesUnSelectable(interaction)):this.active?(graphic.updateElementState(this,"basic",__("Select another area to complete the association")),this.active=!1,_shapesUnSelectable(interaction)):_isMatchable(this)&&(graphic.updateElementState(this,"active",__("Select this area to start an association")),this.active=!0,_shapesSelectable(interaction,this)),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:this})})},_paperUnSelect=function(interaction){
var $container=containerHelper.get(interaction),image=interaction.paper.getById("bg-image-"+interaction.serial);image&&image.click(function(){_shapesUnSelectable(interaction),$container.trigger("unselect.graphicassociate")})},_getActiveElement=function(interaction){var active;return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);if(element&&!0===element.active)return active=element,!1}),active},_createPath=function(interaction,srcElement,destElement,onRemove){var $container=containerHelper.get(interaction),vset=[],src=srcElement.getBBox(),sx=src.x+src.width/2,sy=src.y+src.height/2,
dest=destElement.getBBox(),dx=dest.x+dest.width/2,dy=dest.y+dest.height/2,srcBullet=interaction.paper.circle(sx,sy,3).attr(graphic._style["assoc-bullet"]),destBullet=interaction.paper.circle(dx,dy,3).attr(graphic._style["assoc-bullet"]),path=interaction.paper.path("M"+sx+","+sy+"L"+sx+","+sy).attr(graphic._style.assoc).animate({path:"M"+sx+","+sy+"L"+dx+","+dy},300),layer=interaction.paper.path("M"+sx+","+sy+"L"+dx+","+dy).attr(graphic._style["assoc-layer"]),midPath=layer.getPointAtLength(layer.getTotalLength()/2),closerBg=interaction.paper.circle(midPath.x,midPath.y,9).attr(graphic._style["close-bg"]).toBack(),closer=interaction.paper.path(
graphic._style.close.path).attr(graphic._style.close).transform("T"+(midPath.x-9)+","+(midPath.y-9)).attr("title",_("Click again to remove")).toBack();function hideCloser(){closerBg&&closerBg.type&&(closerBg.animate({opacity:0},300,function(){closerBg.toBack()}).unclick(),closer.animate({opacity:0},300,function(){closer.toBack()}).unclick())}function removeSet(){_.invoke(vset,"remove"),interaction._vsets=_.without(interaction._vsets,vset),"function"==typeof onRemove&&onRemove()}srcElement.toFront(),destElement.toFront(),vset=[srcBullet,path,destBullet,layer,closerBg,closer],interaction._vsets.push(vset),_.invoke(vset,"data","assoc-path",!0),layer.click(
function(){0===closer.attrs.opacity?(closerBg.toFront().animate({opacity:.8},300).click(removeSet),closer.toFront().animate({opacity:1},300).click(removeSet)):hideCloser()}),$container.on("unselect.graphicassociate",function(){hideCloser()})},_shapesSelectable=function(interaction,active){var assocs=active.data("assocs")||[];_.forEach(interaction.getChoices(),function(choice){var element;_.contains(assocs,choice.id())||!(element=interaction.paper.getById(choice.serial)).active&&element.id!==active.id&&_isMatchable(element,active)&&(element.selectable=!0,graphic.updateElementState(element,"selectable"))})},_shapesUnSelectable=function(interaction){_.forEach(
interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,element.active=!1,graphic.updateElementState(element,"basic"))})},_isMatchable=function(element){var matching,matchMax,matchable=!1;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||0,matchable=0===matchMax||matching<matchMax),matchable},_getRawResponse=function(interaction){var responses=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial),assocs=element.data("assocs");element&&assocs&&(responses=responses.concat(_.map(assocs,function(id
){return[choice.id(),id]})))}),responses};return{qtiClass:"graphicAssociateInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$(".main-image-box",$container),interaction._vsets=[],$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),
_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_paperUnSelect(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minAssociations"),max:interaction.attr("maxAssociations"),getResponse:_getRawResponse,onError:function(data){data&&data.target&&graphic.highlightError(data.target)}})})},getContainer:containerHelper.get,setResponse:function(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}if(_.isArray(responseValues)){var map=_.transform(interaction.getChoices(),function(res,choice){res[choice.id(
)]=interaction.paper.getById(choice.serial)});_.forEach(responseValues,function(responseValue){var el1,el2;_.isArray(responseValue)&&2===responseValue.length&&(el1=map[responseValue[0]],el2=map[responseValue[1]],el1&&el2&&(graphic.trigger(el1,"click"),graphic.trigger(el2,"click")))})}}},getResponse:function(interaction){_getRawResponse(interaction);return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var toRemove=[];_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&element.data({max:choice.attr("matchMax"),matching:0,assocs:[]})}),
interaction.paper.forEach(function(elt){elt.data("assoc-path")&&toRemove.push(elt)}),_.invoke(toRemove,"remove")},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$container.off(".graphicassociate"),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(
state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,blockHelperMissing=helpers.blockHelperMissing
;function program9(depth0,data){var stack1;return(stack1=typeof depth0===functionType?depth0.apply(depth0):depth0)||0===stack1?stack1:""}return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicGapMatchInteraction clearfix',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(
depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing horizontal source">\n            ',options={hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data},stack1=(helper=helpers.gapImgs)?helper.call(depth0,options):typeof(helper=depth0&&depth0.gapImgs)===functionType?helper.call(depth0,options):helper,helpers.gapImgs||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n    </div>\n</div>\n"})}),define(
"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",["jquery","lodash","i18n","module","core/promise","core/mouseEvent","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","interact","ui/interactUtils"],function($,_,__,module,Promise,triggerMouseEvent,tpl,graphic,pciResponse,containerHelper,instructionMgr,interact,interactUtils){"use strict";var isDragAndDropEnabled,activeDrop=null,
_choiceUsages={},isDirectedPairFlipped=module.config().flipDirectedPair,_isMatchable=function(element){var matching,matchMax,matchable=!1;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||[],matchable=0===matchMax||matchMax>matching.length),matchable},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,graphic.setStyle(element,"basic"),graphic.updateTitle(element,__("Select an image first")))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){
graphic.updateTitle(element,__("Remove"))})})},_selectShape=function(interaction,element,trackResponse){var $img,$clone,gapFiller,id,bbox,shapeOffset,activeOffset,matching,currentCount,$container=containerHelper.get(interaction),$gapList=$("ul",$container),$active=$gapList.find(".active:first"),$imageBox=$(".main-image-box",$container),boxOffset=$imageBox.offset();void 0===trackResponse&&(trackResponse=!0),$active.length&&(id=$active.data("identifier"),(matching=element.data("matching")||[]).push(id),element.data("matching",matching),currentCount=matching.length,$img=$active.find("img"),_shapesUnSelectable(interaction),$gapList.children().removeClass(
"active"),function(interaction,$choice){var matchMax,usages,choiceSerial=$choice.data("serial"),choice=interaction.getGapImg(choiceSerial);_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),_choiceUsages[choiceSerial]++,!interaction.responseMappingMode&&choice.attr("matchMax")&&(matchMax=+choice.attr("matchMax"),usages=+_choiceUsages[choiceSerial],0!==matchMax&&matchMax<=usages&&(interact($choice.get(0)).draggable(!1),$choice.addClass("disabled"),$choice.removeClass("selectable")))}(interaction,$active),$clone=$img.clone(),shapeOffset=$(element.node).offset(),activeOffset=$active.offset(),$clone.css({position:"absolute",display:"block",
"z-index":1e4,opacity:.8,top:activeOffset.top-boxOffset.top,left:activeOffset.left-boxOffset.left}),$clone.appendTo($imageBox),$clone.animate({top:shapeOffset.top-boxOffset.top,left:shapeOffset.left-boxOffset.left},200,function(){var gapFillerImage;$clone.remove(),bbox=element.getBBox(),gapFillerImage=(gapFiller=graphic.createBorderedImage(interaction.paper,{url:$img.attr("src"),left:bbox.x+8*(currentCount-1),top:bbox.y+8*(currentCount-1),width:parseInt($img.attr("width"),10),height:parseInt($img.attr("height"),10),padding:0,border:!1,shadow:!0}).data("identifier",id).toFront())[2].node,interact(gapFillerImage).on("tap",function(e){var $choice,choiceSerial,
target=e.currentTarget,rElement=interaction.paper.getById(target.raphaelid);e.preventDefault(),e.stopPropagation(),0<$gapList.find(".active").length?interactUtils.tapOn(element.node):(element.data("matching",_.without(element.data("matching")||[],rElement.data("identifier"))),interaction.gapFillers=_.without(interaction.gapFillers,gapFiller),gapFiller.remove(),choiceSerial=($choice=$active).data("serial"),_choiceUsages[choiceSerial]--,$choice.removeClass("disabled"),$choice.addClass("selectable"),interact($choice.get(0)).draggable(!0),containerHelper.triggerResponseChangeEvent(interaction))}),interaction.gapFillers.push(gapFiller),
containerHelper.triggerResponseChangeEvent(interaction)}))},_renderChoice=function(interaction,choice){var rElement=graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select an image first"),hover:!1}).data("max",choice.attr("matchMax")).data("matching",[]);function handleShapeSelect(){_isMatchable(rElement)&&!0===rElement.selectable&&_selectShape(interaction,rElement)}interact(rElement.node).on("tap",function(){handleShapeSelect()}),isDragAndDropEnabled&&interact(rElement.node).dropzone({overlap:.15,ondragenter:function(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"hover"),
activeDrop=rElement.node)},ondrop:function(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"selectable"),handleShapeSelect(),activeDrop=null)},ondragleave:function(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"selectable"),activeDrop=null)}})},_renderGapList=function(interaction,$gapList){var dragOptions,gapFillersSelector=$gapList.selector+" li";function _setActiveGapState($target){$gapList.children("li").removeClass("active"),$target.addClass("active"),function(interaction){var tooltip=__("Select the area to add an image");_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);_isMatchable(
element)&&(element.selectable=!0,graphic.setStyle(element,"selectable"),graphic.updateTitle(element,tooltip))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){graphic.updateTitle(element,tooltip)})})}(interaction)}function _setInactiveGapState($target){$target.removeClass("active"),_shapesUnSelectable(interaction)}interact(gapFillersSelector).on("tap",function(e){var $target;e.stopPropagation(),e.preventDefault(),($target=$(e.currentTarget)).hasClass("disabled")||($target.hasClass("active")?_setInactiveGapState($target):_setActiveGapState($target))}),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,
restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},$(gapFillersSelector).each(function(index,gap){interact(gap).draggable(_.assign({},dragOptions,{onstart:function(e){var draggableSelector,target,$target=$(e.target);_setActiveGapState($target),$target.addClass("dragged"),draggableSelector=gapFillersSelector,target=e.target,interactUtils.iFrameDragFixOn(function(){activeDrop&&interact(activeDrop).fire({type:"drop",target:activeDrop,relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})},onmove:function(e){interactUtils.moveElement(e.target,e.dx,e.dy)},onend:function(e){
var $target=$(e.target);_setInactiveGapState($target),$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1)}))};return{qtiClass:"graphicGapMatchInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),$gapList=$("ul.source",$container),background=interaction.object.attributes;interaction.gapFillers=[],self.getOption&&self.getOption("enableDragAndDrop")&&self.getOption("enableDragAndDrop").graphicGapMatch&&(isDragAndDropEnabled=self.getOption("enableDragAndDrop").graphicGapMatch),
$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container,resize:function(newSize,factor){$gapList.css("max-width",newSize+"px"),1!==factor&&$gapList.find("img").each(function(){var $img=$(this);$img.width($img.attr("width")*factor),$img.height($img.attr("height")*factor)})}}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_renderGapList(interaction,$gapList),
function(interaction){var $container=containerHelper.get(interaction),$gapImages=$("ul > li",$container),bgImage=interaction.paper.getById("bg-image-"+interaction.serial);bgImage&&interact(bgImage.node).on("tap",function(){_shapesUnSelectable(interaction),$gapImages.removeClass("active")})}(interaction)})},getContainer:containerHelper.get,setResponse:function(interaction,response){var responseValues,$container=containerHelper.get(interaction);if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){responseValues=null}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){
var element=interaction.paper.getById(choice.serial);element&&_.forEach(responseValues,function(pair){var responseChoice,responseGap;2===pair.length&&(responseChoice=isDirectedPairFlipped?pair[0]:pair[1],responseGap=isDirectedPairFlipped?pair[1]:pair[0],responseChoice===choice.id()&&($("[data-identifier="+responseGap+"]",$container).addClass("active"),_selectShape(interaction,element,!1)))})})}},getResponse:function(interaction){var raw=function(interaction){var pairs=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_.isArray(element.data("matching"))&&_.forEach(element.data(
"matching"),function(gapImg){isDirectedPairFlipped?pairs.push([choice.id(),gapImg]):pairs.push([gapImg,choice.id()])})}),_.sortBy(pairs,[0,1])}(interaction);return pciResponse.serialize(raw,interaction)},resetResponse:function(interaction){_shapesUnSelectable(interaction),_.forEach(interaction.gapFillers,function(gapFiller){interactUtils.tapOn(gapFiller.items[2][0])})},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),
$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty(),interact($container.find("ul.source li").selector).unset(),interact($container.find(".main-image-box rect").selector).unset()),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},isDirectedPairFlipped:isDirectedPairFlipped}}),define(
"tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes
)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicOrderInteraction clearfix',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(
buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing horizontal ordinals"></ul>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container",
"taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){"use strict";var _renderChoice=function(interaction,$orderList,choice){graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(this.active?_unselectShape(interaction.paper,this,$orderList):_selectShape(interaction.paper,this,$orderList),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{
choice:choice}))})},_renderOrderList=function(interaction,$orderList){var $orderers,size=_.size(interaction.getChoices()),min=interaction.attr("minChoices"),max=interaction.attr("maxChoices");0<max&&max<size?size=max:0<min&&min<size&&(size=min),_.times(size,function(index){var position=index+1,$orderer=$('<li class="selectable" data-number="'+position+'">'+position+"</li>");0===index&&$orderer.addClass("active"),$orderList.append($orderer)}),_createTexts(interaction.paper,size,$orderList),($orderers=$orderList.children("li")).click(function(e){e.preventDefault();var $orderer=$(this);$orderer.hasClass("active")||$orderer.hasClass("disabled")||(
$orderers.removeClass("active"),$orderer.addClass("active"))})},_selectShape=function(paper,element,$orderList){var $active=$orderList.find(".active:first");$active.length&&0<$active.data("number")&&(element.data("number",$active.data("number")),element.active=!0,_showText(paper,element),graphic.updateElementState(element,"active"),$active.toggleClass("active disabled").siblings(":not(.disabled)").first().toggleClass("active"))},_unselectShape=function(paper,element,$orderList){var number=element.data("number");element.active=!1,_hideText(paper,element),element.removeData("number"),graphic.updateElementState(element,"basic"),$orderList.children(
).removeClass("active").filter("[data-number="+number+"]").removeClass("disabled").addClass("active")},_createTexts=function(paper,size){var texts=[];return _.times(size,function(index){var number=index+1,text=graphic.createText(paper,{id:"text-"+number,content:number,title:__("Remove"),style:"order-text",hide:!0});text.click(function(){paper.forEach(function(element){if(element.data("number")===number&&element.events){var evt=_.where(element.events,{name:"click"});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.call(element)}})}),texts.push(text)}),texts},_showText=function(paper,element){var transf,bbox=element.getBBox(),text=paper.getById(
"text-"+element.data("number"));text&&(transf="T"+(bbox.x+bbox.width/2)+","+(bbox.y+bbox.height/2),text.transform(transf).show().toFront())},_hideText=function(paper,element){var text=paper.getById("text-"+element.data("number"));text&&text.hide()},_getRawResponse=function(interaction){var response=[];return _.forEach(interaction.getChoices(),function(choice){var elt=interaction.paper.getById(choice.serial);elt&&elt.data("number")&&response.push({index:elt.data("number"),id:choice.id()})}),_(response).sortBy("index").map("id").value()};return{qtiClass:"graphicOrderInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(
function(resolve,reject){var $container=containerHelper.get(interaction),$orderList=$("ul",$container),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_renderOrderList(interaction,$orderList),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction,$orderList)),instructionMgr.minMaxChoiceInstructions(interaction,{
min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){graphic.highlightError(data.target)}})})},getContainer:containerHelper.get,setResponse:function(interaction,response){var responseValues,$container=containerHelper.get(interaction),$orderList=$("ul",$container);if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(responseValues,function(responseValue,index){var element,number=index+1,choice=_(interaction.getChoices()).where({attributes:{identifier:responseValue}}).first();choice&&(
element=interaction.paper.getById(choice.serial))&&($orderList.children("[data-number="+number+"]").addClass("active"),_selectShape(interaction.paper,element,$orderList))})}},getResponse:function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction),$orderList=$("ul",$container);_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_unselectShape(interaction.paper,element,$orderList)}),$orderList.children("li").removeClass("active disabled").first().addClass("active")},destroy:function(
interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},
response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer=""
;return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-hotspotInteraction clearfix',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class
)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"]
)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',stack1=(
helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"]
,function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){"use strict";var _renderChoice=function(interaction,choice){var $container=containerHelper.get(interaction);graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(){this.active?(graphic.updateElementState(this,"basic",__("Select this area")),this.active=!1,$container.trigger("inactiveChoice.qti-widget",[choice,this])):(graphic.updateElementState(this,"active",__("Click again to remove")),this.active=!0,$container.trigger("activeChoice.qti-widget",[choice,this])),
containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:this})})},_getRawResponse=function(interaction){return _(interaction.getChoices()).map(function(choice){var rElement=interaction.paper.getById(choice.serial);return!(!rElement||!0!==rElement.active)&&choice.id()}).filter(_.isString).value()};return{qtiClass:"hotspotInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one(
"resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){data.target.active&&(data.target.active=!1,graphic.updateElementState(this,"basic",__("Select this area")),graphic.highlightError(data.target),
containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("inactiveChoice.qti-widget",[data.choice,data.target]))}})})},getContainer:containerHelper.get,setResponse:function(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){var rElement;_.contains(responseValues,choice.attributes.identifier)&&(rElement=interaction.paper.getById(choice.serial))&&(rElement.active=!0,graphic.updateElementState(rElement,"active",__("Click again to remove")),
instructionMgr.validateInstructions(interaction,{choice:choice,target:rElement}))})}},getResponse:function(interaction){_getRawResponse(interaction);return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.active=!1,graphic.updateElementState(element,"basic"))}),instructionMgr.resetInstructions(interaction)},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off(
"resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(hb){return hb.template(
function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(
buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-hottextInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="hottextInteraction"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n  ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},
inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <div class="qti-flow-container">',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define(
"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var pseudoLabel=function(interaction){var $container=containerHelper.get(interaction);$(".hottext",$container).on("click",function(e){e.preventDefault(),function($choice,interaction){var $inupt=$choice.find("input");if($inupt.prop("checked"
)||$inupt.hasClass("disabled"))$inupt.prop("checked",!1);else{var maxChoices=parseInt(interaction.attr("maxChoices"));(_.values(_getRawResponse(interaction)).length<maxChoices||0===maxChoices)&&$inupt.prop("checked",!0)}containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:$choice})}($(this),interaction)})},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $("input:checked",$container).each(function(){values.push($(this).val())}),values};return{qtiClass:"hottextInteraction",template:tpl,render:function(interaction){pseudoLabel(interaction),
instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){var $input,$choice,$icon;data.choice&&data.choice.length&&($choice=data.choice.addClass("error"),$input=$choice.find("input"),$icon=$choice.find(" > label > span").addClass("error cross"),setTimeout(function(){$input.prop("checked",!1),$choice.removeClass("error"),$icon.removeClass("error cross")},350))}})},getContainer:containerHelper.get,setResponse:function(interaction,response){var $container=containerHelper.get(interaction);try{_.each(pciResponse.unserialize(response,interaction),
function(identifier){$container.find('input[value="'+identifier+'"]').prop("checked",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},getResponse:function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction);$("input",$container).prop("checked",!1)},destroy:function(interaction){containerHelper.get(interaction).find(".hottext").off("click"),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(
interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,blockHelperMissing=helpers.blockHelperMissing;function program7(depth0,data){var stack1
;return(stack1=typeof depth0===functionType?depth0.apply(depth0):depth0)||0===stack1?stack1:""}return buffer+="<select ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-inlineInteraction qti-inlineChoiceInteraction',((stack1=helpers.if.call(depth0,null==(
stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"\n        data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'"\n        data-qti-class="inlineChoiceInteraction"\n        data-has-search="false"\n        ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n>\n    <option></option>                \n    <option value="empty"></option>\n    ',options={hash:{},inverse:this.noop,
fn:this.program(7,program7,data),data:data},stack1=(helper=helpers.choices)?helper.call(depth0,options):typeof(helper=depth0&&depth0.choices)===functionType?helper.call(depth0,options):helper,helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:this.noop,fn:this.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</select>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container",
"taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","ui/tooltip","select2"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse,tooltip){"use strict";var _defaultOptions={allowEmpty:!0,placeholderText:__("select a choice")},_setVal=function(interaction,choiceIdentifier){containerHelper.get(interaction).val(choiceIdentifier).select2("val",choiceIdentifier)};return{qtiClass:"inlineChoiceInteraction",template:tpl,render:function(interaction,options){var choiceTooltip,opts=_.clone(_defaultOptions),required=!!interaction.attr("required"),$container=containerHelper.get(interaction)
;_.extend(opts,options),opts.allowEmpty&&!required?$container.find("option[value=empty]").text("--- "+__("leave empty")+" ---"):$container.find("option[value=empty]").remove(),$container.select2({width:"element",placeholder:opts.placeholderText,minimumResultsForSearch:-1,dropdownCssClass:"qti-inlineChoiceInteraction-dropdown"});var $el=$container.select2("container");required&&(choiceTooltip=tooltip.warning($el,__("A choice must be selected")),""===$container.val()&&choiceTooltip.show()),$container.on("change",function(e){if($(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")){var $selectedIndex=$(e.currentTarget
)[0].options.selectedIndex?$(e.currentTarget)[0].options.selectedIndex:null;$container.find("option").one("click",function(e){e.stopPropagation()}),$container.find("option").eq($selectedIndex).trigger("click")}required&&""!==$container.val()&&choiceTooltip.hide(),containerHelper.triggerResponseChangeEvent(interaction)}).on("select2-open",function(){required&&choiceTooltip.hide()}).on("select2-close",function(){required&&""===$container.val()&&choiceTooltip.show()})},getContainer:containerHelper.get,setResponse:function(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},getResponse:function(interaction){
return pciResponse.serialize(function(interaction){var value=containerHelper.get(interaction).val();return value&&"empty"!==value?[value]:[]}(interaction),interaction)},resetResponse:function(interaction){_setVal(interaction,"empty")},destroy:function(interaction){var $container=containerHelper.get(interaction);$(document).off(".commonRenderer"),$container.select2("destroy"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order
)&&state.order.length===_.size(interaction.getChoices())&&(($container=containerHelper.get(interaction)).select2("disable").select2("close"),$("option[data-identifier]",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($container),$container.select2("enable")))},getState:function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$(
"option[data-identifier]",$container).each(function(){state.order.push($(this).data("identifier"))})),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;function program9(depth0,data){var stack1;return(stack1=typeof depth0===functionType?depth0.apply(depth0):depth0
)||0===stack1?stack1:""}function program11(depth0,data,depth1){var stack1,buffer="";return buffer+="\n      <tr>\n        ",((stack1=typeof depth0===functionType?depth0.apply(depth0):depth0)||0===stack1)&&(buffer+=stack1),buffer+="\n        ",((stack1=helpers.each.call(depth0,depth1&&depth1.matchSet1,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      "}function program12(depth0,data){return'\n        <td>\n          <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n          </label>\n        </td>\n        '}
return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-matchInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:self.noop,fn:self.program(3,
function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="matchInteraction"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},
inverse:self.noop,fn:self.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n  ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper
)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <div class="match-interaction-area">\n    <table class="matrix">\n      <thead>\n      <tr>\n        <th> </th>\n        ',options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},stack1=(helper=helpers.matchSet1)?helper.call(depth0,options):typeof(helper=depth0&&depth0.matchSet1)===functionType?helper.call(depth0,options):helper,helpers.matchSet1||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n      </tr>\n      </thead>\n      <tbody>\n      ",options={hash:{},inverse:self.noop,fn:self.programWithDepth(11,program11,data,depth0),data:data},stack1=(helper=helpers.matchSet2)?helper.call(depth0,options):typeof(helper=depth0&&depth0.matchSet2)===functionType?helper.call(depth0,options):helper,helpers.matchSet2||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.programWithDepth(11,program11,data,depth0),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n      </tbody>\n    </table>\n  </div>\n  <div class="notification-container"></div>\n</div>\n'})}),define(
"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var inWarning=!1,_filterResponse=function(response){if(void 0===response.list){if(void 0===response.base)throw"The given response is not compliant with PCI JSON representation.";if(null===response.base)return{list:{directedPair:[]}};if(
void 0===response.base.directedPair)throw"The matchInteraction only accepts directedPair values as responses.";return{list:{directedPair:[response.base.directedPair]}}}if(void 0===response.list.directedPair)throw"The matchInteraction only accept directedPair values as responses.";return response},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),values=[];return $container.find("input[type=checkbox]:checked").each(function(){values.push(_inferValue(this))}),values},_inferValue=function(element){var $element=$(element),$container=$element.closest(".match-interaction-area"),y=$element.closest("tr").index(),
x=$element.closest("td").index();return[$(".matrix > thead th",$container).eq(x).data("identifier"),$(".matrix > tbody th",$container).eq(y).data("identifier")]},_onCheckboxSelected=function(interaction,e){var choice,currentResponse=_getRawResponse(interaction),maxAssociations=(interaction.attr("minAssociations"),interaction.attr("maxAssociations"));0===maxAssociations&&(maxAssociations=_countChoices(interaction)),_.size(currentResponse)>maxAssociations?(e.preventDefault(),instructionMgr.validateInstructions(interaction)):!1!==(choice=_maxMatchReached(interaction,e.target))?(e.preventDefault(),instructionMgr.validateInstructions(interaction,choice)):(
containerHelper.triggerResponseChangeEvent(interaction,{}),instructionMgr.validateInstructions(interaction))},_maxMatchReached=function(interaction,input){var association=_inferValue(input),overflow=!1;return _(association).forEach(function(identifier){var choice=_getChoiceDefinitionByIdentifier(interaction,identifier),matchMax=(choice.attributes.matchMin,choice.attributes.matchMax),assoc=_countAssociations(interaction,choice);0<matchMax&&matchMax<assoc&&(overflow=choice)}),overflow},_countAssociations=function(interaction,choice){var rawResponse=_getRawResponse(interaction),count=0;return _(rawResponse).forEach(function(response){
response[0]!==choice.attributes.identifier&&response[1]!==choice.attributes.identifier||count++}),count},_countChoices=function(interaction){return containerHelper.get(interaction).find("input[type=checkbox]").length},_getChoiceDefinitionByIdentifier=function(interaction,identifier){return _getRawChoices(interaction)[identifier]},_getRawChoices=function(interaction){var rawChoices={};return _(interaction.choices).forEach(function(matchset){_(matchset).forEach(function(choice){rawChoices[choice.attributes.identifier]=choice})}),rawChoices},_setInstructions=function(interaction){var msg,onMaxChoicesReached,onMatchMaxReached,minAssociations=interaction.attr(
"minAssociations"),maxAssociations=interaction.attr("maxAssociations"),choiceCount=_countChoices(interaction);onMaxChoicesReached=function(report,msg){!1===inWarning&&(inWarning=!0,report.update({level:"warning",message:__("Maximum number of choices reached."),timeout:2e3,stop:function(){report.update({level:"success",message:msg}),inWarning=!1}}))},onMatchMaxReached=function(interaction,choice,report,msg,level){var $container=containerHelper.get(interaction);if(!1===inWarning){inWarning=!0;var $choice=$container.find('.qti-simpleAssociableChoice[data-identifier="'+choice.attributes.identifier+'"]'),originalBackgroundColor=$choice.css("background-color"),
originalColor=$choice.css("color");report.update({level:"warning",message:__("The highlighted choice cannot be associated more than %d time(s).").replace("%d",choice.attributes.matchMax),timeout:3e3,start:function(){$choice.animate({backgroundColor:"#fff",color:"#ba122b"},250,function(){$choice.animate({backgroundColor:"#ba122b",color:"#fff"},250)})},stop:function(){$choice.animate({backgroundColor:originalBackgroundColor,color:originalColor},500),report.update({level:level,message:msg}),inWarning=!1}})}},0===minAssociations&&0<maxAssociations?(msg=__("You must select 0 to %d choices.").replace("%d",maxAssociations),instructionMgr.appendInstruction(
interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<=maxAssociations?this.setLevel("success"):maxAssociations<responseCount?onMaxChoicesReached(this,msg):this.reset()})):0===minAssociations&&0===maxAssociations?(msg=__("You must select 0 to %d choices.").replace("%d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(
interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):this.setLevel("success")})):0<minAssociations&&0===maxAssociations?(msg=(msg=(msg=__("You must select %1$d to %2$d choices.")).replace("%1$d",minAssociations)).replace("%2$d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<minAssociations?this.setLevel("info"
):choiceCount<responseCount?onMaxChoicesReached(this,msg):this.setLevel("success")})):0<minAssociations&&0<maxAssociations&&(msg=minAssociations!==maxAssociations?(msg=(msg=__("You must select %1$d to %2$d choices.")).replace("%1$d",minAssociations)).replace("%2$d",maxAssociations):(msg=__("You must select exactly %d choice(s).")).replace("%d",minAssociations),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,
this.getLevel()):responseCount<minAssociations?this.setLevel("info"):maxAssociations<responseCount?onMaxChoicesReached(this,msg):minAssociations<=responseCount&&responseCount<=maxAssociations&&this.setLevel("success")}))};return{qtiClass:"matchInteraction",template:tpl,render:function(interaction){var $container=containerHelper.get(interaction);_setInstructions(interaction),$container.on("click.commonRenderer","input[type=checkbox]",function(e){_onCheckboxSelected(interaction,e)}),instructionMgr.validateInstructions(interaction)},getContainer:containerHelper.get,setResponse:function(interaction,response){var $container=containerHelper.get(interaction)
;void 0!==(response=_filterResponse(response)).list&&void 0!==response.list.directedPair&&_(response.list.directedPair).forEach(function(directedPair){var x=$("th[data-identifier="+directedPair[0]+"]",$container).index()-1,y=$("th[data-identifier="+directedPair[1]+"]",$container).parent().index();$(".matrix > tbody tr",$container).eq(y).find("input[type=checkbox]").eq(x).prop("checked",!0)}),instructionMgr.validateInstructions(interaction)},getResponse:function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction);$(
"input[type=checkbox]:checked",$container).each(function(){$(this).prop("checked",!1)}),instructionMgr.validateInstructions(interaction)},destroy:function(interaction){containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(_.isArray(state.order)&&2===state.order.length&&($container=containerHelper.get(interaction),$("thead .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[0],$(a).data("identifier")),bIndex=_.indexOf(state.order[0],$(b).data("identifier"))
;return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($("thead tr",$container)),$("tbody .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[1],$(a).data("identifier")),bIndex=_.indexOf(state.order[1],$(b).data("identifier"));return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().each(function(index,elt){$(elt).prependTo($("tbody tr",$container).eq(index))})),state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)))},getState:function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),!0===interaction.attr("shuffle")&&(
$container=containerHelper.get(interaction),state.order=[[],[]],$("thead .qti-choice",$container).each(function(){state.order[0].push($(this).data("identifier"))}),$("tbody .qti-choice",$container).each(function(){state.order[1].push($(this).data("identifier"))})),state},inferValue:_inferValue}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression
;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-mediaInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,
function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(
depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(
buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="media-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","ui/mediaplayer"],function($,_,__,Promise,tpl,pciResponse,containerHelper,mediaplayer){"use strict";var defaults_type="video/mp4",defaults_video={width:480,height:270};return{qtiClass:"mediaInteraction",template:tpl,render:function(interaction){
var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),media=interaction.object,$item=$container.parents(".qti-item"),maxPlays=parseInt(interaction.attr("maxPlays"),10)||0,url=media.attr("data")||"",canBePlayed=function(){var current=parseInt($container.data("timesPlayed"),10);return 0===maxPlays||current<maxPlays},resize=_.debounce(function(){var width,height;interaction.mediaElement&&(height=$container.find(".media-container").height(),width=$container.find(".media-container").width(),interaction.mediaElement.resize(width,height))},200),initMediaPlayer=function(){interaction.mediaElement||(
interaction.mediaElement=mediaplayer({url:url&&self.resolveUrl(url),type:media.attr("type")||defaults_type,canPause:$container.hasClass("pause"),maxPlays:maxPlays,canSeek:!maxPlays,width:media.attr("width"),height:media.attr("height"),volume:100,autoStart:!!interaction.attr("autostart")&&canBePlayed(),loop:!!interaction.attr("loop"),renderTo:$(".media-container",$container)}).on("render",function(){resize(),$(window).off("resize.mediaInteraction").on("resize.mediaInteraction",resize),$item.off("resize.gridEdit").on("resize.gridEdit",resize),$container.trigger("playerrendered")}).on("ready",function(){$container.trigger("playerready"),canBePlayed(
)||this.disable(),resolve()}).on("update",_.throttle(function(){containerHelper.triggerResponseChangeEvent(interaction)},1e3)).on("ended",function(){$container.data("timesPlayed",$container.data("timesPlayed")+1),containerHelper.triggerResponseChangeEvent(interaction),canBePlayed()||this.disable()}))};0===_.size(media.attributes)&&(media.attr("type",defaults_type),media.attr("width",$container.innerWidth()),media.attr("height",defaults_video.height),media.attr("data","")),$container.data("timesPlayed")||$container.data("timesPlayed",0),$container.on("responseSet",function(){initMediaPlayer()}),initMediaPlayer()})},getContainer:containerHelper.get,
setResponse:function(interaction,response){var responseValues;if(response)try{responseValues=pciResponse.unserialize(response,interaction),containerHelper.get(interaction).data("timesPlayed",responseValues[0])}catch(e){}},getResponse:function(interaction){return pciResponse.serialize(function(interaction){return[containerHelper.get(interaction).data("timesPlayed")||0]}(interaction),interaction)},resetResponse:function(interaction){containerHelper.get(interaction).data("timesPlayed",0)},destroy:function(interaction){var $container=containerHelper.get(interaction);interaction.mediaElement&&(interaction.mediaElement.destroy(),interaction.mediaElement=null),$(
".instruction-container",$container).empty(),$(".media-container",$container).empty(),$container.removeData("timesPlayed"),$(window).off("resize.video"),containerHelper.reset(interaction)},setState:function(interaction,state){var restorePlayerState=function(playerState){playerState&&interaction.mediaElement&&(_.isNumber(playerState.volume)&&interaction.mediaElement.setVolume(playerState.volume),_.isBoolean(playerState.muted)&&(interaction.mediaElement.mute(playerState.muted),interaction.mediaElement.startMuted=playerState.muted),playerState.position&&0<playerState.position&&(interaction.mediaElement.seek(playerState.position),interaction.attr("autostart"
)||interaction.mediaElement.pause()))};_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isPlainObject(state.player)&&interaction.mediaElement&&(interaction.mediaElement.is("ready")?restorePlayerState(state.player):interaction.mediaElement.on("ready.state",function(){interaction.mediaElement.off("ready.state"),restorePlayerState(state.player)})))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),interaction.mediaElement&&(state.player={position:interaction.mediaElement.getPosition(),muted:interaction.mediaElement.is("muted"),
volume:interaction.mediaElement.getVolume()}),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,blockHelperMissing=helpers.blockHelperMissing;function program9(depth0,data){return"horizontal"}function program17(depth0,data){var stack1;return(stack1=typeof depth0===functionType?depth0.apply(depth0):depth0)||0===stack1?stack1:""}
function program19(depth0,data){return"icon-down"}function program21(depth0,data){return"icon-right"}function program23(depth0,data){return"icon-up"}function program25(depth0,data){return"icon-left"}return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+=' class="qti-interaction qti-blockInteraction qti-orderInteraction',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.program(5,function(depth0,data){return" qti-vertical"},data),fn:this.program(3,function(depth0,data){return" qti-horizontal"},data),data:data}))||0===stack1)&&(buffer+=stack1),((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class
)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"\n     data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"\n     data-qti-class="orderInteraction"\n     data-orientation="',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.program(11,function(depth0,data){return"vertical"},data),fn:this.program(9,program9,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"',((stack1=helpers.if.call(depth0,null==(
stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(13,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(15,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="order-interaction-area">\n        <ul class="choice-area square source solid block-listing ',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='">\n            ',options={hash:{},inverse:this.noop,fn:this.program(17,program17,data),data:data},stack1=(helper=helpers.choices)?helper.call(depth0,options
):typeof(helper=depth0&&depth0.choices)===functionType?helper.call(depth0,options):helper,helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:this.noop,fn:this.program(17,program17,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </ul>\n        <div class="arrow-bar middle">\n            <span class="icon-add-to-selection ',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.program(21,program21,data),fn:this.program(19,program19,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='"></span>\n            <span class="icon-remove-from-selection ',((
stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.program(25,program25,data),fn:this.program(23,program23,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n        </div>\n        <ul class="drag-container block-listing"></ul>\n        <ul class="result-area decimal target solid block-listing ',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.noop,fn:this.program(9,program9,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='">\n        </ul>\n        <div class="arrow-bar">\n            <span class="icon-move-before ',((stack1=helpers.if.call(depth0,
depth0&&depth0.horizontal,{hash:{},inverse:this.program(23,program23,data),fn:this.program(25,program25,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n            <span class="icon-move-after ',((stack1=helpers.if.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:this.program(19,program19,data),fn:this.program(21,program21,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n        </div>\n    </div>\n    <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",["lodash","jquery","i18n","core/mouseEvent",
"tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","interact","ui/interactUtils"],function(_,$,__,triggerMouseEvent,tpl,containerHelper,instructionMgr,pciResponse,interact,interactUtils){"use strict";var _freezeSize=function($container){var $orderArea=$container.find(".order-interaction-area");$orderArea.height($orderArea.height())},_setInstructions=function(interaction){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(
".result-area",$container),min=parseInt(interaction.attr("minChoices"),10),max=parseInt(interaction.attr("maxChoices"),10);if(min&&instructionMgr.appendInstruction(interaction,__("You must use at least %d choices",min),function(){$resultArea.find(">li").length>=min?this.setLevel("success"):this.reset()}),max&&max<_.size(interaction.getChoices())){var instructionMax=instructionMgr.appendInstruction(interaction,__("You can use maximum %d choices",max),function(){$resultArea.find(">li").length>=max?($choiceArea.find(">li").addClass("deactivated"),this.setMessage(__("Maximum choices reached"))):($choiceArea.find(">li").removeClass("deactivated"),this.reset())})
;interact($choiceArea.selector+" >li.deactivated").on("tap",function(e){var $target=$(e.currentTarget);$target.addClass("brd-error"),instructionMax.setLevel("warning",2e3),setTimeout(function(){$target.removeClass("brd-error")},150)}),interact($choiceArea.selector+" >li.deactivated").draggable({onstart:function(e){$(e.target).addClass("brd-error"),instructionMax.setLevel("warning")},onend:function(e){$(e.target).removeClass("brd-error"),instructionMax.setLevel("info")}}).styleCursor(!1)}},resetResponse=function(interaction){var $container=containerHelper.get(interaction),initialOrder=_.keys(interaction.getChoices()),$choiceArea=$(".choice-area",$container
).append($(".result-area>li",$container)),$choices=$choiceArea.children(".qti-choice");$container.find(".qti-choice.active").each(function(){interactUtils.tapOn(this)}),$choices.detach().sort(function(choice1,choice2){return _.indexOf(initialOrder,$(choice1).data("serial"))>_.indexOf(initialOrder,$(choice2).data("serial"))}),$choiceArea.prepend($choices)};return{qtiClass:"orderInteraction",getData:function(interaction,data){return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation")})},template:tpl,render:function(interaction){var isDragAndDropEnabled,dragOptions,$dropzoneElement,$container=containerHelper.get(interaction),
$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$iconAdd=$container.find(".icon-add-to-selection"),$iconRemove=$container.find(".icon-remove-from-selection"),$iconBefore=$container.find(".icon-move-before"),$iconAfter=$container.find(".icon-move-after"),$activeChoice=null,choiceSelector=$choiceArea.selector+" >li:not(.deactivated)",resultSelector=$resultArea.selector+" >li",$dragContainer=$container.find(".drag-container"),orientation=interaction.attr("orientation")?interaction.attr("orientation"):"vertical",_setSelection=function($choice){$activeChoice&&$activeChoice.removeClass("active"),($activeChoice=$choice
).addClass("active")},_resetSelection=function(){$activeChoice&&($activeChoice.removeClass("active"),$activeChoice=null),$iconAdd.removeClass("inactive"),$iconRemove.removeClass("active").addClass("inactive"),$iconBefore.removeClass("active").addClass("inactive"),$iconAfter.removeClass("active").addClass("inactive")},_addChoiceToSelection=function($target,position){var $results=$(resultSelector);_resetSelection(),void 0!==position&&position<$results.length?$results.eq(position).before($target):$resultArea.append($target),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},_toggleResultSelection=function(
$target){$target.hasClass("active")?_resetSelection():(_setSelection($target),$iconAdd.addClass("inactive"),$iconRemove.removeClass("inactive").addClass("active"),$iconBefore.removeClass("inactive").addClass("active"),$iconAfter.removeClass("inactive").addClass("active"))},_removeChoice=function(){$activeChoice&&($choiceArea.append($activeChoice),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)),_resetSelection()};function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){_isDropzoneVisible()&&interact($resultArea.selector).fire({type:"drop",target:$dropzoneElement.eq(0),
relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}function _isDropzoneVisible(){return $.contains($container.get(0),$dropzoneElement.get(0))}function _adjustDropzonePosition($dragged){var draggedBox=$dragged.get(0).getBoundingClientRect(),$prevResult=$dropzoneElement.prev(".qti-choice"),$nextResult=$dropzoneElement.next(".qti-choice"),prevMiddle=0<$prevResult.length&&_getMiddleOf($prevResult),nextMiddle=0<$nextResult.length&&_getMiddleOf($nextResult);"horizontal"!==orientation?(prevMiddle&&draggedBox.top<prevMiddle.y&&$prevResult.before($dropzoneElement),nextMiddle&&draggedBox.bottom>nextMiddle.y&&$nextResult.after(
$dropzoneElement)):(prevMiddle&&draggedBox.left<prevMiddle.x&&$prevResult.before($dropzoneElement),nextMiddle&&draggedBox.right>nextMiddle.x&&$nextResult.after($dropzoneElement))}function _getMiddleOf($element){var elementBox=$element.get(0).getBoundingClientRect();return{x:elementBox.left+elementBox.width/2,y:elementBox.top+elementBox.height/2}}interact($container.selector).on("tap",function(){_resetSelection()}),interact(choiceSelector).on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),$iconAdd.addClass("triggered"),setTimeout(function(){$iconAdd.removeClass("triggered")
},150),_addChoiceToSelection($target))}),interact(resultSelector).on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_toggleResultSelection($target))}),interact($iconRemove.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_removeChoice())}),interact($iconBefore.selector).on("tap",function(e){var $prev;$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),($prev=$activeChoice.prev()).length&&($prev.before($activeChoice),
containerHelper.triggerResponseChangeEvent(interaction)))}),interact($iconAfter.selector).on("tap",function(e){var $next;$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),($next=$activeChoice.next()).length&&($next.after($activeChoice),containerHelper.triggerResponseChangeEvent(interaction)))}),this.getOption&&this.getOption("enableDragAndDrop")&&this.getOption("enableDragAndDrop").order&&(isDragAndDropEnabled=this.getOption("enableDragAndDrop").order),isDragAndDropEnabled&&($dropzoneElement=$("<li>",{class:"dropzone qti-choice"}),$("<div>",{class:"qti-block"}).appendTo($dropzoneElement),dragOptions={inertia:!1,
autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector).draggable(_.assign({},dragOptions,{onstart:function(e){$(e.target).addClass("dragged"),_iFrameDragFix(choiceSelector,e.target)},onmove:function(e){var $target=$(e.target);interactUtils.moveElement(e.target,e.dx,e.dy),_isDropzoneVisible()&&_adjustDropzonePosition($target)},onend:function(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(resultSelector).draggable(_.assign({},dragOptions,{onstart:function(e){
var $target=$(e.target);$target.addClass("dragged"),_setSelection($target),$dragContainer.show(),$dragContainer.offset($target.offset()),"horizontal"===orientation?$dragContainer.width($(e.currentTarget).width()):$dragContainer.width($target.parent().width()),$dragContainer.append($target),_iFrameDragFix(resultSelector,e.target)},onmove:function(e){var $target=$(e.target);interactUtils.moveElement(e.target,e.dx,e.dy),_isDropzoneVisible()&&_adjustDropzonePosition($target)},onend:function(e){var $target=$(e.target),hasBeenDroppedInResultArea=$target.parent===$resultArea;$target.removeClass("dragged"),$dragContainer.hide(),
hasBeenDroppedInResultArea||_removeChoice(),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact($resultArea.selector).dropzone({overlap:.5,ondragenter:function(e){var $dragged=$(e.relatedTarget);!function($dragged){var insertPosition,draggedMiddle=_getMiddleOf($dragged),previousMiddle={x:0,y:0};$(resultSelector).each(function(index){var currentMiddle=_getMiddleOf($(this));if("horizontal"!==orientation){if(draggedMiddle.y>previousMiddle.y&&draggedMiddle.y<currentMiddle.y)return insertPosition=index,!1;previousMiddle.y=currentMiddle.y}else{if(
draggedMiddle.x>previousMiddle.x&&draggedMiddle.x<currentMiddle.x)return insertPosition=index,!1;previousMiddle.x=currentMiddle.x}}),void 0!==insertPosition?$(resultSelector).eq(insertPosition).before($dropzoneElement):$resultArea.append($dropzoneElement),$dropzoneElement.height($dragged.height()),$dropzoneElement.find("div").text($dragged.text())}($dragged),$dragged.addClass("droppable")},ondrop:function(e){var $dragged=$(e.relatedTarget),dropzoneIndex=$(resultSelector).index($dropzoneElement);this.ondragleave(e),_addChoiceToSelection($dragged,dropzoneIndex),interactUtils.restoreOriginalPosition($dragged)},ondragleave:function(e){var $dragged=$(
e.relatedTarget);$dropzoneElement.remove(),$dragged.removeClass("droppable")}})),_setInstructions(interaction),$(document).on("attributeChange.qti-widget.commonRenderer",function(e,data){data.element.getSerial()===interaction.getSerial()&&("maxChoices"!==data.key&&"minChoices"!==data.key||(instructionMgr.removeInstructions(interaction),_setInstructions(interaction),instructionMgr.validateInstructions(interaction)))}),_freezeSize($container)},getContainer:containerHelper.get,setResponse:function(interaction,response){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container);if(
null===response||_.isEmpty(response))resetResponse(interaction);else try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$resultArea.append($choiceArea.find("[data-identifier="+identifier+"]"))})}catch(e){throw new Error("wrong response format in argument : "+e)}instructionMgr.validateInstructions(interaction)},getResponse:function(interaction){return pciResponse.serialize(function(interaction){var $container=containerHelper.get(interaction),response=[];return $(".result-area>li",$container).each(function(){response.push($(this).data("identifier"))}),response}(interaction),interaction)},resetResponse:resetResponse,destroy:function(
interaction){var $container=containerHelper.get(interaction);[".choice-area >li:not(.deactivated)",".result-area >li",".icon-add-to-selection",".icon-remove-from-selection",".icon-move-before",".icon-move-after"].forEach(function(selector){interact($container.find(selector).selector).unset()}),$(document).off(".commonRenderer"),$container.find(".order-interaction-area").removeAttr("style"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order
)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return bIndex<aIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState:function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){
state.order.push($(this).data("identifier"))})),state}}}),define("qtiCustomInteractionContext",[],function(){"use strict";return window._pciHooks=window._pciHooks||{},{register:function(pciHook){var typeIdentifier="function"==typeof pciHook.getTypeIdentifier?pciHook.getTypeIdentifier():pciHook.typeIdentifier;if(!typeIdentifier)throw new Error("invalid PCI hook");window._pciHooks[typeIdentifier]=pciHook},notifyReady:function(pciInstance){},notifyDone:function(pciInstance){},onready:function(customInteraction,state){},ondone:function(customInteraction,response,state,status){},createPciInstance:function(pciTypeIdentifier){if(window._pciHooks[pciTypeIdentifier]
){var instance={},proto=window._pciHooks[pciTypeIdentifier];for(var name in proto)"function"==typeof proto[name]?instance[name]=proto[name]:null!==proto[name]&&"object"==typeof proto[name]?instance[name]=proto[name].constructor():instance[name]=proto[name];return instance}throw new Error("no portable custom interaction hook found with the id "+pciTypeIdentifier)}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator",["qtiCustomInteractionContext"],function(qtiCustomInteractionContext){"use strict";return{getPci:function(interaction){var pciTypeIdentifier,pci=interaction.data("pci");if(!pci){if(
pciTypeIdentifier=interaction.typeIdentifier,!(pci=qtiCustomInteractionContext.createPciInstance(pciTypeIdentifier)))throw new Error("no custom interaction hook found for the type "+pciTypeIdentifier);interaction.data("pci",pci),pci._taoCustomInteraction=interaction}return pci}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/common",["lodash","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator"],function(_,containerHelper,instanciator){"use strict";return function(runtime){return{getRequiredModules:function(){var requireEntries=[];return runtime.hook&&requireEntries.push(
runtime.hook.replace(/\.js$/,"")),_.forEach(runtime.libraries,function(lib){requireEntries.push(lib.replace(/\.js$/,""))}),_.forEach(runtime.stylesheets,function(stylesheet){requireEntries.push("css!"+stylesheet.replace(/\.css$/,""))}),requireEntries},createInstance:function(interaction,context){var id=interaction.attr("responseIdentifier"),pci=instanciator.getPci(interaction),properties=_.clone(interaction.properties),assetManager=context.assetManager,pciAssetManager={resolve:function(url){var resolved=assetManager.resolveBy("portableElementLocation",url);return resolved===url||_.isUndefined(resolved)?assetManager.resolve(url):resolved}};pci.initialize(id,
containerHelper.get(interaction).children().get(0),properties,pciAssetManager)},destroy:function(interaction){return instanciator.getPci(interaction).destroy()},setState:function(interaction,state){instanciator.getPci(interaction).setSerializedState(state)},getState:function(interaction){return instanciator.getPci(interaction).getSerializedState()}}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims",["lodash","core/logger","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator"],function(_,loggerFactory,containerHelper,instanciator){"use strict";var logger=loggerFactory(
"taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims"),pciReadyCallback=function(pci,state){logger.info("pciReadyCallback called on PCI "+pci.typeIdentifier)},pciDoneCallback=function(pci,response,state,status){logger.info("pciDoneCallback called on PCI "+pci.typeIdentifier)};return function(runtime){return{getRequiredModules:function(){var requireEntries=[];return _.forEach(runtime.modules,function(module,name){requireEntries.push(name)}),requireEntries},createInstance:function(interaction,context){var config,pci=instanciator.getPci(interaction),properties=_.clone(interaction.properties);_.forOwn(properties,function(propVal,propKey){
properties[propKey]=_.isArray(propVal)||_.isObject(propVal)?JSON.stringify(propVal):propVal}),config={properties:properties,templateVariables:{},boundTo:context.response||{},onready:pciReadyCallback,ondone:pciDoneCallback,status:"interacting"},pci.getInstance(containerHelper.get(interaction).get(0),config,context.state)},destroy:function(interaction){instanciator.getPci(interaction).oncompleted()},setState:_.noop,getState:function(interaction){return instanciator.getPci(interaction).getState()}}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,
partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="qti-interaction qti-customInteraction" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data
){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=(helper=helpers.markup)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.markup)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",["lodash","core/promise","core/logger",
"tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/common","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims","qtiCustomInteractionContext","taoQtiItem/qtiItem/helper/util","taoQtiItem/portableElementRegistry/ciRegistry"],function(_,Promise,loggerFactory,tpl,containerHelper,PortableElement,instanciator,commonPciRenderer,imsPciRenderer,qtiCustomInteractionContext,util,ciRegistry){"use strict"
;var _getPciRenderer=function(interaction){return interaction.data("pci-renderer")};return{qtiClass:"customInteraction",template:tpl,getData:function(customInteraction,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:function(interaction,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var state,id=interaction.attr("responseIdentifier"),typeIdentifier=interaction.typeIdentifier,assetManager=self.getAssetManager(),response={};options.state&&options.state[id]&&(state=options.state[id]),response[id]={
base:null},ciRegistry.loadRuntimes({include:[typeIdentifier]}).then(function(){var pciRenderer,runtime=ciRegistry.getRuntime(typeIdentifier);if(!runtime)return reject("The runtime for the pci cannot be found : "+typeIdentifier);!function(interaction,runtime){var pciRenderer;pciRenderer="IMSPCI"===runtime.model?imsPciRenderer(runtime):commonPciRenderer(runtime),interaction.data("pci-model",runtime.model),interaction.data("pci-renderer",pciRenderer)}(interaction,runtime),pciRenderer=_getPciRenderer(interaction),require(pciRenderer.getRequiredModules(),function(){var pci=instanciator.getPci(interaction);return pci?(pciRenderer.createInstance(interaction,{
response:response,state:state,assetManager:assetManager}),_.isFunction(pci.on)&&interaction.onPci("responseChange",function(){containerHelper.triggerResponseChangeEvent(interaction)}),resolve()):reject('Unable to initialize pci "'+id+'"')},reject)}).catch(function(error){reject('Error loading runtime "'+id+'": '+error)})})},getContainer:containerHelper.get,setResponse:function(interaction,response){instanciator.getPci(interaction).setResponse(response)},getResponse:function(interaction){return instanciator.getPci(interaction).getResponse()},resetResponse:function(interaction){instanciator.getPci(interaction).resetResponse()},destroy:function(interaction){
return _getPciRenderer(interaction).destroy(interaction)},getState:function(interaction){return _getPciRenderer(interaction).getState(interaction)},setState:function(interaction,serializedState){_getPciRenderer(interaction).setState(interaction,serializedState)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression
;return buffer+='<div class="qti-prompt-container" data-html-editable-container',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="qti-prompt" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-html-editable>',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"prompt",template:tpl,
getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(
stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-selectPointInteraction clearfix',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),
data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},
data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,
containerHelper,instructionMgr){"use strict";var getRawResponse=function(interaction){return interaction&&interaction.paper&&_.isArray(interaction.paper.points)?_.map(interaction.paper.points,function(point){return[point.x,point.y]}):[]},addPoint=function(interaction,point){var maxChoices=interaction.attr("maxChoices"),pointChange=function(){containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)};0<maxChoices&&getRawResponse(interaction).length>=maxChoices?instructionMgr.validateInstructions(interaction):(_.isArray(interaction.paper.points)||(interaction.paper.points=[]),graphic.createTarget(interaction.paper
,{point:point,create:function(target){interaction.isTouch&&target&&target.getBBox&&graphic.createTouchCircle(interaction.paper,target.getBBox()),interaction.paper.points.push(point),pointChange()},remove:function(){_.remove(interaction.paper.points,point),pointChange()}}))};return{qtiClass:"selectPointInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,
interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),function(interaction){var $container=containerHelper.get(interaction),$imageBox=$container.find(".main-image-box"),isResponsive=$container.hasClass("responsive"),image=interaction.paper.getById("bg-image-"+interaction.serial);interaction.paper.isTouch=!1,image.touchstart(function(){interaction.paper.isTouch=!0,image.untouchstart()}),image.click(function(event){addPoint(interaction,graphic.getPoint(event,interaction.paper,$imageBox,isResponsive))})}(interaction),
instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),choiceCount:!1,getResponse:getRawResponse,onError:function(data){data&&graphic.highlightError(data.target,"success")}})})},getContainer:containerHelper.get,setResponse:function(interaction,response){var responseValues;if(response&&interaction.paper)try{responseValues=pciResponse.unserialize(response,interaction),"single"===interaction.getResponseDeclaration().attr("cardinality")&&(responseValues=[responseValues]),_(responseValues).filter(function(point){return _.isArray(point)&&2===point.length}).forEach(function(point){addPoint(
interaction,{x:point[0],y:point[1]})})}catch(err){return}},getResponse:function(interaction){return pciResponse.serialize(getRawResponse(interaction),interaction)},resetResponse:function(interaction){interaction&&interaction.paper&&(interaction.paper.points=[],interaction.paper.forEach(function(element){"object"==typeof element.data("point")&&graphic.trigger(element,"click")}))},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(
interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(
helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<div ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-sliderInteraction',((
stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'" data-qti-class="sliderInteraction"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=" >\r\n    ",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper;return(stack1=(
helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\r\n    <div class="instruction-container"></div>\r\n</div>\r\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse",
"nouislider"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var _slideTo=function(options){options.sliderCurrentValue.find(".qti-slider-cur-value").text(options.value),options.sliderValue.val(options.value)};return{qtiClass:"sliderInteraction",template:tpl,render:function(interaction){var attributes=interaction.getAttributes(),$container=interaction.getContainer(),$el=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider",class:"qti-slider"}),$sliderLabels=$("<div />").attr({class:"qti-slider-values"}),$sliderCurrentValue=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider-cur-value",
class:"qti-slider-cur-value"}),$sliderValue=$("<input />").attr({type:"hidden",id:attributes.responseIdentifier+"-qti-slider-value"}),orientation="horizontal",reverse=!(void 0===attributes.reverse||!attributes.reverse),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),step=void 0!==attributes.step&&attributes.step?parseInt(attributes.step):1,steps=(max-min)/step;$sliderCurrentValue.append('<span class="qti-slider-cur-value-text">'+__("Current value:")+" </span>").append('<span class="qti-slider-cur-value"></span>'),$sliderLabels.append('<span class="slider-min">'+(reverse?max:min)+"</span>").append('<span class="slider-max">'+(
reverse?min:max)+"</span>"),interaction.getContainer().append($el).append($sliderLabels).append($sliderCurrentValue).append($sliderValue),void 0!==attributes.orientation&&-1<$.inArray(attributes.orientation,["horizontal","vertical"])&&(orientation=attributes.orientation);var sliderSize=0;"horizontal"===orientation?$container.addClass("qti-slider-horizontal"):(300<(sliderSize=20*steps)&&(sliderSize=300),$container.addClass("qti-slider-vertical"),$el.height(sliderSize+"px"),$sliderLabels.height(sliderSize+"px"));if(void 0!==attributes.stepLabel&&attributes.stepLabel){var middleStep=parseInt(steps/2),leftOffset=100/steps*middleStep,
middleValue=reverse?max-middleStep*step:min+middleStep*step;"horizontal"===orientation?$sliderLabels.find(".slider-min").after('<span class="slider-middle" style="left:'+leftOffset+'%">'+middleValue+"</span>"):$sliderLabels.find(".slider-min").after('<span class="slider-middle" style="top:'+leftOffset+'%">'+middleValue+"</span>")}$el.noUiSlider({start:reverse?max:min,range:{min:min,max:max},step:step,orientation:orientation}).on("slide",function(e){var val=parseInt($(this).val());interaction.attr("reverse")&&(val=max+min-val),val=Math.round(1e3*val)/1e3,_slideTo({value:val,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),
containerHelper.triggerResponseChangeEvent(interaction)}),_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue})},getContainer:containerHelper.get,setResponse:function(interaction,response){var value,attributes=interaction.getAttributes(),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound);value=pciResponse.unserialize(response,interaction)[0],_slideTo({value:value,sliderValue:$sliderValue,
sliderCurrentValue:$sliderCurrentValue}),$el.val(interaction.attr("reverse")?max+min-value:value)},getResponse:function(interaction){return pciResponse.serialize([function(interaction){var value,attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),min=parseInt(attributes.lowerBound),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value");return"integer"===baseType?value=parseInt($sliderValue.val()):"float"===baseType&&(value=parseFloat($sliderValue.val())),isNaN(value)?min:value}(interaction)],interaction)},resetResponse:function(interaction){var attributes=interaction.getAttributes(),$el=$(
"#"+attributes.responseIdentifier+"-qti-slider"),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),startValue=void 0!==attributes.reverse&&attributes.reverse?max:min;_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(startValue)},destroy:function(interaction){interaction.getContainer().empty(),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),
interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+="<input ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{
hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-inlineInteraction qti-textEntryInteraction',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(
stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="textEntryInteraction" type="text">\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",
"taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/patternMask","util/locale","ui/tooltip"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse,patternMaskHelper,locale,tooltip){"use strict";var createTooltip=function($input,theme,message,forceCreation,hidden){var textEntryTooltip;textEntryTooltip=forceCreation||!$input.data("$tooltip")?tooltip.create($input,message,{theme:theme,trigger:"manual"}):($input.data("$tooltip").dispose(),$input.removeData("$tooltip"),tooltip.create($input,message,{
theme:"info",trigger:"manual"})),$input.data("$tooltip",textEntryTooltip),hidden||$input.data("$tooltip").show()};return{qtiClass:"textEntryInteraction",template:tpl,render:function(interaction){var expectedLength,updateConstraintTooltip,attributes=interaction.getAttributes(),$input=interaction.getContainer(),patternMask=interaction.attr("patternMask"),maxChars=parseInt(patternMaskHelper.parsePattern(patternMask,"chars"),10);attributes.expectedLength&&(expectedLength=parseInt(attributes.expectedLength)+2,$input.css("width",expectedLength+"ch"),$input.css("min-width",expectedLength+"ch")),attributes.placeholderText&&$input.attr("placeholder",
attributes.placeholderText),maxChars?(updateConstraintTooltip=function(){var message,count=$input.val().length;maxChars<=count?($input.addClass("maxed"),createTooltip($input,"warning",__("%d/%d",count,maxChars),!0)):(message=count?__("%d/%d",count,maxChars):__("%d characters allowed",maxChars),$input.hasClass("maxed")?($input.removeClass("maxed"),createTooltip($input,"info",message,!0)):createTooltip($input,"info",message))},$input.attr("maxlength",maxChars).on("focus.commonRenderer keydown.commonRenderer",updateConstraintTooltip).on("keyup.commonRenderer",function(){updateConstraintTooltip(),containerHelper.triggerResponseChangeEvent(interaction)}).on(
"blur.commonRenderer",function(){$input.data("$tooltip").hide()})):attributes.patternMask?(createTooltip($input,"error",__("This is not a valid answer"),!0,!0),$input.on("keyup.commonRenderer",_.debounce(function(){new RegExp(attributes.patternMask).test($input.val())?$input.removeClass("invalid").data("$tooltip").hide():$input.addClass("invalid").data("$tooltip").show(),containerHelper.triggerResponseChangeEvent(interaction)},600)).on("keydown.commonRenderer",function(){$input.data("$tooltip").hide()})):$input.on("keyup.commonRenderer",function(){containerHelper.triggerResponseChangeEvent(interaction)})},getContainer:containerHelper.get,
setResponse:function(interaction,response){var responseValue;try{responseValue=pciResponse.unserialize(response,interaction)}catch(e){}responseValue&&responseValue.length&&interaction.getContainer().val(responseValue[0])},getResponse:function(interaction){var value,ret={base:{}},$input=interaction.getContainer(),attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),numericBase=attributes.base||10;return $input.hasClass("invalid")||attributes.placeholderText&&$input.val()===attributes.placeholderText?value="":"integer"===baseType?value=locale.parseInt($input.val(),numericBase
):"float"===baseType?value=locale.parseFloat($input.val()):"string"===baseType&&(value=$input.val()),ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value,ret},resetResponse:function(interaction){interaction.getContainer().val("")},destroy:function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},
response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}
):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n\t",((stack1=helpers.if.call(depth0,depth0&&depth0.prompt,{hash:{},
inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,helper;return(stack1=(helper=helpers.prompt)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.prompt)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1?stack1:""},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n\t<div class="instruction-container"></div>\n    <div class="file-upload fixed-grid-row lft">\n        <div class="progressbar"></div>\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n        <input type="file" ',((stack1=helpers.if.call(depth0,
depth0&&depth0.accept,{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,helper,buffer="";return buffer+='accept="',stack1=(helper=helpers.accept)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.accept)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='/>\n    </div>\n    <div class="file-upload-preview lft visible-file-upload-preview runtime-visible-file-upload-preview">\n        <p class="nopreview">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(
depth0,"No preview available",options):helperMissing.call(depth0,"__","No preview available",options)))+'</p>\n    </div>\n    <div class="file-upload-preview-popup modal">\n        <div class="modal-body">\n        </div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",["jquery","lodash","i18n","context","core/mimetype","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/uploadMime","ui/progressbar","ui/previewer","ui/modal",
"ui/waitForMedia"],function($,_,__,context,mimetype,tpl,containerHelper,instructionMgr,uploadHelper){"use strict";var _initialInstructions=__("Browse your computer and select the appropriate file."),_readyInstructions=__("The selected file is ready to be sent."),_handleSelectedFiles=function(interaction,file,messageWrongType){var reader,$container=containerHelper.get(interaction),filename=file.name,filetype=mimetype.getMimeType(file);if(instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions),!function(file,interaction){var expectedTypes=uploadHelper.getExpectedTypes(interaction,!0),
filetype=mimetype.getMimeType(file);return!expectedTypes.length||0<=_.indexOf(expectedTypes,filetype)}(file,interaction))return instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,function(interaction,userSelectedType,messageWrongType){var types=uploadHelper.getExpectedTypes(interaction),expectedTypeLabels=_.map(_.uniq(types),function(type){var mime=_.find(uploadHelper.getMimeTypes(),{mime:type});return mime?mime.label:type});return messageWrongType&&_.isFunction(messageWrongType)?messageWrongType({userSelectedType:userSelectedType,types:expectedTypeLabels}):__(
'Wrong type of file. Expected %s. The selected file has the mimetype "%s".',expectedTypeLabels.join(__(" or ")),userSelectedType)}(interaction,filetype,messageWrongType),function(){this.setLevel("error")}),void instructionMgr.validateInstructions(interaction);$container.find(".file-name").empty().append(filename),(reader=new FileReader).onload=function(e){var base64Data,commaPosition,base64Raw,$previewArea;instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_readyInstructions,function(){this.setLevel("success")}),instructionMgr.validateInstructions(interaction),$container.find(".progressbar").progressbar("value",100),
commaPosition=(base64Data=e.target.result).indexOf(","),base64Raw=base64Data.substring(commaPosition+1),interaction.data("_response",{base:{file:{data:base64Raw,mime:filetype,name:filename}}}),($previewArea=$container.find(".file-upload-preview")).previewer({url:base64Data,name:filename,mime:filetype}),$previewArea.waitForMedia(function(){var imgNaturalWidth,isOversized,modalWidth,$originalImg=$previewArea.find("img"),$largeDisplay=$(".file-upload-preview-popup"),itemWidth=$(".qti-item").width(),winWidth=$(window).width()-80,fullHeight=$("body").height();$originalImg.length&&(imgNaturalWidth=$originalImg[0].naturalWidth,isOversized=itemWidth<imgNaturalWidth,
modalWidth=Math.min(winWidth,imgNaturalWidth),$previewArea.toggleClass("clickable",isOversized),isOversized&&$previewArea.on("click",function(){$(".upload-ia-modal-bg").remove(),$largeDisplay.find(".modal-body").empty().append($originalImg.clone()),$largeDisplay.on("opened.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","hidden"),$largeDisplay.css({width:modalWidth,height:fullHeight,left:(modalWidth-itemWidth-40)/-2})}).on("closed.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","auto")}).modal({modalOverlayClass:"modal-bg upload-ia-modal-bg"})}))})},reader.onloadstart=function(){
instructionMgr.removeInstructions(interaction),$container.find(".progressbar").progressbar("value",0)},reader.onprogress=function(e){var percentProgress=Math.ceil(Math.round(e.loaded)/Math.round(e.total)*100);$container.find(".progressbar").progressbar("value",percentProgress)},reader.readAsDataURL(file)},_resetGui=function(interaction){var $container=containerHelper.get(interaction);$container.find(".file-name").text(__("No file selected")),$container.find(".btn-info").text(__("Browse..."))};return{qtiClass:"uploadInteraction",template:tpl,render:function(interaction){var changeListener,$input,self=this,$container=containerHelper.get(interaction);if(
_resetGui(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions),interaction.data("_response",{base:null}),changeListener=function(e){var file=e.target.files[0];void 0!==file&&_handleSelectedFiles(interaction,file,self.getCustomMessage("upload","wrongType"))},$input=$container.find("input"),$container.find(".progressbar").progressbar(),!window.FileReader)throw new Error("FileReader API not supported! Please use a compliant browser!");$input.bind("change",changeListener),$input.bind("mousedown",function(e){return e.preventDefault(),$(this).blur(),!1})},getContainer:containerHelper.get,setResponse:function(interaction,response){
var filename,$container=containerHelper.get(interaction);null!==response.base&&(filename=void 0!==response.base.file.name?response.base.file.name:"previously-uploaded-file",$container.find(".file-name").empty().text(filename)),interaction.data("_response",response)},getResponse:function(interaction){return interaction.data("_response")},resetResponse:function(interaction){_resetGui(interaction)},destroy:function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state
)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},getData:function(interaction,data){return _.merge(data||{},{accept:uploadHelper.getExpectedTypes(interaction,!0).join(",")})},resetGui:_resetGui}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",
escapeExpression=this.escapeExpression;return buffer+='<div class="qti-item tao-scope runtime" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier)===functionType?stack1.apply(depth0):stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0
,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+=' id="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.id)===functionType?stack1.apply(depth0):stack1)+'"'},data),
data:data}))||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-itemBody ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='">',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}
):helper)||0===stack1)&&(buffer+=stack1),buffer+='</div>\n    <div id="modalFeedbacks"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/Item",["tpl!taoQtiItem/qtiCommonRenderer/tpl/item","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler"],function(tpl,containerHelper,itemStylesheetHandler){"use strict";return{qtiClass:"assessmentItem",template:tpl,getContainer:containerHelper.get,render:function(item){containerHelper.targetBlank(containerHelper.get(item)),itemStylesheetHandler.attach(item.stylesheets)},destroy:function(item){containerHelper.clear(),
item.stylesheets&&itemStylesheetHandler.detach(item.stylesheets)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/math",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program2(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'}return(stack1=helpers.if.call(
depth0,depth0&&depth0.block,{hash:{},inverse:self.program(4,function(depth0,data){var stack1,helper,buffer="";return buffer+='<span data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="math"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="><math>",((stack1=(helper=helpers.raw)?helper.call(depth0,{
hash:{},data:data}):typeof(helper=depth0&&depth0.raw)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</math></span>"},data),fn:self.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+='<span data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="math"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:self.noop,
fn:self.program(2,program2,data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='><math display="block">',((stack1=(helper=helpers.raw)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.raw)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</math></span>"},data),data:data}))||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Math",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/math","taoQtiItem/qtiCommonRenderer/helpers/container","mathJax"],function(_,Promise,tpl,containerHelper,MathJax){"use strict";return void 0!==MathJax&&MathJax&&(
MathJax.Hub.processSectionDelay=0),{qtiClass:"math",template:tpl,getContainer:containerHelper.get,render:function(math){return new Promise(function(resolve){void 0!==MathJax&&MathJax?(window.MathJax||(window.MathJax=MathJax),_.defer(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,containerHelper.get(math).parent()[0]]),MathJax.Hub.Queue(resolve)})):resolve()})}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",
functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div id="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.identifier
)===functionType?stack1.apply(depth0):stack1)+'" class="',((stack1=helpers.unless.call(depth0,depth0&&depth0.inline,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){return"modal "},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="qti-modalFeedback ",stack1=(helper=helpers.feedbackStyle)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.feedbackStyle)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(3,function(
depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.title,{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+='<h2 class="qti-title modal-title">'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.title
)===functionType?stack1.apply(depth0):stack1)+"</h2>"},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="modal-body">',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>"})}),define("taoQtiItem/qtiItem/helper/container",["lodash","jquery"],function(_,$){"use strict";var _prefix="x-tao-";function _checkContainerType(element){if(_.isFunction(element.initContainer)&&_.isFunction(element.body))return!0;throw"the element is not of a container type"}
function _getBodyDom(element){if(_checkContainerType(element))return $("<div>").html(element.body()).find(".x-tao-wrapper")}function _setBodyDomClass(element,newClass,oldClass){if(_checkContainerType(element)&&(oldClass||newClass)){var $wrapper=$("<div>").html(element.body());_setDomClass($wrapper,newClass,oldClass),element.body($wrapper.html())}}function _setDomClass($wrapper,newClass,oldClass){var $bodyDom=$wrapper.find(".x-tao-wrapper");$bodyDom.length||($wrapper.wrapInner('<div class="x-tao-wrapper">'),$bodyDom=$wrapper.find(".x-tao-wrapper")),oldClass&&$bodyDom.removeClass(oldClass),newClass&&$bodyDom.addClass(newClass)}function _getEncodedDataString(
dataName,value){return dataName&&value?_prefix+dataName+"-"+value:""}function getEncodedData(element,dataName){var regex,matches,$body=_getBodyDom(element);if(dataName&&$body&&$body.length&&$body.attr("class")&&(regex=new RegExp(_prefix+dataName+"-([a-zA-Z0-9-._]*)"),matches=$body.attr("class").match(regex)))return matches[1]}return{setEncodedData:function(element,dataName,newValue){var oldValue=getEncodedData(element,dataName);return _setBodyDomClass(element,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue))},hasEncodedData:function(element,dataName,value){var $body=_getBodyDom(element);return!!(
$body&&$body.length&&dataName&&value)&&$body.hasClass(_getEncodedDataString(dataName,value))},getEncodedData:getEncodedData,removeEncodedData:function(element,dataName){var oldValue=getEncodedData(element,dataName);dataName&&oldValue&&_setBodyDomClass(element,"",_getEncodedDataString(dataName,oldValue))},setEncodedDataToDom:function($wrapper,dataName,newValue,oldValue){_setDomClass($wrapper,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue))}}}),define("taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback","taoQtiItem/qtiCommonRenderer/helpers/container",
"taoQtiItem/qtiItem/helper/container","ui/waitForMedia","ui/modal"],function(_,tpl,containerHelper,coreContainerHelper){"use strict";var modalFeedbackRenderer={qtiClass:"modalFeedback",template:tpl,getContainer:containerHelper.get,minHeight:200,width:600,getData:function(fb,data){var feedbackStyle=coreContainerHelper.getEncodedData(fb,"modalFeedback");return data.feedbackStyle=feedbackStyle,data},render:function(modalFeedback,data){data=data||{};var $modal=containerHelper.get(modalFeedback);$modal.waitForMedia(function(){$modal.on("opened.modal",function(){var $itemBody=containerHelper.get(modalFeedback.getRootElement()).children(".qti-itemBody"),
requiredHeight=$modal.outerHeight()+parseInt($modal.css("top"));requiredHeight>$itemBody.height()&&$itemBody.height(requiredHeight)}).on("closed.modal",function(){_.isFunction(data.callback)&&data.callback.call(this)}).modal({startClosed:!1,minHeight:modalFeedbackRenderer.minHeight,width:modalFeedbackRenderer.width})})}};return modalFeedbackRenderer}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",
escapeExpression=this.escapeExpression;return buffer+='<div class="qti-object-container" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"]
)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=" >\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Object",["tpl!taoQtiItem/qtiCommonRenderer/tpl/object","taoQtiItem/qtiCommonRenderer/helpers/container","ui/previewer"],function(tpl,containerHelper){"use strict";return{qtiClass:"object",template:tpl,getContainer:containerHelper.get,render:function(obj){var $container=containerHelper.get(obj),previewOptions={url:obj.renderer.resolveUrl(obj.attr("data")),mime:obj.attr("type")};obj.attr("height")&&(previewOptions.height=obj.attr("height")),obj.attr("width")&&(
previewOptions.width=obj.attr("width")),previewOptions.url&&previewOptions.mime&&$container.previewer(previewOptions)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="qti-infoControl',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(1,
function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(3,function(
depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",((stack1=(helper=helpers.markup)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.markup)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("qtiInfoControlContext",[],function(){return window._picHooks=window._picHooks||{},{register:function(picHook){
window._picHooks[picHook.getTypeIdentifier()]=picHook},notifyReady:function(picInstance){},createPciInstance:function(typeIdentifier){if(window._picHooks[typeIdentifier]){var instance={},proto=window._picHooks[typeIdentifier];for(var name in proto)"function"==typeof proto[name]?instance[name]=proto[name]:null!==proto[name]&&"object"==typeof proto[name]?instance[name]=proto[name].constructor():instance[name]=proto[name];return instance}throw"no portable info control hook found with the id "+typeIdentifier}}}),define("taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl",
"taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","qtiInfoControlContext","taoQtiItem/qtiItem/helper/util","taoQtiItem/portableElementRegistry/icRegistry"],function(_,Promise,tpl,containerHelper,PortableElement,qtiInfoControlContext,util,icRegistry){"use strict";var _getPic=function(infoControl){var typeIdentifier,pic=infoControl.data("pic")||void 0;if(!pic){if(typeIdentifier=infoControl.typeIdentifier,!(pic=qtiInfoControlContext.createPciInstance(typeIdentifier)))throw"no custom infoControl hook found for the type "+typeIdentifier;infoControl.data("pic",pic),pic._taoInfoControl=infoControl}return pic}
;return{qtiClass:"infoControl",template:tpl,getData:function(infoControl,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:function(infoControl,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var state={},id=infoControl.attr("id"),typeIdentifier=infoControl.typeIdentifier,config=infoControl.properties,$dom=containerHelper.get(infoControl).children(),assetManager=self.getAssetManager();icRegistry.loadRuntimes().then(function(){var requireEntries=[],runtime=icRegistry.getRuntime(typeIdentifier);if(
!runtime)return reject("The runtime for the pic cannot be found : "+typeIdentifier);runtime.hook&&requireEntries.push(runtime.hook.replace(/\.js$/,"")),_.forEach(runtime.libraries,function(module){requireEntries.push(module.replace(/\.js$/,""))}),_.forEach(runtime.stylesheets,function(stylesheet){requireEntries.push("css!"+stylesheet.replace(/\.css$/,""))}),require(requireEntries,function(){var pic=_getPic(infoControl),picAssetManager={resolve:function(url){var resolved=assetManager.resolveBy("portableElementLocation",url);return resolved===url?assetManager.resolveBy("baseUrl",url):resolved}};return pic?(pic.initialize(id,$dom[0],config,picAssetManager),
pic.setSerializedState(state),resolve()):reject("Unable to initialize pic : "+id)},reject)}).catch(function(error){reject("Error loading runtime : "+id)})})},getContainer:containerHelper.get,destroy:function(infoControl){_getPic(infoControl).destroy()},getState:function(infoControl){return _getPic(infoControl).getSerializedState()},setState:function(infoControl,state){_getPic(infoControl).setSerializedState(state)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/printedVariable",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="printedVariable"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(
stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=(helper=helpers.value)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.value)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable",["tpl!taoQtiItem/qtiCommonRenderer/tpl/printedVariable","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"printedVariable",
template:tpl,getContainer:containerHelper.get}}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(_,Element){return{convertChoices:function(choices,outputType){var ret=[],_this=this;return _.each(choices,function(c){if(Element.isA(c,"choice"))switch(outputType){case"serial":ret.push(c.getSerial());break;case"identifier":ret.push(c.id());break;default:ret.push(c)}else _.isArray(c)&&ret.push(_this.convertChoices(c,outputType))}),ret},findChoices:function(interaction,choices,inputType){var ret=[],_this=this;return _.each(choices,function(c){var choice;_.isString(c)?"serial"===inputType?(
choice=interaction.getChoice(c))&&ret.push(choice):"identifier"===inputType?(choice=interaction.getChoiceByIdentifier(c))&&ret.push(choice):ret.push(c):_.isArray(c)?ret.push(_this.findChoices(interaction,c,inputType)):ret.push(c)}),ret},shuffleChoices:function(choices){var r=[],f={},j=0;for(var i in choices){if(!Element.isA(choices[i],"choice"))throw"invalid element in array: is not a qti choice";var choice=choices[i];choice.attr("fixed")&&(f[j]=choice),r.push(choice),j++}for(var n=0;n<r.length-1;n++)if(!f[n]){for(var k=-1;f[k=n+Math.floor(Math.random()*(r.length-n))];);var tmp=r[k];r[k]=r[n],r[n]=tmp}return r},serialToIdentifier:function(interaction,
choiceSerial){var choice=interaction.getChoice(choiceSerial);return choice?choice.id():""}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","core/promise","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper","ui/themeLoader","ui/themes"],function(_,$,Handlebars,Promise,Element,interactionHelper,themeLoader,themesHelper){"use strict";var _renderableClasses=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","_tooltip","img","math","object","table","modalFeedback","rubricBlock","associateInteraction","choiceInteraction",
"extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","customInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice","infoControl","include","printedVariable"],_dependencies={assessmentItem:["stylesheet","_container","prompt","modalFeedback"],rubricBlock:[
"_container"],associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},_renderableSubclasses={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]},_defaults={shuffleChoices:!0}
;var Renderer=function(options){var _locations={},_renderers={};options=_.defaults(options||{},_defaults),this.isRenderer=!0,this.name="",this.shuffledChoices=[];var _getClassRenderer=function(qtiClass){var ret=null;if(_renderers[qtiClass])ret=_renderers[qtiClass];else{var pos=qtiClass.indexOf(".");0<pos&&(qtiClass=qtiClass.slice(0,pos),_renderers[qtiClass]&&(ret=_renderers[qtiClass]))}return ret};function registerRendererClass(qtiClass,list){var success=!1;return!1===_locations[qtiClass]?success=!(_renderers[qtiClass]=!1):_locations[qtiClass]&&(list.push(_locations[qtiClass]),success=!0),success}this.setOption=function(key,value){
return"string"==typeof key&&(options[key]=value),this},this.setOptions=function(opts){return options=_.extend(options,opts),this},this.getOption=function(key){return"string"==typeof key&&options[key]?options[key]:null},this.getCustomMessage=function(elementName,messageKey){var messages=this.getOption("messages");return messages&&elementName&&messages[elementName]&&_.isString(messages[elementName][messageKey])?Handlebars.compile(messages[elementName][messageKey]):null},this.getAssetManager=function(){return options.assetManager},this.getThemeLoader=function(){return this.themeLoader},this.renderTpl=function(element,data,qtiSubclass){var res,ret="",
qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass),decorators=this.getOption("decorators");if(!renderer||!_.isFunction(renderer.template))throw new Error("no renderer template loaded under the class name : "+qtiClass);return _.isObject(decorators)&&_.isFunction(decorators.before)&&(res=decorators.before(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret+=renderer.template(data),_.isObject(decorators)&&_.isFunction(decorators.after)&&(res=decorators.after(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret},this.getData=function(element,data,qtiSubclass){var ret=data,qtiClass=qtiSubclass||element.qtiClass,
renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.getData&&(ret=renderer.getData.call(this,element,data)),ret},this.renderDirect=function(tpl,data){return Handlebars.compile(tpl)(data)},this.getContainer=function(qtiElement,$scope,qtiSubclass){var qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer found for the class : "+qtiElement.qtiClass;return renderer.getContainer(qtiElement,$scope)},this.postRender=function(qtiElement,data,qtiSubclass){var qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(
renderer&&"function"==typeof renderer.render)return renderer.render.call(this,qtiElement,data)},this.setResponse=function(qtiInteraction,response,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;if("function"==typeof renderer.setResponse){ret=renderer.setResponse.call(this,qtiInteraction,response);var $container=renderer.getContainer.call(this,qtiInteraction);$container instanceof $&&$container.length&&$container.trigger("responseSet",[qtiInteraction,response])}return ret},this.getResponse=function(qtiInteraction,qtiSubclass){
var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.getResponse&&(ret=renderer.getResponse.call(this,qtiInteraction)),ret},this.resetResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.resetResponse&&(ret=renderer.resetResponse.call(this,qtiInteraction)),ret},this.getState=function(qtiInteraction,qtiSubclass){
var qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return _.isFunction(renderer.getState)?renderer.getState.call(this,qtiInteraction):renderer.getResponse.call(this,qtiInteraction)},this.setState=function(qtiInteraction,state,qtiSubclass){var qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;_.isFunction(renderer.setState)?renderer.setState.call(this,qtiInteraction,state):(renderer.resetResponse.call(this,qtiInteraction),renderer.setResponse.call(this,
qtiInteraction,state))},this.destroy=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return _.isFunction(renderer.destroy)&&(ret=renderer.destroy.call(this,qtiInteraction)),ret},this.getLoadedRenderers=function(){return _renderers},this.register=function(renderersLocations){_.extend(_locations,renderersLocations)},this.load=function(callback,requiredClasses){var self=this,required=[],themeData=themesHelper.getCurrentThemeData();if(themeData&&(options.themes=themeData),options.themes&&(
options.themes.base=this.resolveUrl(options.themes.base),_.forEach(options.themes.available,function(theme,index){options.themes.available[index].path=self.resolveUrl(theme.path)}),this.themeLoader=themeLoader(options.themes).load(options.preload)),requiredClasses){if(!_.isArray(requiredClasses))throw new Error('invalid argument type: expected array for arg "requireClasses"');requiredClasses=_.intersection(requiredClasses,_renderableClasses),_.each(requiredClasses,function(reqClass){var deps=_dependencies[reqClass];deps&&(requiredClasses=_.union(requiredClasses,deps))}),_.forEach(requiredClasses,function(qtiClass){var requiredSubClasses;if(
_renderableSubclasses[qtiClass])requiredSubClasses=_.intersection(requiredClasses,_renderableSubclasses[qtiClass]),_.each(requiredSubClasses,function(subclass){if(!registerRendererClass(qtiClass+"."+subclass,required)&&!registerRendererClass(qtiClass,required))throw new Error(self.name+" : missing qti class location declaration: "+qtiClass+", subclass: "+subclass)});else if(!registerRendererClass(qtiClass,required))throw new Error(self.name+" : missing qti class location declaration: "+qtiClass)})}else required=_.values(_locations);return require(required,function(){_.each(arguments,function(clazz){(function(renderer){var valid=!0;if(
"object"!=typeof renderer)return!1;var classCorrect=!1;if(renderer.qtiClass)if(0<=_.indexOf(_renderableClasses,renderer.qtiClass))classCorrect=!0;else{var pos=renderer.qtiClass.indexOf(".");if(0<pos){var qtiClass=renderer.qtiClass.slice(0,pos),subClass=renderer.qtiClass.slice(pos+1);_renderableSubclasses[qtiClass]&&0<=_.indexOf(_renderableSubclasses[qtiClass],subClass)&&(classCorrect=!0)}}if(!classCorrect)throw valid=!1,new Error("invalid qti class name in renderer declaration : "+renderer.qtiClass);if(!renderer.template)throw valid=!1,new Error("missing template in renderer declaration : "+renderer.qtiClass);return valid})(clazz)&&(
_renderers[clazz.qtiClass]=clazz)}),"function"==typeof callback&&callback.call(self,_renderers)}),this},this.unload=function(){return this.themeLoader&&themeLoader(options.themes).unload(),this},this.setShuffledChoices=function(interaction,choices,identificationType){Element.isA(interaction,"interaction")&&(this.shuffledChoices[interaction.getSerial()]=_.pluck(interactionHelper.findChoices(interaction,choices,identificationType),"serial"))},this.getShuffledChoices=function(interaction,reshuffle,returnedType){var serial,i,choices=[];if(Element.isA(interaction,"interaction")){if(serial=interaction.getSerial(),!this.shuffledChoices[serial]||reshuffle)if(
Element.isA(interaction,"matchInteraction"))for(this.shuffledChoices[serial]=[],i=0;i<2;i++)choices[i]=interactionHelper.shuffleChoices(interaction.getChoices(i)),this.shuffledChoices[serial][i]=_.pluck(choices[i],"serial");else choices=interactionHelper.shuffleChoices(interaction.getChoices()),this.shuffledChoices[serial]=_.pluck(choices,"serial");else Element.isA(interaction,"matchInteraction")?_.forEach(choices,function(choice,index){index<2&&_.forEach(this.shuffledChoices[serial][i],function(choiceSerial){choice.push(interaction.getChoice(choiceSerial))})}):_.forEach(this.shuffledChoices[serial],function(choiceSerial){choices.push(interaction.getChoice(
choiceSerial))});return"serial"===returnedType||"identifier"===returnedType?interactionHelper.convertChoices(choices,returnedType):_.clone(choices)}return[]},this.getRenderers=function(){return _renderers},this.getLocations=function(){return _locations},this.resolveUrl=function(url){return options.assetManager?"string"==typeof url&&0<url.length?options.assetManager.resolve(url):void 0:url},this.getAbsoluteUrl=function(relUrl){if(console.warn("DEPRECATED used getAbsoluteUrl with ",arguments),this.getOption("userRelativeUrl"))return relUrl.replace(/^\.?\//,"");if(/^http(s)?:\/\//i.test(relUrl)||/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/.test(relUrl)
)return relUrl;var absUrl="",runtimeLocations=this.getOption("runtimeLocations");return runtimeLocations&&_.size(runtimeLocations)&&_.forIn(runtimeLocations,function(runtimeLocation,typeIdentifier){if(0===relUrl.indexOf(typeIdentifier))return absUrl=relUrl.replace(typeIdentifier,runtimeLocation),!1}),absUrl||(this.getOption("baseUrl")||window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/([^\/]*)$/,""))+relUrl},this.setAreaBroker=function(areaBroker){this._areaBroker=areaBroker},this.getAreaBroker=function(){if(this._areaBroker)return this._areaBroker},this.getItemCreator=function(){return this.getOption("itemCreator")}}
;return{build:function(renderersLocations,name,defaultOptions){var NewRenderer=function(){var options=_.isPlainObject(arguments[0])?arguments[0]:{};Renderer.apply(this),this.register(renderersLocations),this.name=name||"",this.setOptions(_.defaults(options,defaultOptions||{}))};return NewRenderer.prototype=Renderer.prototype,NewRenderer}}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock",["handlebars"
],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program2(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'}return(stack1=helpers.unless.call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,helper,buffer=""
;return buffer+='\n<div class="grid-row qti-rubricBlock" data-use="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.use)===functionType?stack1.apply(depth0):stack1)+'" data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" data-qti-class="rubricBlock"',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data})
)||0===stack1)&&(buffer+=stack1),buffer+='>\n    <div class="col-12">\n        <div class="qti-rubricBlock-body">',((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    </div>\n</div>\n"},data),data:data}))||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"rubricBlock",
getContainer:containerHelper.get,template:tpl,getData:function(rubric,data){return rubric.isEmpty()&&(data.empty=!0),data}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<link \n    href="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.href)===functionType?stack1.apply(depth0):stack1
)+'" \n    type="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.type)===functionType?stack1.apply(depth0):stack1)+'" \n    rel="stylesheet" \n    data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" \n    ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.media,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='media="'+escapeExpression(
typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.media)===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"stylesheet",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,
">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<table\n    class="qti-table',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.class)===functionType?stack1.apply(depth0):stack1)},data),data:data}))||0===stack1)&&(buffer+=stack1),
buffer+='"\n    data-qti-class="table"\n    data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"\n    ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.summary,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,buffer="";return buffer+='summary="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1.summary)===functionType?stack1.apply(depth0):stack1)+'"'},data),
data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    ",((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(5,function(depth0,data){var stack1,buffer="";return buffer+=' lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n    >\n    ",((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{
hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="\n</table>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Table",["tpl!taoQtiItem/qtiCommonRenderer/tpl/table","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"table",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",
escapeExpression=this.escapeExpression;return buffer+='<span\n    data-serial="',stack1=(helper=helpers.serial)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.serial)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"\n    data-qti-class="_tooltip"\n    data-role="tooltip-target"\n    ',((stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.attributes)||!1===stack1?stack1:stack1["xml:lang"],{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,buffer="";return buffer+='lang="'+escapeExpression(typeof(stack1=null==(stack1=depth0&&depth0.attributes
)||!1===stack1?stack1:stack1["xml:lang"])===functionType?stack1.apply(depth0):stack1)+'"'},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",((stack1=(helper=helpers.body)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.body)===functionType?helper.call(depth0,{hash:{},data:data}):helper)||0===stack1)&&(buffer+=stack1),buffer+="\n</span>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Tooltip",["tpl!taoQtiItem/qtiCommonRenderer/tpl/tooltip","taoQtiItem/qtiCommonRenderer/helpers/container","ui/tooltip"],function(tpl,containerHelper,tooltip){"use strict";return{qtiClass:"_tooltip",template:tpl,
getContainer:containerHelper.get,render:function(tooltipDOM){var $container=containerHelper.get(tooltipDOM),renderedTooltip=tooltip.create($container,tooltipDOM.content(),{theme:"default",placement:"top"});$container.data("$tooltip")&&($container.data("$tooltip").dispose(),$container.removeData("$tooltip")),$container.data("$tooltip",renderedTooltip)}}}),define("taoQtiItem/qtiItem/core/IdentifiedElement",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/util"],function(Element,util){"use strict";return Element.extend({buildIdentifier:function(prefix,useSuffix){var item=this.getRootElement(),id=util.buildIdentifier(item,prefix||this.qtiClass,
useSuffix);return id&&this.attr("identifier",id),this},id:function(value){return value||this.attr("identifier")||this.buildIdentifier(this.qtiClass,!0),this.attr("identifier",value)}})}),define("taoQtiItem/qtiItem/core/choices/Choice",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){return IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes)},is:function(qtiClass){return"choice"===qtiClass||this._super(qtiClass)},getInteraction:function(){var found,ret=null,item=this.getRootElement();return item&&(found=item.find(this.serial))&&(ret=found.parent),ret}})}),define(
"taoQtiItem/qtiItem/core/choices/Hotspot",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){return QtiChoice.extend({})}),define("taoQtiItem/qtiItem/core/choices/AssociableHotspot",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){return QtiHotspot.extend({qtiClass:"associableHotspot"})}),define("taoQtiItem/qtiItem/mixin/Mixin",[],function(){return{augment:function(targetClass,methods,options){if("function"==typeof targetClass&&"object"==typeof methods)for(var methodName in methods)if(Object.hasOwnProperty(targetClass.prototype,methodName)){if(options&&options.append){var _parent=targetClass.prototype[methodName]
;targetClass.prototype[methodName]=function(){return methods[methodName].apply(this,arguments),_parent.apply(this,arguments)}}}else targetClass.prototype[methodName]=methods[methodName]}}}),define("taoQtiItem/qtiItem/core/Container",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Element,rendererConfig){"use strict";return Element.extend({qtiClass:"_container",init:function(body){if(this._super(),body&&"string"!=typeof body)throw"the body of a container must be a string";this.bdy=body||"",this.elements={}},body:function(body){if(void 0===body)return this.bdy;if("string"!=typeof body
)throw"body must be a string";this.bdy=body,$(document).trigger("containerBodyChange",{body:body,container:this,parent:this.parent()})},setElements:function(elements,body){var returnValue=!1;for(var i in elements){var elt=elements[i];if(!(elt instanceof Element))throw returnValue=!1,"expected a qti element";-1===(body=body||this.bdy).indexOf(elt.placeholder())&&(body+=elt.placeholder()),elt.setRootElement(this.getRootElement()||null),this.elements[elt.getSerial()]=elt,$(document).trigger("containerElementAdded",{element:elt,container:this}),returnValue=!0}return this.body(body),returnValue},setElement:function(element,body){return this.setElements([element],
body)},removeElement:function(element){var serial="";return"string"==typeof element?serial=element:element instanceof Element&&(serial=element.getSerial()),delete this.elements[serial],this.body(this.body().replace("{{"+serial+"}}","")),this},getElements:function(qtiClass){var elts={};if("string"==typeof qtiClass)for(var serial in this.elements)Element.isA(this.elements[serial],qtiClass)&&(elts[serial]=this.elements[serial]);else elts=_.clone(this.elements);return elts},getElement:function(serial){return this.elements[serial]?this.elements[serial]:null},getComposingElements:function(){var elements=this.getElements(),elts={};for(var serial in elements
)elts[serial]=elements[serial],elts=_.extend(elts,elements[serial].getComposingElements());return elts},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),elementsData=[],tpl=this.body();for(var serial in this.elements){var elt=this.elements[serial];if("function"!=typeof elt.render)throw"render() is not defined for the qti element: "+serial;"_container"===elt.qtiClass?tpl=tpl.replace(elt.placeholder(),elt.render(renderer)):(tpl=tpl.replace(elt.placeholder(),"{{{"+serial+"}}}"),elementsData[serial]=elt.render(renderer))}if(renderer.isRenderer)return this._super({body:renderer.renderDirect(
tpl,elementsData),contentModel:this.contentModel||"flow"},renderer,args.placeholder);throw"invalid qti renderer for qti container"},postRender:function(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),_(this.elements).filter(function(elt){return"function"==typeof elt.postRender}).map(function(elt){return elt.postRender(data,"",renderer)}).flatten(!0).value().concat(this._super(data,altClassName,renderer))},toArray:function(){var arr={serial:this.serial,body:this.bdy,elements:{}};for(var serial in this.elements)arr.elements[serial]=this.elements[serial].toArray();return arr},find:function(serial,parent){var found=null
;return this.elements[serial]?found={parent:parent||this,element:this.elements[serial],location:"body"}:_.each(this.elements,function(elt){if(found=elt.find(serial))return!1}),found},isEmpty:function(){return!this.bdy}})}),define("taoQtiItem/qtiItem/mixin/Container",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/core/Container"],function(Mixin,Container){var methods={initContainer:function(body){this.bdy=new Container(body||""),this.bdy.setRootElement(this.getRootElement()||null),this.bdy.contentModel="blockStatic"},getBody:function(){return this.bdy},body:function(body){var ret=this.bdy.body(body);return body?this:ret},setElement:function(element,
body){return this.bdy.setElement(element,body),this},removeElement:function(element){return this.bdy.removeElement(element)},getElements:function(qtiClass){return this.bdy.getElements(qtiClass)},getElement:function(serial){return this.bdy.getElement(serial)}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/choices/ContainerChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/Container"],function(Choice,Container){var ContainerChoice=Choice.extend({init:function(serial,attributes){this._super(serial,attributes)},is:function(qtiClass){
return"containerChoice"===qtiClass||this._super(qtiClass)}});return Container.augment(ContainerChoice),ContainerChoice}),define("taoQtiItem/qtiItem/core/choices/Gap",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){return QtiChoice.extend({qtiClass:"gap"})}),define("taoQtiItem/qtiItem/core/Object",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig,util){return Element.extend({qtiClass:"object",getMediaType:function(){var type="undefined",mimetype=this.attr("type");return mimetype&&(type=0===mimetype.indexOf("video"
)?"video":0===mimetype.indexOf("audio")?"audio":0===mimetype.indexOf("image")?"image":0===mimetype.indexOf("text/html")?"html":"object"),type},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};switch(this.getMediaType()){case"video":defaultData.video=!0;break;case"audio":defaultData.audio=!0;break;case"html":defaultData.html=!0;break;case"image":default:defaultData.object=!0}return defaultData.attributes={data:renderer.resolveUrl(this.attr("data"))},defaultData.body=this._alt,this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},
isEmpty:function(){return!this.attr("data")}})}),define("taoQtiItem/qtiItem/core/choices/GapImg",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/core/Object"],function(QtiChoice,QtiObject){return QtiChoice.extend({qtiClass:"gapImg",initObject:function(object){this.object=object||new QtiObject},getObject:function(){return this.object}})}),define("taoQtiItem/qtiItem/core/choices/GapText",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){"use strict";return QtiContainerChoice.extend({qtiClass:"gapText"})}),define("taoQtiItem/qtiItem/core/choices/HotspotChoice",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(
QtiHotspot){return QtiHotspot.extend({qtiClass:"hotspotChoice"})}),define("taoQtiItem/qtiItem/mixin/ContainerInline",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="inlineStatic"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/choices/Hottext",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Choice,Container
){var Hottext=Choice.extend({qtiClass:"hottext"});return Container.augment(Hottext),Hottext}),define("taoQtiItem/qtiItem/core/choices/TextVariableChoice",["jquery","lodash","taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,QtiChoice,rendererConfig){return QtiChoice.extend({init:function(serial,attributes,text){this._super(serial,attributes),this.val(text||"")},is:function(qtiClass){return"textVariableChoice"===qtiClass||this._super(qtiClass)},val:function(text){if(void 0===text)return this.text;if("string"!=typeof text)throw"text must be a string";return this.text=text,$(document).trigger("choiceTextChange",{
choice:this,text:text}),this},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={body:this.text};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}})}),define("taoQtiItem/qtiItem/core/choices/InlineChoice",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){return QtiTextVariableChoice.extend({qtiClass:"inlineChoice"})}),define("taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){return QtiContainerChoice.extend({
qtiClass:"simpleAssociableChoice"})}),define("taoQtiItem/qtiItem/core/choices/SimpleChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){return QtiContainerChoice.extend({qtiClass:"simpleChoice"})}),define("taoQtiItem/qtiItem/core/choices/TextEntry",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){return QtiTextVariableChoice.extend({qtiClass:"textEntry"})}),define("taoQtiItem/qtiItem/core/feedbacks/Feedback",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){return IdentifiedElement.extend({is:function(qtiClass){return"feedback"===qtiClass||this._super(qtiClass)
}})}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(Feedback){return Feedback.extend({})}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(Feedback){return Feedback.extend({})}),define("taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",["taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/Container"],function(IdentifiedElement,Container){var ModalFeedback=IdentifiedElement.extend({qtiClass:"modalFeedback",is:function(qtiClass){return"feedback"===qtiClass||this._super(qtiClass)}});return Container.augment(
ModalFeedback),ModalFeedback}),define("taoQtiItem/qtiItem/core/Img",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){return Element.extend({qtiClass:"img",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={src:renderer.resolveUrl(this.attr("src"))},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return!this.attr("src")}})}),define("taoQtiItem/qtiItem/mixin/NamespacedElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"]
,function(Mixin,_){"use strict";var methods={getNamespace:function(){var relatedItem,namespaces,ns;if(this.ns&&(this.ns.name||this.ns.uri))return _.clone(this.ns);if(relatedItem=this.getRootElement()){for(ns in namespaces=relatedItem.getNamespaces())if(0<namespaces[ns].indexOf(this.nsUriFragment))return{name:ns,uri:namespaces[ns]};return relatedItem.namespaces[this.defaultNsName]=this.defaultNsUri,{name:this.defaultNsName,uri:this.defaultNsUri}}return{}},setNamespace:function(name,uri){this.ns={name:name,uri:uri}}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Include",[
"taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/mixin/NamespacedElement"],function(Element,Container,NamespacedElement){var Include=Element.extend({qtiClass:"include",defaultNsName:"xi",defaultNsUri:"http://www.w3.org/2001/XInclude",nsUriFragment:"XInclude",isEmpty:function(){return!this.attr("href")||this.getBody().isEmpty()}});return Container.augment(Include),NamespacedElement.augment(Include),Include}),define("taoQtiItem/qtiItem/core/interactions/Interaction",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,
rendererConfig,util){"use strict";return Element.extend({init:function(serial,attributes){this._super(serial,attributes),this.choices={}},is:function(qtiClass){return"interaction"===qtiClass||this._super(qtiClass)},addChoice:function(choice){return choice.setRootElement(this.getRootElement()||null),this.choices[choice.getSerial()]=choice,this},getChoices:function(){var choices={};for(var i in this.choices)choices[i]=this.choices[i];return choices},getChoice:function(serial){var ret=null;return this.choices[serial]&&(ret=this.choices[serial]),ret},getChoiceByIdentifier:function(identifier){for(var i in this.choices)if(this.choices[i].id()===identifier
)return this.choices[i];return null},getComposingElements:function(){var elts=this._super();for(var serial in this.choices)Element.isA(this.choices[serial],"choice")&&(elts[serial]=this.choices[serial],elts=_.extend(elts,this.choices[serial].getComposingElements()));return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,"choices",serial)),found},getResponseDeclaration:function(){var response=null,responseId=this.attr("responseIdentifier");if(responseId){var item=this.getRootElement();if(!item)throw"cannot get response of an interaction out of its item context";response=item.getResponseDeclaration(
responseId)}return response},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={_type:this.qtiClass.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()}),choices:[],choiceShuffle:!0};if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;var choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),interactionData={interaction:{serial:this.serial,attributes:this.attributes}},_this=this;_.each(choices,function(choice){if(Element.isA(choice,"choice"))try{var renderedChoice=choice.render(_.clone(
interactionData,!0),null,choice.qtiClass+"."+_this.qtiClass,renderer);defaultData.choices.push(renderedChoice)}catch(e){}});var tplName=args.subclass?this.qtiClass+"."+args.subclass:this.qtiClass;return this._super(_.merge(defaultData,args.data),args.placeholder,tplName,renderer)},postRender:function(data,altClassName,renderer){var self=this;return renderer=renderer||this.getRenderer(),_(this.getChoices()).filter(function(elt){return Element.isA(elt,"choice")}).map(function(choice){return choice.postRender({},choice.qtiClass+"."+self.qtiClass,renderer)}).value().concat(this._super(data,altClassName,renderer))},setResponse:function(values){
var renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return renderer.setResponse(this,values)},getResponse:function(){var renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return renderer.getResponse(this)},resetResponse:function(){var renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return renderer.resetResponse(this)},getState:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return _.isFunction(renderer.getState)&&(
ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;_.isFunction(renderer.setState)&&renderer.setState(this,state)},clear:function(){var renderer=this.getRenderer();if(renderer&&_.isFunction(renderer.destroy))return renderer.destroy(this)},toArray:function(){var arr=this._super();for(var serial in arr.choices={},this.choices)Element.isA(this.choices[serial],"choice")&&(arr.choices[serial]=this.choices[serial].toArray());return arr},getNormalMaximum:function(){return!1}})}),define("taoQtiItem/qtiItem/core/interactions/Prompt",[
"taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Element,Container){var Prompt=Element.extend({qtiClass:"prompt"});return Container.augment(Prompt),Prompt}),define("taoQtiItem/qtiItem/core/interactions/BlockInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/core/interactions/Prompt","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Interaction,Prompt,_,rendererConfig){"use strict";return Interaction.extend({init:function(serial,attributes){this._super(serial,attributes),this.prompt=new Prompt("")},is:function(qtiClass){return"blockInteraction"===qtiClass||this._super(qtiClass
)},getComposingElements:function(){var elts=this._super();return(elts=_.extend(elts,this.prompt.getComposingElements()))[this.prompt.getSerial()]=this.prompt,elts},find:function(serial){return this._super(serial)||this.prompt.find(serial)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={prompt:this.prompt.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),[].concat(this.prompt.postRender({},"",renderer)).concat(this._super(
data,altClassName,renderer))},toArray:function(){var arr=this._super();return arr.prompt=this.prompt.toArray(),arr}})}),define("taoQtiItem/qtiItem/helper/response",["lodash"],function(_){"use strict";var _templateNames={MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct",MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response",MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point",NONE:"no_response_processing"};return{isUsingTemplate:function(response,tpl){return!(!_.isString(tpl)||tpl!==response.template&&_templateNames[tpl]!==response.template)},
isValidTemplateName:function(tplName){return!!this.getTemplateUriFromName(tplName)},getTemplateUriFromName:function(tplName){return _templateNames[tplName]?_templateNames[tplName]:""},getTemplateNameFromUri:function(tplUri){var tplName="";return _.forIn(_templateNames,function(uri,name){if(uri===tplUri)return tplName=name,!1}),tplName}}}),define("taoQtiItem/qtiCreator/model/helper/event",["jquery","lodash"],function($,_){"use strict";var eventList=["containerBodyChange","containerElementAdded","elementCreated.qti-widget","attributeChange.qti-widget","choiceCreated.qti-widget","correctResponseChange.qti-widget","mapEntryChange.qti-widget",
"mapEntryRemove.qti-widget","deleted.qti-widget","choiceTextChange.qti-widget","responseTemplateChange.qti-widget","mappingAttributeChange.qti-widget","feedbackRuleConditionChange.qti-widget","feedbackRuleCreated.qti-widget","feedbackRuleRemoved.qti-widget","feedbackRuleElseCreated.qti-widget","feedbackRuleElseRemoved.qti-widget"],event={choiceCreated:function(choice,interaction){$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:interaction})},choiceDeleted:function(choice,interaction){$(document).trigger("choiceDeleted.qti-widget",{choice:choice,interaction:interaction})},deleted:function(element,parent){element.isset(
)&&element.unset(),$(document).off("."+element.getSerial()),$(document).trigger("deleted.qti-widget",{element:element,parent:parent})},getList:function(addedNamespace){var events=_.clone(eventList);return addedNamespace?_.map(events,function(e){return e+"."+addedNamespace}):events},initElementToWidgetListeners:function(){var ns=".widget-container";$(document).off(ns).on(event.getList(ns).join(" "),function(e,data){var element=data.element||data.container||null,widget=data&&element&&element.data("widget");!widget&&data.parent&&(widget=(element=data.parent).data("widget")),widget&&widget.$container.trigger(e.type+".qti-creator.qti-creator",data)})},
getNs:function(){return".qti-creator"},getNsModel:function(){return".qti-creator"}};return event}),define("taoQtiItem/qtiCreator/model/helper/invalidator",["lodash"],function(_){"use strict";return{completelyValid:function(element){var serial,invalidElements,item=element.getRootElement();item&&(serial=element.getSerial(),delete(invalidElements=item.data("invalid")||{})[serial],item.data("invalid",invalidElements))},valid:function(element,key){var invalidElements,item=element.getRootElement(),serial=element.getSerial();if(item){if(invalidElements=item.data("invalid")||{},!key)throw new Error('missing required argument "key"')
;invalidElements[serial]&&invalidElements[serial][key]&&(delete invalidElements[serial][key],_.size(invalidElements[serial])||delete invalidElements[serial],item.data("invalid",invalidElements))}},invalid:function(element,key,message,stateName){var invalidElements,item=element.getRootElement(),serial=element.getSerial();if(item){if(invalidElements=item.data("invalid")||{},!key)throw new Error('missing required arguments "key"');invalidElements[serial]||(invalidElements[serial]={}),invalidElements[serial][key]={message:message||"",stateName:stateName||"active"},item.data("invalid",invalidElements)}},isValid:function(element){var item=element.getRootElement(),
serial=element.getSerial();return!item||!(item.data("invalid")||{})[serial]}}}),define("taoQtiItem/qtiCreator/model/mixin/editable",["lodash","jquery","core/encoder/entity","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/invalidator"],function(_,$,entity,Element,event,invalidator){"use strict";return{init:function(serial,attributes){var attr={};"object"==typeof serial&&(attributes=serial,serial=""),_.isFunction(this.getDefaultAttributes)&&_.extend(attr,this.getDefaultAttributes()),_.extend(attr,attributes),this._super(serial,attr)},attr:function(key,value){var ret=this._super(key,value)
;return void 0!==key&&void 0!==value&&$(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:entity.encode(value)}),_.isString(ret)?entity.decode(ret):ret},removeAttr:function(key){var ret=this._super(key);return $(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:null}),ret},remove:function(){if(0===arguments.length)return function(element){var found,parent,removed=!1,related=element.getRootElement();if(!related)throw new Error("no related item found");return(found=related.find(element.getSerial()))&&(parent=found.parent,Element.isA(parent,"interaction")?("gapImg"===element.qtiClass?parent.removeGapImg(element
):Element.isA(element,"choice")&&parent.removeChoice(element),removed=!0):"body"===found.location&&_.isFunction(parent.initContainer)?(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.getBody().removeElement(element),removed=!0):Element.isA(parent,"_container")&&(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.removeElement(element),removed=!0),removed&&(element.data("removed",!0),invalidator.completelyValid(element),event.deleted(element,parent))),removed}(this);if(2===arguments.length)return element=this,containerPropName=arguments[0],eltToBeRemoved=arguments[1],targetSerial="",element[containerPropName]&&(
"string"==typeof eltToBeRemoved?(targetSerial=eltToBeRemoved,targetElt=Element.getElementBySerial(targetSerial)):eltToBeRemoved instanceof Element&&(targetSerial=eltToBeRemoved.getSerial(),targetElt=eltToBeRemoved),targetSerial&&(invalidator.completelyValid(targetElt),delete element[containerPropName][targetSerial],Element.unsetElement(targetSerial))),element;throw new Error("invalid number of argument given");var element,containerPropName,eltToBeRemoved,targetElt,targetSerial}}}),define("taoQtiItem/qtiItem/core/variables/VariableDeclaration",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){"use strict"
;return IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes),this.defaultValue=null},is:function(qtiClass){return"variableDeclaration"===qtiClass||this._super(qtiClass)},toArray:function(){var arr=this._super();return arr.defaultValue=this.defaultValue,arr},setDefaultValue:function(value){this.defaultValue=value},getDefaultValue:function(){return this.defaultValue}})}),define("taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration"],function(VariableDeclaration){return VariableDeclaration.extend({qtiClass:"outcomeDeclaration"})}),define(
"taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/variables/OutcomeDeclaration"],function(_,editable,OutcomeDeclaration){"use strict";var methods={};return _.extend(methods,editable),OutcomeDeclaration.extend(methods)}),define("taoQtiItem/qtiItem/helper/maxScore",["lodash","lib/gamp/gamp","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration"],function(_,gamp,responseHelper,OutcomeDeclaration){"use strict";var pairExists=function(collection,pair){return 2===pair.length&&(
collection[pair[0]+" "+pair[1]]||collection[pair[1]+" "+pair[0]])};return{setNormalMaximum:function(item){var normalMaximum,scoreOutcome=item.getOutcomeDeclaration("SCORE");scoreOutcome&&item.responseProcessing&&"templateDriven"===item.responseProcessing.processingType&&(normalMaximum=_.reduce(item.getInteractions(),function(acc,interaction){var interactionMaxScore=interaction.getNormalMaximum();return!!_.isNumber(interactionMaxScore)&&gamp.add(acc,interactionMaxScore)},0),_.isNumber(normalMaximum)?scoreOutcome.attr("normalMaximum",normalMaximum):scoreOutcome.removeAttr("normalMaximum"))},setMaxScore:function(item){var customOutcomes,maxScore,maxScoreOutcome
,hasInvalidInteraction=!1;item.getOutcomeDeclaration("SCORE")&&item.responseProcessing&&"templateDriven"===item.responseProcessing.processingType&&(maxScore=_.reduce(item.getInteractions(),function(acc,interaction){var interactionMaxScore=interaction.getNormalMaximum();return _.isNumber(interactionMaxScore)?gamp.add(acc,interactionMaxScore):(hasInvalidInteraction=!0,acc)},0),(customOutcomes=_(item.getOutcomes()).filter(function(outcome){return"SCORE"!==outcome.id()&&"MAXSCORE"!==outcome.id()})).size()&&(maxScore=customOutcomes.reduce(function(acc,outcome){return gamp.add(acc,parseFloat(outcome.attr("normalMaximum")||0))},maxScore)),
!hasInvalidInteraction||customOutcomes.size()?((maxScoreOutcome=item.getOutcomeDeclaration("MAXSCORE"))||(maxScoreOutcome=new OutcomeDeclaration({cardinality:"single",baseType:"float"}),item.addOutcomeDeclaration(maxScoreOutcome),maxScoreOutcome.buildIdentifier("MAXSCORE",!1)),maxScoreOutcome.setDefaultValue(maxScore)):item.removeOutcome("MAXSCORE"))},getMatchMaxOrderedChoices:function(choiceCollection){return _(choiceCollection).map(function(choice){var matchMax=parseInt(choice.attr("matchMax"),10);return _.isNaN(matchMax)&&(matchMax=0),{matchMax:0===matchMax?1/0:matchMax,id:choice.id()}}).sortBy("matchMax").reverse().valueOf()},
choiceInteractionBased:function(interaction,options){var max,maxChoice,scoreMaps,requiredChoiceCount,totalAnswerableResponse,sortedMapEntries,missingMapsCount,responseDeclaration=interaction.getResponseDeclaration(),mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);if(options=_.defaults(options||{},{maxChoices:0,minChoices:0}),maxChoice=parseInt(interaction.attr("maxChoices")||options.maxChoices,10),0,"MATCH_CORRECT"===template)max=maxChoice&&_.isArray(responseDeclaration.correctResponse)&&(
responseDeclaration.correctResponse.length>maxChoice||responseDeclaration.correctResponse.length<0)?0:!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:1;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;totalAnswerableResponse=(requiredChoiceCount=0)===maxChoice?1/0:maxChoice,scoreMaps=_.values(responseDeclaration.mapEntries),missingMapsCount=0-(sortedMapEntries=_(scoreMaps).map(function(v){return parseFloat(v)}).sortBy().reverse().first(totalAnswerableResponse)).size(),_.times(missingMapsCount,function(){
sortedMapEntries.push(mapDefault)}),mapDefault&&0<mapDefault&&0<(missingMapsCount=maxChoice?maxChoice-sortedMapEntries.size():_.size(interaction.getChoices())-sortedMapEntries.size())&&_.times(missingMapsCount,function(){sortedMapEntries.push(mapDefault)}),max=sortedMapEntries.reduce(function(acc,v){var score=v;return score<0&&requiredChoiceCount<=0&&(score=0),requiredChoiceCount--,gamp.add(acc,score)},0),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},orderInteractionBased:function(interaction){var max,
maxChoice=parseInt(interaction.attr("maxChoices")||0,10),responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);return"MATCH_CORRECT"===template?max=_.isArray(responseDeclaration.correctResponse)&&maxChoice&&responseDeclaration.correctResponse.length>maxChoice?0:!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:1:"MAP_RESPONSE"!==template&&"MAP_RESPONSE_POINT"!==template||(max=0),max},associateInteractionBased:function(interaction,options){var max,requiredAssoc,totalAnswerableResponse,usedChoices,
choicesIdentifiers,sortedMapEntries,i,allPossibleMapEntries,infiniteScoringPair,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),maxAssoc=parseInt(interaction.attr("maxAssociations")||0,10),mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0);if(options=_.defaults(options||{},{possiblePairs:[],checkInfinitePair:!1}),"MATCH_CORRECT"===template)!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&(!responseDeclaration.correctResponse.length||maxAssoc&&responseDeclaration.correctResponse.length>maxAssoc)?max=0:(max=1,
choicesIdentifiers=[],_.forEach(responseDeclaration.correctResponse,function(pair){var choices;_.isString(pair)&&(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length&&(choicesIdentifiers.push(choices[0].trim()),choicesIdentifiers.push(choices[1].trim())))}),_.forEach(_.countBy(choicesIdentifiers),function(count,identifier){var matchMax,choice=interaction.getChoiceByIdentifier(identifier);return choice?(matchMax=parseInt(choice.attr("matchMax"),10))&&matchMax<count?(max=0,!1):void 0:(max=0,!1)}));else if("MAP_RESPONSE"===template){if(totalAnswerableResponse=(requiredAssoc=0)===maxAssoc?1/0:maxAssoc,usedChoices={},
!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;if(allPossibleMapEntries=_.clone(responseDeclaration.mapEntries),mapDefault&&0<mapDefault&&_.forEachRight(options.possiblePairs,function(pair){pairExists(allPossibleMapEntries,pair)||(allPossibleMapEntries[pair[0]+" "+pair[1]]=mapDefault)}),sortedMapEntries=_(allPossibleMapEntries).map(function(score,pair){return{score:parseFloat(score),pair:pair}}).sortBy("score").reverse().filter(function(mapEntry){var choices,choiceId,choice,_usedChoices,pair=mapEntry.pair;if(!_.isString(pair))return!1;if(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length){for(
_usedChoices=_.cloneDeep(usedChoices),i=0;i<2;i++){if(!_usedChoices[choiceId=choices[i]]){if(!(choice=interaction.getChoiceByIdentifier(choiceId)))return!1;_usedChoices[choiceId]={used:0,max:parseInt(choice.attr("matchMax"),10)}}if(_usedChoices[choiceId].max&&_usedChoices[choiceId].used===_usedChoices[choiceId].max)return!1;_usedChoices[choiceId].used++}return infiniteScoringPair=infiniteScoringPair||options.checkInfinitePair&&0<mapEntry.score&&0===_usedChoices[choices[0]].max&&0===_usedChoices[choices[1]].max,_.assign(usedChoices,_usedChoices),!0}return!1}).first(totalAnswerableResponse),infiniteScoringPair)return!1;max=sortedMapEntries.reduce(function(acc,
v){var score=v.score;return v.score<0&&requiredAssoc<=0&&(score=0),requiredAssoc--,gamp.add(acc,score)},0),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},gapMatchInteractionBased:function(interaction){var max,skippableWrongResponse,usedChoices,usedGaps,group1,group2,allPossibleMapEntries,gapMatchInteraction,pairs,matchSet1,matchSet2,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),mapDefault=parseFloat(
responseDeclaration.mappingAttributes.defaultValue||0),getMatchMaxOrderedChoices=function(choiceCollection){return _(choiceCollection).map(function(choice){return{matchMax:0===choice.attr("matchMax")?1/0:choice.attr("matchMax")||0,id:choice.id()}}).sortBy("matchMax").reverse().valueOf()};if("MATCH_CORRECT"===template)!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?max=0:(max=1,group1=[],group2=[],_.forEach(responseDeclaration.correctResponse,function(pair){var choices;_.isString(pair)&&(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length&&(group1.push(
choices[0].trim()),group2.push(choices[1].trim())))}),_.forEach(_.countBy(group1),function(count,identifier){var choice=interaction.getChoiceByIdentifier(identifier),matchMax=parseInt(choice.attr("matchMax"),10);if(matchMax&&matchMax<count)return max=0,!1}),_.forEach(_.countBy(group2),function(count){if(1<count)return max=0,!1}));else if("MAP_RESPONSE"===template){if(skippableWrongResponse=1/0,usedChoices={},usedGaps={},!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;allPossibleMapEntries=_.clone(responseDeclaration.mapEntries),mapDefault&&0<mapDefault&&_.forEachRight((pairs=[],matchSet1=getMatchMaxOrderedChoices((
gapMatchInteraction=interaction).getChoices()),matchSet2=getMatchMaxOrderedChoices(gapMatchInteraction.getGaps()),_.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs),function(pair){pairExists(allPossibleMapEntries,pair)||(allPossibleMapEntries[pair[0]+" "+pair[1]]=mapDefault)}),max=_(allPossibleMapEntries).map(function(score,pair){return{score:parseFloat(score),pair:pair}}).sortBy("score").reverse().filter(function(mapEntry){var choices,choiceId,gapId,choice,pair=mapEntry.pair,_usedChoices=_.cloneDeep(usedChoices);if(!_.isString(pair))return!1;if(choices=pair.trim().split(" "),_.isArray(
choices)&&2===choices.length){if(choiceId=choices[0],gapId=choices[1],!_usedChoices[choiceId]){if(!(choice=interaction.getChoiceByIdentifier(choiceId)))return!1;_usedChoices[choiceId]={used:0,max:parseInt(choice.attr("matchMax"),10)}}return(!_usedChoices[choiceId].max||_usedChoices[choiceId].used!==_usedChoices[choiceId].max)&&(_usedChoices[choiceId].used++,usedGaps[gapId]||(usedGaps[gapId]={used:0,max:1}),(!usedGaps[gapId].max||usedGaps[gapId].used!==usedGaps[gapId].max)&&(usedGaps[gapId].used++,_.assign(usedChoices,_usedChoices),!0))}return!1}).first(1/0).reduce(function(acc,v){var score=v.score;return 0<=score?acc+score:0<skippableWrongResponse?(
skippableWrongResponse--,acc):acc+score},0),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=!1);return max},selectPointInteractionBased:function(interaction){var max,skippableWrongResponse,totalAnswerableResponse,maxChoice=parseInt(interaction.attr("maxChoices"),10),responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);return"MATCH_CORRECT"===template||"MAP_RESPONSE"===template?0:("MAP_RESPONSE_POINT"===template&&(skippableWrongResponse=1/0,
totalAnswerableResponse=0===maxChoice?1/0:maxChoice,max=_(responseDeclaration.mapEntries).map(function(v){return parseFloat(v.mappedValue)}).sortBy().reverse().first(totalAnswerableResponse).reduce(function(acc,v){return 0<=v?acc+v:0<skippableWrongResponse?(skippableWrongResponse--,acc):acc+v},0),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))),max)},sliderInteractionBased:function(interaction){var max,scoreMaps,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template);if(
"MATCH_CORRECT"===template)max=!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:1;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;scoreMaps=_.values(responseDeclaration.mapEntries),max=_(scoreMaps).map(function(v){return parseFloat(v)}).max(),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},textEntryInteractionBased:function(interaction){var max,
scoreMaps,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),isPossibleResponse=function(value){var patternMask=interaction.attr("patternMask");return!patternMask||!!value.match(new RegExp(patternMask))};if("MATCH_CORRECT"===template)max=!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&!responseDeclaration.correctResponse.length?0:isPossibleResponse(responseDeclaration.correctResponse[0])?1:0;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;scoreMaps=_.values(_.filter(
responseDeclaration.mapEntries,function(score,key){return isPossibleResponse(key)})),max=_(scoreMaps).map(function(v){return parseFloat(v)}).max(),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=Math.min(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max}}}),define("taoQtiItem/qtiItem/core/interactions/AssociateInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";return BlockInteraction.extend({qtiClass:"associateInteraction",getNormalMaximum:function(){
return maxScore.associateInteractionBased(this,{possiblePairs:function(associateInteraction){var i,j,pairs=[],choices=maxScore.getMatchMaxOrderedChoices(associateInteraction.getChoices());for(i=0;i<choices.length;i++)for(j=i;j<choices.length;j++)pairs.push([choices[i].id,choices[j].id]);return pairs}(this)})}})}),define("taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";return BlockInteraction.extend({qtiClass:"choiceInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}})}),
define("taoQtiItem/qtiItem/core/interactions/ContainerInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/mixin/Container"],function(BlockInteraction,Container){var ContainerInteraction=BlockInteraction.extend({});return Container.augment(ContainerInteraction),ContainerInteraction}),define("taoQtiItem/qtiItem/mixin/CustomElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){var methods={prop:function(name,value){if(name)if(void 0!==value)this.properties[name]=value;else if("object"==typeof name)for(var prop in name)this.prop(prop,name[prop]);else if("string"==typeof name
)return void 0===this.properties[name]?void 0:this.properties[name];return this},removeProp:function(propNames){var _this=this;return"string"==typeof propNames&&(propNames=[propNames]),_.each(propNames,function(propName){delete _this.attributes[propName]}),this},getProperties:function(){return _.clone(this.properties)},getMarkupNamespace:function(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRootElement();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function(name,
uri){this.markupNs={name:name,uri:uri}}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/interactions/CustomInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Interaction,CustomElement,NamespacedElement,rendererConfig){var CustomInteraction=Interaction.extend({qtiClass:"customInteraction",defaultNsName:"pci",defaultNsUri:"http://www.imsglobal.org/xsd/portableCustomInteraction",nsUriFragment:"portableCustomInteraction",
defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.pciReadyCallbacks=[]},is:function(qtiClass){return"customInteraction"===qtiClass||this._super(qtiClass)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pci:this.getNamespace().name+":"}};return this._super(
_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},getMarkupNamespace:function(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRootElement();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function(name,uri){this.markupNs={name:name,uri:uri}},onPciReady:function(callback){this.pciReadyCallbacks.push(callback),this.data("pci"
)&&this.triggerPciReady()},triggerPciReady:function(){var _this=this,pci=this.data("pci");if(!pci)throw"cannot trigger pci ready when no pci is actually attached to the interaction";_.each(this.pciReadyCallbacks,function(fn){fn.call(_this,pci)}),this.pciReadyCallbacks=[],this.data("pciReady",!0)},onPci:function(event,callback){return this.onPciReady(function(pci){if(!_.isFunction(pci.on))throw"the pci does not implement on() function";pci.on(event,callback)}),this},offPci:function(event){return this.onPciReady(function(pci){if(!_.isFunction(pci.off))throw"the pci does not implement off() function";pci.off(event)}),this},triggerPci:function(event,args){
return this.onPciReady(function(pci){if(!_.isFunction(pci.off))throw"the pci does not implement off() function";pci.trigger(event,args)}),this}});return CustomElement.augment(CustomInteraction),NamespacedElement.augment(CustomInteraction),CustomInteraction}),define("taoQtiItem/qtiItem/core/interactions/InlineInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction"],function(Interaction){"use strict";return Interaction.extend({is:function(qtiClass){return"inlineInteraction"===qtiClass||this._super(qtiClass)}})}),define("taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(
InlineInteraction){return InlineInteraction.extend({qtiClass:"endAttemptInteraction"})}),define("taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/maxScore"],function(_,BlockInteraction,rendererConfig,maxScore){"use strict";return BlockInteraction.extend({qtiClass:"extendedTextInteraction",render:function(){var i,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={multiple:!1,maxStringLoop:[]},response=this.getResponseDeclaration();if(this.attr(
"maxStrings")&&("multiple"===response.attr("cardinality")||"ordered"===response.attr("cardinality")))for(defaultData.multiple=!0,i=0;i<this.attr("maxStrings");i++)defaultData.maxStringLoop.push(i+"");return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getNormalMaximum:function(){return maxScore.textEntryInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(ContainerInteraction,maxScore){"use strict";return ContainerInteraction.extend({qtiClass:"gapMatchInteraction",
getGaps:function(){return this.getBody().getElements("gap")},getNormalMaximum:function(){return maxScore.gapMatchInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/ObjectInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/Object"],function(QtiBlockInteraction,QtiObject){return QtiBlockInteraction.extend({initObject:function(object){this.object=object||new QtiObject},getObject:function(){return this.object}})}),define("taoQtiItem/qtiItem/core/interactions/GraphicInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(
QtiObjectInteraction,_,rendererConfig){return QtiObjectInteraction.extend({render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={backgroundImage:this.object.getAttributes(),object:this.object.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}})}),define("taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";return GraphicInteraction.extend({
qtiClass:"graphicAssociateInteraction",getNormalMaximum:function(){return maxScore.associateInteractionBased(this,{possiblePairs:function(associateInteraction){var i,j,pairs=[],choices=maxScore.getMatchMaxOrderedChoices(associateInteraction.getChoices());for(i=0;i<choices.length;i++)for(j=i;j<choices.length;j++)i!==j&&pairs.push([choices[i].id,choices[j].id]);return pairs}(this)})}})}),define("taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/maxScore",
"taoQtiItem/qtiItem/helper/response"],function(GraphicInteraction,Element,_,rendererConfig,maxScore,responseHelper){"use strict";return GraphicInteraction.extend({qtiClass:"graphicGapMatchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.gapImgs={}},addGapImg:function(gapImg){Element.isA(gapImg,"gapImg")&&(gapImg.setRootElement(this.getRootElement()||null),this.gapImgs[gapImg.getSerial()]=gapImg)},removeGapImg:function(gapImg){var serial="";return"string"==typeof gapImg?serial=gapImg:Element.isA(gapImg,"gapImg")&&(serial=gapImg.getSerial()),delete this.gapImgs[serial],this},getGapImgs:function(){return _.clone(this.gapImgs)},
getGapImg:function(serial){return this.gapImgs[serial]},getChoiceByIdentifier:function(identifier){var choice=this._super(identifier);return choice||(choice=_.find(this.gapImgs,function(elt){return elt&&elt.id()===identifier})),choice},getComposingElements:function(){var serial,elts=this._super();for(serial in this.gapImgs)elts[serial]=this.gapImgs[serial],elts=_.extend(elts,this.gapImgs[serial].getComposingElements());return elts},find:function(serial){var found=this._super(serial);return found||this.gapImgs[serial]&&(found={parent:this,element:this.gapImgs[serial]}),found},render:function(){var serial,args=rendererConfig.getOptionsFromArguments(arguments),
renderer=args.renderer||this.getRenderer(),defaultData={gapImgs:[]},gapImgs=this.getGapImgs();for(serial in gapImgs)Element.isA(gapImgs[serial],"choice")&&defaultData.gapImgs.push(gapImgs[serial].render({},null,"",renderer));return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var serial,gapImgs,arr=this._super();for(serial in arr.gapImgs={},gapImgs=this.getGapImgs())arr.gapImgs[serial]=gapImgs[serial].toArray();return arr},getNormalMaximum:function(){var graphicGapInteraction,pairs,matchSet1,matchSet2;return maxScore.associateInteractionBased(this,{possiblePairs:(graphicGapInteraction=this,pairs=[],
matchSet1=maxScore.getMatchMaxOrderedChoices(graphicGapInteraction.getGapImgs()),matchSet2=maxScore.getMatchMaxOrderedChoices(graphicGapInteraction.getChoices()),_.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs),checkInfinitePair:!0})}})}),define("taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";return GraphicInteraction.extend({qtiClass:"graphicOrderInteraction",getNormalMaximum:function(){return maxScore.orderInteractionBased(
this)}})}),define("taoQtiItem/qtiItem/core/interactions/HotspotInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";return GraphicInteraction.extend({qtiClass:"hotspotInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/HottextInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/maxScore"],function(ContainerInteraction,Element,maxScore){"use strict";return ContainerInteraction.extend({
qtiClass:"hottextInteraction",getChoices:function(){return this.getBody().getElements("hottext")},getChoice:function(serial){var element=this.getBody().getElement(serial);return Element.isA(element,"choice")?element:null},getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(InlineInteraction,maxScore){"use strict";return InlineInteraction.extend({qtiClass:"inlineChoiceInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this,{
maxChoices:1})}})}),define("taoQtiItem/qtiItem/core/interactions/MatchInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,SimpleAssociableChoice,_,rendererConfig,util,maxScore){"use strict";return BlockInteraction.extend({qtiClass:"matchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.choices=[{},{}]},addChoice:function(choice,matchSet){matchSet=parseInt(matchSet),this.choices[matchSet]&&(
choice.setRootElement(this.getRootElement()||null),this.choices[matchSet][choice.getSerial()]=choice)},getChoices:function(matchSet){return matchSet=parseInt(matchSet),this.choices[matchSet]?_.clone(this.choices[matchSet]):_.clone(this.choices)},getChoice:function(serial){return this.choices[0][serial]||this.choices[1][serial]||null},getChoiceByIdentifier:function(identifier){var i,matchSet,serial;for(i=0;i<2;i++)for(serial in matchSet=this.getChoices(i))if(matchSet[serial]instanceof SimpleAssociableChoice&&matchSet[serial].id()===identifier)return matchSet[serial];return null},getComposingElements:function(){var i,matchSet,serial,elts=this._super();for(
i=0;i<2;i++)for(serial in matchSet=this.getChoices(i))matchSet[serial]instanceof SimpleAssociableChoice&&(elts[serial]=matchSet[serial],elts=_.extend(elts,matchSet[serial].getComposingElements()));return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["choices.0","choices.1"],serial)),found},render:function(){var choices,i,matchSet,serial,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={matchSet1:[],matchSet2:[]},interactionData={interaction:{serial:this.serial,attributes:this.attributes}};if(!renderer
)throw"no renderer found for the interaction "+this.qtiClass;for(choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),i=0;i<2;i++)for(serial in matchSet=choices[i])matchSet[serial]instanceof SimpleAssociableChoice&&defaultData["matchSet"+(i+1)].push(matchSet[serial].render(_.clone(interactionData,!0),null,"simpleAssociableChoice.matchInteraction",renderer));return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),_(this.getChoices()).map(function(choices){return _(
choices).filter(function(choice){return choice instanceof SimpleAssociableChoice}).map(function(choice){return choice.postRender({},"simpleAssociableChoice.matchInteraction",renderer)}).value()}).flatten(!0).value().concat(this._super(data,altClassName,renderer))},toArray:function(){var i,matchSet,serial,arr=this._super();for(arr.choices={0:{},1:{}},i=0;i<2;i++)for(serial in matchSet=this.getChoices(i))matchSet[serial]instanceof SimpleAssociableChoice&&(arr.choices[i][serial]=matchSet[serial].toArray());return arr},getNormalMaximum:function(){var matchInteraction,pairs,matchSet1,matchSet2;return maxScore.associateInteractionBased(this,{possiblePairs:(
matchInteraction=this,pairs=[],matchSet1=maxScore.getMatchMaxOrderedChoices(matchInteraction.getChoices(0)),matchSet2=maxScore.getMatchMaxOrderedChoices(matchInteraction.getChoices(1)),_.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs)})}})}),define("taoQtiItem/qtiItem/core/interactions/MediaInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/ObjectInteraction","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,ObjectInteraction,rendererConfig){"use strict";return ObjectInteraction.extend({qtiClass:"mediaInteraction",render:function(){
var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={object:this.object.render({},null,"",renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}})}),define("taoQtiItem/qtiItem/core/interactions/OrderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";return BlockInteraction.extend({qtiClass:"orderInteraction",getNormalMaximum:function(){return maxScore.orderInteractionBased(this)}})}),define(
"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){"use strict";return GraphicInteraction.extend({qtiClass:"selectPointInteraction",getNormalMaximum:function(){return maxScore.selectPointInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/SliderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){"use strict";return BlockInteraction.extend({qtiClass:"sliderInteraction",getNormalMaximum:function(){
return maxScore.sliderInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(InlineInteraction,maxScore){"use strict";return InlineInteraction.extend({qtiClass:"textEntryInteraction",getNormalMaximum:function(){return maxScore.textEntryInteractionBased(this)}})}),define("taoQtiItem/qtiItem/core/interactions/UploadInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(InlineInteraction){return InlineInteraction.extend({qtiClass:"uploadInteraction"})}),define(
"taoQtiItem/qtiItem/mixin/ContainerItemBody",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="itemBody"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Item",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/ContainerItemBody","lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(Element,
IdentifiedElement,Container,_,$,util){"use strict";var Item=IdentifiedElement.extend({qtiClass:"assessmentItem",init:function(serial,attributes){this._super(serial,attributes),(this.rootElement=this).stylesheets={},this.responses={},this.outcomes={},this.modalFeedbacks={},this.namespaces={},this.schemaLocations={},this.responseProcessing=null,this.apipAccessibility=null},getInteractions:function(){var interactions=[],elts=this.getComposingElements();for(var serial in elts)Element.isA(elts[serial],"interaction")&&interactions.push(elts[serial]);return interactions},addResponseDeclaration:function(response){if(!Element.isA(response,"responseDeclaration")
)throw"is not a qti response declaration";return response.setRootElement(this),this.responses[response.getSerial()]=response,this},getResponseDeclaration:function(identifier){for(var i in this.responses)if(this.responses[i].attr("identifier")===identifier)return this.responses[i];return null},addOutcomeDeclaration:function(outcome){if(!Element.isA(outcome,"outcomeDeclaration"))throw"is not a qti outcome declaration";return outcome.setRootElement(this),this.outcomes[outcome.getSerial()]=outcome,this},getOutcomeDeclaration:function(identifier){var found;return _.forEach(this.outcomes,function(outcome){if(outcome.id()===identifier)return found=outcome,!1}),
found},getOutcomes:function(){return _.clone(this.outcomes)},removeOutcome:function(identifier){var outcome=this.getOutcomeDeclaration(identifier);outcome&&(this.outcomes=_.omit(this.outcomes,outcome.getSerial()))},addModalFeedback:function(feedback){if(!Element.isA(feedback,"modalFeedback"))throw"is not a qti modal feedback";return feedback.setRootElement(this),this.modalFeedbacks[feedback.getSerial()]=feedback,this},getComposingElements:function(){var elts=this._super(),_this=this;return _.forEach(["responses","outcomes","modalFeedbacks","stylesheets"],function(elementCollection){for(var i in _this[elementCollection]){var elt=_this[elementCollection][i]
;elts[i]=elt,elts=_.extend(elts,elt.getComposingElements())}}),this.responseProcessing instanceof Element&&(elts[this.responseProcessing.getSerial()]=this.responseProcessing),elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["responses","outcomes","modalFeedbacks","stylesheets"],serial)),found},getResponses:function(){return _.clone(this.responses)},getRootElement:function(){return this},addNamespace:function(name,uri){this.namespaces[name]=uri},setNamespaces:function(namespaces){this.namespaces=namespaces},getNamespaces:function(){return _.clone(this.namespaces)},setSchemaLocations:function(locations
){this.schemaLocations=locations},getSchemaLocations:function(){return _.clone(this.schemaLocations)},setApipAccessibility:function(apip){this.apipAccessibility=apip||null},getApipAccessibility:function(){return this.apipAccessibility},addStylesheet:function(stylesheet){if(!Element.isA(stylesheet,"stylesheet"))throw"is not a qti stylesheet declaration";return stylesheet.setRootElement(this),this.stylesheets[stylesheet.getSerial()]=stylesheet,this},removeStyleSheet:function(stylesheet){return delete this.stylesheets[stylesheet.getSerial()],this},stylesheetExists:function(href){var exists=!1;return _.forEach(this.stylesheets,function(stylesheet){if(
stylesheet.attr("href")===href)return!(exists=!0)}),exists},setResponseProcessing:function(rp){if(!Element.isA(rp,"responseProcessing"))throw"is not a response processing";return rp.setRootElement(this),this.responseProcessing=rp,this},toArray:function(){var arr=this._super(),toArray=function(elt){return elt.toArray()};return arr.namespaces=this.namespaces,arr.schemaLocations=this.schemaLocations,arr.outcomes=_.map(this.outcomes,toArray),arr.responses=_.map(this.responses,toArray),arr.stylesheets=_.map(this.stylesheets,toArray),arr.modalFeedbacks=_.map(this.modalFeedbacks,toArray),arr.responseProcessing=this.responseProcessing.toArray(),arr},
isEmpty:function(){var body=this.body().trim();if(body){var $children=$("<div>").html(body).children();return!(1!==$children.length||!$children.hasClass("empty"))}return!0},clear:function(){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.destroy)&&renderer.destroy(this)}});return Container.augment(Item),Item}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",assessmentItem:"taoQtiItem/qtiItem/core/Item",responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",
stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",gapText:"taoQtiItem/qtiItem/core/choices/GapText",hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",
hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",
graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",
orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",
customInteraction:"taoQtiItem/qtiItem/core/interactions/CustomInteraction",infoControl:"taoQtiItem/qtiItem/core/PortableInfoControl",include:"taoQtiItem/qtiItem/core/Include",table:"taoQtiItem/qtiItem/core/Table",printedVariable:"taoQtiItem/qtiItem/core/PrintedVariable",_tooltip:"taoQtiItem/qtiItem/core/Tooltip"}}),define("taoQtiItem/qtiItem/helper/xmlNsHandler",[],function(){"use strict";var prefixed="article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section";return{stripNs:function(body){var pattern="([\\w]+)\\:("+prefixed+")",openRegEx=new RegExp("(<"+pattern+")","gi"),closeRegEx=new RegExp("(<\\/"+pattern+">)","gi");return body.replace(
openRegEx,"<$3").replace(closeRegEx,"</$3>")},restoreNs:function(xml,namespaces){var tagMatch,xmlRe=new RegExp("(<("+prefixed+")[^>]*>|<\\/("+prefixed+")>)","gi"),tagRe=new RegExp("((<)("+prefixed+")([^>]*)(>)|(<\\/)("+prefixed+")(>))","i"),xmlMatch=xml.match(xmlRe),imsXsd="http://www.imsglobal.org/xsd",html5Ns=imsXsd+"/imsqtiv2p2_html5_v1p0",prefix=function(namespaces,html5Ns){var key;for(key in namespaces)if(namespaces[key]===html5Ns)return key;return"qh5"}(namespaces,html5Ns),prefixAtt="xmlns:"+prefix+'="'+html5Ns+'"',i=xmlMatch?xmlMatch.length:0;if(!xmlMatch)return xml;for(;i--;)tagMatch=xmlMatch[i].match(tagRe),xml=xml.replace(xmlMatch[i],
tagMatch[5]?"<"+prefix+":"+tagMatch[3]+tagMatch[4]+">":"</"+prefix+":"+tagMatch[7]+">");return xmlMatch.length&&-1===xml.indexOf(prefixAtt)&&(xml=xml.replace("<assessmentItem","<assessmentItem "+prefixAtt)),xml=(xml=xml.replace('xmlns="'+imsXsd+'/imsqti_v2p1"','xmlns="'+imsXsd+'/imsqti_v2p2"')).replace('xsi:schemaLocation="'+imsXsd+'/imsqti_v2p1 imsqti_v2p1.xsd"','xsi:schemaLocation="'+imsXsd+"/imsqti_v2p2 "+imsXsd+'/qti/qtiv2p2/imsqti_v2p2.xsd"')}}}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/xmlNsHandler"],function(_,Class,qtiClasses,Element,
xmlNsHandler){"use strict";var Loader=Class.extend({init:function(item,classesLocation){this.qti={},this.classesLocation={},this.item=item||null,this.setClassesLocation(classesLocation||qtiClasses)},setClassesLocation:function(qtiClasses){return _.extend(this.classesLocation,qtiClasses),this},getRequiredClasses:function(data){var i,ret=[];for(i in data)"qtiClass"===i&&"_container"!==data[i]&&"rootElement"!==i?ret.push(data[i]):"object"==typeof data[i]&&"responseRules"!==i&&(ret=_.union(ret,this.getRequiredClasses(data[i])));return ret},loadRequiredClasses:function(data,callback,reload){var i,requiredClass,requiredClasses=this.getRequiredClasses(data,reload),
required=[];for(i in requiredClasses){if(requiredClass=requiredClasses[i],!this.classesLocation[requiredClass])throw new Error("missing qti class location declaration : "+requiredClass);required.push(this.classesLocation[requiredClass])}var _this=this;require(required,function(){_.each(arguments,function(QtiClass){_this.qti[QtiClass.prototype.qtiClass]=QtiClass}),callback.call(_this,_this.qti)})},getLoadedClasses:function(){return _.keys(this.qti)},loadItemData:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){var i;if("object"==typeof data&&"assessmentItem"===data.qtiClass){for(i in data.serial&&Element.unsetElement(
data.serial),_this.item=new Qti.assessmentItem(data.serial,data.attributes||{}),_this.loadContainer(_this.item.getBody(),data.body),data.outcomes){var outcome=_this.buildOutcome(data.outcomes[i]);outcome&&_this.item.addOutcomeDeclaration(outcome)}for(i in data.feedbacks){var feedback=_this.buildElement(data.feedbacks[i]);feedback&&_this.item.addModalFeedback(feedback)}for(i in data.stylesheets){var stylesheet=_this.buildElement(data.stylesheets[i]);stylesheet&&_this.item.addStylesheet(stylesheet)}for(i in data.responses){var response=_this.buildResponse(data.responses[i]);if(response){_this.item.addResponseDeclaration(response)
;var feedbackRules=data.responses[i].feedbackRules;feedbackRules&&_.forIn(feedbackRules,function(fbData,serial){response.feedbackRules[serial]=_this.buildSimpleFeedbackRule(fbData,response)})}}data.responseProcessing&&_this.item.setResponseProcessing(_this.buildResponseProcessing(data.responseProcessing)),_this.item.setNamespaces(data.namespaces),_this.item.setSchemaLocations(data.schemaLocations),_this.item.setApipAccessibility(data.apipAccessibility)}"function"==typeof callback&&callback.call(_this,_this.item)})},loadAndBuildElement:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){var element=_this.buildElement(data)
;"function"==typeof callback&&callback.call(_this,element)})},loadElement:function(element,data,callback){var _this=this;this.loadRequiredClasses(data,function(){_this.loadElementData(element,data),"function"==typeof callback&&callback.call(_this,element)})},loadElements:function(data,callback){var _this=this;if(!_this.item)throw"QtiLoader : cannot load elements in empty item";this.loadRequiredClasses(data,function(){var allElements=_this.item.getComposingElements();for(var i in data){var elementData=data[i];elementData&&elementData.qtiClass&&elementData.serial&&allElements[elementData.serial]&&_this.loadElementData(allElements[elementData.serial],
elementData)}"function"==typeof callback&&callback.call(_this,_this.item)})},buildResponse:function(data){var response=this.buildElement(data);return response.template=data.howMatch||null,response.defaultValue=data.defaultValue||null,response.correctResponse=data.correctResponses||null,_.size(data.mapping)?response.mapEntries=data.mapping:_.size(data.areaMapping)?response.mapEntries=data.areaMapping:response.mapEntries={},response.mappingAttributes=data.mappingAttributes||{},response},buildSimpleFeedbackRule:function(data,response){var feedbackRule=this.buildElement(data);feedbackRule.setCondition(response,data.condition,data.comparedValue||null),
feedbackRule.feedbackOutcome=this.item.outcomes[data.feedbackOutcome]||null,feedbackRule.feedbackThen=this.item.modalFeedbacks[data.feedbackThen]||null,feedbackRule.feedbackElse=this.item.modalFeedbacks[data.feedbackElse]||null;response=feedbackRule.comparedOutcome;return feedbackRule.feedbackThen&&feedbackRule.feedbackThen.data("relatedResponse",response),feedbackRule.feedbackElse&&feedbackRule.feedbackElse.data("relatedResponse",response),feedbackRule},buildOutcome:function(data){var outcome=this.buildElement(data);return outcome.defaultValue=data.defaultValue||null,outcome},buildResponseProcessing:function(data){var rp=this.buildElement(data)
;return data&&data.processingType&&("custom"===data.processingType?(rp.xml=data.data,rp.processingType="custom"):rp.processingType="templateDriven"),rp},loadContainer:function(bodyObject,bodyData){if(!Element.isA(bodyObject,"_container"))throw"bodyObject must be a QTI Container";if(!bodyData||"string"!=typeof bodyData.body||"array"!=typeof bodyData.elements&&"object"!=typeof bodyData.elements)throw"wrong bodydata format";for(var serial in bodyData.elements){var eltData=bodyData.elements[serial],element=this.buildElement(eltData);element&&bodyObject.setElement(element,bodyData.body)}bodyObject.body(xmlNsHandler.stripNs(bodyData.body))},buildElement:function(
elementData){var elt=null;if(!(elementData&&elementData.qtiClass&&elementData.serial))throw"wrong elementData format";var className=elementData.qtiClass;if(!this.qti[className])throw"the qti element class does not exist: "+className;return elt=new this.qti[className](elementData.serial),this.loadElementData(elt,elementData),elt},loadElementData:function(element,data){var attributes=_.defaults(data.attributes||{},element.attributes||{});return element.setAttributes(attributes),element.body&&data.body&&element.bdy&&this.loadContainer(element.getBody(),data.body),element.object&&data.object&&element.object&&this.loadObjectData(element.object,data.object),
Element.isA(element,"interaction")?this.loadInteractionData(element,data):Element.isA(element,"choice")?this.loadChoiceData(element,data):Element.isA(element,"math")?this.loadMathData(element,data):Element.isA(element,"infoControl")?this.loadPicData(element,data):Element.isA(element,"_tooltip")&&this.loadTooltipData(element,data),element},loadInteractionData:function(interaction,data){Element.isA(interaction,"blockInteraction")&&data.prompt&&this.loadContainer(interaction.prompt.getBody(),data.prompt),this.buildInteractionChoices(interaction,data),Element.isA(interaction,"customInteraction")&&this.loadPciData(interaction,data)},
buildInteractionChoices:function(interaction,data){if(data.choices){if(Element.isA(interaction,"matchInteraction"))for(var set=0;set<2;set++){if(!data.choices[set])throw"missing match set #"+set;var matchSet=data.choices[set];for(var serial in matchSet){(choice=this.buildElement(matchSet[serial]))&&interaction.addChoice(choice,set)}}else for(var serial in data.choices){var choice;(choice=this.buildElement(data.choices[serial]))&&interaction.addChoice(choice)}if(Element.isA(interaction,"graphicGapMatchInteraction")&&data.gapImgs)for(var serial in data.gapImgs){var gapImg=this.buildElement(data.gapImgs[serial]);gapImg&&interaction.addGapImg(gapImg)}}},
loadChoiceData:function(choice,data){Element.isA(choice,"textVariableChoice")?choice.val(data.text):Element.isA(choice,"gapImg")||(Element.isA(choice,"gapText")?choice.body()||choice.body(data.text):Element.isA(choice,"containerChoice"))},loadObjectData:function(object,data){object.setAttributes(data.attributes),data._alt&&("object"===data._alt.qtiClass?object._alt=Loader.buildElement(data._alt):object._alt=data._alt)},loadMathData:function(math,data){math.ns=data.ns||{},math.setMathML(data.mathML||""),_.forIn(data.annotations||{},function(value,encoding){math.setAnnotation(encoding,value)})},loadTooltipData:function(tooltip,data){tooltip.content(
data.content)},loadPciData:function(pci,data){loadPortableCustomElementData(pci,data)},loadPicData:function(pic,data){loadPortableCustomElementData(pic,data)}});function loadPortableCustomElementData(portableElement,data){portableElement.typeIdentifier=data.typeIdentifier,portableElement.markup=data.markup,portableElement.entryPoint=data.entryPoint,portableElement.libraries=data.libraries,portableElement.setNamespace("",data.xmlns),function(portableElement,rawProperties){var properties={};_.forOwn(rawProperties,function(value,key){try{properties[key]=JSON.parse(value)}catch(e){properties[key]=value}}),portableElement.properties=properties}(portableElement,
data.properties)}return Loader}),define("taoQtiItem/qtiItem/core/Math",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/mixin/NamespacedElement"],function($,_,Element,rendererConfig,NamespacedElement){"use strict";var Math;return Math=Element.extend({qtiClass:"math",defaultNsName:"m",defaultNsUri:"http://www.w3.org/1998/Math/MathML",nsUriFragment:"MathML",init:function(serial,attributes){this._super(serial,attributes),this.ns=null,this.mathML="",this.annotations={}},setAnnotation:function(encoding,value){this.annotations[encoding]=_.unescape(value)},getAnnotation:function(encoding){
return this.annotations[encoding]},removeAnnotation:function(encoding){delete this.annotations[encoding]},setMathML:function(mathML){var ns=this.getNamespace(),nsName=ns.name&&ns.uri?ns.name:"";mathML=function(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":"")+"math[^>]*>","g");return mathML.replace(regex,"").replace(/^\s*[\r\n]/gm,"").replace(/\s*[\r\n]$/gm,"")}(mathML,nsName),ns&&(mathML=function(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":""),"g");return mathML.replace(regex,"<$1")}(mathML,nsName)),this.mathML=mathML},getMathML:function(){return this.mathML},render:function(){var encoding,defaultData,
args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),tag=this.qtiClass,raw=this.mathML,body=raw,ns=this.getNamespace(),annotations="";for(encoding in this.annotations)annotations+='<annotation encoding="'+encoding+'">'+_.escape(this.annotations[encoding])+"</annotation>";return annotations&&(raw=0<raw.indexOf("</semantics>")?raw.replace("</semantics>",annotations+"</semantics>"):"<semantics>"+raw+annotations+"</semantics>"),ns&&ns.name&&(body=raw.replace(/<(\/)?([^!<])/g,"<$1"+ns.name+":$2"),tag=ns.name+":"+tag),body=(body=body.replace(/<!--.*?-->/g,"")).replace(/&lt;!--.*?--&gt;/g,""),defaultData={
block:"block"===this.attr("display"),body:body,raw:raw,tag:tag,ns:ns},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return!(mathStr=this.mathML,hasContent=!1,mathStr&&mathStr.trim()&&(mathText=$($.parseHTML(mathStr)).text(),hasContent=_.isString(mathText)&&!!mathText.trim()),hasContent||this.annotations.latex&&this.annotations.latex.trim());var mathStr,mathText,hasContent}}),NamespacedElement.augment(Math),Math}),define("taoQtiItem/qtiItem/core/PortableInfoControl",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement",
"taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,CustomElement,NamespacedElement,rendererConfig){"use strict";var PortableInfoControl=Element.extend({qtiClass:"infoControl",defaultNsName:"pic",defaultNsUri:"http://www.imsglobal.org/xsd/portableInfoControl",nsUriFragment:"portableInfoControl",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.readyStack=[]},is:function(qtiClass){return"infoControl"===qtiClass||this._super(qtiClass)},render:function(){
var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pic:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getState:function(){var ret=null,renderer=this.getRenderer();return renderer&&_.isFunction(renderer.getState)&&(ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.getState)&&renderer.setState(this,state)},
toArray:function(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},onReady:function(cb){this.readyStack.push(cb),this.data("_ready")&&this.data("pic")&&this.triggerReady()},triggerReady:function(){var self=this;_.forEach(this.readyStack,function(cb){cb.call(self,self.data("pic"))}),this.readyStack=[],this.data("_ready",!0)}});return CustomElement.augment(PortableInfoControl),NamespacedElement.augment(PortableInfoControl),PortableInfoControl}),define("taoQtiItem/qtiItem/core/PrintedVariable",["taoQtiItem/qtiItem/core/Element"],function(Element){"use strict";return Element.extend({qtiClass:"printedVariable"})}),define(
"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){"use strict";return Element.extend({qtiClass:"_simpleFeedbackRule",serial:"",rootElement:null,init:function(serial,feedbackOutcome,feedbackThen,feedbackElse){this._super(serial,{}),this.condition="correct",this.comparedOutcome=null,this.comparedValue=0,this.feedbackOutcome=feedbackOutcome,Element.isA(feedbackThen,"feedback")?this.feedbackThen=feedbackThen:this.feedbackThen=null,Element.isA(feedbackElse,"feedback")?this.feedbackElse=feedbackThen:this.feedbackElse=null},setCondition:function(comparedOutcome,condition,comparedValue){
var _comparedValues=[];if(!Element.isA(comparedOutcome,"variableDeclaration"))throw"invalid outcome type: must be a variableDeclaration";switch(condition){case"correct":case"incorrect":if(!Element.isA(comparedOutcome,"responseDeclaration"))throw"invalid outcome type: must be a responseDeclaration";this.comparedOutcome=comparedOutcome,this.condition=condition;break;case"lt":case"lte":case"equal":case"gte":case"gt":if(null==comparedValue)throw"compared value must not be null";this.comparedOutcome=comparedOutcome,this.condition=condition,this.comparedValue=comparedValue;break;case"choices":if(!Element.isA(comparedOutcome,"responseDeclaration"
)||null===comparedValue||!_.isArray(comparedValue))throw"compared value must not be null";var choices=_.values(comparedOutcome.getInteraction().getChoices());this.comparedOutcome=comparedOutcome,this.condition=condition,_.each(comparedValue,function(v){v instanceof Element?_comparedValues.push(v):_.isString(v)&&_.each(choices,function(c){if(c.attr("identifier")===v)return _comparedValues.push(c),!1})}),this.comparedValue=_comparedValues;break;default:throw"unknown condition type : ".condition}return this},setFeedbackElse:function(feedback){Element.isA(feedback,"feedback")&&(this.feedbackElse=feedback)},toArray:function(){var val=this.comparedValue,
_toString=function(v){return val instanceof Element?val.attr("identifier"):val+""};return val=_.isArray(val)?_.map(val,_toString):_toString(),{condition:this.condition,comparedOutcome:this.comparedOutcome.id(),comparedValue:val}}})}),define("taoQtiItem/qtiItem/core/ResponseProcessing",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){return Element.extend({qtiClass:"responseProcessing",processingType:"",xml:"",toArray:function(){var arr=this._super();return arr.processingType=this.processingType,arr.xml=this.xml,arr}})}),define("taoQtiItem/qtiItem/core/RubricBlock",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/Container"],
function(Element,Container){var RubricBlock=Element.extend({qtiClass:"rubricBlock",isEmpty:function(){return!(this.bdy&&this.bdy.body())}});return Container.augment(RubricBlock),RubricBlock}),define("taoQtiItem/qtiItem/core/Stylesheet",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){return Element.extend({qtiClass:"stylesheet",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={href:renderer.resolveUrl(this.attr("href"))},this._super(_.merge(defaultData,args.data),
args.placeholder,args.subclass,renderer)}})}),define("taoQtiItem/qtiItem/mixin/ContainerTable",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){"use strict";var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="table"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Table",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerTable"],function(_,Element,Container){"use strict"
;var Table=Element.extend({qtiClass:"table"});return Container.augment(Table),Table=Table.extend({body:function(newBody){return _.isString(newBody)&&(newBody=newBody.replace("<table>","").replace("</table>","")),this._super(newBody)}})}),define("taoQtiItem/qtiItem/core/Tooltip",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,ContainerInline,rendererConfig){"use strict";var Tooltip=Element.extend({qtiClass:"_tooltip",init:function(serial,attributes,newContent){this._super(serial,attributes),this.content(newContent||"")},content:function(newContent){if(
void 0===newContent)return this.tooltipContent;if("string"!=typeof newContent)throw new Error("newContent must be a string");return this.tooltipContent=newContent,this},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={content:this.tooltipContent};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return ContainerInline.augment(Tooltip),Tooltip}),define("taoQtiItem/qtiItem/core/variables/ResponseDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration","lodash"],function(VariableDeclaration,_){"use strict"
;return VariableDeclaration.extend({qtiClass:"responseDeclaration",init:function(serial,attributes){this._super(serial,attributes),this.template="",this.mappingAttributes={},this.mapEntries={},this.correctResponse=null,this.feedbackRules={}},getFeedbackRules:function(){return _.values(this.feedbackRules)},getComposingElements:function(){var elts=this._super();return elts=_.extend(elts,this.feedbackRules)},toArray:function(){var arr=this._super();return arr.howMatch=this.template,arr.correctResponses=this.correctResponse,arr.mapping=this.mapEntries,arr.mappingAttributes=this.mappingAttributes,arr.feedbackRules=_.map(this.feedbackRules,function(rule){
return rule.toArray()}),arr},getInteraction:function(){var interaction=null,responseId=this.id(),interactions=this.getRootElement().getInteractions();return _.each(interactions,function(i){if(i.attributes.responseIdentifier===responseId)return interaction=i,!1}),interaction},isCardinality:function(cardinalities){var comparison;if(_.isArray(cardinalities))comparison=cardinalities;else{if(!_.isString(cardinalities))return!1;cardinalities=[cardinalities]}return 0<=_.indexOf(comparison,this.attr("cardinality"))}})}),define("taoQtiItem/qtiItem/helper/EventMgr",["lodash"],function(_){return function(){var events={};this.get=function(event){
return event&&events[event]?_.clone(events[event]):[]},this.on=function(event,callback){var tokens=event.split(".");if(tokens[0]){var name=tokens.shift();events[name]=events[name]||[],events[name].push({ns:tokens,callback:callback})}},this.off=function(event){event&&events[event]&&(events[event]=[])},this.trigger=function(event,data){events[event]&&_.each(events[event],function(e){e.callback.apply({type:event,ns:[]},data)})}}}),define("taoQtiItem/qtiItem/helper/pci",["lodash"],function(_){return{getRawValues:function(pciVar){if(_.isPlainObject(pciVar)){if(void 0!==pciVar.base)return _.values(pciVar.base);if(pciVar.list)return _.values(pciVar.list)}
throw"unsupported type "}}}),define("taoQtiItem/qtiItem/helper/modalFeedback",["jquery","lodash","taoQtiItem/qtiItem/helper/pci","taoQtiItem/qtiItem/helper/container"],function($,_,pci,containerHelper){"use strict";var getInteractionsDisplayInfo=function(item){var interactionsDisplayInfo=[],$itemContainer=item.getContainer(),interactionOrder=0;return _.forEach(item.getComposingElements(),function(element){var interaction,messageGroupId,$displayContainer,$interactionContainer,responseIdentifier;element.is("interaction")&&interactionsDisplayInfo.push(($interactionContainer=(interaction=element).getContainer(),responseIdentifier=interaction.attr(
"responseIdentifier"),interaction.is("inlineInteraction")?(messageGroupId=($displayContainer=$interactionContainer.closest('[class*=" col-"], [class^="col-"]')).attr("data-messageGroupId"))||(messageGroupId=_.uniqueId("inline_message_group_"),$displayContainer.attr("data-messageGroupId",messageGroupId)):(messageGroupId=responseIdentifier,$displayContainer=$interactionContainer),{responseIdentifier:responseIdentifier,interactionContainer:$interactionContainer,displayContainer:$displayContainer,messageGroupId:messageGroupId,order:-1}))}),$itemContainer.find(".qti-interaction").each(function(){var self=this;_.forEach(interactionsDisplayInfo,function(
_interactionInfo){if(_interactionInfo.interactionContainer[0]===self)return _interactionInfo.order=interactionOrder,!1}),interactionOrder++}),interactionsDisplayInfo=_.sortBy(interactionsDisplayInfo,"order")};return{getFeedbacks:function(item,itemSession){var messages={},$itemContainer=item.getContainer(),$itemBody=$(".qti-itemBody",$itemContainer),interactionsDisplayInfo=getInteractionsDisplayInfo(item),renderingQueue=[];return _.forEach(item.modalFeedbacks,function(feedback){var feedbackIds,message,$container,comparedOutcome,_currentMessageGroupId,interactionInfo,outcomeIdentifier=feedback.attr("outcomeIdentifier"),order=-1;if(
itemSession[outcomeIdentifier]){if(feedbackIds=pci.getRawValues(itemSession[outcomeIdentifier]),!_.contains(feedbackIds,feedback.id()))return!0;if(message=function(feedback){return(""+feedback.body()+feedback.attr("title")).toLowerCase().trim().replace(/x-tao-[a-zA-Z0-9\-._\s]*/g,"")}(feedback),comparedOutcome=containerHelper.getEncodedData(feedback,"relatedOutcome"),interactionInfo=_.find(interactionsDisplayInfo,{responseIdentifier:comparedOutcome}),comparedOutcome&&interactionInfo?($container=interactionInfo.displayContainer,_currentMessageGroupId=interactionInfo.messageGroupId,order=interactionInfo.order):($container=$itemBody,
_currentMessageGroupId="__item__"),messages[_currentMessageGroupId]||(messages[_currentMessageGroupId]=[]),_.contains(messages[_currentMessageGroupId],message))return!0;messages[_currentMessageGroupId].push(message),renderingQueue.push({feedback:feedback,$container:$container,order:order})}}),renderingQueue=_.sortBy(renderingQueue,"order")}}}),define("taoQtiItem/qtiItem/helper/Parser",["jquery"],function($){return function(){var _$xml=null;this.loadXML=function(xml){_$xml=$.parseXML(xml)},this.getDOM=function(){return _$xml}}}),define("taoQtiItem/qtiItem/helper/simpleParser",["lodash","jquery","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/core/Loader"
],function(_,$,util,Loader){"use strict";var _parsableElements=["img","object","printedVariable"],_qtiClassNames={rubricblock:"rubricBlock",printedvariable:"printedVariable"},_qtiAttributesNames={powerform:"powerForm",mappingindicator:"mappingIndicator"},_defaultOptions={ns:{math:"",include:"xi"},loaded:null,model:null};function _getElementSelector(qtiClass,ns){return ns?ns+"\\:"+qtiClass+","+qtiClass:qtiClass}function buildElement($elt){var qtiClass=function($node){var qtiClass=$node.prop("tagName").toLowerCase();return qtiClass=qtiClass.replace(/.*:/,""),_qtiClassNames[qtiClass]?_qtiClassNames[qtiClass]:qtiClass}($elt),elt={qtiClass:qtiClass,
serial:util.buildSerial(qtiClass+"_"),attributes:{}};return $.each($elt[0].attributes,function(){var attrName;this.specified&&(attrName=_qtiAttributesNames[this.name]||this.name,elt.attributes[attrName]=this.value)}),elt}function parseContainer($container,options){var ret={serial:util.buildSerial("_container_"),body:"",elements:{}};return _.each(_parsableElements,function(qtiClass){$container.find(qtiClass).each(function(){var $qtiElement=$(this),element=buildElement($qtiElement);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))})}),$container.find(_getElementSelector("math",options.ns.math)).each(function(){
var $qtiElement=$(this),element=function($elt,options){var elt=buildElement($elt);return elt.annotations={},$elt.find(_getElementSelector("annotation",options.ns.math)).each(function(){var $annotation=$(this),encoding=$annotation.attr("encoding");encoding&&(elt.annotations[encoding]=_.unescape($annotation.html())),$annotation.remove()}),elt.mathML=$elt.html(),elt.ns={name:"m",uri:"http://www.w3.org/1998/Math/MathML"},elt}($qtiElement,options);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))}),$container.find(_getElementSelector("include",options.ns.include)).each(function(){var $qtiElement=$(this),element=buildElement(
$qtiElement);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))}),$container.find('[data-role="tooltip-target"]').each(function(){var element,$content,contentHtml,$target=$(this),contentId=$target.attr("aria-describedBy");contentId&&($content=$container.find("#"+contentId)).length&&(contentHtml=$content.html(),element=function(targetHtml,contentId,contentHtml){return{elements:{},qtiClass:"_tooltip",serial:util.buildSerial("_tooltip_"),attributes:{"aria-describedby":contentId},content:contentHtml,body:{elements:{},serial:util.buildSerial("container"),body:targetHtml}}}($target.html(),contentId,contentHtml),
ret.elements[element.serial]=element,$target.replaceWith(_placeholder(element)),$content.remove())}),ret.body=$container.html(),ret}function _placeholder(element){return"{{"+element.serial+"}}"}return{parse:function(xmlStr,opts){var options=_.merge(_.clone(_defaultOptions),opts||{}),$container=$(xmlStr),element=buildElement($container),data=parseContainer($container,options);return _.isUndefined(data.body)||(element.body=data),_.isFunction(options.loaded)&&options.model&&(new Loader).setClassesLocation(options.model).loadAndBuildElement(element,options.loaded),element}}}),define("taoQtiItem/qtiItem/helper/xincludeLoader",["jquery","lodash",
"taoQtiItem/qtiItem/helper/simpleParser","taoQtiItem/qtiItem/core/Loader"],function($,_,simpleParser,Loader){return{load:function(xinclude,baseUrl,callback){var href=xinclude.attr("href");href&&baseUrl&&require(["text!"+baseUrl+href],function(stimulusXml){var $sampleXMLrootNode=$("<div>").html(stimulusXml).children(),$stimulus=$("<include>").append($sampleXMLrootNode),data=simpleParser.parse($stimulus,{ns:{math:"m"}});(new Loader).loadElement(xinclude,data,function(){if(_.isFunction(callback)){var loadedClasses=this.getLoadedClasses();loadedClasses.push("_container"),callback(xinclude,data,loadedClasses)}})},function(err){callback(xinclude,!1,[])})}}}),
define("taoQtiItem/runner/provider/manager/picManager",["jquery","lodash","taoQtiItem/qtiItem/core/Element"],function($,_,Element){"use strict";var picManager={init:function(pic,item){return Element.isA(pic,"infoControl")&&(this._pic=pic),Element.isA(item,"assessmentItem")&&(this._item=item),this},getPic:function(){return this._pic},getItem:function(){return this._item},getSerial:function(){return this._pic&&this._pic.serial},getTypeIdentifier:function(){return this._pic&&this._pic.typeIdentifier},getDom:function(){if(!this._dom){var pic,tool,serial=this.getSerial();serial&&(pic=$('[data-serial="'+serial+'"]')).length&&((tool=$(
'[data-pic-serial="'+serial+'"]')).length||(tool=pic.children().first()),this._dom={pic:pic,tool:tool,button:tool.find(".sts-button"),broken:pic.is(":empty")})}return this._dom},enable:function(){var dom=this.getDom();return dom&&(dom.button.removeClass("disabled"),dom.tool.find(".sts-button-disable-mask").remove(),this.disabled=!1,this.trigger("enable")),this},disable:function(){var button,dom=this.getDom();return dom&&(button=dom.button.addClass("disabled"),$('<div class="sts-button-disable-mask" style="position:absolute;z-index:10000000000000"></div>').appendTo(dom.tool).offset(button.offset()).width(button.outerWidth()).height(button.outerHeight()),
dom.tool.find(".sts-container, .sts-menu-container").addClass("sts-hidden-container"),this.disabled=!0,this.trigger("disable")),this},show:function(){var dom=this.getDom();return dom&&(dom.tool.show(),this.trigger("show")),this},hide:function(){var dom=this.getDom();return dom&&(dom.tool.hide(),this.trigger("hide")),this},trigger:function(eventName){var dom=this.getDom(),args=_.rest(arguments,1);return args.unshift(this),dom&&(dom.tool.trigger(eventName,args),dom.broken&&dom.pic.trigger(eventName,args)),this}},picManagerCollection={init:function(item){return Element.isA(item,"assessmentItem")&&(this._item=item),this},getList:function(force){var self=this
;return!force&&self._list||(self._map={},self._list=[],self._item&&_.forEach(self._item.getElements(),function(element){var manager;Element.isA(element,"infoControl")&&(manager=managerFactory(element,self._item),self._list.push(manager),self._map[element.serial]=manager,self._map[element.typeIdentifier]=manager)})),this._list},getPic:function(picId){return this.getList(),this._map[picId]},execute:function(picId,action){var pic=this.getPic(picId);if(pic&&pic[action])return pic[action].apply(pic,_.rest(arguments,2))},executeAll:function(action,filter){var cb,args=_.rest(arguments,2);return cb="function"==typeof filter?function(pic){filter.call(pic,pic
)&&pic[action]&&pic[action].apply(pic,args)}:function(pic){pic[action]&&pic[action].apply(pic,args)},this.each(cb)},each:function(cb){return _.forEach(this.getList(),cb),this},enablePic:function(picId){return this.execute(picId,"enable"),this},disablePic:function(picId){return this.execute(picId,"disable"),this},showPic:function(picId){return this.execute(picId,"show"),this},hidePic:function(picId){return this.execute(picId,"hide"),this},enableAll:function(filter){return this.executeAll("enable",filter),this},disableAll:function(filter){return this.executeAll("disable",filter),this},showAll:function(filter){return this.executeAll("show",filter),this},
hideAll:function(filter){return this.executeAll("hide",filter),this}},managerFactory=function(pic,item){return _.clone(picManager,!0).init(pic,item)};return{collection:function(item){return _.clone(picManagerCollection,!0).init(item)},manager:managerFactory}}),define("taoQtiItem/runner/provider/manager/userModules",["lodash","module","core/promise"],function(_,module,Promise){"use strict";return{load:function(userModules){var config=module.config();return userModules&&_.isArray(userModules)||(userModules=config&&config.userModules&&_.isArray(config.userModules)?config.userModules:[]),new Promise(function(resolve,reject){require(userModules,function(){
_.forEach(arguments,function(dependency){dependency&&_.isFunction(dependency.exec)&&dependency.exec()}),resolve()},function(err){reject(err.message)})})}}}),define("taoQtiItem/portableElementRegistry/provider/sideLoadingProviderFactory",[],function(){"use strict";return function(portableElements){var _registry=portableElements;return{add:function(id,portableElement){return _registry[id]=portableElement,this},load:function(){return _registry}}}}),define("taoQtiItem/runner/provider/qti",["jquery","lodash","context","core/promise","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiItem/core/Element","taoQtiItem/portableElementRegistry/ciRegistry",
"taoQtiItem/portableElementRegistry/icRegistry","taoQtiItem/portableElementRegistry/provider/sideLoadingProviderFactory","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/runner/provider/manager/picManager","taoQtiItem/runner/provider/manager/userModules","taoQtiItem/qtiItem/helper/modalFeedback","taoItems/assets/manager"],function($,_,context,Promise,QtiLoader,Element,ciRegistry,icRegistry,sideLoadingProviderFactory,QtiRenderer,picManager,userModules,modalFeedbackHelper){"use strict";var timeout=1e3*(0<context.timeout?context.timeout+1:30);return{init:function(itemData,done){var self=this,rendererOptions=_.merge({assetManager:this.assetManager},
_.pick(this.options,["themes","preload"]));this._renderer=new QtiRenderer(rendererOptions),this._loader=new QtiLoader,this._loader.loadItemData(itemData,function(item){if(!item)return self.trigger("error","Unable to load item from the given data.");self._item=item,self._renderer.load(function(){self._item.setRenderer(this),done()},this.getLoadedClasses())})},render:function(elt,done,options){var self=this;if(options=_.defaults(options||{},{state:{}}),this._item){try{elt.innerHTML=this._item.render({})}catch(e){self.trigger("error","Error in template rendering : "+e.message)}try{options.portableElements&&(options.portableElements.pci&&(
ciRegistry.resetProviders(),ciRegistry.registerProvider("pciDeliveryProvider",sideLoadingProviderFactory(options.portableElements.pci))),options.portableElements.pic&&(icRegistry.resetProviders(),icRegistry.registerProvider("picDeliveryProvider",sideLoadingProviderFactory(options.portableElements.pic)))),Promise.race([Promise.all(this._item.postRender(options)),new Promise(function(resolve,reject){_.delay(reject,timeout,new Error("Post rendering ran out of time."))})]).then(function(){return $(elt).off("responseChange").on("responseChange",function(){self.trigger("statechange",self.getState()),self.trigger("responsechange",self.getResponses())}).off(
"endattempt").on("endattempt",function(e,responseIdentifier){self.trigger("endattempt",responseIdentifier||e.originalEvent.detail)}).off("themechange").on("themechange",function(e,themeName){var themeLoader=self._renderer.getThemeLoader();themeName=themeName||e.originalEvent.detail,themeLoader&&themeLoader.change(themeName)}),self.trigger("listpic",picManager.collection(self._item)),userModules.load().then(done)}).catch(function(err){self.trigger("error","Error in post rendering : "+err instanceof Error?err.message:err)})}catch(err){self.trigger("error","Error in post rendering : "+err.message)}}},clear:function(elt,done){var self=this
;self._item&&Promise.all(this._item.getInteractions().map(function(interaction){return interaction.clear()})).then(function(){self._item.clear(),$(elt).off("responseChange").off("endattempt").off("themechange").off("feedback").empty(),self._renderer&&self._renderer.unload(),self._item=null}).then(done).catch(function(err){self.trigger("error","Something went wrong while destroying an interaction: "+err.message)})},getState:function(){var state={};return this._item&&(_.forEach(this._item.getInteractions(),function(interaction){state[interaction.attr("responseIdentifier")]=interaction.getState()}),_.forEach(this._item.getElements(),function(element){
Element.isA(element,"infoControl")&&element.attr("id")&&(state.pic=state.pic||{},state.pic[element.attr("id")]=element.getState())})),state},setState:function(state){this._item&&state&&(_.forEach(this._item.getInteractions(),function(interaction){var id=interaction.attr("responseIdentifier");id&&state[id]&&interaction.setState(state[id])}),state.pic&&_.forEach(this._item.getElements(),function(element){Element.isA(element,"infoControl")&&state.pic[element.attr("id")]&&element.setState(state.pic[element.attr("id")])}))},getResponses:function(){var responses={};return this._item&&_.reduce(this._item.getInteractions(),function(res,interaction){
return responses[interaction.attr("responseIdentifier")]=interaction.getResponse(),responses},responses),responses},renderFeedbacks:function(feedbacks,itemSession,done){var _renderer=this._item.getRenderer();new QtiLoader(this._item).loadElements(feedbacks,function(item){_renderer.load(function(){var renderingQueue=modalFeedbackHelper.getFeedbacks(item,itemSession);done(renderingQueue)},this.getLoadedClasses())})}}}),define("taoQtiItem/runner/qtiItemRunner",["taoItems/runner/api/itemRunner","taoQtiItem/runner/provider/qti"],function(itemRunner,qtiRuntimeProvider){"use strict";return itemRunner.register("qti",qtiRuntimeProvider),itemRunner}),define(
"taoQtiItem/loader/taoQtiItemRunner.bundle",function(){}),define("taoQtiItem/loader/taoQtiItemRunner.min",["taoItems/loader/taoItemsRunner.min"],function(){});
//# sourceMappingURL=taoQtiItemRunner.min.js.map