function _typeof2(obj){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)}define("core/format",["lodash"],function(_){'use strict';function format(message){var replacements=Array.prototype.slice.call(arguments,1);return _.reduce(message.match(pattern),function(acc,match,index){var replacement="";if(void 0!==replacements[index]){switch(match){case"%d":replacement=+replacements[index];break;case"%j":try{replacement=JSON.stringify(replacements[index]).replace(/"/g,"")}catch(e){}break;default:replacement=replacements[index];}message=message.replace(match,replacement)}return message},message)}_=_&&_.hasOwnProperty("default")?_["default"]:_;var pattern=/(%[sdj])/g;return format}),define("core/promise",[],function(){'use strict';return Promise}),define("core/logger/api",["lodash","core/format","core/promise"],function(_,format,Promise){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,format=format&&format.hasOwnProperty("default")?format["default"]:format,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise;var defaultLevel="info",levels={fatal:60,error:50,warn:40,info:30,debug:20,trace:10},logQueue=[],getLevel=function(level){return"undefined"==typeof level||_.isString(level)&&!_.has(levels,level)?defaultLevel:_.isNumber(level)?_.findKey(levels,function(l){return l===level})||defaultLevel:level},getLevelNum=function(level){return _.isString(level)&&_.has(levels,level)?levels[level]:_.isNumber(level)&&_.contains(levels,level)?level:levels[defaultLevel]},checkMinLevel=function(minLevel,level){return getLevelNum(level)>=getLevelNum(minLevel)},loggerFactory=function loggerFactory(name,minLevel,fields){var baseRecord,logger;if(!_.isString(name)||_.isEmpty(name))throw new TypeError("A logger needs a name");return _.isPlainObject(minLevel)&&"undefined"==typeof field&&(fields=minLevel,minLevel=defaultLevel),baseRecord=_.defaults(fields||{},{name:name,pid:1,hostname:navigator.userAgent}),logger={log:function(level,recordFields,message){var rest=[],time=new Date().toISOString(),record,err;if(!1!==loggerFactory.providers&&checkMinLevel(minLevel||defaultLevel,level))return _.isString(recordFields)||recordFields instanceof Error?(message=recordFields,recordFields={},rest=[].slice.call(arguments,2)):rest=[].slice.call(arguments,3),record={level:getLevel(level),v:0,time:time},checkMinLevel(levels.error,level)||message instanceof Error?(message instanceof Error?err=message:(message=_.isObject(message)?JSON.stringify(message):message,err=new Error(message)),record.msg=err.message,record.err=err):record.msg=format.apply(null,[message].concat(rest)),_.merge(record,baseRecord,recordFields),logQueue.push(record),loggerFactory.flush(),this},level:function(value){return"undefined"==typeof value?getLevel(minLevel):(minLevel=getLevelNum(value),this)},child:function(childFields){return loggerFactory(name,minLevel,_.defaults(childFields,baseRecord))}},_.reduce(levels,function(target,level,levelName){return target[levelName]=_.partial(logger.log,level),target},logger)};return loggerFactory.levels=levels,loggerFactory.providers=!1,loggerFactory.load=function(providerConfigs){var self=this,modules=[];return this.providers=[],new Promise(function(resolve,reject){_.forEach(providerConfigs,function(providerConfig,providerName){modules.push(providerName)}),require(modules,function(){var loadedProviders=[].slice.call(arguments);_.forEach(loadedProviders,function(provider,moduleKey){try{self.register(provider,providerConfigs[modules[moduleKey]])}catch(err){reject(err)}}),self.flush(),resolve()},reject)})},loggerFactory.register=function(provider,providerConfig){if(!_.isPlainObject(provider)||!_.isFunction(provider.log))throw new TypeError("A log provider is an object with a log method");provider.checkMinLevel=checkMinLevel,_.isFunction(provider.setConfig)&&provider.setConfig(providerConfig),this.providers=this.providers||[],this.providers.push(provider)},loggerFactory.flush=function(){_.isArray(this.providers)&&0<this.providers.length&&(_.forEach(logQueue,function(message){_.forEach(loggerFactory.providers,function(provider){provider.log.call(provider,message)})}),logQueue=[])},loggerFactory.setDefaultLevel=function(level){return defaultLevel=getLevel(level),defaultLevel},loggerFactory}),define("core/logger",["lodash","module","core/logger/api"],function(_,module,loggerFactory){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,module=module&&module.hasOwnProperty("default")?module["default"]:module,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var defaultConfig={level:loggerFactory.levels.warn,loggers:{"core/logger/console":{level:"warn"}}},config=_.defaults(module.config()||{},defaultConfig),logger=loggerFactory("core/logger");return loggerFactory.setDefaultLevel(config.level),loggerFactory.load(config.loggers),window.onerror=function(msg,url,line,col){logger.error("Caught[via window.onerror]: '"+msg+"' from "+url+":"+line+":"+col)},window.setTaoLogLevel=function(level){return loggerFactory.setDefaultLevel(level)},loggerFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("lib/uuid",factory):(global=global||self,global.uuid=factory())}(this,function(){'use strict';var CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];return function(len,radix){var chars=CHARS,uuid=[],i,r;if(radix=radix||chars.length,len)for(i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];else for(uuid[8]=uuid[13]=uuid[18]=uuid[23]="-",uuid[14]="4",i=0;36>i;i++)uuid[i]||(r=0|16*Math.random(),uuid[i]=chars[19===i?8|3&r:r]);return uuid.join("")}}),define("core/eventifier",["lodash","core/promise","lib/uuid","core/logger"],function(_,Promise,uuid,loggerFactory){'use strict';function getEventNames(eventNames){return!_.isString(eventNames)||_.isEmpty(eventNames)?[]:_(eventNames.split(/\s/g)).compact().uniq().value()}function getName(eventName){return-1<eventName.indexOf(".")?eventName.substr(0,eventName.indexOf(".")):eventName}function getNamespace(eventName){return-1<eventName.indexOf(".")?eventName.substr(eventName.indexOf(".")+1):"@"}function getHandlerObject(){return{before:[],between:[],after:[]}}function eventifier(target){var eventHandlers={},getHandlers=function(eventName,type){var name=getName(eventName),ns=getNamespace(eventName);return type=type||"between",eventHandlers[ns]=eventHandlers[ns]||{},eventHandlers[ns][name]=eventHandlers[ns][name]||getHandlerObject(),eventHandlers[ns][name][type]},eventApi={on:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName).push(handler)}),this},off:function(eventNames){return _.forEach(getEventNames(eventNames),function(eventName){var name=getName(eventName),ns=getNamespace(eventName),offNamespaces;ns&&!name?"*"===ns?(offNamespaces={},offNamespaces["@"]=eventHandlers["@"],eventHandlers=offNamespaces):eventHandlers[ns]={}:_.forEach(eventHandlers,function(nsHandlers,namespace){nsHandlers[name]&&("@"===ns||ns===namespace)&&(nsHandlers[name]=getHandlerObject())})}),this},removeAllListeners:function(){return eventHandlers={},this},trigger:function(eventNames){function triggerAllHandlers(allHandlers,name,ns){var event={name:name,namespace:ns};allHandlers.before.length?triggerBefore(allHandlers.before,event).then(function(){triggerBetween(allHandlers,event)}).catch(function(err){logHandlerStop("before",event,err)}):triggerBetween(allHandlers,event)}function triggerBefore(handlers,event){var beforeArgs=args.slice(),pHandlers;return beforeArgs.unshift(event),pHandlers=handlers.map(function(handler){var value=!shouldStop(event.name)&&handler.apply(self,beforeArgs);return!1===value?Promise.reject():value}),Promise.all(pHandlers)}function triggerBetween(allHandlers,event){shouldStop(event.name)?logHandlerStop("before",event):triggerHandlers(allHandlers.between,event).then(function(){triggerAfter(allHandlers.after,event)}).catch(function(err){logHandlerStop("on",event,err)})}function triggerAfter(handlers,event){shouldStop(event.name)?logHandlerStop("on",event):triggerHandlers(handlers,event).then(function(){shouldStop(event.name)&&logHandlerStop("after",event)}).catch(function(err){logHandlerStop("after",event,err)})}function triggerHandlers(handlers,event){var pHandlers;return pHandlers=handlers.map(function(handler){return shouldStop(event.name)?Promise.reject():handler.apply(self,args)}),Promise.all(pHandlers)}function logHandlerStop(stoppedIn,event,err){err instanceof Error&&logger.error(err),logger.trace({err:err,event:event.name,stoppedIn:stoppedIn},event.name+" handlers stopped")}function shouldStop(name){return stoppedEvents[name]}var self=this,args=[].slice.call(arguments,1);return stoppedEvents={},_.forEach(getEventNames(eventNames),function(eventName){var ns=getNamespace(eventName),name=getName(eventName),mergedHandlers=_(eventHandlers).filter(function(nsHandlers,namespace){return nsHandlers[name]&&("@"===ns||ns===namespace||"*"===namespace)}).reduce(function(acc,nsHandlers){return acc.before=acc.before.concat(nsHandlers[name].before),acc.between=acc.between.concat(nsHandlers[name].between),acc.after=acc.after.concat(nsHandlers[name].after),acc},getHandlerObject());logger.trace({event:eventName,args:args},"trigger %s",eventName),mergedHandlers&&triggerAllHandlers(mergedHandlers,name,ns)}),this},before:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"before").push(handler)}),this},after:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"after").push(handler)}),this},stopEvent:function(name){_.isString(name)&&!_.isEmpty(name.trim())&&(stoppedEvents[name.trim()]=!0)},spread:function(destination,eventNames){var self=this;return destination&&_.isFunction(destination.trigger)&&(_.isString(eventNames)&&(eventNames=getEventNames(eventNames)),_.forEach(eventNames,function(eventName){self.on(eventName,function(){var args=[eventName].concat([].slice.call(arguments));destination.trigger.apply(destination,args)})})),this}},targetName,logger,stoppedEvents;return target=target||{},targetName=target.name||target.id||target.serial||uuid(6),logger=eventifierLogger.child({target:targetName}),_(eventApi).functions().forEach(function(method){_.isFunction(target[method])&&eventifierLogger.warn("The target object has already a method named "+method,target),target[method]=function(){var args=[].slice.call(arguments);return eventApi[method].apply(target,args)}}),target}_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var eventifierLogger=loggerFactory("core/eventifier");return eventifier}),define("css!ui/component/css/components",[],function(){}),define("ui/component",["jquery","lodash","core/eventifier","handlebars","i18n","lib/dompurify/purify","css!ui/component/css/components.css"],function($$1,_,eventifier,Handlebars,__,DOMPurify){'use strict';var _Mathround=Math.round;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function defaultTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function delegatedResize(){var width=this.config.width,height=this.config.height,$container=this.getContainer(),$element=this.getElement();$container&&("auto"===width&&(width=$container.width()),"auto"===height&&(height=$container.height())),$element&&(_.isNumber(width)&&$element.css({width:"".concat(width,"px")}),_.isNumber(height)&&$element.css({height:"".concat(height,"px")})),this._width=width,this._height=height}function component(specs,defaults){var componentTpl=defaultTpl,componentState={},componentApi={init:function(config){return this.config=_(config||{}).omit(function(value){return null===value||"undefined"==typeof value}).defaults(defaults||{}).value(),componentState={},this.trigger("init"),this.config.renderTo&&($container=$$1(this.config.renderTo),this.render()),this},destroy:function(){return this.trigger("destroy"),this.$component&&this.$component.remove(),this.$component=null,componentState={},this},render:function(container){return container&&($container=$$1(container)),this.$component=$$1(componentTpl(this.config)),$container&&(this.config.replace&&$container.empty(),$container.append(this.$component)),this.setState("rendered",!0),delegatedResize.call(this),this.trigger("render",this.$component),this},setSize:function(width,height){return this.config.width=width,this.config.height=height,this.is("rendered")&&delegatedResize.call(this),this.trigger("setsize",width,height),this},getSize:function(){if(this.is("rendered"))return{width:this._width||0,height:this._height||0}},getOuterSize:function(includeMargin){var $component;if(this.is("rendered"))return $component=this.getElement(),includeMargin=includeMargin||!1,{width:_Mathround($component.outerWidth(includeMargin)),height:_Mathround($component.outerHeight(includeMargin))}},show:function(){return this.trigger("show",this),this.setState("hidden",!1)},hide:function(){return this.trigger("hide",this),this.setState("hidden",!0)},enable:function(){return this.trigger("enable",this),this.setState("disabled",!1)},disable:function(){return this.trigger("disable",this),this.setState("disabled",!0)},is:function(state){return!!componentState[state]},setState:function(state,flag){return flag=!!flag,componentState[state]=flag,this.$component&&this.$component.toggleClass(state,flag),this.trigger("state",state,flag,this),this},getContainer:function(){return $container},getElement:function(){return this.$component},getTemplate:function(){return componentTpl},setTemplate:function(template){var tpl=template||defaultTpl;return componentTpl=tpl,_.isFunction(componentTpl)||(componentTpl=function(){return tpl}),this.trigger("template",componentTpl),this},getConfig:function(){return this.config||defaults||{}}},$container;return specs&&_(specs).functions().forEach(function(method){componentApi[method]=function(){return specs[method].apply(componentApi,_slice.call(arguments))}}),eventifier(componentApi)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"component\"></div>"}),_slice=[].slice;return component}),define("util/regexEscape",[],function(){'use strict';return function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}),define("util/wrapLongWords",["util/regexEscape"],function(regexEscape){'use strict';function wrapLongWords(str,threshold){str=str.toString().replace(/([\w])</g,"$1 <");for(var chunkExp=new RegExp(".{1,"+threshold+"}","g"),longWords=str.match(new RegExp("[\\S]{"+threshold+",}","g"))||[],i=longWords.length,cut;i--;)cut=getCutTerm(longWords[i],chunkExp),str=str.replace(new RegExp(regexEscape(longWords[i]),"g"),cut);return str}regexEscape=regexEscape&&regexEscape.hasOwnProperty("default")?regexEscape["default"]:regexEscape;var getCutTerm=function(longWord,chunkExp){for(var cutTerms=longWord.match(chunkExp),i=cutTerms.length,oldFirst="",newFirst="",offenders=[".",":",";"];i--;)newFirst=cutTerms[i].charAt(0),-1<offenders.indexOf(newFirst)&&(cutTerms[i]=cutTerms[i].substr(1)),-1<offenders.indexOf(oldFirst)&&(cutTerms[i]+=oldFirst),oldFirst=newFirst;return cutTerms.join(" ")};return wrapLongWords}),define("util/encode",[],function(){'use strict';var _reQuot=/"/g,_reApos=/'/g,encodeHTML=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML};return{html:encodeHTML,attribute:function(html){return encodeHTML(html).replace(_reQuot,"&quot;").replace(_reApos,"&apos;")},encodeBase64:function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},decodeBase64:function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}),define("ui/feedback",["jquery","lodash","core/format","ui/component","util/wrapLongWords","util/encode","handlebars","i18n","lib/dompurify/purify"],function($$1,_,format,component,wrapLongWords,encode,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function tpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,format=format&&format.hasOwnProperty("default")?format["default"]:format,component=component&&component.hasOwnProperty("default")?component["default"]:component,wrapLongWords=wrapLongWords&&wrapLongWords.hasOwnProperty("default")?wrapLongWords["default"]:wrapLongWords,encode=encode&&encode.hasOwnProperty("default")?encode["default"]:encode,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"feedback feedback-",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" ",stack1=helpers["if"].call(depth0,depth0&&depth0.popup,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"popup"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n    <span class=\"icon-",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n    <div>\n        ",stack1=(helper=helpers.dompurify||depth0&&depth0.dompurify,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.msg,options):helperMissing.call(depth0,"dompurify",depth0&&depth0.msg,options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close message",options):helperMissing.call(depth0,"__","Close message",options)))+"\" class=\"icon-close\" data-close=\":parent .feedback\"></span>\n</div>\n",buffer}),currents=[],levels=["info","success","warning","danger","error"],defaultOptions={timeout:{info:2e3,success:2e3,warning:4e3,danger:4e3,error:8e3},wrapLongWordsAfter:40,encodeHtml:!0,popup:!0},feedbackFactory=function($container,config){var feedback;if($container&&$container.length||($container=$$1("#feedback-box")),!$container.length)throw new TypeError("The feedback needs to belong to an existing container");return feedback=component({message:function(level,msg,params,options){var displayedMessage=msg;return level&&_.contains(levels,level)||(level="info"),_.isPlainObject(params)&&(options=params,params=[]),this.config=_.defaults(options||{},this.config),this.config.level=level,this.config.encodeHtml&&(displayedMessage=encode.html(displayedMessage)),this.config.wrapLongWordsAfter&&(displayedMessage=wrapLongWords(displayedMessage,this.config.wrapLongWordsAfter)),_.isArray(params)&&params.length&&(displayedMessage=format.apply(format,[displayedMessage].concat(params))),this.config.msg=displayedMessage,this},info:function(msg,params,options){return this.message("info",msg,params,options).open()},success:function(msg,params,options){return this.message("success",msg,params,options).open()},warning:function(msg,params,options){return this.message("warning",msg,params,options).open()},danger:function(msg,params,options){return this.message("danger",msg,params,options).open()},error:function(msg,params,options){return this.message("error",msg,params,options).open()},open:function(){return _(currents).reject(this).invoke("close"),this.display()},close:function(){this.is("rendered")&&this.destroy()},display:function(){return this.is("rendered")?this.show():this.render($container),this}},defaultOptions),feedback.setTemplate(tpl).on("init",function(){this.config.id="feedback-"+(currents.length+1),currents.push(this),$container.trigger("create.feedback")}).on("render",function(){var self=this,$component=this.getElement(),$closer=$$1(".icon-close",$component),timeout=_.isPlainObject(this.config.timeout)?this.config.timeout[this.config.level]:this.config.timeout;$closer.off("click").on("click",function(e){e.preventDefault(),self.destroy()}),_.isNumber(timeout)&&0<timeout&&_.delay(function(){self.close()},timeout),$container.trigger("display.feedback")}).on("destroy",function(){$container.trigger("close.feedback"),_.remove(currents,this)}).init(config)};return feedbackFactory}),define("taoQtiItem/portableElementRegistry/factory/factory",["lodash","core/promise","core/eventifier"],function(_,Promise,eventifier){'use strict';var _requirejs=window.require,_defaultLoadingOptions={reload:!1},loadModuleConfig=function(manifest){return new Promise(function(resolve,reject){var requireConfigAliases={},reqConfigs=[],modules={},baseUrl;return manifest&&manifest.runtime?void(baseUrl=manifest.baseUrl,_.isArray(manifest.runtime.config)&&manifest.runtime.config.length&&_.forEach(manifest.runtime.config,function(pciConfig){_.isString(pciConfig)?reqConfigs.push("json!"+baseUrl+"/"+pciConfig):pciConfig.data?modules=_.defaults(modules,pciConfig.data.paths||{}):pciConfig.file&&reqConfigs.push("json!"+baseUrl+"/"+pciConfig.file)}),require(reqConfigs,function(){var runtimeModules={};requireConfigAliases[manifest.typeIdentifier]=baseUrl,"IMSPCI"===manifest.model&&(modules=_.reduce(arguments,function(acc,conf){return _.defaults(acc,conf.paths||{})},modules),_.forEach(manifest.runtime.modules||{},function(paths,id){paths&&(_.isString(paths)||_.isArray(paths)&&paths.length)&&(runtimeModules[id]=paths)}),modules=_.merge(modules,runtimeModules),_.forEach(modules,function(paths,id){paths=_.isArray(paths)?paths:[paths],requireConfigAliases[id]=_.map(paths,function(path){return baseUrl+"/"+path.replace(/\.js$/,"")})})),resolve(requireConfigAliases)},reject)):reject("invalid manifest")})},isPortableElementProvider=function(provider){return provider&&_.isFunction(provider.load)};return function(methods){var _loaded=!1,__providers={};return eventifier(_.defaults(methods||{},{_registry:{},get:function(typeIdentifier,version){if(this._registry[typeIdentifier])return version?_.find(this._registry[typeIdentifier],{version:version}):_.last(this._registry[typeIdentifier])},registerProvider:function(moduleName,provider){return __providers[moduleName]=isPortableElementProvider(provider)?provider:null,_loaded=!1,this},resetProviders:function(){return __providers={},_loaded=!1,this},loadProviders:function(options){var self=this,loadPromise;return loadPromise=_loaded&&!options.reload?Promise.resolve([]):new Promise(function(resolve,reject){var providerLoadingStack=[];_.forIn(__providers,function(provider,id){null===provider&&providerLoadingStack.push(id)}),_requirejs(providerLoadingStack,function(){_.each([].slice.call(arguments),function(provider){isPortableElementProvider(provider)&&(__providers[providerLoadingStack.shift()]=provider)}),resolve(__providers),_loaded=!0,self.trigger("providersloaded",__providers)},reject)}),loadPromise},getAllVersions:function(){var all={};return _.forIn(this._registry,function(versions,id){all[id]=_.map(versions,"version")}),all},getRuntime:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement?_.assign(portableElement.runtime,{id:portableElement.typeIdentifier,label:portableElement.label,baseUrl:portableElement.baseUrl,model:portableElement.model}):void this.trigger("error",{message:"no portable element runtime found",typeIdentifier:typeIdentifier,version:version})},getCreator:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&portableElement.creator?_.assign(portableElement.creator,{id:portableElement.typeIdentifier,label:portableElement.label,baseUrl:portableElement.baseUrl,response:portableElement.response,model:portableElement.model,xmlns:portableElement.xmlns}):void this.trigger("error",{message:"no portable element runtime found",typeIdentifier:typeIdentifier,version:version})},getLatestCreators:function(){var all={};return _.forIn(this._registry,function(versions,id){var lastVersion=_.last(versions);lastVersion.creator&&lastVersion.creator.hook&&lastVersion.enabled&&(all[id]=lastVersion)}),all},getBaseUrl:function(typeIdentifier,version){var runtime=this.get(typeIdentifier,version);return runtime?runtime.baseUrl:""},loadRuntimes:function(options){var self=this,loadPromise;return options=_.defaults(options||{},_defaultLoadingOptions),loadPromise=self.loadProviders(options).then(function(providers){var loadStack=[];return _.forEach(providers,function(provider){provider&&loadStack.push(provider.load())}),Promise.all(loadStack).then(function(results){var configLoadingStack=[];return self._registry=_.reduce(results,function(acc,_pcis){return _.merge(acc,_pcis)},self._registry||{}),_.forIn(self._registry,function(versions,typeIdentifier){return!!(_.isArray(options.include)&&0>_.indexOf(options.include,typeIdentifier))||void configLoadingStack.push(loadModuleConfig(self.get(typeIdentifier)))}),Promise.all(configLoadingStack).then(function(moduleConfigs){var requireConfigAliases=_.reduce(moduleConfigs,function(acc,paths){return _.merge(acc,paths)},{});_requirejs.config({paths:requireConfigAliases})})})}),loadPromise.then(function(){self.trigger("runtimesloaded")}).catch(function(err){self.trigger("error",err)}),loadPromise},loadCreators:function(options){var self=this,loadPromise;return options=_.defaults(options||{},_defaultLoadingOptions),loadPromise=self.loadRuntimes(options).then(function(){var requiredCreatorHooks=[];return _.forIn(self._registry,function(versions,typeIdentifier){var portableElementModel=self.get(typeIdentifier);if(portableElementModel.creator&&portableElementModel.creator.hook){if(portableElementModel.enabled){if(_.isArray(options.include)&&0>_.indexOf(options.include,typeIdentifier))return!0;}else if(!_.isArray(options.include)||0>_.indexOf(options.include,typeIdentifier))return!0;requiredCreatorHooks.push(portableElementModel.creator.hook.replace(/\.js$/,""))}}),requiredCreatorHooks.length?new Promise(function(resolve,reject){_requirejs(requiredCreatorHooks,function(){var creators={};_.each(arguments,function(creatorHook){var id=creatorHook.getTypeIdentifier(),portableElementModel=self.get(id),i=_.findIndex(self._registry[id],{version:portableElementModel.version});0>i?self.trigger("error","no creator found for id/version "+id+"/"+portableElementModel.version):(self._registry[id][i].creator.module=creatorHook,creators[id]=creatorHook)}),resolve(creators)},reject)}):Promise.resolve({})}),loadPromise.then(function(creators){return self.trigger("creatorsloaded",creators),creators}).catch(function(err){self.trigger("error",err)}),loadPromise},enable:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&(portableElement.enabled=!0),this},disable:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&(portableElement.enabled=!1),this},isEnabled:function(typeIdentifier,version){var portableElement=this.get(typeIdentifier,version);return portableElement&&!0===portableElement.enabled}}))}}),define("taoQtiItem/qtiCreator/helper/qtiElements",["jquery","lodash","i18n"],function($,_,__){"use strict";var QtiElements={};return QtiElements.classes={itemBody:{parents:["bodyElement"],contains:["block"],abstract:!0},atomicBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["inline"],abstract:!0},atomicInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],abstract:!0},simpleBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["block"],abstract:!0},simpleInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],abstract:!0},flowStatic:{parents:["flow"],abstract:!0},blockStatic:{parents:["block"],abstract:!0},inlineStatic:{parents:["inline"],abstract:!0},flow:{parents:["objectFlow"],abstract:!0},tableCell:{parents:["bodyElement"],contains:["flow"],abstract:!0},caption:{parents:["bodyElement"],contains:["inline"],xhtml:!0},col:{parents:["bodyElement"],xhtml:!0},colgroup:{parents:["bodyElement"],contains:["col"],xhtml:!0},div:{parents:["blockStatic","bodyElement","flowStatic"],contains:["flow"],xhtml:!0},dl:{parents:["blockStatic","bodyElement","flowStatic"],contains:["dlElement"],xhtml:!0},dt:{parents:["dlElement"],contains:["inline"],xhtml:!0},dd:{parents:["dlElement"],contains:["flow"],xhtml:!0},hr:{parents:["blockStatic","bodyElement","flowStatic"],xhtml:!0},math:{parents:["blockStatic","flowStatic","inlineStatic"],xhtml:!0},li:{parents:["bodyElement"],contains:["flow"],xhtml:!0},ol:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},ul:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},object:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["objectFlow"],xhtml:!0},param:{parents:["objectFlow"],xhtml:!0},table:{parents:["blockStatic","bodyElement","flowStatic"],contains:["caption","col","colgroup","thead","tfoot","tbody"],xhtml:!0},tbody:{parents:["bodyElement"],contains:["tr"],xhtml:!0},tfoot:{parents:["bodyElement"],contains:["tr"],xhtml:!0},thead:{parents:["bodyElement"],contains:["tr"],xhtml:!0},td:{parents:["tableCell"],xhtml:!0},th:{parents:["tableCell"],xhtml:!0},tr:{parents:["bodyElement"],contains:["tableCell"],xhtml:!0},a:{parents:["simpleInline"],xhtml:!0},abbr:{parents:["simpleInline"],xhtml:!0},acronym:{parents:["simpleInline"],xhtml:!0},b:{parents:["simpleInline"],xhtml:!0},big:{parents:["simpleInline"],xhtml:!0},cite:{parents:["simpleInline"],xhtml:!0},code:{parents:["simpleInline"],xhtml:!0},dfn:{parents:["simpleInline"],xhtml:!0},em:{parents:["simpleInline"],xhtml:!0},i:{parents:["simpleInline"],xhtml:!0},kbd:{parents:["simpleInline"],xhtml:!0},q:{parents:["simpleInline"],xhtml:!0},samp:{parents:["simpleInline"],xhtml:!0},small:{parents:["simpleInline"],xhtml:!0},span:{parents:["simpleInline"],xhtml:!0},strong:{parents:["simpleInline"],xhtml:!0},sub:{parents:["simpleInline"],xhtml:!0},sup:{parents:["simpleInline"],xhtml:!0},tt:{parents:["simpleInline"],xhtml:!0},var:{parents:["simpleInline"],xhtml:!0},blockquote:{parents:["simpleBlock"],xhtml:!0},address:{parents:["atomicBlock"],xhtml:!0},h1:{parents:["atomicBlock"],xhtml:!0},h2:{parents:["atomicBlock"],xhtml:!0},h3:{parents:["atomicBlock"],xhtml:!0},h4:{parents:["atomicBlock"],xhtml:!0},h5:{parents:["atomicBlock"],xhtml:!0},h6:{parents:["atomicBlock"],xhtml:!0},p:{parents:["atomicBlock"],xhtml:!0},pre:{parents:["atomicBlock"],xhtml:!0},img:{parents:["atomicInline"],xhtml:!0,attributes:["src","alt","longdesc","height","width"]},br:{parents:["atomicInline"],xhtml:!0},infoControl:{parents:["blockStatic","bodyElement","flowStatic"],qti:!0},textRun:{parents:["inlineStatic","flowstatic"],qti:!0},feedbackInline:{parents:["simpleInline","feedbackElement"],qti:!0},feedbackBlock:{parents:["simpleBlock"],qti:!0},rubricBlock:{parents:["simpleBlock"],qti:!0},blockInteraction:{parents:["block","flow","interaction"],qti:!0},inlineInteraction:{parents:["inline","flow","interaction"],qti:!0},gap:{parents:["inlineStatic"],qti:!0},hottext:{parents:["flowstatic","inlineStatic"],contains:["inlineStatic"],qti:!0},printedVariable:{parents:["bodyElement","flowStatic","inlineStatic","textOrVariable"],qti:!0},prompt:{parents:["bodyElement"],contains:["inlineStatic"],qti:!0},templateElement:{parents:["bodyElement"],qti:!0},templateBlock:{parents:["blockStatic","flowStatic","templateElement"],contains:["blockStatic"],qti:!0},templateInline:{parents:["inlineStatic","flowStatic","templateElement"],contains:["inlineStatic"],qti:!0},choiceInteraction:{parents:["blockInteraction"],qti:!0},associateInteraction:{parents:["blockInteraction"],qti:!0},orderInteraction:{parents:["blockInteraction"],qti:!0},matchInteraction:{parents:["blockInteraction"],qti:!0},hottextInteraction:{parents:["blockInteraction"],qti:!0},gapMatchInteraction:{parents:["blockInteraction"],qti:!0},mediaInteraction:{parents:["blockInteraction"],qti:!0},sliderInteraction:{parents:["blockInteraction"],qti:!0},uploadInteraction:{parents:["blockInteraction"],qti:!0},drawingInteraction:{parents:["blockInteraction"],qti:!0},graphicInteraction:{parents:["blockInteraction"],qti:!0},hotspotInteraction:{parents:["graphicInteraction"],qti:!0},graphicAssociateInteraction:{parents:["graphicInteraction"],qti:!0},graphicOrderInteraction:{parents:["graphicInteraction"],qti:!0},graphicGapMatchInteraction:{parents:["graphicInteraction"],qti:!0},selectPointInteraction:{parents:["graphicInteraction"],qti:!0},textEntryInteraction:{parents:["stringInteraction","inlineInteraction"],qti:!0},extendedTextInteraction:{parents:["stringInteraction","blockInteraction"],qti:!0},inlineChoiceInteraction:{parents:["inlineInteraction"],qti:!0},endAttemptInteraction:{parents:["inlineInteraction"],qti:!0},customInteraction:{parents:["block","flow","interaction"],qti:!0},_container:{parents:["block"],qti:!0}},QtiElements.cache={containable:{},children:{},parents:{}},QtiElements.getAllowedContainersElements=function(qtiClass,$container){var classes=QtiElements.getAllowedContainers(qtiClass),jqSelector="";for(var i in classes)classes[i].qti||(jqSelector+=classes[i]+", ");return jqSelector&&(jqSelector=jqSelector.substring(0,jqSelector.length-2)),$(jqSelector,$container?$container:$(document)).filter(":not([data-qti-type])")},QtiElements.getAllowedContainers=function(qtiClass){var ret;if(QtiElements.cache.containable[qtiClass])ret=QtiElements.cache.containable[qtiClass];else{ret=[];var parents=QtiElements.getParentClasses(qtiClass,!0);for(var aClass in QtiElements.classes){var model=QtiElements.classes[aClass];if(model.contains){var intersect=_.intersection(model.contains,parents);intersect.length&&(!model.abstract&&ret.push(aClass),ret=_.union(ret,QtiElements.getChildClasses(aClass,!0)))}}QtiElements.cache.containable[qtiClass]=ret}return ret},QtiElements.getAllowedContents=function(qtiClass,recursive,checked){var ret=[];checked=checked||{};var model=QtiElements.classes[qtiClass];if(model&&model.contains)for(var i in model.contains){var contain=model.contains[i];if(!checked[contain]){checked[contain]=!0,ret.push(contain);var children=QtiElements.getChildClasses(contain,!0);for(var i in children){var child=children[i];checked[child]||(checked[child]=!0,ret.push(child),recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(child,!0,checked))))}recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(contain,!0,checked)))}}var parents=QtiElements.getParentClasses(qtiClass,!0);for(var i in parents)ret=_.union(ret,QtiElements.getAllowedContents(parents[i],recursive,checked));return _.uniq(ret,!1)},QtiElements.isAllowedClass=function(qtiContainerClass,qtiContentClass){var allowedClasses=QtiElements.getAllowedContents(qtiContainerClass);return 0<=_.indexOf(allowedClasses,qtiContentClass)},QtiElements.getParentClasses=function(qtiClass,recursive){var ret;if(recursive&&QtiElements.cache.parents[qtiClass])ret=QtiElements.cache.parents[qtiClass];else{if(ret=[],QtiElements.classes[qtiClass]&&(ret=QtiElements.classes[qtiClass].parents,recursive)){for(var i in ret)ret=_.union(ret,QtiElements.getParentClasses(ret[i],recursive));ret=_.uniq(ret,!1)}QtiElements.cache.parents[qtiClass]=ret}return ret},QtiElements.getChildClasses=function(qtiClass,recursive,type){var cacheType=type?type:"all",ret;if(recursive&&QtiElements.cache.children[qtiClass]&&QtiElements.cache.children[qtiClass][cacheType])ret=QtiElements.cache.children[qtiClass][cacheType];else{for(var aClass in ret=[],QtiElements.classes){var model=QtiElements.classes[aClass];0<=_.indexOf(model.parents,qtiClass)&&(type?model[type]&&ret.push(aClass):ret.push(aClass),recursive&&(ret=_.union(ret,QtiElements.getChildClasses(aClass,recursive,type))))}QtiElements.cache.children[qtiClass]||(QtiElements.cache.children[qtiClass]={}),QtiElements.cache.children[qtiClass][cacheType]=ret}return ret},QtiElements.isBlock=function(qtiClass){return QtiElements.is(qtiClass,"block")},QtiElements.isInline=function(qtiClass){return QtiElements.is(qtiClass,"inline")},QtiElements.is=function(qtiClass,topClass){if(qtiClass===topClass)return!0;var parents=QtiElements.getParentClasses(qtiClass,!0);return 0<=_.indexOf(parents,topClass)},QtiElements.getAvailableAuthoringElements=function(){return{choiceInteraction:{label:__("Choice Interaction"),description:__("Select a single (radio buttons) or multiple (check boxes) responses among a set of choices."),icon:"icon-choice",short:__("Choice"),qtiClass:"choiceInteraction",tags:["Common Interactions","mcq"]},orderInteraction:{label:__("Order Interaction"),icon:"icon-order",description:__("Arrange a list of choices in the correct order."),short:__("Order"),qtiClass:"orderInteraction",tags:["Common Interactions","ordering"]},associateInteraction:{label:__("Associate Interaction"),icon:"icon-associate",description:__("Create pair(s) from a series of choices."),short:__("Associate"),qtiClass:"associateInteraction",tags:["Common Interactions","association"]},matchInteraction:{label:__("Match Interaction"),icon:"icon-match",description:__("Create association(s) between two sets of choices displayed in a table (row and column)."),short:__("Match"),qtiClass:"matchInteraction",tags:["Common Interactions","association"]},hottextInteraction:{label:__("Hottext Interaction"),icon:"icon-hottext",description:__("Select one or more text parts (hottext) within a text."),short:__("Hottext"),qtiClass:"hottextInteraction",tags:["Common Interactions","text"]},gapMatchInteraction:{label:__("Gap Match Interaction"),icon:"icon-gap-match",description:__(" Fill in the gaps in a text from a set of choices."),short:__("Gap Match"),qtiClass:"gapMatchInteraction",tags:["Common Interactions","text","association"]},sliderInteraction:{label:__("Slider Interaction"),icon:"icon-slider",description:__("Select a value within a numerical range."),short:__("Slider"),qtiClass:"sliderInteraction",tags:["Common Interactions","special"]},extendedTextInteraction:{label:__("Extended Text Interaction"),icon:"icon-extended-text",description:__("Collect open-ended information in one or more text area(s) (strings or numeric values)."),short:__("Extended Text"),qtiClass:"extendedTextInteraction",tags:["Common Interactions","text"]},uploadInteraction:{label:__("File Upload Interaction"),icon:"icon-upload",description:__("Upload a file (e.g. document, picture...) as a response."),short:__("File Upload"),qtiClass:"uploadInteraction",tags:["Common Interactions","special"]},mediaInteraction:{label:__("Media Interaction"),icon:"icon-media",description:__("Control the playing parameters (auto-start, loop) of a video or audio file and report the number of time it has been played."),short:__("Media"),qtiClass:"mediaInteraction",tags:["Common Interactions","media"]},_container:{label:__("Text Block"),icon:"icon-font",description:__("Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions."),short:__("Block"),qtiClass:"_container",tags:["Inline Interactions","text"]},inlineChoiceInteraction:{label:__("Inline Choice Interaction"),icon:"icon-inline-choice",description:__("Select a choice from a drop-down list."),short:__("Inline Choice"),qtiClass:"inlineChoiceInteraction",tags:["Inline Interactions","inline-interactions","mcq"]},textEntryInteraction:{label:__("Text Entry Interaction"),icon:"icon-text-entry",description:__("Collect open-ended information in a short text input (strings or numeric values)."),short:__("Text Entry"),qtiClass:"textEntryInteraction",tags:["Inline Interactions","inline-interactions","text"]},endAttemptInteraction:{label:__("End Attempt Interaction"),icon:"icon-end-attempt",description:__("Trigger the end of the item attempt."),short:__("End Attempt"),qtiClass:"endAttemptInteraction",tags:["Inline Interactions","inline-interactions","button","submit"]},hotspotInteraction:{label:__("Hotspot Interaction"),icon:"icon-hotspot",description:__("Select one or more areas (hotspots) displayed on an picture."),short:__("Hotspot"),qtiClass:"hotspotInteraction",tags:["Graphic Interactions","mcq"]},graphicOrderInteraction:{label:__("Graphic Order Interaction"),icon:"icon-graphic-order",description:__("Order the areas (hotspots) displayed on a picture."),short:__("Order"),qtiClass:"graphicOrderInteraction",tags:["Graphic Interactions","ordering"]},graphicAssociateInteraction:{label:__("Graphic Associate Interaction"),icon:"icon-graphic-associate",description:__("Create association(s) between areas (hotspots) displayed on a picture."),short:__("Associate"),qtiClass:"graphicAssociateInteraction",tags:["Graphic Interactions","association"]},graphicGapMatchInteraction:{label:__("Graphic Gap Match Interaction"),icon:"icon-graphic-gap",description:__("Fill in the gaps on a picture with a set of image choices."),short:__("Gap Match"),qtiClass:"graphicGapMatchInteraction",tags:["Graphic Interactions","association"]},selectPointInteraction:{label:__("Select Point Interaction"),icon:"icon-select-point",description:__("Position one or more points on a picture (response areas are not displayed)."),short:__("Select Point"),qtiClass:"selectPointInteraction",tags:["Graphic Interactions"]}}},QtiElements}),define("taoQtiItem/portableElementRegistry/factory/ciRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/factory","taoQtiItem/qtiCreator/helper/qtiElements"],function(_,portableElementRegistry,qtiElements){'use strict';return function(){return portableElementRegistry({getAuthoringData:function(typeIdentifier,options){var pciModel;if(options=_.defaults(options||{},{version:0,enabledOnly:!1}),pciModel=this.get(typeIdentifier,options.version),pciModel&&pciModel.creator&&pciModel.creator.hook&&pciModel.creator.icon&&(pciModel.enabled||!options.enabledOnly))return{label:pciModel.label,icon:pciModel.creator.icon.replace(new RegExp("^"+typeIdentifier+"/"),pciModel.baseUrl),short:pciModel.short,description:pciModel.description,qtiClass:"customInteraction."+pciModel.typeIdentifier,tags:_.union(["Custom Interactions"],pciModel.tags)}}}).on("creatorsloaded",function(){var creators=this.getLatestCreators();_.forEach(creators,function(creator,typeIdentifier){qtiElements.classes["customInteraction."+typeIdentifier]={parents:["customInteraction"],qti:!0}})})}}),define("taoQtiItem/portableElementRegistry/ciRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/ciRegistry","module"],function(_,ciRegistry,module){'use strict';var registry=ciRegistry(),providers=[],config=module.config();return config&&config.providers&&(providers=config.providers),_.each(providers,function(provider){provider.name&&provider.module&&registry.registerProvider(provider.module)}),registry}),define("taoQtiItem/portableElementRegistry/factory/icRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/factory"],function(_,portableElementRegistry){'use strict';return function(){return portableElementRegistry()}}),define("taoQtiItem/portableElementRegistry/icRegistry",["lodash","taoQtiItem/portableElementRegistry/factory/icRegistry","module"],function(_,icRegistry,module){'use strict';var registry=icRegistry(),providers=[],config=module.config();return config&&config.providers&&(providers=config.providers),_.each(providers,function(provider){provider.name&&provider.module&&registry.registerProvider(provider.module)}),registry}),define("core/moduleLoader",["lodash","core/promise"],function(_,Promise){'use strict';function moduleLoaderFactory(requiredModules,validate,specs){var loaded={},modules={},excludes=[],bundles=[],loader={addList:function(moduleList){return _.forEach(moduleList,this.add,this),this},add:function(def){if(_.isEmpty(def.module)||!_.isString(def.module))throw new TypeError("An AMD module must be defined");if(_.isEmpty(def.category)||!_.isString(def.category))throw new TypeError("Providers must belong to a category");return modules[def.category]=modules[def.category]||[],_.isNumber(def.position)?modules[def.category][def.position]=def.module:"prepend"===def.position||"before"===def.position?modules[def.category].unshift(def.module):modules[def.category].push(def.module),def.bundle&&!_.contains(bundles,def.bundle)&&bundles.push(def.bundle),this},append:function(def){return this.add(_.merge({position:"append"},def))},prepend:function(def){return this.add(_.merge({position:"prepend"},def))},remove:function(module){return excludes.push(module),this},load:function(loadBundles){var self=this,dependencies=_(modules).values().flatten().uniq().difference(excludes).value(),loadModules=function(amdModules){return _.isArray(amdModules)&&amdModules.length?new Promise(function(resolve,reject){require(amdModules,function(){resolve([].slice.call(arguments))},reject)}):Promise.resolve()};return loadModules(loadBundles?bundles:[]).then(function(){return loadModules(dependencies)}).then(function(loadedModules){return _.forEach(dependencies,function(dependency,index){var module=loadedModules[index],category=_.findKey(modules,function(val){return _.contains(val,dependency)});if(!validate(module))throw new TypeError("Invalid module");_.isString(category)&&(loaded[category]=loaded[category]||[],loaded[category].push(module))}),self.getModules()})},getModules:function(category){return _.isString(category)?loaded[category]||[]:_(loaded).values().flatten().uniq().value()},getCategories:function(){return _.keys(loaded)}};return validate=_.isFunction(validate)?validate:_.isPlainObject,_.forEach(requiredModules,function(moduleList,category){if(_.isEmpty(category)||!_.isString(category))throw new TypeError("Modules must belong to a category");if(!_.isArray(moduleList))throw new TypeError("A list of modules must be an array");if(!_.all(moduleList,validate))throw new TypeError("The list does not contain valid modules");loaded[category]=loaded[category]?loaded[category].concat(moduleList):moduleList}),specs&&_(specs).functions().forEach(function(method){loader[method]=function(){return specs[method].apply(loader,[].slice.call(arguments))}}),loader}return _=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,moduleLoaderFactory}),define("core/pluginLoader",["lodash","core/moduleLoader"],function(_,moduleLoaderFactory){'use strict';function pluginLoaderFactory(requiredPlugins){return moduleLoaderFactory(requiredPlugins,_.isFunction,{getPlugins:function(category){return this.getModules(category)}})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,moduleLoaderFactory=moduleLoaderFactory&&moduleLoaderFactory.hasOwnProperty("default")?moduleLoaderFactory["default"]:moduleLoaderFactory,pluginLoaderFactory}),define("core/delegator",["lodash"],function(_){'use strict';function delegator(api,provider,config){function delegate(fnName){var response,args;if(!provider)throw new Error("There is no "+name+" provider!");else if(_.isFunction(provider[fnName])||defaultProvider)args=_slice.call(arguments,1),response=(provider[fnName]||defaultProvider).apply(context,args),wrapper&&(response=wrapper(response)),eventifier&&api.trigger.apply(api,[fnName,response].concat(args));else throw new Error("There is no method called "+fnName+" in the "+name+" provider!");return response}var extendedConfig=_.defaults(config||{},defaults),eventifier=!!(extendedConfig.eventifier&&api&&api.trigger),context=extendedConfig.forward?provider:api,defaultProvider=_.isFunction(extendedConfig.defaultProvider)?extendedConfig.defaultProvider:_.noop,wrapper=_.isFunction(extendedConfig.wrapper)?extendedConfig.wrapper:null,name=extendedConfig.name;return extendedConfig.required&&(defaultProvider=null),delegate}_=_&&_.hasOwnProperty("default")?_["default"]:_;var defaults={name:"provided",eventifier:!0},_slice=[].slice;return delegator}),define("core/plugin",["lodash","core/delegator","core/promise"],function(_,delegator,Promise){'use strict';function pluginFactory(provider,defaults){var pluginName;if(!_.isPlainObject(provider)||!_.isString(provider.name)||_.isEmpty(provider.name)||!_.isFunction(provider.init))throw new TypeError("A plugin should be defined at least by a name property and an init method");return pluginName=provider.name,defaults=defaults||{},function(host,areaBroker,config){var states={},pluginContent={},plugin,delegate;if(!_.isObject(host)||!_.isFunction(host.on)||!_.isFunction(host.trigger))throw new TypeError("A plugin host should be a valid eventified object");return config=_.defaults(config||{},defaults),plugin={install:function(){var self=this;return delegate("install").then(function(){self.trigger("install")})},init:function(content){var self=this;return states={},content&&(pluginContent=content),delegate("init",content).then(function(){self.setState("init",!0).trigger("init")})},render:function(){var self=this;return delegate("render").then(function(){self.setState("ready",!0).trigger("render").trigger("ready")})},finish:function(){var self=this;return delegate("finish").then(function(){self.setState("finish",!0).trigger("finish")})},destroy:function(){var self=this;return delegate("destroy").then(function(){config={},states={},self.setState("init",!1),self.trigger("destroy")})},trigger:function(name){var args=[].slice.call(arguments,1);return host.trigger.apply(host,["plugin-"+name+"."+pluginName,plugin].concat(args)),this},getHost:function(){return host},getAreaBroker:function(){return areaBroker},getConfig:function(){return config},setConfig:function(name,value){return _.isPlainObject(name)?config=_.defaults(name,config):config[name]=value,this},getState:function(name){return!!states[name]},setState:function(name,active){if(!_.isString(name)||_.isEmpty(name))throw new TypeError("The state must have a name");return states[name]=!!active,this},getContent:function(){return pluginContent},setContent:function(content){return pluginContent=content,this},getName:function(){return pluginName},show:function(){var self=this;return delegate("show").then(function(){self.setState("visible",!0).trigger("show")})},hide:function(){var self=this;return delegate("hide").then(function(){self.setState("visible",!1).trigger("hide")})},enable:function(){var self=this;return delegate("enable").then(function(){self.setState("enabled",!0).trigger("enable")})},disable:function(){var self=this;return delegate("disable").then(function(){self.setState("enabled",!1).trigger("disable")})}},delegate=delegator(plugin,provider,{eventifier:!1,wrapper:function(response){return Promise.resolve(response)}}),_.isString(defaults.hostName)&&!_.isEmpty(defaults.hostName)&&(plugin["get"+defaults.hostName.charAt(0).toUpperCase()+defaults.hostName.slice(1)]=plugin.getHost),plugin}}return _=_&&_.hasOwnProperty("default")?_["default"]:_,delegator=delegator&&delegator.hasOwnProperty("default")?delegator["default"]:delegator,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,pluginFactory}),define("taoQtiItem/qtiCreator/context/plugins/content/windowResizer",["jquery","lodash","core/plugin"],function($,_,pluginFactory){'use strict';var $window=$(window);return pluginFactory({name:"windowResizer",init:function(){var qtiCreatorContext=this.getHost();$window.on("resize.itemcreatorwindowresizer",_.throttle(function(){qtiCreatorContext.trigger("resize")},200))},destroy:function(){$window.off("resize.itemcreatorwindowresizer")}})}),define("taoQtiItem/qtiCreator/context/loader",["core/pluginLoader","taoQtiItem/qtiCreator/context/plugins/content/windowResizer"],function(pluginLoader,windowResizer){'use strict';return pluginLoader({content:[windowResizer]})}),define("taoQtiItem/qtiCreator/context/qtiCreatorContext",["lodash","core/eventifier","core/promise","taoQtiItem/qtiCreator/context/loader"],function(_,eventifier,Promise,pluginLoader){'use strict';return function(){var plugins={},pluginRun=function(method){var execStack=[];return _.forEach(plugins,function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)},qtiCreatorContext;return qtiCreatorContext={init:function(){var self=this;return pluginLoader.load().then(function(){var pluginFactories=pluginLoader.getPlugins();return _.forEach(pluginFactories,function(pluginFactory){var plugin=pluginFactory(self);plugins[plugin.getName()]=plugin}),pluginRun("init").then(function(){self.trigger("init")})}).catch(function(err){self.trigger("error",err)})},destroy:function(){return pluginRun("destroy").then(function(){self.trigger("destroy")}).catch(function(err){self.trigger("error",err)})}},eventifier(qtiCreatorContext)}}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",assessmentItem:"taoQtiItem/qtiItem/core/Item",responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",gapText:"taoQtiItem/qtiItem/core/choices/GapText",hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",customInteraction:"taoQtiItem/qtiItem/core/interactions/CustomInteraction",infoControl:"taoQtiItem/qtiItem/core/PortableInfoControl",include:"taoQtiItem/qtiItem/core/Include",table:"taoQtiItem/qtiItem/core/Table",printedVariable:"taoQtiItem/qtiItem/core/PrintedVariable",_tooltip:"taoQtiItem/qtiItem/core/Tooltip"}}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(_){'use strict';return{buildSerial:function(prefix){for(var id=prefix||"",chars="abcdefghijklmnopqrstuvwxyz0123456789",i=0;22>i;i++)id+=chars.charAt(Math.floor(Math.random()*chars.length));return id},buildId:function(item,prefix){var i=1,suffix="",exists=!1,id,usedIds;if(!item)throw new TypeError("A item is required to generate a unique identifier");usedIds=item.getUsedIds();do exists=!1,id=prefix+suffix,_.contains(usedIds,id)&&(exists=!0,suffix="_"+i,i++);while(exists);return id},buildIdentifier:function(item,prefix,useSuffix){var suffix="",i=1,exists=!1,id,usedIds;if(!item)throw new TypeError("A item is required to generate a unique identifier");if(!prefix)throw new TypeError("Prefix is required to build an identifier");usedIds=item.getUsedIdentifiers(),useSuffix=!!_.isUndefined(useSuffix)||useSuffix,prefix&&(prefix=prefix.replace(/_[0-9]+$/ig,"_").replace(/[^a-zA-Z0-9_]/ig,"_").replace(/(_)+/ig,"_"),useSuffix&&(suffix="_"+i));do exists=!1,id=prefix+suffix,usedIds[id]&&(exists=!0,suffix="_"+i,i++);while(exists);return id},findInCollection:function(element,collectionNames,searchedSerial){var found=null;if(_.isString(collectionNames)&&(collectionNames=[collectionNames]),_.isArray(collectionNames))_.each(collectionNames,function(collectionName){var collection=element;_.each(collectionName.split("."),function(nameToken){collection=collection[nameToken]});var elt=collection[searchedSerial];return elt?(found={parent:element,element:elt},!1):(_.each(collection,function(elt){if(_.isFunction(elt.find)&&(found=elt.find(searchedSerial),found))return!1}),!found)&&void 0});else throw new Error("invalid argument : collectionNames must be an array or a string");return found},addMarkupNamespace:function(markup,ns){return ns?(markup=markup.replace(/<(\/)?([a-z:]+)(\s?)([^><]*)>/g,function($0,$1,$2,$3,$4){return 0<$2.indexOf(":")?$0:($1=$1||"",$3=$3||"","<"+$1+ns+":"+$2+$3+$4+">")}),markup):markup},removeMarkupNamespaces:function(markup){return markup.replace(/<(\/)?(\w*):([^>]*)>/g,"<$1$3>")},getMarkupUsedNamespaces:function(markup){var namespaces=[];return markup.replace(/<(\/)?(\w*):([^>]*)>/g,function(original,slash,ns,node){return namespaces.push(ns),"<"+slash+node+">"}),_.uniq(namespaces)}}}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(_,$){return{getOptionsFromArguments:function(args){var options={data:{},placeholder:null,subclass:"",renderer:null};return _.each(args,function(arg){arg&&(arg.isRenderer?options.renderer=arg:arg instanceof $&&arg.length?options.placeholder=arg:_.isString(arg)?options.subclass=arg:_.isPlainObject(arg)?options.data=arg:console.log("invalid arg",arg,args))}),options}}}),define("taoQtiItem/qtiItem/core/Element",["jquery","lodash","class","core/logger","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Class,loggerFactory,util,rendererConfig){'use strict';var _instances={},logger=loggerFactory("taoQtiItem/qtiItem/core/Element"),Element=Class.extend({qtiClass:"",serial:"",rootElement:null,init:function init(serial,attributes){if(this.attributes={},this.metaData={},"object"===_typeof2(serial)&&(attributes=serial,serial=""),serial||(serial=util.buildSerial(this.qtiClass+"_")),serial&&("string"!=typeof serial||!serial.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+_typeof2(serial)+") "+serial;if(!_instances[serial])_instances[serial]=this,this.serial=serial,this.setAttributes(attributes||{});else throw"a QTI Element with the same serial already exists "+serial;"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),"function"==typeof this.initObject&&this.initObject()},is:function is(qtiClass){return qtiClass===this.qtiClass},placeholder:function placeholder(){return"{{"+this.serial+"}}"},getSerial:function getSerial(){return this.serial},getUsedIdentifiers:function getUsedIdentifiers(){var usedIds={},elts=this.getComposingElements();for(var i in elts){var elt=elts[i],id=elt.attr("identifier");id&&(usedIds[id]=elt)}return usedIds},getUsedIds:function(){var usedIds=[];return _.forEach(this.getComposingElements(),function(elt){var id=elt.attr("id");id&&!_.contains(usedIds,id)&&usedIds.push(id)}),usedIds},attr:function attr(name,value){if(name)if(void 0!==value)this.attributes[name]=value;else if("object"===_typeof2(name))for(var prop in name)this.attr(prop,name[prop]);else if("string"==typeof name)return void 0===this.attributes[name]?void 0:this.attributes[name];return this},data:function data(name,value){if(name)if(void 0!==value)this.metaData[name]=value,$(document).trigger("metaChange.qti-widget",{element:this,key:name,value:value});else if("object"===_typeof2(name))for(var prop in name)this.data(prop,name[prop]);else if("string"==typeof name)return void 0===this.metaData[name]?void 0:this.metaData[name];return this},removeData:function removeData(name){return delete this.metaData[name],this},removeAttr:function removeAttr(name){return this.removeAttributes(name)},setAttributes:function setAttributes(attributes){return _.isPlainObject(attributes)||logger.warn("attributes should be a plain object"),this.attributes=attributes,this},getAttributes:function getAttributes(){return _.clone(this.attributes)},removeAttributes:function removeAttributes(attrNames){for(var i in"string"==typeof attrNames&&(attrNames=[attrNames]),attrNames)delete this.attributes[attrNames[i]];return this},getComposingElements:function getComposingElements(){function append(element){elts[element.getSerial()]=element,elts=_.extend(elts,element.getComposingElements())}var elts={};return"function"==typeof this.initContainer&&append(this.getBody()),"function"==typeof this.initObject&&append(this.getObject()),_.each(this.metaData,function(v){Element.isA(v,"_container")?append(v):_.isArray(v)&&_.each(v,function(v){Element.isA(v,"_container")&&append(v)})}),elts},getUsedClasses:function getUsedClasses(){var ret=[this.qtiClass],composingElts=this.getComposingElements();return _.each(composingElts,function(elt){ret.push(elt.qtiClass)}),_.uniq(ret)},find:function find(serial){var found=null,object,body;return"function"==typeof this.initObject&&(object=this.getObject(),object.serial===serial&&(found={parent:this,element:object,location:"object"})),found||"function"!=typeof this.initContainer||(body=this.getBody(),found=body.serial===serial?{parent:this,element:body,location:"body"}:this.getBody().find(serial,this)),found},parent:function parent(){var item=this.getRootElement();if(item){var found=item.find(this.getSerial());if(found)return found.parent}return null},setRelatedItem:function setRelatedItem(item){logger.warn("Deprecated use of setRelatedItem()"),this.setRootElement(item)},setRootElement:function setRootElement(item){var composingElts,i;if(Element.isA(item,"assessmentItem"))for(i in this.rootElement=item,composingElts=this.getComposingElements(),composingElts)composingElts[i].setRootElement(item)},getRelatedItem:function getRelatedItem(){return logger.warn("Deprecated use of getRelatedItem()"),this.getRootElement()},getRootElement:function getRootElement(){var ret=null;return Element.isA(this.rootElement,"assessmentItem")&&(ret=this.rootElement),ret},setRenderer:function setRenderer(renderer){if(renderer&&renderer.isRenderer){this.renderer=renderer;var elts=this.getComposingElements();for(var serial in elts)elts[serial].setRenderer(renderer)}else throw"invalid qti rendering engine"},getRenderer:function getRenderer(){return this.renderer},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),_renderer=args.renderer||this.getRenderer(),tplData={},defaultData={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()},rendering;if(!_renderer)throw new Error("render: no renderer found for the element "+this.qtiClass+":"+this.serial);return"function"==typeof this.initContainer&&(defaultData.body=this.getBody().render(args.renderer)),"function"==typeof this.initObject&&(defaultData.object={attributes:this.object.getAttributes()},defaultData.object.attributes.data=_renderer.resolveUrl(this.object.attr("data"))),tplData=_.merge(defaultData,args.data||{}),tplData=_renderer.getData(this,tplData,args.subclass),rendering=_renderer.renderTpl(this,tplData,args.subclass),args.placeholder&&args.placeholder.replaceWith(rendering),rendering},postRender:function postRender(data,altClassName,renderer){var postRenderers=[],_renderer=renderer||this.getRenderer();if("function"==typeof this.initContainer&&(postRenderers=this.getBody().postRender(data,"",renderer)),_renderer)postRenderers.push(_renderer.postRender(this,data,altClassName));else throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial;return _.compact(postRenderers)},getContainer:function getContainer($scope,subclass){var renderer=this.getRenderer();if(renderer)return renderer.getContainer(this,$scope,subclass);throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function toArray(){var arr={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(arr.body=this.getBody().toArray()),"function"==typeof this.initObject&&(arr.object=this.object.toArray()),arr},isEmpty:function isEmpty(){return!1},addClass:function addClass(className){var clazz=this.attr("class")||"";_containClass(clazz,className)||this.attr("class",clazz+(clazz.length?" ":"")+className)},hasClass:function hasClass(className){return _containClass(this.attr("class"),className)},removeClass:function removeClass(className){var clazz=this.attr("class")||"";if(clazz){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)");clazz=clazz.replace(regex," ").trim(),clazz?this.attr("class",clazz):this.removeAttr("class")}},toggleClass:function toggleClass(className,state){return"boolean"==typeof state?state?this.addClass(className):this.removeClass(className):this.hasClass(className)?this.removeClass(className):this.addClass(className)},isset:function isset(){return Element.issetElement(this.serial)},unset:function unset(){return Element.unsetElement(this.serial)}}),_containClass=function(allClassStr,className){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)","");return allClassStr&&regex.test(allClassStr)};return Element.isA=function(qtiElement,qtiClass){return qtiElement instanceof Element&&qtiElement.is(qtiClass)},Element.getElementBySerial=function(serial){return _instances[serial]},Element.issetElement=function(serial){return!!_instances[serial]},Element.unsetElement=function(serial){var element=Element.getElementBySerial(serial);if(element){var composingElements=element.getComposingElements();return _.each(composingElements,function(elt){delete _instances[elt.serial]}),delete _instances[element.serial],!0}return!1},Element}),define("taoQtiItem/qtiItem/helper/xmlNsHandler",[],function(){'use strict';function getPrefix(namespaces,html5Ns){for(var key in namespaces)if(namespaces[key]===html5Ns)return key;return"qh5"}return{stripNs:function(body){var openRegEx=/(<([\w]+)\:(article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section))/gi,closeRegEx=/(<\/([\w]+)\:(article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section)>)/gi;return body.replace(openRegEx,"<$3").replace(closeRegEx,"</$3>")},restoreNs:function(xml,namespaces){var xmlRe=/(<(article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section)[^>]*>|<\/(article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section)>)/gi,tagRe=/((<)(article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section)([^>]*)(>)|(<\/)(article|aside|bdi|figure|footer|header|nav|rb|rp|rt|rtc|ruby|section)(>))/i,xmlMatch=xml.match(xmlRe),imsXsd="http://www.imsglobal.org/xsd",html5Ns=imsXsd+"/imsqtiv2p2_html5_v1p0",prefix=getPrefix(namespaces,html5Ns),prefixAtt="xmlns:"+prefix+"=\""+html5Ns+"\"",i=xmlMatch?xmlMatch.length:0,tagMatch;if(!xmlMatch)return xml;for(;i--;)tagMatch=xmlMatch[i].match(tagRe),xml=xml.replace(xmlMatch[i],tagMatch[5]?"<"+prefix+":"+tagMatch[3]+tagMatch[4]+">":"</"+prefix+":"+tagMatch[7]+">");return xmlMatch.length&&-1===xml.indexOf(prefixAtt)&&(xml=xml.replace("<assessmentItem","<assessmentItem "+prefixAtt)),xml=xml.replace("xmlns=\""+imsXsd+"/imsqti_v2p1\"","xmlns=\""+imsXsd+"/imsqti_v2p2\""),xml=xml.replace("xsi:schemaLocation=\""+imsXsd+"/imsqti_v2p1 imsqti_v2p1.xsd\"","xsi:schemaLocation=\""+imsXsd+"/imsqti_v2p2 "+imsXsd+"/qti/qtiv2p2/imsqti_v2p2.xsd\""),xml}}}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/xmlNsHandler"],function(_,Class,qtiClasses,Element,xmlNsHandler){'use strict';function loadPortableCustomElementData(portableElement,data){portableElement.typeIdentifier=data.typeIdentifier,portableElement.markup=data.markup,portableElement.entryPoint=data.entryPoint,portableElement.libraries=data.libraries,portableElement.setNamespace("",data.xmlns),loadPortableCustomElementProperties(portableElement,data.properties)}function loadPortableCustomElementProperties(portableElement,rawProperties){var properties={};_.forOwn(rawProperties,function(value,key){try{properties[key]=JSON.parse(value)}catch(e){properties[key]=value}}),portableElement.properties=properties}var Loader=Class.extend({init:function init(item,classesLocation){this.qti={},this.classesLocation={},this.item=item||null,this.setClassesLocation(classesLocation||qtiClasses)},setClassesLocation:function setClassesLocation(qtiClasses){return _.extend(this.classesLocation,qtiClasses),this},getRequiredClasses:function getRequiredClasses(data){var ret=[],i;for(i in data)"qtiClass"===i&&"_container"!==data[i]&&"rootElement"!==i?ret.push(data[i]):"object"===_typeof2(data[i])&&"responseRules"!==i&&(ret=_.union(ret,this.getRequiredClasses(data[i])));return ret},loadRequiredClasses:function loadRequiredClasses(data,callback,reload){var requiredClasses=this.getRequiredClasses(data,reload),required=[],i,requiredClass;for(i in requiredClasses)if(requiredClass=requiredClasses[i],this.classesLocation[requiredClass])required.push(this.classesLocation[requiredClass]);else throw new Error("missing qti class location declaration : "+requiredClass);var _this=this;require(required,function(){_.each(arguments,function(QtiClass){_this.qti[QtiClass.prototype.qtiClass]=QtiClass}),callback.call(_this,_this.qti)})},getLoadedClasses:function getLoadedClasses(){return _.keys(this.qti)},loadItemData:function loadItemData(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){if("object"===_typeof2(data)&&"assessmentItem"===data.qtiClass){for(var i in data.serial&&Element.unsetElement(data.serial),_this.item=new Qti.assessmentItem(data.serial,data.attributes||{}),_this.loadContainer(_this.item.getBody(),data.body),data.outcomes){var outcome=_this.buildOutcome(data.outcomes[i]);outcome&&_this.item.addOutcomeDeclaration(outcome)}for(i in data.feedbacks){var feedback=_this.buildElement(data.feedbacks[i]);feedback&&_this.item.addModalFeedback(feedback)}for(i in data.stylesheets){var stylesheet=_this.buildElement(data.stylesheets[i]);stylesheet&&_this.item.addStylesheet(stylesheet)}for(i in data.responses){var response=_this.buildResponse(data.responses[i]);if(response){_this.item.addResponseDeclaration(response);var feedbackRules=data.responses[i].feedbackRules;feedbackRules&&_.forIn(feedbackRules,function(fbData,serial){response.feedbackRules[serial]=_this.buildSimpleFeedbackRule(fbData,response)})}}data.responseProcessing&&_this.item.setResponseProcessing(_this.buildResponseProcessing(data.responseProcessing)),_this.item.setNamespaces(data.namespaces),_this.item.setSchemaLocations(data.schemaLocations),_this.item.setApipAccessibility(data.apipAccessibility)}"function"==typeof callback&&callback.call(_this,_this.item)})},loadAndBuildElement:function loadAndBuildElement(data,callback){var _this=this;_this.loadRequiredClasses(data,function(){var element=_this.buildElement(data);"function"==typeof callback&&callback.call(_this,element)})},loadElement:function loadElement(element,data,callback){var _this=this;this.loadRequiredClasses(data,function(){_this.loadElementData(element,data),"function"==typeof callback&&callback.call(_this,element)})},loadElements:function loadElements(data,callback){var _this=this;if(_this.item)this.loadRequiredClasses(data,function(){var allElements=_this.item.getComposingElements();for(var i in data){var elementData=data[i];elementData&&elementData.qtiClass&&elementData.serial&&allElements[elementData.serial]&&_this.loadElementData(allElements[elementData.serial],elementData)}"function"==typeof callback&&callback.call(_this,_this.item)});else throw"QtiLoader : cannot load elements in empty item"},buildResponse:function buildResponse(data){var response=this.buildElement(data);return response.template=data.howMatch||null,response.defaultValue=data.defaultValue||null,response.correctResponse=data.correctResponses||null,response.mapEntries=_.size(data.mapping)?data.mapping:_.size(data.areaMapping)?data.areaMapping:{},response.mappingAttributes=data.mappingAttributes||{},response},buildSimpleFeedbackRule:function buildSimpleFeedbackRule(data,response){var feedbackRule=this.buildElement(data);feedbackRule.setCondition(response,data.condition,data.comparedValue||null),feedbackRule.feedbackOutcome=this.item.outcomes[data.feedbackOutcome]||null,feedbackRule.feedbackThen=this.item.modalFeedbacks[data.feedbackThen]||null,feedbackRule.feedbackElse=this.item.modalFeedbacks[data.feedbackElse]||null;var response=feedbackRule.comparedOutcome;return feedbackRule.feedbackThen&&feedbackRule.feedbackThen.data("relatedResponse",response),feedbackRule.feedbackElse&&feedbackRule.feedbackElse.data("relatedResponse",response),feedbackRule},buildOutcome:function buildOutcome(data){var outcome=this.buildElement(data);return outcome.defaultValue=data.defaultValue||null,outcome},buildResponseProcessing:function buildResponseProcessing(data){var rp=this.buildElement(data);return data&&data.processingType&&("custom"===data.processingType?(rp.xml=data.data,rp.processingType="custom"):rp.processingType="templateDriven"),rp},loadContainer:function loadContainer(bodyObject,bodyData){if(!Element.isA(bodyObject,"_container"))throw"bodyObject must be a QTI Container";if(bodyData&&"string"==typeof bodyData.body&&("array"==typeof bodyData.elements||"object"===_typeof2(bodyData.elements))){for(var serial in bodyData.elements){var eltData=bodyData.elements[serial],element=this.buildElement(eltData);element&&bodyObject.setElement(element,bodyData.body)}bodyObject.body(xmlNsHandler.stripNs(bodyData.body))}else throw"wrong bodydata format"},buildElement:function buildElement(elementData){var elt=null;if(elementData&&elementData.qtiClass&&elementData.serial){var className=elementData.qtiClass;if(this.qti[className])elt=new this.qti[className](elementData.serial),this.loadElementData(elt,elementData);else throw"the qti element class does not exist: "+className}else throw"wrong elementData format";return elt},loadElementData:function loadElementData(element,data){var attributes=_.defaults(data.attributes||{},element.attributes||{});return element.setAttributes(attributes),element.body&&data.body&&element.bdy&&this.loadContainer(element.getBody(),data.body),element.object&&data.object&&element.object&&this.loadObjectData(element.object,data.object),Element.isA(element,"interaction")?this.loadInteractionData(element,data):Element.isA(element,"choice")?this.loadChoiceData(element,data):Element.isA(element,"math")?this.loadMathData(element,data):Element.isA(element,"infoControl")?this.loadPicData(element,data):Element.isA(element,"_tooltip")&&this.loadTooltipData(element,data),element},loadInteractionData:function loadInteractionData(interaction,data){Element.isA(interaction,"blockInteraction")&&data.prompt&&this.loadContainer(interaction.prompt.getBody(),data.prompt),this.buildInteractionChoices(interaction,data),Element.isA(interaction,"customInteraction")&&this.loadPciData(interaction,data)},buildInteractionChoices:function buildInteractionChoices(interaction,data){if(data.choices){if(Element.isA(interaction,"matchInteraction"))for(var set=0;2>set;set++){if(!data.choices[set])throw"missing match set #"+set;var matchSet=data.choices[set];for(var serial in matchSet){var choice=this.buildElement(matchSet[serial]);choice&&interaction.addChoice(choice,set)}}else for(var serial in data.choices){var choice=this.buildElement(data.choices[serial]);choice&&interaction.addChoice(choice)}if(Element.isA(interaction,"graphicGapMatchInteraction")&&data.gapImgs)for(var serial in data.gapImgs){var gapImg=this.buildElement(data.gapImgs[serial]);gapImg&&interaction.addGapImg(gapImg)}}},loadChoiceData:function loadChoiceData(choice,data){Element.isA(choice,"textVariableChoice")?choice.val(data.text):Element.isA(choice,"gapImg")||(Element.isA(choice,"gapText")?!choice.body()&&choice.body(data.text):Element.isA(choice,"containerChoice"))},loadObjectData:function loadObjectData(object,data){object.setAttributes(data.attributes),data._alt&&("object"===data._alt.qtiClass?object._alt=Loader.buildElement(data._alt):object._alt=data._alt)},loadMathData:function loadMathData(math,data){math.ns=data.ns||{},math.setMathML(data.mathML||""),_.forIn(data.annotations||{},function(value,encoding){math.setAnnotation(encoding,value)})},loadTooltipData:function loadTooltipData(tooltip,data){tooltip.content(data.content)},loadPciData:function loadPciData(pci,data){loadPortableCustomElementData(pci,data)},loadPicData:function loadPicData(pic,data){loadPortableCustomElementData(pic,data)}});return Loader}),define("core/encoder/entity",[],function(){'use strict';var _StringfromCharCode=String.fromCharCode,guiltyChars=["&","<",">","\""];return{encode:function(input){return input+="",input.split("").map(function(character){return-1<guiltyChars.indexOf(character)?"&#"+character.charCodeAt()+";":character}).join("")},decode:function(input){return input+="",input.replace(/&#(\d+);/g,function(matches,code){return _StringfromCharCode(code)})}}}),define("taoQtiItem/qtiCreator/model/helper/event",["jquery","lodash"],function($,_){"use strict";var namespaceModel=".qti-creator",eventList=["containerBodyChange","containerElementAdded","elementCreated.qti-widget","attributeChange.qti-widget","choiceCreated.qti-widget","correctResponseChange.qti-widget","mapEntryChange.qti-widget","mapEntryRemove.qti-widget","deleted.qti-widget","choiceTextChange.qti-widget","responseTemplateChange.qti-widget","mappingAttributeChange.qti-widget","feedbackRuleConditionChange.qti-widget","feedbackRuleCreated.qti-widget","feedbackRuleRemoved.qti-widget","feedbackRuleElseCreated.qti-widget","feedbackRuleElseRemoved.qti-widget"],event={choiceCreated:function(choice,interaction){$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:interaction})},choiceDeleted:function(choice,interaction){$(document).trigger("choiceDeleted.qti-widget",{choice:choice,interaction:interaction})},deleted:function deleted(element,parent){element.isset()&&element.unset(),$(document).off("."+element.getSerial()),$(document).trigger("deleted.qti-widget",{element:element,parent:parent})},getList:function getList(addedNamespace){var events=_.clone(eventList);return addedNamespace?_.map(events,function(e){return e+"."+addedNamespace}):events},initElementToWidgetListeners:function initElementToWidgetListeners(){$(document).off(".widget-container").on(event.getList(".widget-container").join(" "),function(e,data){var element=data.element||data.container||null,widget=data&&element&&element.data("widget");!widget&&data.parent&&(element=data.parent,widget=element.data("widget")),widget&&widget.$container.trigger(e.type+".qti-creator"+namespaceModel,data)})},getNs:function getNs(){return".qti-creator"},getNsModel:function getNsModel(){return namespaceModel}};return event}),define("taoQtiItem/qtiCreator/model/helper/invalidator",["lodash"],function(_){"use strict";return{completelyValid:function completelyValid(element){var item=element.getRootElement(),serial,invalidElements;item&&(serial=element.getSerial(),invalidElements=item.data("invalid")||{},delete invalidElements[serial],item.data("invalid",invalidElements))},valid:function valid(element,key){var item=element.getRootElement(),serial=element.getSerial(),invalidElements;if(item)if(invalidElements=item.data("invalid")||{},key)invalidElements[serial]&&invalidElements[serial][key]&&(delete invalidElements[serial][key],!_.size(invalidElements[serial])&&delete invalidElements[serial],item.data("invalid",invalidElements));else throw new Error("missing required argument \"key\"")},invalid:function invalid(element,key,message,stateName){var item=element.getRootElement(),serial=element.getSerial(),invalidElements;if(item)if(invalidElements=item.data("invalid")||{},key)invalidElements[serial]||(invalidElements[serial]={}),invalidElements[serial][key]={message:message||"",stateName:stateName||"active"},item.data("invalid",invalidElements);else throw new Error("missing required arguments \"key\"")},isValid:function isValid(element){var item=element.getRootElement(),serial=element.getSerial(),invalidElements;return!item||(invalidElements=item.data("invalid")||{},!invalidElements[serial])}}}),define("taoQtiItem/qtiCreator/model/mixin/editable",["lodash","jquery","core/encoder/entity","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/invalidator"],function(_,$,entity,Element,event,invalidator){"use strict";var _removeSelf=function(element){var removed=!1,related=element.getRootElement(),found,parent;if(related)found=related.find(element.getSerial()),found&&(parent=found.parent,Element.isA(parent,"interaction")?("gapImg"===element.qtiClass?parent.removeGapImg(element):Element.isA(element,"choice")&&parent.removeChoice(element),removed=!0):"body"===found.location&&_.isFunction(parent.initContainer)?(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.getBody().removeElement(element),removed=!0):Element.isA(parent,"_container")&&(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.removeElement(element),removed=!0),removed&&(element.data("removed",!0),invalidator.completelyValid(element),event.deleted(element,parent)));else throw new Error("no related item found");return removed},_removeElement=function(element,containerPropName,eltToBeRemoved){var targetSerial="",targetElt;return element[containerPropName]&&("string"==typeof eltToBeRemoved?(targetSerial=eltToBeRemoved,targetElt=Element.getElementBySerial(targetSerial)):eltToBeRemoved instanceof Element&&(targetSerial=eltToBeRemoved.getSerial(),targetElt=eltToBeRemoved),targetSerial&&(invalidator.completelyValid(targetElt),delete element[containerPropName][targetSerial],Element.unsetElement(targetSerial))),element};return{init:function init(serial,attributes){var attr={};"object"===_typeof2(serial)&&(attributes=serial,serial=""),_.isFunction(this.getDefaultAttributes)&&_.extend(attr,this.getDefaultAttributes()),_.extend(attr,attributes),this._super(serial,attr)},attr:function attr(key,value){var ret=this._super(key,value);return"undefined"!=typeof key&&"undefined"!=typeof value&&$(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:entity.encode(value)}),_.isString(ret)?entity.decode(ret):ret},removeAttr:function removeAttr(key){var ret=this._super(key);return $(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:null}),ret},remove:function remove(){if(0===arguments.length)return _removeSelf(this);if(2===arguments.length)return _removeElement(this,arguments[0],arguments[1]);throw new Error("invalid number of argument given")}}}),define("taoQtiItem/qtiCreator/model/qtiClasses",["lodash","taoQtiItem/qtiItem/core/qtiClasses"],function(_,qtiClasses){"use strict";return _.defaults({assessmentItem:"taoQtiItem/qtiCreator/model/Item",_container:"taoQtiItem/qtiCreator/model/Container",img:"taoQtiItem/qtiCreator/model/Img",math:"taoQtiItem/qtiCreator/model/Math",object:"taoQtiItem/qtiCreator/model/Object",table:"taoQtiItem/qtiCreator/model/Table",rubricBlock:"taoQtiItem/qtiCreator/model/RubricBlock",modalFeedback:"taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/model/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCreator/model/interactions/MatchInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",simpleChoice:"taoQtiItem/qtiCreator/model/choices/SimpleChoice",simpleAssociableChoice:"taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",inlineChoice:"taoQtiItem/qtiCreator/model/choices/InlineChoice",mediaInteraction:"taoQtiItem/qtiCreator/model/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/model/interactions/UploadInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCreator/model/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",graphicInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",hotspotChoice:"taoQtiItem/qtiCreator/model/choices/HotspotChoice",gapImg:"taoQtiItem/qtiCreator/model/choices/GapImg",associableHotspot:"taoQtiItem/qtiCreator/model/choices/AssociableHotspot",gapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GapMatchInteraction",hottextInteraction:"taoQtiItem/qtiCreator/model/interactions/HottextInteraction",hottext:"taoQtiItem/qtiCreator/model/choices/Hottext",gapText:"taoQtiItem/qtiCreator/model/choices/GapText",gap:"taoQtiItem/qtiCreator/model/choices/Gap",responseDeclaration:"taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiCreator/model/ResponseProcessing",customInteraction:"taoQtiItem/qtiCreator/model/interactions/PortableCustomInteraction",endAttemptInteraction:"taoQtiItem/qtiCreator/model/interactions/EndAttemptInteraction",infoControl:"taoQtiItem/qtiCreator/model/PortableInfoControl",include:"taoQtiItem/qtiCreator/model/Include",printedVariable:"taoQtiItem/qtiCreator/model/PrintedVariable",_tooltip:"taoQtiItem/qtiCreator/model/Tooltip"},qtiClasses)}),define("taoQtiItem/qtiCreator/model/helper/container",["jquery","lodash","taoQtiItem/qtiCreator/model/qtiClasses"],function($,_,qtiClasses){"use strict";return{createElements:function createElements(container,body,callback){var regex=/{{([a-z_]+)\.?([a-z_]*):new}}/ig,required={};body.replace(regex,function(original,qtiClass){if(qtiClasses[qtiClass])required[qtiClass]=qtiClasses[qtiClass];else throw new Error("missing required class : "+qtiClass)}),require(_.values(required),function(){var Qti=_.reduce([].slice.call(arguments),function(acc,qtiClassElt){return acc[qtiClassElt.prototype.qtiClass]=qtiClassElt,acc},{}),promises=[],$doc=$(document),newElts={},newBody=body.replace(regex,function(original,qtiClass,subClass){var elt=new Qti[qtiClass];return Qti[qtiClass]?(container.getRenderer()&&elt.setRenderer(container.getRenderer()),newElts[elt.getSerial()]=elt,subClass&&(elt.typeIdentifier=subClass),elt.placeholder()):original});container.setElements(newElts,newBody),_.each(newElts,function(elt){_.isFunction(elt.buildIdentifier)&&elt.buildIdentifier(),_.isFunction(elt.afterCreate)&&promises.push(elt.afterCreate())}),"function"==typeof callback&&Promise.all(promises).then(function(){_.each(newElts,function(elt){$doc.trigger("elementCreated.qti-widget",{parent:container.parent(),element:elt})}),callback.call(container,newElts)}).catch(function(err){container.getRenderer().getCreatorContext().trigger("error",err)})})}}}),define("taoQtiItem/qtiCreator/model/mixin/editableContainer",["taoQtiItem/qtiCreator/model/helper/container"],function(containerHelper){"use strict";return{createElements:function createElements(body,callback){var _this=this;containerHelper.createElements(_this.getBody(),body,function(newElts){callback.call(_this,newElts)})}}}),define("taoQtiItem/qtiItem/core/IdentifiedElement",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/util"],function(Element,util){'use strict';var IdentifiedElement=Element.extend({buildIdentifier:function(prefix,useSuffix){var item=this.getRootElement(),id=util.buildIdentifier(item,prefix||this.qtiClass,useSuffix);return id&&this.attr("identifier",id),this},id:function(value){return value||this.attr("identifier")||this.buildIdentifier(this.qtiClass,!0),this.attr("identifier",value)}});return IdentifiedElement}),define("taoQtiItem/qtiItem/mixin/Mixin",[],function(){return{augment:function augment(targetClass,methods,options){if("function"==typeof targetClass&&"object"===_typeof2(methods))for(var methodName in methods)if(!Object.hasOwnProperty(targetClass.prototype,methodName))targetClass.prototype[methodName]=methods[methodName];else if(options&&options.append){var _parent=targetClass.prototype[methodName];targetClass.prototype[methodName]=function(){return methods[methodName].apply(this,arguments),_parent.apply(this,arguments)}}}}}),define("taoQtiItem/qtiItem/core/Container",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Element,rendererConfig){'use strict';var Container=Element.extend({qtiClass:"_container",init:function init(body){if(this._super(),body&&"string"!=typeof body)throw"the body of a container must be a string";this.bdy=body||"",this.elements={}},body:function body(_body){if("undefined"==typeof _body)return this.bdy;if("string"==typeof _body)this.bdy=_body,$(document).trigger("containerBodyChange",{body:_body,container:this,parent:this.parent()});else throw"body must be a string"},setElements:function setElements(elements,body){var returnValue=!1;for(var i in elements){var elt=elements[i];if(elt instanceof Element)body=body||this.bdy,-1===body.indexOf(elt.placeholder())&&(body+=elt.placeholder()),elt.setRootElement(this.getRootElement()||null),this.elements[elt.getSerial()]=elt,$(document).trigger("containerElementAdded",{element:elt,container:this}),returnValue=!0;else throw returnValue=!1,"expected a qti element"}return this.body(body),returnValue},setElement:function setElement(element,body){return this.setElements([element],body)},removeElement:function removeElement(element){var serial="";return"string"==typeof element?serial=element:element instanceof Element&&(serial=element.getSerial()),delete this.elements[serial],this.body(this.body().replace("{{"+serial+"}}","")),this},getElements:function getElements(qtiClass){var elts={};if("string"==typeof qtiClass)for(var serial in this.elements)Element.isA(this.elements[serial],qtiClass)&&(elts[serial]=this.elements[serial]);else elts=_.clone(this.elements);return elts},getElement:function getElement(serial){return this.elements[serial]?this.elements[serial]:null},getComposingElements:function getComposingElements(){var elements=this.getElements(),elts={};for(var serial in elements)elts[serial]=elements[serial],elts=_.extend(elts,elements[serial].getComposingElements());return elts},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),elementsData=[],tpl=this.body();for(var serial in this.elements){var elt=this.elements[serial];if("function"==typeof elt.render)"_container"===elt.qtiClass?tpl=tpl.replace(elt.placeholder(),elt.render(renderer)):(tpl=tpl.replace(elt.placeholder(),"{{{"+serial+"}}}"),elementsData[serial]=elt.render(renderer));else throw"render() is not defined for the qti element: "+serial}if(renderer.isRenderer)return this._super({body:renderer.renderDirect(tpl,elementsData),contentModel:this.contentModel||"flow"},renderer,args.placeholder);throw"invalid qti renderer for qti container"},postRender:function postRender(data,altClassName,renderer){renderer=renderer||this.getRenderer();var res=_(this.elements).filter(function(elt){return"function"==typeof elt.postRender}).map(function(elt){return elt.postRender(data,"",renderer)}).flatten(!0).value().concat(this._super(data,altClassName,renderer));return res},toArray:function toArray(){var arr={serial:this.serial,body:this.bdy,elements:{}};for(var serial in this.elements)arr.elements[serial]=this.elements[serial].toArray();return arr},find:function find(serial,parent){var found=null;return this.elements[serial]?found={parent:parent||this,element:this.elements[serial],location:"body"}:_.each(this.elements,function(elt){if(found=elt.find(serial),found)return!1}),found},isEmpty:function isEmpty(){return!this.bdy}});return Container}),define("taoQtiItem/qtiItem/mixin/Container",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/core/Container"],function(Mixin,Container){var methods={initContainer:function initContainer(body){this.bdy=new Container(body||""),this.bdy.setRootElement(this.getRootElement()||null),this.bdy.contentModel="blockStatic"},getBody:function getBody(){return this.bdy},body:function body(_body2){var ret=this.bdy.body(_body2);return _body2?this:ret},setElement:function setElement(element,body){return this.bdy.setElement(element,body),this},removeElement:function removeElement(element){return this.bdy.removeElement(element)},getElements:function getElements(qtiClass){return this.bdy.getElements(qtiClass)},getElement:function getElement(serial){return this.bdy.getElement(serial)}};return{augment:function augment(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/mixin/ContainerItemBody",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function initContainer(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="itemBody"}}),{augment:function augment(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Item",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/ContainerItemBody","lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(Element,IdentifiedElement,Container,_,$,util){'use strict';var Item=IdentifiedElement.extend({qtiClass:"assessmentItem",init:function(serial,attributes){this._super(serial,attributes),this.rootElement=this,this.stylesheets={},this.responses={},this.outcomes={},this.modalFeedbacks={},this.namespaces={},this.schemaLocations={},this.responseProcessing=null,this.apipAccessibility=null},getInteractions:function(){var interactions=[],elts=this.getComposingElements();for(var serial in elts)Element.isA(elts[serial],"interaction")&&interactions.push(elts[serial]);return interactions},addResponseDeclaration:function(response){if(Element.isA(response,"responseDeclaration"))response.setRootElement(this),this.responses[response.getSerial()]=response;else throw"is not a qti response declaration";return this},getResponseDeclaration:function(identifier){for(var i in this.responses)if(this.responses[i].attr("identifier")===identifier)return this.responses[i];return null},addOutcomeDeclaration:function(outcome){if(Element.isA(outcome,"outcomeDeclaration"))outcome.setRootElement(this),this.outcomes[outcome.getSerial()]=outcome;else throw"is not a qti outcome declaration";return this},getOutcomeDeclaration:function(identifier){var found;return _.forEach(this.outcomes,function(outcome){if(outcome.id()===identifier)return found=outcome,!1}),found},getOutcomes:function(){return _.clone(this.outcomes)},removeOutcome:function(identifier){var outcome=this.getOutcomeDeclaration(identifier);outcome&&(this.outcomes=_.omit(this.outcomes,outcome.getSerial()))},addModalFeedback:function(feedback){if(Element.isA(feedback,"modalFeedback"))feedback.setRootElement(this),this.modalFeedbacks[feedback.getSerial()]=feedback;else throw"is not a qti modal feedback";return this},getComposingElements:function(){var elts=this._super(),_this=this;return _.forEach(["responses","outcomes","modalFeedbacks","stylesheets"],function(elementCollection){for(var i in _this[elementCollection]){var elt=_this[elementCollection][i];elts[i]=elt,elts=_.extend(elts,elt.getComposingElements())}}),this.responseProcessing instanceof Element&&(elts[this.responseProcessing.getSerial()]=this.responseProcessing),elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["responses","outcomes","modalFeedbacks","stylesheets"],serial)),found},getResponses:function(){return _.clone(this.responses)},getRootElement:function(){return this},addNamespace:function(name,uri){this.namespaces[name]=uri},setNamespaces:function(namespaces){this.namespaces=namespaces},getNamespaces:function(){return _.clone(this.namespaces)},setSchemaLocations:function(locations){this.schemaLocations=locations},getSchemaLocations:function(){return _.clone(this.schemaLocations)},setApipAccessibility:function(apip){this.apipAccessibility=apip||null},getApipAccessibility:function(){return this.apipAccessibility},addStylesheet:function(stylesheet){if(Element.isA(stylesheet,"stylesheet"))stylesheet.setRootElement(this),this.stylesheets[stylesheet.getSerial()]=stylesheet;else throw"is not a qti stylesheet declaration";return this},removeStyleSheet:function(stylesheet){return delete this.stylesheets[stylesheet.getSerial()],this},stylesheetExists:function(href){var exists=!1;return _.forEach(this.stylesheets,function(stylesheet){if(stylesheet.attr("href")===href)return exists=!0,!1}),exists},setResponseProcessing:function(rp){if(Element.isA(rp,"responseProcessing"))rp.setRootElement(this),this.responseProcessing=rp;else throw"is not a response processing";return this},toArray:function toArray(){var arr=this._super(),toArray=function(elt){return elt.toArray()};return arr.namespaces=this.namespaces,arr.schemaLocations=this.schemaLocations,arr.outcomes=_.map(this.outcomes,toArray),arr.responses=_.map(this.responses,toArray),arr.stylesheets=_.map(this.stylesheets,toArray),arr.modalFeedbacks=_.map(this.modalFeedbacks,toArray),arr.responseProcessing=this.responseProcessing.toArray(),arr},isEmpty:function(){var body=this.body().trim();if(body){var $dummy=$("<div>").html(body),$children=$dummy.children();return!!(1===$children.length&&$children.hasClass("empty"))}return!0},clear:function(){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.destroy)&&renderer.destroy(this)}});return Container.augment(Item),Item}),define("taoQtiItem/qtiItem/core/Stylesheet",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){var Stylesheet=Element.extend({qtiClass:"stylesheet",render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={href:renderer.resolveUrl(this.attr("href"))},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return Stylesheet}),define("taoQtiItem/qtiCreator/model/Stylesheet",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Stylesheet"],function(_,editable,Stylesheet){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{href:"css/tao-user-styles.css",title:"",type:"text/css",media:"all"}}}),Stylesheet.extend(methods)}),define("taoQtiItem/qtiItem/core/ResponseProcessing",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element){var ResponseProcessing=Element.extend({qtiClass:"responseProcessing",processingType:"",xml:"",toArray:function toArray(){var arr=this._super();return arr.processingType=this.processingType,arr.xml=this.xml,arr}});return ResponseProcessing}),define("taoQtiItem/qtiCreator/model/ResponseProcessing",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/ResponseProcessing"],function(_,editable,ResponseProcessing){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{}},setProcessingType:function setProcessingType(processingType){this.processingType!==processingType&&("custom"===this.processingType&&_.each(this.getRootElement().getResponses(),function(r){r.setTemplate("MATCH_CORRECT")}),this.processingType=processingType)}}),ResponseProcessing.extend(methods)}),define("taoQtiItem/qtiItem/core/variables/VariableDeclaration",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){'use strict';var VariableDeclaration=IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes),this.defaultValue=null},is:function(qtiClass){return"variableDeclaration"===qtiClass||this._super(qtiClass)},toArray:function(){var arr=this._super();return arr.defaultValue=this.defaultValue,arr},setDefaultValue:function(value){this.defaultValue=value},getDefaultValue:function(){return this.defaultValue}});return VariableDeclaration}),define("taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration"],function(VariableDeclaration){return VariableDeclaration.extend({qtiClass:"outcomeDeclaration"})}),define("taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/variables/OutcomeDeclaration"],function(_,editable,OutcomeDeclaration){"use strict";var methods={};return _.extend(methods,editable),OutcomeDeclaration.extend(methods)}),define("taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",["taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/Container"],function(IdentifiedElement,Container){var ModalFeedback=IdentifiedElement.extend({qtiClass:"modalFeedback",is:function is(qtiClass){return"feedback"===qtiClass||this._super(qtiClass)}});return Container.augment(ModalFeedback),ModalFeedback}),define("taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/feedbacks/ModalFeedback"],function(_,editable,ModalFeedback){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{title:"modal feedback title",showHide:"show"}}}),ModalFeedback.extend(methods)}),define("taoQtiItem/qtiCreator/model/Item",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableContainer","taoQtiItem/qtiItem/core/Item","taoQtiItem/qtiCreator/model/Stylesheet","taoQtiItem/qtiCreator/model/ResponseProcessing","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration","taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback"],function(_,editable,editableContainer,Item,Stylesheet,ResponseProcessing,OutcomeDeclaration,ModalFeedback){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableContainer),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{identifier:"myItem_1",title:"Item title",adaptive:!1,timeDependent:!1,"xml:lang":"en-US"}},createResponseProcessing:function createResponseProcessing(){var rp=new ResponseProcessing;return rp.processingType="templateDriven",this.setResponseProcessing(rp),rp},createStyleSheet:function createStyleSheet(href){if(href&&_.isString(href)){var stylesheet=new Stylesheet({href:href});return stylesheet.setRenderer(this.getRenderer()),this.addStylesheet(stylesheet),stylesheet}throw"missing or invalid type for the required arg \"href\""},createOutcomeDeclaration:function createOutcomeDeclaration(attributes){var identifier=attributes.identifier||"";delete attributes.identifier;var outcome=new OutcomeDeclaration(attributes);return this.addOutcomeDeclaration(outcome),outcome.buildIdentifier(identifier),outcome},getOutcomeDeclaration:function(identifier){var found;return _.forEach(this.outcomes,function(outcome){if(outcome.id()===identifier)return found=outcome,!1}),found},removeOutcome:function(identifier){var outcome=this.getOutcomeDeclaration(identifier);outcome&&(this.outcomes=_.omit(this.outcomes,outcome.getSerial()))},createModalFeedback:function createModalFeedback(attributes,response){var identifier=attributes.identifier||"";delete attributes.identifier;var modalFeedback=new ModalFeedback(attributes);return this.addModalFeedback(modalFeedback),modalFeedback.buildIdentifier(identifier),modalFeedback.body("Some feedback text."),response&&"responseDeclaration"===response.qtiClass&&modalFeedback.data("relatedResponse",response),modalFeedback},deleteResponseDeclaration:function deleteResponseDeclaration(response){var self=this,serial;return _.isString(response)?serial=response:response&&"responseDeclaration"===response.qtiClass&&(serial=response.getSerial()),this.responses[serial]&&(_.each(this.responses[serial].feedbackRules,function(rule){var feedbacks=[];rule.feedbackThen&&rule.feedbackThen.is("modalFeedback")&&feedbacks.push(rule.feedbackThen.serial),rule.feedbackElse&&rule.feedbackElse.is("modalFeedback")&&feedbacks.push(rule.feedbackElse.serial),self.modalFeedbacks=_.omit(self.modalFeedbacks,feedbacks),rule.feedbackOutcome&&rule.feedbackOutcome.is("outcomeDeclaration")&&(self.outcomes=_.omit(self.outcomes,rule.feedbackOutcome.serial))}),this.responses=_.omit(this.responses,serial)),this}}),Item.extend(methods)}),define("taoQtiItem/qtiCreator/helper/itemLoader",["jquery","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/qtiClasses"],function($,Loader,Item,qtiClasses){"use strict";var _generateIdentifier=function(uri){var pos=uri.lastIndexOf("#");return uri.substr(pos+1)},qtiNamespace="http://www.imsglobal.org/xsd/imsqti_v2p2",qtiSchemaLocation={"http://www.imsglobal.org/xsd/imsqti_v2p2":"http://www.imsglobal.org/xsd/qti/qtiv2p2/imsqti_v2p2.xsd"};return{loadItem:function(config,callback){config.uri&&$.ajax({url:config.itemDataUrl,dataType:"json",data:{uri:config.uri}}).done(function(data){var loader,itemData,newItem;data.itemData&&"assessmentItem"===data.itemData.qtiClass?(loader=new Loader().setClassesLocation(qtiClasses),itemData=data.itemData,loader.loadItemData(itemData,function(loadedItem){var namespaces;loadedItem.isEmpty()&&loadedItem.body(""),namespaces=loadedItem.getNamespaces(),namespaces[""]=qtiNamespace,loadedItem.setNamespaces(namespaces),loadedItem.setSchemaLocations(qtiSchemaLocation),data.languagesList&&loadedItem.data("languagesList",data.languagesList),callback(loadedItem,this.getLoadedClasses())})):(newItem=new Item().id(_generateIdentifier(config.uri)).attr("title",config.label),newItem.createResponseProcessing(),newItem.setNamespaces({"":qtiNamespace,xsi:"http://www.w3.org/2001/XMLSchema-instance",m:"http://www.w3.org/1998/Math/MathML"}),newItem.setSchemaLocations(qtiSchemaLocation),newItem.data("new",!0),data.languagesList&&newItem.data("languagesList",data.languagesList),callback(newItem))})}}}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(_,Element){var _Mathfloor=Math.floor;return{convertChoices:function convertChoices(choices,outputType){var ret=[],_this=this;return _.each(choices,function(c){Element.isA(c,"choice")?"serial"===outputType?ret.push(c.getSerial()):"identifier"===outputType?ret.push(c.id()):ret.push(c):_.isArray(c)&&ret.push(_this.convertChoices(c,outputType))}),ret},findChoices:function findChoices(interaction,choices,inputType){var ret=[],_this=this;return _.each(choices,function(c){var choice;_.isString(c)?"serial"===inputType?(choice=interaction.getChoice(c),choice&&ret.push(choice)):"identifier"===inputType?(choice=interaction.getChoiceByIdentifier(c),choice&&ret.push(choice)):ret.push(c):_.isArray(c)?ret.push(_this.findChoices(interaction,c,inputType)):ret.push(c)}),ret},shuffleChoices:function shuffleChoices(choices){var r=[],f={},j=0;for(var i in choices)if(Element.isA(choices[i],"choice")){var choice=choices[i];choice.attr("fixed")&&(f[j]=choice),r.push(choice),j++}else throw"invalid element in array: is not a qti choice";for(var n=0;n<r.length-1;n++)if(!f[n]){var k=-1;do k=n+_Mathfloor(Math.random()*(r.length-n));while(f[k]);var tmp=r[k];r[k]=r[n],r[n]=tmp}return r},serialToIdentifier:function serialToIdentifier(interaction,choiceSerial){var choice=interaction.getChoice(choiceSerial);return choice?choice.id():""}}}),define("ui/themeLoader",["jquery","lodash"],function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var $container=$("head").length?$("head"):$("body"),triggerThemeChange=function(themeId){_.delay(function(){$(document).trigger("themechange."+"themeloader",[themeId])},200)},createStyleSheet=function(theme){var type="base"===theme.id?"custom-theme-base":"custom-theme-theme";return $("<link>").attr({rel:"stylesheet",type:"text/css",href:theme.path,"data-type":type,"data-name":theme.name||theme.id,"data-id":theme.id})},getLink=function(id){return $("link[data-id=\""+id+"\"][data-type^=\""+"custom-theme-"+"\"]",$container)},isAttached=function(id){return 0<getLink(id).length},enable=function($nodes){$nodes.prop("disabled",!1).removeProp("disabled").removeAttr("disabled")},disable=function($nodes){return $nodes.prop("disabled",!0).attr("disabled",!0)},themeLoader=function(config){var styles={},defaultTheme,activeTheme,themes,i;if(!_.isPlainObject(config))throw new TypeError("Theme loader configuration is required");if(!_.isString(config.base))throw new TypeError("Theme loader configuration is an object with a base property configuration");if(!_.isArray(config.available)||!config.available.length)throw new TypeError("No theme declared in the configuration");for(i in config.available)if(!_.isPlainObject(config.available[i])||_.isEmpty(config.available[i].id)||_.isEmpty(config.available[i].path))throw new TypeError("There is a theme that does not contain an id or a path");return defaultTheme=config.default||_.first(_.pluck(config.available,"id")),activeTheme=defaultTheme,themes=[{id:"base",path:config.base,name:"TAO"}],themes=themes.concat(config.available),_.forEach(themes,function(theme){styles[theme.id]=isAttached(theme.id)?getLink(theme.id):createStyleSheet(theme)}),{load:function(preload){return _.forEach(styles,function($link,id){isAttached(id)||(!preload&&id===activeTheme&&$link.on("load",function(){triggerThemeChange(id)}),disable($link),$container.append($link)),preload||("base"!==id&&id!==defaultTheme?disable($link):(enable($link),activeTheme=id,triggerThemeChange(activeTheme)))}),this},unload:function(){return disable($("link[data-type^=\"custom-theme-\"]",$container)),this},change:function(id){return _.contains(["base","default"],id)&&!isAttached(id)&&(id=defaultTheme),isAttached(id)&&(disable($("link[data-type=\"custom-theme-theme\"]",$container)),enable(getLink(id)),activeTheme=id,triggerThemeChange(activeTheme)),this},getActiveTheme:function(){return activeTheme}}};return themeLoader}),define("ui/themes",["lodash","module"],function(_,module){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,module=module&&module.hasOwnProperty("default")?module["default"]:module;var themesConfig;return{getConfig:function(){var initialConfig;return themesConfig||(initialConfig=module.config(),themesConfig=_.cloneDeep(initialConfig)),themesConfig},getDefaultNamespacePrefix:function(){return"items"},get:function(what,ns){var config=this.getConfig();if(ns?what+="_"+ns:config.activeNamespace&&config[what+"_"+config.activeNamespace]&&(what+="_"+config.activeNamespace),_.isPlainObject(config[what]))return config[what]},getAvailable:function(what,ns){var available=[],themes=this.get(what,ns);return themes&&_.isArray(themes.available)&&(available=themes.available),available},getActiveNamespace:function(){return this.getConfig().activeNamespace},setActiveNamespace:function(ns){this.getConfig().activeNamespace=ns},getCurrentThemeData:function(what){var themeNamespace=this.getActiveNamespace();return what||(what=this.getDefaultNamespacePrefix()),this.get(what,themeNamespace)}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","core/promise","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper","ui/themeLoader","ui/themes"],function(_,$,Handlebars,Promise,Element,interactionHelper,themeLoader,themesHelper){'use strict';function getDocumentBaseUrl(){return window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/([^\/]*)$/,"")}var _isValidRenderer=function(renderer){var valid=!0;if("object"!==_typeof2(renderer))return!1;var classCorrect=!1;if(renderer.qtiClass)if(0<=_.indexOf(_renderableClasses,renderer.qtiClass))classCorrect=!0;else{var pos=renderer.qtiClass.indexOf(".");if(0<pos){var qtiClass=renderer.qtiClass.slice(0,pos),subClass=renderer.qtiClass.slice(pos+1);_renderableSubclasses[qtiClass]&&0<=_.indexOf(_renderableSubclasses[qtiClass],subClass)&&(classCorrect=!0)}}if(!classCorrect)throw valid=!1,new Error("invalid qti class name in renderer declaration : "+renderer.qtiClass);if(!renderer.template)throw valid=!1,new Error("missing template in renderer declaration : "+renderer.qtiClass);return valid},_renderableClasses=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","_tooltip","img","math","object","table","modalFeedback","rubricBlock","associateInteraction","choiceInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","customInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice","infoControl","include","printedVariable"],_dependencies={assessmentItem:["stylesheet","_container","prompt","modalFeedback"],rubricBlock:["_container"],associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},_renderableSubclasses={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]},_defaults={shuffleChoices:!0},Renderer=function(options){function registerRendererClass(qtiClass,list){var success=!1;return!1===_locations[qtiClass]?(_renderers[qtiClass]=!1,success=!0):_locations[qtiClass]&&(list.push(_locations[qtiClass]),success=!0),success}var _locations={},_renderers={};options=_.defaults(options||{},_defaults),this.isRenderer=!0,this.name="",this.shuffledChoices=[];var _getClassRenderer=function(qtiClass){var ret=null;if(_renderers[qtiClass])ret=_renderers[qtiClass];else{var pos=qtiClass.indexOf(".");0<pos&&(qtiClass=qtiClass.slice(0,pos),_renderers[qtiClass]&&(ret=_renderers[qtiClass]))}return ret};this.setOption=function(key,value){return"string"==typeof key&&(options[key]=value),this},this.setOptions=function(opts){return options=_.extend(options,opts),this},this.getOption=function(key){return"string"==typeof key&&options[key]?options[key]:null},this.getCustomMessage=function(elementName,messageKey){var messages=this.getOption("messages");return messages&&elementName&&messages[elementName]&&_.isString(messages[elementName][messageKey])?Handlebars.compile(messages[elementName][messageKey]):null},this.getAssetManager=function(){return options.assetManager},this.getThemeLoader=function(){return this.themeLoader},this.renderTpl=function(element,data,qtiSubclass){var ret="",qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass),decorators=this.getOption("decorators"),res;if(!renderer||!_.isFunction(renderer.template))throw new Error("no renderer template loaded under the class name : "+qtiClass);return _.isObject(decorators)&&_.isFunction(decorators.before)&&(res=decorators.before(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret+=renderer.template(data),_.isObject(decorators)&&_.isFunction(decorators.after)&&(res=decorators.after(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret},this.getData=function(element,data,qtiSubclass){var ret=data,qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.getData&&(ret=renderer.getData.call(this,element,data)),ret},this.renderDirect=function(tpl,data){return Handlebars.compile(tpl)(data)},this.getContainer=function(qtiElement,$scope,qtiSubclass){var ret=null,qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer)ret=renderer.getContainer(qtiElement,$scope);else throw"no renderer found for the class : "+qtiElement.qtiClass;return ret},this.postRender=function(qtiElement,data,qtiSubclass){var qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer&&"function"==typeof renderer.render)return renderer.render.call(this,qtiElement,data)},this.setResponse=function(qtiInteraction,response,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;else if("function"==typeof renderer.setResponse){ret=renderer.setResponse.call(this,qtiInteraction,response);var $container=renderer.getContainer.call(this,qtiInteraction);$container instanceof $&&$container.length&&$container.trigger("responseSet",[qtiInteraction,response])}return ret},this.getResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer)"function"==typeof renderer.getResponse&&(ret=renderer.getResponse.call(this,qtiInteraction));else throw"no renderer registered under the name : "+qtiClass;return ret},this.resetResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer)"function"==typeof renderer.resetResponse&&(ret=renderer.resetResponse.call(this,qtiInteraction));else throw"no renderer registered under the name : "+qtiClass;return ret},this.getState=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer)ret=_.isFunction(renderer.getState)?renderer.getState.call(this,qtiInteraction):renderer.getResponse.call(this,qtiInteraction);else throw"no renderer registered under the name : "+qtiClass;return ret},this.setState=function(qtiInteraction,state,qtiSubclass){var qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer)_.isFunction(renderer.setState)?renderer.setState.call(this,qtiInteraction,state):(renderer.resetResponse.call(this,qtiInteraction),renderer.setResponse.call(this,qtiInteraction,state));else throw"no renderer registered under the name : "+qtiClass},this.destroy=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(renderer)_.isFunction(renderer.destroy)&&(ret=renderer.destroy.call(this,qtiInteraction));else throw"no renderer registered under the name : "+qtiClass;return ret},this.getLoadedRenderers=function(){return _renderers},this.register=function(renderersLocations){_.extend(_locations,renderersLocations)},this.load=function(callback,requiredClasses){var self=this,required=[],themeData=themesHelper.getCurrentThemeData();if(themeData&&(options.themes=themeData),options.themes&&(options.themes.base=this.resolveUrl(options.themes.base),_.forEach(options.themes.available,function(theme,index){options.themes.available[index].path=self.resolveUrl(theme.path)}),this.themeLoader=themeLoader(options.themes).load(options.preload)),!requiredClasses)required=_.values(_locations);else if(_.isArray(requiredClasses))requiredClasses=_.intersection(requiredClasses,_renderableClasses),_.each(requiredClasses,function(reqClass){var deps=_dependencies[reqClass];deps&&(requiredClasses=_.union(requiredClasses,deps))}),_.forEach(requiredClasses,function(qtiClass){var requiredSubClasses;if(_renderableSubclasses[qtiClass])requiredSubClasses=_.intersection(requiredClasses,_renderableSubclasses[qtiClass]),_.each(requiredSubClasses,function(subclass){if(!registerRendererClass(qtiClass+"."+subclass,required)&&!registerRendererClass(qtiClass,required))throw new Error(self.name+" : missing qti class location declaration: "+qtiClass+", subclass: "+subclass)});else if(!registerRendererClass(qtiClass,required))throw new Error(self.name+" : missing qti class location declaration: "+qtiClass)});else throw new Error("invalid argument type: expected array for arg \"requireClasses\"");return require(required,function(){_.each(arguments,function(clazz){_isValidRenderer(clazz)&&(_renderers[clazz.qtiClass]=clazz)}),"function"==typeof callback&&callback.call(self,_renderers)}),this},this.unload=function(){return this.themeLoader&&themeLoader(options.themes).unload(),this},this.setShuffledChoices=function(interaction,choices,identificationType){Element.isA(interaction,"interaction")&&(this.shuffledChoices[interaction.getSerial()]=_.pluck(interactionHelper.findChoices(interaction,choices,identificationType),"serial"))},this.getShuffledChoices=function(interaction,reshuffle,returnedType){var choices=[],serial,i;if(Element.isA(interaction,"interaction")){if(serial=interaction.getSerial(),this.shuffledChoices[serial]&&!reshuffle)Element.isA(interaction,"matchInteraction")?_.forEach(choices,function(choice,index){2>index&&_.forEach(this.shuffledChoices[serial][i],function(choiceSerial){choice.push(interaction.getChoice(choiceSerial))})}):_.forEach(this.shuffledChoices[serial],function(choiceSerial){choices.push(interaction.getChoice(choiceSerial))});else if(Element.isA(interaction,"matchInteraction"))for(this.shuffledChoices[serial]=[],i=0;2>i;i++)choices[i]=interactionHelper.shuffleChoices(interaction.getChoices(i)),this.shuffledChoices[serial][i]=_.pluck(choices[i],"serial");else choices=interactionHelper.shuffleChoices(interaction.getChoices()),this.shuffledChoices[serial]=_.pluck(choices,"serial");return"serial"===returnedType||"identifier"===returnedType?interactionHelper.convertChoices(choices,returnedType):_.clone(choices)}return[]},this.getRenderers=function(){return _renderers},this.getLocations=function(){return _locations},this.resolveUrl=function(url){return options.assetManager?"string"==typeof url&&0<url.length?options.assetManager.resolve(url):void 0:url},this.getAbsoluteUrl=function(relUrl){if(console.warn("DEPRECATED used getAbsoluteUrl with ",arguments),this.getOption("userRelativeUrl"))return relUrl.replace(/^\.?\//,"");if(/^http(s)?:\/\//i.test(relUrl)||/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/.test(relUrl))return relUrl;var absUrl="",runtimeLocations=this.getOption("runtimeLocations");if(runtimeLocations&&_.size(runtimeLocations)&&_.forIn(runtimeLocations,function(runtimeLocation,typeIdentifier){if(0===relUrl.indexOf(typeIdentifier))return absUrl=relUrl.replace(typeIdentifier,runtimeLocation),!1}),absUrl)return absUrl;var baseUrl=this.getOption("baseUrl")||getDocumentBaseUrl();return baseUrl+relUrl},this.setAreaBroker=function(areaBroker){this._areaBroker=areaBroker},this.getAreaBroker=function(){if(this._areaBroker)return this._areaBroker},this.getItemCreator=function(){return this.getOption("itemCreator")}};return{build:function build(renderersLocations,name,defaultOptions){var NewRenderer=function(){var options=_.isPlainObject(arguments[0])?arguments[0]:{};Renderer.apply(this),this.register(renderersLocations),this.name=name||"",this.setOptions(_.defaults(options,defaultOptions||{}))};return NewRenderer.prototype=Renderer.prototype,NewRenderer}}}),define("util/url",["lodash","context"],function(_,context){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}_=_&&_.hasOwnProperty("default")?_["default"]:_,context=context&&context.hasOwnProperty("default")?context["default"]:context;var parsers={absolute:/^(?:[a-z]+:)?\/\//i,base64:/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/,query:/(?:^|&)([^&=]*)=?([^&]*)/g,url:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/};return{parse:function(url){var keys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","queryString","hash"],i=keys.length,parsed=Object.create({toString:function(){return this.source}}),matches;if(parsed.base64=parsers.base64.test(url),parsed.base64)parsed.source=url;else{for(matches=parsers.url.exec(url);i--;)parsed[keys[i]]=matches[i]||"";parsed.query={},parsed.queryString.replace(parsers.query,function($0,$1,$2){$1&&(parsed.query[$1]=$2)})}return parsed},isAbsolute:function(url){return"object"===_typeof(url)&&url.hasOwnProperty("source")?url.source!==url.relative:"string"==typeof url?parsers.absolute.test(url):void 0},isRelative:function(url){var absolute=this.isAbsolute(url);if("boolean"==typeof absolute)return!absolute},isBase64:function(url){return"object"===_typeof(url)&&url.hasOwnProperty("source")?url.base64:"string"==typeof url?parsers.base64.test(url):void 0},encodeAsXmlAttr:function(uri){return /[<>&']+/.test(uri)?encodeURIComponent(uri):uri},build:function(path,params){var queryString="",url,hasQueryString;return path&&(_.isString(path)&&(url=path),_.isArray(path)&&(url="",_.forEach(path,function(chunk){url+=/\/$/.test(url)&&/^\//.test(chunk)?chunk.substr(1):""===url||/\/$/.test(url)||/^\//.test(chunk)?chunk:"/"+chunk})),_.isPlainObject(params)&&(hasQueryString=-1<url.indexOf("?"),queryString=_.reduce(params,function(acc,value,key){return(!_.isEmpty(acc)||hasQueryString)&&(acc+="&"),"object"!==_typeof(value)||_.isArray(value)?acc+=encodeURIComponent(key)+"="+encodeURIComponent(value):_.forOwn(value,function(parameterValue,parameterName){acc+=encodeURIComponent(key)+"["+encodeURIComponent(parameterName)+"]="+encodeURIComponent(parameterValue)+"&"}),acc},queryString),!_.isEmpty(queryString)&&(!hasQueryString&&(url+="?"),url+=queryString))),url},route:function(action,controller,extension,params,rootUrl){var routeParts=[extension,controller,action];if(_.some(routeParts,function(value){return _.isEmpty(value)||!_.isString(value)}))throw new TypeError("All parts are required to build an URL");return rootUrl=rootUrl||context&&context.root_url,this.build([rootUrl].concat(routeParts),params)}}}),define("taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy",["taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/portableElementRegistry/icRegistry"],function(ciRegistry,icRegistry){'use strict';function getBaseUrlByIdentifier(typeIdentifier){return ciRegistry.get(typeIdentifier)?ciRegistry.getBaseUrl(typeIdentifier):icRegistry.get(typeIdentifier)?icRegistry.getBaseUrl(typeIdentifier):typeIdentifier}return{name:"portableElementLocation",handle:function(url){if(url.file===url.path)return getBaseUrlByIdentifier(url.file);return url.source===url.relative?url.relative.replace(/^(\.\/)?([a-z_0-9]+)\/(.*)/i,function(fullmatch,$1,typeIdentifier,relPath){var runtimeLocation=getBaseUrlByIdentifier(typeIdentifier);return runtimeLocation?runtimeLocation+"/"+relPath:fullmatch}):void 0}}}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","context","ui/themes","taoItems/assets/manager","taoItems/assets/strategies","module","taoQtiItem/portableElementRegistry/assetManager/portableAssetStrategy"],function(_,context,themes,assetManagerFactory,assetStrategies,module,portableAssetStrategy){'use strict';var itemThemes=themes.get("items"),moduleConfig=module.config(),assetManager=assetManagerFactory([{name:"theme",handle:function(url){if(itemThemes&&url.path&&(url.path===itemThemes.base||_.contains(_.pluck(itemThemes.available,"path"),url.path)))return context.root_url+url.toString()}},assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.itemCssNoCache,assetStrategies.baseUrl,portableAssetStrategy],{baseUrl:""});return{name:"commonRenderer",locations:{assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,_tooltip:"taoQtiItem/qtiCommonRenderer/renderers/Tooltip",stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",outcomeDeclaration:!1,responseDeclaration:!1,responseProcessing:!1,img:"taoQtiItem/qtiCommonRenderer/renderers/Img",math:"taoQtiItem/qtiCommonRenderer/renderers/Math",object:"taoQtiItem/qtiCommonRenderer/renderers/Object",table:"taoQtiItem/qtiCommonRenderer/renderers/Table",printedVariable:"taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",hotspotChoice:!1,gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",associableHotspot:!1,customInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",infoControl:"taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiCommonRenderer/renderers/Include",endAttemptInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction"},options:{assetManager:assetManager,themes:itemThemes,enableDragAndDrop:{associate:!!moduleConfig.associateDragAndDrop,gapMatch:!!moduleConfig.gapMatchDragAndDrop,graphicGapMatch:!!moduleConfig.graphicGapMatchDragAndDrop,order:!!moduleConfig.orderDragAndDrop},messages:moduleConfig.messages}}}),define("taoQtiItem/qtiCreator/renderers/config",["lodash","context","taoQtiItem/qtiCommonRenderer/renderers/config","taoItems/assets/manager","taoItems/assets/strategies"],function(_,context,commonRenderConfig,assetManagerFactory,assetStrategies){'use strict';var assetManager=assetManagerFactory([assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl],{baseUrl:""}),locations=_.defaults({_container:"taoQtiItem/qtiCreator/renderers/Container",_tooltip:"taoQtiItem/qtiCreator/renderers/Tooltip",assessmentItem:"taoQtiItem/qtiCreator/renderers/Item",rubricBlock:"taoQtiItem/qtiCreator/renderers/RubricBlock",img:"taoQtiItem/qtiCreator/renderers/Img",math:"taoQtiItem/qtiCreator/renderers/Math",object:"taoQtiItem/qtiCreator/renderers/Object",table:"taoQtiItem/qtiCreator/renderers/Table",modalFeedback:"taoQtiItem/qtiCreator/renderers/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",matchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",associateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",mediaInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",sliderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",gapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GapMatchInteraction",hottextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HottextInteraction",customInteraction:"taoQtiItem/qtiCreator/renderers/interactions/PortableCustomInteraction",endAttemptInteraction:"taoQtiItem/qtiCreator/renderers/interactions/EndAttemptInteraction",infoControl:"taoQtiItem/qtiCreator/renderers/PortableInfoControl",include:"taoQtiItem/qtiCreator/renderers/Include",gap:"taoQtiItem/qtiCreator/renderers/choices/Gap",gapText:"taoQtiItem/qtiCreator/renderers/choices/GapText",hottext:"taoQtiItem/qtiCreator/renderers/choices/Hottext",printedVariable:"taoQtiItem/qtiCreator/renderers/PrintedVariable"},commonRenderConfig.locations);return{name:"creatorRenderer",locations:locations,options:{assetManager:assetManager}}}),define("taoQtiItem/qtiCreator/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCreator/renderers/config"],function(Renderer,config){'use strict';return Renderer.build(config.locations,config.name,config.options)}),define("util/dom",["jquery"],function($){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$;return{contains:function(elt){return elt instanceof $&&(elt=elt[0]),$.contains(document,elt)}}}),define("taoQtiItem/qtiCreator/helper/creatorRenderer",["jquery","lodash","taoQtiItem/qtiCreator/renderers/Renderer","taoItems/assets/manager","taoItems/assets/strategies","util/dom"],function($,_,Renderer,assetManagerFactory,assetStrategies,dom){"use strict";var _creatorRenderer=null,_configurableInteractions=["endAttempt"],_extractInteractionsConfig=function(config){var ret={};return config&&config.properties&&_.each(_configurableInteractions,function(interactionName){config.properties[interactionName]&&(ret[interactionName]=config.properties[interactionName])}),ret},get=function(reset,config,areaBroker){var $bodyEltForm;return config=config||{},config.properties=config.properties||{},(!_creatorRenderer||reset)&&($bodyEltForm=_creatorRenderer?_creatorRenderer.getOption("bodyElementOptionForm"):null,(reset||!$bodyEltForm||!$bodyEltForm.length||!dom.contains($bodyEltForm))&&(_creatorRenderer=new Renderer({lang:"",uri:"",shuffleChoices:!1,itemOptionForm:$("#item-editor-item-property-bar .panel"),interactionOptionForm:$("#item-editor-interaction-property-bar .panel"),choiceOptionForm:$("#item-editor-choice-property-bar .panel"),responseOptionForm:$("#item-editor-response-property-bar .panel"),bodyElementOptionForm:areaBroker.getElementPropertyPanelArea(),textOptionForm:$("#item-editor-text-property-bar .panel"),modalFeedbackOptionForm:$("#item-editor-modal-feedback-property-bar .panel"),mediaManager:{appendContainer:"#mediaManager",browseUrl:config.properties.getFilesUrl,uploadUrl:config.properties.fileUploadUrl,deleteUrl:config.properties.fileDeleteUrl,downloadUrl:config.properties.fileDownloadUrl,fileExistsUrl:config.properties.fileExistsUrl,mediaSourcesUrl:config.properties.mediaSourcesUrl},interactions:_extractInteractionsConfig(config),qtiCreatorContext:config.qtiCreatorContext}),_creatorRenderer.getAssetManager().setData({baseUrl:config.properties.baseUrl||""}),_creatorRenderer.setAreaBroker(areaBroker),_.assign(_creatorRenderer,{getCreatorContext:function(){return this.getOption("qtiCreatorContext")}}))),_creatorRenderer};return{get:get,setOption:function setOption(name,value){return get().setOption(name,value)},setOptions:function setOptions(options){return get().setOptions(options)},load:function load(qtiClasses,done){return get().load(function(){_.isFunction(done)&&done.apply(this,arguments)},qtiClasses)}}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config"],function(Renderer,config){'use strict';return Renderer.build(config.locations,config.name,config.options)}),define("taoQtiItem/qtiCommonRenderer/helpers/container",["lodash","jquery","taoQtiItem/qtiItem/core/Element"],function(_,$,Element){'use strict';var _containers={},_$containerContext=$(),_getSelector=function(element){var serial=element.getSerial(),selector="[data-serial="+serial+"]";return Element.isA(element,"choice")?selector=".qti-choice"+selector:Element.isA(element,"interaction")&&(selector=".qti-interaction"+selector),selector};return{setContext:function setContext($scope){_$containerContext=$scope},get:function get(element,$scope){var serial=element.getSerial();return $scope instanceof $&&$scope.length?$scope.find(_getSelector(element)):_$containerContext instanceof $&&_$containerContext.length?_$containerContext.find(_getSelector(element)):(_containers[serial]&&_containers[serial].length||(_containers[serial]=$(_getSelector(element))),_containers[serial])},reset:function reset(element){element instanceof Element&&_containers[element.getSerial()]&&(_containers=_.omit(_containers,element.getSerial()))},clear:function(){_containers={},_$containerContext=$()},trigger:function trigger(eventType,element,data){eventType&&(data&&!_.isArray(data)&&(data=[data]),this.get(element).trigger(eventType,data))},triggerResponseChangeEvent:function triggerResponseChangeEvent(interaction,extraData){this.trigger("responseChange",interaction,[{interaction:interaction,response:interaction.getResponse()},extraData])},targetBlank:function targetBlank($container){$container.on("click","a",function(e){e.preventDefault();var href=$(this).attr("href");href&&href.match(/^http/i)&&window.open(href,"_blank")})}}}),define("taoQtiItem/qtiCreator/helper/commonRenderer",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCommonRenderer/helpers/container"],function(_,Renderer,containerHelper){"use strict";var _$previousContext=null,commonRenderer={render:function render(item,$container){return commonRenderer.setContext($container),_renderer.load(function(){$container.append(item.render(this)),item.postRender({},"",this)},item.getUsedClasses())},get:function get(reset,config){return(!_renderer||reset)&&(_renderer=new Renderer({shuffleChoices:!0}),config&&_renderer.getAssetManager().setData({baseUrl:config.properties.baseUrl||""})),_renderer},getOption:function getOption(name){return _renderer.getOption(name)},setOption:function setOption(name,value){return _renderer.setOption(name,value)},setOptions:function setOptions(options){return _renderer.setOptions(options)},setContext:function setContext($context){return _$previousContext=$context,containerHelper.setContext($context)},restoreContext:function restoreContext(){containerHelper.setContext(_$previousContext),_$previousContext=null},load:function load(qtiClasses,done){var renderer=_renderer||this.get();return renderer.load(function(){_.isFunction(done)&&done.apply(this,arguments)},qtiClasses)}},_renderer;return commonRenderer}),define("taoQtiItem/qtiItem/helper/simpleParser",["lodash","jquery","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/core/Loader"],function(_,$,util,Loader){"use strict";function _getElementSelector(qtiClass,ns){return ns?ns+"\\:"+qtiClass+","+qtiClass:qtiClass}function getQtiClassFromXmlDom($node){var qtiClass=$node.prop("tagName").toLowerCase();return qtiClass=qtiClass.replace(/.*:/,""),_qtiClassNames[qtiClass]?_qtiClassNames[qtiClass]:qtiClass}function buildElement($elt){var qtiClass=getQtiClassFromXmlDom($elt),elt={qtiClass:qtiClass,serial:util.buildSerial(qtiClass+"_"),attributes:{}};return $.each($elt[0].attributes,function(){var attrName;this.specified&&(attrName=_qtiAttributesNames[this.name]||this.name,elt.attributes[attrName]=this.value)}),elt}function buildMath($elt,options){var elt=buildElement($elt);return elt.annotations={},$elt.find(_getElementSelector("annotation",options.ns.math)).each(function(){var $annotation=$(this),encoding=$annotation.attr("encoding");encoding&&(elt.annotations[encoding]=_.unescape($annotation.html())),$annotation.remove()}),elt.mathML=$elt.html(),elt.ns={name:"m",uri:"http://www.w3.org/1998/Math/MathML"},elt}function buildTooltip(targetHtml,contentId,contentHtml){return{elements:{},qtiClass:"_tooltip",serial:util.buildSerial("_tooltip_"),attributes:{"aria-describedby":contentId},content:contentHtml,body:{elements:{},serial:util.buildSerial("container"),body:targetHtml}}}function parseContainer($container,options){var ret={serial:util.buildSerial("_container_"),body:"",elements:{}};return _.each(_parsableElements,function(qtiClass){$container.find(qtiClass).each(function(){var $qtiElement=$(this),element=buildElement($qtiElement,options);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))})}),$container.find(_getElementSelector("math",options.ns.math)).each(function(){var $qtiElement=$(this),element=buildMath($qtiElement,options);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))}),$container.find(_getElementSelector("include",options.ns.include)).each(function(){var $qtiElement=$(this),element=buildElement($qtiElement,options);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))}),$container.find("[data-role=\"tooltip-target\"]").each(function(){var $target=$(this),contentId=$target.attr("aria-describedBy"),element,$content,contentHtml;contentId&&($content=$container.find("#"+contentId),$content.length&&(contentHtml=$content.html(),element=buildTooltip($target.html(),contentId,contentHtml),ret.elements[element.serial]=element,$target.replaceWith(_placeholder(element)),$content.remove()))}),ret.body=$container.html(),ret}function _placeholder(element){return"{{"+element.serial+"}}"}var _parsableElements=["img","object","printedVariable"],_qtiClassNames={rubricblock:"rubricBlock",printedvariable:"printedVariable"},_qtiAttributesNames={powerform:"powerForm",mappingindicator:"mappingIndicator"},_defaultOptions={ns:{math:"",include:"xi"},loaded:null,model:null},parser;return parser={parse:function parse(xmlStr,opts){var options=_.merge(_.clone(_defaultOptions),opts||{}),$container=$(xmlStr),element=buildElement($container,options),data=parseContainer($container,options),loader;return _.isUndefined(data.body)||(element.body=data),_.isFunction(options.loaded)&&options.model&&(loader=new Loader().setClassesLocation(options.model),loader.loadAndBuildElement(element,options.loaded)),element}},parser}),define("taoQtiItem/qtiItem/helper/xincludeLoader",["jquery","lodash","taoQtiItem/qtiItem/helper/simpleParser","taoQtiItem/qtiItem/core/Loader"],function($,_,simpleParser,Loader){return{load:function(xinclude,baseUrl,callback){var href=xinclude.attr("href");href&&baseUrl&&require(["text!"+baseUrl+href],function(stimulusXml){var $wrapper=$("<div>").html(stimulusXml),$sampleXMLrootNode=$wrapper.children(),$stimulus=$("<include>").append($sampleXMLrootNode),data=simpleParser.parse($stimulus,{ns:{math:"m"}});new Loader().loadElement(xinclude,data,function(){if(_.isFunction(callback)){var loadedClasses=this.getLoadedClasses();loadedClasses.push("_container"),callback(xinclude,data,loadedClasses)}})},function(){callback(xinclude,!1,[])})}}}),define("taoQtiItem/qtiCreator/helper/xincludeRenderer",["lodash","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiItem/helper/xincludeLoader"],function(_,commonRenderer,xincludeLoader){'use strict';return{render:function(xincludeWidget,baseUrl,newHref){var xinclude=xincludeWidget.element;newHref&&xinclude.attr("href",newHref),xincludeLoader.load(xinclude,baseUrl,function(xi,data,loadedClasses){data?commonRenderer.get().load(function(){_.each(xinclude.getComposingElements(),function(elt){elt.setRenderer(commonRenderer.get())}),xincludeWidget.refresh()},loadedClasses):xinclude.removeAttr("href")})}}}),define("ui/hider",["jquery","core/eventifier"],function($){'use strict';function jqWrap(element){return element instanceof $?element:$(element)}$=$&&$.hasOwnProperty("default")?$["default"]:$;return{show:function(element){return jqWrap(element).removeClass("hidden")},hide:function(element){return jqWrap(element).addClass("hidden")},toggle:function(element,state){return"undefined"!=typeof state&&(state=!state),jqWrap(element).toggleClass("hidden",state)},isHidden:function(element,real){var $elt=jqWrap(element);return real?$elt.hasClass("hidden")||"none"===$elt.css("display")||"hidden"===$elt.css("visibility"):$elt.hasClass("hidden")}}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionButton",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    data-sub-group=\"",(helper=helpers.subGroup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.subGroup,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n",buffer}function program5(depth0,data){var buffer="",stack1,helper;return buffer+="\n    title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n",buffer}function program7(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <span class=\"icon ",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n    ",buffer}function program9(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <img class=\"icon\" src=\"",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<li\n",stack1=helpers["if"].call(depth0,depth0&&depth0.subGroup,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    data-qti-class=\"",(helper=helpers.qtiClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.qtiClass,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.disabled,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,function(){return"\n    class=\"disabled\"\n    title=\"element available in the final release\"\n"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.iconFont,{hash:{},inverse:self.program(9,program9,data),fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    \n    <div class=\"truncate\">",(helper=helpers.short)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.short,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\n</li>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionGroup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<section class=\"tool-group\" id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <h2>",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h2>\n    <div class=\"panel clearfix\">\n        <ul class=\"tool-list plain\"></ul>\n    </div>\n</section>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        ",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    </div>\n</div>",buffer})}),define("core/dataattrhandler",["jquery","lodash"],function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var defaults={container:!1,listenerEvent:"click",useTarget:!0,bubbled:!1},letDefaultOn=[":radio",":checkbox"],shouldPreventDefault=function($elt){return!$elt.is(letDefaultOn.join(","))},DataAttrHandler=function(attrName,options){var self=this;this.options=_.defaults(options,defaults);var selector="[data-"+attrName+"]";return _.has(this.options,"namespace")&&_.isString(this.options.namespace)?void(this.options.container&&this.options.container.selector&&(selector=this.options.container.selector+" "+selector),this.options.inner&&(selector+=" "+this.options.inner),$(document).off(this.options.listenerEvent,selector).on(this.options.listenerEvent,selector,function(e){var $elt=$(e.target);if(!0===self.options.bubbled||$elt.is(selector)){var $target,$outer;void 0===$elt.data(attrName)&&(self.options.inner||self.options.bubbled)&&($outer=$elt,$elt=$elt.parents("[data-"+attrName+"]")),$target=!0===self.options.useTarget?DataAttrHandler.getTarget(attrName,$elt):self.options.inner?$outer:void 0,$elt.data(self.options.namespace)||("function"==typeof self.createPlugin&&self.createPlugin($elt,$target),$elt.is(":radio")&&$elt.attr("name")&&$(":radio[name=\""+$elt.attr("name")+"\"]").not($elt).on(self.options.listenerEvent,function(e){"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()})),"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()}})):$.error("The plugin data namespace option is required")};return DataAttrHandler.prototype.init=function(cb){return this.createPlugin=cb,this},DataAttrHandler.prototype.trigger=function(cb){return this.callPluginMethod=cb,this},DataAttrHandler.getTarget=function(attrName,$elt){var relativeRegex=/^(\+|>|~|:parent|<)/,$target=[],targetSelector=$elt.attr("data-"+attrName)||$elt.attr("href")||$elt.attr("attrName");if(!_.isEmpty(targetSelector)){var matches=relativeRegex.exec(targetSelector);if(null!==matches){var selector=targetSelector.replace(relativeRegex,"");$target=":parent"===matches[0]||"<"===matches[0]?$elt.parents(selector):"~"===matches[0]?$elt.siblings(selector):"+"===matches[0]?$elt.next(selector):$(selector,$elt)}else $target=$(targetSelector)}return $target},DataAttrHandler}),define("ui/tooltip",["jquery","lodash","core/dataattrhandler","lib/popper/tooltip","handlebars","i18n","lib/dompurify/purify"],function($$1,_,DataAttrHandler,Tooltip,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function defaultTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,DataAttrHandler=DataAttrHandler&&DataAttrHandler.hasOwnProperty("default")?DataAttrHandler["default"]:DataAttrHandler,Tooltip=Tooltip&&Tooltip.hasOwnProperty("default")?Tooltip["default"]:Tooltip,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"tooltip ",(helper=helpers["class"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["class"],stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" role=\"tooltip\">\n    <div class=\"tooltip-arrow\"></div>\n    <div class=\"tooltip-inner tooltip-body\"></div>\n</div>",buffer}),themes=["dark","default","info","warning","error","success","danger"],themesMap={default:defaultTpl({class:"tooltip-plain"}),dark:defaultTpl({class:"tooltip-dark"}),error:defaultTpl({class:"tooltip-red"}),success:defaultTpl({class:"tooltip-green"}),info:defaultTpl({class:"tooltip-blue"}),warning:defaultTpl({class:"tooltip-orange"}),danger:defaultTpl({class:"tooltip-danger"})},defaultOptions={template:themesMap.default,html:!0,trigger:"hover focus",popperOptions:{positionFixed:!0,placement:"auto",modifiers:{preventOverflow:{escapeWithReference:!1,enabled:!0,padding:6,boundariesElement:"viewport"}}}},checkHTMLInstance=function(el){return el instanceof Element||el instanceof HTMLDocument||el.jquery};return{lookup:function($container){var setTooltip=function(el,inst){$$1(el).data("$tooltip")&&($$1(el).data("$tooltip").dispose(),$$1(el).removeData("$tooltip")),$$1(el).data("$tooltip",inst)},themeName;if($container&&checkHTMLInstance($container))$$1("[data-tooltip]",$container).each(function(){var $content=DataAttrHandler.getTarget("tooltip",$$1(this)),predefinedOptions=_.cloneDeep(defaultOptions),opt;themeName=_.contains(themes,$$1(this).data("tooltip-theme"))?$$1(this).data("tooltip-theme"):"default",opt={template:themesMap[themeName]},opt=$content.length?_.merge(predefinedOptions,opt,{title:$content[0].cloneNode(!0)}):_.merge(predefinedOptions,opt),setTooltip(this,new Tooltip(this,opt))});else throw new TypeError("Tooltip should be connected to DOM Element")},create:function(el,message,options){var predefinedOptions=_.cloneDeep(defaultOptions),calculatedOptions,themeName,template;if(calculatedOptions=options?_.merge(predefinedOptions,options):predefinedOptions,themeName=_.contains(themes,calculatedOptions.theme)?calculatedOptions.theme:"default",template={template:themesMap[themeName]},!el&&!checkHTMLInstance(el))throw new TypeError("Tooltip should be connected to DOM Element");if(!message&&!(checkHTMLInstance(el)||"string"==typeof message))throw new TypeError("Tooltip should have messsage to show");return new Tooltip(el,_.merge(calculatedOptions,template,{title:message}))},error:function(element,message,options){var theme={theme:"error"};return this.create(element,message,options?_.merge(theme,options):theme)},success:function(element,message,options){var theme={theme:"success"};return this.create(element,message,options?_.merge(theme,options):theme)},info:function(element,message,options){var theme={theme:"info"};return this.create(element,message,options?_.merge(theme,options):theme)},warning:function(element,message,options){var theme={theme:"warning"};return this.create(element,message,options?_.merge(theme,options):theme)},danger:function(element,message,options){var theme={theme:"danger"};return this.create(element,message,options?_.merge(theme,options):theme)}}}),define("taoQtiItem/qtiCreator/editor/interactionsToolbar",["jquery","lodash","i18n","ui/hider","tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionButton","tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionGroup","tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip","ui/tooltip"],function($,_,__,hider,insertInteractionTpl,insertSectionTpl,tooltipTpl,tooltip){'use strict';function getGroupId(groupLabel){return groupLabel.replace(/\W+/g,"-").toLowerCase()}function getGroupSectionId(groupLabel){return"sidebar-left-section-"+getGroupId(groupLabel)}function addGroup($sidebar,groupLabel){var groupId=getGroupSectionId(groupLabel),$section=$(insertSectionTpl({id:groupId,label:groupLabel}));return $sidebar.append($section),$section}function getGroup($sidebar,groupLabel){var groupId=getGroupSectionId(groupLabel);return $sidebar.find("#"+groupId)}function isReady($sidebar){return!!$sidebar.data("interaction-toolbar-ready")}function exists($sidebar,interactionClass){return!!$sidebar.find("li[data-qti-class=\""+interactionClass+"\"]").length}function add($sidebar,interactionAuthoringData){if(exists($sidebar,interactionAuthoringData.qtiClass))throw"the interaction is already in the sidebar";var groupLabel=interactionAuthoringData.tags[0]||"",subGroupId=interactionAuthoringData.tags[1],$group=getGroup($sidebar,groupLabel),tplData={qtiClass:interactionAuthoringData.qtiClass,disabled:!!interactionAuthoringData.disabled,title:interactionAuthoringData.description,iconFont:/^icon-/.test(interactionAuthoringData.icon),icon:interactionAuthoringData.icon,short:interactionAuthoringData.short,dev:!1};subGroupId&&_subgroups[subGroupId]&&(tplData.subGroup=subGroupId),$group.length||($group=addGroup($sidebar,groupLabel)),subGroupId&&_subgroups[subGroupId]&&(tplData.subGroup=subGroupId),$group.length||($group=addGroup($sidebar,groupLabel));var $interaction=$(insertInteractionTpl(tplData));return $group.find(".tool-list").append($interaction),$interaction}function buildSubGroups($sidebar){$sidebar.find("[data-sub-group]").each(function(){var $element=$(this),$section=$element.parents("section"),subGroup=$element.data("sub-group"),$subGroupPanel,$subGroupList,$cover;subGroup&&($subGroupPanel=$section.find(".sub-group."+subGroup),$subGroupList=$subGroupPanel.find(".tool-list"),!$subGroupPanel.length&&($subGroupPanel=$("<div>",{class:"panel clearfix sub-group "+subGroup}),$subGroupList=$("<ul>",{class:"tool-list plain clearfix"}),$subGroupPanel.append($subGroupList),$section.append($subGroupPanel),$cover=$("<div>",{class:"sub-group-cover blocking"}),$subGroupPanel.append($cover),$subGroupPanel.data("cover",$cover)),$subGroupList.append($element))}),addInlineInteractionTooltip()}function addInlineInteractionTooltip(){var $inlineInteractionsPanel=$("#sidebar-left-section-inline-interactions .inline-interactions"),$tooltip=$(tooltipTpl({message:__("Inline interactions need to be inserted into a text block.")})),timer;$inlineInteractionsPanel.append($tooltip),tooltip.lookup($inlineInteractionsPanel),$tooltip.css({position:"absolute",zIndex:11,top:0,right:10}),$inlineInteractionsPanel.on("mouseenter",".sub-group-cover",function(){timer=setTimeout(function(){$tooltip.find("[data-tooltip]").data("$tooltip").show()},300)}).on("mouseleave",".sub-group-cover",function(){$tooltip.find("[data-tooltip]").data("$tooltip").hide(),clearTimeout(timer)})}var _subgroups={"inline-interactions":"Inline Interactions"},_events={interactiontoolbarready:"interactiontoolbarready.qti-widget"};return{create:function($sidebar,interactions){_.each(interactions,function(interactionAuthoringData){add($sidebar,interactionAuthoringData)}),buildSubGroups($sidebar),$sidebar.data("interaction-toolbar-ready",!0),$sidebar.trigger(_events.interactiontoolbarready)},add:add,exists:exists,addGroup:addGroup,getGroupId:getGroupId,getGroupSectionId:getGroupSectionId,getGroup:getGroup,isReady:isReady,whenReady:function($sidebar){return new Promise(function(resolve){isReady($sidebar)?resolve():$sidebar.on(_events.interactiontoolbarready,function(){resolve()})})},remove:function($sidebar,interactionClass){$sidebar.find("li[data-qti-class=\""+interactionClass+"\"]").remove()},disable:function($sidebar,interactionClass){hider.hide($sidebar.find("li[data-qti-class=\""+interactionClass+"\"]"))},enable:function($sidebar,interactionClass){hider.show($sidebar.find("li[data-qti-class=\""+interactionClass+"\"]"))},getCustomInteractionTag:function getCustomInteractionTag(){return"Custom Interactions"}}}),define("taoQtiItem/qtiCreator/helper/panel",["jquery","lodash","taoQtiItem/qtiItem/core/Element"],function($,_,Element){"use strict";var _getItemContainer=function(){return $("#item-editor-panel")},showPanel=function($panel,$fold){$panel.show(),openSections($panel.children("section")),$fold&&$fold.length&&closeSections($fold.children("section"))},toggleInlineInteractionGroup=function(){var $itemContainer=_getItemContainer();$itemContainer.find(".widget-textBlock").length?enableSubGroup("inline-interactions"):disableSubGroup("inline-interactions")},heading="h2",section="section",panel="hr, .panel",closed="closed",ns="accordion",_toggleSections=function(sections,preserveOthers,state){sections.each(function(){$(this).find(heading).trigger("click",{preserveOthers:preserveOthers,forceState:state})})},closeSections=function(sections,preserveOthers){_toggleSections(sections,!!preserveOthers,"close")},openSections=function(sections,preserveOthers){_toggleSections(sections,!!preserveOthers,"open")},_toggleSubGroup=function(subGroup,state){if(subGroup=$("."+subGroup),subGroup.length){var fn="disable"===state?"addClass":"removeClass";subGroup.data("cover")[fn]("blocking")}},enableSubGroup=function(subGroup){_toggleSubGroup(subGroup,"enable")},disableSubGroup=function(subGroup){_toggleSubGroup(subGroup,"disable")};return{initFormVisibilityListener:function initFormVisibilityListener(){$(document).off(".panel");var $itemContainer=_getItemContainer(),_staticElements={_tooltip:"Tooltip",img:"Image",object:"Media",rubricBlock:"Rubric Block",math:"Math",table:"Table",include:"Shared Stimulus",infoControl:"Student Tool"},$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar"),$formResponsePanel=$("#item-editor-response-property-bar"),$formItemPanel=$("#item-editor-item-property-bar"),$formBodyElementPanel=$("#item-editor-body-element-property-bar"),$formTextBlockPanel=$("#item-editor-text-property-bar"),$formModalFeedbackPanel=$("#item-editor-modal-feedback-property-bar"),$formStylePanel=$("#item-style-editor-bar"),$appearanceToggler=$("#appearance-trigger"),$menuLabel=$appearanceToggler.find(".menu-label"),$itemIcon=$appearanceToggler.find(".icon-item"),$styleIcon=$appearanceToggler.find(".icon-style"),_toggleAppearanceEditor=function(active){active?($appearanceToggler.addClass("active"),$formStylePanel.show(),$formItemPanel.hide(),$itemContainer.trigger("styleedit"),showPanel($formStylePanel),$menuLabel.text($menuLabel.data("item")),$itemIcon.show(),$styleIcon.hide()):($appearanceToggler.removeClass("active"),$formStylePanel.hide(),showPanel($formItemPanel),$menuLabel.text($menuLabel.data("style")),$itemIcon.hide(),$styleIcon.show())};$appearanceToggler.on("click",function(){$appearanceToggler.hasClass("active")?_toggleAppearanceEditor(!1):_toggleAppearanceEditor(!0)}),_.delay(function(){showPanel($formItemPanel)},200),$(document).on("afterStateInit.qti-widget.panel",function(e,element,state){switch(state.name){case"active":_toggleAppearanceEditor(!1),Element.isA(element,"assessmentItem")||$formItemPanel.hide();var label=_staticElements[element.qtiClass];label?($formBodyElementPanel.find("h2").html(label+" Properties"),showPanel($formBodyElementPanel)):"_container"===element.qtiClass&&showPanel($formTextBlockPanel),"modalFeedback"===element.qtiClass&&(showPanel($formModalFeedbackPanel),$formResponsePanel.hide());break;case"question":showPanel($formInteractionPanel);break;case"answer":showPanel($formResponsePanel);break;case"choice":showPanel($formChoicePanel,$formInteractionPanel);break;case"sleep":_staticElements[element.qtiClass]?$formBodyElementPanel.hide():"_container"===element.qtiClass&&$formTextBlockPanel.hide(),Element.isA(element,"choice")||$itemContainer.find(".widget-box.edit-active").length||showPanel($formItemPanel);}}).on("afterStateExit.qti-widget.panel",function(e,element,state){switch(state.name){case"active":"modalFeedback"===element.qtiClass&&(showPanel($formResponsePanel),$formModalFeedbackPanel.hide());break;case"question":element.is("interaction")&&($formChoicePanel.hide(),$formInteractionPanel.hide());break;case"choice":$formChoicePanel.hide(),showPanel($formInteractionPanel);break;case"answer":$formResponsePanel.hide();}}).on("elementCreated.qti-widget.panel",function(e,data){"_container"===data.element.qtiClass&&enableSubGroup("inline-interactions")}).on("deleted.qti-widget.panel",function(e,data){"_container"===data.element.qtiClass&&toggleInlineInteractionGroup()})},showPanel:showPanel,toggleInlineInteractionGroup:toggleInlineInteractionGroup,initSidebarAccordion:function initSidebarAccordion($sidebar){var $sections=$sidebar.find(section),$allPanels=$sidebar.children(panel).hide(),$allTriggers=$sidebar.find(heading);return!(0!==$allTriggers.length)||void($allTriggers.each(function(){var $heading=$(this),$section=$heading.parents(section),$panel=$section.children(panel),$closer=$("<span>",{class:"icon-up"}),$opener=$("<span>",{class:"icon-down"}),action=$panel.is(":visible")?"open":"close";($heading.append($closer).append($opener).addClass(closed),!$heading.hasClass("_accordion"))&&($heading.addClass("_accordion"),$panel.on("panelclose."+ns+" panelopen."+ns,function(e,args){var fn="panelclose"===e.type?"add":"remove";args.heading[fn+"Class"](closed)}),$panel.trigger("panel"+action+"."+ns,{heading:$heading}))}),$sections.each(function(){$(this).find(heading).on("click",function(e,args){var $heading=$(this),$panel=$heading.parents(section).children(panel),preserveOthers=!!(args&&args.preserveOthers),forceState=!!(args&&args.forceState)&&args.forceState,action,classFn;forceState&&(classFn="open"===forceState?"addClass":"removeClass",$heading[classFn](closed)),action=$heading.hasClass(closed)?"open":"close",!1,$panel.trigger("panel"+action+"."+ns,{heading:$heading})[{close:"hide",open:"fadeIn"}[action]]()})}))},openSections:openSections,closeSections:closeSections,enableSubGroup:enableSubGroup,disableSubGroup:disableSubGroup}}),define("taoQtiItem/qtiCreator/editor/interactionsPanel",["lodash","taoQtiItem/qtiCreator/editor/interactionsToolbar","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/portableElementRegistry/ciRegistry"],function(_,interactionsToolbar,panel,qtiElements,ciRegistry){'use strict';return function($container){var interactions=qtiElements.getAvailableAuthoringElements();_.forIn(ciRegistry.getAllVersions(),function(versions,typeId){var data=ciRegistry.getAuthoringData(typeId,{enabledOnly:!0});data&&data.tags&&data.tags[0]===interactionsToolbar.getCustomInteractionTag()&&(interactions[data.qtiClass]=data)}),interactionsToolbar.create($container,interactions),panel.initSidebarAccordion($container),panel.closeSections($container.find("section")),panel.openSections($container.find("#sidebar-left-section-common-interactions"),!1),panel.toggleInlineInteractionGroup()}}),define("util/urlParser",["lodash"],function(_){'use strict';function UrlParser(url){var detachedAnchor;this.url=url,detachedAnchor=document.createElement("a"),detachedAnchor.href=url,this.data=_.pick(detachedAnchor,urlParts),this.params=UrlParser.extractParams(this.data.search)}_=_&&_.hasOwnProperty("default")?_["default"]:_;var urlParts=["hash","host","hostname","pathname","port","protocol","search"];return UrlParser.extractParams=function(search){var params={};return search.replace(/^\?/,"").replace(/([^=&]+)=([^&]*)/g,function(m,key,value){params[decodeURIComponent(key)]=decodeURIComponent(value)}),params},UrlParser.prototype.get=function(what){return!!_.contains(urlParts,what)&&this.data[what]},UrlParser.prototype.getParams=function(){return this.params},UrlParser.prototype.setParams=function(params){_.isObject(params)&&(this.params=params)},UrlParser.prototype.addParam=function(key,value){key&&(this.params[key]=value)},UrlParser.prototype.getPaths=function(){return this.data.pathname.replace(/^\/|\/$/g,"").split("/")},UrlParser.prototype.getUrl=function(exclude){var url="";return exclude=exclude||[],this.data&&(this.data.hostname&&!_.contains(exclude,"host")&&(url+=(this.data.protocol?this.data.protocol:"http:")+"//"+this.data.hostname.replace(/\/$/,""),this.data.port&&80!==this.data.port&&"80"!==this.data.port&&"0"!==this.data.port&&(url+=":"+this.data.port)),!/\/$/.test(url)&&!/^\//.test(this.data.pathname)&&(url+="/"),url+=this.data.pathname,this.params&&!_.contains(exclude,"params")&&(url+="?",_.forEach(this.params,function(value,key){url+=encodeURIComponent(key)+"="+encodeURIComponent(value)+"&"}),url=url.substring(0,url.length-1)),this.data.hash&&!_.contains(exclude,"hash")&&(url+=this.data.hash)),url},UrlParser.prototype.getBaseUrl=function(){var baseUrl=this.getUrl(["params","hash"]),paths=this.getPaths(),lastPart=paths[paths.length-1];return 0<paths.length&&/\.[a-z]+$/.test(lastPart)&&(baseUrl=baseUrl.replace(lastPart,"").replace(/\/\/$/,"/")),baseUrl},UrlParser.prototype.sameDomain=function(url){var parsedUrl;if("undefined"==typeof url&&(parsedUrl=new UrlParser(window.location)),"string"==typeof url&&(parsedUrl=new UrlParser(url)),url instanceof UrlParser&&(parsedUrl=url),!(parsedUrl instanceof UrlParser))throw new TypeError("Invalid url format");return"data:"===this.get("protocol")||"data:"===parsedUrl.get("protocol")||this.get("protocol")===parsedUrl.get("protocol")&&this.get("hostname")===parsedUrl.get("hostname")&&this.get("port")===parsedUrl.get("port")},UrlParser.prototype.checkCORS=UrlParser.prototype.sameDomain,UrlParser}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n<li data-css-res=\"",(helper=helpers.path)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.path,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"icon-preview style-sheet-toggler\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n    <span class=\"file-label truncate\" title=\"",(helper=helpers.editLabelTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.editLabelTxt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <input type=\"text\" class=\"style-sheet-label-editor\" value=\"",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"icon-bin\" title=\"",(helper=helpers.deleteTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deleteTxt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"css-delete\"></span>\n    <span class=\"icon-download\" title=\"",(helper=helpers.downloadTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.downloadTxt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"css-download\"></span>\n</li>\n",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers.each.call(depth0,depth0&&depth0.stylesheets,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleEditor",["jquery","lodash","i18n","util/urlParser","core/promise","tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler","jquery.fileDownload"],function($,_,__,UrlParser,Promise,cssTpl){'use strict';var _getUri=function(action){return globalConfig[action+"CssUrl"]},_basename=function(path){return path.substring(path.lastIndexOf("/")+1)},style={},$styleElem=function(){var styleElem=$("#item-editor-user-styles");return styleElem.length?styleElem.empty():(styleElem=$("<style>",{id:"item-editor-user-styles"}),$("head").append(styleElem)),styleElem}(),common={title:__("Disable this stylesheet temporarily"),deleteTxt:__("Remove this stylesheet"),editLabelTxt:__("Edit stylesheet label"),downloadTxt:__("Download this stylesheet"),preparingMessageHtml:__("Preparing CSS, please wait\u2026"),failMessageHtml:__("There was a problem downloading your CSS, please try again."),isInValidLocalTxt:__("This stylesheet has not been found on the server. you may want to delete this reference")},customStylesheet="",erase=function(){return style={},$styleElem.text(""),!1},create=function(dontAppend){var css="",key1,key2,mSelector,mProp;if(_.isEmpty(style))return erase();for(key1 in style)if(style.hasOwnProperty(key1)){for(key2 in css+=key1+"{",style[key1])if(style[key1].hasOwnProperty(key2))if(_.isPlainObject(style[key1][key2]))for(mSelector in style[key1][key2]){for(mProp in css+=key2+"{",style[key1][key2])css+=mProp+":"+style[key1][key2][mSelector]+";";css+="}"}else css+=key2+":"+style[key1][key2]+";";css+="}\n"}return dontAppend||$styleElem.text(css),css},apply=function(selector,property,value){style[selector]=style[selector]||{},value?style[selector][property]=value:(delete style[selector][property],0===_.size(style[selector])&&delete style[selector]),create(),$(document).trigger("stylechange.qti-creator")},verifyInit=function(){if(!itemConfig)throw new Error("Missing itemConfig, did you call styleEditor.init()?");return!0},download=function(uri){verifyInit(),$.fileDownload(_getUri("download"),{preparingMessageHtml:common.preparingMessageHtml,failMessageHtml:common.failMessageHtml,successCallback:function successCallback(){},httpMethod:"POST",data:_.extend({},itemConfig,{stylesheetUri:uri})})},addStylesheet=function(stylesheet){var stylesheets=[],loadStylesheet=function(link,stylesheet,isLocal,isValid){var isInvalidLocal=isLocal&&!isValid,tplData={path:stylesheet.attr("href"),label:stylesheet.attr("title")||fileName,title:common.title,deleteTxt:common.deleteTxt,downloadTxt:common.downloadTxt,editLabelTxt:isInvalidLocal?common.isInValidLocalTxt:common.editLabelTxt};return stylesheets.push(tplData),listEntry=$(cssTpl({stylesheets:stylesheets})),listEntry.data("stylesheetObj",stylesheet),$("#style-sheet-toggler").append(listEntry),isInvalidLocal?(listEntry.addClass("not-available"),void listEntry.find("[data-role=\"css-download\"], .style-sheet-toggler").css("visibility","hidden")):void($styleElem.before(link),setTimeout(function(){var isInit=!1;$(document).trigger("customcssloaded.styleeditor",[style]),$(window).trigger("resize"),currentItem.pendingStylesheetsInit&&(isInit=!0,currentItem.pendingStylesheetsInit--),$(document).trigger("stylechange.qti-creator",[{initializing:isInit}])},isLocal?500:3500))},fileName,link,listEntry,parser;_.isString(stylesheet)&&(stylesheet=currentItem.createStyleSheet(stylesheet)),fileName=_basename(stylesheet.attr("href")),link=function(){var _link=$(stylesheet.render()),_href=_link.attr("href"),_sep=-1<_href.indexOf("?")?"&":"?";return _link.attr("href",_href+_sep+new Date().getTime().toString()),_link}(),parser=new UrlParser(link.attr("href")),parser.checkCORS()?$.when($.ajax(link.attr("href"))).then(function(){loadStylesheet(link,stylesheet,!0,!0)},function(){loadStylesheet(link,stylesheet,!0,!1)}):loadStylesheet(link,stylesheet,!1)},addItemStylesheets=function(){var key,currentStylesheet;for(key in currentItem.pendingStylesheetsInit=_.size(currentItem.stylesheets),currentItem.stylesheets)if(currentItem.stylesheets.hasOwnProperty(key)){if(currentStylesheet=currentItem.stylesheets[key],"tao-user-styles.css"===_basename(currentStylesheet.attr("href"))){customStylesheet=currentStylesheet;continue}addStylesheet(currentItem.stylesheets[key])}customStylesheet||(customStylesheet=currentItem.createStyleSheet("style/custom/tao-user-styles.css"))},removeOrphanedStylesheets=function(){$("link[data-serial]").remove()},getItem=function(){return currentItem},init=function(item,config){var resizerTarget,href;globalConfig=config,currentItem=item,itemConfig={uri:config.uri,lang:config.lang,baseUrl:config.baseUrl},removeOrphanedStylesheets(),addItemStylesheets(),resizerTarget=$("#item-editor-item-resizer").data("target"),href=customStylesheet.attr("href"),currentItem.data("responsive",!0),$.when($.getJSON(_getUri("load"),_.extend({},itemConfig,{stylesheetUri:href}))).then(function(_style){style=_style,create(),style.length&&currentItem.data("responsive",!!(style[resizerTarget]&&style[resizerTarget].width)),$(document).trigger("customcssloaded.styleeditor",[style])})},getStyle=function(){return style},itemConfig,globalConfig,currentItem;return{apply:apply,save:function(){return new Promise(function(resolve,reject){verifyInit(),$.post(_getUri("save"),_.extend({},itemConfig,{cssJson:JSON.stringify(style),stylesheetUri:customStylesheet.attr("href")})).done(resolve).fail(function(xhr,status,err){reject(err)})})},download:download,erase:erase,init:init,create:create,getItem:getItem,getStyle:getStyle,addStylesheet:addStylesheet}}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"feedback-",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" popup\">\n    <span class=\"icon-",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n    ",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+"\" class=\"icon-close close-trigger\"></span>\n</div>",buffer})}),define("core/pluginifier",["jquery","lodash"],function($,_){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var basePlugin={options:function(dataNs,ns,_options){return this.each(function(){var $elt=$(this),currentOptions=$elt.data(dataNs);currentOptions&&$elt.data(dataNs,_.merge(currentOptions,_options))})},disable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.addClass(options.disableClass||"disabled").trigger("disable."+ns)})},enable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.removeClass(options.disableClass||"disabled").trigger("enable."+ns)})}};return{register:function(pluginName,plugin,config){config=config||{};var ns=config.ns||pluginName.toLowerCase(),dataNs=config.dataNs||"ui."+ns,expose=config.expose||[];return _.isFunction($.fn[pluginName])?$.error("A plugin named "+pluginName+" is already registered"):_.isPlainObject(plugin)&&_.isFunction(plugin.init)?void(_.assign(plugin,_.transform(basePlugin,function(result,prop,key){_.isFunction(prop)&&(result[key]=_.partial(basePlugin[key],dataNs,ns))})),_.forEach(expose,function(toExposeName){var privateMethod=toExposeName,publicMethod=toExposeName;/^_/.test(expose)?publicMethod=publicMethod.replace(/^_/,""):privateMethod="_"+privateMethod,_.isFunction(plugin[privateMethod])&&!_.isFunction(plugin[publicMethod])&&(plugin[publicMethod]=function(){var args=Array.prototype.slice.call(arguments,0),returnValue;return this.each(function(){returnValue=plugin[privateMethod].apply(plugin,[$(this)].concat(args))}),returnValue||this})}),$.fn[pluginName]=function(method){if(plugin[method]){if(/^_/.test(method))$.error("Trying to call a private method `"+method+"`");else return plugin[method].apply(this,Array.prototype.slice.call(arguments,1));}else if("object"===_typeof(method)||!method)return plugin.init.apply(this,arguments);$.error("Method "+method+" does not exist on plugin")}):$.error("The object to register as a jQuery plugin must be a plain object with an `init` method.")}}}),define("ui/resourcemgr/fileBrowser",["jquery","lodash"],function($,_){'use strict';function fileBrowser(options){function getFolderContent(tree,path,cb){var content=getByPath(tree,path);content&&(content.children||content.empty)?cb(content):loadContent(path).done(function(data){tree.path?data.children?(!_.find(content.children,"path")&&(tree.empty=!0),setToPath(tree,path,data.children)):tree.empty=!0:tree=_.merge(tree,data),cb(data)})}function getByPath(tree,path){var match;return tree&&(tree.path&&0===tree.path.indexOf(path)?match=tree:tree.children&&_.forEach(tree.children,function(child){if(match=getByPath(child,path),match)return!1})),match}function setToPath(tree,path,data){var done=!1;return tree&&(tree.path===path?tree.children=data:tree.children&&_.forEach(tree.children,function(child){if(done=setToPath(child,path,data),done)return!1})),done}function removeFromPath(tree,path){var done=!1,removed=[];return tree&&tree.children&&(removed=_.remove(tree.children,function(child){return child.path===path||child.name&&tree.path+child.name===path}),done=0<removed.length,!done&&_.forEach(tree.children,function(child){if(done=removeFromPath(child,path),done)return!1})),done}function loadContent(path){var parameters={};return parameters[options.pathParam]=path,$.getJSON(options.browseUrl,_.merge(parameters,options.params))}function updateFolders(data,$parent,recurse){var $item;recurse&&data&&data.path&&(data.relPath===void 0&&(data.relPath=data.path),$item=$("<li><a data-path=\""+data.path+"\" data-display=\""+data.relPath+"\" href=\"#\">"+data.label+"</a></li>").appendTo($parent)),data&&data.children&&_.isArray(data.children)&&!data.empty&&_.forEach(data.children,function(child){updateFolders(child,$parent,!0)})}var root=options.root||"/",path=options.path||"/",$container=options.$target,$fileBrowser=$(".file-browser .file-browser-wrapper",$container),$divContainer=$("."+root,$fileBrowser),$folderContainer=$(".folders",$divContainer),fileTree={};$folderContainer.append("<li class=\"root\"><a class=\"root-folder\" href=\"#\"></a></li>"),getFolderContent(fileTree,path,function(content){var $rootNode=$(".root-folder",$folderContainer),$innerList=$("<ul></ul>").insertAfter($rootNode);content.children&&$rootNode.addClass("opened"),updateFolders(content,$innerList),$(".file-browser").find("li.active").removeClass("active"),$("li.root",$folderContainer).addClass("active"),$rootNode.attr("data-path",content.path).text(content.label),$container.trigger("folderselect.resourcemgr",[content.label,content.children,content.path])}),$divContainer.off("click",".folders a").on("click",".folders a",function(e){e.preventDefault();var $selected=$(this),$folders=$(".folders li",$fileBrowser),fullPath=$selected.data("path"),displayPath=$selected.data("display"),subTree=getByPath(fileTree,fullPath);getFolderContent(subTree,fullPath,function(content){if(content){var $innerList=$selected.siblings("ul");!$innerList.length&&content.children&&_.find(content.children,"path")&&!content.empty?($innerList=$("<ul></ul>").insertAfter($selected),updateFolders(content,$innerList),$selected.addClass("opened")):$innerList.length&&("none"===$innerList.css("display")?($innerList.show(),$selected.addClass("opened")):$selected.parent("li").hasClass("active")&&($innerList.hide(),$selected.removeClass("opened"))),$folders.removeClass("active"),$selected.parent("li").addClass("active"),$container.trigger("folderselect.resourcemgr",[content.label,content.children,content.path])}})}),$container.on("filenew.resourcemgr",function(e,file,path){var subTree=getByPath(fileTree,path);subTree&&(!subTree.children&&(subTree.children=[]),!_.find(subTree.children,{name:file.name})&&(subTree.children.push(file),$container.trigger("folderselect.resourcemgr",[subTree.label,subTree.children,path])))}),$container.on("filedelete.resourcemgr",function(e,path){removeFromPath(fileTree,path)})}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;return fileBrowser}),define("util/bytes",[],function(){'use strict';return{hrSize:function(bytes){var unit=0,thresh=1024;for(bytes=bytes||0;bytes>=thresh;)bytes/=thresh,unit++;return bytes.toFixed(2)+["B","kB","MB","GB","TB"][unit]}}}),define("core/mimetype",["jquery","lodash"],function($,_){'use strict';function getFileExtension(fileName){var extMatch=fileName.match(/\.([0-9a-z]+)(?:[\?#]|$)/i);if(extMatch&&1<extMatch.length)return extMatch[1]}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var categories={video:{category:"media",mimes:["application/ogg","video/*"],extensions:["avi","mp4","ogg","mpeg","flv"]},audio:{category:"media",mimes:["audio/*"],extensions:["mp3","wav","aac"]},image:{category:"media",mimes:["image/*","application/x-gzip"],extensions:["png","jpg","jpeg","gif","svg","svgz","ico"]},flash:{category:"media",mimes:["application/x-shockwave-flash"],extensions:["flv","swf"]},geogebra:{category:"media",mimes:["application/vnd.geogebra.file","application/vnd.geogebra.tool"],extensions:["ggb","ggt"]},rdf:{category:"sources",mimes:["application/rdf+xml"],extensions:["rdf"]},xml:{category:"sources",mimes:["application/xml","application/xml-dtd","text/xml"],extensions:["xml","dtd","qti"]},html:{category:"sources",mimes:["text/html","text/xhtml","application/xhtml+xml","application/qti+xml"],extensions:["html","htm","html5","xhtml"]},font:{category:"sources",mimes:["application/font-woff"],extensions:["woff","eot","ttf"]},js:{category:"sources",mimes:["application/javascript","application/json","text/javascript"],extensions:["js","json"]},css:{category:"sources",mimes:["text/css"],extensions:["css","sass","scss","less"]},shell:{category:"sources",mimes:["application/x-sh"],extensions:["sh"]},mathml:{category:"sources",mimes:["application/mathml+xml"],extensions:["mathml"]},pdf:{category:"document",mimes:["application/pdf"],extensions:["pdf"]},office:{category:"document",mimes:["application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","application/vnd.ms-excel","application/msword"],extensions:["doc","odt","docx","xls","xlsx","ods","ppt","pptx","odp"]},text:{category:["document"],mimes:["text/*"],extensions:["txt","csv"]},archive:{category:"archive",mimes:["application/zip","application/gzip","application/rar","application/x-7z-compressed","application/x-bzip","application/x-bzip2"],extensions:["zip","gz","bz","bz2","rar","p7z","7z"]},generic:{category:"generic",mimes:["application/octet-stream","application/force-download","application/x-force-download"]}},extensions={txt:"text/plain",htm:"text/html",html:"text/html",xhtml:"application/xhtml+xml",php:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"text/xml",rdf:"text/xml",swf:"application/x-shockwave-flash",flv:"video/x-flv",csv:"text/csv",rtx:"text/richtext",rtf:"application/rtf",png:"image/png",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",ico:"image/vnd.microsoft.icon",tiff:"image/tiff",tif:"image/tiff",svg:"image/svg+xml",svgz:"image/svg+xml",zip:"application/zip",rar:"application/x-rar-compressed",exe:"application/x-msdownload",msi:"application/x-msdownload",cab:"application/vnd.ms-cab-compressed",mp3:"audio/mpeg",oga:"audio/ogg",ogg:"audio/ogg",aac:"audio/aac",qt:"video/quicktime",mov:"video/quicktime",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",pdf:"application/pdf",psd:"image/vnd.adobe.photoshop",ai:"application/postscript",eps:"application/postscript",ps:"application/postscript",doc:"application/msword",xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",woff:"application/x-font-woff",eot:"application/vnd.ms-fontobject",ttf:"application/x-font-ttf"},mimetypeHelper={getResourceType:function(url,callback){return $.ajax({type:"HEAD",async:!0,url:url,success:function(message,text,jqXHR){var mime=jqXHR.getResponseHeader("Content-Type");callback&&callback(null,mime)},error:function(jqXHR){var error=jqXHR.status||404;callback&&callback(error)}}),this},getFileType:function(file){var mime=file.mime,type,ext;return mime&&(type=_.findKey(categories,{mimes:[mime]}),!type&&(type=_.findKey(categories,{mimes:[mime.replace(/\/.*$/,"/*")]}))),type||(ext=getFileExtension(file.name),ext&&(type=_.findKey(categories,{extensions:[ext]}))),type},match:function(type,validTypes){var checkType=type.replace(/^["']+|['"]+$/g,""),starType=checkType.replace(/\/.*$/,"/*");return _.contains(validTypes,checkType)||_.contains(validTypes,starType)},getCategory:function(type){if(categories[type])return categories[type].category},getMimeType:function(file){var type=file.type,category=mimetypeHelper.getFileType({name:file.name,mime:type}),ext;return type&&!type.match(/invalid/)&&"generic"!==category?type:(ext=getFileExtension(file.name),ext&&extensions[ext])?extensions[ext]:type}};return mimetypeHelper}),define("core/promiseQueue",["lodash","core/promise","core/eventifier","lib/uuid"],function(_,Promise,eventifier,uuid){'use strict';return _=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,function(){var queue={},getId=function getId(){var id="promise-"+uuid(6);return"undefined"==typeof queue[id]?id:getId()};return{add:function(promise){return queue[getId()]=promise,this},getValues:function(){return _.values(queue)},clear:function(){return queue={},this},serie:function(promiseFn){var id=getId(),currentQueue=this.getValues(),emitter=eventifier();return queue[id]=new Promise(function(resolve){emitter.on("fulfilled",resolve)}),Promise.all(currentQueue).then(function(){if(_.isFunction(promiseFn))return promiseFn()}).then(function(data){return emitter.trigger("fulfilled"),delete queue[id],data}).catch(function(err){throw queue={},err})}}}}),define("core/store/localstorage",["lodash","core/promise","core/promiseQueue","lib/uuid"],function(_,Promise,promiseQueue,uuid){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue["default"]:promiseQueue,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid;var storage=window.localStorage,knownStoresName="index",idStoreName="id",writingQueue=promiseQueue(),setEntry=function(storeName,key,value){return new Promise(function(resolve,reject){try{storage.setItem("tao-store-"+storeName+"."+key,JSON.stringify(value)),resolve(!0)}catch(ex){reject(ex)}})},getEntry=function(storeName,key){return new Promise(function(resolve,reject){var value;try{value=storage.getItem("tao-store-"+storeName+"."+key),null===value?resolve():resolve(JSON.parse(value))}catch(ex){reject(ex)}})},getKnownStores=function(){return getEntry(knownStoresName,"stores")},registerStore=function(storeName){return getKnownStores().then(function(stores){return stores=stores||{},stores[storeName]={name:storeName,lastOpen:Date.now()},setEntry(knownStoresName,"stores",stores)})},unregisterStore=function(storeName){return getKnownStores().then(function(stores){return stores=stores||{},delete stores[storeName],setEntry(knownStoresName,"stores",stores)})},localStorageBackend=function(storeName){var registered=!1,openStore=function(){return registered?Promise.resolve():registerStore(storeName).then(function(){registered=!0})},name;if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return name="tao-store-"+storeName+".",{getItem:function(key){return writingQueue.serie(function(){return openStore().then(function(){return getEntry(storeName,key)})})},setItem:function(key,value){return writingQueue.serie(function(){return openStore().then(function(){return setEntry(storeName,key,value)})})},removeItem:function(key){return writingQueue.serie(function(){return openStore().then(function(){return storage.removeItem(name+key),!0})})},getItems:function(){var keyPattern=new RegExp("^"+name);return writingQueue.serie(function(){return openStore().then(function(){return _(storage).map(function(entry,index){return storage.key(index)}).filter(function(key){return keyPattern.test(key)}).reduce(function(acc,key){var exposedKey=key.replace(name,""),value;try{value=storage.getItem(key),null!==value&&(acc[exposedKey]=JSON.parse(value))}catch(ex){acc[exposedKey]=null}return acc},{})})})},clear:function(){var keyPattern=new RegExp("^"+name);return writingQueue.serie(function(){return openStore().then(function(){return _(storage).map(function(entry,index){return storage.key(index)}).filter(function(key){return keyPattern.test(key)}).forEach(function(key){storage.removeItem(key)}),!0})})},removeStore:function(){return this.clear().then(function(){return unregisterStore(storeName)})}}};return localStorageBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),getKnownStores().then(function(stores){var removing=_(stores).filter(function(store,storeName){return!validate||validate(storeName,store)}).map(function(store){return store&&store.name?localStorageBackend(store.name).removeStore():Promise.resolve()}).value();return Promise.all(removing)})},localStorageBackend.getAll=function(validate){return getKnownStores().then(function(stores){return _(stores).filter(function(store,storeName){return!validate||validate(storeName,store)}).map(function(store){return store.name}).value()})},localStorageBackend.getStoreIdentifier=function(){var idStore=localStorageBackend(idStoreName);return idStore.getItem(idStoreName).then(function(id){return _.isEmpty(id)?(id=uuid(),idStore.setItem(idStoreName,id).then(function(){return id})):id})},localStorageBackend}),define("core/store/indexeddb",["lodash","core/promise","lib/uuid"],function(_,Promise,uuid){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid;var commonjsGlobal="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,idbstore=function(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}(function(module){(function(name,definition,global){module.exports?module.exports=definition():global[name]=definition()})("IDBStore",function(){function mixin(target,source){var name,s;for(name in source)s=source[name],s!==empty[name]&&s!==target[name]&&(target[name]=s);return target}var defaultErrorHandler=function(error){throw error},defaultSuccessHandler=function(){},defaults={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:defaultErrorHandler,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},IDBStore=function(kwArgs,onStoreReady){for(var key in"undefined"==typeof onStoreReady&&"function"==typeof kwArgs&&(onStoreReady=kwArgs),"[object Object]"!=Object.prototype.toString.call(kwArgs)&&(kwArgs={}),defaults)this[key]="undefined"==typeof kwArgs[key]?defaults[key]:kwArgs[key];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,onStoreReady&&(this.onStoreReady=onStoreReady);var env="object"==("undefined"==typeof window?"undefined":_typeof(window))?window:self,availableImplementations=this.implementationPreference.filter(function(implName){return implName in env});this.implementation=availableImplementations[0],this.idb=env[this.implementation],this.keyRange=env.IDBKeyRange||env.webkitIDBKeyRange||env.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()},proto={constructor:IDBStore,version:"1.7.0",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var openRequest=this.idb.open(this.dbName,this.dbVersion),preventSuccessCallback=!1;openRequest.onerror=function(error){var gotVersionErr=!1;"error"in error.target?gotVersionErr="VersionError"==error.target.error.name:"errorCode"in error.target&&(gotVersionErr=12==error.target.errorCode),gotVersionErr?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(error)}.bind(this),openRequest.onsuccess=function(event){if(!preventSuccessCallback){if(this.db)return void this.onStoreReady();if(this.db=event.target.result,"string"==typeof this.db.version)return void this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));if(!this.db.objectStoreNames.contains(this.storeName))return void this.onError(new Error("Object store couldn't be created."));var emptyTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=emptyTransaction.objectStore(this.storeName);var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName)return preventSuccessCallback=!0,void this.onError(new Error("Cannot create index: No index name given."));if(this.normalizeIndexData(indexData),this.hasIndex(indexName)){var actualIndex=this.store.index(indexName),complies=this.indexComplies(actualIndex,indexData);complies||(preventSuccessCallback=!0,this.onError(new Error("Cannot modify index \""+indexName+"\" for current version. Please bump version number to "+(this.dbVersion+1)+"."))),existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else preventSuccessCallback=!0,this.onError(new Error("Cannot create new index \""+indexName+"\" for current version. Please bump version number to "+(this.dbVersion+1)+"."))},this),existingIndexes.length&&(preventSuccessCallback=!0,this.onError(new Error("Cannot delete index(es) \""+existingIndexes.toString()+"\" for current version. Please bump version number to "+(this.dbVersion+1)+"."))),preventSuccessCallback||this.onStoreReady()}}.bind(this),openRequest.onupgradeneeded=function(event){if(this.db=event.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=event.target.transaction.objectStore(this.storeName);else{var optionalParameters={autoIncrement:this.autoIncrement};null!==this.keyPath&&(optionalParameters.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,optionalParameters)}var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(indexName||(preventSuccessCallback=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(indexData),this.hasIndex(indexName)){var actualIndex=this.store.index(indexName),complies=this.indexComplies(actualIndex,indexData);complies||(this.store.deleteIndex(indexName),this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})),existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})},this),existingIndexes.length&&existingIndexes.forEach(function(_indexName){this.store.deleteIndex(_indexName)},this)}.bind(this)},deleteDatabase:function(onSuccess,onError){if(this.idb.deleteDatabase){this.db.close();var deleteRequest=this.idb.deleteDatabase(this.dbName);deleteRequest.onsuccess=onSuccess,deleteRequest.onerror=onError}else onError(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(key,value,onSuccess,onError){null!==this.keyPath&&(onError=onSuccess,onSuccess=value,value=key),onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,putTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE),putRequest;return putTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},putTransaction.onabort=onError,putTransaction.onerror=onError,null===this.keyPath?putRequest=putTransaction.objectStore(this.storeName).put(value,key):(this._addIdPropertyIfNeeded(value),putRequest=putTransaction.objectStore(this.storeName).put(value)),putRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},putRequest.onerror=onError,putTransaction},get:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,getTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);getTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getTransaction.onabort=onError,getTransaction.onerror=onError;var getRequest=getTransaction.objectStore(this.storeName).get(key);return getRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},getRequest.onerror=onError,getTransaction},remove:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,removeTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);removeTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},removeTransaction.onabort=onError,removeTransaction.onerror=onError;var deleteRequest=removeTransaction.objectStore(this.storeName)["delete"](key);return deleteRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},deleteRequest.onerror=onError,removeTransaction},batch:function(dataArray,onSuccess,onError){if(onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),"[object Array]"!=Object.prototype.toString.call(dataArray))onError(new Error("dataArray argument must be of type Array."));else if(0===dataArray.length)return onSuccess(!0);var count=dataArray.length,called=!1,hasSuccess=!1,batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(hasSuccess)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var onItemSuccess=function(){count--,0!==count||called||(called=!0,hasSuccess=!0)};return dataArray.forEach(function(operation){var type=operation.type,key=operation.key,value=operation.value,onItemError=function(err){batchTransaction.abort(),called||(called=!0,onError(err,type,key))};if("remove"==type){var deleteRequest=batchTransaction.objectStore(this.storeName)["delete"](key);deleteRequest.onsuccess=onItemSuccess,deleteRequest.onerror=onItemError}else if("put"==type){var putRequest;null===this.keyPath?putRequest=batchTransaction.objectStore(this.storeName).put(value,key):(this._addIdPropertyIfNeeded(value),putRequest=batchTransaction.objectStore(this.storeName).put(value)),putRequest.onsuccess=onItemSuccess,putRequest.onerror=onItemError}},this),batchTransaction},putBatch:function(dataArray,onSuccess,onError){var batchData=dataArray.map(function(item){return{type:"put",value:item}});return this.batch(batchData,onSuccess,onError)},upsertBatch:function(dataArray,options,onSuccess,onError){"function"==typeof options&&(onSuccess=options,onError=onSuccess,options={}),onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),options||(options={}),"[object Array]"!=Object.prototype.toString.call(dataArray)&&onError(new Error("dataArray argument must be of type Array."));var keyField=options.keyField||this.keyPath,count=dataArray.length,called=!1,hasSuccess=!1,index=0,batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){hasSuccess?onSuccess(dataArray):onError(!1)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var onItemSuccess=function(event){var record=dataArray[index++];record[keyField]=event.target.result,count--,0!==count||called||(called=!0,hasSuccess=!0)};return dataArray.forEach(function(record){var key=record.key,onItemError=function(err){batchTransaction.abort(),called||(called=!0,onError(err))},putRequest;null===this.keyPath?putRequest=batchTransaction.objectStore(this.storeName).put(record,key):(this._addIdPropertyIfNeeded(record),putRequest=batchTransaction.objectStore(this.storeName).put(record)),putRequest.onsuccess=onItemSuccess,putRequest.onerror=onItemError},this),batchTransaction},removeBatch:function(keyArray,onSuccess,onError){var batchData=keyArray.map(function(key){return{type:"remove",key:key}});return this.batch(batchData,onSuccess,onError)},getBatch:function(keyArray,onSuccess,onError,arrayType){if(onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler),arrayType||(arrayType="sparse"),"[object Array]"!=Object.prototype.toString.call(keyArray))onError(new Error("keyArray argument must be of type Array."));else if(0===keyArray.length)return onSuccess([]);var data=[],count=keyArray.length,hasSuccess=!1,result=null,batchTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},batchTransaction.onabort=onError,batchTransaction.onerror=onError;var onItemSuccess=function(event){event.target.result||"dense"==arrayType?data.push(event.target.result):"sparse"==arrayType&&data.length++,count--,0===count&&(hasSuccess=!0,result=data)};return keyArray.forEach(function(key){var onItemError=function(err){result=err,onError(err),batchTransaction.abort()},getRequest=batchTransaction.objectStore(this.storeName).get(key);getRequest.onsuccess=onItemSuccess,getRequest.onerror=onItemError},this),batchTransaction},getAll:function(onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var getAllTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY),store=getAllTransaction.objectStore(this.storeName);return store.getAll?this._getAllNative(getAllTransaction,store,onSuccess,onError):this._getAllCursor(getAllTransaction,store,onSuccess,onError),getAllTransaction},_getAllNative:function(getAllTransaction,store,onSuccess,onError){var hasSuccess=!1,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getAllTransaction.onabort=onError,getAllTransaction.onerror=onError;var getAllRequest=store.getAll();getAllRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},getAllRequest.onerror=onError},_getAllCursor:function(getAllTransaction,store,onSuccess,onError){var all=[],hasSuccess=!1,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},getAllTransaction.onabort=onError,getAllTransaction.onerror=onError;var cursorRequest=store.openCursor();cursorRequest.onsuccess=function(event){var cursor=event.target.result;cursor?(all.push(cursor.value),cursor["continue"]()):(hasSuccess=!0,result=all)},cursorRequest.onError=onError},clear:function(onSuccess,onError){onError||(onError=defaultErrorHandler),onSuccess||(onSuccess=defaultSuccessHandler);var hasSuccess=!1,result=null,clearTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);clearTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},clearTransaction.onabort=onError,clearTransaction.onerror=onError;var clearRequest=clearTransaction.objectStore(this.storeName).clear();return clearRequest.onsuccess=function(event){hasSuccess=!0,result=event.target.result},clearRequest.onerror=onError,clearTransaction},_addIdPropertyIfNeeded:function(dataObj){"undefined"==typeof dataObj[this.keyPath]&&(dataObj[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(indexName){return this.store.indexNames.contains(indexName)},normalizeIndexData:function(indexData){indexData.keyPath=indexData.keyPath||indexData.name,indexData.unique=!!indexData.unique,indexData.multiEntry=!!indexData.multiEntry},indexComplies:function(actual,expected){var complies=["keyPath","unique","multiEntry"].every(function(key){if("multiEntry"==key&&void 0===actual[key]&&!1===expected[key])return!0;if("keyPath"==key&&"[object Array]"==Object.prototype.toString.call(expected[key])){var exp=expected.keyPath,act=actual.keyPath;if("string"==typeof act)return exp.toString()==act;if("function"!=typeof act.contains&&"function"!=typeof act.indexOf)return!1;if(act.length!==exp.length)return!1;for(var i=0,m=exp.length;i<m;i++)if(!(act.contains&&act.contains(exp[i])||act.indexOf(-1!==exp[i])))return!1;return!0}return expected[key]==actual[key]});return complies},iterate:function(onItem,options){options=mixin({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:defaultErrorHandler,limit:1/0,offset:0,allowItemRejection:!1},options||{});var directionType="desc"==options.order.toLowerCase()?"PREV":"NEXT";options.filterDuplicates&&(directionType+="_NO_DUPLICATE");var hasSuccess=!1,cursorTransaction=this.db.transaction([this.storeName],this.consts[options.writeAccess?"READ_WRITE":"READ_ONLY"]),cursorTarget=cursorTransaction.objectStore(this.storeName);options.index&&(cursorTarget=cursorTarget.index(options.index));var recordCount=0;cursorTransaction.oncomplete=function(){return hasSuccess?void(options.onEnd?options.onEnd():onItem(null)):void options.onError(null)},cursorTransaction.onabort=options.onError,cursorTransaction.onerror=options.onError;var cursorRequest=cursorTarget.openCursor(options.keyRange,this.consts[directionType]);return cursorRequest.onerror=options.onError,cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(!cursor)hasSuccess=!0;else if(options.offset)cursor.advance(options.offset),options.offset=0;else{var onItemReturn=onItem(cursor.value,cursor,cursorTransaction);options.allowItemRejection&&!1===onItemReturn||recordCount++,options.autoContinue&&(recordCount+options.offset<options.limit?cursor["continue"]():hasSuccess=!0)}},cursorTransaction},query:function(onSuccess,options){var result=[],processedItems=0;return options=options||{},options.autoContinue=!0,options.writeAccess=!1,options.allowItemRejection=!!options.filter,options.onEnd=function(){onSuccess(result,processedItems)},this.iterate(function(item){processedItems++;var accept=!options.filter||options.filter(item);return!1!==accept&&result.push(item),accept},options)},count:function(onSuccess,options){options=mixin({index:null,keyRange:null},options||{});var onError=options.onError||defaultErrorHandler,hasSuccess=!1,result=null,cursorTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);cursorTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)},cursorTransaction.onabort=onError,cursorTransaction.onerror=onError;var cursorTarget=cursorTransaction.objectStore(this.storeName);options.index&&(cursorTarget=cursorTarget.index(options.index));var countRequest=cursorTarget.count(options.keyRange);return countRequest.onsuccess=function(evt){hasSuccess=!0,result=evt.target.result},countRequest.onError=onError,cursorTransaction},makeKeyRange:function(options){var hasLower="undefined"!=typeof options.lower,hasUpper="undefined"!=typeof options.upper,isOnly="undefined"!=typeof options.only,keyRange;switch(!0){case isOnly:keyRange=this.keyRange.only(options.only);break;case hasLower&&hasUpper:keyRange=this.keyRange.bound(options.lower,options.upper,options.excludeLower,options.excludeUpper);break;case hasLower:keyRange=this.keyRange.lowerBound(options.lower,options.excludeLower);break;case hasUpper:keyRange=this.keyRange.upperBound(options.upper,options.excludeUpper);break;default:throw new Error("Cannot create KeyRange. Provide one or both of \"lower\" or \"upper\" value, or an \"only\" value.");}return keyRange}},empty={};return IDBStore.prototype=proto,IDBStore.version=proto.version,IDBStore},commonjsGlobal)}),idStoreName="id",isIndexedDB2="undefined"!=typeof IDBObjectStore&&"getAll"in IDBObjectStore.prototype,openStore=function(storeName){return new Promise(function(resolve,reject){var store=new idbstore({dbVersion:1,storeName:storeName,storePrefix:"tao-store-",keyPath:"key",autoIncrement:!0,onStoreReady:function(){store.db.onversionchange=function(e){e&&e.newVersion||store.db.close()},resolve(store)},onError:reject})})},setEntry=function(store,key,value){return new Promise(function(resolve,reject){store.put({key:key,value:value},function(returnKey){resolve(returnKey===key)},reject)})},getEntry=function(store,key){return new Promise(function(resolve,reject){store.get(key,function(entry){return entry&&"undefined"!=typeof entry.value?void resolve(entry.value):resolve(entry)},reject)})},getEntries=function(store){return new Promise(function(resolve,reject){var success=function(entries){return _.isArray(entries)?void resolve(_.reduce(entries,function(acc,entry){return entry.key&&entry.value&&(acc[entry.key]=entry.value),acc},{})):resolve({})};store.getAll(success,reject)})},removeEntry=function(store,key){return new Promise(function(resolve,reject){store.remove(key,function(result){resolve(!1!==result)},reject)})},getKnownStores=function(){return knownStores||(knownStores=openStore("index")),knownStores},registerStore=function(storeName){return getKnownStores().then(function(store){return setEntry(store,storeName,{name:storeName,lastOpen:Date.now()})})},unregisterStore=function(storeName){return getKnownStores().then(function(store){return removeEntry(store,storeName)})},deleteStore=function(store,storeName){return new Promise(function(resolve,reject){var success=function(){unregisterStore(storeName).then(function(){resolve(!0)}).catch(reject)};isIndexedDB2?store.deleteDatabase(success,reject):store.clear(success,reject)})},indexDbBackend=function(storeName){var getStore=function(){return innerStore||(innerStore=openStore(storeName).then(function(store){return registerStore(storeName).then(function(){return Promise.resolve(store)})})),innerStore},ensureSerie=function(getWritingPromise){return writePromise?new Promise(function(resolve,reject){var runWrite=function(){var p=getWritingPromise();writePromise=p,p.then(resolve).catch(reject)};writePromise.then(runWrite).catch(runWrite)}):(writePromise=getWritingPromise(),writePromise)},innerStore,writePromise;if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return{getItem:function(key){return ensureSerie(function(){return getStore().then(function(store){return getEntry(store,key)})})},setItem:function(key,value){return ensureSerie(function(){return getStore().then(function(store){return setEntry(store,key,value)})})},removeItem:function(key){return ensureSerie(function(){return getStore().then(function(store){return removeEntry(store,key)})})},getItems:function(){return ensureSerie(function(){return getStore().then(function(store){return getEntries(store)})})},clear:function(){return ensureSerie(function(){return getStore().then(function(store){return new Promise(function(resolve,reject){store.clear(function(){resolve(!0)},reject)})})})},removeStore:function(){return ensureSerie(function(){return getStore().then(function(store){return deleteStore(store,storeName)})})}}},knownStores;return indexDbBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),getKnownStores().then(function(store){return new Promise(function(resolve,reject){function cleanUp(entries){var all=[];_.forEach(entries,function(entry){var storeName=entry&&entry.key;storeName&&all.push(openStore(storeName).then(function(storeToRemove){if(!validate||validate(storeName,entry.value))return deleteStore(storeToRemove,storeName)}))}),Promise.all(all).then(resolve).catch(reject)}store.getAll(cleanUp,reject)})})},indexDbBackend.getAll=function(validate){return _.isFunction(validate)||(validate=function(){return!0}),getKnownStores().then(function(store){return new Promise(function(resolve,reject){store.getAll(function(entries){var storeNames=_(entries).filter(function(entry){return entry&&entry.key&&validate(entry.key,entry.value)}).map(function(entry){return entry.key}).value();return resolve(storeNames)},reject)})})},indexDbBackend.getStoreIdentifier=function(){return openStore(idStoreName).then(function(store){return getEntry(store,idStoreName).then(function(id){return _.isEmpty(id)?(id=uuid(),setEntry(store,idStoreName,id).then(function(){return id})):id})})},indexDbBackend}),define("core/store/memory",["lodash","core/promise","lib/uuid"],function(_,Promise,uuid){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid;var memoryStore={},memoryStorageBackend=function(storeName){if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return memoryStore[storeName]=memoryStore[storeName]||{},{getItem:function(key){return _.isPlainObject(memoryStore[storeName])?Promise.resolve(memoryStore[storeName][key]):Promise.resolve()},setItem:function(key,value){return _.isPlainObject(memoryStore[storeName])||(memoryStore[storeName]={}),memoryStore[storeName][key]=value,Promise.resolve(!0)},removeItem:function(key){return memoryStore[storeName]=_.omit(memoryStore[storeName],key),Promise.resolve("undefined"==typeof memoryStore[storeName][key])},getItems:function(){return Promise.resolve(memoryStore[storeName])},clear:function(){return memoryStore[storeName]={},Promise.resolve(!0)},removeStore:function(){return memoryStore=_.omit(memoryStore,storeName),Promise.resolve("undefined"==typeof memoryStore[storeName])}}},idStore;return memoryStorageBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),memoryStore=_.omit(memoryStore,function(store,storeName){return!validate||validate(storeName)}),Promise.resolve(!0)},memoryStorageBackend.getAll=function(validate){var storeNames=[];return _.isFunction(validate)||(validate=null),storeNames=_(memoryStore).map(function(store,storeName){return storeName}).filter(function(storeName){return!validate||validate(storeName)}).value(),Promise.resolve(storeNames)},memoryStorageBackend.getStoreIdentifier=function(){return _.isEmpty(idStore)&&(idStore=uuid()),Promise.resolve(idStore)},memoryStorageBackend}),define("core/store",["lodash","moment","module","core/logger","core/promise","core/store/localstorage","core/store/indexeddb","core/store/memory"],function(_,moment,module,loggerFactory,Promise,localStorageBackend,indexedDBBackend,memoryBackend){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,moment=moment&&moment.hasOwnProperty("default")?moment["default"]:moment,module=module&&module.hasOwnProperty("default")?module["default"]:module,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,localStorageBackend=localStorageBackend&&localStorageBackend.hasOwnProperty("default")?localStorageBackend["default"]:localStorageBackend,indexedDBBackend=indexedDBBackend&&indexedDBBackend.hasOwnProperty("default")?indexedDBBackend["default"]:indexedDBBackend,memoryBackend=memoryBackend&&memoryBackend.hasOwnProperty("default")?memoryBackend["default"]:memoryBackend;var supportsIndexedDB=!1,dectectionDone=!1,quotaChecked=!1,backendApi=["removeAll","getAll","getStoreIdentifier"],storeApi=["getItem","setItem","removeItem","getItems","clear","removeStore"],logger=loggerFactory("core/store"),config=_.defaults(module.config()||{},{lowSpaceRatio:80,invalidation:{staled:"P2W",oldster:"P2M"}}),isIndexDBSupported=function(){return dectectionDone?Promise.resolve(supportsIndexedDB):new Promise(function(resolve){var done=function(result){return supportsIndexedDB=!!result,dectectionDone=!0,resolve(supportsIndexedDB)},test,indexedDB;try{if(indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,!indexedDB)return done(!1);test=indexedDB.open("__feature_test",1),test.onsuccess=function(){if(test.result)return test.result.close(),done(!0)},test.onerror=function(e){return e.preventDefault(),done(!1),!1}}catch(err){done(!1)}})},checkQuotas=function(){!quotaChecked&&"storage"in window.navigator&&window.navigator.storage.estimate&&window.navigator.storage.estimate().then(function(estimate){var usedRatio=0;_.isNumber(estimate.usage)&&_.isNumber(estimate.quota)&&0<estimate.quota&&(usedRatio=estimate.usage/estimate.quota,usedRatio>config.lowSpaceRatio?(logger.warn("The browser storage is getting low "+usedRatio.toFixed(2)+"% used",estimate),logger.warn("We will attempt to clean oldster databases in persistent backends"),store.cleanUpSpace(config.invalidation.oldster,[],localStorageBackend),isIndexDBSupported&&store.cleanUpSpace(config.invalidation.oldster,[],indexedDBBackend)):logger.debug("Browser storage estimate : "+usedRatio.toFixed(2)+"% used",estimate))}).catch(function(err){logger.warn("Unable to retrieve quotas : "+err.message)}),quotaChecked=!0},isBackendApiValid=function(backend){return _.all(backendApi,function(method){return _.isFunction(backend[method])})},isStorageApiValid=function(storage){return _.all(storeApi,function(method){return _.isFunction(storage[method])})},loadBackend=function(preselectedBackend){return isIndexDBSupported().then(function(){var backend=preselectedBackend||(supportsIndexedDB?indexedDBBackend:localStorageBackend);return _.isFunction(backend)?isBackendApiValid(backend)?(backend!==memoryBackend&&checkQuotas(),backend):Promise.reject(new TypeError("This backend doesn't comply with the store backend API")):Promise.reject(new TypeError("No backend, no storage!"))})},store;store=function(storeName,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){var storeInstance=backend(storeName);return isStorageApiValid(storeInstance)?storeInstance:Promise.reject(new TypeError("The store doesn't comply with the Storage interface"))})},store.backends={localStorage:localStorageBackend,indexedDB:indexedDBBackend,memory:memoryBackend},store.removeAll=function(validate,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.removeAll(validate)})},store.cleanUpSpace=function(since,storeNamePattern,preselectedBackend){var invalidate=function(storeName,storeEntry){return!!(storeName&&storeEntry)&&(!(storeNamePattern instanceof RegExp)||storeNamePattern.test(storeName))&&_.isNumber(storeEntry.lastOpen)&&_.isNumber(tsThreshold)&&storeEntry.lastOpen<=tsThreshold},tsThreshold;return _.isNumber(since)&&0<since?tsThreshold=since:(!_.isString(since)&&(since=config.invalidation.oldster),tsThreshold=moment().subtract(moment.duration(since)).valueOf()),logger.info("Trying to remove stores lastly opened before "+tsThreshold+"("+since+")"),store.removeAll(invalidate,preselectedBackend)},store.getAll=function(validate,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.getAll(validate)})},store.getIdentifier=function(preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.getStoreIdentifier()})};var store$1=store;return store$1}),define("css!ui/mediaplayer/css/player",[],function(){}),define("ui/mediaplayer",["jquery","lodash","async","util/urlParser","core/eventifier","core/mimetype","core/store","handlebars","i18n","lib/dompurify/purify","css!ui/mediaplayer/css/player.css","nouislider"],function($$1,_,async,UrlParser,eventifier,mimetype,store,Handlebars,__,DOMPurify){'use strict';var _Mathabs=Math.abs,_Mathmin=Math.min,_Mathmax=Math.max,_Mathfloor2=Math.floor;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function playerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,async=async&&async.hasOwnProperty("default")?async["default"]:async,UrlParser=UrlParser&&UrlParser.hasOwnProperty("default")?UrlParser["default"]:UrlParser,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,mimetype=mimetype&&mimetype.hasOwnProperty("default")?mimetype["default"]:mimetype,store=store&&store.hasOwnProperty("default")?store["default"]:store,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1;return buffer+="\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.is,null==stack1||!1===stack1?stack1:stack1.youtube),{hash:{},inverse:self.program(5,program5,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",buffer}function program2(depth0,data){var buffer="",stack1;return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sources,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <div class=\"media video youtube\" data-video-src=\"",(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-video-id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-type=\"youtube\"></div>\n            ",buffer}function program5(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        <video class=\"media video\" poster=\"",(helper=helpers.poster)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.poster,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" controls ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.is,null==stack1||!1===stack1?stack1:stack1.cors),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sources,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Your browser doesn\u2019t support the video player.",options):helperMissing.call(depth0,"__","Your browser doesn\u2019t support the video player.",options)))+"\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.link,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </video>\n        ",buffer}function program6(){return"crossorigin"}function program8(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <source src=\"",(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            ",buffer}function program10(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n            <a href=\"",(helper=helpers.link)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.link,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Please download the video and view offline.",options):helperMissing.call(depth0,"__","Please download the video and view offline.",options)))+"</a>\n            ",buffer}function program12(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        <audio class=\"media audio\" controls ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.is,null==stack1||!1===stack1?stack1:stack1.cors),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sources,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Your browser doesn\u2019t support the audio player.",options):helperMissing.call(depth0,"__","Your browser doesn\u2019t support the audio player.",options)))+"\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.link,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </audio>\n    ",buffer}function program13(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n            <a href=\"",(helper=helpers.link)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.link,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Please download the track and listen offline.",options):helperMissing.call(depth0,"__","Please download the track and listen offline.",options)))+"</a>\n            ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"mediaplayer ",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"player\">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.is,null==stack1||!1===stack1?stack1:stack1.video),{hash:{},inverse:self.program(12,program12,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        <div class=\"overlay\">\n            <a class=\"action play\" data-control=\"play\"><span class=\"icon icon-play\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Play",options):helperMissing.call(depth0,"__","Play",options)))+"\"></span></a>\n            <a class=\"action play\" data-control=\"pause\"><span class=\"icon icon-pause\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+"\"></span></a>\n        </div>\n    </div>\n    <div class=\"controls\">\n        <div class=\"bar\">\n            <div class=\"control actions playback\">\n                <a class=\"action play\" data-control=\"play\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Play",options):helperMissing.call(depth0,"__","Play",options)))+"\"><span class=\"icon icon-play\"></span></a>\n                <a class=\"action play\" data-control=\"pause\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+"\"><span class=\"icon icon-pause\"></span></a>\n            </div>\n            <div class=\"control seek\"><div class=\"slider\"></div></div>\n            <div class=\"control infos timer\">\n                <span class=\"info time\" data-control=\"time-cur\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Current playback position",options):helperMissing.call(depth0,"__","Current playback position",options)))+"\">00:00</span>\n                <span class=\"info time\" data-control=\"time-end\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Total duration",options):helperMissing.call(depth0,"__","Total duration",options)))+"\">00:00</span>\n            </div>\n            <div class=\"control actions sound\">\n                <div class=\"volume\"><div class=\"slider\"></div></div>\n                <a class=\"action mute\" data-control=\"mute\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Mute",options):helperMissing.call(depth0,"__","Mute",options)))+"\"><span class=\"icon icon-sound\"></span></a>\n                <a class=\"action mute\" data-control=\"unmute\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Restore sound",options):helperMissing.call(depth0,"__","Restore sound",options)))+"\"><span class=\"icon icon-mute\"></span></a>\n            </div>\n        </div>\n    </div>\n    <div class=\"error\">\n        <div class=\"message\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"This media cannot be played!",options):helperMissing.call(depth0,"__","This media cannot be played!",options)))+"</div>\n    </div>\n</div>\n",buffer}),_ns=".mediaplayer",_reYoutube=/([?&\/]v[=\/])([\w-]+)([&\/]?)/,_reAppleMobiles=/ip(hone|od)/i,_slice=[].slice,_volumeMin=0,_volumeMax=100,_volumeRange=_volumeMax-_volumeMin,_defaults={type:"video/mp4",video:{width:480,height:270,minWidth:200,minHeight:200},audio:{width:400,height:30,minWidth:200,minHeight:36},options:{volume:_Mathfloor2(.8*_volumeRange),startMuted:!1,maxPlays:0,replayTimeout:0,canPause:!0,canSeek:!0,loop:!1,autoStart:!1}},_mimeTypes={"video/webm":"video/webm; codecs=\"vp8, vorbis\"","video/mp4":"video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"","video/ogg":"video/ogg; codecs=\"theora, vorbis\"","audio/mpeg":"audio/mpeg;","audio/mp4":"audio/mp4; codecs=\"mp4a.40.5\"","audio/ogg":"audio/ogg; codecs=\"vorbis\"","audio/wav":"audio/wav; codecs=\"1\""},_extractYoutubeId=function(url){var res=_reYoutube.exec(url);return res&&res[2]||url},_ensureNumber=function(value){return value=parseFloat(value),isFinite(value)?value:0},_leadingZero=function(n,len){for(var value=n.toString();value.length<len;)value="0"+value;return value},_timerFormat=function(time){var seconds=_Mathfloor2(time%60),minutes=_Mathfloor2(time/60)%60,hours=_Mathfloor2(time/3600),parts=[];return hours&&parts.push(hours),parts.push(_leadingZero(minutes,2)),parts.push(_leadingZero(seconds,2)),parts.join(":")},_needTypeAdjust=function(type){return"string"==typeof type&&0===type.indexOf("application")},_getAdjustedType=function(source){var type="video/ogg",url=source&&source.src||source,ext=url&&url.substr(-4);return(".ogg"===ext||".oga"===ext)&&(type="audio/ogg"),type},_configToSources=function(config){var sources=config.sources||[],url=config.url;return _.isArray(sources)||(sources=[sources]),url&&(!_.isArray(config.url)&&(url=[url]),sources=sources.concat(url)),sources},_checkSupport=function(media,mimeType){var support=!!media.canPlayType;return mimeType&&support&&(support=!!media.canPlayType(_mimeTypes[mimeType]||mimeType).replace(/no/,"")),support},_support={canPlay:function(type,mime){if(type)switch(type.toLowerCase()){case"audio":return this.canPlayAudio(mime);case"youtube":case"video":return this.canPlayVideo(mime);default:return!1;}return this.canPlayAudio()&&this.canPlayVideo()},canPlayAudio:function(mime){return this._mediaAudio||(this._mediaAudio=document.createElement("audio")),_checkSupport(this._mediaAudio,mime)},canPlayVideo:function(mime){return this._mediaVideo||(this._mediaVideo=document.createElement("video")),_checkSupport(this._mediaVideo,mime)},canControl:function(){return!_reAppleMobiles.test(navigator.userAgent)}},_youtubeManager={injected:!1,ready:!1,pending:[],add:function(elem,player,options){this.ready?this.create(elem,player,options):(this.pending.push([elem,player,options]),!this.injected&&this.injectApi())},remove:function(elem,player){var pending=this.pending;_.forEach(pending,function(args,idx){args&&elem===args[0]&&player===args[1]&&(pending[idx]=null)})},create:function(elem,player,options){var $elem;return this.ready?void(!options&&(options={}),$elem=$$1(elem),new window.YT.Player($elem.get(0),{height:$elem.width(),width:$elem.height(),videoId:$elem.data("videoId"),playerVars:{autoplay:0,controls:options.controls?1:0,rel:0,showinfo:0,wmode:"transparent",modestbranding:1,disablekb:1,playsinline:1,enablejsapi:1,origin:location.hostname},events:{onReady:player.onReady.bind(player),onStateChange:player.onStateChange.bind(player)}})):this.add(elem,player,options)},apiReady:function(){var self=this,pending=this.pending;this.pending=[],this.ready=!0,_.forEach(pending,function(args){args&&self.create.apply(self,args)})},isApiReady:function(){var apiReady="undefined"!=typeof window.YT&&"undefined"!=typeof window.YT.Player;return apiReady&&!this.ready&&_youtubeManager.apiReady(),apiReady},injectApi:function(){var self=this;self.isApiReady()||require(["https://www.youtube.com/iframe_api"],function(){(function check(){self.isApiReady()||setTimeout(check,100)})()}),this.injected=!0}},_nativePlayer=function(mediaplayer){var $media,media,player,played;return mediaplayer&&(player={init:function(){var result=!1,mediaElem;return $media=mediaplayer.$media,media=null,played=!1,$media&&(mediaElem=$media.get(0),mediaElem&&mediaElem.canPlayType&&(media=mediaElem,result=!0),!mediaplayer.is("nogui")&&$media.removeAttr("controls"),$media.on("play"+_ns,function(){played=!0,mediaplayer._onPlay()}).on("pause"+_ns,function(){mediaplayer._onPause()}).on("ended"+_ns,function(){played=!1,mediaplayer._onEnd()}).on("timeupdate"+_ns,function(){mediaplayer._onTimeUpdate()}).on("loadstart",function(){media.networkState===HTMLMediaElement.NETWORK_NO_SOURCE&&mediaplayer._onError()}).on("error"+_ns,function(){media.networkState===HTMLMediaElement.NETWORK_NO_SOURCE?mediaplayer._onError():(mediaplayer._onRecoverError(),media.networkState===HTMLMediaElement.NETWORK_LOADING&&mediaplayer.is("playing")&&mediaplayer.render())}).on("loadedmetadata"+_ns,function(){mediaplayer.is("error")&&mediaplayer._onRecoverError(),mediaplayer._onReady()})),result},destroy:function(){$media&&$media.off(_ns).attr("controls",""),this.stop(),$media=null,media=null,played=!1},getPosition:function(){return media?media.currentTime:0},getDuration:function(){return media?media.duration:0},getVolume:function(){var value=0;return media&&(value=parseFloat(media.volume)*_volumeRange+_volumeMin),value},setVolume:function(value){media&&(media.volume=(parseFloat(value)-_volumeMin)/_volumeRange)},setSize:function(width,height){$media&&$media.width(width).height(height)},seek:function(value){media&&(media.currentTime=parseFloat(value),!played&&this.play())},play:function(){media&&media.play()},pause:function(){media&&media.pause()},stop:function(){media&&played&&(media.currentTime=media.duration)},mute:function(state){media&&(media.muted=!!state)},isMuted:function(){return!!media&&!!media.muted},addMedia:function(url,type){return type=type||_defaults.type,(!media||_checkSupport(media,type))&&!!(url&&$media)&&($media.append("<source src=\""+url+"\" type=\""+(_mimeTypes[type]||type)+"\" />"),!0)},setMedia:function(url,type){return!!$media&&($media.empty(),this.addMedia(url,type))}}),player},_players={audio:_nativePlayer,video:_nativePlayer,youtube:function(mediaplayer){function loopEvents(callback){_.forEach(["onStateChange","onPlaybackQualityChange","onPlaybackRateChange","onError","onApiChange"],callback)}var $media,media,player,interval,destroyed,initWidth,initHeight;return mediaplayer&&(player={init:function(){return $media=mediaplayer.$media,media=null,destroyed=!1,$media&&_youtubeManager.add($media,this,{controls:mediaplayer.is("nogui")}),!!$media},onReady:function(event){var callbacks=this._callbacks;media=event.target,$media=$$1(media.getIframe()),this._callbacks=null,destroyed?this.destroy():(initWidth&&initHeight&&this.setSize(initWidth,initHeight),mediaplayer._onReady(),callbacks&&_.forEach(callbacks,function(cb){cb()}))},onStateChange:function(event){if(this.stopPolling(),!destroyed)switch(event.data){case 0:mediaplayer._onEnd();break;case 1:mediaplayer._onPlay(),this.startPolling();break;case 2:mediaplayer._onPause();}},stopPolling:function(){interval&&(clearInterval(interval),interval=null)},startPolling:function(){interval=setInterval(function(){mediaplayer._onTimeUpdate()},mediaplayerFactory.youtubePolling)},destroy:function(){destroyed=!0,media?(loopEvents(function(ev){media.removeEventListener(ev)}),media.destroy()):_youtubeManager.remove($media,this),this.stopPolling(),$media=null,media=null},getPosition:function(){return media?media.getCurrentTime():0},getDuration:function(){return media?media.getDuration():0},getVolume:function(){var value=0;return media&&(value=media.getVolume()*_volumeRange/100+_volumeMin),value},setVolume:function(value){media&&media.setVolume(100*((parseFloat(value)-_volumeMin)/_volumeRange))},setSize:function(width,height){$media&&$media.width(width).height(height),media?media.setSize(width,height):(initWidth=width,initHeight=height)},seek:function(value){media&&media.seekTo(parseFloat(value),!0)},play:function(){media&&media.playVideo()},pause:function(){media&&media.pauseVideo()},stop:function(){media&&(media.stopVideo(),mediaplayer._onEnd())},mute:function(state){media&&media[state?"mute":"unMute"]()},isMuted:function(){return!!media&&media.isMuted()},addMedia:function(url){var id=_extractYoutubeId(url),cb=id&&function(){media.cueVideoById(id)};return!!cb&&(media?cb():(this._callbacks=this._callbacks||[],this._callbacks.push(cb)),!0)},setMedia:function(url){var id=_extractYoutubeId(url),cb=id&&function(){media.loadVideoById(id)};return!!cb&&(media?cb():this._callbacks=[cb],!0)}}),player}},mediaplayer={init:function(config){var self=this;return this.config=_.omit(config||{},function(value){return"undefined"==typeof value||null===value}),_.defaults(this.config,_defaults.options),this._setType(this.config.type||_defaults.type),this._reset(),this._updateVolumeFromStore(),this._initEvents(),this._initSources(function(){self.is("youtube")||_.each(self.config.sources,function(source){if(source&&source.type&&0===source.type.indexOf("audio"))return self._setType(source.type),self._initType(),!1}),self.config.renderTo&&_.defer(function(){self.render()})}),this},destroy:function(){return this.trigger("destroy"),this.player&&this.player.destroy(),this.$component&&(this._unbindEvents(),this._destroySlider(this.$seekSlider),this._destroySlider(this.$volumeSlider),this.$component.remove()),this._reset(),this},render:function(to){var renderTo=to||this.config.renderTo||this.$container;return this.$component&&this.destroy(),this._initState(),this._buildDom(),this._updateDuration(0),this._updatePosition(0),this._bindEvents(),this._playingState(!1,!0),this._initPlayer(),this._initSize(),this.resize(this.config.width,this.config.height),this.config.is.rendered=!0,renderTo&&(this.$container=$$1(renderTo).append(this.$component)),this.trigger("render",this.$component),this},seek:function(time,internal){return this._canPlay()&&(this._updatePosition(time,internal),this.execute("seek",this.position),!this.is("ready")&&(this.autoStartAt=this.position),this.loop=!!this.config.loop),this},play:function(time){return this._canPlay()&&("undefined"!=typeof time&&this.seek(time),this.execute("play"),!this.is("ready")&&(this.autoStart=!0),this.loop=!!this.config.loop,this.timerId&&cancelAnimationFrame(this.timerId)),this},pause:function(time){return this._canPause()&&("undefined"!=typeof time&&this.seek(time),this.execute("pause"),!this.is("ready")&&(this.autoStart=!1)),this},resume:function(){return this._canResume()&&this.play(),this},stop:function(){return this.loop=!1,this.execute("stop"),this.is("ready")||(this.autoStart=!1),this},restart:function(){return this.play(0),this},rewind:function(){return this.seek(0),this},mute:function(state){return"undefined"==typeof state&&(state=!0),this.execute("mute",state),this._setState("muted",state),this.is("ready")||(this.startMuted=state),this},unmute:function(){return this.mute(!1),this},setVolume:function(value,internal){return this._updateVolume(value,internal),this.execute("setVolume",this.volume),this},getVolume:function(){return this.volume},getPosition:function(){return this.position},getDuration:function(){return this.duration},getTimesPlayed:function(){return this.timesPlayed},getType:function(){return this.type},getContainer:function(){var $container;return!this.$container&&this.$component&&($container=this.$component.parent(),$container.length&&(this.$container=$container)),this.$container},getElement:function(){return this.$component},getSources:function(){return this.config.sources.slice()},setSource:function(src,callback){return this._getSource(src,function(source){this.config.sources=[source],this.is("rendered")&&this.player.setMedia(source.src,source.type),callback&&callback.call(this,source)}),this},addSource:function(src,callback){return this._getSource(src,function(source){this.config.sources.push(source),this.is("rendered")&&this.player.addMedia(source.src,source.type),callback&&callback.call(this,source)}),this},is:function(state){return!!this.config.is[state]},resize:function(width,height){var type=this.is("video")?"video":"audio",defaults=_defaults[type]||_defaults.video;return width=_Mathmax(defaults.minWidth,width),height=_Mathmax(defaults.minHeight,height),this.config.width=width,this.config.height=height,this.$component&&(height-=this.$component.outerHeight()-this.$component.height(),width-=this.$component.outerWidth()-this.$component.width(),this.$component.width(width).height(height),!this.is("nogui")&&(height-=this.$controls.outerHeight())),this.execute("setSize",width,height),this},enable:function(){return this._fromState("disabled"),this},disable:function(){return this._toState("disabled"),this.trigger("disabled"),this},show:function(){return this._fromState("hidden"),this},hide:function(){return this._toState("hidden"),this},_setType:function(type){this.type=-1===type.indexOf("youtube")?0===type.indexOf("audio")?"audio":"video":"youtube"},_initType:function(){var is=this.config.is;is.youtube="youtube"===this.type,is.video="video"===this.type||"youtube"===this.type,is.audio="audio"===this.type},_getSource:function(src,callback){function done(){_needTypeAdjust(source.type)&&(source.type=_getAdjustedType(source)),self.is("youtube")&&(source.id=_extractYoutubeId(source.src)),callback.call(self,source)}var self=this,source;source=_.isString(src)?{src:src}:_.clone(src),this.is("youtube")&&!source.type&&(source.type=_defaults.type),source.type?done():mimetype.getResourceType(source.src,function(err,type){err&&(type=_defaults.type),source.type=type,done()})},_initSources:function(callback){var self=this,sources=_configToSources(this.config);this.config.sources=[],async.each(sources,function(source,cb){self.addSource(source,function(src){cb(null,src)})},callback)},_initEvents:function(){var triggerEvent;eventifier(this),triggerEvent=this.trigger,this.trigger=function(eventName){return this.$component&&this.$component.trigger(eventName+_ns,_slice.call(arguments,1)),triggerEvent.apply(this,arguments)}},_initSize:function(){var type=this.is("video")?"video":"audio",defaults=_defaults[type]||_defaults.video;this.config.width=_.parseInt(this.config.width)||defaults.width,this.config.height=_.parseInt(this.config.height)||defaults.height},_initPlayer:function(){var player=_players[this.type],error;_support.canPlay(this.type)?(_.isFunction(player)&&(this.player=player(this)),error=!this.player||!this.player.init()):error=!0,this._setState("error",error),this._setState("nogui",!_support.canControl()),this._setState("loading",!0)},_initState:function(){var isCORS=!1,page;this.is("youtube")||(page=new UrlParser(window.location),isCORS=_.some(this.config.sources,function(source){return!page.sameDomain(source.src)})),this._setState("cors",isCORS),this._setState("ready",!1)},_reset:function(){this.config.is={},this._initType(),this.$component=null,this.$container=null,this.$player=null,this.$media=null,this.$controls=null,this.$seek=null,this.$seekSlider=null,this.$sound=null,this.$volume=null,this.$volumeControl=null,this.$volumeSlider=null,this.$position=null,this.$duration=null,this.player=null,this.duration=0,this.position=0,this.timesPlayed=0,this.volume=this.config.volume,this.autoStart=this.config.autoStart,this.autoStartAt=this.config.autoStartAt,this.startMuted=this.config.startMuted},_buildDom:function(){this.$component=$$1(playerTpl(this.config)),this.$player=this.$component.find(".player"),this.$media=this.$component.find(".media"),this.$controls=this.$component.find(".controls"),this.$seek=this.$controls.find(".seek .slider"),this.$sound=this.$controls.find(".sound"),this.$volumeControl=this.$controls.find(".volume"),this.$volume=this.$controls.find(".volume .slider"),this.$position=this.$controls.find("[data-control=\"time-cur\"]"),this.$duration=this.$controls.find("[data-control=\"time-end\"]"),this.$volumeSlider=this._renderSlider(this.$volume,this.volume,_volumeMin,_volumeMax,!0)},_renderSlider:function($elt,value,min,max,vertical){var orientation,direction;return vertical?(orientation="vertical",direction="rtl"):(orientation="horizontal",direction="ltr"),$elt.noUiSlider({start:_ensureNumber(value)||0,step:1,connect:"lower",orientation:orientation,direction:direction,animate:!0,range:{min:_ensureNumber(min)||0,max:_ensureNumber(max)||0}})},_destroySlider:function($elt){$elt&&$elt.get(0).destroy()},_bindEvents:function(){var self=this,overing=!1;this.$component.on("contextmenu"+_ns,function(event){event.preventDefault()}),this.$controls.on("click"+_ns,".action",function(event){var $target=$$1(event.target),$action=$target.closest(".action"),id=$action.data("control");_.isFunction(self[id])&&self[id]()}),this.$player.on("click"+_ns,function(){self.is("playing")?self.pause():self.play()}),this.$seek.on("change"+_ns,function(event,value){self.seek(value,!0)}),$$1(document).on("updateVolume"+_ns,function(event,value){self.setVolume(value)}),this.$volume.on("change"+_ns,function(event,value){self.unmute(),$$1(document).trigger("updateVolume"+_ns,value),self.setVolume(value,!0)}),this.$sound.on("mouseover"+_ns,"a",function(){var position;overing||self.$volumeControl.hasClass("up")||self.$volumeControl.hasClass("down")||(overing=!0,position=self.$controls[0].getBoundingClientRect(),position&&position.top&&position.top<200?self.$volumeControl.addClass("down"):self.$volumeControl.addClass("up"),self.overingTimer=_.delay(function(){self.$volumeControl&&self.$volumeControl.removeClass("up down"),overing=!1},15e3),self.$volumeControl.one("mouseleave"+_ns,function(){self.$volumeControl.removeClass("up down"),overing=!1}))})},_unbindEvents:function(){this.$component.off(_ns),this.$player.off(_ns),this.$controls.off(_ns),this.$seek.off(_ns),this.$volume.off(_ns),this.overingTimer&&clearTimeout(this.overingTimer),$$1(document).off(_ns)},_updateVolumeSlider:function(value){this.$volumeSlider&&this.$volumeSlider.val(value)},_updateVolume:function(value,internal){this.volume=_Mathmax(_volumeMin,_Mathmin(_volumeMax,parseFloat(value))),this._storeVolume(this.volume),internal||this._updateVolumeSlider(value)},_updatePositionSlider:function(value){this.$seekSlider&&this.$seekSlider.val(value)},_updatePositionLabel:function(value){this.$position&&this.$position.text(_timerFormat(value))},_updatePosition:function(value,internal){this.position=_Mathmax(0,_Mathmin(this.duration,parseFloat(value))),internal||this._updatePositionSlider(this.position),this._updatePositionLabel(this.position)},_updateDurationSlider:function(value){this.$seekSlider&&(this._destroySlider(this.$seekSlider),this.$seekSlider=null),value&&isFinite(value)&&(this.$seekSlider=this._renderSlider(this.$seek,0,0,value),this.$seekSlider.attr("disabled",!this.config.canSeek))},_updateDurationLabel:function(value){this.$duration&&(value&&isFinite(value)?this.$duration.text(_timerFormat(value)).show():this.$duration.hide())},_updateDuration:function(value){this.duration=_Mathabs(parseFloat(value)),this._updateDurationSlider(this.duration),this._updateDurationLabel(this.duration)},_onReady:function(){this._updateDuration(this.player.getDuration()),this._setState("ready",!0),this._setState("canplay",!0),this._setState("canpause",this.config.canPause),this._setState("canseek",this.config.canSeek),this._setState("loading",!1),this.trigger("ready"),this.setVolume(this.volume),this.mute(!!this.startMuted),this.autoStartAt?this.seek(this.autoStartAt):this.autoStart&&this.play()},_storeVolume:function(volume){return store("mediaVolume").then(function(volumeStore){volumeStore.setItem("volume",volume)})},_updateVolumeFromStore:function(){var self=this;return store("mediaVolume").then(function(volumeStore){return volumeStore.getItem("volume")}).then(function(volume){_.isNumber(volume)&&(self.volume=_Mathmax(_volumeMin,_Mathmin(_volumeMax,parseFloat(volume))),self.setVolume(self.volume))})},_onError:function(){this._setState("error",!0),this._setState("loading",!1),this.trigger("error")},_onRecoverError:function(){this._setState("error",!1),this.trigger("recovererror")},_onPlay:function(){this._playingState(!0),this.trigger("play",this.$media[0])},_onPause:function(){this._playingState(!1),this.trigger("pause")},_onEnd:function(){this.timesPlayed++,this._playingState(!1,!0),this._updatePosition(0),this._playLimitReached()?(this._disableGUI(),this.trigger("limitreached")):this.loop?this.restart():0<parseInt(this.config.replayTimeout,10)&&(this.replayTimeoutStartMs=new window.Date().getTime(),this._replayTimeout()),this.trigger("ended")},_onTimeUpdate:function(){this._updatePosition(this.player.getPosition()),this.trigger("update")},_replayTimeout:function(){var nowMs=new window.Date().getTime(),elapsedSeconds=_Mathfloor2((nowMs-this.replayTimeoutStartMs)/1e3);this.timerId=requestAnimationFrame(this._replayTimeout.bind(this)),elapsedSeconds>=parseInt(this.config.replayTimeout,10)&&(this._disableGUI(),this.disable(),cancelAnimationFrame(this.timerId))},_disableGUI:function(){this._setState("ready",!1),this._setState("canplay",!1)},_playLimitReached:function(){return this.config.maxPlays&&this.timesPlayed>=this.config.maxPlays},_canPlay:function(){return this.is("ready")&&!this.is("disabled")&&!this.is("hidden")&&!this._playLimitReached()},_canPause:function(){return!!this.config.canPause},_canSeek:function(){return!!this.config.canSeek},_canResume:function(){return this.is("paused")&&this._canPlay()},_setState:function(name,value){return value=!!value,this.config.is[name]=value,this.$component&&this.$component.toggleClass(name,value),this},_fromState:function(stateName){return this._setState(stateName,!1),this.resume(),this},_toState:function(stateName){return this.pause(),this._setState(stateName,!0),this},_playingState:function(state,ended){return this._setState("playing",!!state),this._setState("paused",!state),this._setState("ended",!!ended),this},execute:function(command){var ctx=this.player,method=ctx&&ctx[command];if(_.isFunction(method))return method.apply(ctx,_slice.call(arguments,1))}},mediaplayerFactory=function(config){var player=_.clone(mediaplayer);return player.init(config)};return mediaplayerFactory.canPlay=function(type,mime){return _support.canPlay(type,mime)},mediaplayerFactory.canPlayAudio=function(mime){return _support.canPlayAudio(mime)},mediaplayerFactory.canPlayVideo=function(mime){return _support.canPlayVideo(mime)},mediaplayerFactory.canControl=function(){return _support.canControl()},mediaplayerFactory.youtubePolling=100,mediaplayerFactory}),define("core/providerRegistry",["lodash"],function(_){'use strict';return _=_&&_.hasOwnProperty("default")?_["default"]:_,function(target,validator){function registerProvider(name,provider){var valid=!0;if(!_.isString(name)||0>=name.length)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init))throw new TypeError("A provider is an object that contains at least an init function.");return valid=validator&&_.isFunction(validator)?validator(provider):valid,valid&&(_providers[name]=provider),this}function getProvider(providerName){var provider;if(!_providers||0===_.size(_providers))throw new Error("No provider registered");if(_.isString(providerName)&&0<providerName.length?provider=_providers[providerName]:1===_.size(_providers)&&(providerName=_.keys(_providers)[0],provider=_providers[providerName]),!provider)throw new Error("No candidate found for the provider");return provider}function getAvailableProviders(){return _.keys(_providers)}var _providers={};return target=target||{},target.registerProvider=registerProvider,target.getProvider=getProvider,target.getAvailableProviders=getAvailableProviders,target.clearProviders=function(){return _providers={},this},target}}),define("ui/documentViewer/viewerFactory",["lodash","core/providerRegistry","core/delegator","ui/component"],function(_,providerRegistry,delegator,component){'use strict';function viewerFactory(documentType,config){var viewer=viewerFactory.getProvider(documentType),documentViewer=component({getType:function(){return this.config.type},getUrl:function(){return this.config.url}},defaults),delegate=delegator(documentViewer,viewer,{name:documentType+"Viewer",eventifier:!1,wrapper:function(response){return Promise.resolve(response)}});return _.isFunction(viewer.getTemplate)&&documentViewer.setTemplate(viewer.getTemplate()),documentViewer.on("init",function(){var self=this;delegate("init").then(function(){self.trigger("initialized")}).catch(function(err){self.trigger("error",err)})}).on("destroy",function(){var self=this;delegate("unload").then(function(){self.trigger("unloaded")}).catch(function(err){self.trigger("error",err)})}).on("render",function(){var self=this;delegate("load").then(function(){self.trigger("loaded")}).catch(function(err){self.trigger("error",err)})}).on("setsize",function(width,height){var self=this;delegate("setSize",width,height).then(function(){self.trigger("resized",width,height)}).catch(function(err){self.trigger("error",err)})}).init(config)}_=_&&_.hasOwnProperty("default")?_["default"]:_,providerRegistry=providerRegistry&&providerRegistry.hasOwnProperty("default")?providerRegistry["default"]:providerRegistry,delegator=delegator&&delegator.hasOwnProperty("default")?delegator["default"]:delegator,component=component&&component.hasOwnProperty("default")?component["default"]:component;var defaults={width:"auto",height:"auto",fitToWidth:!1,allowSearch:!1,caseSensitiveSearch:!1,highlightAllMatches:!1},mandatory=["load"],viewerFactory$1=providerRegistry(viewerFactory,function(provider){return _.each(mandatory,function(name){if(!_.isFunction(provider[name]))throw new TypeError("The viewer provider MUST implement the "+name+"() method!")}),!0});return viewerFactory$1}),define("css!ui/documentViewer/css/documentViewer",[],function(){}),define("ui/documentViewer",["lodash","ui/component","ui/documentViewer/viewerFactory","handlebars","i18n","lib/dompurify/purify","css!ui/documentViewer/css/documentViewer.css"],function(_,component,viewerFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function documentViewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function documentViewerFactory(config){var documentType,documentUrl,viewer;return component({getType:function(){return documentType||null},getUrl:function(){return documentUrl||null},getViewer:function(){return viewer||null},load:function(url,type){var self=this;if(_.isEmpty(url)||!_.isString(url))throw new TypeError("You must provide the URL of the document!");if(_.isEmpty(type)||!_.isString(type))throw new TypeError("You must provide a document type!");return viewer&&viewer.destroy(),documentType=type,documentUrl=url,viewer=viewerFactory(documentType,_.merge({type:documentType,url:documentUrl,replace:!0},_.pick(this.config,_.keys(defaults)))).on("loaded",function(){self.trigger("loaded",documentUrl,documentType)}).on("unloaded",function(){self.trigger("unloaded",documentUrl,documentType)}).on("resized",function(width,height){self.trigger("resized",width,height)}).on("error",function(err){self.trigger("error",err)}),this.trigger("load",documentUrl,documentType),this.is("rendered")&&viewer.render(this.getElement()),this},unload:function(){return viewer&&viewer.destroy(),this.trigger("unload",documentUrl,documentType),viewer=null,documentType=null,documentUrl=null,this}},defaults).setTemplate(documentViewerTpl).on("init",function(){viewer=null,documentType=null,documentUrl=null}).on("destroy",function(){this.unload()}).on("render",function(){viewer&&viewer.render(this.getElement())}).on("setsize",function(width,height){viewer&&viewer.setSize(width,height)}).init(config)}_=_&&_.hasOwnProperty("default")?_["default"]:_,component=component&&component.hasOwnProperty("default")?component["default"]:component,viewerFactory=viewerFactory&&viewerFactory.hasOwnProperty("default")?viewerFactory["default"]:viewerFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"document-viewer\"></div>"}),defaults={width:"auto",height:"auto",fitToWidth:!1,allowSearch:!1,caseSensitiveSearch:!1,highlightAllMatches:!1};return documentViewerFactory.registerProvider=function(type,provider){return viewerFactory.registerProvider(type,provider),this},documentViewerFactory.clearProviders=function(){return viewerFactory.clearProviders(),this},documentViewerFactory}),define("core/requireIfExists",["core/promise"],function(Promise){'use strict';function requireIfExists(uri){return new Promise(function(resolve){require([uri],resolve,function(err){var failedId=err.requireModules&&err.requireModules[0];if(failedId===uri)requirejs.undef(failedId),define(failedId,function(){return null}),require([failedId],resolve);else throw err})})}return Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,requireIfExists}),define("ui/documentViewer/providers/pdfViewer/fallback/viewer",["handlebars","i18n","lodash","lib/dompurify/purify"],function(Handlebars,__,_,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function viewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,_=_&&_.hasOwnProperty("default")?_["default"]:_,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<iframe ></iframe>"});return function($container){var template=viewerTpl(),$viewer=null;return{load:function(url){return new Promise(function(resolve){$viewer=$container.html(template).find("iframe"),$viewer.one("load.provider",resolve).attr("src",url)})},unload:function(){$container.empty(),$viewer=null},setSize:function(width,height){$viewer&&$viewer.width(width).height(height)}}}}),define("ui/areaBroker",["jquery","lodash"],function($,_){'use strict';function areaBroker(requiredAreas,$container,mapping){var components={},broker,areas;if(("string"==typeof $container||$container instanceof HTMLElement)&&($container=$($container)),!$container||!$container.length)throw new TypeError("Please provide the areaBroker a container");return requiredAreas=requiredAreas||[],broker={defineAreas:function(areasMapping){var keys,required;if(!_.isPlainObject(areasMapping))throw new TypeError("A mapping has the form of a plain object");if(keys=_.keys(areasMapping),required=_.all(requiredAreas,function(val){return _.contains(keys,val)}),!required)throw new TypeError("You have to define a mapping for at least : "+requiredAreas.join(", "));areas=areasMapping},getContainer:function(){return $container},getArea:function(name){if(_.isEmpty(areas))throw new Error("Sorry areas have not been defined yet!");return areas[name]},setComponent:function(areaName,component){if(!areas[areaName])throw new TypeError("There is no areas defined or no area named "+areaName);if(!_.isObject(component))throw new TypeError("A component has to be an object");components[areaName]=component,this["get"+areaName[0].toUpperCase()+areaName.slice(1)]=this.getComponent.bind(this,areaName)},getComponent:function(areaName){return components[areaName]}},broker.defineAreas(mapping),_.forEach(requiredAreas,function(area){var areaIdentifier=area[0].toUpperCase()+area.slice(1);broker["get"+areaIdentifier+"Area"]=_.bind(_.partial(broker.getArea,area),broker)}),broker}return $=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,areaBroker}),define("ui/documentViewer/providers/pdfViewer/pdfjs/areaBroker",["lodash","ui/areaBroker"],function(_,areaBroker$1){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,areaBroker$1=areaBroker$1&&areaBroker$1.hasOwnProperty("default")?areaBroker$1["default"]:areaBroker$1;var areaBroker=_.partial(areaBroker$1,["bar","actions","info","content"]);return areaBroker}),define("ui/autoscroll",["jquery"],function($){'use strict';var _Mathmin2=Math.min,_Mathmax2=Math.max;return $=$&&$.hasOwnProperty("default")?$["default"]:$,function(element,container){return new Promise(function(resolve){var $element=$(element),$container=$(container||$element.parent()),currentScrollTop,minScrollTop,maxScrollTop,scrollTop;$element.length&&$container.length?(currentScrollTop=$container.scrollTop(),maxScrollTop=$element.offset().top-$container.offset().top+currentScrollTop,minScrollTop=maxScrollTop-$container.height()+$element.outerHeight(),scrollTop=_Mathmax2(_Mathmin2(maxScrollTop,currentScrollTop),minScrollTop),scrollTop===currentScrollTop?resolve():$container.animate({scrollTop:scrollTop}).promise().done(resolve)):resolve()})}}),define("ui/documentViewer/providers/pdfViewer/pdfjs/searchEngine",["lodash","handlebars","i18n","lib/dompurify/purify"],function(_,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function matchTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function normalizeSpecialChars(text){return text.replace(normalizationRegex,function(ch){return charactersToNormalize[ch]})}function findInText(query,text){var queryLen=query.length,end=0,matches=[],index;if(queryLen)do index=text.indexOf(query,end),end=index+queryLen,-1!==index&&matches.push([index,end]);while(-1!==index);return matches}function findInDocument(query,contentText,config){var normalizedQuery=normalizeSpecialChars(query);return config.caseSensitive||(normalizedQuery=normalizedQuery.toLowerCase()),_.times(contentText.length,function(pageIndex){var pageContent=normalizeSpecialChars(contentText[pageIndex]);return config.caseSensitive||(pageContent=pageContent.toLowerCase()),findInText(normalizedQuery,pageContent)})}function highlight(text,index,cls){return matchTpl({text:text,index:index,cls:cls}).trim()}function highlightInText(text,start,end,index,cls){return text.substring(0,start)+highlight(text.substring(start,end),index,cls)+text.substring(end)}function refineMatches(matches,pageContent){var refinedMatches=[],textItems=pageContent.content.items,count=textItems.length,cursor=0,strPos=0;return _.forEach(matches,function(match,index){for(var matchStart=match[0],matchEnd=match[1],position={index:index};cursor<count&&matchStart>=strPos+textItems[cursor].str.length;)strPos+=textItems[cursor].str.length,cursor++;for(position.begin={node:cursor,offset:matchStart-strPos};cursor<count&&matchEnd>strPos+textItems[cursor].str.length;)strPos+=textItems[cursor].str.length,cursor++;position.end={node:cursor,offset:matchEnd-strPos},refinedMatches.push(position)}),refinedMatches}function renderMatches(matches,pageContent,selectedMatch){var positions=refineMatches(matches,pageContent),matchIndex=positions.length-1,nodes=pageContent.nodes,selected=matchIndex===selectedMatch;_.forEachRight(nodes,function(node,nodeIndex){for(var nodeText=pageContent.content.items[nodeIndex].str,match,startInNode,endInNode,nodeInMatch,cls;0<=matchIndex;){if(match=positions[matchIndex],startInNode=match.begin.node===nodeIndex,endInNode=match.end.node===nodeIndex,nodeInMatch=nodeIndex>match.begin.node&&nodeIndex<match.end.node,cls=selected?" selected":"",startInNode&&endInNode)nodeText=highlightInText(nodeText,match.begin.offset,match.end.offset,match.index,cls),matchIndex--;else if(startInNode)nodeText=highlightInText(nodeText,match.begin.offset,nodeText.length,match.index,"begin"+cls),matchIndex--;else if(endInNode){nodeText=highlightInText(nodeText,0,match.end.offset,match.index,"end"+cls);break}else if(nodeInMatch){nodeText=highlight(nodeText,match.index,"middle"+cls);break}else break;selected=matchIndex===selectedMatch}node.innerHTML=nodeText})}function pdfjsSearchFactory(config){var textManager=null,currentQuery=null,currentMatch=null,matches=[],pages=[],count=0;if(config=config||{},textManager=config.textManager,!_.isPlainObject(textManager))throw new TypeError("You must provide a textManager to give access to the PDF text content! [config.textManager is missing]");return{getPages:function(){return pages},getMatches:function(){return matches},getMatchCount:function(){return count},clearMatches:function(){currentMatch=null,matches=[],pages=[],count=0},setTextManager:function(manager){textManager=manager},getTextManager:function(){return textManager},getQuery:function(){return currentQuery},getCurrentMatch:function(){return currentMatch},previousMatch:function(){var loop=!1,pageIndex;return currentMatch&&(currentMatch.index?currentMatch.index--:(pageIndex=_.indexOf(pages,currentMatch.page),loop=!pageIndex,currentMatch.page=pages[(pageIndex+pages.length-1)%pages.length],currentMatch.index=matches[currentMatch.page-1].length-1),currentMatch.overall=(currentMatch.overall+count-2)%count+1),loop},nextMatch:function(){var loop=!1,pageIndex;return currentMatch&&(currentMatch.index+1<matches[currentMatch.page-1].length?currentMatch.index++:(pageIndex=_.indexOf(pages,currentMatch.page),loop=pageIndex===pages.length-1,currentMatch.page=pages[(pageIndex+1)%pages.length],currentMatch.index=0),currentMatch.overall=currentMatch.overall%count+1),loop},search:function(query,pageNum){return matches=null,textManager.getContents().then(function(pageContents){var contentText=_.map(pageContents,"text"),firstPage=0,firstMatch=0;return matches=findInDocument(query,contentText,config),currentQuery=query,currentMatch=null,pages=[],count=0,_.forEach(matches,function(pageMatches,pageIndex){var page=pageIndex+1;0<pageMatches.length&&(pages.push(page),!firstPage&&page>=pageNum&&(firstPage=page,firstMatch=count)),count+=pageMatches.length}),firstPage||(firstPage=pages[0]||0),firstPage&&(currentMatch={overall:firstMatch+1,page:firstPage,index:0}),firstPage})},updateMatches:function(pageNum){return textManager.getPageContent(pageNum).then(function(pageContent){var selectedMatch;return currentMatch&&currentMatch.page===pageNum&&(selectedMatch=currentMatch.index),pageContent&&renderMatches(matches[pageNum-1],pageContent,selectedMatch),pageNum})},destroy:function(){textManager=null,currentQuery=null,currentMatch=null,matches=null,pages=null,config=null}}}_=_&&_.hasOwnProperty("default")?_["default"]:_,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"highlight ",(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-match=\"",(helper=helpers.index)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.index,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n",buffer}),charactersToNormalize={"‘":"'","’":"'","‚":"'","‛":"'","“":"\"","”":"\"","„":"\"","‟":"\"","¼":"1/4","½":"1/2","¾":"3/4"},normalizationRegex=new RegExp("["+Object.keys(charactersToNormalize).join("")+"]","g");return pdfjsSearchFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/findBar",["jquery","lodash","ui/autoscroll","ui/hider","ui/documentViewer/providers/pdfViewer/pdfjs/searchEngine","handlebars","i18n","lib/dompurify/purify"],function($$1,_,autoscroll,hider,searchEngineFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function findBarTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function toggleState($element,enabled){enabled?$element.removeAttr("disabled"):$element.attr("disabled",!0)}function pdfjsFindBarFactory(config){function doSearch(){loopBegin=!1,loopEnd=!1,query?searchEngine&&(events.trigger("searching",query),searchEngine.search(query,pageNum).then(function(page){events.trigger("searchdone",query,page),page?jumpTo(page):refresh()}).catch(function(err){events.trigger("error",err)})):(searchEngine&&searchEngine.clearMatches(),refresh()),updateControls()}function updateMatches(page){var textManager=searchEngine&&searchEngine.getTextManager();if(textManager&&textManager.getDocument())return events.trigger("matchesupdating",page),searchEngine.updateMatches(page).then(matchUpdated)}function jumpTo(page){events.trigger("setpage",page)}function refresh(){events.trigger("refresh")}function matchUpdated(page){navigating&&(navigating=!1,focusOnMatch()),updateControls(),events.trigger("matchesupdated",page)}function jumpToMatch(){var match;searchEngine&&(match=searchEngine.getCurrentMatch(),match&&(navigating=!0,pageNum===match.page?updateSelection():jumpTo(match.page)))}function moveBy(direction){loopBegin=!1,loopEnd=!1,searchEngine&&(0>direction?loopEnd=searchEngine.previousMatch():loopBegin=searchEngine.nextMatch(),jumpToMatch()),updateControls(),focusOnInput()}function getSelectectMatchElement(){return broker.getContentArea().find(".highlight.selected")}function getCurrentMatchElement(){var match=searchEngine.getCurrentMatch();return broker.getContentArea().find("[data-match=\""+match.index+"\"]")}function updateSelection(){broker&&searchEngine&&(getSelectectMatchElement().removeClass("selected"),getCurrentMatchElement().addClass("selected"),matchUpdated(pageNum))}function focusOnMatch(){broker&&searchEngine&&autoscroll(getSelectectMatchElement(),broker.getContentArea())}function focusOnInput(){controls.$searchQuery.focus()}function readCaseSensitiveOption(){config.caseSensitive=controls.$caseSensitive.is(":checked")}function applyHighlightAllOption(){broker&&broker.getContentArea().toggleClass("highlight-all",controls.$highlightAll.is(":checked"))}function checkQuery(){var typedQuery=controls.$searchQuery.val();typedQuery!==query&&(query=typedQuery,navigating=!0,doSearch())}function fetchControls($container){return{$searchBar:$$1(".pdf-find-bar",$container),$searchButton:$$1("[data-control=\"pdf-search\"]",$container),$searchQuery:$$1("[data-control=\"pdf-search-query\"]",$container),$prevMatch:$$1("[data-control=\"pdf-search-prev\"]",$container),$nextMatch:$$1("[data-control=\"pdf-search-next\"]",$container),$caseSensitive:$$1("[data-control=\"case-sensitive-search\"]",$container),$highlightAll:$$1("[data-control=\"highlight-all\"]",$container),$matchIndex:$$1("[data-control=\"pdf-search-index\"]",$container),$matchCount:$$1("[data-control=\"pdf-search-count\"]",$container),$searchPosition:$$1("[data-control=\"pdf-search-position\"]",$container),$searchLoopBegin:$$1("[data-control=\"pdf-search-loop-begin\"]",$container),$searchLoopEnd:$$1("[data-control=\"pdf-search-loop-end\"]",$container)}}function updateControls(){var matchCount=0,matchIndex=0,match;searchEngine&&(matchCount=searchEngine.getMatchCount(),match=searchEngine.getCurrentMatch(),matchIndex=match&&match.overall),enabled||hider.isHidden(controls.$searchBar)||hider.hide(controls.$searchBar),toggleState(controls.$searchButton,enabled),toggleState(controls.$searchQuery,enabled),toggleState(controls.$caseSensitive,enabled),toggleState(controls.$highlightAll,enabled),toggleState(controls.$prevMatch,enabled&&1<matchCount),toggleState(controls.$nextMatch,enabled&&1<matchCount),controls.$matchIndex.text(matchIndex),controls.$matchCount.text(matchCount),hider.toggle(controls.$searchPosition,enabled&&0<matchCount),hider.toggle(controls.$searchLoopBegin,enabled&&loopBegin),hider.toggle(controls.$searchLoopEnd,enabled&&loopEnd)}var throttledSearchStart=_.throttle(checkQuery,250),events=null,broker=null,searchEngine=null,query=null,pageNum=0,enabled=!0,loopBegin=!1,loopEnd=!1,navigating=!1,controls;if(config=config||{},!_.isPlainObject(config.events))throw new TypeError("You must provide an events hub! [config.events is missing]");if(!_.isPlainObject(config.areaBroker))throw new TypeError("You must provide an areaBroker to give access to the UI! [config.areaBroker is missing]");if(!_.isPlainObject(config.textManager))throw new TypeError("You must provide a textManager to give access to the PDF text content! [config.textManager is missing]");return searchEngine=searchEngineFactory(config),broker=config.areaBroker,events=config.events,broker.getActionsArea().prepend(findBarTpl(config)),controls=fetchControls(broker.getBarArea()),readCaseSensitiveOption(),applyHighlightAllOption(),controls.$searchButton.on("click",function(){hider.toggle(controls.$searchBar),hider.isHidden(controls.$searchBar)||focusOnInput()}),controls.$prevMatch.on("click",function(){moveBy(-1)}),controls.$nextMatch.on("click",function(){moveBy(1)}),controls.$caseSensitive.on("change",function(){navigating=!0,readCaseSensitiveOption(),doSearch(),focusOnInput()}),controls.$highlightAll.on("change",function(){applyHighlightAllOption(),focusOnInput()}),controls.$searchQuery.on("keypress",function(event){switch(event.keyCode){case 27:hider.hide(controls.$searchBar);break;default:throttledSearchStart();}}),events.on("enable.findbar",function(){enabled=!0,updateControls()}).on("disable.findbar",function(){enabled=!1,updateControls()}).on("pagechange.findbar",function(page){pageNum=page,updateControls()}).on("allrendered.findbar",function(page){pageNum=page,updateMatches(page),updateControls()}).trigger("init.findbar"),{getSearchEngine:function(){return searchEngine},destroy:function(){searchEngine&&searchEngine.destroy(),controls.$searchButton&&controls.$searchButton.remove(),controls.$searchBar&&controls.$searchBar.remove(),controls={},config=null,searchEngine=null,broker=null,events.trigger("destroy.findbar"),events.off(".findbar"),events=null}}}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,autoscroll=autoscroll&&autoscroll.hasOwnProperty("default")?autoscroll["default"]:autoscroll,hider=hider&&hider.hasOwnProperty("default")?hider["default"]:hider,searchEngineFactory=searchEngineFactory&&searchEngineFactory.hasOwnProperty("default")?searchEngineFactory["default"]:searchEngineFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(){return"checked "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<button class=\"small search\" data-control=\"pdf-search\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Search",options):helperMissing.call(depth0,"__","Search",options)))+"\"><span class=\"icon icon-find\"></span></button>\n<div class=\"pdf-find-bar hidden\">\n    <label for=\"pdf-search-query\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Search",options):helperMissing.call(depth0,"__","Search",options)))+":</label>\n    <input type=\"text\" id=\"pdf-search-query\" data-control=\"pdf-search-query\" placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Type your search",options):helperMissing.call(depth0,"__","Type your search",options)))+"\"/>\n    <button class=\"small search\" data-control=\"pdf-search-prev\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous match",options):helperMissing.call(depth0,"__","Previous match",options)))+"\"><span class=\"icon icon-left\"></span></button>\n    <button class=\"small search\" data-control=\"pdf-search-next\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next match",options):helperMissing.call(depth0,"__","Next match",options)))+"\"><span class=\"icon icon-right\"></span></button>\n    <input type=\"checkbox\" id=\"highlight-all\" data-control=\"highlight-all\" value=\"1\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.highlightAll,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/><label for=\"highlight-all\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Highlight all",options):helperMissing.call(depth0,"__","Highlight all",options)))+"</label>\n    <input type=\"checkbox\" id=\"case-sensitive-search\" data-control=\"case-sensitive-search\" value=\"1\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.caseSensitive,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/><label for=\"case-sensitive-search\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Case sensitive",options):helperMissing.call(depth0,"__","Case sensitive",options)))+"</label>\n    <span class=\"pdf-search-info\" data-control=\"pdf-search-info\">\n        <span class=\"pdf-search-position hidden\" data-control=\"pdf-search-position\">\n            <span class=\"pdf-search-index\" data-control=\"pdf-search-index\"></span>/<span class=\"pdf-search-count\" data-control=\"pdf-search-count\"></span>\n        </span>\n        <span class=\"pdf-search-loop hidden\" data-control=\"pdf-search-loop-begin\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"End of document reached. Continuing from the beginning.",options):helperMissing.call(depth0,"__","End of document reached. Continuing from the beginning.",options)))+"\n        </span>\n        <span class=\"pdf-search-loop hidden\" data-control=\"pdf-search-loop-end\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start of document reached. Continuing from the end.",options):helperMissing.call(depth0,"__","Start of document reached. Continuing from the end.",options)))+"\n        </span>\n    </span>\n</div>\n",buffer});return pdfjsFindBarFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/pageView",["jquery","ui/hider","handlebars","i18n","lodash","lib/dompurify/purify"],function($$1,hider,Handlebars,__,_,DOMPurify){'use strict';var _Mathmin3=Math.min,_Mathmax3=Math.max;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function pageTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function getOutputScale(context){var devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||1;return devicePixelRatio/backingStoreRatio}function normalizeScale(scale){return _Mathmin3(_Mathmax3(MIN_SCALE,parseInt(scale,10)||1),10)}function pageViewFactory($container,config){function adjustSize(viewport,fitToWidth){function setSize(w,h){$pageView.width(w).height(h).offset({left:parentOffset.left+_Mathmax3(0,(parentWidth-w)/2)}),$drawLayer.width(w).height(h),$textLayer.width(w).height(h)}var ratio=viewport.width/(viewport.height||1)||1,parentWidth=$container.width(),parentHeight=$container.height(),parentOffset=$container.offset(),width,height;fitToWidth?(width=parentWidth,height=width/ratio,height>parentHeight&&(setSize(_Mathmax3(1,parentWidth/2),height),parentWidth=$container.prop("scrollWidth"),width=parentWidth,height=width/ratio)):1<=ratio?(height=_Mathmin3(parentHeight,parentWidth/ratio),width=_Mathmin3(parentWidth,height*ratio)):(width=_Mathmin3(parentWidth,parentHeight*ratio),height=_Mathmin3(parentHeight,width/ratio)),setSize(width,height),canvas.width=viewport.width,canvas.height=viewport.height}var textManager=null,rendered=!1,view={get pageNum(){return pageNum},set pageNum(num){pageNum=parseInt(num,10),$pageView.attr("data-page",num)},isRendered:function(){return rendered},getContainer:function(){return $container},getElement:function(){return $pageView},getDrawLayerElement:function(){return $drawLayer},getTextLayerElement:function(){return $textLayer},getCanvas:function(){return canvas},getRenderingContext:function(){return context},setTextManager:function(manager){textManager=manager},getTextManager:function(){return textManager},render:function(page,fitToWidth){var promises=[],renderScale=scale*CSS_UNITS,viewport,textViewport,renderContext;return rendered=!1,viewport=page.getViewport(renderScale),renderContext={canvasContext:view.getRenderingContext(),viewport:viewport},adjustSize(viewport,fitToWidth),promises.push(page.render(renderContext).promise),textManager&&($textLayer.empty(),textViewport=viewport.clone({scale:renderScale*$textLayer.width()/viewport.width}),promises.push(textManager.renderPage(page.pageIndex+1,textViewport).then(function(renderedContent){$textLayer&&$textLayer.append(renderedContent)}))),Promise.all(promises).then(function(){rendered=!0})},show:function(){hider.show($pageView)},hide:function(){hider.hide($pageView)},destroy:function(){$pageView.remove(),$container=null,$pageView=null,$textLayer=null,$drawLayer=null,canvas=null,context=null,textManager=null,config=null}},$pageView,$textLayer,$drawLayer,canvas,context,scale,pageNum;return config=config||{},textManager=config.textManager,pageNum=config.pageNum,$pageView=$$1(pageTpl({page:pageNum})),$textLayer=$pageView.find(".pdf-text"),$drawLayer=$pageView.find("canvas"),canvas=$drawLayer.get(0),context=canvas.getContext("2d"),scale=normalizeScale(1*getOutputScale(context)),$container.append($pageView),view}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,hider=hider&&hider.hasOwnProperty("default")?hider["default"]:hider,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,_=_&&_.hasOwnProperty("default")?_["default"]:_,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"pdf-page hidden\" data-page=\"",(helper=helpers.page)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.page,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <canvas class=\"pdf-content\"></canvas>\n    <div class=\"pdf-text\"></div>\n</div>\n",buffer}),MIN_SCALE=.25,CSS_UNITS=96/72;return pageViewFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/pagesManager",["lodash","ui/documentViewer/providers/pdfViewer/pdfjs/pageView"],function(_,pageViewFactory){'use strict';var _Mathmin4=Math.min,_Mathmax4=Math.max;return _=_&&_.hasOwnProperty("default")?_["default"]:_,pageViewFactory=pageViewFactory&&pageViewFactory.hasOwnProperty("default")?pageViewFactory["default"]:pageViewFactory,function($container,config){var activeView=null,textManager=null,views=null,pagesManager={get pageCount(){return pageCount},getContainer:function(){return $container},setTextManager:function(manager){textManager=manager,_.forEach(views,function(view){view&&view.setTextManager(manager)})},getTextManager:function(){return textManager},getView:function(pageNum){var index,view;return pageNum=_Mathmin4(_Mathmax4(1,parseInt(pageNum,10)||1),pageCount),index=pageNum-1,view=views[index],view||(views[index]=view=pageViewFactory($container,{pageNum:pageNum,textManager:textManager})),view},getActiveView:function(){return activeView},setActiveView:function(page){var oldActiveView=activeView;activeView=pagesManager.getView(page),oldActiveView&&oldActiveView!==activeView&&oldActiveView.hide(),activeView&&(activeView.pageNum=page,activeView.show())},renderPage:function(page,fitToWidth){return activeView?activeView.render(page,fitToWidth):Promise.resolve()},destroy:function(){_.forEach(views,function(view){view&&view.destroy()}),$container=null,activeView=null,textManager=null,views=null,config=null}},pageCount;return config=config||{},textManager=config.textManager,pageCount=_Mathmax4(1,parseInt(config.pageCount,10)||1),views=Array(pageCount),pagesManager}}),define("ui/documentViewer/providers/pdfViewer/pdfjs/textManager",["lodash"],function(_){'use strict';var _Mathmin5=Math.min,_Mathmax5=Math.max;function textManagerFactory(config){function cancelRenderingTask(pageIndex){textRenderTasks&&textRenderTasks[pageIndex]&&(textRenderTasks[pageIndex].cancel(),textRenderTasks[pageIndex]=null)}function cancelAllRenderingTasks(){var pageIndex;if(textRenderTasks)for(pageIndex=textRenderTasks.length;pageIndex--;)cancelRenderingTask(pageIndex)}function getPageTextContent(pageNum){return pdfDoc.getPage(pageNum).then(function(page){return page.getTextContent({normalizeWhitespace:!0})})}function getTextContent(){var numPages=pdfDoc.numPages,promises=[];return _.times(numPages,function(pageIndex){promises.push(getPageTextContent(pageIndex+1).then(function(textContent){var strings=_.map(textContent.items,"str");return{content:textContent,strings:strings,text:strings.join(""),nodes:[]}}))}),Promise.all(promises)}function getPageContents(){var numPages=pdfDoc.numPages,contentPromise;return contentPromise=pageContents?Promise.resolve(pageContents):getTextContent().then(function(content){return textRenderTasks=Array(numPages),pageContents=content,pageContents}),contentPromise}var pdfDoc=null,PDFJS=null,pageContents=null,textRenderTasks=null;if(config=config||{},PDFJS=config.PDFJS,!_.isPlainObject(PDFJS))throw new TypeError("You must provide the entry point to the PDF.js library! [config.PDFJS is missing]");return{setDocument:function(doc){cancelAllRenderingTasks(),pdfDoc=doc,pageContents=null},getDocument:function(){return pdfDoc},getContents:function(){return pdfDoc?getPageContents():Promise.reject(new Error("You must assign a document to get the content from!"))},getText:function(){return this.getContents().then(function(content){return _.map(content,"text")})},getFullText:function(){return this.getContents().then(function(content){return _.map(content,"text").join(" ")})},getPageContent:function(pageNum){return this.getContents().then(function(content){var pageIndex=_Mathmin5(_Mathmax5(0,pageNum-1),content.length-1);return content[pageIndex]})},getPageText:function(pageNum){return this.getContents().then(function(content){var pageIndex=_Mathmin5(_Mathmax5(0,pageNum-1),content.length-1);return content[pageIndex].text})},renderPage:function(pageNum,viewport,timeout){return this.getContents().then(function(content){var pageIndex=_Mathmin5(_Mathmax5(0,pageNum-1),content.length-1),pageContent=content[pageIndex],textLayerFrag=document.createDocumentFragment();return cancelRenderingTask(pageIndex),pageContent.nodes=[],textRenderTasks[pageIndex]=PDFJS.renderTextLayer({textContent:pageContent.content,textDivs:pageContent.nodes,container:textLayerFrag,viewport:viewport,timeout:timeout}),textRenderTasks[pageIndex].promise.then(function(){return textRenderTasks[pageIndex]=null,textLayerFrag},function(){textRenderTasks[pageIndex]=null})})},destroy:function(){cancelAllRenderingTasks(),pdfDoc=null,PDFJS=null,pageContents=null,config=null}}}return _=_&&_.hasOwnProperty("default")?_["default"]:_,textManagerFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/wrapper",["lodash","ui/documentViewer/providers/pdfViewer/pdfjs/pagesManager","ui/documentViewer/providers/pdfViewer/pdfjs/textManager"],function(_,pagesManagerFactory,textManagerFactory){'use strict';var _Mathmin6=Math.min,_Mathmax6=Math.max;function base64toBytes(data){for(var raw=window.atob(data),rawLength=raw.length,array=new Uint8Array(new ArrayBuffer(rawLength));rawLength--;)array[rawLength]=raw.charCodeAt(rawLength);return array}function processUri(uri){var base64Index;return uri+="",base64Index=uri.indexOf(";base64,"),0<=base64Index?base64toBytes(uri.substring(base64Index+8)):uri}function pdfjsWrapperFactory($container,config){var pdfDoc=null,pageNum=1,pageCount=1,pageNumPending=null,pageRendering=null,pagesManager=null,textManager=null,states={},PDFJS=null,events=null,wrapper={get wrapped(){return PDFJS},load:function(url){return pdfDoc=null,states={},events.trigger("loading",url),PDFJS.getDocument(processUri(url)).then(function(doc){states.destroyed||(pdfDoc=doc,pageNum=1,pageCount=pdfDoc.numPages,textManager.setDocument(pdfDoc),states.loaded=!0,events.trigger("loaded",url))})},renderPage:function(num){return pdfDoc?(pageRendering?pageNumPending=num:(events.trigger("rendering",num),states.rendered=!1,states.rendering=!0,pageRendering=pdfDoc.getPage(num).then(function(page){if(pagesManager)return pagesManager.renderPage(page,config.fitToWidth).then(function(){var nextPage=pageNumPending;if(pageNumPending=null,pageRendering=null,!states.destroyed){if(states.rendered=!0,states.rendering=!1,events.trigger("rendered",num),null!==nextPage)return wrapper.renderPage(nextPage);events.trigger("allrendered",num)}})})),pageRendering):Promise.resolve(num)},getState:function(name){return!!states[name]},getDocument:function(){return pdfDoc},getPageCount:function(){return pageCount},getPage:function(){return pageNum},setPage:function(page){return pageNum=_Mathmin6(_Mathmax6(1,page||0),pageCount),pagesManager.setActiveView(pageNum),events.trigger("pagechange",pageNum),wrapper.renderPage(pageNum)},getTextManager:function(){return textManager},getPagesManager:function(){return pagesManager},refresh:function(){return events.trigger("refreshing",pageNum),pagesManager.setActiveView(pageNum),wrapper.renderPage(pageNum)},destroy:function(){pagesManager&&pagesManager.destroy(),textManager&&textManager.destroy(),pdfDoc&&pdfDoc.destroy(),states={destroyed:!0},pdfDoc=null,pageNumPending=null,pageRendering=null,pagesManager=null,$container=null,PDFJS=null,config=null,events.trigger("destroy.wrapper"),events=null}};if(config=config||{},PDFJS=config.PDFJS,events=config.events,!_.isPlainObject(PDFJS))throw new TypeError("You must provide the entry point to the PDF.js library! [config.PDFJS is missing]");if(!_.isPlainObject(events))throw new TypeError("You must provide an events hub! [config.events is missing]");return textManager=textManagerFactory({PDFJS:PDFJS}),pagesManager=pagesManagerFactory($container,{pageCount:1,textManager:textManager}),events.on("setpage.wrapper",function(page){wrapper.setPage(page)}).on("refresh.wrapper",function(){wrapper.refresh()}).trigger("init.wrapper"),wrapper}_=_&&_.hasOwnProperty("default")?_["default"]:_,pagesManagerFactory=pagesManagerFactory&&pagesManagerFactory.hasOwnProperty("default")?pagesManagerFactory["default"]:pagesManagerFactory,textManagerFactory=textManagerFactory&&textManagerFactory.hasOwnProperty("default")?textManagerFactory["default"]:textManagerFactory;return pdfjsWrapperFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/viewer",["jquery","lodash","core/eventifier","ui/documentViewer/providers/pdfViewer/pdfjs/areaBroker","ui/documentViewer/providers/pdfViewer/pdfjs/findBar","ui/documentViewer/providers/pdfViewer/pdfjs/wrapper","handlebars","i18n","lib/dompurify/purify"],function($$1,_,eventifier,areaBroker,findBarFactory,wrapperFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function viewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function toggleState($element,enabled){enabled?$element.removeAttr("disabled"):$element.attr("disabled",!0)}function pdfjsViewerFactory($container,config){function updateControls(){var page=pdf.getPage(),pageCount=pdf.getPageCount();page!==parseInt(controls.$pageNum.val(),10)&&controls.$pageNum.val(page),toggleState(controls.$pagePrev,enabled&&1<page),toggleState(controls.$pageNext,enabled&&page<pageCount),toggleState(controls.$pageNum,enabled&&1<pageCount)}function enable(){events.trigger("enable")}function disable(){events.trigger("disable")}function refresh(){events.trigger("refresh")}function jumpPage(page){events.trigger("setpage",page)}function movePage(step){jumpPage(pdf.getPage()+step)}var template=viewerTpl(config),events=eventifier(),controls={},broker=null,findBar=null,pdfConfig=null,pdf=null,PDFJS=null,enabled=!0;if(config=config||{},PDFJS=config.PDFJS,pdfConfig=_.merge({events:events},_.pick(config,["PDFJS","fitToWidth"])),!_.isPlainObject(PDFJS))throw new TypeError("You must provide the entry point to the PDF.js library! [config.PDFJS is missing]");return{load:function(url){return $container.html(template),PDFJS.PDFJS.disableRange=!0,events.on("enable",function(){enabled=!0,updateControls()}).on("disable",function(){enabled=!1,updateControls()}).on("loaded",function(){controls.$pageCount.html(pdf.getPageCount()),enable()}).on("pagechange rendered",function(){updateControls()}),broker=areaBroker($container,{bar:$$1(".pdf-bar",$container),actions:$$1(".pdf-actions",$container),info:$$1(".pdf-info",$container),content:$$1(".pdf-container",$container)}),controls={$navigation:$container.find(".navigation"),$pagePrev:$container.find("[data-control=\"pdf-page-prev\"]"),$pageNext:$container.find("[data-control=\"pdf-page-next\"]"),$pageNum:$container.find("[data-control=\"pdf-page-num\"]"),$pageCount:$container.find("[data-control=\"pdf-page-count\"]"),$fitToWidth:$container.find("[data-control=\"fit-to-width\"]")},pdf=wrapperFactory(broker.getContentArea(),pdfConfig),config.allowSearch&&(findBar=findBarFactory({events:events,areaBroker:broker,textManager:pdf.getTextManager(),caseSensitive:config.caseSensitiveSearch,highlightAll:config.highlightAllMatches})),this.setSize($container.width(),$container.height()),controls.$fitToWidth.on("change",function(){pdfConfig.fitToWidth=controls.$fitToWidth.is(":checked"),refresh()}),controls.$navigation.on("click",function(){movePage(parseInt($$1(this).data("direction"),10)||1)}),controls.$pageNum.on("change",function(){jumpPage(parseInt(controls.$pageNum.val(),10)||pdf.getPage())}).on("keydown",function(event){switch(event.keyCode){case 38:movePage(1),event.stopPropagation(),event.preventDefault();break;case 40:movePage(-1),event.stopPropagation(),event.preventDefault();}}),disable(),pdf.load(url)},unload:function(){disable(),findBar&&findBar.destroy(),pdf&&pdf.destroy(),events.removeAllListeners(),$container.empty(),controls={},pdfConfig=null,pdf=null,findBar=null,broker=null},setSize:function(width,height){var contentHeight,$bar,$content;if(pdf)return $bar=broker.getBarArea(),$content=broker.getContentArea(),contentHeight=height-$bar.outerHeight(),$bar.width(width),$content.width(width).height(contentHeight),events.trigger("resized",width,height,contentHeight),pdf.refresh()}}}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,areaBroker=areaBroker&&areaBroker.hasOwnProperty("default")?areaBroker["default"]:areaBroker,findBarFactory=findBarFactory&&findBarFactory.hasOwnProperty("default")?findBarFactory["default"]:findBarFactory,wrapperFactory=wrapperFactory&&wrapperFactory.hasOwnProperty("default")?wrapperFactory["default"]:wrapperFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",helper,options;return buffer+="\n        <input type=\"checkbox\" id=\"fit-to-width\" data-control=\"fit-to-width\" value=\"1\" checked /> <label for=\"fit-to-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Fit to width",options):helperMissing.call(depth0,"__","Fit to width",options)))+"</label>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"pdf-bar\">\n    <div class=\"pdf-actions\">\n        <button class=\"small navigation\" data-control=\"pdf-page-prev\" data-direction=\"-1\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous page",options):helperMissing.call(depth0,"__","Previous page",options)))+"\"><span class=\"icon icon-step-backward\"></span><span class=\"text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous",options):helperMissing.call(depth0,"__","Previous",options)))+"</span></button>\n        <button class=\"small navigation\" data-control=\"pdf-page-next\" data-direction=\"1\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next page",options):helperMissing.call(depth0,"__","Next page",options)))+"\"><span class=\"icon icon-step-forward\"></span><span class=\"text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next",options):helperMissing.call(depth0,"__","Next",options)))+"</span></button>\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.fitToWidth,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    <div class=\"pdf-info\">\n        <label for=\"pdf-page-num\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Page",options):helperMissing.call(depth0,"__","Page",options)))+":</label>\n        <input class=\"info\" id=\"pdf-page-num\" data-control=\"pdf-page-num\" value=\"1\" />\n        <label>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+"</label>\n        <span class=\"info\" data-control=\"pdf-page-count\">1</span>\n    </div>\n</div>\n<div class=\"pdf-container\"></div>\n",buffer});return pdfjsViewerFactory}),define("ui/documentViewer/providers/pdfViewer",["lodash","core/requireIfExists","ui/documentViewer/providers/pdfViewer/fallback/viewer","ui/documentViewer/providers/pdfViewer/pdfjs/viewer","handlebars","i18n","lib/dompurify/purify"],function(_,requireIfExists,fallbackFactory,pdfjsFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function viewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}_=_&&_.hasOwnProperty("default")?_["default"]:_,requireIfExists=requireIfExists&&requireIfExists.hasOwnProperty("default")?requireIfExists["default"]:requireIfExists,fallbackFactory=fallbackFactory&&fallbackFactory.hasOwnProperty("default")?fallbackFactory["default"]:fallbackFactory,pdfjsFactory=pdfjsFactory&&pdfjsFactory.hasOwnProperty("default")?pdfjsFactory["default"]:pdfjsFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"pdf-viewer\"></div>"});return{getTemplate:function(){return viewerTpl},init:function(){this.pdf=null},load:function(){var self=this,$element=this.getElement();return requireIfExists("pdfjs-dist/build/pdf").then(function(pdfjs){var config=_.clone(self.config);return pdfjs?(config.PDFJS=pdfjs,self.pdf=pdfjsFactory($element,config)):self.pdf=fallbackFactory($element,config),self.pdf.load(self.getUrl())}).then(function(){self.setSize($element.width(),$element.height())})},unload:function(){this.pdf&&this.pdf.unload(),this.is("rendered")&&this.getElement().empty(),this.pdf=null},setSize:function(width,height){this.pdf&&this.pdf.setSize(width,height)}}}),define("ui/previewer",["jquery","lodash","i18n","core/mimetype","core/pluginifier","ui/mediaplayer","iframeNotifier","ui/documentViewer","ui/documentViewer/providers/pdfViewer"],function($,_,__,mimeType,Pluginifier,mediaplayer,iframeNotifier,documentViewer,pdfViewer){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,mimeType=mimeType&&mimeType.hasOwnProperty("default")?mimeType["default"]:mimeType,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,mediaplayer=mediaplayer&&mediaplayer.hasOwnProperty("default")?mediaplayer["default"]:mediaplayer,iframeNotifier=iframeNotifier&&iframeNotifier.hasOwnProperty("default")?iframeNotifier["default"]:iframeNotifier,documentViewer=documentViewer&&documentViewer.hasOwnProperty("default")?documentViewer["default"]:documentViewer,pdfViewer=pdfViewer&&pdfViewer.hasOwnProperty("default")?pdfViewer["default"]:pdfViewer;var dataNs="ui.previewer",defaults={containerClass:"previewer"},_defaultSize={video:{width:480,height:300},audio:{width:290,height:36},pdf:{width:340,height:500}},previewGenerator={placeHolder:_.template("<p class='nopreview' data-type='${type}'>${desc}</p>"),youtubeTemplate:_.template("<div data-src=${jsonurl} data-type='video/youtube'></div>"),videoTemplate:_.template("<div data-src=${jsonurl} data-type='${mime}'></div>"),audioTemplate:_.template("<div data-src=${jsonurl} data-type='${mime}'></div>"),imageTemplate:_.template("<img src=${jsonurl} alt='${name}' />"),pdfTemplate:_.template("<div class='pdfpreview'></div>"),flashTemplate:_.template("<object data=${jsonurl} type='application/x-shockwave-flash'><param name='movie' value=${jsonurl}></param></object>"),mathmlTemplate:_.template("<iframe src=${jsonurl}></iframe>"),xmlTemplate:_.template("<pre>${xml}</pre>"),htmlTemplate:_.template("<iframe src=${jsonurl}></iframe>"),generate:function(type,data){var tmpl=this[type+"Template"];if(data.jsonurl=JSON.stringify(data.url),_.isFunction(tmpl))return tmpl(data)}};documentViewer.registerProvider("pdf",pdfViewer);var previewer={init:function(options){return options=_.defaults(options||{},defaults),this.each(function(){var $elt=$(this);$elt.data(dataNs)?$elt.previewer("update",options):(!$elt.hasClass(options.containerClass)&&$elt.addClass(options.containerClass),$elt.data(dataNs,options),previewer._update($elt),$elt.trigger("create.previewer"))})},update:function(data){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);$elt.data(dataNs,_.merge(options,data)),previewer._update($elt)})},_setPlayer:function($elt,player){$elt.data("player",player)},_clearPlayer:function($elt){$elt&&$elt.data("player")&&($elt.data("player").destroy(),$elt.removeData("player"))},_update:function($elt){var self=previewer,options=$elt.data(dataNs),player,$content,$controls,content,type;self._clearPlayer($elt),options&&(type=options.type||mimeType.getFileType({mime:options.mime,name:options.url}),options.url&&(!options.name&&(options.name=options.url.substring(options.url.lastIndexOf("/")+1,options.url.lastIndexOf("."))),content=previewGenerator.generate(type,options)),!content&&(content=previewGenerator.placeHolder({desc:__("No preview available"),type:options.type||options.mime||""})),$content=$(content),$content.on("load",function(){iframeNotifier.parent("imageloaded")}),options.width&&$content.attr("width",options.width),options.height&&$content.attr("height",options.height),$elt.empty().html($content),options.url&&("audio"===type||"video"===type?(player=mediaplayer({url:options.url,type:options.mime,renderTo:$content}).on("ready",function(){var defSize=_defaultSize[this.getType()]||_defaultSize.video,width=options.width||defSize.width,height=options.height||defSize.height;this.resize(width,height)}),self._setPlayer($elt,player),$("body").off("keydown.mediaelement").on("keydown.mediaelement",function(event){27===event.keyCode&&self._clearPlayer($elt)}),$controls=$(".actions a:nth-child(1), .actions a:nth-child(3), .icon-close, .upload-switcher, .select-action, .files li>span","#mediaManager"),$controls.off("mousedown.mediaelement").on("mousedown.mediaelement",function(event){event.stopPropagation(),$(this).closest(".mediaplayer").length||($controls.off("mousedown.mediaelement"),self._clearPlayer($elt))})):"pdf"===type&&(documentViewer({renderTo:$content,replace:!0,width:options.width||_defaultSize.pdf.width,height:options.height||_defaultSize.pdf.height}).load(options.url,"pdf"),_.defer(function(){iframeNotifier.parent("imageloaded")}))),$elt.trigger("update.previewer"))},destroy:function(){this.each(function(){var $elt=$(this);previewer._clearPlayer($elt),$elt.trigger("destroy.previewer")})}};return Pluginifier.register("previewer",previewer),function($container){$container.find("[data-preview]").each(function(){var $elt=$(this);$elt.previewer({url:$elt.data("preview"),type:$elt.data("preview-type"),mime:$elt.data("preview-mime"),width:$elt.width(),height:$elt.height()})})}}),define("ui/resourcemgr/filePreview",["jquery","lodash","util/bytes","context","ui/previewer"],function($,_,bytes,context){'use strict';function filePreview(options){function startPreview(file){$previewer.previewer(file),$propType.text(file.type+" ("+file.mime+")"),$propSize.text(bytes.hrSize(file.size)),$link.attr("href",file.download).attr("download",file.file),$link.hasClass("hidden")&&$link.removeClass("hidden"),$selectButton.removeAttr("disabled")}function stopPreview(){$previewer.previewer("update",{url:!1}),$propType.empty(),$propSize.empty(),$("a",$propUrl).addClass("hidden"),$selectButton.attr("disabled","disabled")}var $container=options.$target,$filePreview=$(".file-preview",$container),$previewer=$(".previewer",$container),$propType=$(".prop-type",$filePreview),$propSize=$(".prop-size",$filePreview),$propUrl=$(".prop-url",$filePreview),$link=$("a",$propUrl),$selectButton=$(".select-action",$filePreview),currentSelection=[];$container.on("fileselect.resourcemgr",function(e,file){file&&file.file?(startPreview(file),currentSelection=file):stopPreview()}),$selectButton.on("click",function(e){e.preventDefault();var data=_.pick(currentSelection,["file","type","mime","size","alt"]);context.mediaSources&&0===context.mediaSources.length&&-1<data.file.indexOf("local/")&&(data.file=data.file.substring(6)),$container.trigger("select.resourcemgr",[[data]])})}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,bytes=bytes&&bytes.hasOwnProperty("default")?bytes["default"]:bytes,context=context&&context.hasOwnProperty("default")?context["default"]:context;return filePreview}),define("util/namespace",["lodash"],function(_){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_;var reSplit=/\s/g,namespaceSep=".",namespaceHelper={split:function(names,normalize){return!_.isString(names)||_.isEmpty(names)?[]:(normalize&&(names=names.toLowerCase()),_(names.trim().split(reSplit)).compact().uniq().value())},getName:function(namespaced){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(namespaceSep)?namespaced.substr(0,namespaced.indexOf(namespaceSep)):namespaced},getNamespace:function(namespaced,defaultNs){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(namespaceSep)?namespaced.substr(namespaced.indexOf(namespaceSep)+1):defaultNs||"@"},namespaceAll:function(names,namespace,normalize){var suffix;return _.isArray(names)||(names=namespaceHelper.split(names,normalize)),normalize&&(namespace=namespace.toLowerCase()),suffix=namespace?namespaceSep+namespace:"",_(names).map(function(sh){return 0>sh.indexOf(namespaceSep)?sh+suffix:sh}).compact().uniq().value().join(" ")}};return namespaceHelper}),define("util/shortcut/registry",["jquery","lodash","util/namespace"],function($,_,namespaceHelper){'use strict';var _StringfromCharCode2=String.fromCharCode;function registerEvent(target,eventName,listener){target.addEventListener?target.addEventListener(eventName,listener,!1):target.attachEvent?target.attachEvent("on"+eventName,listener):target["on"+eventName]=listener}function unregisterEvent(target,eventName,listener){target.removeEventListener?target.removeEventListener(eventName,listener,!1):target.detachEvent?target.detachEvent("on"+eventName,listener):target["on"+eventName]=null}function getActualKey(event){var code=event.which||event.keyCode,character=32<=code?_StringfromCharCode2(code).toLowerCase():"",key=event.key&&event.key.toLowerCase(),keyName=event.code&&event.code.toLowerCase();return keyName&&(0===keyName.indexOf("key")?("a">key||"z"<key)&&"a"<=character&&"z">=character&&(key=character):0===keyName.indexOf("digit")&&(key=keyName.substr(5))),specialKeys[code]||key||character}function getActualButton(event){var buttons={clickLeft:!1,clickRight:!1,clickMiddle:!1,clickBack:!1,clickForward:!1};if(event.buttons)buttons.clickLeft=!!(1&event.buttons),buttons.clickRight=!!(2&event.buttons),buttons.clickMiddle=!!(4&event.buttons),buttons.clickBack=!!(8&event.buttons),buttons.clickForward=!!(16&event.buttons);else switch(event.button){case 0:buttons.clickLeft=!0;break;case 1:buttons.clickMiddle=!0;break;case 2:buttons.clickRight=!0;break;case 3:buttons.clickBack=!0;break;case 4:buttons.clickForward=!0;}return buttons}function getActualScroll(event){return{scrollUp:0>event.deltaY,scrollDown:0<event.deltaY}}function normalizeCommand(descriptor){var key=translateKeys[descriptor.key]||descriptor.key,parts=[];return descriptor.ctrlKey&&parts.push("control"),descriptor.altKey&&parts.push("alt"),descriptor.shiftKey&&parts.push("shift"),descriptor.metaKey&&parts.push("meta"),descriptor.scrollDown&&parts.push("scrollDown"),descriptor.scrollUp&&parts.push("scrollUp"),descriptor.clickLeft&&parts.push("clickLeft"),descriptor.clickRight&&parts.push("clickRight"),descriptor.clickMiddle&&parts.push("clickMiddle"),descriptor.clickBack&&parts.push("clickBack"),descriptor.clickForward&&parts.push("clickForward"),key&&0>parts.indexOf(key)&&parts.push(key),parts.join("+")}function parseCommand(shortcut){var parts=namespaceHelper.getName(shortcut).split("+"),descriptor={keyboardInvolved:!1,mouseClickInvolved:!1,mouseWheelInvolved:!1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:null,scrollUp:null,scrollDown:null,clickLeft:null,clickRight:null,clickMiddle:null,clickBack:null,clickForward:null};return _.forEach(parts,function(part){if(modifiers[part])descriptor[modifiers[part]]=!0;else if(0<=part.indexOf("mouse")){if(descriptor.keyboardInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");0<=part.indexOf("scroll")&&(descriptor.mouseWheelInvolved=!0,descriptor.scrollUp=0<=part.indexOf("up"),descriptor.scrollDown=0<=part.indexOf("down")),0<=part.indexOf("click")&&(descriptor.mouseClickInvolved=!0,descriptor.clickLeft=0<=part.indexOf("left"),descriptor.clickRight=0<=part.indexOf("right"),descriptor.clickMiddle=0<=part.indexOf("middle"),descriptor.clickBack=0<=part.indexOf("back"),descriptor.clickForward=0<=part.indexOf("forward"))}else{if(descriptor.mouseClickInvolved||descriptor.mouseWheelInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");descriptor.keyboardInvolved=!0,descriptor.key=part}}),descriptor}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,namespaceHelper=namespaceHelper&&namespaceHelper.hasOwnProperty("default")?namespaceHelper["default"]:namespaceHelper;var modifiers={ctrl:"ctrlKey",alt:"altKey",option:"altKey",shift:"shiftKey",meta:"metaKey",cmd:"metaKey",win:"metaKey"},translateKeys={escape:"esc",arrowdown:"down",arrowleft:"left",arrowright:"right",arrowup:"up"},specialKeys={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"meta",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scrolllock",144:"numlock"};return function(root,defaultOptions){function getHandlers(command,namespace){return handlers[namespace]=handlers[namespace]||{},handlers[namespace][command]=handlers[namespace][command]||[],handlers[namespace][command]}function getCommandHandlers(command){return _.reduce(handlers,function(acc,nsHandlers){return nsHandlers[command]&&(acc=acc.concat(nsHandlers[command])),acc},[])}function clearHandlers(command,namespace){namespace&&!command?handlers[namespace]={}:_.forEach(handlers,function(nsHandlers,ns){nsHandlers[command]&&("*"===namespace||namespace===ns)&&(nsHandlers[command]=[])})}function setOptions(descriptor,options){descriptor.options=_.defaults(_.merge(descriptor.options||{},options),defaultOptions)}function registerKeyboard(){keyboardIsRegistered||(registerEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!0),keyboardCount++}function unregisterKeyboard(){keyboardCount--,0>=keyboardCount&&(keyboardCount=0,keyboardIsRegistered&&(unregisterEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!1))}function registerMouseClick(){mouseClickIsRegistered||(registerEvent(root,"click",onMouseClick),mouseClickIsRegistered=!0),mouseClickCount++}function unregisterMouseClick(){mouseClickCount--,0>=mouseClickCount&&(mouseClickCount=0,mouseClickIsRegistered&&(unregisterEvent(root,"click",onMouseClick),mouseClickIsRegistered=!1))}function registerMouseWheel(){mouseWheelIsRegistered||(registerEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!0),mouseWheelCount++}function unregisterMouseWheel(){mouseWheelCount--,0>=mouseWheelCount&&(mouseWheelCount=0,mouseWheelIsRegistered&&(unregisterEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!1))}function registerCommand(command,descriptor){shortcuts[command]=descriptor,descriptor.keyboardInvolved&&registerKeyboard(),descriptor.mouseClickInvolved&&registerMouseClick(),descriptor.mouseWheelInvolved&&registerMouseWheel()}function unregisterCommand(command){var descriptor=shortcuts[command];shortcuts[command]=null,descriptor&&(descriptor.keyboardInvolved&&unregisterKeyboard(),descriptor.mouseClickInvolved&&unregisterMouseClick(),descriptor.mouseWheelInvolved&&unregisterMouseWheel())}function onKeyboard(event){processShortcut(event,{keyboardInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey,key:getActualKey(event)})}function onMouseClick(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},getActualButton(event)))}function onMouseWheel(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},getActualScroll(event)))}function processShortcut(event,descriptor){var command=normalizeCommand(descriptor),shortcut=shortcuts[command],shortcutHandlers,$target;if(shortcut&&!states.disabled){if(!0===shortcut.options.avoidInput&&($target=$(event.target),$target.closest("[type=\"text\"],textarea").length&&(!shortcut.options.allowIn||!$target.closest(shortcut.options.allowIn).length)))return;!1===shortcut.options.propagate&&event.stopPropagation(),!0===shortcut.options.prevent&&event.preventDefault(),shortcutHandlers=getCommandHandlers(command),shortcutHandlers&&_.forEach(shortcutHandlers,function(handler){handler(event,command)})}}var keyboardIsRegistered=!1,mouseClickIsRegistered=!1,mouseWheelIsRegistered=!1,keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,shortcuts={},handlers={},states={};return root.jquery&&(root=root.get(0)),{set:function(shortcut,options){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor)}),this},add:function(shortcut,handler,options){return _.isFunction(handler)&&_.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor),getHandlers(command,namespace).push(handler)}),this},remove:function(shortcut){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);clearHandlers(command,namespace),getCommandHandlers(command).length||unregisterCommand(command)}),this},exists:function(shortcut){var normalized=(shortcut+"").trim().toLowerCase(),namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor),shortcutExists=!1;return shortcuts[command]?shortcutExists="*"===namespace||!!getHandlers(command,namespace).length:!command&&(shortcutExists=!_.isEmpty(handlers[namespace])),shortcutExists},clear:function(){return shortcuts={},handlers={},keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,unregisterKeyboard(),unregisterMouseClick(),unregisterMouseWheel(),this},getState:function(name){return!!states[name]},setState:function(name,state){return states[name]=!!state,this},enable:function(){return this.setState("disabled",!1),this},disable:function(){return this.setState("disabled",!0),this}}}}),define("ui/keyNavigation/navigator",["jquery","lodash","core/eventifier","util/shortcut/registry"],function($,_,eventifier,shortcutRegistry){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty("default")?shortcutRegistry["default"]:shortcutRegistry;var _navigationGroups={},_ns=".ui-key-navigator",_defaults={defaultPosition:0,keepState:!1,replace:!1,loop:!1,propagateTab:!0},isNavigableElement=function(navElement){return navElement&&_.isFunction(navElement.init)&&_.isFunction(navElement.destroy)&&_.isFunction(navElement.getElement)&&_.isFunction(navElement.isVisible)&&_.isFunction(navElement.isEnabled)&&_.isFunction(navElement.focus)},keyNavigatorFactory=function(config){var _cursor={position:-1,navigable:null},getCurrentCursor=function(){var isFocused=!1;return document.activeElement&&_.forEach(navigables,function(navigable,index){if(navigable.isVisible()&&navigable.isEnabled()&&(document.activeElement===navigable.getElement().get(0)||(!$(document.activeElement).hasClass("key-navigation-highlight")||$(document.activeElement).data("key-navigatior-id")!==id)&&$.contains(navigable.getElement().get(0),document.activeElement)))return _cursor.position=index,_cursor.navigable=navigable,isFocused=!0,!1}),isFocused?_cursor:null},getClosestPositionRight=function(fromPosition){var pos;for(pos=fromPosition;pos<navigables.length;pos++)if(navigables[pos]&&navigables[pos].isVisible()&&navigables[pos].isEnabled())return pos;return-1},getClosestPositionLeft=function(fromPosition){var pos;for(pos=fromPosition;0<=pos;pos--)if(navigables[pos]&&navigables[pos].isVisible()&&navigables[pos].isEnabled())return pos;return-1},id,navigables,keyNavigator,$group;if(config=_.defaults(config||{},_defaults),id=config.id||_.uniqueId("navigator_"),navigables=config.elements||[],_navigationGroups[id])if(config.replace)_navigationGroups[id].destroy();else throw new TypeError("the navigation group id is already in use : "+id);if(_.each(navigables,function(navigable){navigable.init(),navigable.getElement().data("key-navigatior-id",id)}),config.group)if($group=$(config.group),$group.length)$group.addClass("key-navigation-group").attr("data-navigation-id",id);else throw new TypeError("group element does not exist");return keyNavigator=eventifier({getId:function(){return id},getGroup:function(){return $group},isFocused:function(){return!!getCurrentCursor()},next:function(){var cursor=getCurrentCursor(),pos;return cursor?(pos=getClosestPositionRight(cursor.position+1),0<=pos?this.focusPosition(pos):config.loop?this.focusPosition(getClosestPositionRight(0)):this.trigger("upperbound"),this.trigger("next",getCurrentCursor())):this.focusPosition(getClosestPositionRight(0)),this},previous:function(){var cursor=getCurrentCursor(),pos;return cursor?(pos=getClosestPositionLeft(cursor.position-1),0<=pos?this.focusPosition(pos):config.loop?this.focusPosition(getClosestPositionLeft(navigables.length-1)):this.trigger("lowerbound"),this.trigger("previous",getCurrentCursor())):this.focusPosition(getClosestPositionRight(0)),this},activate:function(target){var cursor=getCurrentCursor();return cursor&&this.trigger("activate",cursor,target),this},goto:function(groupId){return _navigationGroups[groupId]?_navigationGroups[groupId].focus():this.trigger("error",new Error("goto an unknown navigation group")),this},focus:function(originNavigator){var pos;return config.keepState&&_cursor&&0<=_cursor.position?pos=_cursor.position:_.isFunction(config.defaultPosition)?(pos=config.defaultPosition(navigables),0>pos&&(pos=0)):pos=config.defaultPosition,this.focusPosition(getClosestPositionRight(pos),originNavigator),this},focusPosition:function(position,originNavigator){return navigables[position]&&(_cursor.navigable&&this.trigger("blur",this.getCursor(),originNavigator),_cursor.position=position,navigables[_cursor.position].focus(),_cursor.navigable=navigables[_cursor.position],this.trigger("focus",this.getCursor(),originNavigator)),this},first:function(){return this.focusPosition(getClosestPositionRight(0)),this},last:function(){return this.focusPosition(getClosestPositionLeft(navigables.length-1)),this},destroy:function(){return _.each(navigables,function(navigable){navigable.getElement().off(_ns),navigable.destroy(),navigable.shortcuts&&navigable.shortcuts.clear()}),delete _navigationGroups[id],this},blur:function(){var cursor=this.getCursor();return cursor&&cursor.navigable&&cursor.navigable.getElement().blur(),this},getCursor:function(){return _.clone(_cursor)},getNavigables:function(){return _.clone(navigables)}}),_.each(navigables,function(navigable){if(!isNavigableElement(navigable))throw new TypeError("not a valid navigable element");navigable.shortcuts=shortcutRegistry(navigable.getElement()).add("tab shift+tab",function(e,key){keyNavigator.trigger(key,e.target)},{propagate:!!config.propagateTab,prevent:!0}).add("enter",function(e){$(e.target).is(":text,textarea")||(e.preventDefault(),keyNavigator.activate(e.target))},{propagate:!1}).add("up down left right",function(e,key){var $target=$(e.target);$target.is(":text,textarea")||(!$target.is("img")&&!$target.hasClass("key-navigation-scrollable")&&e.preventDefault(),keyNavigator.trigger(key,e.target))},{propagate:!1}),navigable.getElement().on("keyup"+_ns,function(e){var keyCode=e.keyCode?e.keyCode:e.charCode;32===keyCode&&(e.target!==this&&$(e.target).is(":input")?e.stopPropagation():(e.preventDefault(),keyNavigator.activate(e.target)))}).on("blur"+_ns,function(){var cursor=keyNavigator.getCursor();cursor&&cursor.navigable&&keyNavigator.trigger("blur",cursor)})}),_navigationGroups[id]=keyNavigator,keyNavigator};return keyNavigatorFactory.get=function(id){if(_navigationGroups[id])return _navigationGroups[id]},keyNavigatorFactory}),define("ui/keyNavigation/navigableDomElement",["jquery","core/eventifier"],function($,eventifier){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier;var navigableDomElement=function($element){return $element=$($element),eventifier({init:function(){if(!$element.length)throw new TypeError("dom element does not exist");return $element.attr("tabindex",-1),$element.addClass("key-navigation-highlight"),this},destroy:function(){return $element.removeClass("key-navigation-highlight"),this},getElement:function(){return $element},isVisible:function(){return $element.is(":visible")},isEnabled:function(){return!$element.is(":disabled")},focus:function(){return $element.focus(),this}})};return navigableDomElement.createFromDoms=function($elements){var list=[];return $elements.each(function(){list.push(navigableDomElement($(this)))}),list},navigableDomElement}),define("ui/modal",["jquery","core/pluginifier","core/dataattrhandler"],function($,Pluginifier,DataAttrHandler){'use strict';var _Mathmax7=Math.max;function closeModal($element,reason){var options=$element.data("ui.modal"),$overlay=$("#"+options.modalOverlay),onClose=function(){$element.removeClass("opened"),$element.css("display","none"),$element.trigger("closed.modal",reason)};modal._unBindEvents($element),options.animate&&$element.is(":visible")?($overlay.fadeOut(options.animate-100),$element.animate({opacity:"0",top:"-1000px"},options.animate,onClose)):($overlay.hide(),$element.hide(),onClose())}function listenDataAttr($container){new DataAttrHandler("modal",{container:$container,listenerEvent:"click",namespace:"ui.modal"}).init(function($elt,$target){$target.modal()})}$=$&&$.hasOwnProperty("default")?$["default"]:$,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,DataAttrHandler=DataAttrHandler&&DataAttrHandler.hasOwnProperty("default")?DataAttrHandler["default"]:DataAttrHandler;var dataNs="ui.modal",defaults={modalCloseClass:"modal-close",modalOverlayClass:"modal-bg",startClosed:!1,disableClosing:!1,width:"responsive",minWidth:0,minHeight:0,vCenter:!0,$context:null,animate:400},animateDiff=100,modal={init:function(options){return options=$.extend(!0,{},defaults,options),options.animate&&("number"==typeof options.animate?options.animate=_Mathmax7(animateDiff,options.animate):options.animate=defaults.animate),$(this).each(function(){var $modal=$(this);if(options.modalOverlay="__modal-bg-"+($modal.attr("id")||new Date().getTime()),$modal.data(dataNs,options),0===$("#"+options.modalOverlay).length){var $overlay=$("<div/>").attr({id:options.modalOverlay,class:options.modalOverlayClass});options.$context instanceof $&&options.$context.length?($overlay.css("position","absolute"),options.$context.append($overlay)):$modal.after($overlay)}0!==$("."+options.modalCloseClass,$modal).length||options.disableClosing||$("<button id=\"modal-close-btn\" class=\""+options.modalCloseClass+"\"><span class=\"icon-close\"></span></button>").appendTo($modal),options.startClosed||modal._open($modal),$modal.trigger("create.modal")})},_destroy:function($element){return $element.each(function(){var $modal=$(this),options=$modal.data(dataNs);$modal.removeData(dataNs),$("#"+options.modalOverlay).remove(),$modal.hide(),$element.trigger("destroyed.modal")})},_bindEvents:function($element){var options=$element.data(dataNs);options&&("responsive"===options.width&&$(window).on("resize.modal",function(e){e.preventDefault(),modal._resize($element)}),!options.disableClosing&&($("."+options.modalCloseClass,$element).on("click.modal",function(e){e.preventDefault(),closeModal($element,"close")}),$("#"+options.modalOverlay).on("click.modal",function(e){e.preventDefault(),closeModal($element,"overlay")}),!options.disableEscape&&$(document).on("keydown.modal",function(e){27===e.keyCode&&(e.preventDefault(),closeModal($element,"escape"))})))},_unBindEvents:function($element){var options=$element.data(dataNs);options&&"responsive"===options.width&&$(window).off("resize.modal"),$element.off("click.modal"),options&&!options.disableClosing&&($("."+options.modalCloseClass,$element).off("click.modal"),$("#"+options.modalOverlay).off("click.modal"),$(document).off("keydown.modal"))},_open:function($element){var modalHeight=$element.outerHeight(),windowHeight=$(window).height(),options=$element.data(dataNs),topOffset,onOpen,$overlay,to;"undefined"!=typeof options&&(onOpen=function(){$element.addClass("opened"),modal._bindEvents($element),$element.trigger("opened.modal")},topOffset=options.top?options.top:options.vCenter||modalHeight>windowHeight?40:(windowHeight-modalHeight)/2,!options.top&&!$element.parent().hasClass("no-scroll-offset")&&$element.parents().map(function(){"BODY"!==this.tagName&&"HTML"!==this.tagName&&(topOffset+=parseInt($(this).scrollTop(),10))}),to={opacity:"1",top:topOffset+"px"},modal._resize($element),$overlay=$("#"+options.modalOverlay),$element.show(),options.animate&&$element.is(":visible")?($element.css({top:"-"+modalHeight+"px",display:"block"}),$overlay.fadeIn(options.animate-animateDiff),$element.animate(to,options.animate,onOpen)):($overlay.show(),$element.css(to),onOpen()))},_close:function($element){closeModal($element,"api")},_resize:function($element){var options=$element.data(dataNs),windowWidth=parseInt($(window).width(),10),css={},modalWidth="responsive"===options.width?.7*windowWidth:parseInt(options.width,10);css.width=_Mathmax7(modalWidth,options.minWidth),options.minHeight&&(css.minHeight=parseInt(options.minHeight)+"px"),$element.css(css)}};return Pluginifier.register("modal",modal,{expose:["open","close","destroy"]}),listenDataAttr}),define("ui/dialog",["jquery","lodash","i18n","handlebars","lib/dompurify/purify","ui/keyNavigation/navigator","ui/keyNavigation/navigableDomElement","util/shortcut/registry","ui/modal"],function($$1,_,__,Handlebars,DOMPurify,keyNavigator,navigableDomElement,shortcutRegistry){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function bodyTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function buttonsTpl(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,keyNavigator=keyNavigator&&keyNavigator.hasOwnProperty("default")?keyNavigator["default"]:keyNavigator,navigableDomElement=navigableDomElement&&navigableDomElement.hasOwnProperty("default")?navigableDomElement["default"]:navigableDomElement,shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty("default")?shortcutRegistry["default"]:shortcutRegistry,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <h4 class=\"strong\">",(helper=helpers.heading)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.heading,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h4>\n        ",buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <div class=\"content\">",(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"preview-modal-feedback modal ",(helper=helpers["class"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["class"],stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"modal-body clearfix\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.heading,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <p class=\"message\">",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</p>\n\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.content,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <div class=\"buttons rgt\"></div>\n    </div>\n</div>\n",buffer});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <button class=\"btn-",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" small ",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-control=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"button\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.icon,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        <span class=\"label\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    </button>\n",buffer}function program2(depth0,data){var buffer="",stack1,helper;return buffer+="<span class=\"icon-",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span> ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers.each.call(depth0,depth0&&depth0.buttons,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n",buffer}),_scope=".modal",_definedButtons={ok:{id:"ok",type:"info",label:__("Ok"),close:!0},cancel:{id:"cancel",type:"regular",label:__("Cancel"),close:!0},yes:{id:"yes",type:"info",label:__("Yes"),close:!0},no:{id:"no",type:"regular",label:__("No"),close:!0}},_defaults={message:"",content:"",width:500,animate:!1,autoRender:!1,autoDestroy:!1,renderTo:"body",buttons:"cancel,ok"},dialog={init:function(options){var self=this,events={},initOptions=_.omit(options||{},function(value,key){var omit=!1;return 2<key.length&&"on"===key.substr(0,2)&&(events[key.substr(2)]=value,omit=!0),omit});return _.defaults(this,initOptions,_defaults),this.$html=$$1(bodyTpl(this)),this.$buttons=this.$html.find(".buttons"),this.rendered=!1,this.destroyed=!1,this.$buttons.on("click"+_scope,"button",this._onButtonClick.bind(this)),this.setButtons(this.buttons),_.forEach(events,function(callback,eventName){0>eventName.indexOf(".")&&(eventName+=_scope),self.on(eventName.toLowerCase(),callback)}),this.autoRender&&this.render(),this},destroy:function(){return this.destroyed||(this._destroy(),this.rendered=!1,this.destroyed=!0,this.trigger("destroy"+_scope),this.$buttons.off(_scope),this.$html.off(_scope).remove(),this.$html=null,this.$buttons=null),this},setButtons:function(buttons){var self=this;return this.destroyed||(!buttons&&(buttons=_defaults.buttons),!_.isArray(buttons)&&_.isString(buttons)&&(buttons=buttons.split(",")),this.buttons={},_.forEach(buttons,function(btn){_.isString(btn)&&(btn=btn.trim(),btn=_definedButtons[btn]||{id:btn,type:"info",label:btn}),btn.type||(btn.type="regular"),self.buttons[btn.id]=btn}),this.$buttons.html(buttonsTpl(this))),this},render:function(to){return this.destroyed||($$1(to||this.renderTo).append(this.$html),this._install(),this.rendered=!0),this},show:function(){return this.destroyed||(this.rendered?this._open():this.render()),this},hide:function(){return!this.destroyed&&this.rendered&&(this._close(),this.autoDestroy&&this.destroy()),this},on:function(){var dom=this.$html;return dom&&dom.on.apply(dom,arguments),this},off:function(){var dom=this.$html;return dom&&dom.off.apply(dom,arguments),this},trigger:function(eventName,extraParameters){var dom=this.$html;return dom&&(void 0===extraParameters&&(extraParameters=[]),!_.isArray(extraParameters)&&(extraParameters=[extraParameters]),extraParameters=Array.prototype.slice.call(extraParameters),extraParameters.push(this),dom.trigger(eventName,extraParameters)),this},getDom:function(){return this.$html},_onButtonClick:function(event){var $btn=$$1(event.target).closest("button"),id=$btn.data("control"),btn=this.buttons[id];btn&&this._execute(btn)},_execute:function(btn){btn.action&&btn.action.apply(this,[btn,this]),this.trigger(btn.id+"btn"+_scope,[btn]),btn.close&&this.hide()},focus:function(button){var focusPosition=-1;button&&(focusPosition=_.findIndex(this.navigator.getNavigables(),function(navigable){return navigable.getElement().is("[data-control=\""+button+"\"]")})),0<=focusPosition?this.navigator.focusPosition(focusPosition):this.navigator.focus()},_install:function(){var self=this,$buttons,closeButton;this.destroyed||(this.$html.modal({width:this.width,animate:this.animate,disableClosing:this.disableClosing,disableEscape:this.disableEscape}).on("closed"+_scope,function(){self.autoDestroy&&self.destroy()}),$buttons=this.$buttons.find("button"),closeButton=$$1(_scope).find("#modal-close-btn")[0],closeButton&&$buttons.push(closeButton),this.navigator=keyNavigator({elements:navigableDomElement.createFromDoms($buttons)}).on("right down",function(){this.next()}).on("left up",function(){this.previous()}).on("tab",function(){this.getCursor().position===$buttons.length-1?this.first():this.next()}).on("shift+tab",function(){0===this.getCursor().position?this.last():this.previous()}).on("activate",function(cursor){cursor.navigable.getElement().click()}),self.navigator.last(),this.globalShortcut=shortcutRegistry($$1("body")).add("tab shift+tab",function(){self.navigator.isFocused()||self.navigator.focus()}),self.trigger("create.dialog"))},_open:function(){this.$html.modal("open")},_close:function(){this.$html.modal("close")},_destroy:function(){this.$html.modal("destroy"),this.navigator&&this.navigator.destroy(),this.globalShortcut&&this.globalShortcut.clear()}},dialogFactory=function(options){var instance=_.clone(dialog,!0);return instance.init(options),instance};return dialogFactory}),define("ui/dialog/alert",["lodash","ui/dialog"],function(_,dialog){'use strict';function dialogAlert(message,action,onCreateDialog){var dlg=dialog({message:message,buttons:"ok",autoDestroy:!0,autoRender:!0}).on("create.dialog",function(){onCreateDialog&&onCreateDialog()});return _.isFunction(action)&&dlg.on("closed.modal",action),dlg}return _=_&&_.hasOwnProperty("default")?_["default"]:_,dialog=dialog&&dialog.hasOwnProperty("default")?dialog["default"]:dialog,dialogAlert}),define("ui/filesender",["jquery","lodash","layout/logout-event"],function($,_,logoutEvent){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,logoutEvent=logoutEvent&&logoutEvent.hasOwnProperty("default")?logoutEvent["default"]:logoutEvent;var FileSender={_opts:{frame:"__postFrame_",loaded:function(){}},_init:function(options){var opts=_.defaults(options,FileSender._opts),xhr2="undefined"!=typeof XMLHttpRequest&&new XMLHttpRequest().upload&&"undefined"!=typeof FormData,$form=this,fileParamName=options.fileParamName||"content",fileNameParamName=options.fileNameParamName||"contentName",$file,xhr,fd;if(!$form.attr("action")&&(!opts.url||0===opts.url.trim().length))throw new Error("An url is required in the options or at least an action ");if($file=$form.find("input[type='file']"),0===$file.length)throw new Error("This plugin is used to post files, your form should include an input element of type file.");if(!$form||!$form.is("form"))throw new Error("This plugin can only be called on a FORM element");xhr2&&(xhr=new XMLHttpRequest,fd=new FormData(this[0]),options.file&&options.file instanceof File&&(fd.append(fileParamName,options.file),fd.append(fileNameParamName,encodeURIComponent(options.file.name))),xhr.open("POST",opts.url,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status){var result=$.parseJSON(xhr.responseText);result.error?"function"==typeof opts.failed&&opts.failed(result.error):"function"==typeof opts.loaded&&opts.loaded(result)}else 403===xhr.status&&logoutEvent(),"function"==typeof opts.failed&&opts.failed()},xhr.send(fd))}};$.fn.sendfile=function(options){return FileSender._init.call(this,options)}}),define("ui/progressbar",["jquery","lodash","core/pluginifier"],function($,_,Pluginifier){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier;var dataNs="ui.progressbar",defaults={disableClass:"disabled",style:"info",value:0,showProgress:!1},progressBar={init:function(options){return options=_.defaults(options||{},defaults),this.each(function(){var $elt=$(this),$pgElt,percent;$elt.data(dataNs)||(options.value=parseInt(options.value,10),$elt.data(dataNs,options),percent=options.value+"%",$pgElt=$("<span></span>").width(percent).attr("title",percent),options.showProgress&&$pgElt.text(percent),$elt.addClass("progressbar").addClass(options.style).empty().append($pgElt),$elt.trigger("create.progressbar"))})},_update:function($elt,value){var options=$elt.data(dataNs),$pgElt,percent;value=parseInt(value,10),0<=value&&100>=value&&(percent=value+"%",$pgElt=$elt.children("span"),$pgElt.width(value+"%").attr("title",percent),options.showProgress&&$pgElt.text(percent),options.value=value,$elt.data(dataNs,options),$elt.trigger("update.progressbar",value))},_value:function($elt,value){var options=$elt.data(dataNs);return"undefined"==typeof value?options.value:progressBar._update($elt,value)},destroy:function(){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&($elt.removeClass("progressbar").empty().removeData(dataNs),$elt.trigger("destroy.progressbar"))})}};Pluginifier.register("progressbar",progressBar,{expose:["update","value"]})}),define("ui/uploader",["jquery","lodash","i18n","async","core/pluginifier","util/bytes","handlebars","lib/dompurify/purify","ui/filesender","ui/progressbar"],function($$1,_,__,async,Pluginifier,bytes,Handlebars,DOMPurify){'use strict';var _Mathround2=Math.round;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function uploaderTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function fileEntryTpl(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,async=async&&async.hasOwnProperty("default")?async["default"]:async,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,bytes=bytes&&bytes.hasOwnProperty("default")?bytes["default"]:bytes,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0,data){var buffer="",helper,options;return buffer+="\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Drag files here",options):helperMissing.call(depth0,"__","Drag files here",options)))+"\n            ",buffer}function program5(depth0,data){var buffer="",helper,options;return buffer+="\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Drag file here",options):helperMissing.call(depth0,"__","Drag file here",options)))+"\n            ",buffer}function program7(depth0,data){var buffer="",helper,options;return buffer+="\n    <button type=\"button\" class=\"btn-info btn-reset small\"><span class=\"icon-eraser\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Reset",options):helperMissing.call(depth0,"__","Reset",options)))+"</button>\n    ",buffer}function program9(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <button class=\"btn-success btn-upload small\"><span class=\"icon-upload\"></span>",(helper=helpers.uploadBtnText)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.uploadBtnText,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</button>\n    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"file-upload grid-row\">\n    <span class=\"btn-info btn-browse small col-5\"><span class=\"icon-folder-open\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Browse...",options):helperMissing.call(depth0,"__","Browse...",options)))+"</span>\n    <span class=\"file-name col-7 truncate placeholder\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No file selected",options):helperMissing.call(depth0,"__","No file selected",options)))+"</span>\n    <input type=\"file\" name=\"",(helper=helpers.inputName)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.inputName,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"multiple"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n</div>\n<!--<div class=\"grid-row\" style=\"display:none;\">-->\n<!--<ul class=\"file-list\"></ul>-->\n<!--</div>-->\n<div class=\"grid-row\">\n    <div class=\"file-drop col-12\" data-drop-msg=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Drop the files to upload",options):helperMissing.call(depth0,"__","Drop the files to upload",options)))+"\">\n        <div class=\"dragholder\">\n            ~ "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"or",options):helperMissing.call(depth0,"__","or",options)))+" ~\n            <br/>\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </div>\n    </div>\n</div>\n<div class=\"grid-row\">\n    <div class=\"progressbar col-12\"></div>\n    <br/>\n</div>\n<div class=\"grid-row\">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.showResetButton,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.showUploadButton,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<li data-file-name=\"",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    ",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    <span class=\"size\">",(helper=helpers.size)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.size,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <span class=\"status\"></span>\n    <a href=\"#\" data-role=\"delete\"><span class=\"icon-close\"></span></a>\n</li>\n",buffer}),ns="uploader",dataNs="ui."+ns,defaults={upload:!0,read:!1,multiple:!1,uploadQueueSize:3,inputName:"content",showResetButton:!0,showUploadButton:!0,browseBtnClass:"btn-browse",uploadBtnClass:"btn-upload",resetBtnClass:"btn-reset",fileNameClass:"file-name",dropZoneClass:"file-drop",progressBarClass:"progressbar",dragOverClass:"drag-hover",formAttributes:{class:"uploader uploaderContainer"},defaultErrMsg:__("Unable to upload file"),uploadBtnText:__("Upload"),fileSelect:function(files,done){return _.isFunction(done)?done(files):files}},tests={filereader:"undefined"!=typeof FileReader,dnd:"draggable"in document.createElement("span")},uploader={init:function(options){var self=uploader;return options=_.defaults(options||{},defaults),this.each(function(){var $elt=$$1(this),$builtInForm;if(!$elt.data(dataNs)){$elt.html(uploaderTpl(options)),$builtInForm=options.$form&&options.$form.length?options.$form:$elt.find("form"),$builtInForm.length||($builtInForm=$elt.closest("form")),$builtInForm.length||($elt.wrap($$1("<form>",options.formAttributes)),$builtInForm=$elt.parent()),options.$input=$$1("input[type=file]",$elt),options.$browseBtn=$$1("."+options.browseBtnClass,$elt),options.$fileName=$$1("."+options.fileNameClass,$elt),options.$dropZone=$$1("."+options.dropZoneClass,$elt),options.$progressBar=$$1("."+options.progressBarClass,$elt),options.$form=$builtInForm,options.$uploadBtn=$$1("."+options.uploadBtnClass,$elt),options.$resetBtn=$$1("."+options.resetBtnClass,$elt),options.useDropZone=tests.dnd,options.dropZonePlaceholder=options.$dropZone.html(),options.fileNamePlaceholder=options.$fileName.text(),options.files=[],$elt.data(dataNs,options),self._reset($elt);var inputHandler=function(e){var finalFiles=[];_.forEach(e.target.files,function(file){finalFiles.push(file)}),self._selectFiles($elt,finalFiles)},dragOverHandler=function(e){e.preventDefault(),e.stopPropagation(),options.$dropZone.addClass(options.dragOverClass)},dragOutHandler=function(e){e.preventDefault(),e.stopPropagation(),options.$dropZone.removeClass(options.dragOverClass)};if(!tests.filereader)throw new Error("FileReader API not supported! Please use a compliant browser!");options.$input.on("change",inputHandler),options.$input.on("mousedown",function(e){return e.preventDefault(),$$1(this).blur(),!1}),options.useDropZone?($$1(document).off("drop."+ns).on("drop."+ns,function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),$$1(document).off("dragover."+ns).on("dragover."+ns,function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),options.$dropZone.on("dragover",dragOverHandler).on("dragend",dragOutHandler).on("dragleave",dragOutHandler).on("drop",function(e){var files=[];if(dragOutHandler(e),e.target.files?files=_.values(e.target.files):e.originalEvent.files?files=_.values(e.originalEvent.files):e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files&&(files=_.values(e.originalEvent.dataTransfer.files)),files&&files.length){var append=0<options.$dropZone.children("ul").length;options.multiple||(files=[files[0]],append=!1),self._selectFiles($elt,files,append)}return!1})):options.$dropZone.hide(),$elt.on("fileselect."+ns,function(){0===options.files.length&&self._reset($elt),options.upload&&options.$uploadBtn.off("click").on("click",function(e){e.preventDefault(),self._upload($elt,options.files)}).removeProp("disabled"),options.read&&self._read($elt,options.files),options.$resetBtn.off("click").on("click",function(e){e.preventDefault(),self._reset($elt)}).removeProp("disabled")}),$elt.trigger("create."+ns)}})},_selectFiles:function($elt,files,append){var self=this,options=$elt.data(dataNs),updateFileName=function(){var length=options.files.length;options.$fileName.text(length+" "+(1<length?__("files selected"):__("file selected"))).removeClass("placeholder")},listContent;0>=files.length&&!append&&self._reset($elt),0<files.length&&options.fileSelect.call($elt,files,function(filteredFiles){options.files=append?options.files.concat(filteredFiles):filteredFiles,options.useDropZone?(updateFileName(),listContent=_.reduce(filteredFiles,function(acc,file){return acc+fileEntryTpl({name:file.name,size:bytes.hrSize(file.size)})},""),append?options.$dropZone.children("ul").append(listContent):options.$dropZone.html("<ul>"+listContent+"</ul>"),options.$dropZone.off("click."+ns).on("click."+ns,"[data-role=delete]",function(e){var $fileEntry=$$1(this).parent(),name=$fileEntry.data("file-name");e.preventDefault(),e.stopPropagation(),name&&(options.files=_.reject(options.files,{name:name}),0===options.files.length?self._reset($elt):updateFileName(),$fileEntry.remove())})):(options.files=options.files.slice(0,1),options.$fileName.text(files[0].name).removeClass("placeholder")),$elt.trigger("fileselect."+ns)})},_files:function($elt){var files=[],options=$elt.data(dataNs);return options&&(files=options.files),files},_reset:function($elt){var options=$elt.data(dataNs);options.$fileName.text(options.fileNamePlaceholder).addClass("placeholder"),options.$dropZone.empty().html(options.dropZonePlaceholder),options.$uploadBtn.prop("disabled",!0),options.$resetBtn.prop("disabled",!0),options.$progressBar&&options.$progressBar.removeClass("success").progressbar("destroy").progressbar({value:0}),$elt.trigger("reset."+ns)},_upload:function($elt){var errors=[],options=$elt.data(dataNs),length,$fileEntries,entryHeight,q;options&&options.files.length&&(length=options.files.length,$fileEntries=$$1("ul",options.$dropZone),entryHeight=$$1("li:first",$fileEntries).outerHeight(),q=async.queue(function(file,done){var $fileEntry=$$1("li[data-file-name=\""+file.name+"\"]",$fileEntries),$status=$$1(".status",$fileEntry),index=$fileEntries.children().index($fileEntry);options.$dropZone.stop(!0,!0).animate({scrollTop:index*entryHeight},25),$status.removeClass("success").removeClass("error").addClass("sending"),options.$form.sendfile({url:options.uploadUrl,file:file,loaded:function(result){$status.removeClass("sending").removeClass("error").addClass("success"),done(null,result)},failed:function(message){message=message||options.defaultErrMsg,$status.removeClass("sending").removeClass("success").addClass("error").attr("title",message),done(new Error(message))}})},options.uploadQueueSize||1),options.$uploadBtn.prop("disabled",!0),options.$resetBtn.prop("disabled",!0),options.$progressBar.progressbar("value",0),_.forEach(options.files,function(file,index){_.delay(function(){q.push(file,function(err,result){var complete=100*((index+1)/length);err?(errors.push(err),$elt.trigger("fail."+ns,[file,err])):$elt.trigger("upload."+ns,[file,result]),options.$progressBar.progressbar("value",complete),100<=complete&&(errors.length===length?options.$progressBar.addClass("error"):0<errors.length?options.$progressBar.addClass("warning"):options.$progressBar.addClass("success"),$elt.trigger("end."+ns))})},50)}))},_read:function($elt){var options=$elt.data(dataNs);options&&options.files.length&&_.forEach(options.files,function(file){var filename=file.name,filesize=file.size,filetype=file.type,reader=new FileReader;reader.onload=function(e){options.$progressBar.progressbar("value",100),$elt.trigger("readend."+ns,[file,e.target.result])},reader.onloadstart=function(){options.$progressBar.progressbar("value",0),$elt.trigger("readstart."+ns,[file])},options.$progressBar.length&&(reader.onprogress=function(e){var percentProgress=Math.ceil(100*(_Mathround2(e.loaded)/_Mathround2(e.total)));options.$progressBar.progressbar("value",percentProgress)}),reader.readAsDataURL(file)})},destroy:function(){this.each(function(){var $elt=$$1(this);$$1(document).off("drop."+ns).off("dragover."+ns),$elt.empty(),$elt.trigger("destroy."+ns)})}};Pluginifier.register(ns,uploader,{expose:["reset","selectFiles","upload","read"]})}),define("ui/resourcemgr/fileSelector",["jquery","lodash","async","i18n","core/mimetype","handlebars","lib/dompurify/purify","ui/feedback","context","ui/uploader"],function($$1,_,async,__,mimeType,Handlebars,DOMPurify,feedback,context){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function fileSelectTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function shortenPath(path){var tokens=path.replace(/\/$/,"").split("/"),start=tokens.length-3,end=tokens.length-1,title=_.map(tokens,function(token,index){return index>start&&token?index<end?token[0]:token:void 0});return title=title.filter(Boolean),title.join("/")}function isTextLarger($element,text){var $dummy=$element.clone().detach().css({position:"absolute",visibility:"hidden","text-overflow":"clip",width:"auto"}).text(text).insertAfter($element),textSize=$dummy.width();return $dummy.remove(),textSize>$element.width()}function fileSelector(options){function setUpUploader(currentPath){var errors=[],$switcher=$$1(".upload-switcher a",$fileSelector);$uploader.on("upload.uploader",function(e,file,result){var path=$$1("[data-display=\""+currentPath+"\"]").data("path")||$$1("[data-display=\"/"+currentPath+"\"]").data("path");path||(path=currentPath),$container.trigger("filenew.resourcemgr",[result,path])}),$uploader.on("fail.uploader",function(e,file,err){errors.push(__("Unable to upload file %s : %s",file.name,err.message))}),$uploader.on("end.uploader",function(){0===errors.length?_.delay(switchUpload,500):feedback().error("<ul><li>"+errors.join("</li><li>")+"</li></ul>",{encodeHtml:!1}),errors=[]}),$uploader.uploader({upload:!0,multiple:!0,uploadUrl:options.uploadUrl+"?"+$$1.param(options.params)+"&"+options.pathParam+"="+currentPath,fileSelect:function(files,done){var givenLength=files.length,fileNames=[];if($fileContainer.find("li > .desc").each(function(){fileNames.push($$1(this).text().toLowerCase())}),options.params.filters){var filters=[],i;if(!_.isString(options.params.filters))for(i in options.params.filters)filters.push(options.params.filters[i].mime);else filters=options.params.filters.split(",");files=_.filter(files,function(file){var checkType=file.type.replace(/^["']+|['"]+$/g,"");return _.contains(filters,checkType)}),files.length!==givenLength&&feedback().error("Unauthorized files have been removed")}async.filter(files,function(file,cb){var result=!0;if(options.fileExistsUrl){var pathParam=currentPath+"/"+file.name;pathParam.replace("//","/"),$$1.getJSON(options.fileExistsUrl+"?"+$$1.param(options.params)+"&"+options.pathParam+"="+pathParam,function(response){response&&!0===response.exists&&(result=window.confirm("Do you want to override "+file.name+"?")),cb(result)})}else _.contains(fileNames,file.name.toLowerCase())&&(result=window.confirm("Do you want to override "+file.name+"?")),cb(result)},done)}}),$container.on("folderselect.resourcemgr",function(e,fullPath,data,uri){currentPath=uri,$uploader.uploader("options",{uploadUrl:options.uploadUrl+"?"+$$1.param(options.params)+"&"+options.pathParam+"="+currentPath+"&relPath="+currentPath})}),$switcher.click(function(e){e.preventDefault(),switchUpload()});var switchUpload=function(){"none"===$fileContainer.css("display")?($uploader.hide(),$fileContainer.show(),$switcher.filter(".upload").css({display:"inline-block"}),$switcher.filter(".listing").hide(),$browserTitle.text(__("Browse folders:"))):($fileContainer.hide(),$placeholder.hide(),$uploader.show(),$switcher.filter(".upload").hide(),$switcher.filter(".listing").css({display:"inline-block"}),$browserTitle.text(__("Upload into:")),$uploader.uploader("reset"))}}function updateFiles(path,files){$fileContainer.empty(),files.length?($placeholder.hide(),$fileContainer.append(fileSelectTpl({files:files}))):"none"!==$fileContainer.css("display")&&$placeholder.show()}var root=options.root||"/",disableUpload=options.disableUpload||!1,$container=options.$target,$fileSelector=$$1(".file-selector",$container),$fileContainer=$$1(".files",$fileSelector),$placeholder=$$1(".empty",$fileSelector),$uploader=$$1(".file-upload-container",$fileSelector),parentSelector="#"+$container.attr("id")+" .file-selector",$pathTitle=$fileSelector.find("h1 > .title"),$browserTitle=$$1(".file-browser > h1",$container);if(disableUpload){var $switcher=$$1(".upload-switcher",$fileSelector);$switcher.remove()}else setUpUploader(root);$container.on("folderselect.resourcemgr",function(e,fullPath,data,activePath){var files;$pathTitle.text(isTextLarger($pathTitle,fullPath)?shortenPath(fullPath):fullPath),_.isArray(data)&&(files=_.filter(data,function(item){return!!item.uri}).map(function(file){return file.type=mimeType.getFileType(file),file.display=void 0===file.identifier?(fullPath+"/"+file.name).replace("//","/"):file.identifier+file.name,file.viewUrl=options.downloadUrl+"?"+$$1.param(options.params)+"&"+options.pathParam+"="+encodeURIComponent(file.uri),file.downloadUrl=file.viewUrl+"&svgzsupport=true",file}),updateFiles(fullPath,files),activePath&&$$1("li[data-file=\""+activePath+"\"]").trigger("click"))}),$$1(parentSelector).off("click",".files li").on("click",".files li",function(){var $selected=$$1(this),$files=$$1(".files > li",$fileSelector),data=_.clone($selected.data());$files.removeClass("active"),$selected.addClass("active"),$container.trigger("fileselect.resourcemgr",[data])}),$$1(parentSelector).off("click",".files li a.select").on("click",".files li a.select",function(e){e.preventDefault();var data=_.pick($$1(this).parents("li").data(),["file","type","mime","size","alt"]);context.mediaSources&&0===context.mediaSources.length&&-1<data.file.indexOf("local/")&&(data.file=data.file.substring(6)),$container.trigger("select.resourcemgr",[[data]])}),$fileContainer.on("delete.deleter",function(e,$target){var params={},path;"deleter"===e.namespace&&$target.length&&(path=$target.data("file"),params[options.pathParam]=path,$$1.getJSON(options.deleteUrl,_.merge(params,options.params),function(response){response.deleted&&$container.trigger("filedelete.resourcemgr",[path])}))})}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,async=async&&async.hasOwnProperty("default")?async["default"]:async,__=__&&__.hasOwnProperty("default")?__["default"]:__,mimeType=mimeType&&mimeType.hasOwnProperty("default")?mimeType["default"]:mimeType,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,feedback=feedback&&feedback.hasOwnProperty("default")?feedback["default"]:feedback,context=context&&context.hasOwnProperty("default")?context["default"]:context,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n<li data-type=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-file=\"",(helper=helpers.uri)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.uri,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-display=\"",(helper=helpers.display)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.display,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-mime=\"",(helper=helpers.mime)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mime,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-size=\"",(helper=helpers.size)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.size,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-url=\"",(helper=helpers.viewUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.viewUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-download=\"",(helper=helpers.downloadUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.downloadUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-alt=\"",(helper=helpers.alt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.alt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"desc truncate\">",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <div class=\"actions\">\n        <div class=\"tlb\">\n            <div class=\"tlb-top\">\n                <span class=\"tlb-box\">\n                    <span class=\"tlb-bar\">\n                        <span class=\"tlb-start\"></span>\n                        <span class=\"tlb-group\">\n                            <a href=\"#\" class=\"tlb-button-off select\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select this file",options):helperMissing.call(depth0,"__","Select this file",options)))+"\"><span class=\"icon-move-item\"></span></a>\n                            <a href=\"",(helper=helpers.downloadUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.downloadUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" download=\"",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" target=\"_blank\" class=\"tlb-button-off download\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Download this file",options):helperMissing.call(depth0,"__","Download this file",options)))+"\"><span class=\"icon-download\"></span></a>\n                            <a href=\"#\" class=\"tlb-button-off\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove this file",options):helperMissing.call(depth0,"__","Remove this file",options)))+"\" data-delete=\":parent li\"><span class=\"icon-bin\"></span></a>\n                        </span>\n                        <span class=\"tlb-end\"></span>\n                    </span>  \n                </span>   \n            </div>\n        </div>\n    </div>\n</li>\n",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,stack1;return stack1=helpers.each.call(depth0,depth0&&depth0.files,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n",buffer});return fileSelector}),define("css!ui/resourcemgr/css/resourcemgr",[],function(){}),define("ui/resourcemgr",["jquery","lodash","core/pluginifier","ui/resourcemgr/fileBrowser","ui/resourcemgr/filePreview","ui/resourcemgr/fileSelector","handlebars","i18n","lib/dompurify/purify","ui/modal","css!ui/resourcemgr/css/resourcemgr.css"],function($$1,_,Pluginifier,fileBrowser,filePreview,fileSelector,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function layout(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,fileBrowser=fileBrowser&&fileBrowser.hasOwnProperty("default")?fileBrowser["default"]:fileBrowser,filePreview=filePreview&&filePreview.hasOwnProperty("default")?filePreview["default"]:filePreview,fileSelector=fileSelector&&fileSelector.hasOwnProperty("default")?fileSelector["default"]:fileSelector,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"resourcemgr modal\">\n\n    <h2>",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h2>\n\n    <div class=\"file-wrapper\">\n    \n        <!-- left section: items selection -->\n        <section class=\"file-browser\">\n            <h1>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Browse resources",options):helperMissing.call(depth0,"__","Browse resources",options)))+"</h1>\n            <div class=\"file-browser-wrapper\"></div>\n        </section>\n \n        <!-- test editor  -->\n        <section class=\"file-selector\">\n\n            <h1>\n                <div class=\"title lft\"></div>\n                <div class=\"upload-switcher rgt\">\n                    <a href=\"#\" class=\"btn-info small upload\"><span class=\"icon-add\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add file(s)",options):helperMissing.call(depth0,"__","Add file(s)",options)))+"</a>\n                    <a href=\"#\" class=\"btn-info small listing\"><span class=\"icon-undo\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Back to listing",options):helperMissing.call(depth0,"__","Back to listing",options)))+"</a>\n                </div>\n            </h1>\n\n            <div class=\"empty\">\n                "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No files",options):helperMissing.call(depth0,"__","No files",options)))+"\n            </div>\n\n            <ul class=\"files\"></ul>\n\n            <div class=\"file-upload-container\"></div>\n\n        </section>\n\n        <section class=\"file-preview\">\n\n            <h1>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Preview",options):helperMissing.call(depth0,"__","Preview",options)))+"</h1>\n\n            <div class=\"previewer\">\n                <p class=\"nopreview\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No Preview available",options):helperMissing.call(depth0,"__","No Preview available",options)))+"</p>\n            </div>\n       \n            <h2 class=\"toggler\" data-toggle=\"~ .file-properties\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File Properties",options):helperMissing.call(depth0,"__","File Properties",options)))+"</h2>\n\n            <div class=\"file-properties\">\n\n                <div class=\"grid-row\">\n                    <div class=\"col-2\">\n                        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Type",options):helperMissing.call(depth0,"__","Type",options)))+"\n                    </div>\n                    <div class=\"col-10 prop-type\"></div>\n                </div>\n\n                <div class=\"grid-row\">\n                    <div class=\"col-2\">\n                        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Size",options):helperMissing.call(depth0,"__","Size",options)))+"\n                    </div>\n                    <div class=\"col-10 prop-size\"></div>\n                </div>\n            \n                <div class=\"grid-row prop-url\">\n                    <div class=\"actions\">\n                        <a href=\"#\" download=\"\" target=\"_blank\" class=\"tlb-button-off download hidden\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Download this file",options):helperMissing.call(depth0,"__","Download this file",options)))+"\">\n                            <button class=\"btn-info small\">\n                                <span class=\"icon-download\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Download this file",options):helperMissing.call(depth0,"__","Download this file",options)))+"\n                            </button>\n                        </a>\n                    </div>\n                </div>\n            </div>\n\n            <h2 class=\"toggler\" data-toggle=\"~ .actions\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Actions",options):helperMissing.call(depth0,"__","Actions",options)))+"</h2>\n\n            <div class=\"actions\">\n                <button class=\"btn-success select-action small\" disabled>\n                    <span class=\"icon-move-item\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select",options):helperMissing.call(depth0,"__","Select",options)))+"\n                </button>\n            </div>\n\n        </section>\n\n    </div>\n</div>\n",buffer}),ns="resourcemgr",dataNs="ui."+ns,defaults={mediaSources:[{root:"local",path:"/"}],open:!0,appendContainer:".tao-scope:first",title:""},resourceMgr={init:function(options){var self=resourceMgr;return options=_.defaults(options,defaults),this.each(function(){var $elt=$$1(this),$target;if(!$elt.data(dataNs)){$elt.data(dataNs,options),_.functions(options).forEach(function(eventName){$elt.on(eventName+"."+ns,function(){options[eventName].apply($elt,arguments)})}),$target=options.$target||self._createTarget($elt),$target.modal({startClosed:!0,minWidth:"responsive"}),$target.on("select."+ns,function(e,files){self._close($elt),$elt.trigger(e,[files])}),$target.on("closed.modal",function(){$elt.trigger("close."+ns)});var $fileBrowser=$$1(".file-browser .file-browser-wrapper",$target);options.mediaSourcesUrl?$$1.getJSON(options.mediaSourcesUrl).done(function(data){for(var mediaSources=data||defaults.mediaSources,i=0;i<mediaSources.length;i++)options.root=mediaSources[i].root,options.path=mediaSources[i].path,$fileBrowser.append("<div class=\""+options.root+"\"><ul class=\"folders\"></ul></div>"),fileBrowser(options)}).fail(function(){for(var i=0;i<defaults.mediaSources.length;i++)options.root=defaults.mediaSources[i].root,options.path=defaults.mediaSources[i].path,$fileBrowser.append("<div class=\""+options.root+"\"><ul class=\"folders\"></ul></div>"),fileBrowser(options)}):options.path&&options.root&&($fileBrowser.append("<div class=\""+options.root+"\"><ul class=\"folders\"></ul></div>"),fileBrowser(options)),$fileBrowser.find("li.root:last").addClass("active"),fileSelector(options),filePreview(options),$elt.trigger("create."+ns,[$target[0]]),options.open&&self._open($elt)}else options=$elt.data(dataNs),options.open&&self._open($elt)})},_createTarget:function($elt){var options=$elt.data(dataNs);return options&&(options.targetId="resourcemgr-"+$$1(document).find(".resourcemgr").length,options.$target=$$1(layout({title:options.title||""})),options.$target.attr("id",options.targetId).css("display","none").appendTo(options.appendContainer),$elt.data(dataNs,options)),options.$target},_open:function($elt){var options=$elt.data(dataNs);options&&options.$target&&(options.$target.modal("open"),$elt.trigger("open."+ns))},_close:function($elt){var options=$elt.data(dataNs);options&&options.$target&&options.$target.modal("close")},destroy:function(){this.each(function(){var $elt=$$1(this),options=$elt.data(dataNs);$elt.data(dataNs,null),options.bindEvent!==void 0&&!1!==options.bindEvent&&$elt.off(options.bindEvent),options.targetId&&$$1("#"+options.targetId).remove(),$$1(window).off("resize.resourcemgr"),$elt.trigger("destroy."+ns)})}};Pluginifier.register(ns,resourceMgr)}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","lodash","taoQtiItem/qtiCreator/model/Stylesheet","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","ui/resourcemgr"],function($,styleEditor,__,_,Stylesheet,genericFeedbackPopup){'use strict';var $doc=$(document),styleSheetToggler=function(){var _createInfoBox=function(data){var $messageBox=$(genericFeedbackPopup(data)),closeTrigger=$messageBox.find(".close-trigger");return $("body").append($messageBox),closeTrigger.on("click",function(){$messageBox.fadeOut(function(){$(this).remove()})}),setTimeout(function(){closeTrigger.trigger("click")},4523),$messageBox};return{init:function init(itemConfig){var cssToggler=$("#style-sheet-toggler"),uploader=$("#stylesheet-uploader"),customCssToggler=$("[data-custom-css]"),getContext=function(trigger){trigger=$(trigger);var li=trigger.closest("li"),stylesheetObj=li.data("stylesheetObj")||new Stylesheet({href:li.data("css-res")}),input=li.find(".style-sheet-label-editor"),labelBox=input.prev(".file-label"),label=input.val();return{li:li,input:input,label:label,labelBox:labelBox,isCustomCss:!!li.data("custom-css"),isDisabled:li.find(".icon-preview").hasClass("disabled"),stylesheetObj:stylesheetObj,cssUri:stylesheetObj.attr("href")}};uploader.on("click",function(){uploader.resourcemgr({appendContainer:"#mediaManager",path:"/",root:"local",browseUrl:itemConfig.getFilesUrl,uploadUrl:itemConfig.fileUploadUrl,deleteUrl:itemConfig.fileDeleteUrl,downloadUrl:itemConfig.fileDownloadUrl,fileExistsUrl:itemConfig.fileExistsUrl,params:{uri:itemConfig.uri,lang:itemConfig.lang,filters:"text/css"},pathParam:"path",select:function select(e,files){var l=files.length,i;for(i=0;i<l;i++)styleEditor.addStylesheet(files[i].file)}})});var deleteStylesheet=function(trigger){var context=getContext(trigger),attr=context.isDisabled?"disabled-href":"href",cssLinks=$("head link");styleEditor.getItem().removeStyleSheet(context.stylesheetObj),cssLinks.filter("["+attr+"*=\""+context.cssUri+"\"]").remove(),context.li.remove(),$(".feedback-info").hide(),_createInfoBox({message:__("Style Sheet <b>%s</b> removed<br> Click <i>Add Style Sheet</i> to re-apply.").replace("%s",context.label),type:"info"}),$doc.trigger("customcssloaded.styleeditor",[styleEditor.getStyle()])},initLabelEditor=function(trigger){var context=getContext(trigger);context.labelBox.hide(),context.input.show()},downloadStylesheet=function(trigger){styleEditor.download(getContext(trigger).cssUri)},saveLabel=function(trigger){var context=getContext(trigger),title=$.trim(context.input.val());return title?void(context.stylesheetObj.attr("title",title),context.input.hide(),context.labelBox.html(title).show()):(context.stylesheetObj.attr("title",""),!1)},handleAvailability=function(trigger){var context=getContext(trigger),attrTo="disabled-href",attrFrom="href",link;context.isCustomCss?context.isDisabled?(styleEditor.create(),customCssToggler.removeClass("not-available")):(styleEditor.erase(),customCssToggler.addClass("not-available")):(context.isDisabled&&(attrTo="href",attrFrom="disabled-href"),link=$("link["+attrFrom+"$=\""+context.cssUri+"\"]"),link.attr(attrTo,link.attr(attrFrom)).removeAttr(attrFrom)),$(trigger).toggleClass("disabled")};cssToggler.on("click",function(e){var target=e.target,className=target.className;-1<className.indexOf("icon-bin")?deleteStylesheet(e.target):-1<className.indexOf("file-label")?initLabelEditor(e.target):-1<className.indexOf("icon-preview")?handleAvailability(e.target):-1<className.indexOf("icon-download")&&downloadStylesheet(e.target)}),cssToggler.on("keydown","input",function(e){13===e.keyCode&&$(e.target).trigger("blur")}),cssToggler.on("blur","input",function(e){saveLabel(e.target)})}}}();return styleSheetToggler}),define("json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json",function(){return{"sans-serif":["Arial, \"Helvetica Neue\", Helvetica, sans-serif","\"Avant Garde\", Avantgarde, \"Century Gothic\", CenturyGothic, \"AppleGothic\", sans-serif","Calibri, Candara, Segoe, \"Segoe UI\", Optima, Arial, sans-serif","Candara, Calibri, Segoe, \"Segoe UI\", Optima, Arial, sans-serif","\"Century Gothic\", CenturyGothic, AppleGothic, sans-serif","Corbel, \"Lucida Grande\", \"Lucida Sans Unicode\", \"Lucida Sans\", \"DejaVu Sans\", \"Bitstream Vera Sans\", \"Liberation Sans\", Verdana, \"Verdana Ref\", sans-serif","\"Franklin Gothic Medium\", \"Franklin Gothic\", \"ITC Franklin Gothic\", Arial, sans-serif","Frutiger, \"Frutiger Linotype\", Univers, Calibri, \"Gill Sans\", \"Gill Sans MT\", \"Myriad Pro\", Myriad, \"DejaVu Sans Condensed\", \"Liberation Sans\", \"Nimbus Sans L\", Tahoma, Geneva, \"Helvetica Neue\", Helvetica, Arial, sans-serif","Futura, \"Century Gothic\", AppleGothic, \"Trebuchet MS\", sans-serif","Geneva, Verdana, \"Lucida Sans\", \"Lucida Grande\", \"Lucida Sans Unicode\", sans-serif","\"Gill Sans\", \"Gill Sans MT\", Calibri, sans-serif","\"Helvetica Neue\", Helvetica, Arial, sans-serif","Impact, Haettenschweiler, \"Franklin Gothic Bold\", Charcoal, \"Helvetica Inserat\", \"Bitstream Vera Sans Bold\", \"Arial Black\", sans-serif","\"Lucida Grande\", \"Lucida Sans Unicode\", \"Lucida Sans\", Geneva, Verdana, sans-serif","Optima, Segoe, \"Segoe UI\", Candara, Calibri, Arial, sans-serif","\"Segoe UI\", Candara, \"Bitstream Vera Sans\", \"DejaVu Sans\", \"Bitstream Vera Sans\", \"Trebuchet MS\", Verdana, \"Verdana Ref\", sans-serif","Tahoma, Verdana, Segoe, sans-serif","\"Trebuchet MS\", \"Lucida Grande\", \"Lucida Sans Unicode\", \"Lucida Sans\", Tahoma, sans-serif","Verdana, Geneva, Tahoma, sans-serif"],serif:["Baskerville, \"Baskerville Old Face\", \"Hoefler Text\", Garamond, \"Times New Roman\", serif","\"Big Caslon\", \"Book Antiqua\", \"Palatino Linotype\", Georgia, serif","\"Bodoni MT\", Didot, \"Didot LT STD\", \"Hoefler Text\", Garamond, \"Times New Roman\", serif","\"Book Antiqua\", Palatino, \"Palatino Linotype\", \"Palatino LT STD\", Georgia, serif","\"Calisto MT\", \"Bookman Old Style\", Bookman, \"Goudy Old Style\", Garamond, \"Hoefler Text\", \"Bitstream Charter\", Georgia, serif","Cambria, \"Hoefler Text\", Utopia, \"Liberation Serif\", \"Nimbus Roman No9 L Regular\", Times, \"Times New Roman\", serif","Constantia, \"Lucida Bright\", Lucidabright, \"Lucida Serif\", Lucida, \"DejaVu Serif\", \"Bitstream Vera Serif\", \"Liberation Serif\", Georgia, serif","Didot, \"Didot LT STD\", \"Hoefler Text\", Garamond, \"Times New Roman\", serif","Garamond, Baskerville, \"Baskerville Old Face\", \"Hoefler Text\", \"Times New Roman\", serif","Georgia, Palatino,\" Palatino Linotype\", Times, \"Times New Roman\", serif","\"Goudy Old Style\", Garamond, \"Big Caslon\", \"Times New Roman\", serif","\"Hoefler Text\", \"Baskerville old face\", Garamond, \"Times New Roman\", serif","\"Lucida Bright\", Georgia, serif","\"Palatino Linotype\", Palatino, Palladio, \"URW Palladio L\", \"Book Antiqua\", Baskerville, \"Bookman Old Style\", \"Bitstream Charter\", \"Nimbus Roman No9 L\", Garamond, \"Apple Garamond\", \"ITC Garamond Narrow\", \"New Century Schoolbook\", \"Century Schoolbook\", \"Century Schoolbook L\", Georgia, serif","Perpetua, Baskerville, \"Big Caslon\", \"Palatino Linotype\", Palatino, \"URW Palladio L\", \"Nimbus Roman No9 L\", serif","Rockwell, \"Courier Bold\", Courier, Georgia, Times, \"Times New Roman\", serif","\"Times New Roman\", TimesNewRoman, Times, Baskerville, Georgia, serif"],monospace:["\"Andale Mono\", AndaleMono, monospace","Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", Monaco, \"Courier New\", Courier, monospace","\"Courier New\", Courier, \"Lucida Sans Typewriter\", \"Lucida Typewriter\", monospace","\"Lucida Console\", \"Lucida Sans Typewriter\", Monaco, \"Bitstream Vera Sans Mono\", monospace","Monaco, Consolas, \"Lucida Console\", monospace","\"Rockwell Extra Bold\", \"Rockwell Bold\", monospace"]}}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSelector",["jquery","json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","select2"],function($,fontStacks,styleEditor,__){'use strict';return function(){var fontSelector=$("select#item-editor-font-selector"),target=fontSelector.data("target"),$target=$(target),normalize=function(font){return font.replace(/"/g,"'").replace(/, /g,",")},clean=function(font){return font.substring(0,font.indexOf(",")).replace(/'/g,"")},resetButton=fontSelector.parent().find("[data-role=\"font-selector-reset\"]"),i=0,toLabel=function(font){return font=font.replace(/-/g," "),(font+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase()})},format=function(state){var originalOption=state.element;return state.id?"<span style=\"font-size: 12px;"+$(originalOption).attr("style")+"\">"+state.text+"</span>":state.text},generic,optGroup,option,l;for(generic in fontSelector.append("<option value=\"\">"+__("Default")+"</option>"),fontStacks)if(fontStacks.hasOwnProperty(generic)){for(optGroup=$("<optgroup>",{label:toLabel(generic)}),l=fontStacks[generic].length,i=0;i<l;i++)fontStacks[generic][i]=normalize(fontStacks[generic][i]),option=$("<option>",{value:fontStacks[generic][i],text:clean(fontStacks[generic][i])}).css({fontFamily:fontStacks[generic][i]}),optGroup.append(option);fontSelector.append(optGroup)}resetButton.on("click",function reset(){styleEditor.apply(target,"font-family"),fontSelector.select2("val",$target.css("font-family"))}),fontSelector.select2({formatResult:format,formatSelection:format,width:"resolve"}),$(document).on("customcssloaded.styleeditor",function(){}),fontSelector.on("change",function(){styleEditor.apply(target,"font-family",$(this).val())})}}),define("taoQtiItem/qtiCreator/helper/popup",["jquery","lodash","core/dataattrhandler"],function($,_,dataAttrHandler){'use strict';return{init:function init($trigger,options){options=_.assign({top:null,right:2,title:null},options||{});var open=function($trigger,$popup){var $container=$popup.parents(".sidebar-popup-parent"),$actionBar=$(".item-editor-action-bar"),baseOffsetTop=$actionBar.offset().top-$actionBar.height(),maxHeight=$(window).height()-baseOffsetTop,top=_.isNull(options.top)?$trigger.offset().top-baseOffsetTop-$popup.height()/2:options.top,$titleArea=$popup.find(".sidebar-popup-title"),$title=$titleArea.find("h3");$titleArea.length&&(maxHeight-=$titleArea.height()),$trigger.trigger("beforeopen.popup",{popup:$popup,trigger:$trigger}),$popup.show(),$popup.css({top:Math.max(baseOffsetTop,top),right:$container.hasClass("item-editor-sidebar-wrapper")?$container.width()+options.right:options.right}),options.title&&$title.text(options.title),$popup.find(".sidebar-popup-content").css({maxHeight:maxHeight}),$trigger.trigger("open.popup",{popup:$popup,trigger:$trigger})},close=function($trigger,$popup){$trigger.trigger("beforeclose.popup",{popup:$popup,trigger:$trigger}),$popup.hide(),$trigger.trigger("close.popup",{popup:$popup,trigger:$trigger})};$trigger.each(function(){var _trigger=$(this),$popup=options.popup||function(){return dataAttrHandler.getTarget("popup",_trigger)}(),$closer=$popup.find(".closer"),$dragger=$popup.find(".sidebar-popup-title").not($closer);if(!$popup||!$popup.length)throw new Error("No popup found");$closer.length&&$closer.on("click",function(){close(_trigger,$popup)}),$dragger.length&&$popup.draggable({handle:$dragger}),_trigger.prop("popup",$popup)}),$trigger.on("click",function(e){var _trigger=$(e.target),$popup=_trigger.prop("popup");e.preventDefault(),$popup.is(":visible")?close(_trigger,$popup):open(_trigger,$popup)})},reorderZindex:function(){}}}),define("taoQtiItem/qtiCreator/editor/styleEditor/colorSelector",["jquery","lodash","i18n","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/helper/popup","lib/farbtastic/farbtastic"],function($,_,__,styleEditor){'use strict';function rgbToHex(color){function toHexPair(inp){return("0"+parseInt(inp,10).toString(16)).slice(-2)}if(!_.isString(color))return color;var rgbArr=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i.exec(color);return _.isArray(rgbArr)&&4===rgbArr.length?"#"+toHexPair(rgbArr[1])+toHexPair(rgbArr[2])+toHexPair(rgbArr[3]):color}return function colorSelector(){var colorPicker=$(".item-editor-color-picker"),widget=colorPicker.find(".color-picker"),widgetBox=colorPicker.find(".color-picker-container"),titleElement=colorPicker.find("#color-picker-title"),input=colorPicker.find("#color-picker-input"),resetButtons=colorPicker.find(".reset-button"),colorTriggers=colorPicker.find(".color-trigger"),colorTriggerLabels=colorPicker.find("label"),currentProperty="color",$doc=$(document),setTitle=function(property,trigger){titleElement.text(trigger.parent().find("label").text())},setTriggerColor=function(){colorTriggers.each(function(){var $trigger=$(this),target=$trigger.data("target"),$target=$(target),style=styleEditor.getStyle()||{},value;style[target]&&style[target][$trigger.data("value")]?(value=style[target][$trigger.data("value")],$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):$target.css($trigger.data("value"))?(value=$target.css($trigger.data("value")),$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):($trigger.css("background-color",""),$trigger.attr("title",__("No value set")))})},widgetObj;widgetObj=$.farbtastic(widget).linkTo(input),widget.on("colorchange.farbtastic",function(e,color){styleEditor.apply(widget.prop("target"),currentProperty,color),setTriggerColor()}),setTriggerColor(),colorTriggers.add(colorTriggerLabels).on("click",function(){var $tmpTrigger=$(this),$trigger="label"===this.nodeName.toLowerCase()?$tmpTrigger.parent().find(".color-trigger"):$tmpTrigger,value=$trigger.css("background-color");widget.prop("target",$trigger.data("target")),widgetBox.hide(),currentProperty=$trigger.data("value"),setTitle(currentProperty,$trigger),widgetObj.setColor(rgbToHex($trigger.css("background-color"))),widgetBox.show()}),$doc.on("mouseup",function(e){return $(e.target).hasClass("closer")?(widgetBox.hide(),!1):widgetBox.is(e.target)||0!==widgetBox.has(e.target).length?void 0:(widgetBox.hide(),!1)}),$doc.on("keyup",function(e){if(27===e.keyCode)return widgetBox.hide(),!1}),resetButtons.on("click",function(){var $this=$(this),$colorTrigger=$this.parent().find(".color-trigger"),target=$colorTrigger.data("target"),value=$colorTrigger.data("value");styleEditor.apply(target,value),setTriggerColor()}),$doc.on("customcssloaded.styleeditor",setTriggerColor)}}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger",["jquery","lodash","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor"],function($,_,styleEditor){'use strict';return function fontSizeChanger(){var $fontSizeChanger=$("#item-editor-font-size-changer"),itemSelector=$fontSizeChanger.data("target"),$item=$(itemSelector),itemFontSize=parseInt($item.css("font-size"),10),$resetBtn=$fontSizeChanger.parents(".reset-group").find("[data-role=\"font-size-reset\"]"),$input=$("#item-editor-font-size-text"),resizeFont=function(){styleEditor.apply(itemSelector+" *","font-size",itemFontSize.toString()+"px")};$fontSizeChanger.find("a").on("click",function(e){if(e.preventDefault(),"reduce"===$(this).data("action")){if(10>=itemFontSize)return;itemFontSize--}else itemFontSize++;resizeFont(),$input.val(itemFontSize),$(this).parent().blur()}),$input.on("keydown",function(e){var c=e.keyCode;return _.contains([8,37,39,46],c)||48<=c&&57>=c||96<=c&&105>=c}),$input.on("blur",function(){itemFontSize=parseInt(this.value,10),resizeFont()}),$input.on("keydown",function(e){var c=e.keyCode;13===c&&$input.trigger("blur")}),$resetBtn.on("click",function(){$input.val(""),styleEditor.apply(itemSelector+" *","font-size")}),$(document).on("customcssloaded.styleeditor",function(e,style){style[itemSelector]&&style[itemSelector]["font-size"]?($input.val(parseInt(style[itemSelector]["font-size"],10)),$input.trigger("blur")):$input.val(parseInt($item.css("font-size"),10))})}}),define("taoQtiItem/qtiCreator/editor/styleEditor/itemResizer",["jquery","lodash","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","nouislider"],function($,_,styleEditor){'use strict';return function(item){var itemResizer=$("#item-editor-item-resizer"),target=itemResizer.data("target"),$target=$(target),targetWidth=$target.innerWidth(),itemWidthPrompt=itemResizer.find("[name=\"item-width-prompt\"]"),sliderBox=itemResizer.find(".slider-box"),slider=itemResizer.find("#item-editor-item-resizer-slider"),input=$("#item-editor-item-resizer-text"),resetButton=itemResizer.find("[data-role=\"item-width-reset\"]"),sliderSettings={range:{min:Math.min(768,targetWidth),max:Math.max(1200,targetWidth)},start:targetWidth},resizeItem=function(val){val?(val=parseInt(val).toString()+"px",styleEditor.apply(target,"width",val),styleEditor.apply(target,"max-width","none")):(styleEditor.apply(target,"width"),styleEditor.apply(target,"max-width")),item.data("widget").$container.trigger("resize.itemResizer")};itemWidthPrompt.on("click",function(){"slider"===this.value?(input.val($target.width()),slider.val($target.width()).trigger("slide"),sliderBox.slideDown(),item.data("responsive",!1),resizeItem($target.width())):(input.val(""),slider.val(sliderSettings.start),sliderBox.slideUp(),item.data("responsive",!0),resizeItem())}),slider.noUiSlider(sliderSettings),slider.on("slide",function(){var value=Math.round(slider.val());input.val(value),resizeItem(value)}),input.on("keydown",function(e){var c=e.keyCode;return _.contains([8,37,39,46],c)||48<=c&&57>=c||96<=c&&105>=c}),input.on("blur",function(){resizeItem(this.value)}),resetButton.on("click",function reset(){itemResizer.find("[value=\"no-slider\"]").trigger("click")}),$(document).on("customcssloaded.styleeditor",function(e,style){var width;style[target]&&style[target].width?(width=parseInt(style[target].width,10),input.val(width),slider.val(width),itemResizer.find("[value=\"slider\"]").trigger("click")):input.val($target.width())})}}),define("taoQtiItem/qtiCreator/editor/propertiesPanel",["lodash","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler","taoQtiItem/qtiCreator/editor/styleEditor/fontSelector","taoQtiItem/qtiCreator/editor/styleEditor/colorSelector","taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger","taoQtiItem/qtiCreator/editor/styleEditor/itemResizer"],function(_,panel,styleEditor,styleSheetToggler,fontSelector,colorSelector,fontSizeChanger,itemResizer){'use strict';return function($container,widget,config){panel.initSidebarAccordion($container),panel.initFormVisibilityListener(),styleEditor.init(widget.element,config),styleSheetToggler.init(config),fontSelector(),colorSelector(),fontSizeChanger(),itemResizer(widget.element)}}),define("taoQtiItem/qtiCreator/itemCreator",["jquery","lodash","i18n","module","core/eventifier","core/promise","taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/portableElementRegistry/icRegistry","taoQtiItem/qtiCreator/context/qtiCreatorContext","taoQtiItem/qtiCreator/helper/itemLoader","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/helper/xincludeRenderer","taoQtiItem/qtiCreator/editor/interactionsPanel","taoQtiItem/qtiCreator/editor/propertiesPanel","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor"],function($,_,__,module,eventifier,Promise,ciRegistry,icRegistry,qtiCreatorContextFactory,itemLoader,creatorRenderer,commonRenderer,xincludeRenderer,interactionPanel,propertiesPanel,eventHelper,styleEditor){'use strict';var loadItem=function(uri,label,itemDataUrl){return new Promise(function(resolve,reject){itemLoader.loadItem({uri:uri,label:label,itemDataUrl:itemDataUrl},function(item){item||reject(new Error("Unable to load the item")),item.data("uri",uri),resolve(item)})})},loadCustomInteractions=function(interactionsIds){return ciRegistry.loadCreators({include:interactionsIds})},loadInfoControls=function(){return icRegistry.loadCreators()};return function(config,areaBroker,pluginFactories){var qtiCreatorContext=qtiCreatorContextFactory(),plugins={},pluginRun=function(method){var execStack=[];return _.forEach(plugins,function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)},itemCreator;if(!_.isPlainObject(config))throw new TypeError("The item creator configuration is required");if(!config.properties||_.isEmpty(config.properties.uri)||_.isEmpty(config.properties.label)||_.isEmpty(config.properties.baseUrl))throw new TypeError("The creator configuration must contains the required properties triples: uri, label and baseUrl");if(!areaBroker)throw new TypeError("Without an areaBroker there are no chance to see something you know");return itemCreator=eventifier({init:function(){var self=this;_.forEach(pluginFactories,function(pluginFactory){var plugin=pluginFactory(self,areaBroker);plugins[plugin.getName()]=plugin}),$(document).off(".qti-widget"),this.on("save",function(silent){var item=this.getItem(),itemWidget=item.data("widget");Promise.all([itemWidget.save(),styleEditor.save()]).then(function(){silent||self.trigger("success",__("Your item has been saved")),self.trigger("saved")}).catch(function(err){self.trigger("error",err)})}),this.on("exit",function(){$(".item-editor-item",areaBroker.getItemPanelArea()).empty()});var usedCustomInteractionIds=[];loadItem(config.properties.uri,config.properties.label,config.properties.itemDataUrl).then(function(item){return _.isObject(item)?(_.forEach(item.getComposingElements(),function(element){element.is("customInteraction")&&usedCustomInteractionIds.push(element.typeIdentifier)}),self.item=item,!0):void self.trigger("error",new Error("Unable to load the item "+config.properties.label))}).then(function(){return Promise.all([loadCustomInteractions(usedCustomInteractionIds),loadInfoControls()])}).then(function(){return pluginRun("init").then(function(){self.trigger("init",self.item)})}).then(function(){return qtiCreatorContext.on("error",function(err){self.trigger("error",err)}),qtiCreatorContext.init()}).catch(function(err){self.trigger("error",err)})},render:function(){var self=this,item=this.getItem();return item&&_.isFunction(item.getUsedClasses)?(commonRenderer.setContext(areaBroker.getItemPanelArea()),commonRenderer.get(!0,config).setOption("baseUrl",config.properties.baseUrl),interactionPanel(areaBroker.getInteractionPanelArea()),$(document).on("ready.qti-widget",function(e,elt){"assessmentItem"===elt.element.qtiClass&&self.trigger("ready")}),config.qtiCreatorContext=qtiCreatorContext,creatorRenderer.get(!0,config,areaBroker).setOptions(config.properties).load(function(){var widget;item.setRenderer(this),areaBroker.getItemPanelArea().append(item.render()),Promise.all(item.postRender(_.clone(config.properties))).then(function(){return areaBroker.getContainer().data("widget",item),widget=item.data("widget"),_.each(item.getComposingElements(),function(element){"include"===element.qtiClass&&xincludeRenderer.render(element.data("widget"),config.properties.baseUrl)}),propertiesPanel(areaBroker.getPropertyPanelArea(),widget,config.properties),eventHelper.initElementToWidgetListeners(),pluginRun("render").then(function(){self.trigger("render")})}).catch(function(err){self.trigger("error",err)})},item.getUsedClasses()),this):this.trigger("error",new Error("We need an item to render."))},destroy:function(){var self=this;return $(document).off(".qti-widget"),pluginRun("destroy").then(function(){return qtiCreatorContext.destroy()}).then(function(){self.trigger("destroy")}).catch(function(err){self.trigger("error",err)}),this},getItem:function(){return this.item},getConfig:function(){return config}}),itemCreator}}),define("taoQtiItem/qtiCreator/editor/areaBroker",["lodash","ui/areaBroker"],function(_,areaBroker){'use strict';return _.partial(areaBroker,["menu","menuLeft","menuRight","editorBar","title","toolbar","interactionPanel","itemPanel","contentCreatorPanel","propertyPanel","itemPropertyPanel","elementPropertyPanel","itemStylePanel","modalContainer"])}),define("tpl!taoQtiItem/qtiCreator/plugins/button",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<li class=\"btn-info small ",(helper=helpers.cssClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cssClass,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"li-inner\"><span class=\"icon-",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n</li>",buffer})}),define("taoQtiItem/qtiCreator/plugins/menu/save",["jquery","i18n","core/plugin","ui/hider","tpl!taoQtiItem/qtiCreator/plugins/button"],function($,__,pluginFactory,hider,buttonTpl){'use strict';return pluginFactory({name:"save",init:function(){var self=this,itemCreator=this.getHost();this.$element=$(buttonTpl({icon:"save",title:__("Save the item"),text:__("Save"),cssClass:"save-trigger"})).on("click",function(e){e.preventDefault(),self.disable(),itemCreator.trigger("save")}),this.hide(),this.disable(),itemCreator.on("ready saved error",function(){self.enable()})},render:function(){var $container=this.getAreaBroker().getMenuArea();$container.append(this.$element),this.show()},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("util/strPad",[],function(){'use strict';var _Mathceil=Math.ceil;return function(input,pad_length,pad_string,pad_type){var half="",str_pad_repeater=function(s,len){for(var collect="";collect.length<len;)collect+=s;return collect=collect.substr(0,len),collect},pad_to_go;return input=input.toString(),input+="",pad_string=void 0===pad_string?" ":pad_string,"STR_PAD_LEFT"!==pad_type&&"STR_PAD_RIGHT"!==pad_type&&"STR_PAD_BOTH"!==pad_type&&(pad_type="STR_PAD_RIGHT"),0<(pad_to_go=pad_length-input.length)&&("STR_PAD_LEFT"===pad_type?input=str_pad_repeater(pad_string,pad_to_go)+input:"STR_PAD_RIGHT"===pad_type?input+=str_pad_repeater(pad_string,pad_to_go):"STR_PAD_BOTH"==pad_type&&(half=str_pad_repeater(pad_string,_Mathceil(pad_to_go/2)),input=half+input+half,input=input.substr(0,pad_length))),input}}),define("taoQtiItem/qtiCreator/plugins/menu/preview",["jquery","i18n","core/plugin","ui/hider","taoItems/preview/preview","tpl!taoQtiItem/qtiCreator/plugins/button","util/url"],function($,__,pluginFactory,hider,preview,buttonTpl,urlUtil){'use strict';return pluginFactory({name:"preview",init:function(){var self=this,itemCreator=this.getHost();itemCreator.on("preview",function(uri){preview.init(urlUtil.build(itemCreator.getConfig().properties.previewUrl,{uri:uri})),preview.show()}),this.$element=$(buttonTpl({icon:"preview",title:__("Preview the item"),text:__("Preview"),cssClass:"preview-trigger"})).on("click",function(e){$(document).trigger("open-preview.qti-item"),e.preventDefault(),self.disable(),itemCreator.trigger("preview",itemCreator.getItem().data("uri")),self.enable()})},render:function(){var $container=this.getAreaBroker().getMenuArea();$container.append(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiItem/qtiCreator/plugins/menu/print",["jquery","i18n","core/plugin","ui/hider","tpl!taoQtiItem/qtiCreator/plugins/button"],function($,__,pluginFactory,hider,buttonTpl){'use strict';var spreadClass=function($container,cssClass){$container.parents().each(function(){$(this).siblings().addClass(cssClass)})};return pluginFactory({name:"print",init:function(){var self=this,itemCreator=this.getHost();spreadClass(this.getAreaBroker().getItemPanelArea(),"item-no-print"),this.$element=$(buttonTpl({icon:"print",title:__("Print the item"),text:__("Print"),cssClass:"print-trigger"})).on("click",function(e){e.preventDefault(),window.print()}),this.hide(),this.disable(),itemCreator.on("ready",function(){self.enable()})},render:function(){var $container=this.getAreaBroker().getMenuArea();$container.append(this.$element),this.show()},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiItem/qtiCreator/plugins/content/title",["jquery","lodash","i18n","core/plugin"],function($,_,__,pluginFactory){'use strict';return pluginFactory({name:"title",init:function(){var config=this.getHost().getConfig(),item=this.getHost().getItem();item&&!_.isEmpty(item.attr("title"))?this.title=item.attr("title"):config&&config.properties&&config.properties.label&&(this.title=config.properties.label)},render:function(){this.title&&this.getAreaBroker().getTitleArea().text(this.title)}})}),define("taoQtiItem/qtiCreator/plugins/content/changeTracker",["jquery","lodash","i18n","core/plugin","core/promise","ui/dialog"],function($,_,__,pluginFactory,Promise,dialog){'use strict';var messages={preview:__("The item needs to be saved before it can be previewed"),leave:__("The item has unsaved changes, are you sure you want to leave ?"),exit:__("The item has unsaved changes, would you like to save it ?")},removeChangeHandlers;return pluginFactory({name:"changeTracker",init:function(){var itemCreator=this.getHost(),$container=this.getAreaBroker().getContainer(),styleChanges=!1,asking=!1,getSerializedItem=function(){var serialized="";try{serialized=JSON.stringify(itemCreator.getItem().toArray()),serialized=serialized.replace(/ {2,}/g," ")}catch(err){serialized=null}return serialized},originalItem=getSerializedItem(),hasChanged=function(){var currentItem;return!!styleChanges||(currentItem=getSerializedItem(),originalItem!==currentItem||_.isNull(currentItem)&&_.isNull(originalItem))},silentSave=function(){return new Promise(function(resolve){itemCreator.on("saved.silent",function(){this.off("saved.silent"),resolve()}).trigger("save",!0)})},confirmBefore=function(message){return new Promise(function(resolve,reject){var confirmDlg;return asking?reject():hasChanged()?void(asking=!0,confirmDlg=dialog({message:message,buttons:[{id:"dontsave",type:"regular",label:__("Don't save"),close:!0},{id:"cancel",type:"regular",label:__("Cancel"),close:!0},{id:"save",type:"info",label:__("Save"),close:!0}],autoRender:!0,autoDestroy:!0,onSaveBtn:function(){silentSave().then(resolve)},onDontsaveBtn:resolve,onCancelBtn:function(){confirmDlg.hide()}}).on("closed.modal",function(){asking=!1})):resolve()})};removeChangeHandlers=function(){$(document).off("stylechange.qti-creator"),$(".content-wrap").off(".qti-creator"),$(window).off("beforeunload.qti-creator")},$(document).one("customcssloaded.styleeditor",function(){originalItem=getSerializedItem(),styleChanges=!1}).on("stylechange.qti-creator",function(e,detail){detail&&detail.initializing||(styleChanges=!0)}),$(window).on("beforeunload.qti-creator",function(){if(!asking&&hasChanged())return messages.leave}).on("popstate",function(){removeChangeHandlers()}),$(".content-wrap").on("click.qti-creator",function(e){!$.contains($container.get(0),e.target)&&hasChanged()&&(e.stopImmediatePropagation(),e.preventDefault(),confirmBefore(messages.exit).then(function(){removeChangeHandlers(),e.target.click()}).catch(_.noop))}),itemCreator.on("ready saved",function(){originalItem=getSerializedItem(),styleChanges=!1}).before("exit",function(){return confirmBefore(messages.exit).then(function(){removeChangeHandlers()})}).before("preview",function(){return confirmBefore(messages.preview)})},destroy:function(){_.isFunction(removeChangeHandlers)&&removeChangeHandlers()}})}),define("ui/incrementer",["jquery","lodash","core/pluginifier","lib/gamp/gamp"],function($,_,Pluginifier,gamp){'use strict';var _Mathpow=Math.pow,_Mathmax8=Math.max,_Mathfloor3=Math.floor;$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,gamp=gamp&&gamp.hasOwnProperty("default")?gamp["default"]:gamp;var dataNs="ui.incrementer",defaults={disableClass:"disabled",step:1,min:null,max:null,zero:!1,incrementerClass:"incrementer",incrementerCtrlClass:"incrementer-ctrl",incrementerWrapperClass:"incrementer-ctrl-wrapper",decimal:0},Incrementer={init:function(options){var self=Incrementer;return options=_.defaults(options||{},defaults),this.each(function(){var $elt=$(this),wrapper=$("<span>",{class:options.incrementerWrapperClass}),$ctrl,currentValue;$elt.data(dataNs)||($elt.is("input[type=\"text\"]")?(currentValue=parseFloat($elt.val()).toFixed(options.decimal),$elt.wrap(wrapper),$elt.data(dataNs,options).addClass(options.incrementerClass).after("<span class=\"ctrl "+options.incrementerCtrlClass+"\"><a href=\"#\" class=\"inc\" title=\"+"+options.step+"\" tabindex=\"-1\"></a><a href=\"#\" class=\"dec\" title=\"-"+options.step+"\" tabindex=\"-1\"></a></span>").on("keydown",function(e){38===e.which?(self._inc($elt),this.select()):40===e.which&&(self._dec($elt),this.select())}).on("keyup",_.debounce(function(){var value=$elt.val(),negative="-"===value.charAt(0),options=$elt.data(dataNs);value=parseFloat(value.replace(/[^\d\.]/g,"")),isNaN(value)?$elt.val(""):(value=negative?-value:value,null===options.min||_.isNumber(options.min)&&value>=options.min||!0===options.zero&&0===value?$elt.val(value):($elt.val(options.min),value=options.min),null===options.max||_.isNumber(options.max)&&value<=options.max?$elt.val(value):$elt.val(options.max)),$elt.trigger("change")},600)).on("focus",function(){this.select()}).on("disable.incrementer",function(){$elt.prop("disabled",!0).addClass("disabled"),$ctrl.find(".inc,.dec").prop("disabled",!0).addClass("disabled")}).on("enable.incrementer",function(){$elt.prop("disabled",!1).removeClass("disabled"),$ctrl.find(".inc,.dec").removeProp("disabled").removeClass("disabled")}),(_.isNaN(currentValue)||null!==options.min&&currentValue<options.min||null!==options.max&&currentValue>options.max)&&$elt.val(options.min||0),$ctrl=$elt.next("."+options.incrementerCtrlClass),$ctrl.find(".inc").click(function(e){e.preventDefault(),$(this).prop("disabled")||self._inc($elt)}),$ctrl.find(".dec").click(function(e){e.preventDefault(),$(this).prop("disabled")||self._dec($elt)}),$elt.trigger("create.incrementer")):$.error("The incrementer plugin applies only on input element of the type text"))})},_toFixedDown:function(number,precision){var m=_Mathpow(10,precision||0);return _Mathfloor3(number*m)/m},_decimalPlaces:function(number){var match=(""+number).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return match?_Mathmax8(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0)):0},_inc:function($elt){var options=$elt.data(dataNs),current=parseFloat($elt.val()||0),value;value=gamp.add(current,options.step),_.isNumber(options.min)&&value<options.min&&(value=options.min),(null===options.max||_.isNumber(options.max)&&value<=options.max)&&($elt.val(value),$elt.trigger("increment.incrementer",[value]).trigger("change"))},_dec:function($elt){var options=$elt.data(dataNs),current=parseFloat($elt.val()||0),value;value=gamp.sub(current,options.step),!0===options.zero&&_.isNumber(options.min)&&value<options.min&&(value=0),(null===options.min||_.isNumber(options.min)&&value>=options.min||!0===options.zero&&0===value)&&($elt.val(value),$elt.trigger("decrement.incrementer",[value]).trigger("change"))},destroy:function(){this.each(function(){var $elt=$(this),options=$elt.data(dataNs);$elt.off("keyup keydown").siblings("."+options.incrementerCtrlClass).remove(),$elt.trigger("destroy.incrementer")})}};return Pluginifier.register("incrementer",Incrementer),function($container){$container.find("[data-increment]").each(function(){var $elt=$(this),decimal=Incrementer._decimalPlaces($elt.attr("data-increment")),step=parseFloat($elt.attr("data-increment")),zero=!!$elt.data("zero"),options={},min,max;options.zero=zero,_.isNaN(step)||(options.step=step),_.isNaN(decimal)||(options.decimal=decimal),$elt.attr("data-min")&&(min=parseFloat($elt.attr("data-min")),!_.isNaN(min)&&(options.min=min)),$elt.attr("data-max")&&(max=parseFloat($elt.attr("data-max")),!_.isNaN(max)&&(options.max=max)),$elt.incrementer(options)})}}),define("ui/selecter",["jquery","select2"],function($){'use strict';function lookupSelecter($container){$("select.select2",$container).each(function(){var $elt=$(this),hasSearch=!1!==$elt.data("has-search"),hasPlaceholder=!!($elt.attr("placeholder")||$elt.data("placeholder")),widthMethod=$elt.data("width")||"resolve",hasSelectedIndex=function(options){for(var i=options.length,selected=!1;i--;)if("string"==typeof options[i].getAttribute("selected")){selected=!0;break}return selected}(this.options),settings={width:widthMethod};hasPlaceholder&&this.options[0]&&this.options[0].text&&($elt.prepend("<option>"),!hasSelectedIndex&&(this.selectedIndex=this.options[0])),hasSearch||(settings.minimumResultsForSearch=-1),$elt.select2(settings)})}return $=$&&$.hasOwnProperty("default")?$["default"]:$,lookupSelecter}),define("ui/inplacer",["jquery","lodash","core/pluginifier","core/dataattrhandler"],function($,_,Pluginifier,DataAttrHandler){'use strict';function getText($elt){var text="";return $elt.contents().filter(function(){this.nodeType===Node.TEXT_NODE&&""!==$.trim(this.nodeValue)&&(text+=$.trim(this.nodeValue))}),text}function setText($elt,text){var set=!1;$elt.contents().filter(function(){if(this.nodeType===Node.TEXT_NODE&&!1==set)return set=!0,void(this.nodeValue=text)}),!1==set&&$elt.prepend(text)}function emptyText($elt){$elt.contents().filter(function(){this.nodeType===Node.TEXT_NODE&&(this.nodeValue="")})}function listenDataAttr($container){new DataAttrHandler("in-place",{container:$container,listenerEvent:"click",namespace:"ui.inplacer"}).init(function($elt,$target){var options={target:$target,bindEvent:!1};$elt.data("width")&&(options.width=$elt.data("width")),$elt.inplacer(options)}).trigger(function($elt){$elt.inplacer("toggle")})}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,DataAttrHandler=DataAttrHandler&&DataAttrHandler.hasOwnProperty("default")?DataAttrHandler["default"]:DataAttrHandler;var dataNs="ui.inplacer",defaults={disableClass:"disabled",bindEvent:"click",inplaceClass:"inplace",mapping:{textarea:["p","div"]}},InPlacer={init:function(options){return options=$.extend(!0,{},defaults,options),this.each(function(){var $elt=$(this);if(!$elt.data(dataNs)){var $target=options.target;/^#/.test($target.selector)||$.error("The target selector must referr to the of an element id or to the element to create."),0===$target.length?($elt.after("<input id='"+$target.selector.replace("#","")+"' type='hidden' />"),options.target=$($target.selector)):"INPUT"!==$target.prop("tagName")&&$.error("The target must be an input element."),$elt.data(dataNs,options),$elt.addClass(options.inplaceClass),InPlacer._sync($elt,$target),!1!==options.bindEvent&&$elt.on(options.bindEvent,function(e){0===$elt.children(":text").length&&(e.preventDefault(),InPlacer._edit($elt))}),$elt.trigger("create.inplacer")}})},_toggle:function($elt){0<$elt.children(":text").length?this._leave($elt):this._edit($elt)},_edit:function($elt){var self=this,options=$elt.data(dataNs),$target=options.target,text=getText($elt),width=options.width||$elt.width()+"px",$editor;if(emptyText($elt),_.contains(options.mapping.textarea,$elt.prop("tagName").toLowerCase())){var height=options.height||$elt.height()+"px";$editor=$elt.append("<textarea>"+text+"</textarea>").children(":input").width(width).height(height)}else $editor=$elt.prepend($("<input>",{type:"text"})).children(":input").width(width).focus().val(text);$editor.off("click").change(function(e){e.stopPropagation()}).keyup(function(e){13===e.which&&self._leave($elt)}).blur(function(){self._leave($elt)}).focus(),self._sync($elt,$target),$elt.trigger("edit.inplacer",[$target.val()])},_leave:function($elt){var options=$elt.data(dataNs),$target=options.target,$input=$elt.children(":input"),content=$input.val();$input.remove(),setText($elt,content),this._sync($elt,$target),$elt.trigger("leave.inplacer",[$target.val()]),$elt.trigger("change")},_sync:function($elt,$target){0<$elt.children(":text").length?$target.val($elt.children(":text").val()):$target.val(getText($elt))},destroy:function(){this.each(function(){var $elt=$(this),options=$elt.data(dataNs);$elt.removeClass(options.inplaceClass),!1!==options.bindEvent&&$elt.off(options.bindEvent),$elt.removeData(dataNs),$elt.trigger("destroy.inplacer")})}};return Pluginifier.register("inplacer",InPlacer,{expose:["toggle","leave","edit"]}),listenDataAttr}),define("ui/validator/Report",[],function(){'use strict';var Report=function(type,data){this.type=type,this.data=data};return Report.prototype.isError=function(){return"failure"===this.type||"error"===this.type},Report}),define("ui/validator/validators",["jquery","lodash","i18n"],function($,_,__){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__;var validators={numeric:{name:"numeric",message:__("must be numeric"),options:{},validate:function(value,callback){var parsedValue=parseFloat(value),r=parsedValue.toString()===value.toString()&&_.isNumber(parsedValue)&&!_.isNaN(parsedValue);"function"==typeof callback&&callback.call(null,r)}},notEmpty:{name:"notEmpty",message:__("this is required"),options:{},validate:function(value,callback){var r;r=!!_.isNumber(value)||!_.isEmpty(value),"function"==typeof callback&&callback.call(null,r)}},pattern:{name:"pattern",message:__("does not match"),options:{pattern:"",modifier:"igm"},validate:function(value,callback,options){var regex=new RegExp(options.pattern,options.modifier||""),match=value.match(regex),r=null!==match;return"function"==typeof callback&&callback.call(null,r),r}},length:{name:"length",message:__("required length"),options:{min:0,max:0},validate:function(value,callback,options){var r=!1;value.length>=options.min&&(options.max?r=value.length<=options.max:r=!0),"function"==typeof callback&&callback.call(null,r)}},fileExists:{name:"fileExists",message:__("no file not found in this location"),options:{baseUrl:""},validate:function(){return function(value,callback,options){if(!value)return void callback(!1);var pattern=/^(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])?)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/i;pattern.test(value)||/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/.test(value)?callback(!0):$.ajax({type:"HEAD",url:options.baseUrl+encodeURIComponent(value),success:function(){callback(!0)},error:function(){callback(!1)}})}}()},validRegex:{name:"validRegex",message:__("invalid regular expression"),options:{},validate:function(value,callback){if("function"==typeof callback){var valid=!1;if(""!==value)try{new RegExp("^"+value+"$"),valid=!0}catch(e){valid=!1}else valid=!0;callback(valid)}}}},register=function(name,validator,force){if(_.isPlainObject(name)&&name.name&&!validator&&(validator=name,name=validator.name),!_.isString(name)||_.isEmpty(name))throw new Error("Please name your validator");if(!_.isObject(validator)||!_.isString(validator.message)||!_.isFunction(validator.validate))throw new Error("A validator must be an object with a message and a validate method, but given : "+JSON.stringify(validator));validators[name]&&!force||(validators[name]=validator)};return{validators:validators,register:register}}),define("ui/validator/Validator",["lodash","async","ui/validator/Report","ui/validator/validators"],function(_,async,Report,validators){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,async=async&&async.hasOwnProperty("default")?async["default"]:async,Report=Report&&Report.hasOwnProperty("default")?Report["default"]:Report,validators=validators&&validators.hasOwnProperty("default")?validators["default"]:validators;var _buildRule=function(rule){var ret=null,_rules=validators.validators;return _.isString(rule)&&_rules[rule]?ret=_rules[rule]:_.isObject(rule)&&rule.name&&(_rules[rule.name]?ret=_.merge(_.cloneDeep(_rules[rule.name]),rule):rule.message&&_.isFunction(rule.validate)&&(ret=rule)),ret},_defaultOptions={lazy:!1},_applyRules=function(value,rule,callback,options){options=_.merge(_.cloneDeep(rule.options),options),rule.validate(value,callback,options)},Validator=function(rules,options){this.options=_.merge(_.cloneDeep(_defaultOptions),options),this.rules=[],this.addRules(rules)};return Validator.getDefaultOptions=function(){return _.clone(_defaultOptions)},Validator.prototype.validate=function(value,arg1,arg2){var callstack=[],options=_.cloneDeep(this.options),callback;return _.isFunction(arg1)?callback=arg1:_.isObject(arg1)&&(_.merge(options,arg1),_.isFunction(arg2)&&(callback=arg2)),_.each(this.rules,function(rule){var validatorOptions={},message;callstack.push(function(cb){_applyRules(value,rule,function(success){if(success)cb(null,new Report("success",{validator:rule.name}));else{message=rule.options.message||rule.message;var report=new Report("failure",{validator:rule.name,message:message});options.lazy?cb(new Error("lazy mode"),report):cb(null,report)}},validatorOptions)})}),async.series(callstack,function(err,results){_.isFunction(callback)&&callback(results)}),this},Validator.prototype.addRule=function(rule){var _rules=validators.validators;return _.isString(rule)&&_rules[rule]?this.rules.push(_rules[rule]):(rule=_buildRule(rule))&&this.rules.push(rule),this},Validator.prototype.addRules=function(rules){var _this=this;return _.each(rules,function(rule){_this.addRule(rule)}),this},Validator}),define("ui/validator",["jquery","lodash","ui/validator/Report","ui/validator/Validator"],function($,_,Report,Validator){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function isCreated($elt){return"object"===_typeof($elt.data("validator-config"))}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,Report=Report&&Report.hasOwnProperty("default")?Report["default"]:Report,Validator=Validator&&Validator.hasOwnProperty("default")?Validator["default"]:Validator,$.fn.validator=function(options){var opts={},method="",args=[],ret;return"object"===_typeof(options)?opts=$.extend({},$.fn.validator.defaults,options):void 0===options?opts=$.extend({},$.fn.validator.defaults):"string"==typeof options&&"function"==typeof methods[options]&&(method=options,args=Array.prototype.slice.call(arguments,1)),this.each(function(){var $this=$(this);isCreated($this)||create($this,opts),method&&(isCreated($this)?ret=methods[method].apply($(this),args):$.error("call of method of validator when it is not initialized"))}),void 0===ret?this:ret},$.fn.validator.defaults={allowEmpty:!1,validator:{lazy:!1}};var methods={destroy:function(){_destroy($(this))},validate:function(arg1,arg2){var options={},callback;_.isFunction(arg1)?callback=arg1:_.isObject(arg1)&&(_.merge(options,arg1),_.isFunction(arg2)&&(callback=arg2)),_validate($(this),callback,options)},getValidator:function(){return $(this).data("validator-instance")}},buildRules=function($elt){var rulesStr=$elt.data("validate"),rules=rulesStr?tokenize(rulesStr):{};return rules},tokenize=function(inputStr){var ret=[],tokens=inputStr.split(/;/);return _.each(tokens,function(token){token=$.trim(token);var options={},rightStr=token.replace(/\$(\w*)/,function($0,k){return key=k,""}),key;if(key){var optionsStr=rightStr.replace(/^\((.*)\)$/,"$1");optionsStr=optionsStr.replace(/(\w+)=((\"(\\.|[^\"])*\")|(\'(\\.|[^\'])*\')),?/g,function($0,optionName,optionValue){return optionValue=optionValue.replace(/^["'](.*)["']$/g,"$1"),options[optionName]=optionValue,""}),optionsStr.replace(/(\w*)=([^\s]*)(,)?/g,function($0,optionName,optionValue){","===optionValue.charAt(optionValue.length-1)&&(optionValue=optionValue.substring(0,optionValue.length-1)),options[optionName]=optionValue}),ret.push({name:key,options:options})}}),ret},buildOptions=function($elt){var optionsStr=$elt.data("validate-option"),optionsArray=optionsStr?tokenize(optionsStr):{},availableCoreValidatorOptions=_.keys(Validator.getDefaultOptions()),options=_.clone($.fn.validator.defaults);return _.each(optionsArray,function(optionArray){0<=_.indexOf(availableCoreValidatorOptions,optionArray.name)?options.validator[optionArray.name]=optionArray.options:options[optionArray.name]=optionArray.options}),options},create=function($elt,options){if(!isCreated($elt)){var rules=buildRules($elt);options.rules&&(rules=_.merge(rules,options.rules),delete options.rules),options=_.merge(options,buildOptions($elt)||{}),$elt.data("validator-config",_.clone(options)),createValidator($elt,rules,options)}},_destroy=function($elts){$elts.removeData("validator-instance validator-config"),$elts.off(".validator")},createValidator=function($elt,rules,options){$elt.data("validator-instance",new Validator(rules,options.validator||{})),options.event&&bindEvents($elt,options)},bindEvents=function($elt,options){var events=_.isArray(options.event)?options.event:[options.event];0<events.length&&_.isFunction(options.validated)&&_.forEach(events,function(event){switch(_.isString(event)&&(event={type:event}),event.type){case"keyup":case"keydown":$elt.on(event.type,function(){var v=$elt.val();event.length?v&&v.length>event.length&&_validate($elt,options.validated,{}):_validate($elt,options.validated,{})});break;case"change":case"blur":$elt.on(event.type,function(){_validate($elt,options.validated,{})});break;default:$.error("unknown event type to be bound to validation : "+event.type);}})},_validate=function($elt,callback,options){var value=$elt.val(),defaults=$elt.data("validator-config"),execCallback=function(results){var valid;$elt.trigger("validated",{elt:$elt[0],results:results}),_.isFunction(callback)&&(valid=0===_.where(results,{type:"failure"}).length,callback.call($elt[0],valid,results))};defaults.allowEmpty&&""===value?execCallback([new Report("success",{validator:"allowEmpty"})]):$elt.data("validator-instance").validate(value,options||{},execCallback)}}),define("ui/groupvalidator",["jquery","lodash","ui/validator"],function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,$.fn.groupValidator=function(options){return options=_.defaults(options||{},$.fn.groupValidator.defaults),this.each(function(){var $container=options.$container=$(this),states=[],callback=function(valid,results){var $elt=$(this);states[$elt.attr("name")]=valid,options.callback.call(this,valid,results,options),$elt.trigger("validated.single",[valid]),$container.trigger("validated.group",[!1===_(states).values().contains(!1),this])},$toValidate=$("[data-validate]",$container).validator({event:options.events,validated:callback});options.validateOnInit&&$toValidate.validator("validate",{},callback)})},$.fn.groupValidator.defaults={validateOnInit:!1,errorClass:"error",errorMessageClass:"validate-error",events:["change","blur"],callback:function(valid,results,options){var $elt=$(this),rule;$elt.siblings("."+options.errorMessageClass).remove(),!1===valid?(rule=_.where(results,{type:"failure"})[0],$elt.addClass(options.errorClass),rule&&rule.data.message&&$elt.after("<span class='"+options.errorMessageClass+"'>"+rule.data.message+"</span>")):$elt.removeClass(options.errorClass)}}}),define("taoQtiItem/qtiCreator/widgets/helpers/validators",["ui/validator/validators","lodash","i18n","taoQtiItem/qtiItem/core/Element"],function(validators,_,__,Element){'use strict';var _qtiIdPattern=/^[_a-zA-Z]{1}[a-zA-Z0-9\-._]{0,31}$/i,qtiValidators=[{name:"qtiIdentifier",message:__("invalid identifier"),validate:function(value,callback){"function"==typeof callback&&callback(_qtiIdPattern.test(value))}},{name:"availableIdentifier",message:__("this identifier is already in use"),validate:function(value,callback,options){if(options.serial){var element=Element.getElementBySerial(options.serial);if(element&&"function"==typeof callback){var ids=element.getRootElement().getUsedIdentifiers(),available=!ids[value]||ids[value].serial===element.serial;callback(available)}}else throw"missing required option \"serial\""}},{name:"availableVariableIdentifier",message:__("identifier already taken"),validate:function(value,callback,options){if(options.serial){var element=Element.getElementBySerial(options.serial);if(element&&"function"==typeof callback){var ids=element.getRootElement().getUsedIdentifiers(),available=!ids[value]||ids[value].serial===element.serial||!ids[value].is("variableDeclaration");callback(available)}}else throw"missing required option \"serial\""}}];return _.each(qtiValidators,function(rule){validators.register(rule.name,rule)}),validators}),define("taoQtiItem/qtiCreator/widgets/helpers/formElement",["jquery","lodash","i18n","taoQtiItem/qtiItem/core/Element","util/dom","ui/incrementer","ui/tooltip","ui/selecter","ui/inplacer","ui/groupvalidator","taoQtiItem/qtiCreator/widgets/helpers/validators"],function($,_,__,Element,dom,spinner,tooltip,select2){'use strict';var updateResponseDeclaration=function(interaction,maxChoice,updateCardinality){var correct=[],responseDeclaration;if(!Element.isA(interaction,"interaction"))throw new Error("The first argument must be an interaction, the current element is "+interaction.qtiClass);updateCardinality=!("undefined"!=typeof updateCardinality)||!!updateCardinality,responseDeclaration=interaction.getResponseDeclaration(),updateCardinality&&responseDeclaration.attr("cardinality",1===maxChoice?"single":"multiple"),maxChoice&&(_.forEach(responseDeclaration.getCorrect(),function(c){return!!(correct.length<maxChoice)&&void correct.push(c)}),responseDeclaration.setCorrect(correct))},createTooltip=function($input,validatorOptions){var formElementTooltip=tooltip.error($input," ",{trigger:"manual",container:validatorOptions.$container[0]});$input.data("$tooltip")&&($input.data("$tooltip").dispose(),$input.removeData("$tooltip")),$input.data("$tooltip",formElementTooltip),$input.attr("data-has-tooltip",!0)},validationCallback=function(valid,results,validatorOptions){var $input=$(this),rule;dom.contains($input)&&(createTooltip($input,validatorOptions),valid?$input.data("$tooltip").hide():(rule=_.where(results,{type:"failure"})[0],rule&&rule.data.message&&!$("#mediaManager").children(".opened").length&&($input.data("$tooltip").updateTitleContent(rule.data.message),$input.data("$tooltip").show())))};return{initWidget:function($form){spinner($form),tooltip.lookup($form),select2($form)},setChangeCallbacks:function($form,element,attributes,options){var applyCallback=function(name,value,$elt){var cb=attributes&&attributes[name];_.isFunction(cb)&&cb.call($elt[0],element,value,name)},callbackSimple=function(){var $elt=$(this),name=$elt.attr("name");$elt.is(":checkbox")?applyCallback(name,$elt.prop("checked"),$elt):applyCallback(name,$elt.val(),$elt)},callbackWithValidation=function(e,valid,elt){var $elt,name;"group"===e.namespace&&($elt=$(elt),name=$elt.attr("name"),valid&&applyCallback(name,$elt.val(),$elt),options.invalidate&&element.data("widget").isValid(name,valid))};options=_.defaults(options||{},{validateOnInit:!1,invalidate:!1}),$form.off(".databinding"),$form.on("change.databinding keyup.databinding",":checkbox, :radio, select, :text:not([data-validate]), :hidden:not([data-validate])",callbackSimple),$form.on("keyup.databinding input.databinding propertychange.databinding","textarea",callbackSimple),$form.on("validated.group.databinding",callbackWithValidation),_.defer(function(){$form.groupValidator({validateOnInit:options.validateOnInit,events:["change","blur",{type:"keyup",length:0}],callback:validationCallback})})},removeChangeCallback:function($form){$form.off(".databinding"),$form.find(":input[data-has-tooltip]").data("$tooltip").dispose(),$form.find(":input[data-has-tooltip]").removeAttr("data-has-tooltip").removeData("$tooltip")},getAttributeChangeCallback:function(allowEmpty){return function(element,value,name){allowEmpty||""!==value?element.attr(name,value):element.removeAttr(name)}},getMinMaxAttributeCallbacks:function($form,attributeNameMin,attributeNameMax,options){var callbacks={};return options=_.defaults(options||{},{allowNull:!1,updateCardinality:!0,attrMethodNames:{remove:"removeAttr",set:"attr"},floatVal:!1,callback:_.noop}),callbacks[attributeNameMin]=function(element,value,name){var isActualNumber;value=options.floatVal?parseFloat(value):parseInt(value,10),isActualNumber=!isNaN(value),options.allowNull||0!==value&&isActualNumber?isActualNumber&&element[options.attrMethodNames.set](name,value):element[options.attrMethodNames.remove](name),options.callback(element,value,name)},callbacks[attributeNameMax]=function(element,value,name){value=options.floatVal?parseFloat(value):parseInt(value,10)||0,element.is("interaction")&&updateResponseDeclaration(element,value,options.updateCardinality),!value&&(element.is("orderInteraction")||element.is("graphicOrderInteraction"))?element[options.attrMethodNames.remove](name):element[options.attrMethodNames.set](name,value),options.callback(element,value,name)},callbacks}}}),define("taoQtiItem/qtiXmlRenderer/renderers/config",["taoItems/assets/manager"],function(assetManagerFactory){'use strict';var assetManager=assetManagerFactory([{name:"nomalize",handle:function(url){if(url)return url.toString().replace(/^\.?\//,"")}}]);return{name:"xmlRenderer",locations:{_container:"taoQtiItem/qtiXmlRenderer/renderers/Container",assessmentItem:"taoQtiItem/qtiXmlRenderer/renderers/Item",stylesheet:"taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",responseDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",outcomeDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",responseProcessing:"taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",_tooltip:"taoQtiItem/qtiXmlRenderer/renderers/Tooltip",math:"taoQtiItem/qtiXmlRenderer/renderers/Math",img:"taoQtiItem/qtiXmlRenderer/renderers/Img",object:"taoQtiItem/qtiXmlRenderer/renderers/Object",table:"taoQtiItem/qtiXmlRenderer/renderers/Table",modalFeedback:"taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",rubricBlock:"taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",associateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",selectPointInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",prompt:"taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",associableHotspot:"taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",gap:"taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",gapImg:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",gapText:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",hotspotChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",hottext:"taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",inlineChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice",customInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/PortableCustomInteraction",endAttemptInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/EndAttemptInteraction",infoControl:"taoQtiItem/qtiXmlRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiXmlRenderer/renderers/Include",printedVariable:"taoQtiItem/qtiXmlRenderer/renderers/PrintedVariable"},options:{assetManager:assetManager}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiXmlRenderer/renderers/config"],function(Renderer,config){'use strict';return Renderer.build(config.locations,config.name,config.options)}),define("taoQtiItem/qtiItem/helper/response",["lodash"],function(_){'use strict';var _templateNames={MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct",MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response",MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point",NONE:"no_response_processing"};return{isUsingTemplate:function(response,tpl){return!!(_.isString(tpl)&&(tpl===response.template||_templateNames[tpl]===response.template))},isValidTemplateName:function(tplName){return!!this.getTemplateUriFromName(tplName)},getTemplateUriFromName:function(tplName){return _templateNames[tplName]?_templateNames[tplName]:""},getTemplateNameFromUri:function(tplUri){var tplName="";return _.forIn(_templateNames,function(uri,name){if(uri===tplUri)return tplName=name,!1}),tplName}}}),define("taoQtiItem/qtiItem/helper/maxScore",["lodash","lib/gamp/gamp","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration"],function(_,gamp,responseHelper,OutcomeDeclaration){'use strict';var _Mathmin7=Math.min,pairExists=function(collection,pair){return 2===pair.length&&(collection[pair[0]+" "+pair[1]]||collection[pair[1]+" "+pair[0]])};return{setNormalMaximum:function(item){var scoreOutcome=item.getOutcomeDeclaration("SCORE"),normalMaximum;scoreOutcome&&item.responseProcessing&&"templateDriven"===item.responseProcessing.processingType&&(normalMaximum=_.reduce(item.getInteractions(),function(acc,interaction){var interactionMaxScore=interaction.getNormalMaximum();return!!_.isNumber(interactionMaxScore)&&gamp.add(acc,interactionMaxScore)},0),_.isNumber(normalMaximum)?scoreOutcome.attr("normalMaximum",normalMaximum):scoreOutcome.removeAttr("normalMaximum"))},setMaxScore:function(item){var hasInvalidInteraction=!1,scoreOutcome=item.getOutcomeDeclaration("SCORE"),customOutcomes,maxScore,maxScoreOutcome;scoreOutcome&&item.responseProcessing&&"templateDriven"===item.responseProcessing.processingType&&(maxScore=_.reduce(item.getInteractions(),function(acc,interaction){var interactionMaxScore=interaction.getNormalMaximum();return _.isNumber(interactionMaxScore)?gamp.add(acc,interactionMaxScore):(hasInvalidInteraction=!0,acc)},0),customOutcomes=_(item.getOutcomes()).filter(function(outcome){return"SCORE"!==outcome.id()&&"MAXSCORE"!==outcome.id()}),customOutcomes.size()&&(maxScore=customOutcomes.reduce(function(acc,outcome){return gamp.add(acc,parseFloat(outcome.attr("normalMaximum")||0))},maxScore)),!hasInvalidInteraction||customOutcomes.size()?(maxScoreOutcome=item.getOutcomeDeclaration("MAXSCORE"),!maxScoreOutcome&&(maxScoreOutcome=new OutcomeDeclaration({cardinality:"single",baseType:"float"}),item.addOutcomeDeclaration(maxScoreOutcome),maxScoreOutcome.buildIdentifier("MAXSCORE",!1)),maxScoreOutcome.setDefaultValue(maxScore)):item.removeOutcome("MAXSCORE"))},getMatchMaxOrderedChoices:function(choiceCollection){return _(choiceCollection).map(function(choice){var matchMax=parseInt(choice.attr("matchMax"),10);return _.isNaN(matchMax)&&(matchMax=0),{matchMax:0===matchMax?1/0:matchMax,id:choice.id()}}).sortBy("matchMax").reverse().valueOf()},choiceInteractionBased:function(interaction,options){var responseDeclaration=interaction.getResponseDeclaration(),mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),max,maxChoice,minChoice,scoreMaps,requiredChoiceCount,totalAnswerableResponse,sortedMapEntries,missingMapsCount;if(options=_.defaults(options||{},{maxChoices:0,minChoices:0}),maxChoice=parseInt(interaction.attr("maxChoices")||options.maxChoices,10),minChoice=0,maxChoice&&minChoice&&maxChoice<minChoice)return 0;if("MATCH_CORRECT"===template)max=maxChoice&&_.isArray(responseDeclaration.correctResponse)&&(responseDeclaration.correctResponse.length>maxChoice||responseDeclaration.correctResponse.length<minChoice)?0:responseDeclaration.correctResponse&&(!_.isArray(responseDeclaration.correctResponse)||responseDeclaration.correctResponse.length)?1:0;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;requiredChoiceCount=minChoice,totalAnswerableResponse=0===maxChoice?1/0:maxChoice,scoreMaps=_.values(responseDeclaration.mapEntries),sortedMapEntries=_(scoreMaps).map(function(v){return parseFloat(v)}).sortBy().reverse().first(totalAnswerableResponse),missingMapsCount=minChoice-sortedMapEntries.size(),_.times(missingMapsCount,function(){sortedMapEntries.push(mapDefault)}),mapDefault&&0<mapDefault&&(missingMapsCount=maxChoice?maxChoice-sortedMapEntries.size():_.size(interaction.getChoices())-sortedMapEntries.size(),0<missingMapsCount&&_.times(missingMapsCount,function(){sortedMapEntries.push(mapDefault)})),max=sortedMapEntries.reduce(function(acc,v){var score=v;return 0>score&&0>=requiredChoiceCount&&(score=0),requiredChoiceCount--,gamp.add(acc,score)},0),responseDeclaration.mappingAttributes.upperBound&&(max=_Mathmin7(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},orderInteractionBased:function(interaction){var minChoice=0,maxChoice=parseInt(interaction.attr("maxChoices")||0,10),responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),max;return maxChoice&&0&&0>maxChoice?0:("MATCH_CORRECT"===template?_.isArray(responseDeclaration.correctResponse)&&maxChoice&&responseDeclaration.correctResponse.length>maxChoice||0?max=0:responseDeclaration.correctResponse&&(!_.isArray(responseDeclaration.correctResponse)||responseDeclaration.correctResponse.length)?max=1:max=0:("MAP_RESPONSE"===template||"MAP_RESPONSE_POINT"===template)&&(max=0),max)},associateInteractionBased:function(interaction,options){var responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),maxAssoc=parseInt(interaction.attr("maxAssociations")||0,10),minAssoc=0,mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0),max,requiredAssoc,totalAnswerableResponse,usedChoices,choicesIdentifiers,sortedMapEntries,i,allPossibleMapEntries,infiniteScoringPair;if(options=_.defaults(options||{},{possiblePairs:[],checkInfinitePair:!1}),maxAssoc&&minAssoc&&maxAssoc<minAssoc)return 0;if("MATCH_CORRECT"===template)!responseDeclaration.correctResponse||_.isArray(responseDeclaration.correctResponse)&&(!responseDeclaration.correctResponse.length||maxAssoc&&responseDeclaration.correctResponse.length>maxAssoc||minAssoc&&responseDeclaration.correctResponse.length<minAssoc)?max=0:(max=1,choicesIdentifiers=[],_.forEach(responseDeclaration.correctResponse,function(pair){var choices;_.isString(pair)&&(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length&&(choicesIdentifiers.push(choices[0].trim()),choicesIdentifiers.push(choices[1].trim())))}),_.forEach(_.countBy(choicesIdentifiers),function(count,identifier){var choice=interaction.getChoiceByIdentifier(identifier),matchMax;return choice?(matchMax=parseInt(choice.attr("matchMax"),10),matchMax&&matchMax<count)?(max=0,!1):void 0:(max=0,!1)}));else if("MAP_RESPONSE"===template){if(requiredAssoc=minAssoc,totalAnswerableResponse=0===maxAssoc?1/0:maxAssoc,usedChoices={},!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;if(allPossibleMapEntries=_.clone(responseDeclaration.mapEntries),mapDefault&&0<mapDefault&&_.forEachRight(options.possiblePairs,function(pair){pairExists(allPossibleMapEntries,pair)||(allPossibleMapEntries[pair[0]+" "+pair[1]]=mapDefault)}),sortedMapEntries=_(allPossibleMapEntries).map(function(score,pair){return{score:parseFloat(score),pair:pair}}).sortBy("score").reverse().filter(function(mapEntry){var pair=mapEntry.pair,choices,choiceId,choice,_usedChoices;if(!_.isString(pair))return!1;if(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length){for(_usedChoices=_.cloneDeep(usedChoices),i=0;2>i;i++){if(choiceId=choices[i],!_usedChoices[choiceId]){if(choice=interaction.getChoiceByIdentifier(choiceId),!choice)return!1;_usedChoices[choiceId]={used:0,max:parseInt(choice.attr("matchMax"),10)}}if(_usedChoices[choiceId].max&&_usedChoices[choiceId].used===_usedChoices[choiceId].max)return!1;_usedChoices[choiceId].used++}return infiniteScoringPair=infiniteScoringPair||options.checkInfinitePair&&0<mapEntry.score&&0===_usedChoices[choices[0]].max&&0===_usedChoices[choices[1]].max,_.assign(usedChoices,_usedChoices),!0}return!1}).first(totalAnswerableResponse),infiniteScoringPair)return!1;max=sortedMapEntries.reduce(function(acc,v){var score=v.score;return 0>v.score&&0>=requiredAssoc&&(score=0),requiredAssoc--,gamp.add(acc,score)},0),responseDeclaration.mappingAttributes.upperBound&&(max=_Mathmin7(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},gapMatchInteractionBased:function(interaction){var responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),maxAssoc=0,minAssoc=0,mapDefault=parseFloat(responseDeclaration.mappingAttributes.defaultValue||0),getMatchMaxOrderedChoices=function(choiceCollection){return _(choiceCollection).map(function(choice){return{matchMax:0===choice.attr("matchMax")?1/0:choice.attr("matchMax")||0,id:choice.id()}}).sortBy("matchMax").reverse().valueOf()},calculatePossiblePairs=function(gapMatchInteraction){var pairs=[],matchSet1=getMatchMaxOrderedChoices(gapMatchInteraction.getChoices()),matchSet2=getMatchMaxOrderedChoices(gapMatchInteraction.getGaps());return _.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs},max,skippableWrongResponse,totalAnswerableResponse,usedChoices,usedGaps,group1,group2,allPossibleMapEntries;if("MATCH_CORRECT"===template)responseDeclaration.correctResponse&&(!_.isArray(responseDeclaration.correctResponse)||responseDeclaration.correctResponse.length)?(max=1,group1=[],group2=[],_.forEach(responseDeclaration.correctResponse,function(pair){var choices;_.isString(pair)&&(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length&&(group1.push(choices[0].trim()),group2.push(choices[1].trim())))}),_.forEach(_.countBy(group1),function(count,identifier){var choice=interaction.getChoiceByIdentifier(identifier),matchMax=parseInt(choice.attr("matchMax"),10);if(matchMax&&matchMax<count)return max=0,!1}),_.forEach(_.countBy(group2),function(count){if(1<count)return max=0,!1})):max=0;else if("MAP_RESPONSE"===template){if(skippableWrongResponse=1/0,totalAnswerableResponse=1/0,usedChoices={},usedGaps={},!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;allPossibleMapEntries=_.clone(responseDeclaration.mapEntries),mapDefault&&0<mapDefault&&_.forEachRight(calculatePossiblePairs(interaction),function(pair){pairExists(allPossibleMapEntries,pair)||(allPossibleMapEntries[pair[0]+" "+pair[1]]=mapDefault)}),max=_(allPossibleMapEntries).map(function(score,pair){return{score:parseFloat(score),pair:pair}}).sortBy("score").reverse().filter(function(mapEntry){var pair=mapEntry.pair,_usedChoices=_.cloneDeep(usedChoices),choices,choiceId,gapId,choice;if(!_.isString(pair))return!1;if(choices=pair.trim().split(" "),_.isArray(choices)&&2===choices.length){if(choiceId=choices[0],gapId=choices[1],!_usedChoices[choiceId]){if(choice=interaction.getChoiceByIdentifier(choiceId),!choice)return!1;_usedChoices[choiceId]={used:0,max:parseInt(choice.attr("matchMax"),10)}}return!(_usedChoices[choiceId].max&&_usedChoices[choiceId].used===_usedChoices[choiceId].max)&&(_usedChoices[choiceId].used++,usedGaps[gapId]||(usedGaps[gapId]={used:0,max:1}),!(usedGaps[gapId].max&&usedGaps[gapId].used===usedGaps[gapId].max))&&(usedGaps[gapId].used++,_.assign(usedChoices,_usedChoices),!0)}return!1}).first(totalAnswerableResponse).reduce(function(acc,v){var score=v.score;return 0<=score?acc+score:0<skippableWrongResponse?(skippableWrongResponse--,acc):acc+score},0),responseDeclaration.mappingAttributes.upperBound&&(max=_Mathmin7(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=!1);return max},selectPointInteractionBased:function(interaction){var maxChoice=parseInt(interaction.attr("maxChoices"),10),minChoice=0,responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),max,skippableWrongResponse,totalAnswerableResponse;return"MATCH_CORRECT"===template||"MAP_RESPONSE"===template?0:("MAP_RESPONSE_POINT"===template&&(skippableWrongResponse=1/0,totalAnswerableResponse=0===maxChoice?1/0:maxChoice,max=_(responseDeclaration.mapEntries).map(function(v){return parseFloat(v.mappedValue)}).sortBy().reverse().first(totalAnswerableResponse).reduce(function(acc,v){return 0<=v?acc+v:0<skippableWrongResponse?(skippableWrongResponse--,acc):acc+v},0),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=_Mathmin7(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))),max)},sliderInteractionBased:function(interaction){var responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),max,scoreMaps;if("MATCH_CORRECT"===template)max=responseDeclaration.correctResponse&&(!_.isArray(responseDeclaration.correctResponse)||responseDeclaration.correctResponse.length)?1:0;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;scoreMaps=_.values(responseDeclaration.mapEntries),max=_(scoreMaps).map(function(v){return parseFloat(v)}).max(),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=_Mathmin7(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max},textEntryInteractionBased:function(interaction){var responseDeclaration=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(responseDeclaration.template),isPossibleResponse=function(value){var patternMask=interaction.attr("patternMask");return!patternMask||!!value.match(new RegExp(patternMask))},max,scoreMaps;if("MATCH_CORRECT"===template)max=responseDeclaration.correctResponse&&(!_.isArray(responseDeclaration.correctResponse)||responseDeclaration.correctResponse.length)?isPossibleResponse(responseDeclaration.correctResponse[0])?1:0:0;else if("MAP_RESPONSE"===template){if(!responseDeclaration.mapEntries||!_.size(responseDeclaration.mapEntries))return 0;scoreMaps=_.values(_.filter(responseDeclaration.mapEntries,function(score,key){return isPossibleResponse(key)})),max=_(scoreMaps).map(function(v){return parseFloat(v)}).max(),max=parseFloat(max),responseDeclaration.mappingAttributes.upperBound&&(max=_Mathmin7(max,parseFloat(responseDeclaration.mappingAttributes.upperBound||0)))}else"MAP_RESPONSE_POINT"===template&&(max=0);return max}}}),define("taoQtiItem/qtiCreator/helper/xmlRenderer",["core/logger","taoQtiItem/qtiXmlRenderer/renderers/Renderer","taoQtiItem/qtiItem/helper/maxScore","taoQtiItem/qtiItem/core/Element"],function(loggerFactory,XmlRenderer,maxScore,Element){'use strict';var logger=loggerFactory("taoQtiItem/qtiCreator/helper/xmlRenderer"),_xmlRenderer=new XmlRenderer({shuffleChoices:!1}).load();return{render:function _render(element){var xml="";try{element instanceof Element&&(element.is("assessmentItem")&&(maxScore.setNormalMaximum(element),maxScore.setMaxScore(element)),xml=element.render(_xmlRenderer))}catch(e){logger.error(e)}return xml},get:function get(){return _xmlRenderer}}}),define("tpl!taoQtiItem/qtiCreator/tpl/outcomeEditor/panel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"qti-outcome-editor panel\">\n    <hr/>\n    <h3 class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Outcome Declarations",options):helperMissing.call(depth0,"__","Outcome Declarations",options)))+"</h3>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">here you can provide scoring aspects for manual scoring/marking, e.g. CONTENT, GRAMMAR, SPELLING</span>\n    <div class=\"outcomes\">\n        ",(helper=helpers.listing)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.listing,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    <a href=\"#\" class=\"adder feedbackRule-add\">Add an outcome</a>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/outcomeEditor/listing",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n<div class=\"outcome-container panel subpanel",stack1=helpers["if"].call(depth0,depth0&&depth0.readonly,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"identifier-label\" title=\"",(helper=helpers.interpretation)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.interpretation,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n        <span class=\"label\">",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n        <input class=\"identifier\"\n               name=\"identifier\"\n               value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n               type=\"text\"\n               placeholder=\"e.g. CONTENT\"\n               data-validate=\"$notEmpty; $qtiIdentifier; $availableVariableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n    </div>\n    <span class=\"trigger icon-bin\" title=\"",(helper=helpers.titleDelete)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.titleDelete,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"delete\"></span>\n    <span class=\"trigger icon-edit sidebar-popup-trigger\" data-popup=\"~ .sidebar-popup\" title=\"",(helper=helpers.titleEdit)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.titleEdit,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"edit\"></span>\n    <div class=\"outcome-properties-form\">\n        <div class=\"panel\">\n            <label for=\"interpretation\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interpretation",options):helperMissing.call(depth0,"__","Interpretation",options)))+"</label>\n            <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"A human interpretation of the variable's value.",options):helperMissing.call(depth0,"__","A human interpretation of the variable's value.",options)))+"</div>\n            <input name=\"interpretation\" value=\"",(helper=helpers.interpretation)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.interpretation,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\">\n        </div>\n        <div class=\"panel minimum-maximum\">\n            <label class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Value",options):helperMissing.call(depth0,"__","Value",options)))+"</label>\n            <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Defines the maximum magnitude of numeric outcome variables, the maximum must be a positive value and the minimum may be negative.",options):helperMissing.call(depth0,"__","Defines the maximum magnitude of numeric outcome variables, the maximum must be a positive value and the minimum may be negative.",options)))+"</div>\n            <input name=\"normalMinimum\" value=\"",(helper=helpers.normalMinimum)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.normalMinimum,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\".1\" type=\"text\" />\n            <label for=\"normalMaximum\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"to",options):helperMissing.call(depth0,"__","to",options)))+"</label>\n            <input name=\"normalMaximum\" value=\"",(helper=helpers.normalMaximum)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.normalMaximum,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\".1\" data-min=\"0\" type=\"text\" />\n        </div>\n    </div>\n</div>\n",buffer}function program2(){return" readonly"}function program4(){return" editable deletable"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var self=this,escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1;return stack1=helpers.each.call(depth0,depth0&&depth0.outcomes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCreator/plugins/panel/outcomeEditor",["jquery","lodash","i18n","core/plugin","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/popup","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration","taoQtiItem/qtiCreator/helper/xmlRenderer","tpl!taoQtiItem/qtiCreator/tpl/outcomeEditor/panel","tpl!taoQtiItem/qtiCreator/tpl/outcomeEditor/listing"],function($,_,__,pluginFactory,Element,popup,formElement,OutcomeDeclaration,xmlRenderer,panelTpl,listingTpl){'use strict';function getRpUsedVariables(item){var rpXml=xmlRenderer.render(item.responseProcessing),variables=["SCORE","MAXSCORE"],$rp=$(rpXml);return $rp.find("variable,setOutcomeValue").each(function(){var id=$(this).attr("identifier");variables.push(id)}),_.uniq(variables)}function renderListing(item,$outcomeEditorPanel){var rpVariables=getRpUsedVariables(item),outcomesData=_.map(item.outcomes,function(outcome){var readonly=0<=rpVariables.indexOf(outcome.id());return{serial:outcome.serial,identifier:outcome.id(),interpretation:outcome.attr("interpretation"),normalMaximum:outcome.attr("normalMaximum"),normalMinimum:outcome.attr("normalMinimum"),titleDelete:readonly?__("Cannot delete a variable currently used in response processing"):__("Delete"),titleEdit:readonly?__("Cannot edit a variable currently used in response processing"):__("Edit"),readonly:readonly}});$outcomeEditorPanel.find(".outcomes").html(listingTpl({outcomes:outcomesData})),formElement.initWidget($outcomeEditorPanel)}return pluginFactory({name:"outcomeEditor",init:function(){var item=this.getHost().getItem(),$container=this.getAreaBroker().getContainer(),$responsePanel=$container.find("#sidebar-right-response-properties"),$outcomeEditorPanel;$container.on("initResponseForm.outcome-editor",function(){$responsePanel.find(".qti-outcome-editor").remove(),$outcomeEditorPanel=$(panelTpl()),$outcomeEditorPanel.on("click.outcome-editor",".editable [data-role=\"edit\"]",function(){var $outcomeContainer=$(this).closest(".outcome-container"),serial=$outcomeContainer.data("serial"),outcome=Element.getElementBySerial(serial),$labelContainer=$outcomeContainer.find(".identifier-label"),$identifierLabel=$labelContainer.find(".label"),$identifierInput=$labelContainer.find(".identifier");$outcomeContainer.addClass("editing"),$identifierInput.focus(),$identifierInput.val(""),$identifierInput.val(outcome.id()),formElement.setChangeCallbacks($outcomeContainer,outcome,_.assign({identifier:function identifier(outcome,value){$identifierLabel.html(value),outcome.id(value)},interpretation:function interpretation(outcome,value){$labelContainer.attr("title",value),outcome.attr("interpretation",value)}},formElement.getMinMaxAttributeCallbacks($outcomeContainer,"normalMinimum","normalMaximum",{allowNull:!0,floatVal:!0,callback:function callback(outcome,value,attr){isNaN(value)&&outcome.removeAttr(attr)}})))}).on("click.outcome-editor",".editing [data-role=\"edit\"]",function(){var $outcomeContainer=$(this).closest(".outcome-container");$outcomeContainer.removeClass("editing"),formElement.removeChangeCallback($outcomeContainer)}).on("click.outcome-editor",".deletable [data-role=\"delete\"]",function(){var $outcomeContainer=$(this).closest(".outcome-container");$outcomeContainer.remove(),item.remove("outcomes",$outcomeContainer.data("serial"))}).on("click.outcome-editor",".adder",function(){var newOutcome=new OutcomeDeclaration({cardinality:"single",baseType:"float",normalMinimum:0,normalMaximum:1});item.addOutcomeDeclaration(newOutcome),newOutcome.buildIdentifier("OUTCOME"),renderListing(item,$outcomeEditorPanel)}),$responsePanel.append($outcomeEditorPanel),renderListing(item,$outcomeEditorPanel)})}})}),define("taoQtiItem/qtiCreator/plugins/loader",["core/pluginLoader","taoQtiItem/qtiCreator/plugins/menu/save","taoQtiItem/qtiCreator/plugins/menu/preview","taoQtiItem/qtiCreator/plugins/menu/print","taoQtiItem/qtiCreator/plugins/content/title","taoQtiItem/qtiCreator/plugins/content/changeTracker","taoQtiItem/qtiCreator/plugins/panel/outcomeEditor"],function(pluginLoader,save,preview,print,title,changeTracker,outcomeEditor){'use strict';return pluginLoader({menu:[save,preview,print],content:[title,changeTracker],panel:[outcomeEditor]})}),define("taoQtiItem/controller/creator/index",["jquery","lodash","module","core/logger","core/promise","ui/feedback","layout/loading-bar","taoQtiItem/qtiCreator/itemCreator","taoQtiItem/qtiCreator/editor/areaBroker","taoQtiItem/qtiCreator/plugins/loader"],function($,_,module,loggerFactory,Promise,feedback,loadingBar,itemCreatorFactory,areaBrokerFactory,pluginLoader){'use strict';var loadAreaBroker=function(){var $container=$("#item-editor-scope");return areaBrokerFactory($container,{menu:$(".menu",$container),menuLeft:$(".menu-left",$container),menuRight:$(".menu-right",$container),contentCreatorPanel:$("#item-editor-panel",$container),editorBar:$("#item-editor-panel .item-editor-bar",$container),title:$("#item-editor-panel .item-editor-bar h1",$container),toolbar:$("#item-editor-panel .item-editor-bar #toolbar-top",$container),interactionPanel:$("#item-editor-interaction-bar",$container),propertyPanel:$("#item-editor-item-widget-bar",$container),itemPanel:$("#item-editor-scroll-inner",$container),itemPropertyPanel:$("#sidebar-right-item-properties",$container),itemStylePanel:$("#item-style-editor-bar",$container),modalContainer:$("#modal-container",$container),elementPropertyPanel:$("#item-editor-body-element-property-bar .panel",$container)})};return{start:function start(){var config=module.config(),logger=loggerFactory("controller/creator"),reportError=function(err){loadingBar.stop(),logger.error(err),err instanceof Error&&feedback().error(err.message)};loadingBar.start(),config&&(config.plugins&&_.forEach(config.plugins,function(plugin){plugin&&plugin.module&&pluginLoader.add(plugin)}),config.contextPlugins&&_.forEach(config.contextPlugins,function(plugin){plugin&&plugin.module&&(plugin.exclude?pluginLoader.remove(plugin.module):pluginLoader.add(plugin))})),pluginLoader.load().then(function(){itemCreatorFactory(config,loadAreaBroker(),pluginLoader.getPlugins()).on("error",reportError).on("success",function(message){return feedback().success(message)}).on("init",function(){this.render()}).on("ready",function(){return loadingBar.stop()}).init()}).catch(reportError)}}}),define("taoQtiItem/controller/routes",[],function(){'use strict';return{QtiPreview:{actions:{index:"taoItems/controller/preview/itemRunner"}},QtiCreator:{actions:{index:"controller/creator/index"}}}}),define("taoQtiItem/mathRenderer/mathRenderer",["mathJax"],function(MathJax){return{render:function($container){$container.find("math").each(function(){var $math=$(this);$math.wrap($("<span>",{class:"math-renderer"}));var $wrap=$math.parent(".math-renderer");MathJax.Hub.Queue(["Typeset",MathJax.Hub,$wrap[0]])})}}}),define("taoQtiItem/portableElementRegistry/provider/localManifestProvider",["lodash","context","core/promise"],function(_,context,Promise){'use strict';function setPortableElementPrefix(obj,prefix){var ret;return _.isArray(obj)?ret=_.map(obj,function(v){return setPortableElementPrefix(v,prefix)}):_.isPlainObject(obj)?(ret={},_.forIn(obj,function(v,k){ret[k]=setPortableElementPrefix(v,prefix)})):_.isString(obj)&&(ret=obj.replace("./",prefix+"/")),ret}function useSource(manifest){var runtimeModules,runtimeSrc;return"IMSPCI"===manifest.model?(runtimeModules=(manifest.runtime||{}).modules,runtimeSrc=(manifest.runtime||{}).src||[],runtimeSrc.length&&_.forOwn(runtimeModules,function(allModulesFiles,moduleKey){moduleKey.indexOf(".min")===moduleKey.length-4&&(runtimeModules[moduleKey]=allModulesFiles.map(function(filePath){return filePath.replace(".min.js",".js")}))})):(manifest.runtime&&_.isArray(manifest.runtime.src)&&(delete manifest.runtime.hook,manifest.runtime.libraries=manifest.runtime.src),manifest.creator&&_.isArray(manifest.creator.src)&&(delete manifest.creator.hook,manifest.creator.libraries=manifest.creator.src)),manifest}var _portableElementManifests={},_registry={};return{addManifestPath:function(id,pathToManifest){return _portableElementManifests[id]=pathToManifest,this},getModuleName:function(){return"taoQtiItem/portableElementRegistry/provider/localManifestProvider"},load:function(){return new Promise(function(resolve,reject){var _requiredManifests=_.map(_portableElementManifests,function(manifest){return"json!"+manifest});require(_requiredManifests,function(){var ok=!0;_.each([].slice.call(arguments),function(manifest){var id;if(manifest&&manifest.typeIdentifier){if(id=manifest.typeIdentifier,!_portableElementManifests[id])return reject("typeIdentifier mismatch"),ok=!1,!1;manifest=useSource(manifest),manifest.baseUrl=window.location.origin+"/"+_portableElementManifests[id].replace(/^([a-zA-Z]*)\/(.*)\/([a-zA-Z]*)(Creator.json$)/,"$1/views/js/$2"),_registry[id]=[setPortableElementPrefix(manifest,id)]}}),ok&&resolve(_registry)},reject)})}}}),define("taoQtiItem/portableElementRegistry/provider/sideLoadingProviderFactory",[],function(){'use strict';return function(portableElements){var _registry=portableElements;return{add:function(id,portableElement){return _registry[id]=portableElement,this},load:function(){return _registry}}}}),define("ui/ckeditor/dtdHandler",["lodash"],function(_){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_;var dtdHandler=function(){function _normalizeElement(element){if(_.isObject(element)&&!_.isArray(element)){if("nodeName"in element)return element.nodeName.toLowerCase();if(0 in element&&"nodeName"in element[0])return element[0].nodeName.toLowerCase()}else if(_.isString(element))return element.toLowerCase();throw new Error("Unknown element "+element)}var dtdMode="html",dtds={},setMode=function(mode){if("xhtml"===mode.toLowerCase()&&(mode="html"),!_.contains(["html","qti"],mode))throw new Error("Unknown mode "+mode);return dtdMode=mode,this},html5Only=["article","aside","bdi","command","datalist","details","dialog","figcaption","figure","footer","header","keygen","main","mark","meter","nav","output","progress","rp","rt","ruby","section","summary","time","wbr","hgroup"],getParentsOf=function(child){var parents=[],element;for(element in child=_normalizeElement(child),dtds[dtdMode])dtds[dtdMode].hasOwnProperty(element)&&0!==element.indexOf("$")&&child in dtds[dtdMode][element]&&parents.push(element);return parents},getChildrenOf=function(parent){return parent=_normalizeElement(parent),parent in dtds[dtdMode]?_.keys(dtds[dtdMode][parent]):[]},isChildOf=function(child,of){return _.contains(getChildrenOf(of),_normalizeElement(child))},isParentOf=function(parent,of){return _.contains(getParentsOf(of),_normalizeElement(parent))},getDtd=function(){return dtds[dtdMode]},getMode=function(){return dtdMode};return dtds.html=function(){var X=_.extend,Y=function(source,removed){var substracted=_.cloneDeep(source),i,name;for(i=1;i<arguments.length;i++)for(name in removed=arguments[i],removed)delete substracted[name];return substracted},P={},F={},FO={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},M={command:1,link:1,meta:1,noscript:1,script:1,style:1},E={},T={"#":1},DFO={center:1,dir:1,noframes:1},dtd;return X(P,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,var:1,video:1,wbr:1},T,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1}),X(F,FO,P,DFO),dtd={a:Y(P,{a:1,button:1}),abbr:P,address:F,area:E,article:X({style:1},F),aside:X({style:1},F),audio:X({source:1,track:1},F),b:P,base:E,bdi:P,bdo:P,blockquote:F,body:F,br:E,button:Y(P,{a:1,button:1}),canvas:P,caption:F,cite:P,code:P,col:E,colgroup:{col:1},command:E,datalist:X({option:1},P),dd:F,del:P,details:X({summary:1},F),dfn:P,div:X({style:1},F),dl:{dt:1,dd:1},dt:F,em:P,embed:E,fieldset:X({legend:1},F),figcaption:F,figure:X({figcaption:1},F),footer:F,form:F,h1:P,h2:P,h3:P,h4:P,h5:P,h6:P,head:X({title:1,base:1},M),header:F,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:E,html:X({head:1,body:1},F,M),i:P,iframe:T,img:E,input:E,ins:P,kbd:P,keygen:E,label:P,legend:P,li:F,link:E,map:F,mark:P,menu:X({li:1},F),meta:E,meter:Y(P,{meter:1}),nav:F,noscript:X({link:1,meta:1,style:1},P),object:X({param:1},P),ol:{li:1},optgroup:{option:1},option:T,output:P,p:P,param:E,pre:P,progress:Y(P,{progress:1}),q:P,rp:P,rt:P,ruby:X({rp:1,rt:1},P),s:P,samp:P,script:T,section:X({style:1},F),select:{optgroup:1,option:1},small:P,source:E,span:P,strong:P,style:T,sub:P,summary:P,sup:P,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:F,textarea:T,tfoot:{tr:1},th:F,thead:{tr:1},time:Y(P,{time:1}),title:T,tr:{th:1,td:1},track:E,u:P,ul:{li:1},var:P,video:X({source:1,track:1},F),wbr:E,acronym:P,applet:X({param:1},F),basefont:E,big:P,center:F,dialog:E,dir:{li:1},font:P,isindex:E,noframes:F,strike:P,tt:P},X(dtd,{$block:X({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},FO,DFO),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,nav:1,p:1,pre:1,section:1,table:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:P,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:X({body:1,head:1,html:1},dtd.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,var:1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),dtd}(),dtds.qti=function(){for(var actions=["remove","add"],actLnt=actions.length,overrides={pre:{add:[],remove:["img","object","big","small","sub","sup"]},table:{remove:["col"]}},qtiDtd=_.cloneDeep(dtds.html),h5Len=html5Only.length,element,listCnt,child,actCnt,action,tmp,intersection;h5Len--;)delete qtiDtd[html5Only[h5Len]];for(element in qtiDtd)qtiDtd.hasOwnProperty(element)&&(intersection=_.intersection(_.keys(qtiDtd[element]),html5Only),!!intersection.length)&&(overrides[element]||(overrides[element]={remove:[]}),overrides[element].remove=overrides[element].remove.concat(intersection));for(element in overrides)if(overrides.hasOwnProperty(element)&&qtiDtd.hasOwnProperty(element))for(actCnt=0;actCnt<actLnt;actCnt++)if(action=actions[actCnt],!!(action in overrides[element])){if(listCnt=overrides[element][action].length,"remove"===action&&"all"===overrides[element][action]){qtiDtd[element]={};continue}for(;listCnt--;)child=overrides[element][action][listCnt],tmp=_.cloneDeep(qtiDtd[element]),"remove"===action?(delete tmp[child],qtiDtd[element]=tmp):"add"===action&&"undefined"!=typeof qtiDtd[child]&&(tmp[child]=1,qtiDtd[element]=tmp[child])}return qtiDtd}(),{getDtd:getDtd,getChildrenOf:getChildrenOf,getParentsOf:getParentsOf,isChildOf:isChildOf,isParentOf:isParentOf,getMode:getMode,setMode:setMode}}();return dtdHandler}),define("ui/ckeditor/ckConfigurator",["jquery","lodash","ui/ckeditor/dtdHandler","ckeditor"],function($,_,dtdHandler){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,dtdHandler=dtdHandler&&dtdHandler.hasOwnProperty("default")?dtdHandler["default"]:dtdHandler;var originalConfig=_.cloneDeep(window.CKEDITOR.config),ckConfigurator=function(){var toolbarPresets={inline:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar","TaoQtiTable","TaoTooltip"]},{name:"links",items:["Link"]}],flow:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar","TaoQtiTable","TaoTooltip"]},{name:"links",items:["Link"]}],block:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["Image","SpecialChar","TaoQtiTable","TaoTooltip"]},{name:"links",items:["Link"]},{name:"styles",items:["Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}],extendedText:[{name:"basicstyles",items:["Bold","Italic","Underline","Subscript","Superscript"]},{name:"insert",items:["SpecialChar","TaoTab","TaoUnTab"]},{name:"paragraph",items:["NumberedList","BulletedList"]},{name:"clipboard",items:["Cut","Copy","Paste"]},{name:"history",items:["Undo","Redo"]},{name:"textcolor",items:["TextColor"]},{name:"font",items:["Font"]},{name:"fontsize",items:["FontSize"]}],htmlField:[{name:"basicstyles",items:["Bold","Italic","Strike","Underline"]},{name:"exponent",items:["Subscript","Superscript"]},{name:"fontstyles",items:["TextColor","Font","FontSize"]},{name:"paragraph",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"indent",items:["TaoTab","TaoUnTab"]},{name:"history",items:["Undo","Redo"]},{name:"list",items:["NumberedList","BulletedList"]},{name:"insert",items:["Link","SpecialChar"]}]},ckConfig={disableAutoInline:!0,entities:!1,entities_processNumerical:!0,autoParagraph:!1,extraPlugins:"confighelper",floatSpaceDockedOffsetY:0,forcePasteAsPlainText:!0,skin:"tao",language:"en",removePlugins:"",linkShowAdvancedTab:!1,justifyClasses:["txt-lft","txt-ctr","txt-rgt","txt-jty"],linkShowTargetTab:!1,coreStyles_underline:{element:"span",attributes:{class:"txt-underline"}},coreStyles_highlight:{element:"span",attributes:{class:"txt-highlight"}},specialChars:["!","&quot;","#","$","%","&amp;","'","(",")","*","+","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";",["&lt;","Less than"],["&le;","Less than or equal to"],"&asymp;","=","&ne;",["&ge;","Greater than or equal to"],["&gt;","Greater than"],"?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","&euro;","&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;","&sbquo;","&#8219;","&bdquo;","&hellip;","&trade;","&#9658;","&bull;","&rarr;","&rArr;","&hArr;","&diams;","&asymp;"],disableNativeTableHandles:!0},_updatePlugins=function(ckConfig,positionedPlugins){var tbCnt=ckConfig.toolbar.length,stringVals={},itCnt,itLen,method,plugin,index,separator,idxItem,numToReplace,stringVal,i;for(positionedPlugins=positionedPlugins||{},ckConfig.extraPlugins=function(positionedPluginArr,extraPlugins){for(var pluginIndex=positionedPluginArr.length,extraPluginArr=extraPlugins.split(",");pluginIndex--;)positionedPluginArr[pluginIndex]=positionedPluginArr[pluginIndex].toLowerCase();return extraPluginArr=_.compact(_.union(extraPluginArr,positionedPluginArr)),extraPluginArr.join(",")}(_.keys(positionedPlugins),ckConfig.extraPlugins),i=0;i<tbCnt;i++)_.isString(ckConfig.toolbar[i])&&(stringVals[i]=ckConfig.toolbar[i],ckConfig.toolbar[i]={items:[]});for(plugin in positionedPlugins){for(method=function(pluginProps){for(var propIndex=pluginProps.length;propIndex--;)if(0===pluginProps[propIndex].indexOf("insert")||"replace"===pluginProps[propIndex])return pluginProps[propIndex];throw new Error("Missing key insertBefore | insertAfter | replace in positionedPlugins")}(_.keys(positionedPlugins[plugin])),idxItem=positionedPlugins[plugin][method].toLowerCase(),separator=positionedPlugins[plugin].separator||!1,index=-1;tbCnt--;){for(itLen=ckConfig.toolbar[tbCnt].items.length,itCnt=0;itCnt<itLen;itCnt++)if(ckConfig.toolbar[tbCnt].items[itCnt].toLowerCase()===idxItem){index=itCnt;break}if(-1<index){numToReplace="replace"===method?1:0,"insertAfter"===method&&index++,separator&&(ckConfig.toolbar[tbCnt].items.splice(index,numToReplace,"-"),index++),ckConfig.toolbar[tbCnt].items.splice(index,numToReplace,plugin);break}}tbCnt=ckConfig.toolbar.length}for(stringVal in stringVals)ckConfig.toolbar[stringVal]=stringVals[stringVal]},_switchDtd=function(dtdMode){dtdHandler.setMode(dtdMode),window.CKEDITOR.dtd=dtdHandler.getDtd()},getConfig=function(editor,toolbarType,options){var positionedPlugins={},toolbar,toolbars,config,dtdMode;if("reset"===toolbarType)return originalConfig;for(toolbar in options=options||{},options.resourcemgr=options.resourcemgr||{},toolbars=_.clone(toolbarPresets,!0),dtdMode=options.dtdMode||"html",("qti"===dtdMode||0===toolbarType.indexOf("qti"))&&(toolbarType=toolbarType.slice(3).toLowerCase(),ckConfig.allowedContent=!0,ckConfig.autoParagraph=!1,dtdMode="qti"),"qti"===dtdMode&&(options.qtiMedia&&(positionedPlugins.TaoQtiMedia={insertAfter:"SpecialChar"}),options.qtiImage&&(positionedPlugins.TaoQtiImage={insertAfter:"SpecialChar"}),options.qtiInclude&&(positionedPlugins.TaoQtiInclude={insertAfter:"SpecialChar"}),options.underline&&(positionedPlugins.TaoUnderline={insertAfter:"Italic"}),options.highlight&&(options.underline?positionedPlugins.TaoHighlight={insertAfter:"TaoUnderline"}:positionedPlugins.TaoHighlight={insertAfter:"Italic"}),options.mathJax&&(positionedPlugins.TaoQtiMaths={insertAfter:"SpecialChar"})),options.toolbar&&(toolbars[toolbarType]=_.clone(options.toolbar)),toolbars)toolbars.hasOwnProperty(toolbar)&&(ckConfig["toolbar_"+toolbar]=toolbars[toolbar]);return"undefined"!=typeof toolbars[toolbarType]&&(ckConfig.toolbar=toolbars[toolbarType]),"undefined"!=typeof options.positionedPlugins&&(options.positionedPlugins={}),!1!==options.positionedPlugins&&(positionedPlugins=_.assign(positionedPlugins,_.clone(options.positionedPlugins)),_updatePlugins(ckConfig,positionedPlugins)),config=_.assign({},_.cloneDeep(originalConfig),ckConfig,_.omit(options,["qtiImage","qtiInclude","underline","highlight","mathJax","toolbar","positionedPlugins"])),editor.on("focus",function(){_switchDtd(dtdMode)}),editor.on("instanceReady",function(e){$(e.editor.element.$).removeAttr("title")}),window.CKEDITOR.on("dialogDefinition",function(e){var linkTypes,wanted,linkIndex;if("link"===e.data.name){for(linkTypes=e.data.definition.getContents("info").get("linkType").items,linkIndex=linkTypes.length;linkIndex--;)if("anchor"!==linkTypes[linkIndex][1]){wanted=linkIndex;continue}linkTypes.splice(wanted+1,1)}}),config};return _switchDtd("qti"),{getConfig:getConfig}}();return ckConfigurator}),define("taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator",["ui/ckeditor/ckConfigurator"],function(ckConfigurator){'use strict';return{getConfig:function getConfig(editor,toolbarType,options){return options=options||{},options.underline=!0,ckConfigurator.getConfig(editor,toolbarType,options)}}}),define("json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json",function(){return{basic:{stroke:"#8D949E","stroke-width":2,"stroke-dasharray":"","stroke-linejoin":"round",fill:"#cccccc","fill-opacity":.5,cursor:"pointer"},hover:{stroke:"#3E7DA7",fill:"#0E5D91","fill-opacity":.3},selectable:{"stroke-dasharray":"-",stroke:"#3E7DA7",fill:"#cccccc","fill-opacity":.5},active:{stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91","fill-opacity":.5},error:{stroke:"#C74155","stroke-dasharray":"","fill-opacity":.5,fill:"#661728"},success:{stroke:"#C74155","stroke-dasharray":"",fill:"#0E914B","fill-opacity":.5},layer:{fill:"#ffffff",opacity:0,cursor:"pointer"},creator:{"fill-opacity":.5,stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91",cursor:"pointer"},"imageset-rect-stroke":{fill:"#ffffff",stroke:"#666666","stroke-width":1,"stroke-linejoin":"round",cursor:"pointer"},"imageset-rect-no-stroke":{fill:"#ffffff",stroke:"#ffffff","stroke-width":2,"stroke-linejoin":"round",cursor:"pointer"},"imageset-img":{cursor:"pointer"},"order-text":{fill:"#ffffff",stroke:"#000000","stroke-width":.7,"font-family":"sans-serif","font-weight":"bold","font-size":22,cursor:"pointer"},"score-text-default":{stroke:"#444444","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"score-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"small-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":16,cursor:"pointer"},"layer-pos-text":{stroke:"#333","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":14},target:{path:"m 18,8.4143672 -1.882582,0 C 15.801891,4.9747852 13.071059,2.2344961 9.63508,1.9026738 L 9.63508,0 8.2305176,0 l 0,1.9026387 C 4.7947148,2.2343027 2.0637246,4.9746621 1.7481973,8.4143672 l -1.7481973,0 0,1.4045625 1.754877,0 c 0.3460429,3.4066753 3.0632871,6.1119843 6.4756406,6.4413813 l 0,1.739689 1.4045624,0 0,-1.739725 c 3.412547,-0.329537 6.129633,-3.034793 6.475641,-6.4413453 l 1.889279,0 z m -8.36492,6.5188648 0,-4.064673 -1.4045624,0 0,4.063882 C 5.5511016,14.612555 3.4232695,12.494619 3.0864551,9.8189297 l 4.0449512,0 0,-1.4045625 -4.0546368,0 C 3.3788672,5.6984941 5.5228887,3.5393379 8.2305176,3.2161113 l 0,3.9153125 1.4045624,0 0,-3.9160859 c 2.711162,0.3203965 4.858576,2.4808887 5.160955,5.1990293 l -3.927441,0 0,1.4045625 3.917773,0 C 14.449289,12.496957 12.318363,14.616158 9.63508,14.933232 z",fill:"#0E914B",width:1,"stroke-width":0,cursor:"pointer"},"target-hover":{fill:"#3E7DA7","fill-opacity":1},"target-success":{fill:"#0E914B","fill-opacity":1},assoc:{"stroke-width":2,"stroke-linecap":"round",cursor:"pointer"},"assoc-layer":{"stroke-width":12,cursor:"pointer","stroke-opacity":0},"assoc-bullet":{fill:"#000000"},close:{path:"m 8.9997236,18.000001 c -4.9703918,0 -8.99972284217367,-4.02901 -8.99972284217367,-9 C 7.5782633e-7,4.029011 4.0293108,9.8531742e-7 8.9997236,9.8531742e-7 13.970691,9.8531742e-7 18.000001,4.029011 18.000001,9.000001 c 0,4.97099 -4.02931,9 -9.0002774,9 z m 0.0045,-16.37151 c -4.06191,0 -7.35492,3.29635 -7.35492,7.36251 0,4.06562 3.292989,7.36255 7.35492,7.36255 4.0630384,0 7.3554334,-3.29693 7.3554334,-7.36255 0,-4.06614 -3.292969,-7.36251 -7.3554334,-7.36251 v 0 z m 3.1314894,9.31167 -1.953823,-1.94014 1.953843,-1.94018 c 0.08964,-0.089 0.134622,-0.19099 0.135073,-0.30584 4.31e-4,-0.11488 -0.04383,-0.21712 -0.132838,-0.30681 l -0.54267,-0.54685 c -0.08898,-0.0897 -0.190903,-0.13473 -0.305719,-0.13514 -0.114837,-4.4e-4 -0.217064,0.0439 -0.306703,0.1329 l -1.9623724,1.94865 -1.962395,-1.94865 c -0.08964,-0.089 -0.191845,-0.13336 -0.306702,-0.1329 -0.114837,4.3e-4 -0.216736,0.0455 -0.305719,0.13514 l -0.54265,0.54685 c -0.08902,0.0897 -0.133269,0.19193 -0.132838,0.30681 4.3e-4,0.11485 0.04543,0.21681 0.135073,0.30584 l 1.953823,1.94018 -1.953782,1.94014 c -0.0896,0.089 -0.134684,0.19094 -0.135114,0.3058 -4.31e-4,0.11486 0.04386,0.21716 0.132838,0.30681 l 0.542671,0.54687 c 0.08896,0.0897 0.190923,0.13467 0.305718,0.13516 0.114857,3.9e-4 0.217105,-0.0439 0.306724,-0.13288 l 1.962332,-1.94863 1.9623324,1.94863 c 0.08962,0.089 0.191886,0.13323 0.306744,0.13288 0.114836,-4.5e-4 0.216736,-0.0455 0.305698,-0.13516 l 0.542691,-0.54687 c 0.089,-0.0897 0.133227,-0.19193 0.132838,-0.30681 -3.9e-4,-0.1149 -0.0455,-0.21683 -0.135073,-0.3058 z",fill:"#0E5D91",width:1,opacity:0,"stroke-width":0,cursor:"pointer"},"close-bg":{fill:"#ffffff",stroke:"none",cursor:"pointer",opacity:0},"touch-circle":{fill:"none",stroke:"#3E7DA7","stroke-width":2}}}),define("taoQtiItem/qtiCommonRenderer/helpers/Graphic",["jquery","lodash","raphael","scale.raphael","json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json"],function($,_,raphael,scaleRaphael,gstyle){'use strict';var _Mathfloor4=Math.floor,_Mathround3=Math.round,shapeMap={default:"rect",poly:"path"},coordsValidator={rect:4,ellipse:4,circle:3,poly:6,default:0},qti2raphCoordsMapper={rect:function rect(coords){return[coords[0],coords[1],coords[2]-coords[0],coords[3]-coords[1]]},default:function _default(paper){return[0,0,paper.width,paper.height]},poly:function poly(coords){var size=coords.length,a;for(coords[0]!==coords[size-2]&&coords[1]!==coords[size-1]&&(coords.push(coords[0]),coords.push(coords[1])),coords[0]="M"+coords[0],a=1;a<size;a++)0==a%2&&(coords[a]="L"+coords[a]);return[coords.join(" ")]}},raph2qtiCoordsMapper={rect:function rect(attr){return[attr.x,attr.y,attr.x+attr.width,attr.y+attr.height]},circle:function circle(attr){return[attr.cx,attr.cy,attr.r]},ellipse:function ellipse(attr){return[attr.cx,attr.cy,attr.rx,attr.ry]},default:function _default(attr){return this.rect(attr)},path:function path(attr){var poly=[],i;if(_.isArray(attr.path))for(i=1;i<attr.path.length;i++)3===attr.path[i].length&&(poly.push(attr.path[i][1]),poly.push(attr.path[i][2]));return poly}};return{_style:gstyle,setStyle:function setStyle(element,name){element&&gstyle[name]&&element.attr(gstyle[name])},responsivePaper:function responsivePaper(id,serial,options){function resizePaper(e,givenWidth){var diff,maxWidth,containerWidth,containerHeight,factor;e&&e.stopPropagation(),diff=$editor.outerWidth()-$editor.width()+($container.outerWidth()-$container.width())+1,maxWidth=$body.width(),containerWidth=$container.innerWidth(),(0<containerWidth||0<givenWidth)&&(givenWidth<containerWidth&&givenWidth<maxWidth?containerWidth=givenWidth-diff:containerWidth>maxWidth?containerWidth=maxWidth-diff:containerWidth-=diff,factor=containerWidth/imgWidth,containerHeight=imgHeight*factor,0<containerWidth&&paper.changeSize(containerWidth,containerHeight,!1,!1),"function"==typeof options.resize&&options.resize(containerWidth,factor),$container.trigger("resized.qti-widget"))}var $container=options.container||$("#"+id).parent(),$editor=$(".image-editor",$container),$body=$container.closest(".qti-itemBody"),resizer=_.throttle(resizePaper,10),imgWidth=options.width||$container.innerWidth(),imgHeight=options.height||$container.innerHeight(),paper,image;return paper=scaleRaphael(id,imgWidth,imgHeight),image=paper.image(options.img,0,0,imgWidth,imgHeight),image.id=options.imgId||image.id,paper.setViewBox(0,0,imgWidth,imgHeight),resizer(),$(image.node).attr("externalResourcesRequired","true").on("load",resizer),"SVG"===raphael.type?($(window).on("resize.qti-widget."+serial,resizer),$container.on("resize.qti-widget."+serial,resizer),$(document).on("customcssloaded.styleeditor",resizer)):($container.find(".main-image-box").width(imgWidth),"function"==typeof options.resize&&options.resize(imgWidth,1)),paper},createElement:function createElement(paper,type,coords,options){var self=this,shaper=shapeMap[type]?paper[shapeMap[type]]:paper[type],shapeCoords=!1===options.qtiCoords?coords:self.raphaelCoords(paper,type,coords),element;if("function"==typeof shaper)element=shaper.apply(paper,shapeCoords),element&&(options.id&&(element.id=options.id),options.title&&element.attr("title",options.title),element.attr(gstyle[options.style||"basic"]).toFront(),$(element.node).removeAttr("stroke-dasharray"),!1!==options.hover&&element.hover(function(){element.flashing||self.updateElementState(this,"hover")},function(){element.flashing||self.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")}),!1!==options.touchEffect&&element.touchstart(function(){self.createTouchCircle(paper,element.getBBox())}));else throw new Error("Unable to find method "+type+" on paper");return element},createTarget:function(paper,options){var baseSize,count,factor,half,hover,layer,point,self,tBBox,targetSize,x,y,target;return options=options||{},self=this,point=options.point||{x:0,y:0},factor=0===paper.w?1:paper.width/paper.w,hover="undefined"==typeof options.hover||!!options.hover,baseSize=18,half=baseSize/2,x=point.x-half,y=point.y-half,targetSize=0===factor?2:2/factor,target=paper.path(gstyle.target.path).transform("t"+x+","+y+"s"+targetSize).attr(gstyle.target).attr("title",_("Click again to remove")),options.id?target.id=options.id:(count=0,paper.forEach(function(element){element.data("target")&&count++}),target.id="target-"+count),tBBox=target.getBBox(),layer=paper.rect(tBBox.x,tBBox.y,tBBox.width,tBBox.height).attr(gstyle.layer).click(function(){var id=target.id,p=this.data("point");_.isFunction(options.select)&&options.select(target,p,this),_.isFunction(options.remove)&&(this.remove(),target.remove(),options.remove(id,p))}),hover&&layer.hover(function(){target.flashing||self.setStyle(target,"target-hover")},function(){target.flashing||self.setStyle(target,"target-success")}),layer.id="layer-"+target.id,layer.data("point",point),target.data("target",point),_.isFunction(options.create)&&options.create(target),target},raphaelCoords:function(paper,type,coords){var shapeCoords;if(_.isString(coords)&&(coords=_.map(coords.split(","),function(coord){return parseInt(coord,10)})),!_.isArray(coords)||coords.length<coordsValidator[type])throw new Error("Invalid coords "+JSON.stringify(coords)+"  for type "+type);return shapeCoords="rect"===type?qti2raphCoordsMapper.rect(coords):"default"===type?qti2raphCoordsMapper["default"].call(null,paper):"poly"===type?qti2raphCoordsMapper.poly(coords):coords,shapeCoords},qtiCoords:function(element){var mapper=raph2qtiCoordsMapper[element.type],result="";return _.isFunction(mapper)&&(result=_.map(mapper.call(raph2qtiCoordsMapper,element.attr()),function(coord){return _.parseInt(coord)}).join(",")),result},createTouchCircle:function createTouchCircle(paper,bbox){var radius=bbox.width>bbox.height?bbox.width:bbox.height,tCircle=paper.circle(bbox.x+bbox.width/2,bbox.y+bbox.height/2,radius);tCircle.attr(gstyle["touch-circle"]),_.defer(function(){tCircle.animate({r:radius+5,opacity:.7},300,function(){tCircle.remove()})})},createText:function createText(paper,options){var top=options.top||0,left=options.left||0,content=options.content||"",style=options.style||"small-text",title=options.title||"",factor=1,fontSize,scaledFontSize,text;return paper.width&&paper.w&&(factor=paper.width/paper.w),text=paper.text(left,top,content).toFront(),options.id&&(text.id=options.id),options.hide&&text.hide(),text.attr(gstyle[style]),"undefined"!=typeof factor&&1!==factor&&(fontSize=parseInt(text.attr("font-size"),10),scaledFontSize=_Mathfloor4(fontSize/factor)+1,text.attr("font-size",scaledFontSize)),title&&this.updateTitle(text,title),text},createShapeText:function createShapeText(paper,shape,options){var self=this,bbox=shape.getBBox(),text=this.createText(paper,_.merge({left:bbox.x+bbox.width/2,top:bbox.y+bbox.height/2},options));return options.shapeClick&&text.click(function(){self.trigger(shape,"click")}),text},createBorderedImage:function createBorderedImage(paper,options){var padding=0<=options.padding?options.padding:6,halfPad=padding/2,rx=options.left,ry=options.top,rw=options.width+padding,rh=options.height+padding,ix=options.left+halfPad,iy=options.top+halfPad,iw=options.width,ih=options.height,set=paper.set(),rect=paper.rect(rx,ry,rw,rh).attr(options.border?gstyle["imageset-rect-stroke"]:gstyle["imageset-rect-no-stroke"]),image=paper.image(options.url,ix,iy,iw,ih).attr(gstyle["imageset-img"]);return options.shadow&&set.push(rect.glow({width:2,offsetx:1,offsety:1})),set.push(rect,image),set.move=function(x,y,duration){var animation=raphael.animation({x:x,y:y},duration||400),elt=rect.animate(animation);return image.animateWith(elt,animation,{x:x+halfPad,y:y+halfPad},duration||400),set},set},updateElementState:function updateElementState(element,state,title){element&&element.animate&&(element.animate(gstyle[state],200,"linear",function(){element.attr(gstyle[state]),$(element.node).removeAttr("stroke-dasharray")}),title&&this.updateTitle(element,title))},updateTitle:function updateTitle(element,title){element&&element.node&&(_.forEach(element.node.children,function(child){"title"===child.nodeName.toLowerCase()&&element.node.removeChild(child)}),element.attr("title",title))},highlightError:function highlightError(element,restoredState){var self=this;element&&(element.flashing=!0,self.updateElementState(element,"error"),_.delay(function(){self.updateElementState(element,restoredState||"basic"),element.flashing=!1},800))},trigger:function trigger(element,event){var evt=_.where(element.events,{name:event});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.apply(element,Array.prototype.slice.call(arguments,2))},getPoint:function(event,paper,$container){var point=this.clickPoint($container,event),rect=$container.get(0).getBoundingClientRect(),factor=paper.w/rect.width;return point.x=_Mathround3(point.x*factor),point.y=_Mathround3(point.y*factor),point},position:function position($container,paper){var pw=parseInt(paper.w||paper.width,10),cw=parseInt($container.width(),10),ph=parseInt(paper.w||paper.width,10),ch=parseInt($container.height(),10);return{left:(cw-pw)/2,top:(ch-ph)/2}},clickPoint:function clickPoint($container,event){var offset=$container.offset(),x,y;return event.pageX||event.pageY?(x=event.pageX-offset.left,y=event.pageY-offset.top):(event.clientX||event.clientY)&&(x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-offset.left,y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop-offset.top),{x:x,y:y}}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div id=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"small feedback-info item-instruction\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <span class=\"icon-info icon\"></span><span class=\"instruction-message\">",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction",["lodash","taoQtiItem/qtiItem/helper/util","tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction"],function(_,util,instructionTpl){var _notificationLevels=["info","warning","error","success"],Instruction=function(interaction,message,callback){this.interaction=interaction,this.defaultMessage=message||"",this.currentMessage="",this.level="info",this.serial=util.buildSerial("instruction_"),this.callback=callback,this.$dom=null,this.state=!1};return Instruction.isValidLevel=function(level){return 0<=_.indexOf(_notificationLevels,level)},Instruction.prototype.setState=function(state){this.state=state},Instruction.prototype.checkState=function(state){return this.state===state},Instruction.prototype.getId=function(){return this.serial},Instruction.prototype.create=function($container){$container.append(instructionTpl({message:this.defaultMessage,serial:this.serial})),this.$dom=$container.find("#"+this.serial)},Instruction.prototype.update=function(options){var level=options&&options.level?options.level:"",message=options&&options.message?options.message:"",timeout=options&&options.timeout?options.timeout:0,start=options&&"function"==typeof options.start?options.start:null,stop=options&&"function"==typeof options.stop?options.stop:null;if(level&&Instruction.isValidLevel(level)&&(this.$dom.removeClass("feedback-"+this.level).addClass("feedback-"+level),this.$dom.find(".icon").removeClass("icon-"+this.level).addClass("icon-"+level),this.level=level),message&&(this.$dom.find(".instruction-message").html(message),this.currentMessage=message),timeout){var _this=this;start&&start.call(_this),_this.timer=setTimeout(function(){stop&&stop.call(_this),_this.timer=null},timeout)}},Instruction.prototype.setLevel=function(level,timeout){var options={level:level};timeout&&(options.timeout=parseInt(timeout),options.stop=function(){this.setLevel("info")}),this.update(options)},Instruction.prototype.getLevel=function(){return this.level},Instruction.prototype.setMessage=function(message,timeout){this.update({message:message,timeout:timeout})},Instruction.prototype.reset=function(){this.update({level:"info",message:this.defaultMessage}),this.state=!1},Instruction.prototype.validate=function(data){"function"==typeof this.callback&&this.callback.call(this,data)},Instruction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/notification",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"small feedback-",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" item-notification\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <span class=\"icon-",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span><span class=\"feedback-message\">",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+"\" class=\"icon-close close-trigger\"></span>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager",["lodash","jquery","i18n","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction","tpl!taoQtiItem/qtiCommonRenderer/tpl/notification"],function(_,$,__,containerHelper,Instruction,notifTpl){'use strict';var _instructions={};return{validateInstructions:function validateInstructions(element,data){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.validate(data||{})})},appendInstruction:function appendInstruction(element,message,validateCallback){var serial=element.getSerial(),instruction=new Instruction(element,message,validateCallback);return _instructions[serial]||(_instructions[serial]={}),_instructions[serial][instruction.getId()]=instruction,instruction.create($(".instruction-container",containerHelper.get(element))),instruction},removeInstructions:function removeInstructions(element){_instructions[element.getSerial()]={},containerHelper.get(element).find(".instruction-container").empty()},resetInstructions:function resetInstructions(element){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.reset()})},minMaxChoiceInstructions:function minMaxChoiceInstructions(interaction,options){var self=this,min=options.min||0,max=options.max||0,getResponse=options.getResponse,onError=options.onError||_.noop(),choiceCount=!1!==options.choiceCount&&_.size(interaction.getChoices()),minInstructionSet=!1,msg;if(!_.isFunction(getResponse))throw"invalid parameter getResponse";0<max&&(!1===choiceCount||max<choiceCount)&&(max===min?(minInstructionSet=!0,msg=1>=max?__("You must select exactly %d choice",max):__("You must select exactly %d choices",max),self.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function start(){onError(data)},stop:function stop(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):max>min&&(msg=1>=max?__("You can select maximum %d choice",max):__("You can select maximum %d choices",max),self.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function start(){onError(data)},stop:function stop(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!minInstructionSet&&0<min&&(!1===choiceCount||min<choiceCount)&&(msg=1>=min?__("You must select at least %d choice",min):__("You must select at least %d choices",min),self.appendInstruction(interaction,msg,function(){getResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},appendNotification:function appendNotification(element,message,level){if(level=level||"info",Instruction.isValidLevel(level)){var $container=containerHelper.get(element);$container.find(".notification-container").prepend(notifTpl({level:level,message:message}));var $notif=$container.find(".item-notification:first"),_remove=function(){$notif.fadeOut()};return $notif.find(".close-trigger").on("click",_remove),setTimeout(_remove,2e3),$notif}},removeNotifications:function removeNotifications(element){containerHelper.get(element).find(".item-notification").remove()}}}),define("taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler",["jquery","lodash"],function($,_){'use strict';var informLoaded=_.throttle(function(){$(document).trigger("customcssloaded.styleeditor")},10,{leading:!1});return{attach:function(stylesheets){var $head=$("head");$head.length||($head=$("body")),_(stylesheets).forEach(function(stylesheet){var $link,href;stylesheet.attr("href")&&($link=$(stylesheet.render()),href=$link.attr("href"),$link.removeAttr("href").attr("href",href),$link.one("load",informLoaded).appendTo($head))})},detach:function(stylesheets){_(stylesheets).forEach(function(stylesheet){stylesheet.serial&&$("link[data-serial=\""+stylesheet.serial+"\"]").remove()})}}}),define("taoQtiItem/qtiCommonRenderer/helpers/patternMask",[],function(){'use strict';var regexChar=/\^\[\\s\\S\]\{\d+\,(\d+)\}\$/,regexWords=/\^\(\?\:\(\?\:\[\^\\s\\:\\!\\\?\\\;\\\…\\\€\]\+\)\[\\s\\:\\!\\\?\\;\\\…\\\€\]\*\)\{\d+\,(\d+)\}\$/;return{parsePattern:function(pattern,type){if(pattern===void 0||null===pattern)return null;if("words"===type){var result=pattern.match(regexWords);return null!==result&&1<result.length?result[1]:null}if("chars"===type){var result=pattern.match(regexChar);return null!==result&&1<result.length?result[1]:null}return null},createMaxWordPattern:function(max){return"^(?:(?:[^\\s\\:\\!\\?\\;\\\u2026\\\u20AC]+)[\\s\\:\\!\\?\\;\\\u2026\\\u20AC]*){0,"+max.toString()+"}$"},createMaxCharPattern:function(max){return"^[\\s\\S]{0,"+max.toString()+"}$"}}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint",["lodash"],function(_){'use strict';var _formatters={boolean:function boolean(value){return value?"true":"false"},integer:function integer(value){return value},float:function float(value){return value},string:function string(value){return""===value?"NULL":"\""+value+"\""},point:function point(value){return"["+value[0]+", "+value[1]+"]"},pair:function pair(value){return"["+value[0]+", "+value[1]+"]"},directedPair:function directedPair(value){return"["+value[0]+", "+value[1]+"]"},duration:function duration(value){return value},file:function file(){return"binary data"},uri:function uri(value){return value},intOrIdentifier:function intOrIdentifier(value){return value},identifier:function identifier(value){return value}};return{printBase:function(value,withType){var print="",base=value.base;if(withType="undefined"==typeof withType||withType,base)return _.forIn(_formatters,function(formatter,baseType){if(void 0!==base[baseType])return print+=withType?"("+baseType+") ":"",print+=formatter(base[baseType]),!1}),print},printList:function(value,withType){var print="",list=value.list;if(withType="undefined"==typeof withType||withType,list)return _.forIn(_formatters,function(formatter,baseType){if(void 0!==list[baseType])return print+=withType?"("+baseType+") ":"",print+="[",_.each(list[baseType],function(value){print+=formatter(value)+", "}),_.size(list[baseType])&&(print=print.substring(0,print.length-2)),print+="]",!1}),print},printRecord:function(value){return value&&value.record?"(record) "+JSON.stringify(value.record):""}}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciResponse",["lodash","taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint"],function(_,pciPrettyPrint){'use strict';var _qtiModelPciResponseCardinalities={single:"base",multiple:"list",ordered:"list",record:"record"};return{unserialize:function unserialize(response,interaction){var ret=[],responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality"),mappedCardinality;if(_qtiModelPciResponseCardinalities[cardinality]){mappedCardinality=_qtiModelPciResponseCardinalities[cardinality];var responseValues=response[mappedCardinality];if(null===responseValues)ret=[];else if(!_.isObject(responseValues))throw"invalid response cardinality, expected "+cardinality+" ("+mappedCardinality+")";else if(void 0!==responseValues[baseType])ret=responseValues[baseType],ret=_.isArray(ret)?ret:[ret];else throw"invalid response baseType"}else throw"unknown cardinality in the responseDeclaration of the interaction";return ret},serialize:function serialize(responseValues,interaction){if(!_.isArray(responseValues))throw"invalid argument : responseValues must be an Array";var response={},responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality"),mappedCardinality;if(responseValues=_.map(responseValues||[],function(v){return"boolean"===baseType?!0===v||"true"===v:v}),_qtiModelPciResponseCardinalities[cardinality])mappedCardinality=_qtiModelPciResponseCardinalities[cardinality],"base"===mappedCardinality?0===responseValues.length?response.base=null:(response.base={},response.base[baseType]=responseValues[0]):(response[mappedCardinality]={},response[mappedCardinality][baseType]=responseValues);else throw"unknown cardinality in the responseDeclaration of the interaction";return response},isEmpty:function isEmpty(response){return null===response||_.isEmpty(response)||null===response.base||_.isArray(response.list)&&_.isEmpty(response.list)||_.isArray(response.record)&&_.isEmpty(response.record)},prettyPrint:function prettyPrint(response){var print="";if("undefined"!=typeof response.base)print+=pciPrettyPrint.printBase(response,!0);else if("undefined"!=typeof response.list)print+=pciPrettyPrint.printList(response,!0);else if("undefined"!=typeof response.record)print+=pciPrettyPrint.printRecord(response,!0);else throw"Not a valid PCI JSON Response";return print}}}),define("taoQtiItem/qtiCommonRenderer/helpers/PortableElement",["jquery"],function(){'use strict';var imgSrcPattern=/(<img[^>]*src=["'])([^"']+)(["'])/ig;return{fixMarkupMediaSources:function(html,renderer){return html=html||"",html.replace(imgSrcPattern,function(substr,$1,$2,$3){var resolved=renderer.resolveUrl($2)||$2;return $1+resolved+$3})}}}),define("util/capitalize",["lodash"],function(_){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_;var capitalize=function(input,allWords){var ucFirst=function(str){return str.charAt(0).toUpperCase()+str.substr(1)};return _.isString(input)?!1!==allWords&&-1<input.indexOf(" ")?_.map(input.split(" "),ucFirst).join(" "):ucFirst(input):input};return capitalize}),define("util/adaptSize",["jquery","util/capitalize"],function($,capitalize){'use strict';var _Mathmax9=Math.max,_Mathfloor5=Math.floor;$=$&&$.hasOwnProperty("default")?$["default"]:$,capitalize=capitalize&&capitalize.hasOwnProperty("default")?capitalize["default"]:capitalize;var adaptSize=function(){var _resize=function($elements,dimensions){$elements.each(function(){for(var dimension in dimensions)dimensions.hasOwnProperty(dimension)&&$(this)[dimension]("auto")}),$elements.each(function(){for(var dimension in dimensions)dimensions.hasOwnProperty(dimension)&&(dimensions[dimension]=_Mathmax9(_Mathfloor5(dimensions[dimension]||0),$(this)["outer"+capitalize(dimension)]()))}),$elements.css(dimensions)};return{width:function($elements,minWidth){_resize($elements,{width:minWidth})},height:function($elements,minHeight){_resize($elements,{height:minHeight})},both:function($elements,minWidth,minHeight){_resize($elements,{height:minHeight,width:minWidth})}}}();return adaptSize}),define("ui/waitForMedia",["jquery"],function($){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$;$.fn.waitForMedia=function(allLoadedCallback){function allLoaded($container){$container.trigger("all-loaded.wait"),"function"==typeof allLoadedCallback&&allLoadedCallback.call($container[0])}return this.each(function(){var $container=$(this),$img=$container.find("img[src]"),count=$img.length,loaded=0,imageLoaded=function(){$(this).trigger("loaded.wait").off("load.wait").off("error.wait"),loaded++,loaded===count&&allLoaded($container)};return 0===count?void allLoaded($container):void $img.each(function(){this.complete?imageLoaded.call(this):$(this).on("load.wait error.wait",imageLoaded)})})}}),define("taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter",["jquery","lodash","util/adaptSize","ui/waitForMedia"],function($,_,_adaptSize){'use strict';return{adaptSize:function adaptSize(target){var $elements,$container;switch(!0){case"undefined"!=typeof target.$container:$elements=target.$container.find(".add-option, .result-area .target, .choice-area .qti-choice"),$container=target.$container;break;default:$elements=target,$container=$($elements).first().parent();}$container.waitForMedia(function(){_adaptSize.height($elements),document.addEventListener("load",function(e){"stylesheet"===e.target.rel&&_adaptSize.height($elements)},!0)})}}}),define("taoQtiItem/qtiCommonRenderer/helpers/uploadMime",["lodash","i18n"],function(_,__){"use strict";var uploadMime={getMimeTypes:function(){return[{mime:"application/zip",label:__("ZIP archive"),equivalent:["application/x-zip-compressed"]},{mime:"text/plain",label:__("Plain text")},{mime:"application/pdf",label:__("PDF file")},{mime:"image/jpeg",label:__("JPEG image")},{mime:"image/png",label:__("PNG image")},{mime:"image/gif",label:__("GIF image")},{mime:"image/svg+xml",label:__("SVG image")},{mime:"audio/mpeg",label:__("MPEG audio"),equivalent:["audio/mp3"]},{mime:"audio/x-ms-wma",label:__("Windows Media audio")},{mime:"audio/x-wav",label:__("WAV audio"),equivalent:["audio/wav"]},{mime:"video/mpeg",label:__("MPEG video")},{mime:"video/mp4",label:__("MP4 video")},{mime:"video/quicktime",label:__("Quicktime video")},{mime:"video/x-ms-wmv",label:__("Windows Media video")},{mime:"video/x-flv",label:__("Flash video")},{mime:"text/csv",label:__("CSV file")},{mime:"application/msword",label:__("Microsoft Word"),equivalent:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]},{mime:"application/vnd.ms-excel",label:__("Microsoft Excel"),equivalent:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]},{mime:"application/vnd.ms-powerpoint",label:__("Microsoft Powerpoint"),equivalent:["application/vnd.openxmlformats-officedocument.presentationml.presentation"]}]},setExpectedTypes:function(interaction,types){var classes=interaction.attr("class")||"";classes=classes.replace(/x-tao-upload-type-[-_a-zA-Z+.0-9]*/g,"").trim(),interaction.attr("class",classes),interaction.removeAttr("type");types&&(1===types.length?"any/kind"!==types[0]&&interaction.attr("type",types[0]):interaction.attr("class",_.reduce(types,function(acc,selectedType){return acc+" x-tao-upload-type-"+selectedType.replace("/","_")},classes).trim()))},getExpectedTypes:function(interaction,includeEquivalents){var classes=interaction.attr("class")||"",types=[],equivalents=[],mimes;return interaction.attr("type")?types.push(interaction.attr("type")):classes.replace(/x-tao-upload-type-([-_a-zA-Z+.0-9]*)/g,function($0,type){types.push(type.replace("_","/").trim())}),!0===includeEquivalents&&(mimes=uploadMime.getMimeTypes(),_.forEach(types,function(mime){var mimeData=_.find(mimes,{mime:mime});mimeData&&_.isArray(mimeData.equivalent)&&(equivalents=_.union(equivalents,mimeData.equivalent))})),_.union(types,equivalents)}};return uploadMime}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<span class=\"qti-choice qti-gap\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\r\n    <span data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" class=\"gapmatch-content\">&nbsp;</span>\r\n</span>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"gap",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+="alt=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.objetLabel),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<li class=\"qti-choice qti-gapImg selectable\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <img src=\""+escapeExpression((stack1=(stack1=(stack1=depth0&&depth0.object,null==stack1||!1===stack1?stack1:stack1.attributes),null==stack1||!1===stack1?stack1:stack1.data),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" \n         width=\""+escapeExpression((stack1=(stack1=(stack1=depth0&&depth0.object,null==stack1||!1===stack1?stack1:stack1.attributes),null==stack1||!1===stack1?stack1:stack1.width),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"\n         height=\""+escapeExpression((stack1=(stack1=(stack1=depth0&&depth0.object,null==stack1||!1===stack1?stack1:stack1.attributes),null==stack1||!1===stack1?stack1:stack1.height),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"\n         ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.objectLabel),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />\n</li>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"gapImg",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<li class=\"qti-choice\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</li>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"gapText",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<span class=\"qti-choice qti-hottext hottext\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\r\n    <label class=\"hottext-checkmark\">\r\n        <input type=\"checkbox\" value=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\r\n        <span class=\"icon-checkbox small\"></span>\r\n    </label>\r\n    <span class=\"hottext-content\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>\r\n</span>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"hottext",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<option data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" value=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</option>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(_,tpl,containerHelper){'use strict';return{qtiClass:"inlineChoice",getContainer:containerHelper.get,template:tpl,getData:function(choice,data){return data.body=_.unescape(data.body),data}}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"simpleAssociableChoice.associateInteraction",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<th class=\"qti-choice qti-associableChoice qti-simpleAssociableChoice\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</th>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"simpleAssociableChoice.matchInteraction",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+="\n            <input type=\"radio\" name=\"response-"+escapeExpression((stack1=(stack1=depth0&&depth0.interaction,null==stack1||!1===stack1?stack1:stack1.serial),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" value=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" tabindex=\"1\">\n            <span class=\"icon-radio\"></span>\n            ",buffer}function program5(depth0){var buffer="",stack1;return buffer+="\n            <input type=\"checkbox\" name=\"response-"+escapeExpression((stack1=(stack1=depth0&&depth0.interaction,null==stack1||!1===stack1?stack1:stack1.serial),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" value=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" tabindex=\"1\">\n            <span class=\"icon-checkbox\"></span>\n            ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<li class=\"qti-choice qti-simpleChoice\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div class=\"pseudo-label-box\">\n        <label class=\"real-label\">\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.unique,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </label>\n        <div class=\"label-box\">\n            <div class=\"label-content clear\" contenteditable=\"false\">\n                ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                <svg class=\"overlay-answer-eliminator\">\n                    <line x1=\"0\" y1=\"100%\" x2=\"100%\" y2=\"0\"/>\n                    <line x1=\"0\" y1=\"0\" x2=\"100%\" y2=\"100%\"/>\n                </svg>\n            </div>\n        </div>\n    </div>\n    <label data-eliminable=\"container\" data-label=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Eliminate",options):helperMissing.call(depth0,"__","Eliminate",options)))+"\">\n        <span data-eliminable=\"trigger\" class=\"icon-checkbox\"></span>\n    </label>\n</li>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"simpleChoice.choiceInteraction",getContainer:containerHelper.get,getData:function getData(choice,data){return data.unique=1===parseInt(data.interaction.attributes.maxChoices),data},template:tpl}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"simpleChoice.orderInteraction",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/container",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="<div class=\"qti-block\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>",buffer}function program2(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program4(depth0,data){var buffer="",stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return stack1=(helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),data:data},helper?helper.call(depth0,depth0&&depth0.contentModel,"blockStatic",options):helperMissing.call(depth0,"equal",depth0&&depth0.contentModel,"blockStatic",options)),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Container",["tpl!taoQtiItem/qtiCommonRenderer/tpl/container"],function(tpl){'use strict';return{qtiClass:"_container",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/img",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+="class=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program5(depth0){var buffer="",stack1;return buffer+="height=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.height),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",buffer}function program7(depth0){var buffer="",stack1;return buffer+="width=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.width),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",buffer}function program9(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program11(depth0){var buffer="",stack1;return buffer+="height: "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.height),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"px; ",buffer}function program13(depth0){var buffer="",stack1;return buffer+="width: "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.width),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"px; ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<img \n    data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n    data-qti-class=\"img\" \n    src=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.src),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" \n    alt=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.alt),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" \n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.height),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.width),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    style=\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.height),{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.width),{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"\n    />",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Img",["core/promise","ui/waitForMedia","tpl!taoQtiItem/qtiCommonRenderer/tpl/img","taoQtiItem/qtiCommonRenderer/helpers/container"],function(Promise,waitForMedia,tpl,containerHelper){'use strict';return{qtiClass:"img",template:tpl,getContainer:containerHelper.get,render:function(img){return new Promise(function(resolve){containerHelper.get(img).waitForMedia(resolve)})}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"qti-include\" data-href=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.href),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Include",["tpl!taoQtiItem/qtiCommonRenderer/tpl/include"],function(tpl){'use strict';return{qtiClass:"include",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    class=\"qti-interaction qti-blockInteraction qti-associateInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"\n    data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n    data-qti-class=\"associateInteraction\"\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <ul class=\"choice-area clearfix  none block-listing solid horizontal source\">\n        ",options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </ul>\n    <ul class=\"result-area none target clearfix\">\n    </ul>\n    <div class=\"notification-container\"></div>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<li class=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"incomplete-pair"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div class=\"target lft\"></div>\n    <div class=\"target rgt\"></div>\n</li>",buffer})}),define("core/mouseEvent",[],function(){'use strict';function triggerMouseEvent(element,eventName,eventOptions){var event;return-1!==allowedEvents.indexOf(eventName)&&(event=createEvent(eventName,eventOptions),dispatchEvent(element,eventName,event))}var allowedEvents=["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","show"],createEvent=function(eventName,eventOptions){var event;try{event=new MouseEvent(eventName,eventOptions)}catch(e){event=document.createEvent("MouseEvents"),event.initMouseEvent(eventName,eventOptions.bubbles||!1,eventOptions.cancelable||!1,eventOptions.view||null,eventOptions.detail||0,eventOptions.screenX||0,eventOptions.screenY||0,eventOptions.clientX||0,eventOptions.clientY||0,eventOptions.ctrlKey||!1,eventOptions.altKey||!1,eventOptions.shiftKey||!1,eventOptions.metaKey||!1,eventOptions.button||0,eventOptions.relatedTarget||null)}return event},dispatchEvent;return dispatchEvent=document.dispatchEvent?function(element,eventName,event){return!!element&&(element.dispatchEvent(event),!0)}:document.fireEvent?function(element,eventName,event){return!!element&&(element.fireEvent("on"+eventName,event),!0)}:function(){return!1},triggerMouseEvent}),define("ui/interactUtils",["jquery","lodash","interact","core/mouseEvent"],function($,_,interact,triggerMouseEvent){'use strict';function iFrameDragFixCb(){_.isFunction(simulateDrop)&&simulateDrop(),interact.stop()}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,triggerMouseEvent=triggerMouseEvent&&triggerMouseEvent.hasOwnProperty("default")?triggerMouseEvent["default"]:triggerMouseEvent;var interactHelper,simulateDrop;interactHelper={iFrameDragFixOn:function(simulateDropCb){simulateDrop=simulateDropCb,document.body.addEventListener("mouseleave",iFrameDragFixCb)},iFrameDragFixOff:function(){document.body.removeEventListener("mouseleave",iFrameDragFixCb)},calculateScale:function(e){var scaleX=e.getBoundingClientRect().width/e.offsetWidth,scaleY=e.getBoundingClientRect().height/e.offsetHeight;return[scaleX,scaleY]},tapOn:function(element,cb,delay){var eventOptions={bubbles:!0},domElement;element&&(domElement=element instanceof $?element.get(0):element,triggerMouseEvent(domElement,"mousedown",eventOptions),triggerMouseEvent(domElement,"mouseup",eventOptions),cb&&_.delay(cb,delay||0))},moveElement:function(element,dx,dy){var domElement=element instanceof $?element.get(0):element,x=(parseFloat(domElement.getAttribute("data-x"))||0)+dx,y=(parseFloat(domElement.getAttribute("data-y"))||0)+dy,transform="translate("+x+"px, "+y+"px) translateZ(0px)";domElement.style.webkitTransform=transform,domElement.style.transform=transform,domElement.setAttribute("data-x",x),domElement.setAttribute("data-y",y)},restoreOriginalPosition:function(element){var domElement=element instanceof $?element.get(0):element;domElement.style.webkitTransform="translate(0px, 0px) translateZ(0px)",domElement.style.transform="translate(0px, 0px) translateZ(0px)",domElement.setAttribute("data-x",0),domElement.setAttribute("data-y",0)}};var interactHelper$1=interactHelper;return interactHelper$1}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","interact","ui/interactUtils"],function($,_,__,Promise,tpl,pairTpl,containerHelper,instructionMgr,pciResponse,sizeAdapter,interact,interactUtils){'use strict';var setChoice=function(interaction,$choice,$target){var $container=containerHelper.get(interaction),choiceSerial=$choice.data("serial"),usage=$choice.data("usage")||0,choice=interaction.getChoice(choiceSerial);if(!choiceSerial)throw"empty choice serial";usage++,$choice.data("usage",usage);var _setChoice=function(){$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&usage>=choice.attr("matchMax")&&$choice.addClass("deactivated")};if($target.siblings("div").hasClass("filled")){var $resultArea=$(".result-area",$container),$pair=$target.parent(),thisPairSerial=[$target.siblings("div").data("serial"),choiceSerial],$otherRepeatedPair=$();$resultArea.children().not($pair).each(function(){var $otherPair=$(this).children(".filled");if(2===$otherPair.length){var otherPairSerial=[$($otherPair[0]).data("serial"),$($otherPair[1]).data("serial")];if(2===_.intersection(thisPairSerial,otherPairSerial).length)return $otherRepeatedPair=$otherPair,!1}}),0===$otherRepeatedPair.length?(_setChoice(),containerHelper.triggerResponseChangeEvent(interaction,{type:"added",$pair:$pair,choices:thisPairSerial}),instructionMgr.validateInstructions(interaction,{choice:$choice,target:$target}),(interaction.responseMappingMode||0===parseInt(interaction.attr("maxAssociations")))&&($pair.removeClass("incomplete-pair"),!$resultArea.children(".incomplete-pair").length&&($resultArea.append(pairTpl({empty:!0})),$resultArea.children(".incomplete-pair").fadeIn(600,function(){$(this).show()})))):($otherRepeatedPair.css("border","1px solid orange"),$target.html(__("identical pair already exists")).css({color:"orange",border:"1px solid orange"}),setTimeout(function(){$otherRepeatedPair.removeAttr("style"),$target.empty().css({color:"",border:""})},2e3))}else _setChoice()},unsetChoice=function(interaction,$filledChoice,animate,triggerChange){var $container=containerHelper.get(interaction),choiceSerial=$filledChoice.data("serial"),$choice=$container.find(".choice-area [data-serial="+choiceSerial+"]"),usage=$choice.data("usage")||0,$parent=$filledChoice.parent(),$sibling=$container.find(".choice-area [data-serial="+$filledChoice.siblings(".target").data("serial")+"]");usage--,$choice.data("usage",usage).removeClass("deactivated"),$filledChoice.removeClass("filled").removeData("serial").empty(),interaction.swapping||(!1!==triggerChange&&(containerHelper.triggerResponseChangeEvent(interaction,{type:"removed",$pair:$filledChoice.parent()}),instructionMgr.validateInstructions(interaction,{choice:$choice})),$sibling.data("usage",$sibling.data("usage")-1).removeClass("deactivated"),!$choice.siblings("div").hasClass("filled")&&(0===parseInt(interaction.attr("maxAssociations"))||interaction.responseMappingMode)&&!$parent.hasClass("incomplete-pair")&&(animate?$parent.addClass("removing").fadeOut(500,function(){$(this).remove()}):$parent.remove()))},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction),choice=interaction.getChoiceByIdentifier(identifier);if(!choice)throw new Error("cannot find a choice with the identifier : "+identifier);return $(".choice-area [data-serial="+choice.getSerial()+"]",$container)},renderEmptyPairs=function(interaction){var $container=containerHelper.get(interaction),max=parseInt(interaction.attr("maxAssociations")),$resultArea=$(".result-area",$container);if(interaction.responseMappingMode||0===max)$resultArea.append(pairTpl({empty:!0})),$resultArea.children(".incomplete-pair").show();else for(var i=0;i<max;i++)$resultArea.append(pairTpl())},_setInstructions=function(interaction){var min=parseInt(interaction.attr("minAssociations"),10),max=parseInt(interaction.attr("maxAssociations"),10);if(0===min)0===max&&instructionMgr.appendInstruction(interaction,__("You may make as many association pairs as you want."));else{0===max&&instructionMgr.appendInstruction(interaction,__("The maximum number of association is unlimited."));var msg=__("You need to make")+" ";msg+=1<min?__("at least")+" "+min+" "+__("association pairs"):__("one association pair"),instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()})}},_setPairs=function(interaction,pairs){var $container=containerHelper.get(interaction),addedPairs=0,$emptyPair=$(".result-area>li:first",$container);return pairs&&"single"===interaction.getResponseDeclaration().attr("cardinality")&&pairs.length&&(pairs=[pairs]),_.each(pairs,function(pair){if($emptyPair.length){var $divs=$emptyPair.children("div");setChoice(interaction,getChoice(interaction,pair[0]),$($divs[0])),setChoice(interaction,getChoice(interaction,pair[1]),$($divs[1])),addedPairs++,$emptyPair=$emptyPair.next("li")}else return!1}),addedPairs},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".result-area>li",$container).each(function(){var pair=[];$(this).find("div").each(function(){var serial=$(this).data("serial");serial&&pair.push(interaction.getChoice(serial).id())}),2===pair.length&&response.push(pair)}),response};return{qtiClass:"associateInteraction",template:tpl,render:function render(interaction){var self=this;return new Promise(function(resolve){function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){var $activeDrop=$(resultSelector+".dropzone");$activeDrop.length&&interact(resultSelector).fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),$activeDrop=$(choiceSelector+".dropzone"),$activeDrop.length&&interact(choiceSelector+".empty").fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}var $container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$activeChoice=null,$bin=$("<span>",{class:"icon-undo remove-choice",title:__("remove")}),choiceSelector=$choiceArea.selector+" >li",resultSelector=$resultArea.selector+" >li>div",binSelector=$container.selector+" .remove-choice",_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){setChoice(interaction,$choice,$target),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_resetSelection=function(){$activeChoice&&($resultArea.find(".remove-choice").remove(),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){unsetChoice(interaction,$choice,!0),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_isInsertionMode=function(){return $activeChoice&&$activeChoice.data("identifier")},_isModeEditing=function(){return $activeChoice&&!$activeChoice.data("identifier")},_handleChoiceActivate=function($target){$target.hasClass("deactivated")||(_isModeEditing()?(interaction.swapping=!0,_unsetChoice($activeChoice),_setChoice($target,$activeChoice),_resetSelection(),interaction.swapping=!1):$target.hasClass("active")?_resetSelection():_activateChoice($target))},_activateChoice=function($choice){_resetSelection(),$activeChoice=$choice,$choice.addClass("active"),$resultArea.find(">li>.target").addClass("empty")},_handleResultActivate=function($target){var targetSerial=$target.data("serial"),choiceSerial;_isInsertionMode()?(choiceSerial=$activeChoice.data("serial"),targetSerial!==choiceSerial&&($target.hasClass("filled")&&(interaction.swapping=!0),targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target),interaction.swapping=!1),_resetSelection()):_isModeEditing()?(choiceSerial=$activeChoice.data("serial"),targetSerial!==choiceSerial&&(($target.hasClass("filled")||$activeChoice.siblings("div")[0]===$target[0])&&(interaction.swapping=!0),_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target),interaction.swapping=!1),_resetSelection()):targetSerial&&(_activateResult($target),$target.append($bin))},_activateResult=function($target){var targetSerial=$target.data("serial");$activeChoice=$target,$activeChoice.addClass("active"),$resultArea.find(">li>.target").filter(function(){return $(this).data("serial")!==targetSerial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $(this).data("serial")!==targetSerial}).addClass("empty")},isDragAndDropEnabled,dragOptions,dropOptions,scaleX,scaleY;interact($container.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||_resetSelection()}),interact($choiceArea.selector+" >li").on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_handleChoiceActivate($target),e.preventDefault())}),interact($resultArea.selector+" >li>div").on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_handleResultActivate($target),e.preventDefault())}),interact(binSelector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection(),e.preventDefault())}),interaction.responseMappingMode||_setInstructions(interaction),self.getOption&&self.getOption("enableDragAndDrop")&&self.getOption("enableDragAndDrop").associate&&(isDragAndDropEnabled=self.getOption("enableDragAndDrop").associate),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector+":not(.deactivated)").draggable(_.defaults({onstart:function onstart(e){var $target=$(e.target),scale;$target.addClass("dragged"),_activateChoice($target),_iFrameDragFix(choiceSelector+":not(.deactivated)",e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY)},onend:function onend(e){var $target=$(e.target);$target.removeClass("dragged"),_resetSelection(),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}},dragOptions)).styleCursor(!1),interact(resultSelector+".filled").draggable(_.defaults({onstart:function onstart(e){var $target=$(e.target),scale;$target.addClass("dragged"),_resetSelection(),_activateResult($target),_iFrameDragFix(resultSelector+".filled",e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY)},onend:function onend(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),$activeChoice&&_unsetChoice($activeChoice),_resetSelection(),interactUtils.iFrameDragFixOff()}},dragOptions)).styleCursor(!1),dropOptions={overlap:.15,ondragenter:function ondragenter(e){$(e.target).addClass("dropzone"),$(e.relatedTarget).addClass("droppable")},ondragleave:function ondragleave(e){$(e.target).removeClass("dropzone"),$(e.relatedTarget).removeClass("droppable")}},interact(resultSelector).dropzone(_.defaults({ondrop:function ondrop(e){this.ondragleave(e),_handleResultActivate($(e.target))}},dropOptions)),interact(choiceSelector+".empty").dropzone(_.defaults({ondrop:function ondrop(e){this.ondragleave(e),_handleChoiceActivate($(e.target))}},dropOptions))),renderEmptyPairs(interaction),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",$container)),resolve()})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){_setPairs(interaction,pciResponse.unserialize(response,interaction))},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function resetResponse(interaction){var $container=containerHelper.get(interaction);$container.find(".result-area .active").each(function(){interactUtils.tapOn(this)}),$(".result-area>li>div",$container).each(function(){unsetChoice(interaction,$(this),!1,!1)}),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},destroy:function destroy(interaction){var $container=containerHelper.get(interaction);interact($container.selector).unset(),interact($container.find(".choice-area").selector+" >li").unset(),interact($container.find(".result-area").selector+" >li>div").unset(),interact($container.find(".remove-choice").selector).unset(),instructionMgr.removeInstructions(interaction),$(".result-area",$container).empty(),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState:function(interaction){var state={},response=interaction.getResponse(),$container;return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state},renderEmptyPairs:renderEmptyPairs}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program11(depth0,data){var stack1,helper;return(helper=helpers.listStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.listStyle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program13(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div\n  ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  class=\"qti-interaction qti-blockInteraction qti-choiceInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"\n  data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n  data-qti-class=\"choiceInteraction\"\n  ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n  ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  <div class=\"instruction-container\"></div>\n  <ol class=\"plain block-listing solid choice-area",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,function(){return" horizontal"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" ",stack1=helpers["if"].call(depth0,depth0&&depth0.listStyle,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n      ",options={hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  </ol>\n  <div class=\"notification-container\"></div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(_,$,__,tpl,containerHelper,instructionMgr,pciResponse,sizeAdapter){'use strict';var _triggerInput=function($choiceBox,state){var $input=$choiceBox.find("input:radio,input:checkbox").not("[disabled]").not(".disabled"),$choiceBoxes=$choiceBox.add($choiceBox.siblings());$input.length&&(!_.isBoolean(state)&&(state=!$input.prop("checked")),$input.prop("checked",state),$input.trigger("change"),$choiceBoxes.removeClass("user-selected"),$choiceBoxes.find("input:checked").not("[disabled]").not(".disabled").parents(".qti-choice").addClass("user-selected"))},_pseudoLabel=function(interaction,$container){$container.off(".commonRenderer"),$container.on("keydown.commonRenderer.keyNavigation",".qti-choice input:radio:not([disabled]):not(.disabled), .qti-choice input:checkbox:not([disabled]):not(.disabled)",function(e){var $qtiChoice=$(this).closest(".qti-choice"),keyCode=e.keyCode?e.keyCode:e.charCode;keyCode===38||keyCode===37?(e.preventDefault(),e.stopPropagation(),$qtiChoice.prev(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled").focus()):(keyCode===40||keyCode===39)&&(e.preventDefault(),e.stopPropagation(),$qtiChoice.next(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled").focus())}).on("keyup.commonRenderer.keyNavigation",".qti-choice input:radio:not([disabled]):not(.disabled), .qti-choice input:checkbox:not([disabled]):not(.disabled)",function(e){var keyCode=e.keyCode?e.keyCode:e.charCode;(keyCode===32||keyCode===13)&&(e.preventDefault(),e.stopPropagation(),_triggerInput($(this).closest(".qti-choice")))}),$container.on("click.commonRenderer",".qti-choice",function(e){var $choiceBox=$(this),eliminator=e.target.dataset&&e.target.dataset.eliminable,input=this.querySelector(".real-label > input"),state;e.originalEvent&&$(e.originalEvent.target).is("input")||$choiceBox.closest(".qti-item").hasClass("prevent-click-handler")||(e.preventDefault(),e.stopPropagation(),!_.isUndefined(eliminator)&&(state=!1,"trigger"===eliminator&&this.classList.toggle("eliminated")),_triggerInput($choiceBox,state),this.classList.contains("eliminated")?input.setAttribute("disabled","disabled"):input.removeAttribute("disabled"),instructionMgr.validateInstructions(interaction,{choice:$choiceBox}),containerHelper.triggerResponseChangeEvent(interaction))})},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $(".real-label > input[name=response-"+interaction.getSerial()+"]:checked",$container).each(function(){values.push($(this).val())}),values},_setInstructions=function(interaction){var min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),choiceCount=_.size(interaction.getChoices()),minInstructionSet=!1,highlightInvalidInput=function($choice){var $input=$choice.find(".real-label > input"),$li=$choice.css("color","#BA122B"),$icon=$choice.find(".real-label > span").css("color","#BA122B").addClass("cross error"),timeout=interaction.data("__instructionTimeout");timeout&&clearTimeout(timeout),timeout=setTimeout(function(){$input.prop("checked",!1),$li.removeAttr("style"),$icon.removeAttr("style").removeClass("cross"),$li.toggleClass("user-selected",!1),containerHelper.triggerResponseChangeEvent(interaction)},150),interaction.data("__instructionTimeout",timeout)},msg;1<max&&max<choiceCount&&(max===min?(minInstructionSet=!0,msg=__("You must select exactly %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function start(){data&&data.choice&&highlightInvalidInput(data.choice)},stop:function stop(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):max>min&&(msg=1===max?__("You can select maximum of 1 choice"):__("You can select maximum of %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function start(){data&&data.choice&&highlightInvalidInput(data.choice)},stop:function stop(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!minInstructionSet&&0<min&&min<choiceCount&&(msg=1===min?__("You must select at least 1 choice"):__("You must select at least %s choices",min),instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},isEliminable=function(interaction){return /\beliminable\b/.test(interaction.attr("class"))};return{qtiClass:"choiceInteraction",template:tpl,getData:function(interaction,data){var listStyles=(interaction.attr("class")||"").match(/\blist-style-[\w-]+/)||[];return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation"),listStyle:listStyles.pop(),eliminable:isEliminable(interaction)})},render:function(interaction){var $container=containerHelper.get(interaction);_pseudoLabel(interaction,$container),_setInstructions(interaction),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize($(".add-option, .result-area .target, .choice-area .qti-choice",$container))},getContainer:containerHelper.get,setResponse:function(interaction,response){var $container=containerHelper.get(interaction);try{_.forEach(pciResponse.unserialize(response,interaction),function(identifier){var $input=$container.find(".real-label > input[value=\""+identifier+"\"]").prop("checked",!0);$input.closest(".qti-choice").toggleClass("user-selected",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},getResponse:function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction);$(".real-label > input",$container).prop("checked",!1)},destroy:function(interaction){var $container=containerHelper.get(interaction),timeout=interaction.data("__instructionTimeout");timeout&&clearTimeout(timeout),$container.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),$container=containerHelper.get(interaction),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&$(".qti-simpleChoice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container)),isEliminable(interaction)&&_.isArray(state.eliminated)&&state.eliminated.length&&_.forEach(state.eliminated,function(identifier){$container.find(".qti-simpleChoice[data-identifier="+identifier+"]").addClass("eliminated")}))},getState:function(interaction){var $container=containerHelper.get(interaction),state={},response=interaction.getResponse();return response&&(state.response=response),!0===interaction.attr("shuffle")&&(state.order=[],$(".qti-simpleChoice",$container).each(function(){state.order.push($(this).data("identifier"))})),isEliminable(interaction)&&(state.eliminated=[],$container.find(".qti-simpleChoice.eliminated").each(function(){state.eliminated.push($(this).data("identifier"))})),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<a class=\"qti-interaction qti-inlineInteraction qti-endAttemptInteraction btn small btn-info\"\n        data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n        data-qti-class=\"endAttemptInteraction\"\n        value=\"false\"\n        tabindex=\"0\"\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.title),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\n</a>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n"],function(_,tpl,containerHelper,pciResponse,__){'use strict';function _setVal(interaction,val){containerHelper.get(interaction).val(val).change()}return{qtiClass:"endAttemptInteraction",template:tpl,getData:function(interaction,data){return data.attributes.title||(data.attributes.title=__("End Attempt")),data},render:function(interaction){var $container=containerHelper.get(interaction);$container.on("click.commonRenderer",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||($container.val(!0),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("endattempt",[interaction.attr("responseIdentifier")]))})},getContainer:containerHelper.get,setResponse:function(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},getResponse:function(interaction){var val=containerHelper.get(interaction).val();return val=val&&"false"!==val&&"0"!==val,pciResponse.serialize([val],interaction)},resetResponse:function(interaction){_setVal(interaction,!1)},destroy:function(interaction){containerHelper.get(interaction).off(".commonRenderer")},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("util/strLimiter",[],function(){'use strict';return{limitByWordCount:function(str,maxWordCount){for(var textArr=str.match(/(([\S]+)|([\s]+))/g),newText=/\s+/.test(textArr[0])?textArr.shift():"";maxWordCount&&textArr.length;)newText+=textArr.shift(),textArr.length&&(newText+=textArr.shift()),maxWordCount--;return newText=newText.replace(/\s+$/,""),newText},limitByCharCount:function(str,maxCharCount){return str.substr(0,maxCharCount)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        ",stack1=(helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(14,program14,data),fn:self.program(10,program10,data),data:data},helper?helper.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),"xhtml",options):helperMissing.call(depth0,"equal",(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),"xhtml",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        {!-- If there's an expected length or a max length --}}\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.expectedLength),{hash:{},inverse:self.noop,fn:self.program(18,program18,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",buffer}function program10(depth0,data){var buffer="",stack1;return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",buffer}function program11(depth0,data){var buffer="",stack1;return buffer+="\n                <div class=\"text-container text-"+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" name=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"_"+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\" contenteditable></div>\n            ",buffer}function program12(){return" attributes.class"}function program14(depth0,data){var buffer="",stack1;return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",buffer}function program15(depth0,data){var buffer="",stack1;return buffer+="\n                <textarea class=\"text-container text-"+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" name=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"_"+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\" ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.patternMask),{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n            ",buffer}function program16(depth0){var buffer="",stack1;return buffer+="pattern=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.patternMask),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program18(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n            <div class=\"text-counter\">\n                <span class=\"count-chars\">0</span> "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.expectedLength),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"recommanded",options):helperMissing.call(depth0,"__","recommanded",options)))+".\n            </div>\n        ",buffer}function program20(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n            <div class=\"text-counter\">\n                <span class=\"count-chars\">0</span> "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",(helper=helpers.maxLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxLength,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        ",buffer}function program22(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n            <div class=\"text-counter\">\n                <span class=\"count-words\">0</span> "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",(helper=helpers.maxWords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxWords,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"words",options):helperMissing.call(depth0,"__","words",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        ",buffer}function program24(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        ",stack1=(helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(27,program27,data),fn:self.program(25,program25,data),data:data},helper?helper.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),depth0&&depth0.xhtml,options):helperMissing.call(depth0,"equal",(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),depth0&&depth0.xhtml,options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.expectedLength),{hash:{},inverse:self.noop,fn:self.program(29,program29,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",buffer}function program25(depth0,data){var buffer="",stack1;return buffer+="\n            <div class=\"text-container text-"+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" contenteditable></div>\n        ",buffer}function program27(depth0,data){var buffer="",stack1;return buffer+="\n            <textarea class=\"text-container text-"+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.format),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.patternMask),{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n        ",buffer}function program29(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n            <div class=\"text-counter\">\n                <span class=\"count-chars\">0</span> "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.expectedLength),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"recommended",options):helperMissing.call(depth0,"__","recommended",options)))+".\n            </div>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-extendedTextInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"extendedTextInteraction\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.program(24,program24,data),fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",["jquery","lodash","i18n","core/promise","util/strLimiter","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","ckeditor","taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator","taoQtiItem/qtiCommonRenderer/helpers/patternMask","ui/tooltip"],function($,_,__,Promise,strLimiter,tpl,containerHelper,instructionMgr,ckEditor,ckConfigurator,patternMaskHelper,tooltip){'use strict';var inputLimiter=function(interaction){var $container=containerHelper.get(interaction),expectedLength=interaction.attr("expectedLength"),expectedLines=interaction.attr("expectedLines"),patternMask=interaction.attr("patternMask"),enabled=!1,patternRegEx,$textarea,$charsCounter,$wordsCounter,maxWords,maxLength;(expectedLength||expectedLines||patternMask)&&(enabled=!0,$textarea=$(".text-container",$container),$charsCounter=$(".count-chars",$container),$wordsCounter=$(".count-words",$container),""!==patternMask&&(maxWords=patternMaskHelper.parsePattern(patternMask,"words"),maxLength=patternMaskHelper.parsePattern(patternMask,"chars"),maxWords=_.isNaN(maxWords)?void 0:maxWords,maxLength=_.isNaN(maxLength)?void 0:maxLength,!maxLength&&!maxWords&&(patternRegEx=new RegExp(patternMask))));var limiter={enabled:enabled,listenTextInput:function(){var self=this,ignoreKeyCodes=[8,16,17,46,37,38,39,40,35,36,1114177,3342401,1114181,3342405,2228232,2228261,4456485,2228262,2228263,4456487,2228264,1114120,1114177,1114202,1114200],triggerKeyCodes=[32,13,2228237],invalidToolip=tooltip.error($container,__("This is not a valid answer"),{position:"bottom",trigger:"manual"}),patternHandler=function(e){var isCke="xhtml"===_getFormat(interaction),newValue;if(patternRegEx){if(newValue=isCke?e.getData():e.currentTarget.value,!newValue)return!1;_.debounce(function(){patternRegEx.test(newValue)?($container.removeClass("invalid"),invalidToolip.dispose()):($container.addClass("invalid"),$container.show(),invalidToolip.show(),containerHelper.triggerResponseChangeEvent(interaction))},400)()}},keyLimitHandler=function(e){var keyCode=e&&e.data?e.data.keyCode:e.which;return!_.contains(ignoreKeyCodes,keyCode)&&(maxWords&&self.getWordsCount()>=maxWords&&_.contains(triggerKeyCodes,keyCode)||maxLength&&self.getCharsCount()>=maxLength)?(e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),!1):void _.defer(function(){self.updateCounter()})},nonKeyLimitHandler=function(e){var oldValue=_getTextareaValue(interaction),isCke="xhtml"===_getFormat(interaction),newValue;return newValue=isCke?e.data.dataValue:e.originalEvent.clipboardData?e.originalEvent.clipboardData.getData("text"):e.originalEvent.dataTransfer.getData("text")||e.originalEvent.dataTransfer.getData("text/plain")||"",e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),!!newValue&&void(_.isNull(maxWords)?!_.isNull(maxLength)&&(newValue=strLimiter.limitByCharCount(newValue,maxLength-self.getCharsCount())):newValue=strLimiter.limitByWordCount(newValue,maxWords-self.getWordsCount()),isCke?_getCKEditor(interaction).insertText(newValue):containerHelper.get(interaction).find("textarea").val(oldValue+newValue),_.defer(function(){self.updateCounter()}))},cke;"xhtml"===_getFormat(interaction)?(cke=_getCKEditor(interaction),cke.on("key",keyLimitHandler),cke.on("paste",nonKeyLimitHandler)):$textarea.on("keyup.commonRenderer",patternHandler).on("keydown.commonRenderer",keyLimitHandler).on("paste.commonRenderer drop.commonRenderer",nonKeyLimitHandler)},getWordsCount:function(){var value=_getTextareaValue(interaction)||"";return _.isEmpty(value)?0:value.trim().replace(/\s+/gi," ").split(" ").length},getCharsCount:function(){var value=_getTextareaValue(interaction)||"";return value.length},updateCounter:function(){$charsCounter.text(this.getCharsCount()),$wordsCounter.text(this.getWordsCount())}};return limiter},_getTextareaValue=function(interaction,raw){return"xhtml"===_getFormat(interaction)?_ckEditorData(interaction,raw):containerHelper.get(interaction).find("textarea").val()},_setPattern=function($element,pattern){var patt=new RegExp(pattern);$element.on("keyup.commonRenderer",function(){$element.removeClass("field-error"),patt.test($element.val())||$element.addClass("field-error")})},_isMultiple=function(interaction){var attributes=interaction.getAttributes(),response=interaction.getResponseDeclaration();return!!(attributes.maxStrings&&("multiple"===response.attr("cardinality")||"ordered"===response.attr("cardinality")))},_setUpCKEditor=function(interaction,options){var $container=containerHelper.get(interaction),editor=ckEditor.replace($container.find(".text-container")[0],options||{});if(editor)return $container.data("editor",editor.name),editor},_destroyCkEditor=function(interaction){var $container=containerHelper.get(interaction),name=$container.data("editor"),editor;name&&(editor=ckEditor.instances[name]),editor&&(editor.destroy(),$container.removeData("editor"))},_getCKEditor=function(interaction){var $container=containerHelper.get(interaction),name=$container.data("editor");return ckEditor.instances[name]},_ckEditorData=function(interaction,raw){var editor=_getCKEditor(interaction),data=editor&&editor.getData()||"";return raw||(data=_stripTags(data)),data},_stripTags=function(str){var tempNode=document.createElement("div");return tempNode.innerHTML=str,tempNode.textContent},_getFormat=function(interaction){var format=interaction.attr("format");return _.contains(["plain","xhtml","preformatted"],format)?format:"plain"},setText=function(interaction,text){var limiter=inputLimiter(interaction);if("xhtml"===_getFormat(interaction))try{_getCKEditor(interaction).setData(text,function(){limiter.enabled&&limiter.updateCounter()})}catch(e){console.error("setText error",e)}else containerHelper.get(interaction).find("textarea").val(text),limiter.enabled&&limiter.updateCounter()};return{qtiClass:"extendedTextInteraction",template:tpl,render:function(interaction){return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),multiple=_isMultiple(interaction),limiter=inputLimiter(interaction),placeholderText=interaction.attr("placeholderText"),ckOptions={extraPlugins:"onchange",language:"en",defaultLanguage:"en",resize_enabled:!0,secure:"https:"===location.protocol,forceCustomDomain:!0},$el,expectedLength,minStrings,patternMask,placeholderType,editor,isThemeLoaded,_styleUpdater,themeLoaded,_getNumStrings;multiple?($el=$container.find("input"),minStrings=interaction.attr("minStrings"),expectedLength=interaction.attr("expectedLength"),patternMask=interaction.attr("patternMask"),minStrings&&(_getNumStrings=function($element){var num=0;return $element.each(function(){""!==$(this).val()&&num++}),num},minStrings=parseInt(minStrings,10),0<minStrings&&$el.on("blur.commonRenderer",function(){setTimeout(function(){!$el.is(":focus")&&_getNumStrings($el)<minStrings&&instructionMgr.appendNotification(interaction,__("The minimum number of answers is ")+" : "+minStrings,"warning")},100)})),expectedLength&&(expectedLength=parseInt(expectedLength,10),0<expectedLength&&$el.each(function(){$(this).css("width",expectedLength+"em")})),patternMask&&$el.each(function(){_setPattern($(this),patternMask)}),placeholderText&&(placeholderType="first","multiple"===placeholderType?$el.each(function(){$(this).attr("placeholder",placeholderText)}):"first"==placeholderType&&$el.first().attr("placeholder",placeholderText)),resolve()):($el=$container.find("textarea"),placeholderText&&$el.attr("placeholder",placeholderText),"xhtml"===_getFormat(interaction)?(isThemeLoaded=!1,_styleUpdater=function(){var qtiItemStyle,$editorBody,qtiItem;editor.document&&(qtiItem=$(".qti-item").get(0),qtiItemStyle=qtiItem.currentStyle||window.getComputedStyle(qtiItem),$editorBody=editor.document.$&&editor.document.$.body?$(editor.document.$.body):$(editor.document.getBody().$),$editorBody.css({"background-color":"transparent",color:qtiItemStyle.color}))},themeLoaded=function(){isThemeLoaded=!0,_styleUpdater()},editor=_setUpCKEditor(interaction,ckOptions),!editor&&reject("Unable to instantiate ckEditor"),editor.on("instanceReady",function(){_styleUpdater(),editor.container&&editor.container.$&&$(editor.container.$).addClass("no-key-navigation"),_.delay(resolve,300)}),("ready"===editor.status||"loaded"===editor.status)&&_.defer(resolve),editor.on("configLoaded",function(){editor.config=ckConfigurator.getConfig(editor,"extendedText",ckOptions),limiter.enabled&&limiter.listenTextInput()}),editor.on("change",function(){containerHelper.triggerResponseChangeEvent(interaction,{})}),$(document).on("themechange.themeloader",themeLoaded)):($el.on("keyup.commonRenderer change.commonRenderer",function(){containerHelper.triggerResponseChangeEvent(interaction,{})}),limiter.enabled&&limiter.listenTextInput(),resolve()))})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var _setMultipleVal=function(identifier,value){interaction.getContainer().find("#"+identifier).val(value)},baseType=interaction.getResponseDeclaration().attr("baseType");if(response.base&&response.base[baseType]!==void 0)setText(interaction,response.base[baseType]);else if(response.list&&response.list[baseType])for(var i in response.list[baseType]){var serial=void 0===response.list.serial?"":response.list.serial[i];_setMultipleVal(serial+"_"+i,response.list[baseType][i])}else throw new Error("wrong response format in argument.")},getResponse:function getResponse(interaction){var $container=containerHelper.get(interaction),attributes=interaction.getAttributes(),responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),numericBase=attributes.base||10,multiple=!!(attributes.maxStrings&&("multiple"===responseDeclaration.attr("cardinality")||"ordered"===responseDeclaration.attr("cardinality"))),ret=multiple?{list:{}}:{base:{}};if(multiple){var values=[];$container.find("input").each(function(i){var $el=$(this);attributes.placeholderText&&$el.val()===attributes.placeholderText?values[i]="":"integer"===baseType?(values[i]=parseInt($el.val(),numericBase),values[i]=isNaN(values[i])?"":values[i]):"float"===baseType?(values[i]=parseFloat($el.val()),values[i]=isNaN(values[i])?"":values[i]):"string"===baseType&&(values[i]=$el.val())}),ret.list[baseType]=values}else{var value="";attributes.placeholderText&&_getTextareaValue(interaction)===attributes.placeholderText?value="":"integer"===baseType?value=parseInt(_getTextareaValue(interaction),numericBase):"float"===baseType?value=parseFloat(_getTextareaValue(interaction)):"string"===baseType&&(value=_getTextareaValue(interaction,!0)),ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value}return ret},getData:function getCustomData(interaction,data){var pattern=interaction.attr("patternMask"),maxWords=parseInt(patternMaskHelper.parsePattern(pattern,"words")),maxLength=parseInt(patternMaskHelper.parsePattern(pattern,"chars")),expectedLength=parseInt(interaction.attr("expectedLines"),10);return _.merge(data||{},{maxWords:isNaN(maxWords)?void 0:maxWords,maxLength:isNaN(maxLength)?void 0:maxLength,attributes:isNaN(expectedLength)?void 0:{expectedLength:72*expectedLength}})},resetResponse:function resetResponse(interaction){"xhtml"===_getFormat(interaction)?_getCKEditor(interaction).setData(""):containerHelper.get(interaction).find("input, textarea").val("")},destroy:function(interaction){var $container=containerHelper.get(interaction),$el=$container.find("input, textarea");"xhtml"===_getFormat(interaction)&&_destroyCkEditor(interaction),$el.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},setState:function(interaction,state){if(_.isObject(state)&&state.response)try{interaction.setResponse(state.response)}catch(e){throw interaction.resetResponse(),e}},enable:function enable(interaction){var $container=containerHelper.get(interaction),editor;$container.find("input, textarea").removeAttr("disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction),editor&&("ready"===editor.status?editor.setReadOnly(!1):editor.readOnly=!1))},disable:function disable(interaction){var $container=containerHelper.get(interaction),editor;$container.find("input, textarea").attr("disabled","disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction),editor&&("ready"===editor.status?editor.setReadOnly(!0):editor.readOnly=!0))},clearText:function clearText(interaction){setText(interaction,"")},setText:setText}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-gapMatchInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"gapMatchInteraction\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <ul class=\"choice-area none block-listing solid horizontal source\">\n        ",options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </ul>\n    <div class=\"instruction-container\"></div>\n    <div class=\"qti-flow-container\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","interact","ui/interactUtils"],function(_,__,$,tpl,containerHelper,instructionMgr,pciResponse,interact,interactUtils){'use strict';var _choiceUsages={},setChoice=function(interaction,$choice,$target){var choiceSerial=$choice.data("serial"),choice=interaction.getChoice(choiceSerial);_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),_choiceUsages[choiceSerial]++,$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&_choiceUsages[choiceSerial]>=choice.attr("matchMax")&&$choice.attr("class","deactivated"),containerHelper.triggerResponseChangeEvent(interaction)},unsetChoice=function(interaction,$choice){var serial=$choice.data("serial"),$container=containerHelper.get(interaction);$container.find(".choice-area [data-serial="+serial+"]").removeClass().addClass("qti-choice"),_choiceUsages[serial]--,$choice.removeClass("filled").removeData("serial").empty(),interaction.swapping||containerHelper.triggerResponseChangeEvent(interaction)},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".choice-area [data-identifier="+identifier+"]",$container)},getGap=function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".qti-flow-container [data-identifier="+identifier+"]",$container)},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$(".gapmatch-content.active",$container).removeClass("active"),$(".gapmatch-content",$container).each(function(){unsetChoice(interaction,$(this))})},_setPairs=function(interaction,pairs){_.each(pairs,function(pair){pair&&setChoice(interaction,getChoice(interaction,pair[0]),getGap(interaction,pair[1]).find(".gapmatch-content"))})},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".gapmatch-content",$container).each(function(){var choiceSerial=$(this).data("serial"),pair=[];choiceSerial&&pair.push(interaction.getChoice(choiceSerial).attr("identifier")),pair.push($(this).data("identifier")),2===pair.length&&response.push(pair)}),response};return{qtiClass:"gapMatchInteraction",template:tpl,render:function render(interaction){function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){$activeDrop&&interact(gapSelector).fire({type:"drop",target:$activeDrop.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}function _handleChoiceSelect($target){$activeChoice&&$target.hasClass("active")||$target.hasClass("deactivated")||(_resetSelection(),$activeChoice=$target.addClass("active"),$(gapSelector).addClass("empty"))}function _handleFilledGapSelect($target){$activeChoice=$target,$(gapSelector).addClass("active")}function _handleGapSelect($target){var choiceSerial,targetSerial;_isInsertionMode()?(choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial"),targetSerial!==choiceSerial&&(targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target)),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null):_isModeEditing()?(choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial"),targetSerial!==choiceSerial&&(_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target)),_resetSelection()):$target.data("serial")&&$target.hasClass("filled")&&(targetSerial=$target.data("serial"),$activeChoice=$target,$activeChoice.addClass("active"),$flowContainer.find(">li>div").filter(function(){return $target.data("serial")!==targetSerial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $target.data("serial")!==targetSerial}).addClass("empty"),$target.append($bin))}var $container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$flowContainer=$container.find(".qti-flow-container"),$activeChoice=null,$activeDrop=null,$bin=$("<span>",{class:"icon-undo remove-choice",title:__("remove")}),choiceSelector=$choiceArea.selector+" .qti-choice",gapSelector=$flowContainer.selector+" .gapmatch-content",filledGapSelector=gapSelector+".filled",binSelector=$container.selector+" .remove-choice",_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){return setChoice(interaction,$choice,$target)},_resetSelection=function(){$activeChoice&&($flowContainer.find(".remove-choice").remove(),$activeChoice.removeClass("deactivated active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){return unsetChoice(interaction,$choice)},_isInsertionMode=function(){return $activeChoice&&!$activeChoice.hasClass("filled")},_isModeEditing=function(){return $activeChoice&&$activeChoice.hasClass("filled")},isDragAndDropEnabled,dragOptions,scaleX,scaleY;this.getOption&&this.getOption("enableDragAndDrop")&&this.getOption("enableDragAndDrop").gapMatch&&(isDragAndDropEnabled=this.getOption("enableDragAndDrop").gapMatch),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector).draggable(_.assign({},dragOptions,{onstart:function onstart(e){var $target=$(e.target),scale;$target.addClass("dragged"),_handleChoiceSelect($target),_iFrameDragFix(choiceSelector,e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY)},onend:function onend(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(filledGapSelector).draggable(_.assign({},dragOptions,{onstart:function onstart(e){var $target=$(e.target),scale;$target.addClass("dragged"),_handleFilledGapSelect($target),_iFrameDragFix(filledGapSelector,e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY)},onend:function onend(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),$activeChoice&&(_unsetChoice($activeChoice),_resetSelection()),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(gapSelector).dropzone({overlap:.05,ondragenter:function ondragenter(e){var $target=$(e.target),$dragged=$(e.relatedTarget);$activeDrop=$target,$target.addClass("dropzone"),$dragged.addClass("droppable")},ondrop:function ondrop(e){_handleGapSelect($(e.target)),this.ondragleave(e)},ondragleave:function ondragleave(e){var $target=$(e.target),$dragged=$(e.relatedTarget);$target.removeClass("dropzone"),$dragged.removeClass("droppable"),$activeDrop=null}})),interact($container.selector).on("tap",function(e){e.stopPropagation(),_resetSelection()}),interact(choiceSelector).on("tap",function(e){e.stopPropagation(),_handleChoiceSelect($(e.currentTarget)),e.preventDefault()}),interact(gapSelector).on("tap",function(e){e.stopPropagation(),_handleGapSelect($(e.currentTarget)),e.preventDefault()}),interact(binSelector).on("tap",function(e){e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection(),e.preventDefault()})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){resetResponse(interaction),_setPairs(interaction,pciResponse.unserialize(response,interaction))},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:resetResponse,destroy:function destroy(interaction){var $container=containerHelper.get(interaction);interact($container.selector).unset(),interact($container.find(".choice-area").selector+" .qti-choice").unset(),interact($container.find(".qti-flow-container").selector+" .gapmatch-content").unset(),interact($container.find(".remove-choice").selector).unset(),$container.find(".gapmatch-content").empty(),$container.find(".active").removeClass("active"),$container.find(".remove-choice").remove(),$container.find(".empty").removeClass("empty"),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState:function(interaction){var state={},response=interaction.getResponse(),$container;return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicAssociateInteraction clearfix",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"image-editor solid\">\n        <div id='graphic-paper-",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"' class=\"main-image-box\"></div>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){'use strict';var _renderChoice=function(interaction,choice){var shape=choice.attr("shape"),coords=choice.attr("coords"),maxAssociations=interaction.attr("maxAssociations"),rElement=graphic.createElement(interaction.paper,shape,coords,{id:choice.serial,title:__("Select this area to start an association")}).data("max",choice.attr("matchMax")).data("matching",0).removeData("assocs").click(function(){var self=this,active,assocs;return 0<maxAssociations&&_getRawResponse(interaction).length>=maxAssociations?(_shapesUnSelectable(interaction),void instructionMgr.validateInstructions(interaction,{choice:choice,target:this})):void(this.selectable?(active=_getActiveElement(interaction),active&&(active.data("matching",active.data("matching")+1),this.data("matching",this.data("matching")+1),assocs=active.data("assocs")||[],assocs.push(choice.id()),active.data("assocs",assocs),_createPath(interaction,active,this,function(){active.data("matching",active.data("matching")-1),self.data("matching",self.data("matching")-1),active.data("assocs",_.remove(active.data("assocs")||[],choice.id())),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:self})})),_shapesUnSelectable(interaction)):this.active?(graphic.updateElementState(this,"basic",__("Select another area to complete the association")),this.active=!1,_shapesUnSelectable(interaction)):_isMatchable(this)&&(graphic.updateElementState(this,"active",__("Select this area to start an association")),this.active=!0,_shapesSelectable(interaction,this)),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:this}))})},_paperUnSelect=function(interaction){var $container=containerHelper.get(interaction),image=interaction.paper.getById("bg-image-"+interaction.serial);image&&image.click(function(){_shapesUnSelectable(interaction),$container.trigger("unselect.graphicassociate")})},_getActiveElement=function(interaction){var active;return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);if(element&&!0===element.active)return active=element,!1}),active},_createPath=function(interaction,srcElement,destElement,onRemove){function showCloser(){closerBg.toFront().animate({opacity:.8},300).click(removeSet),closer.toFront().animate({opacity:1},300).click(removeSet)}function hideCloser(){closerBg&&closerBg.type&&(closerBg.animate({opacity:0},300,function(){closerBg.toBack()}).unclick(),closer.animate({opacity:0},300,function(){closer.toBack()}).unclick())}function removeSet(){_.invoke(vset,"remove"),interaction._vsets=_.without(interaction._vsets,vset),"function"==typeof onRemove&&onRemove()}var $container=containerHelper.get(interaction),vset=[],src=srcElement.getBBox(),sx=src.x+src.width/2,sy=src.y+src.height/2,dest=destElement.getBBox(),dx=dest.x+dest.width/2,dy=dest.y+dest.height/2,srcBullet=interaction.paper.circle(sx,sy,3).attr(graphic._style["assoc-bullet"]),destBullet=interaction.paper.circle(dx,dy,3).attr(graphic._style["assoc-bullet"]),path=interaction.paper.path("M"+sx+","+sy+"L"+sx+","+sy).attr(graphic._style.assoc).animate({path:"M"+sx+","+sy+"L"+dx+","+dy},300),layer=interaction.paper.path("M"+sx+","+sy+"L"+dx+","+dy).attr(graphic._style["assoc-layer"]),midPath=layer.getPointAtLength(layer.getTotalLength()/2),closerBg=interaction.paper.circle(midPath.x,midPath.y,9).attr(graphic._style["close-bg"]).toBack(),closer=interaction.paper.path(graphic._style.close.path).attr(graphic._style.close).transform("T"+(midPath.x-9)+","+(midPath.y-9)).attr("title",_("Click again to remove")).toBack();srcElement.toFront(),destElement.toFront(),vset=[srcBullet,path,destBullet,layer,closerBg,closer],interaction._vsets.push(vset),_.invoke(vset,"data","assoc-path",!0),layer.click(function(){0===closer.attrs.opacity?showCloser():hideCloser()}),$container.on("unselect.graphicassociate",function(){hideCloser()})},_shapesSelectable=function(interaction,active){var assocs=active.data("assocs")||[];_.forEach(interaction.getChoices(),function(choice){var element;_.contains(assocs,choice.id())||(element=interaction.paper.getById(choice.serial),!element.active&&element.id!==active.id&&_isMatchable(element,active)&&(element.selectable=!0,graphic.updateElementState(element,"selectable")))})},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,element.active=!1,graphic.updateElementState(element,"basic"))})},_isMatchable=function(element){var matchable=!1,matching,matchMax;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||0,matchable=0===matchMax||matchMax>matching),matchable},_getRawResponse=function(interaction){var responses=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial),assocs=element.data("assocs");element&&assocs&&(responses=responses.concat(_.map(assocs,function(id){return[choice.id(),id]})))}),responses};return{qtiClass:"graphicAssociateInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),background=interaction.object.attributes,$imageBox=$(".main-image-box",$container);interaction._vsets=[],$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_paperUnSelect(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minAssociations"),max:interaction.attr("maxAssociations"),getResponse:_getRawResponse,onError:function onError(data){data&&data.target&&graphic.highlightError(data.target)}})})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}if(_.isArray(responseValues)){var map=_.transform(interaction.getChoices(),function(res,choice){res[choice.id()]=interaction.paper.getById(choice.serial)});_.forEach(responseValues,function(responseValue){var el1,el2;_.isArray(responseValue)&&2===responseValue.length&&(el1=map[responseValue[0]],el2=map[responseValue[1]],el1&&el2&&(graphic.trigger(el1,"click"),graphic.trigger(el2,"click")))})}}},getResponse:function getResponse(interaction){var raw=_getRawResponse(interaction),response=pciResponse.serialize(_getRawResponse(interaction),interaction);return response},resetResponse:function(interaction){var toRemove=[];_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&element.data({max:choice.attr("matchMax"),matching:0,assocs:[]})}),interaction.paper.forEach(function(elt){elt.data("assoc-path")&&toRemove.push(elt)}),_.invoke(toRemove,"remove")},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$container.off(".graphicassociate"),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicGapMatchInteraction clearfix",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"image-editor solid\">\n        <div id='graphic-paper-",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"' class=\"main-image-box\"></div>\n        <div class=\"clearfix\"></div>\n        <ul class=\"none block-listing horizontal source\">\n            ",options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},(helper=helpers.gapImgs)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.gapImgs,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.gapImgs||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",["jquery","lodash","i18n","module","core/promise","core/mouseEvent","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","interact","ui/interactUtils"],function($,_,__,module,Promise,triggerMouseEvent,tpl,graphic,pciResponse,containerHelper,instructionMgr,interact,interactUtils){'use strict';var activeDrop=null,_choiceUsages={},isDirectedPairFlipped=module.config().flipDirectedPair,_isMatchable=function(element){var matchable=!1,matching,matchMax;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||[],matchable=0===matchMax||matchMax>matching.length),matchable},_shapesSelectable=function(interaction){var tooltip=__("Select the area to add an image");_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);_isMatchable(element)&&(element.selectable=!0,graphic.setStyle(element,"selectable"),graphic.updateTitle(element,tooltip))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){graphic.updateTitle(element,tooltip)})})},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,graphic.setStyle(element,"basic"),graphic.updateTitle(element,__("Select an image first")))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){graphic.updateTitle(element,__("Remove"))})})},_paperUnSelect=function(interaction){var $container=containerHelper.get(interaction),$gapImages=$("ul > li",$container),bgImage=interaction.paper.getById("bg-image-"+interaction.serial);bgImage&&interact(bgImage.node).on("tap",function(){_shapesUnSelectable(interaction),$gapImages.removeClass("active")})},_setChoice=function(interaction,$choice){var choiceSerial=$choice.data("serial"),choice=interaction.getGapImg(choiceSerial),matchMax,usages;_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),_choiceUsages[choiceSerial]++,!interaction.responseMappingMode&&choice.attr("matchMax")&&(matchMax=+choice.attr("matchMax"),usages=+_choiceUsages[choiceSerial],0!==matchMax&&matchMax<=usages&&(interact($choice.get(0)).draggable(!1),$choice.addClass("disabled"),$choice.removeClass("selectable")))},_unsetChoice=function(interaction,$choice){var choiceSerial=$choice.data("serial");_choiceUsages[choiceSerial]--,$choice.removeClass("disabled"),$choice.addClass("selectable"),interact($choice.get(0)).draggable(!0)},_selectShape=function(interaction,element,trackResponse){var $container=containerHelper.get(interaction),$gapList=$("ul",$container),$active=$gapList.find(".active:first"),$imageBox=$(".main-image-box",$container),boxOffset=$imageBox.offset(),$img,$clone,gapFiller,id,bbox,shapeOffset,activeOffset,matching,currentCount;"undefined"==typeof trackResponse&&(trackResponse=!0),$active.length&&(id=$active.data("identifier"),matching=element.data("matching")||[],matching.push(id),element.data("matching",matching),currentCount=matching.length,$img=$active.find("img"),_shapesUnSelectable(interaction),$gapList.children().removeClass("active"),_setChoice(interaction,$active),$clone=$img.clone(),shapeOffset=$(element.node).offset(),activeOffset=$active.offset(),$clone.css({position:"absolute",display:"block","z-index":1e4,opacity:.8,top:activeOffset.top-boxOffset.top,left:activeOffset.left-boxOffset.left}),$clone.appendTo($imageBox),$clone.animate({top:shapeOffset.top-boxOffset.top,left:shapeOffset.left-boxOffset.left},200,function(){var gapFillerImage;$clone.remove(),bbox=element.getBBox(),gapFiller=graphic.createBorderedImage(interaction.paper,{url:$img.attr("src"),left:bbox.x+8*(currentCount-1),top:bbox.y+8*(currentCount-1),width:parseInt($img.attr("width"),10),height:parseInt($img.attr("height"),10),padding:0,border:!1,shadow:!0}).data("identifier",id).toFront(),gapFillerImage=gapFiller[2].node,interact(gapFillerImage).on("tap",function(e){var target=e.currentTarget,rElement=interaction.paper.getById(target.raphaelid);e.preventDefault(),e.stopPropagation(),0<$gapList.find(".active").length?interactUtils.tapOn(element.node):(element.data("matching",_.without(element.data("matching")||[],rElement.data("identifier"))),interaction.gapFillers=_.without(interaction.gapFillers,gapFiller),gapFiller.remove(),_unsetChoice(interaction,$active),containerHelper.triggerResponseChangeEvent(interaction))}),interaction.gapFillers.push(gapFiller),containerHelper.triggerResponseChangeEvent(interaction)}))},_renderChoice=function(interaction,choice){function handleShapeSelect(){_isMatchable(rElement)&&!0===rElement.selectable&&_selectShape(interaction,rElement)}var rElement=graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select an image first"),hover:!1}).data("max",choice.attr("matchMax")).data("matching",[]);interact(rElement.node).on("tap",function(){handleShapeSelect()}),isDragAndDropEnabled&&interact(rElement.node).dropzone({overlap:.15,ondragenter:function ondragenter(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"hover"),activeDrop=rElement.node)},ondrop:function ondrop(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"selectable"),handleShapeSelect(),activeDrop=null)},ondragleave:function ondragleave(){_isMatchable(rElement)&&(graphic.setStyle(rElement,"selectable"),activeDrop=null)}})},_iFrameDragFix=function(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){activeDrop&&interact(activeDrop).fire({type:"drop",target:activeDrop,relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})},_renderGapList=function(interaction,$gapList){function toggleActiveGapState($target){$target.hasClass("disabled")||($target.hasClass("active")?_setInactiveGapState($target):_setActiveGapState($target))}function _setActiveGapState($target){$gapList.children("li").removeClass("active"),$target.addClass("active"),_shapesSelectable(interaction)}function _setInactiveGapState($target){$target.removeClass("active"),_shapesUnSelectable(interaction)}var gapFillersSelector=$gapList.selector+" li",dragOptions,scaleX,scaleY;interact(gapFillersSelector).on("tap",function(e){e.stopPropagation(),e.preventDefault(),toggleActiveGapState($(e.currentTarget))}),isDragAndDropEnabled&&(dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},$(gapFillersSelector).each(function(index,gap){interact(gap).draggable(_.assign({},dragOptions,{onstart:function onstart(e){var $target=$(e.target),scale;_setActiveGapState($target),$target.addClass("dragged"),_iFrameDragFix(gapFillersSelector,e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY)},onend:function onend(e){var $target=$(e.target);_setInactiveGapState($target),$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1)}))},_getRawResponse=function(interaction){var pairs=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_.isArray(element.data("matching"))&&_.forEach(element.data("matching"),function(gapImg){isDirectedPairFlipped?pairs.push([choice.id(),gapImg]):pairs.push([gapImg,choice.id()])})}),_.sortBy(pairs,[0,1])},isDragAndDropEnabled;return{qtiClass:"graphicGapMatchInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),$gapList=$("ul.source",$container),background=interaction.object.attributes;interaction.gapFillers=[],self.getOption&&self.getOption("enableDragAndDrop")&&self.getOption("enableDragAndDrop").graphicGapMatch&&(isDragAndDropEnabled=self.getOption("enableDragAndDrop").graphicGapMatch),$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container,resize:function resize(newSize,factor){$gapList.css("max-width",newSize+"px"),1!==factor&&$gapList.find("img").each(function(){var $img=$(this);$img.width($img.attr("width")*factor),$img.height($img.attr("height")*factor)})}}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_renderGapList(interaction,$gapList),_paperUnSelect(interaction)})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var $container=containerHelper.get(interaction),responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){responseValues=null}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_.forEach(responseValues,function(pair){var responseChoice,responseGap;2===pair.length&&(responseChoice=isDirectedPairFlipped?pair[0]:pair[1],responseGap=isDirectedPairFlipped?pair[1]:pair[0],responseChoice===choice.id()&&($("[data-identifier="+responseGap+"]",$container).addClass("active"),_selectShape(interaction,element,!1)))})})}},getResponse:function getResponse(interaction){var raw=_getRawResponse(interaction);return pciResponse.serialize(raw,interaction)},resetResponse:function(interaction){_shapesUnSelectable(interaction),_.forEach(interaction.gapFillers,function(gapFiller){interactUtils.tapOn(gapFiller.items[2][0])})},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty(),interact($container.find("ul.source li").selector).unset(),interact($container.find(".main-image-box rect").selector).unset()),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},isDirectedPairFlipped:isDirectedPairFlipped}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicOrderInteraction clearfix",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"image-editor solid\">\n        <div id='graphic-paper-",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"' class=\"main-image-box\"></div>\n        <div class=\"clearfix\"></div>\n        <ul class=\"none block-listing horizontal ordinals\"></ul>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){'use strict';var _renderChoice=function(interaction,$orderList,choice){graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(this.active?_unselectShape(interaction.paper,this,$orderList):_selectShape(interaction.paper,this,$orderList),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice}))})},_renderOrderList=function(interaction,$orderList){var size=_.size(interaction.getChoices()),min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),$orderers;0<max&&max<size?size=max:0<min&&min<size&&(size=min),_.times(size,function(index){var position=index+1,$orderer=$("<li class=\"selectable\" data-number=\""+position+"\">"+position+"</li>");0===index&&$orderer.addClass("active"),$orderList.append($orderer)}),_createTexts(interaction.paper,size,$orderList),$orderers=$orderList.children("li"),$orderers.click(function(e){e.preventDefault();var $orderer=$(this);$orderer.hasClass("active")||$orderer.hasClass("disabled")||($orderers.removeClass("active"),$orderer.addClass("active"))})},_selectShape=function(paper,element,$orderList){var $active=$orderList.find(".active:first");$active.length&&0<$active.data("number")&&(element.data("number",$active.data("number")),element.active=!0,_showText(paper,element),graphic.updateElementState(element,"active"),$active.toggleClass("active disabled").siblings(":not(.disabled)").first().toggleClass("active"))},_unselectShape=function(paper,element,$orderList){var number=element.data("number");element.active=!1,_hideText(paper,element),element.removeData("number"),graphic.updateElementState(element,"basic"),$orderList.children().removeClass("active").filter("[data-number="+number+"]").removeClass("disabled").addClass("active")},_createTexts=function(paper,size){var texts=[];return _.times(size,function(index){var number=index+1,text=graphic.createText(paper,{id:"text-"+number,content:number,title:__("Remove"),style:"order-text",hide:!0});text.click(function(){paper.forEach(function(element){if(element.data("number")===number&&element.events){var evt=_.where(element.events,{name:"click"});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.call(element)}})}),texts.push(text)}),texts},_showText=function(paper,element){var bbox=element.getBBox(),text=paper.getById("text-"+element.data("number")),transf;text&&(transf="T"+(bbox.x+bbox.width/2)+","+(bbox.y+bbox.height/2),text.transform(transf).show().toFront())},_hideText=function(paper,element){var text=paper.getById("text-"+element.data("number"));text&&text.hide()},_getRawResponse=function(interaction){var response=[];return _.forEach(interaction.getChoices(),function(choice){var elt=interaction.paper.getById(choice.serial);elt&&elt.data("number")&&response.push({index:elt.data("number"),id:choice.id()})}),_(response).sortBy("index").map("id").value()};return{qtiClass:"graphicOrderInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),$orderList=$("ul",$container),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_renderOrderList(interaction,$orderList),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction,$orderList)),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function onError(data){graphic.highlightError(data.target)}})})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var $container=containerHelper.get(interaction),$orderList=$("ul",$container),responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(responseValues,function(responseValue,index){var choice=_(interaction.getChoices()).where({attributes:{identifier:responseValue}}).first(),element;choice&&(element=interaction.paper.getById(choice.serial),element&&($orderList.children("[data-number="+(index+1)+"]").addClass("active"),_selectShape(interaction.paper,element,$orderList)))})}},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){var $container=containerHelper.get(interaction),$orderList=$("ul",$container);_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_unselectShape(interaction.paper,element,$orderList)}),$orderList.children("li").removeClass("active disabled").first().addClass("active")},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-graphicInteraction qti-hotspotInteraction clearfix",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"image-editor solid\">\n        <div id='graphic-paper-",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"' class=\"main-image-box\"></div>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){'use strict';var _renderChoice=function(interaction,choice){var $container=containerHelper.get(interaction),rElement=graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(){this.active?(graphic.updateElementState(this,"basic",__("Select this area")),this.active=!1,$container.trigger("inactiveChoice.qti-widget",[choice,this])):(graphic.updateElementState(this,"active",__("Click again to remove")),this.active=!0,$container.trigger("activeChoice.qti-widget",[choice,this])),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:this})})},_getRawResponse=function(interaction){return _(interaction.getChoices()).map(function(choice){var rElement=interaction.paper.getById(choice.serial);return!!(rElement&&!0===rElement.active)&&choice.id()}).filter(_.isString).value()};return{qtiClass:"hotspotInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function onError(data){data.target.active&&(data.target.active=!1,graphic.updateElementState(this,"basic",__("Select this area")),graphic.highlightError(data.target),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("inactiveChoice.qti-widget",[data.choice,data.target]))}})})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){var rElement;_.contains(responseValues,choice.attributes.identifier)&&(rElement=interaction.paper.getById(choice.serial),rElement&&(rElement.active=!0,graphic.updateElementState(rElement,"active",__("Click again to remove")),instructionMgr.validateInstructions(interaction,{choice:choice,target:rElement})))})}},getResponse:function getResponse(interaction){var raw=_getRawResponse(interaction),response=pciResponse.serialize(_getRawResponse(interaction),interaction);return response},resetResponse:function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.active=!1,graphic.updateElementState(element,"basic"))}),instructionMgr.resetInstructions(interaction)},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-hottextInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"hottextInteraction\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n  ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  <div class=\"instruction-container\"></div>\n  <div class=\"qti-flow-container\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){'use strict';var pseudoLabel=function(interaction){var $container=containerHelper.get(interaction),setChoice=function($choice,interaction){var $inupt=$choice.find("input");if($inupt.prop("checked")||$inupt.hasClass("disabled"))$inupt.prop("checked",!1);else{var maxChoices=parseInt(interaction.attr("maxChoices")),currentChoices=_.values(_getRawResponse(interaction)).length;(currentChoices<maxChoices||0===maxChoices)&&$inupt.prop("checked",!0)}containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:$choice})};$(".hottext",$container).on("click",function(e){e.preventDefault(),setChoice($(this),interaction)})},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $("input:checked",$container).each(function(){values.push($(this).val())}),values};return{qtiClass:"hottextInteraction",template:tpl,render:function render(interaction){pseudoLabel(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function onError(data){var $input,$choice,$icon;data.choice&&data.choice.length&&($choice=data.choice.addClass("error"),$input=$choice.find("input"),$icon=$choice.find(" > label > span").addClass("error cross"),setTimeout(function(){$input.prop("checked",!1),$choice.removeClass("error"),$icon.removeClass("error cross")},350))}})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var $container=containerHelper.get(interaction);try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$container.find("input[value=\""+identifier+"\"]").prop("checked",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function resetResponse(interaction){var $container=containerHelper.get(interaction);$("input",$container).prop("checked",!1)},destroy:function(interaction){var $container=containerHelper.get(interaction);$container.find(".hottext").off("click"),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<select ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-inlineInteraction qti-inlineChoiceInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"\n        data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n        data-qti-class=\"inlineChoiceInteraction\"\n        data-has-search=\"false\"\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    <option></option>                \n    <option value=\"empty\"></option>\n    ",options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</select>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","ui/tooltip","select2"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse,tooltip){'use strict';var _defaultOptions={allowEmpty:!0,placeholderText:__("select a choice")},_setVal=function(interaction,choiceIdentifier){containerHelper.get(interaction).val(choiceIdentifier).select2("val",choiceIdentifier)},_getRawResponse=function(interaction){var value=containerHelper.get(interaction).val();return value&&value!=="empty"?[value]:[]};return{qtiClass:"inlineChoiceInteraction",template:tpl,render:function render(interaction,options){var opts=_.clone(_defaultOptions),required=!!interaction.attr("required"),$container=containerHelper.get(interaction),choiceTooltip;_.extend(opts,options),opts.allowEmpty&&!required?$container.find("option[value=empty]").text("--- "+__("leave empty")+" ---"):$container.find("option[value=empty]").remove(),$container.select2({width:"element",placeholder:opts.placeholderText,minimumResultsForSearch:-1,dropdownCssClass:"qti-inlineChoiceInteraction-dropdown"});var $el=$container.select2("container");required&&(choiceTooltip=tooltip.warning($el,__("A choice must be selected")),""===$container.val()&&choiceTooltip.show()),$container.on("change",function(e){if($(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")){var $selectedIndex=$(e.currentTarget)[0].options.selectedIndex?$(e.currentTarget)[0].options.selectedIndex:null;$container.find("option").one("click",function(e){e.stopPropagation()}),$container.find("option").eq($selectedIndex).trigger("click")}required&&""!==$container.val()&&choiceTooltip.hide(),containerHelper.triggerResponseChangeEvent(interaction)}).on("select2-open",function(){required&&choiceTooltip.hide()}).on("select2-close",function(){required&&""===$container.val()&&choiceTooltip.show()})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function resetResponse(interaction){_setVal(interaction,"empty")},destroy:function destroy(interaction){var $container=containerHelper.get(interaction);$(document).off(".commonRenderer"),$container.select2("destroy"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$container.select2("disable").select2("close"),$("option[data-identifier]",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($container),$container.select2("enable")))},getState:function(interaction){var state={},response=interaction.getResponse(),$container;return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$("option[data-identifier]",$container).each(function(){state.order.push($(this).data("identifier"))})),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program9(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program11(depth0,data,depth1){var buffer="",stack1;return buffer+="\n      <tr>\n        ",stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.each.call(depth0,depth1&&depth1.matchSet1,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      ",buffer}function program12(){return"\n        <td>\n          <label>\n            <input type=\"checkbox\" >\n            <span class=\"icon-checkbox cross\"></span>\n          </label>\n        </td>\n        "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-matchInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"matchInteraction\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n  ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  <div class=\"instruction-container\"></div>\n  <div class=\"match-interaction-area\">\n    <table class=\"matrix\">\n      <thead>\n      <tr>\n        <th> </th>\n        ",options={hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data},(helper=helpers.matchSet1)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet1,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.matchSet1||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      </thead>\n      <tbody>\n      ",options={hash:{},inverse:self.noop,fn:self.programWithDepth(11,program11,data,depth0),data:data},(helper=helpers.matchSet2)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet2,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.matchSet2||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.programWithDepth(11,program11,data,depth0),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tbody>\n    </table>\n  </div>\n  <div class=\"notification-container\"></div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){'use strict';var inWarning=!1,_filterResponse=function(response){if("undefined"==typeof response.list){if("undefined"==typeof response.base)throw"The given response is not compliant with PCI JSON representation.";else{if(null===response.base)return{list:{directedPair:[]}};if("undefined"==typeof response.base.directedPair)throw"The matchInteraction only accepts directedPair values as responses.";else return{list:{directedPair:[response.base.directedPair]}}}}else if("undefined"==typeof response.list.directedPair)throw"The matchInteraction only accept directedPair values as responses.";else return response},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),values=[];return $container.find("input[type=checkbox]:checked").each(function(){values.push(_inferValue(this))}),values},_inferValue=function(element){var $element=$(element),$container=$element.closest(".match-interaction-area"),y=$element.closest("tr").index(),x=$element.closest("td").index(),firstId=$(".matrix > thead th",$container).eq(x).data("identifier"),secondId=$(".matrix > tbody th",$container).eq(y).data("identifier");return[firstId,secondId]},_onCheckboxSelected=function(interaction,e){var currentResponse=_getRawResponse(interaction),minAssociations=interaction.attr("minAssociations"),maxAssociations=interaction.attr("maxAssociations"),choice;0===maxAssociations&&(maxAssociations=_countChoices(interaction)),_.size(currentResponse)>maxAssociations?(e.preventDefault(),instructionMgr.validateInstructions(interaction)):!1===(choice=_maxMatchReached(interaction,e.target))?(containerHelper.triggerResponseChangeEvent(interaction,{}),instructionMgr.validateInstructions(interaction)):(e.preventDefault(),instructionMgr.validateInstructions(interaction,choice))},_maxMatchReached=function(interaction,input){var association=_inferValue(input),overflow=!1;return _(association).forEach(function(identifier){var choice=_getChoiceDefinitionByIdentifier(interaction,identifier),matchMin=choice.attributes.matchMin,matchMax=choice.attributes.matchMax,assoc=_countAssociations(interaction,choice);0<matchMax&&assoc>matchMax&&(overflow=choice)}),overflow},_countAssociations=function(interaction,choice){var rawResponse=_getRawResponse(interaction),count=0;return _(rawResponse).forEach(function(response){(response[0]===choice.attributes.identifier||response[1]===choice.attributes.identifier)&&count++}),count},_countChoices=function(interaction){var $container=containerHelper.get(interaction);return $container.find("input[type=checkbox]").length},_getChoiceDefinitionByIdentifier=function(interaction,identifier){var rawChoices=_getRawChoices(interaction);return rawChoices[identifier]},_getRawChoices=function(interaction){var rawChoices={};return _(interaction.choices).forEach(function(matchset){_(matchset).forEach(function(choice){rawChoices[choice.attributes.identifier]=choice})}),rawChoices},_setInstructions=function(interaction){var minAssociations=interaction.attr("minAssociations"),maxAssociations=interaction.attr("maxAssociations"),choiceCount=_countChoices(interaction),superClosure=function(){var onMaxChoicesReached=function(report,msg){!1===inWarning&&(inWarning=!0,report.update({level:"warning",message:__("Maximum number of choices reached."),timeout:2e3,stop:function stop(){report.update({level:"success",message:msg}),inWarning=!1}}))},onMatchMaxReached=function(interaction,choice,report,msg,level){var $container=containerHelper.get(interaction);if(!1==inWarning){inWarning=!0;var $choice=$container.find(".qti-simpleAssociableChoice[data-identifier=\""+choice.attributes.identifier+"\"]"),originalBackgroundColor=$choice.css("background-color"),originalColor=$choice.css("color");report.update({level:"warning",message:__("The highlighted choice cannot be associated more than %d time(s).").replace("%d",choice.attributes.matchMax),timeout:3e3,start:function start(){$choice.animate({backgroundColor:"#fff",color:"#ba122b"},250,function(){$choice.animate({backgroundColor:"#ba122b",color:"#fff"},250)})},stop:function stop(){$choice.animate({backgroundColor:originalBackgroundColor,color:originalColor},500),report.update({level:level,message:msg}),inWarning=!1}})}};0===minAssociations&&0<maxAssociations?(msg=__("You must select 0 to %d choices.").replace("%d",maxAssociations),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<=maxAssociations?this.setLevel("success"):responseCount>maxAssociations?onMaxChoicesReached(this,msg):this.reset()})):0===minAssociations&&0===maxAssociations?(msg=__("You must select 0 to %d choices.").replace("%d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):this.setLevel("success")})):0<minAssociations&&0===maxAssociations?(msg=__("You must select %1$d to %2$d choices."),msg=msg.replace("%1$d",minAssociations),msg=msg.replace("%2$d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<minAssociations?this.setLevel("info"):responseCount>choiceCount?onMaxChoicesReached(this,msg):this.setLevel("success")})):0<minAssociations&&0<maxAssociations&&(minAssociations===maxAssociations?(msg=__("You must select exactly %d choice(s)."),msg=msg.replace("%d",minAssociations)):(msg=__("You must select %1$d to %2$d choices."),msg=msg.replace("%1$d",minAssociations),msg=msg.replace("%2$d",maxAssociations)),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&0<choice.attributes.matchMax&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):responseCount<minAssociations?this.setLevel("info"):responseCount>maxAssociations?onMaxChoicesReached(this,msg):responseCount>=minAssociations&&responseCount<=maxAssociations&&this.setLevel("success")}))},msg;superClosure()};return{qtiClass:"matchInteraction",template:tpl,render:function render(interaction){var $container=containerHelper.get(interaction);_setInstructions(interaction),$container.on("click.commonRenderer","input[type=checkbox]",function(e){_onCheckboxSelected(interaction,e)}),instructionMgr.validateInstructions(interaction)},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var $container=containerHelper.get(interaction);response=_filterResponse(response),"undefined"!=typeof response.list&&"undefined"!=typeof response.list.directedPair&&_(response.list.directedPair).forEach(function(directedPair){var x=$("th[data-identifier="+directedPair[0]+"]",$container).index()-1,y=$("th[data-identifier="+directedPair[1]+"]",$container).parent().index();$(".matrix > tbody tr",$container).eq(y).find("input[type=checkbox]").eq(x).prop("checked",!0)}),instructionMgr.validateInstructions(interaction)},getResponse:function getResponse(interaction){var response=pciResponse.serialize(_getRawResponse(interaction),interaction);return response},resetResponse:function resetResponse(interaction){var $container=containerHelper.get(interaction);$("input[type=checkbox]:checked",$container).each(function(){$(this).prop("checked",!1)}),instructionMgr.validateInstructions(interaction)},destroy:function destroy(interaction){var $container=containerHelper.get(interaction);$container.off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(_.isArray(state.order)&&2===state.order.length&&($container=containerHelper.get(interaction),$("thead .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[0],$(a).data("identifier")),bIndex=_.indexOf(state.order[0],$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($("thead tr",$container)),$("tbody .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[1],$(a).data("identifier")),bIndex=_.indexOf(state.order[1],$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().each(function(index,elt){$(elt).prependTo($("tbody tr",$container).eq(index))})),state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)))},getState:function(interaction){var state={},response=interaction.getResponse(),$container;return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[[],[]],$("thead .qti-choice",$container).each(function(){state.order[0].push($(this).data("identifier"))}),$("tbody .qti-choice",$container).each(function(){state.order[1].push($(this).data("identifier"))})),state},inferValue:_inferValue}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-mediaInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"media-container\"></div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","ui/mediaplayer"],function($,_,__,Promise,tpl,pciResponse,containerHelper,mediaplayer){'use strict';var defaults={type:"video/mp4",video:{width:480,height:270},audio:{width:400,height:30}},_getRawResponse=function(interaction){return[containerHelper.get(interaction).data("timesPlayed")||0]};return{qtiClass:"mediaInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),media=interaction.object,$item=$container.parents(".qti-item"),maxPlays=parseInt(interaction.attr("maxPlays"),10)||0,url=media.attr("data")||"",canBePlayed=function(){var current=parseInt($container.data("timesPlayed"),10);return 0===maxPlays||maxPlays>current},resize=_.debounce(function(){var width,height;interaction.mediaElement&&(height=$container.find(".media-container").height(),width=$container.find(".media-container").width(),interaction.mediaElement.resize(width,height))},200),initMediaPlayer=function(){interaction.mediaElement||(interaction.mediaElement=mediaplayer({url:url&&self.resolveUrl(url),type:media.attr("type")||defaults.type,canPause:$container.hasClass("pause"),maxPlays:maxPlays,canSeek:!maxPlays,width:media.attr("width"),height:media.attr("height"),volume:100,autoStart:!!interaction.attr("autostart")&&canBePlayed(),loop:!!interaction.attr("loop"),renderTo:$(".media-container",$container)}).on("render",function(){resize(),$(window).off("resize.mediaInteraction").on("resize.mediaInteraction",resize),$item.off("resize.gridEdit").on("resize.gridEdit",resize),$container.trigger("playerrendered")}).on("ready",function(){$container.trigger("playerready"),canBePlayed()||this.disable(),resolve()}).on("update",_.throttle(function(){containerHelper.triggerResponseChangeEvent(interaction)},1e3)).on("ended",function(){$container.data("timesPlayed",$container.data("timesPlayed")+1),containerHelper.triggerResponseChangeEvent(interaction),canBePlayed()||this.disable()}))};0===_.size(media.attributes)&&(media.attr("type",defaults.type),media.attr("width",$container.innerWidth()),media.attr("height",defaults.video.height),media.attr("data","")),$container.data("timesPlayed")||$container.data("timesPlayed",0),$container.on("responseSet",function(){initMediaPlayer()}),initMediaPlayer()})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var responseValues;if(response)try{responseValues=pciResponse.unserialize(response,interaction),containerHelper.get(interaction).data("timesPlayed",responseValues[0])}catch(e){}},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:function(interaction){containerHelper.get(interaction).data("timesPlayed",0)},destroy:function destroy(interaction){var $container=containerHelper.get(interaction);interaction.mediaElement&&(interaction.mediaElement.destroy(),interaction.mediaElement=null),$(".instruction-container",$container).empty(),$(".media-container",$container).empty(),$container.removeData("timesPlayed"),$(window).off("resize.video"),containerHelper.reset(interaction)},setState:function(interaction,state){var restorePlayerState=function(playerState){playerState&&interaction.mediaElement&&(_.isNumber(playerState.volume)&&interaction.mediaElement.setVolume(playerState.volume),_.isBoolean(playerState.muted)&&(interaction.mediaElement.mute(playerState.muted),interaction.mediaElement.startMuted=playerState.muted),playerState.position&&0<playerState.position&&(interaction.mediaElement.seek(playerState.position),!interaction.attr("autostart")&&interaction.mediaElement.pause()))};_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isPlainObject(state.player)&&interaction.mediaElement&&(interaction.mediaElement.is("ready")?restorePlayerState(state.player):interaction.mediaElement.on("ready.state",function(){interaction.mediaElement.off("ready.state"),restorePlayerState(state.player)})))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),interaction.mediaElement&&(state.player={position:interaction.mediaElement.getPosition(),muted:interaction.mediaElement.is("muted"),volume:interaction.mediaElement.getVolume()}),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program9(){return"horizontal"}function program13(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program15(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program17(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program19(){return"icon-down"}function program21(){return"icon-right"}function program23(){return"icon-up"}function program25(){return"icon-left"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-orderInteraction",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(5,function(){return" qti-vertical"},data),fn:self.program(3,function(){return" qti-horizontal"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"\n     data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n     data-qti-class=\"orderInteraction\"\n     data-orientation=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(11,function(){return"vertical"},data),fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"order-interaction-area\">\n        <ul class=\"choice-area square source solid block-listing ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n            ",options={hash:{},inverse:self.noop,fn:self.program(17,program17,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(17,program17,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n        <div class=\"arrow-bar middle\">\n            <span class=\"icon-add-to-selection ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(21,program21,data),fn:self.program(19,program19,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"></span>\n            <span class=\"icon-remove-from-selection ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(25,program25,data),fn:self.program(23,program23,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" inactive\"></span>\n        </div>\n        <ul class=\"drag-container block-listing\"></ul>\n        <ul class=\"result-area decimal target solid block-listing ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n        </ul>\n        <div class=\"arrow-bar\">\n            <span class=\"icon-move-before ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(23,program23,data),fn:self.program(25,program25,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" inactive\"></span>\n            <span class=\"icon-move-after ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(19,program19,data),fn:self.program(21,program21,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" inactive\"></span>\n        </div>\n    </div>\n    <div class=\"notification-container\"></div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",["lodash","jquery","i18n","core/mouseEvent","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","interact","ui/interactUtils"],function(_,$,__,triggerMouseEvent,tpl,containerHelper,instructionMgr,pciResponse,interact,interactUtils){'use strict';var _freezeSize=function($container){var $orderArea=$container.find(".order-interaction-area");$orderArea.height($orderArea.height())},_setInstructions=function(interaction){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container),min=parseInt(interaction.attr("minChoices"),10),max=parseInt(interaction.attr("maxChoices"),10);if(min&&instructionMgr.appendInstruction(interaction,__("You must use at least %d choices",min),function(){$resultArea.find(">li").length>=min?this.setLevel("success"):this.reset()}),max&&max<_.size(interaction.getChoices())){var instructionMax=instructionMgr.appendInstruction(interaction,__("You can use maximum %d choices",max),function(){$resultArea.find(">li").length>=max?($choiceArea.find(">li").addClass("deactivated"),this.setMessage(__("Maximum choices reached"))):($choiceArea.find(">li").removeClass("deactivated"),this.reset())});interact($choiceArea.selector+" >li.deactivated").on("tap",function(e){var $target=$(e.currentTarget);$target.addClass("brd-error"),instructionMax.setLevel("warning",2e3),setTimeout(function(){$target.removeClass("brd-error")},150)}),interact($choiceArea.selector+" >li.deactivated").draggable({onstart:function onstart(e){var $target=$(e.target);$target.addClass("brd-error"),instructionMax.setLevel("warning")},onend:function onend(e){var $target=$(e.target);$target.removeClass("brd-error"),instructionMax.setLevel("info")}}).styleCursor(!1)}},resetResponse=function(interaction){var $container=containerHelper.get(interaction),initialOrder=_.keys(interaction.getChoices()),$choiceArea=$(".choice-area",$container).append($(".result-area>li",$container)),$choices=$choiceArea.children(".qti-choice");$container.find(".qti-choice.active").each(function(){interactUtils.tapOn(this)}),$choices.detach().sort(function(choice1,choice2){return _.indexOf(initialOrder,$(choice1).data("serial"))>_.indexOf(initialOrder,$(choice2).data("serial"))}),$choiceArea.prepend($choices)},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),response=[];return $(".result-area>li",$container).each(function(){response.push($(this).data("identifier"))}),response};return{qtiClass:"orderInteraction",getData:function getCustomData(interaction,data){return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation")})},template:tpl,render:function render(interaction){function _iFrameDragFix(draggableSelector,target){interactUtils.iFrameDragFixOn(function(){_isDropzoneVisible()&&interact($resultArea.selector).fire({type:"drop",target:$dropzoneElement.eq(0),relatedTarget:target}),interact(draggableSelector).fire({type:"dragend",target:target})})}function _isDropzoneVisible(){return $.contains($container.get(0),$dropzoneElement.get(0))}function _insertDropzone($dragged){var draggedMiddle=_getMiddleOf($dragged),previousMiddle={x:0,y:0},insertPosition;$(resultSelector).each(function(index){var currentMiddle=_getMiddleOf($(this));if("horizontal"!==orientation){if(draggedMiddle.y>previousMiddle.y&&draggedMiddle.y<currentMiddle.y)return insertPosition=index,!1;previousMiddle.y=currentMiddle.y}else{if(draggedMiddle.x>previousMiddle.x&&draggedMiddle.x<currentMiddle.x)return insertPosition=index,!1;previousMiddle.x=currentMiddle.x}}),"undefined"==typeof insertPosition?$resultArea.append($dropzoneElement):$(resultSelector).eq(insertPosition).before($dropzoneElement),$dropzoneElement.height($dragged.height()),$dropzoneElement.find("div").text($dragged.text())}function _adjustDropzonePosition($dragged){var draggedBox=$dragged.get(0).getBoundingClientRect(),$prevResult=$dropzoneElement.prev(".qti-choice"),$nextResult=$dropzoneElement.next(".qti-choice"),prevMiddle=!!(0<$prevResult.length)&&_getMiddleOf($prevResult),nextMiddle=!!(0<$nextResult.length)&&_getMiddleOf($nextResult);"horizontal"===orientation?(prevMiddle&&draggedBox.left<prevMiddle.x&&$prevResult.before($dropzoneElement),nextMiddle&&draggedBox.right>nextMiddle.x&&$nextResult.after($dropzoneElement)):(prevMiddle&&draggedBox.top<prevMiddle.y&&$prevResult.before($dropzoneElement),nextMiddle&&draggedBox.bottom>nextMiddle.y&&$nextResult.after($dropzoneElement))}function _getMiddleOf($element){var elementBox=$element.get(0).getBoundingClientRect();return{x:elementBox.left+elementBox.width/2,y:elementBox.top+elementBox.height/2}}var $container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$iconAdd=$container.find(".icon-add-to-selection"),$iconRemove=$container.find(".icon-remove-from-selection"),$iconBefore=$container.find(".icon-move-before"),$iconAfter=$container.find(".icon-move-after"),$activeChoice=null,choiceSelector=$choiceArea.selector+" >li:not(.deactivated)",resultSelector=$resultArea.selector+" >li",$dragContainer=$container.find(".drag-container"),orientation=interaction.attr("orientation")?interaction.attr("orientation"):"vertical",_activeControls=function(){$iconAdd.addClass("inactive"),$iconRemove.removeClass("inactive").addClass("active"),$iconBefore.removeClass("inactive").addClass("active"),$iconAfter.removeClass("inactive").addClass("active")},_resetControls=function(){$iconAdd.removeClass("inactive"),$iconRemove.removeClass("active").addClass("inactive"),$iconBefore.removeClass("active").addClass("inactive"),$iconAfter.removeClass("active").addClass("inactive")},_setSelection=function($choice){$activeChoice&&$activeChoice.removeClass("active"),$activeChoice=$choice,$activeChoice.addClass("active")},_resetSelection=function(){$activeChoice&&($activeChoice.removeClass("active"),$activeChoice=null),_resetControls()},_addChoiceToSelection=function($target,position){var $results=$(resultSelector);_resetSelection(),"undefined"!=typeof position&&position<$results.length?$results.eq(position).before($target):$resultArea.append($target),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},_toggleResultSelection=function($target){$target.hasClass("active")?_resetSelection():(_setSelection($target),_activeControls())},_removeChoice=function(){$activeChoice&&($choiceArea.append($activeChoice),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)),_resetSelection()},_moveResultBefore=function(){var $prev=$activeChoice.prev();$prev.length&&($prev.before($activeChoice),containerHelper.triggerResponseChangeEvent(interaction))},_moveResultAfter=function(){var $next=$activeChoice.next();$next.length&&($next.after($activeChoice),containerHelper.triggerResponseChangeEvent(interaction))},scaleX,scaleY,isDragAndDropEnabled,dragOptions,$dropzoneElement;interact($container.selector).on("tap",function(){_resetSelection()}),interact(choiceSelector).on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),$iconAdd.addClass("triggered"),setTimeout(function(){$iconAdd.removeClass("triggered")},150),_addChoiceToSelection($target))}),interact(resultSelector).on("tap",function(e){var $target=$(e.currentTarget);$target.closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_toggleResultSelection($target))}),interact($iconRemove.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_removeChoice())}),interact($iconBefore.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_moveResultBefore())}),interact($iconAfter.selector).on("tap",function(e){$(e.currentTarget).closest(".qti-item").hasClass("prevent-click-handler")||(e.stopPropagation(),_moveResultAfter())}),this.getOption&&this.getOption("enableDragAndDrop")&&this.getOption("enableDragAndDrop").order&&(isDragAndDropEnabled=this.getOption("enableDragAndDrop").order),isDragAndDropEnabled&&($dropzoneElement=$("<li>",{class:"dropzone qti-choice"}),$("<div>",{class:"qti-block"}).appendTo($dropzoneElement),dragOptions={inertia:!1,autoScroll:!0,restrict:{restriction:".qti-interaction",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}}},interact(choiceSelector).draggable(_.assign({},dragOptions,{onstart:function onstart(e){var $target=$(e.target),scale;$target.addClass("dragged"),_iFrameDragFix(choiceSelector,e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){var $target=$(e.target);interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY),_isDropzoneVisible()&&_adjustDropzonePosition($target)},onend:function onend(e){var $target=$(e.target);$target.removeClass("dragged"),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact(resultSelector).draggable(_.assign({},dragOptions,{onstart:function onstart(e){var $target=$(e.target),scale;$target.addClass("dragged"),_setSelection($target),$dragContainer.show(),$dragContainer.offset($target.offset()),"horizontal"===orientation?$dragContainer.width($(e.currentTarget).width()):$dragContainer.width($target.parent().width()),$dragContainer.append($target),_iFrameDragFix(resultSelector,e.target),scale=interactUtils.calculateScale(e.target),scaleX=scale[0],scaleY=scale[1]},onmove:function onmove(e){var $target=$(e.target);interactUtils.moveElement(e.target,e.dx/scaleX,e.dy/scaleY),_isDropzoneVisible()&&_adjustDropzonePosition($target)},onend:function onend(e){var $target=$(e.target),hasBeenDroppedInResultArea=$target.parent===$resultArea;$target.removeClass("dragged"),$dragContainer.hide(),hasBeenDroppedInResultArea||_removeChoice(),interactUtils.restoreOriginalPosition($target),interactUtils.iFrameDragFixOff()}})).styleCursor(!1),interact($resultArea.selector).dropzone({overlap:.5,ondragenter:function ondragenter(e){var $dragged=$(e.relatedTarget);_insertDropzone($dragged),$dragged.addClass("droppable")},ondrop:function ondrop(e){var $dragged=$(e.relatedTarget),dropzoneIndex=$(resultSelector).index($dropzoneElement);this.ondragleave(e),_addChoiceToSelection($dragged,dropzoneIndex),interactUtils.restoreOriginalPosition($dragged)},ondragleave:function ondragleave(e){var $dragged=$(e.relatedTarget);$dropzoneElement.remove(),$dragged.removeClass("droppable")}})),_setInstructions(interaction),$(document).on("attributeChange.qti-widget.commonRenderer",function(e,data){data.element.getSerial()===interaction.getSerial()&&("maxChoices"===data.key||"minChoices"===data.key)&&(instructionMgr.removeInstructions(interaction),_setInstructions(interaction),instructionMgr.validateInstructions(interaction))}),_freezeSize($container)},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container);if(null===response||_.isEmpty(response))resetResponse(interaction);else try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$resultArea.append($choiceArea.find("[data-identifier="+identifier+"]"))})}catch(e){throw new Error("wrong response format in argument : "+e)}instructionMgr.validateInstructions(interaction)},getResponse:function getResponse(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},resetResponse:resetResponse,destroy:function destroy(interaction){var $container=containerHelper.get(interaction);[".choice-area >li:not(.deactivated)",".result-area >li",".icon-add-to-selection",".icon-remove-from-selection",".icon-move-before",".icon-move-after"].forEach(function(selector){interact($container.find(selector).selector).unset()}),$(document).off(".commonRenderer"),$container.find(".order-interaction-area").removeAttr("style"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:aIndex<bIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState:function(interaction){var state={},response=interaction.getResponse(),$container;return response&&(state.response=response),!0===interaction.attr("shuffle")&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state}}}),define("qtiCustomInteractionContext",[],function(){'use strict';return window._pciHooks=window._pciHooks||{},{register:function register(pciHook){var typeIdentifier="function"==typeof pciHook.getTypeIdentifier?pciHook.getTypeIdentifier():pciHook.typeIdentifier;if(typeIdentifier)window._pciHooks[typeIdentifier]=pciHook;else throw new Error("invalid PCI hook")},notifyReady:function notifyReady(){},notifyDone:function notifyDone(){},onready:function(){},ondone:function(){},createPciInstance:function createPciInstance(pciTypeIdentifier){if(window._pciHooks[pciTypeIdentifier]){var instance={},proto=window._pciHooks[pciTypeIdentifier];for(var name in proto)instance[name]="function"==typeof proto[name]?proto[name]:null!==proto[name]&&"object"===_typeof2(proto[name])?proto[name].constructor():proto[name];return instance}throw new Error("no portable custom interaction hook found with the id "+pciTypeIdentifier)}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator",["qtiCustomInteractionContext"],function(qtiCustomInteractionContext){'use strict';return{getPci:function(interaction){var pci=interaction.data("pci"),pciTypeIdentifier;if(!pci)if(pciTypeIdentifier=interaction.typeIdentifier,pci=qtiCustomInteractionContext.createPciInstance(pciTypeIdentifier),pci)interaction.data("pci",pci),pci._taoCustomInteraction=interaction;else throw new Error("no custom interaction hook found for the type "+pciTypeIdentifier);return pci}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/common",["lodash","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator"],function(_,containerHelper,instanciator){'use strict';return function(runtime){return{getRequiredModules:function(){var requireEntries=[];return runtime.hook&&requireEntries.push(runtime.hook.replace(/\.js$/,"")),_.forEach(runtime.libraries,function(lib){requireEntries.push(lib.replace(/\.js$/,""))}),_.forEach(runtime.stylesheets,function(stylesheet){requireEntries.push("css!"+stylesheet.replace(/\.css$/,""))}),requireEntries},createInstance:function createInstance(interaction,context){var id=interaction.attr("responseIdentifier"),pci=instanciator.getPci(interaction),properties=_.clone(interaction.properties),assetManager=context.assetManager;pci.initialize(id,containerHelper.get(interaction).children().get(0),properties,{resolve:function(url){var resolved=assetManager.resolveBy("portableElementLocation",url);return resolved===url||_.isUndefined(resolved)?assetManager.resolve(url):resolved}})},destroy:function(interaction){return instanciator.getPci(interaction).destroy()},setState:function(interaction,state){instanciator.getPci(interaction).setSerializedState(state)},getState:function(interaction){return instanciator.getPci(interaction).getSerializedState()}}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims",["lodash","core/logger","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator"],function(_,loggerFactory,containerHelper,instanciator){'use strict';var logger=loggerFactory("taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims"),pciReadyCallback=function(pci){logger.info("pciReadyCallback called on PCI "+pci.typeIdentifier)},pciDoneCallback=function(pci){logger.info("pciDoneCallback called on PCI "+pci.typeIdentifier)};return function(runtime){return{getRequiredModules:function(){var requireEntries=[];return _.forEach(runtime.modules,function(module,name){requireEntries.push(name)}),requireEntries},createInstance:function(interaction,context){var pci=instanciator.getPci(interaction),properties=_.clone(interaction.properties),config;_.forOwn(properties,function(propVal,propKey){properties[propKey]=_.isArray(propVal)||_.isObject(propVal)?JSON.stringify(propVal):propVal}),config={properties:properties,templateVariables:{},boundTo:context.response||{},onready:pciReadyCallback,ondone:pciDoneCallback,status:"interacting"},pci.getInstance(containerHelper.get(interaction).get(0),config,context.state)},destroy:function(interaction){instanciator.getPci(interaction).oncompleted()},setState:_.noop,getState:function(interaction){return instanciator.getPci(interaction).getState()}}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"qti-interaction qti-customInteraction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",["lodash","core/promise","core/logger","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/instanciator","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/common","taoQtiItem/qtiCommonRenderer/renderers/interactions/pci/ims","qtiCustomInteractionContext","taoQtiItem/qtiItem/helper/util","taoQtiItem/portableElementRegistry/ciRegistry"],function(_,Promise,loggerFactory,tpl,containerHelper,PortableElement,instanciator,commonPciRenderer,imsPciRenderer,qtiCustomInteractionContext,util,ciRegistry){'use strict';var _setPciModel=function(interaction,runtime){var pciRenderer;pciRenderer="IMSPCI"===runtime.model?imsPciRenderer(runtime):commonPciRenderer(runtime),interaction.data("pci-model",runtime.model),interaction.data("pci-renderer",pciRenderer)},_getPciRenderer=function(interaction){return interaction.data("pci-renderer")};return{qtiClass:"customInteraction",template:tpl,getData:function getData(customInteraction,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:function(interaction,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var id=interaction.attr("responseIdentifier"),typeIdentifier=interaction.typeIdentifier,assetManager=self.getAssetManager(),response={},state;options.state&&options.state[id]&&(state=options.state[id]),response[id]={base:null},ciRegistry.loadRuntimes({include:[typeIdentifier]}).then(function(){var runtime=ciRegistry.getRuntime(typeIdentifier),pciRenderer;return runtime?void(_setPciModel(interaction,runtime),pciRenderer=_getPciRenderer(interaction),require(pciRenderer.getRequiredModules(),function(){var pci=instanciator.getPci(interaction);return pci?(pciRenderer.createInstance(interaction,{response:response,state:state,assetManager:assetManager}),_.isFunction(pci.on)&&interaction.onPci("responseChange",function(){containerHelper.triggerResponseChangeEvent(interaction)}),resolve()):reject("Unable to initialize pci \""+id+"\"")},reject)):reject("The runtime for the pci cannot be found : "+typeIdentifier)}).catch(function(error){reject("Error loading runtime \""+id+"\": "+error)})})},getContainer:containerHelper.get,setResponse:function(interaction,response){instanciator.getPci(interaction).setResponse(response)},getResponse:function(interaction){return instanciator.getPci(interaction).getResponse()},resetResponse:function(interaction){instanciator.getPci(interaction).resetResponse()},destroy:function(interaction){return _getPciRenderer(interaction).destroy(interaction)},getState:function(interaction){return _getPciRenderer(interaction).getState(interaction)},setState:function(interaction,serializedState){_getPciRenderer(interaction).setState(interaction,serializedState)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"qti-prompt-container\" data-html-editable-container",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div class=\"qti-prompt\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-html-editable>",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"prompt",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-graphicInteraction qti-selectPointInteraction clearfix",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"instruction-container\"></div>\n    <div class=\"image-editor solid\">\n        <div id='graphic-paper-",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"' class=\"main-image-box\"></div>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){'use strict';var getRawResponse=function(interaction){return interaction&&interaction.paper&&_.isArray(interaction.paper.points)?_.map(interaction.paper.points,function(point){return[point.x,point.y]}):[]},addPoint=function(interaction,point){var maxChoices=interaction.attr("maxChoices"),pointChange=function(){containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)};0<maxChoices&&getRawResponse(interaction).length>=maxChoices?instructionMgr.validateInstructions(interaction):(!_.isArray(interaction.paper.points)&&(interaction.paper.points=[]),graphic.createTarget(interaction.paper,{point:point,create:function(target){interaction.isTouch&&target&&target.getBBox&&graphic.createTouchCircle(interaction.paper,target.getBBox()),interaction.paper.points.push(point),pointChange()},remove:function(){_.remove(interaction.paper.points,point),pointChange()}}))},enableSelection=function(interaction){var $container=containerHelper.get(interaction),$imageBox=$container.find(".main-image-box"),isResponsive=$container.hasClass("responsive"),image=interaction.paper.getById("bg-image-"+interaction.serial);interaction.paper.isTouch=!1,image.touchstart(function(){interaction.paper.isTouch=!0,image.untouchstart()}),image.click(function(event){addPoint(interaction,graphic.getPoint(event,interaction.paper,$imageBox,isResponsive))})};return{qtiClass:"selectPointInteraction",template:tpl,render:function(interaction){var self=this;return new Promise(function(resolve){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),enableSelection(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),choiceCount:!1,getResponse:getRawResponse,onError:function onError(data){data&&graphic.highlightError(data.target,"success")}})})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var responseValues;if(response&&interaction.paper)try{responseValues=pciResponse.unserialize(response,interaction),"single"===interaction.getResponseDeclaration().attr("cardinality")&&(responseValues=[responseValues]),_(responseValues).filter(function(point){return _.isArray(point)&&2===point.length}).forEach(function(point){addPoint(interaction,{x:point[0],y:point[1]})})}catch(err){}},getResponse:function getResponse(interaction){return pciResponse.serialize(getRawResponse(interaction),interaction)},resetResponse:function(interaction){interaction&&interaction.paper&&(interaction.paper.points=[],interaction.paper.forEach(function(element){var point=element.data("point");"object"===_typeof2(point)&&graphic.trigger(element,"click")}))},destroy:function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program7(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-blockInteraction qti-sliderInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"sliderInteraction\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" >\r\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n    <div class=\"instruction-container\"></div>\r\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","nouislider"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){'use strict';var _slideTo=function(options){options.sliderCurrentValue.find(".qti-slider-cur-value").text(options.value),options.sliderValue.val(options.value)},_getRawResponse=function(interaction){var attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),min=parseInt(attributes.lowerBound),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),value;return"integer"===baseType?value=parseInt($sliderValue.val()):"float"===baseType&&(value=parseFloat($sliderValue.val())),isNaN(value)?min:value};return{qtiClass:"sliderInteraction",template:tpl,render:function render(interaction){var attributes=interaction.getAttributes(),$container=interaction.getContainer(),$el=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider",class:"qti-slider"}),$sliderLabels=$("<div />").attr({class:"qti-slider-values"}),$sliderCurrentValue=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider-cur-value",class:"qti-slider-cur-value"}),$sliderValue=$("<input />").attr({type:"hidden",id:attributes.responseIdentifier+"-qti-slider-value"}),orientation="horizontal",reverse=!!("undefined"!=typeof attributes.reverse&&attributes.reverse),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),step="undefined"!=typeof attributes.step&&attributes.step?parseInt(attributes.step):1,steps=(max-min)/step;$sliderCurrentValue.append("<span class=\"qti-slider-cur-value-text\">"+__("Current value:")+" </span>").append("<span class=\"qti-slider-cur-value\"></span>"),$sliderLabels.append("<span class=\"slider-min\">"+(reverse?max:min)+"</span>").append("<span class=\"slider-max\">"+(reverse?min:max)+"</span>"),interaction.getContainer().append($el).append($sliderLabels).append($sliderCurrentValue).append($sliderValue),"undefined"!=typeof attributes.orientation&&-1<$.inArray(attributes.orientation,["horizontal","vertical"])&&(orientation=attributes.orientation);var sliderSize=0;if("horizontal"===orientation)$container.addClass("qti-slider-horizontal");else{sliderSize=20*steps,sliderSize>300&&(sliderSize=300),$container.addClass("qti-slider-vertical"),$el.height(sliderSize+"px"),$sliderLabels.height(sliderSize+"px")}if("undefined"!=typeof attributes.stepLabel&&attributes.stepLabel){var middleStep=parseInt(steps/2),leftOffset=100/steps*middleStep,middleValue=reverse?max-middleStep*step:min+middleStep*step;"horizontal"===orientation?$sliderLabels.find(".slider-min").after("<span class=\"slider-middle\" style=\"left:"+leftOffset+"%\">"+middleValue+"</span>"):$sliderLabels.find(".slider-min").after("<span class=\"slider-middle\" style=\"top:"+leftOffset+"%\">"+middleValue+"</span>")}$el.noUiSlider({start:reverse?max:min,range:{min:min,max:max},step:step,orientation:orientation}).on("slide",function(){var val=parseInt($(this).val());interaction.attr("reverse")&&(val=max+min-val),val=Math.round(1e3*val)/1e3,_slideTo({value:val,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),containerHelper.triggerResponseChangeEvent(interaction)}),_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue})},getContainer:containerHelper.get,setResponse:function setResponse(interaction,response){var attributes=interaction.getAttributes(),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),value;value=pciResponse.unserialize(response,interaction)[0],_slideTo({value:value,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(interaction.attr("reverse")?max+min-value:value)},getResponse:function getResponse(interaction){return pciResponse.serialize([_getRawResponse(interaction)],interaction)},resetResponse:function resetResponse(interaction){var attributes=interaction.getAttributes(),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),reverse=!!("undefined"!=typeof attributes.reverse&&attributes.reverse),startValue=reverse?max:min;_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(startValue)},destroy:function destroy(interaction){var $container=interaction.getContainer();$container.empty(),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<input ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-interaction qti-inlineInteraction qti-textEntryInteraction",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"textEntryInteraction\" type=\"text\">",buffer})}),define("util/locale",["module","moment"],function(module,moment){'use strict';module=module&&module.hasOwnProperty("default")?module["default"]:module,moment=moment&&moment.hasOwnProperty("default")?moment["default"]:moment;var configuration=module.config(),locale={getConfig:function(){return configuration},setConfig:function(config){configuration=config||{}},getDecimalSeparator:function(){return this.getConfig()&&this.getConfig().decimalSeparator?this.getConfig().decimalSeparator:"."},getThousandsSeparator:function(){return this.getConfig()&&this.getConfig().thousandsSeparator?this.getConfig().thousandsSeparator:""},getDateTimeFormat:function(){return this.getConfig()&&this.getConfig().dateTimeFormat?this.getConfig().dateTimeFormat:"DD/MM/YYYY HH:mm:ss"},parseFloat:function(_parseFloat){function parseFloat(){return _parseFloat.apply(this,arguments)}return parseFloat.toString=function(){return _parseFloat.toString()},parseFloat}(function(numStr){var thousandsSeparator=this.getThousandsSeparator(),decimalSeparator=this.getDecimalSeparator();return thousandsSeparator.length&&(numStr=numStr.replace(new RegExp("\\"+thousandsSeparator,"g"),"")),"."!==decimalSeparator&&(numStr=numStr.replace(/\./g,"_").replace(new RegExp("\\"+decimalSeparator,"g"),".")),parseFloat(numStr)}),parseInt:function(_parseInt){function parseInt(){return _parseInt.apply(this,arguments)}return parseInt.toString=function(){return _parseInt.toString()},parseInt}(function(number,numericBase){var thousandsSeparator=this.getThousandsSeparator();return thousandsSeparator.length&&(number=number.replace(new RegExp("\\"+thousandsSeparator,"g"),"")),parseInt(number,numericBase)}),formatDateTime:function(timestamp){return moment(timestamp,"X").format(this.getDateTimeFormat())}};return locale}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/patternMask","util/locale","ui/tooltip"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse,patternMaskHelper,locale,tooltip){'use strict';var hideTooltip=function($input){$input.data("$tooltip")&&$input.data("$tooltip").hide()},showTooltip=function($input,theme,message){if($input.data("$tooltip"))$input.data("$tooltip").updateTitleContent(message);else{var textEntryTooltip=tooltip.create($input,message,{theme:theme,trigger:"manual"});$input.data("$tooltip",textEntryTooltip)}$input.data("$tooltip").show()};return{qtiClass:"textEntryInteraction",template:tpl,render:function(interaction){var attributes=interaction.getAttributes(),$input=interaction.getContainer(),patternMask=interaction.attr("patternMask"),maxChars=parseInt(patternMaskHelper.parsePattern(patternMask,"chars"),10),expectedLength,updateMaxCharsTooltip,updatePatternMaskTooltip;attributes.expectedLength&&(expectedLength=parseInt(attributes.expectedLength)+2,$input.css("width",expectedLength+"ch"),$input.css("min-width",expectedLength+"ch")),attributes.placeholderText&&$input.attr("placeholder",attributes.placeholderText),maxChars?(updateMaxCharsTooltip=function(){var count=$input.val().length,message,messageType;message=count?__("%d/%d",count,maxChars):__("%d characters allowed",maxChars),count>=maxChars?($input.addClass("maxed"),messageType="warning"):($input.removeClass("maxed"),messageType="info"),showTooltip($input,messageType,message)},$input.attr("maxlength",maxChars).on("focus.commonRenderer",function(){updateMaxCharsTooltip()}).on("keyup.commonRenderer",function(){updateMaxCharsTooltip(),containerHelper.triggerResponseChangeEvent(interaction)}).on("blur.commonRenderer",function(){hideTooltip($input)})):attributes.patternMask?(updatePatternMaskTooltip=function(){var regex=new RegExp(attributes.patternMask);hideTooltip($input),$input.val().length&&regex.test($input.val())?$input.removeClass("invalid"):($input.addClass("invalid"),showTooltip($input,"error",__("This is not a valid answer")))},$input.on("focus.commonRenderer",function(){updatePatternMaskTooltip()}).on("keyup.commonRenderer",function(){updatePatternMaskTooltip(),containerHelper.triggerResponseChangeEvent(interaction)}).on("blur.commonRenderer",function(){hideTooltip($input)})):$input.on("keyup.commonRenderer",function(){containerHelper.triggerResponseChangeEvent(interaction)})},getContainer:containerHelper.get,setResponse:function(interaction,response){var responseValue;try{responseValue=pciResponse.unserialize(response,interaction)}catch(e){}responseValue&&responseValue.length&&interaction.getContainer().val(responseValue[0])},getResponse:function(interaction){var ret={base:{}},$input=interaction.getContainer(),attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),numericBase=attributes.base||10,value;return $input.hasClass("invalid")||attributes.placeholderText&&$input.val()===attributes.placeholderText?value="":"integer"===baseType?value=locale.parseInt($input.val(),numericBase):"float"===baseType?value=locale.parseFloat($input.val()):"string"===baseType&&(value=$input.val()),ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value,ret},resetResponse:function(interaction){interaction.getContainer().val("")},destroy:function(interaction){$("input.qti-textEntryInteraction").each(function(index,el){var $input=$(el);$input.data("$tooltip")&&($input.data("$tooltip").dispose(),$input.removeData("$tooltip"))}),$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var buffer="",stack1,helper;return buffer+="accept=\"",(helper=helpers.accept)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.accept,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"qti-interaction qti-blockInteraction qti-uploadInteraction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n\t",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\t<div class=\"instruction-container\"></div>\n    <div class=\"file-upload fixed-grid-row lft\">\n        <div class=\"progressbar\"></div>\n        <span class=\"btn-info small col-4\"></span>\n        <span class=\"file-name placeholder col-8 truncate\"></span>\n        <input type=\"file\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.accept,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n    </div>\n    <div class=\"file-upload-preview lft visible-file-upload-preview runtime-visible-file-upload-preview\">\n        <p class=\"nopreview\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No preview available",options):helperMissing.call(depth0,"__","No preview available",options)))+"</p>\n    </div>\n    <div class=\"file-upload-preview-popup modal\">\n        <div class=\"modal-body\">\n        </div>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",["jquery","lodash","i18n","context","core/mimetype","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/uploadMime","ui/progressbar","ui/previewer","ui/modal","ui/waitForMedia"],function($,_,__,context,mimetype,tpl,containerHelper,instructionMgr,uploadHelper){'use strict';var _Mathceil2=Math.ceil,_Mathmin8=Math.min,_Mathround4=Math.round,_initialInstructions=__("Browse your computer and select the appropriate file."),_readyInstructions=__("The selected file is ready to be sent."),validateFileType=function(file,interaction){var expectedTypes=uploadHelper.getExpectedTypes(interaction,!0),filetype=mimetype.getMimeType(file);return!expectedTypes.length||0<=_.indexOf(expectedTypes,filetype)},getMessageWrongType=function(interaction,userSelectedType,messageWrongType){var types=uploadHelper.getExpectedTypes(interaction),expectedTypeLabels=_.map(_.uniq(types),function(type){var mime=_.find(uploadHelper.getMimeTypes(),{mime:type});return mime?mime.label:type});return messageWrongType&&_.isFunction(messageWrongType)?messageWrongType({userSelectedType:userSelectedType,types:expectedTypeLabels}):__("Wrong type of file. Expected %s. The selected file has the mimetype \"%s\".",expectedTypeLabels.join(__(" or ")),userSelectedType)},_handleSelectedFiles=function(interaction,file,messageWrongType){var $container=containerHelper.get(interaction),filename=file.name,filetype=mimetype.getMimeType(file),reader;return instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions),validateFileType(file,interaction)?void($container.find(".file-name").empty().append(filename),reader=new FileReader,reader.onload=function(e){var base64Data,commaPosition,base64Raw,$previewArea;instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_readyInstructions,function(){this.setLevel("success")}),instructionMgr.validateInstructions(interaction),$container.find(".progressbar").progressbar("value",100),base64Data=e.target.result,commaPosition=base64Data.indexOf(","),base64Raw=base64Data.substring(commaPosition+1),interaction.data("_response",{base:{file:{data:base64Raw,mime:filetype,name:filename}}}),$previewArea=$container.find(".file-upload-preview"),$previewArea.previewer({url:base64Data,name:filename,mime:filetype}),$previewArea.waitForMedia(function(){var $originalImg=$previewArea.find("img"),$largeDisplay=$(".file-upload-preview-popup"),$item=$(".qti-item"),itemWidth=$item.width(),winWidth=$(window).width()-80,fullHeight=$("body").height(),imgNaturalWidth,isOversized,modalWidth;$originalImg.length&&(imgNaturalWidth=$originalImg[0].naturalWidth,isOversized=imgNaturalWidth>itemWidth,modalWidth=_Mathmin8(winWidth,imgNaturalWidth),$previewArea.toggleClass("clickable",isOversized),isOversized&&$previewArea.on("click",function(){var $modalBody;$(".upload-ia-modal-bg").remove(),$modalBody=$largeDisplay.find(".modal-body"),$modalBody.empty().append($originalImg.clone()),$largeDisplay.on("opened.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","hidden"),$largeDisplay.css({width:modalWidth,height:fullHeight,left:(modalWidth-itemWidth-40)/-2})}).on("closed.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","auto")}).modal({modalOverlayClass:"modal-bg upload-ia-modal-bg"})}))})},reader.onloadstart=function(){instructionMgr.removeInstructions(interaction),$container.find(".progressbar").progressbar("value",0)},reader.onprogress=function(e){var percentProgress=_Mathceil2(100*(_Mathround4(e.loaded)/_Mathround4(e.total)));$container.find(".progressbar").progressbar("value",percentProgress)},reader.readAsDataURL(file)):(instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,getMessageWrongType(interaction,filetype,messageWrongType),function(){this.setLevel("error")}),void instructionMgr.validateInstructions(interaction))},_resetGui=function(interaction){var $container=containerHelper.get(interaction);$container.find(".file-name").text(__("No file selected")),$container.find(".btn-info").text(__("Browse..."))};return{qtiClass:"uploadInteraction",template:tpl,render:function(interaction){var self=this,$container=containerHelper.get(interaction),changeListener,$input;if(_resetGui(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions),interaction.data("_response",{base:null}),changeListener=function(e){var file=e.target.files[0];"undefined"!=typeof file&&_handleSelectedFiles(interaction,file,self.getCustomMessage("upload","wrongType"))},$input=$container.find("input"),$container.find(".progressbar").progressbar(),!window.FileReader)throw new Error("FileReader API not supported! Please use a compliant browser!");$input.bind("change",changeListener),$input.bind("mousedown",function(e){return e.preventDefault(),$(this).blur(),!1})},getContainer:containerHelper.get,setResponse:function(interaction,response){var $container=containerHelper.get(interaction),filename;null!==response.base&&(filename="undefined"==typeof response.base.file.name?"previously-uploaded-file":response.base.file.name,$container.find(".file-name").empty().text(filename)),interaction.data("_response",response)},getResponse:function(interaction){return interaction.data("_response")},resetResponse:function(interaction){_resetGui(interaction)},destroy:function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState:function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState:function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},getData:function(interaction,data){return _.merge(data||{},{accept:uploadHelper.getExpectedTypes(interaction,!0).join(",")})},resetGui:_resetGui}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program5(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"qti-item tao-scope runtime\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-itemBody ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    <div id=\"modalFeedbacks\"></div>\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Item",["tpl!taoQtiItem/qtiCommonRenderer/tpl/item","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler"],function(tpl,containerHelper,itemStylesheetHandler){'use strict';return{qtiClass:"assessmentItem",template:tpl,getContainer:containerHelper.get,render:function(item){containerHelper.targetBlank(containerHelper.get(item)),itemStylesheetHandler.attach(item.stylesheets)},destroy:function(item){containerHelper.clear(),item.stylesheets&&itemStylesheetHandler.detach(item.stylesheets)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/math",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="<span data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"math\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="><math display=\"block\">",(helper=helpers.raw)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.raw,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</math></span>",buffer}function program2(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program4(depth0,data){var buffer="",stack1,helper;return buffer+="<span data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"math\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="><math>",(helper=helpers.raw)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.raw,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</math></span>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.block,{hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Math",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/math","taoQtiItem/qtiCommonRenderer/helpers/container","mathJax"],function(_,Promise,tpl,containerHelper,MathJax){'use strict';return"undefined"!=typeof MathJax&&MathJax&&(MathJax.Hub.processSectionDelay=0),{qtiClass:"math",template:tpl,getContainer:containerHelper.get,render:function(math){return new Promise(function(resolve){"undefined"!=typeof MathJax&&MathJax?(!window.MathJax&&(window.MathJax=MathJax),_.defer(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,containerHelper.get(math).parent()[0]]),MathJax.Hub.Queue(resolve)})):resolve()})}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program5(depth0){var buffer="",stack1;return buffer+="<h2 class=\"qti-title modal-title\">"+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.title),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</h2>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div id=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" class=\"",stack1=helpers.unless.call(depth0,depth0&&depth0.inline,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"modal "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-modalFeedback ",(helper=helpers.feedbackStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.feedbackStyle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.title),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"modal-body\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiItem/helper/container",["lodash","jquery"],function(_,$){'use strict';function _checkContainerType(element){if(_.isFunction(element.initContainer)&&_.isFunction(element.body))return!0;throw"the element is not of a container type"}function _getBodyDom(element){if(_checkContainerType(element))return $("<div>").html(element.body()).find(".x-tao-wrapper")}function _setBodyDomClass(element,newClass,oldClass){if(_checkContainerType(element)&&(oldClass||newClass)){var $wrapper=$("<div>").html(element.body());_setDomClass($wrapper,newClass,oldClass),element.body($wrapper.html())}}function _setDomClass($wrapper,newClass,oldClass){var $bodyDom=$wrapper.find(".x-tao-wrapper");$bodyDom.length||($wrapper.wrapInner("<div class=\"x-tao-wrapper\">"),$bodyDom=$wrapper.find(".x-tao-wrapper")),oldClass&&$bodyDom.removeClass(oldClass),newClass&&$bodyDom.addClass(newClass)}function _getEncodedDataString(dataName,value){return dataName&&value?"x-tao-"+dataName+"-"+value:""}function getEncodedData(element,dataName){var $body=_getBodyDom(element),regex,matches;if(dataName&&$body&&$body.length&&$body.attr("class")&&(regex=new RegExp("x-tao-"+dataName+"-([a-zA-Z0-9-._]*)"),matches=$body.attr("class").match(regex),matches))return matches[1]}return{setEncodedData:function(element,dataName,newValue){var oldValue=getEncodedData(element,dataName);return _setBodyDomClass(element,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue))},hasEncodedData:function(element,dataName,value){var $body=_getBodyDom(element);return!!($body&&$body.length&&dataName&&value)&&$body.hasClass(_getEncodedDataString(dataName,value))},getEncodedData:getEncodedData,removeEncodedData:function(element,dataName){var oldValue=getEncodedData(element,dataName);dataName&&oldValue&&_setBodyDomClass(element,"",_getEncodedDataString(dataName,oldValue))},setEncodedDataToDom:function($wrapper,dataName,newValue,oldValue){_setDomClass($wrapper,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue))}}}),define("taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiItem/helper/container","ui/waitForMedia","ui/modal"],function(_,tpl,containerHelper,coreContainerHelper){'use strict';var modalFeedbackRenderer={qtiClass:"modalFeedback",template:tpl,getContainer:containerHelper.get,width:600,getData:function getData(fb,data){return data.feedbackStyle=coreContainerHelper.getEncodedData(fb,"modalFeedback"),data},render:function render(modalFeedback,data){var $modal=containerHelper.get(modalFeedback);$modal.waitForMedia(function(){$modal.on("opened.modal",function(){var $itemBody=containerHelper.get(modalFeedback.getRootElement()).children(".qti-itemBody"),requiredHeight=$modal.outerHeight()+parseInt($modal.css("top"));requiredHeight>$itemBody.height()&&$itemBody.height(requiredHeight)}).on("closed.modal",function(){data=data||{},_.isFunction(data.callback)&&data.callback.call(this)}).modal({startClosed:!1,minHeight:modalFeedbackRenderer.minHeight,width:modalFeedbackRenderer.width})})}};return modalFeedbackRenderer}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"qti-object-container\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" >\n</div>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Object",["tpl!taoQtiItem/qtiCommonRenderer/tpl/object","taoQtiItem/qtiCommonRenderer/helpers/container","ui/previewer"],function(tpl,containerHelper){'use strict';return{qtiClass:"object",template:tpl,getContainer:containerHelper.get,render:function render(obj){var $container=containerHelper.get(obj),previewOptions={url:obj.renderer.resolveUrl(obj.attr("data")),mime:obj.attr("type")};obj.attr("height")&&(previewOptions.height=obj.attr("height")),obj.attr("width")&&(previewOptions.width=obj.attr("width")),previewOptions.url&&previewOptions.mime&&$container.previewer(previewOptions)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program3(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"qti-infoControl",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("qtiInfoControlContext",[],function(){window._picHooks=window._picHooks||{};return{register:function register(picHook){window._picHooks[picHook.getTypeIdentifier()]=picHook},notifyReady:function notifyReady(){},createPciInstance:function createPciInstance(typeIdentifier){if(window._picHooks[typeIdentifier]){var instance={},proto=window._picHooks[typeIdentifier];for(var name in proto)instance[name]="function"==typeof proto[name]?proto[name]:null!==proto[name]&&"object"===_typeof2(proto[name])?proto[name].constructor():proto[name];return instance}throw"no portable info control hook found with the id "+typeIdentifier}}}),define("taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","qtiInfoControlContext","taoQtiItem/qtiItem/helper/util","taoQtiItem/portableElementRegistry/icRegistry"],function(_,Promise,tpl,containerHelper,PortableElement,qtiInfoControlContext,util,icRegistry){'use strict';var _getPic=function(infoControl){var pic=infoControl.data("pic")||void 0,typeIdentifier;if(!pic)if(typeIdentifier=infoControl.typeIdentifier,pic=qtiInfoControlContext.createPciInstance(typeIdentifier),pic)infoControl.data("pic",pic),pic._taoInfoControl=infoControl;else throw"no custom infoControl hook found for the type "+typeIdentifier;return pic};return{qtiClass:"infoControl",template:tpl,getData:function getData(infoControl,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:function render(infoControl,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var state={},id=infoControl.attr("id"),typeIdentifier=infoControl.typeIdentifier,config=infoControl.properties,$dom=containerHelper.get(infoControl).children(),assetManager=self.getAssetManager();icRegistry.loadRuntimes().then(function(){var requireEntries=[],runtime=icRegistry.getRuntime(typeIdentifier);return runtime?void(runtime.hook&&requireEntries.push(runtime.hook.replace(/\.js$/,"")),_.forEach(runtime.libraries,function(module){requireEntries.push(module.replace(/\.js$/,""))}),_.forEach(runtime.stylesheets,function(stylesheet){requireEntries.push("css!"+stylesheet.replace(/\.css$/,""))}),require(requireEntries,function(){var pic=_getPic(infoControl);return pic?(pic.initialize(id,$dom[0],config,{resolve:function(url){var resolved=assetManager.resolveBy("portableElementLocation",url);return resolved===url?assetManager.resolveBy("baseUrl",url):resolved}}),pic.setSerializedState(state),resolve()):reject("Unable to initialize pic : "+id)},reject)):reject("The runtime for the pic cannot be found : "+typeIdentifier)}).catch(function(){reject("Error loading runtime : "+id)})})},getContainer:containerHelper.get,destroy:function(infoControl){_getPic(infoControl).destroy()},getState:function(infoControl){return _getPic(infoControl).getSerializedState()},setState:function(infoControl,state){_getPic(infoControl).setSerializedState(state)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/printedVariable",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<span data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"printedVariable\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</span>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable",["tpl!taoQtiItem/qtiCommonRenderer/tpl/printedVariable","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"printedVariable",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n<div class=\"grid-row qti-rubricBlock\" data-use=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.use),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"rubricBlock\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <div class=\"col-12\">\n        <div class=\"qti-rubricBlock-body\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    </div>\n</div>\n",buffer}function program2(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers.unless.call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"rubricBlock",getContainer:containerHelper.get,template:tpl,getData:function(rubric,data){return rubric.isEmpty()&&(data.empty=!0),data}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="media=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.media),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<link \n    href=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.href),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" \n    type=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.type),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" \n    rel=\"stylesheet\" \n    data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.media),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"stylesheet",template:tpl,getContainer:containerHelper.get}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}function program3(depth0){var buffer="",stack1;return buffer+="summary=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.summary),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program5(depth0){var buffer="",stack1;return buffer+=" lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<table\n    class=\"qti-table",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"\n    data-qti-class=\"table\"\n    data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.summary),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    >\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</table>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Table",["tpl!taoQtiItem/qtiCommonRenderer/tpl/table","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){'use strict';return{qtiClass:"table",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="lang=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<span\n    data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n    data-qti-class=\"_tooltip\"\n    data-role=\"tooltip-target\"\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["xml:lang"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</span>",buffer})}),define("taoQtiItem/qtiCommonRenderer/renderers/Tooltip",["tpl!taoQtiItem/qtiCommonRenderer/tpl/tooltip","taoQtiItem/qtiCommonRenderer/helpers/container","ui/tooltip"],function(tpl,containerHelper,tooltip){'use strict';return{qtiClass:"_tooltip",template:tpl,getContainer:containerHelper.get,render:function(tooltipDOM){var $container=containerHelper.get(tooltipDOM),renderedTooltip=tooltip.create($container,tooltipDOM.content(),{theme:"default",placement:"top"});$container.data("$tooltip")&&($container.data("$tooltip").dispose(),$container.removeData("$tooltip")),$container.data("$tooltip",renderedTooltip)}}}),define("tpl!taoQtiItem/qtiCreator/editor/blockAdder/tpl/addColumnRow",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"add-block-element\">\n    <div class=\"line\"></div>\n    <div class=\"circle\" title=\"Insert block below\"><span>+</span></div>\n</div>"})}),define("taoQtiItem/qtiCreator/editor/gridEditor/config",[],function(){"use strict";return{min:{interaction:2,text:1,rubricBlock:12},throttle:{resize:100}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/helper",[],function(){"use strict";var helpers={getColUnits:function($elt){var cssClasses=$elt.attr("class");if(!cssClasses)throw new Error("the element has no css class");var colMatch=cssClasses.match(/col-([\d]+)/);if(colMatch&&colMatch.length)return parseInt(colMatch.pop());throw"the element has no col-* class"},setUnitsFromClass:function($el){var units=helpers.getColUnits($el);return $el.attr("data-units",units),units}};return helpers}),function(e,t){function i(t,n){var u=t.nodeName.toLowerCase(),r,i,o;return"area"===u?(r=t.parentNode,i=r.name,!!(t.href&&i&&"map"===r.nodeName.toLowerCase())&&(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};e.ui.version||(e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function focus(t,n){return"number"==typeof t?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function scrollParent(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return /(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return /(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function zIndex(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r=e(this[0]),i,s;r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(r.css("zIndex"),10),!isNaN(s)&&0!==s))return s;r=r.parent()}return 0},uniqueId:function uniqueId(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function removeUniqueId(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function focusable(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function tabbable(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||0<=n)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===n.offsetHeight,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i="Width"===r?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"==typeof t?this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")}):o["outer"+r].call(this,t)}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=!!t.length,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function disableSelection(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function enableSelection(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function add(t,n,r){var s=e.ui[t].prototype,i;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function call(e,t,n){var i=e.plugins[t],r;if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function hasScroll(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",i=!1;return!!(0<t[r])||(t[r]=1,i=0<t[r],t[r]=0,i)},isOverAxis:function isOverAxis(e,t,n){return e>t&&e<t+n},isOver:function isOver(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}}))}(jQuery),function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position,n;e.position={scrollbarWidth:function scrollbarWidth(){if(n!==t)return n;var s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0],r,i;return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function getScrollInfo(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,s="scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function getWithinInfo(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={},n,l,d,v,m;return 9===w.nodeType?(l=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(l=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",l=d=0,v={top:w.pageY,left:w.pageX}):(l=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;1===e.length&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),S[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),1===E.length&&(E[1]=E[0]),"right"===t.at[0]?m.left+=l:"center"===t.at[0]&&(m.left+=l/2),"bottom"===t.at[1]?m.top+=d:"center"===t.at[1]&&(m.top+=d/2),n=h(S.at,l,d),m.left+=n[0],m.top+=n[1],this.each(function(){var a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight()),o,u;"right"===t.my[0]?C.left-=f:"center"===t.my[0]&&(C.left-=f/2),"bottom"===t.my[1]?C.top-=c:"center"===t.my[1]&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:w,marginTop:x},e.each(["left","top"],function(r,i){e.ui.position[E[r]]&&e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a})}),e.fn.bgiframe&&a.bgiframe(),t.using&&(u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:0>s?"left":0<n?"right":"center",vertical:0>u?"top":0<o?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),d<c&&i(o+u)<d&&(h.vertical="middle"),h.important=r(i(n),i(s))>r(i(o),i(u))?"horizontal":"vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function left(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?0<u&&0>=a?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):0<a&&0>=u?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:0<u?e.left+=u:0<a?e.left-=a:e.left=r(e.left-o,e.left)},top:function top(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?0<u&&0>=a?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):0<a&&0>=u?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:0<u?e.top+=u:0<a?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function left(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,c="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,h=-2*t.offset[0],p,d;0>a?(p=e.left+l+c+h+t.collisionWidth-s-r,(0>p||p<i(a))&&(e.left+=l+c+h)):0<f&&(d=e.left-t.collisionPosition.marginLeft+l+c+h-o,(0<d||i(d)<f)&&(e.left+=l+c+h))},top:function top(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l="top"===t.my[1],c=l?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,h="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1],d,v;0>a?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(0>v||v<i(a))&&(e.top+=c+h+p)):0<f&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(0<d||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function left(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function top(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var o=document.getElementsByTagName("body")[0],u=document.createElement("div"),t,n,r,i,s;for(s in t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"}),r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=10<i&&11>i,t.innerHTML="",n.removeChild(t)}(),!1!==e.uiBackCompat&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return 1===i.length&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),1===s.length&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;null!=(r=t[n]);n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var a=t.split(".")[0],i,s,o,u;t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){for(var i=r.call(arguments,1),s=0,o=i.length,u,a;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u="string"==typeof o,a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var i=e.data(this,s),r;return i?e.isFunction(i[o])&&"_"!==o.charAt(0)?(r=i[o].apply(i,a),r!==i&&r!==t)?(f=r&&r.jquery?f.pushStack(r.get()):r,!1):void 0:e.error("no such method '"+o+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+o+"'")}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function _createWidget(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function remove(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function destroy(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function widget(){return this.element},option:function option(n,r){var i=n,s,o,u;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(i={},s=n.split("."),n=s.shift(),s.length){for(o=i[n]=e.widget.extend({},this.options[n]),u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];if(n=s.pop(),r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}return this._setOptions(i),this},_setOptions:function _setOptions(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function _setOption(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function enable(){return this._setOption("disabled",!1)},disable:function disable(){return this._setOption("disabled",!0)},_on:function _on(t,n,r){var s=this,i;"boolean"!=typeof t&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){return!t&&(!0===s.options.disabled||e(this).hasClass("ui-state-disabled"))?void 0:("string"==typeof o?s[o]:o).apply(s,arguments)}"string"!=typeof o&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function _off(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function _delay(e,t){var r=this;return setTimeout(function(){return("string"==typeof e?r[e]:e).apply(r,arguments)},t||0)},_hoverable:function _hoverable(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function mouseenter(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function mouseleave(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function _focusable(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function focusin(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function focusout(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function _trigger(t,n,r){var o=this.options[t],i,s;if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent,s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&!1===o.apply(this.element[0],[n].concat(r))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var u=i?!0===i||"number"==typeof i?n:i.effect||n:t,o;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||!1!==e.uiBackCompat&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),!1!==e.uiBackCompat&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e){var _Mathabs2=Math.abs,n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function _mouseInit(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function _mouseDestroy(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function _mouseDown(t){if(!n){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=1===t.which,s=!!("string"==typeof this.options.cancel&&t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(i&&!s&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0))}},_mouseMove:function _mouseMove(t){return e.ui.ie&&!(9<=document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function _mouseUp(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function _mouseDistanceMet(e){return Math.max(_Mathabs2(this._mouseDownEvent.pageX-e.pageX),_Mathabs2(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function _mouseDelayMet(){return this.mouseDelayMet},_mouseStart:function _mouseStart(){},_mouseDrag:function _mouseDrag(){},_mouseStop:function _mouseStop(){},_mouseCapture:function _mouseCapture(){return!0}})}(jQuery),define("taoQtiItem/lib/jqueryui_dragdrop",["jquery"],function(jQuery){var _Mathabs3=Math.abs,_Mathmax10=Math.max,_Mathround5=Math.round;(function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function _create(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function _destroy(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function _mouseCapture(t){var n=this.options;return!(this.helper||n.disabled||e(t.target).is(".ui-resizable-handle"))&&(this.handle=this._getHandle(t),!!this.handle&&(e(!0===n.iframeFix?"iframe":n.iframeFix).each(function(){e("<div class=\"ui-draggable-iframeFix\" style=\"background: #fff;\"></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0))},_mouseStart:function _mouseStart(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function _mouseDrag(t,n){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var r=this._uiHash();if(!1===this._trigger("drag",t,r))return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),(e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1)},_mouseStop:function _mouseStop(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);for(var r=this.element[0],i=!1;r&&(r=r.parentNode);)r==document&&(i=!0);if(!i&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!n||"valid"==this.options.revert&&n||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==s._trigger("stop",t)&&s._clear()})}else!1!==this._trigger("stop",t)&&this._clear();return!1},_mouseUp:function _mouseUp(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function cancel(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function _getHandle(t){var n=!(this.options.handle&&e(this.options.handle,this.element).length);return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function _createHelper(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"==n.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"==n.appendTo?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function _getParentOffset(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s="hidden"!=e(r).css("overflow");this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?_Mathmax10(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?_Mathmax10(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function _convertPositionTo(t,n){n||(n=this.position);var r="absolute"==t?1:-1,i=this.options,s="absolute"==this.cssPosition&&(this.scrollParent[0]==document||!e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function _generatePosition(t){var n=this.options,r="absolute"==this.cssPosition&&(this.scrollParent[0]==document||!e.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+_Mathround5((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+_Mathround5((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function _clear(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function _trigger(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function _uiHash(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function start(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function stop(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==r.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function drag(t,n){var r=e(this).data("draggable"),i=this;e.each(r.sortables,function(){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function start(){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function stop(){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function start(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function stop(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function start(){var r=e(this).data("draggable");r.scrollParent[0]!=document&&"HTML"!=r.scrollParent[0].tagName&&(r.overflowOffset=r.scrollParent.offset())},drag:function drag(t){var r=e(this).data("draggable"),i=r.options,s=!1;r.scrollParent[0]!=document&&"HTML"!=r.scrollParent[0].tagName?((!i.axis||"x"!=i.axis)&&(r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed)),(!i.axis||"y"!=i.axis)&&(r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed))):((!i.axis||"x"!=i.axis)&&(t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),(!i.axis||"y"!=i.axis)&&(t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),!1!==s&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function start(){var r=e(this).data("draggable"),i=r.options;r.snapElements=[],e(i.snap.constructor==String?i.snap:i.snap.items||":data(draggable)").each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function drag(t,n){for(var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height,l=r.snapElements.length-1;0<=l;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if("inner"!=i.snapMode){var v=_Mathabs3(p-f)<=s,m=_Mathabs3(d-a)<=s,g=_Mathabs3(c-u)<=s,y=_Mathabs3(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if("outer"!=i.snapMode){var v=_Mathabs3(p-a)<=s,m=_Mathabs3(d-f)<=s,g=_Mathabs3(c-o)<=s,y=_Mathabs3(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||b}}}),e.ui.plugin.add("draggable","stack",{start:function start(){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(i.length){var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function start(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function stop(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})})(jQuery)}),function(e){e.widget("ui.droppable",{version:"1.9.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function _create(){var t=this.options,n=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function _destroy(){for(var t=e.ui.ddmanager.droppables[this.options.scope],n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function _setOption(t,n){"accept"==t&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function _activate(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function _deactivate(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function _over(t){var n=e.ui.ddmanager.current;!n||(n.currentItem||n.element)[0]==this.element[0]||this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function _out(t){var n=e.ui.ddmanager.current;!n||(n.currentItem||n.element)[0]==this.element[0]||this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function _drop(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),!i&&!!this.accept.call(this.element[0],r.currentItem||r.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element)},ui:function ui(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,d=e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);return d;case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return!1;}},e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function prepareOffsets(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var o=0;o<r.length;o++)if(!(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))){for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible="none"!=r[o].element.css("display"),r[o].visible&&("mousedown"==i&&r[o]._activate.call(r[o],n),r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight})}},drop:function drop(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n)))}),r},dragStart:function dragStart(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function drag(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var r=e.ui.intersect(t,this,this.options.tolerance),i=r||1!=this.isover?r&&0==this.isover?"isover":null:"isout";if(i){var s;if(this.options.greedy){var o=this.options.scope,u=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===o});u.length&&(s=e.data(u[0],"droppable"),s.greedyChild="isover"==i?1:0)}s&&"isover"==i&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this["isout"==i?"isover":"isout"]=0,this["isover"==i?"_over":"_out"].call(this,n),s&&"isout"==i&&(s.isout=0,s.isover=1,s._over.call(s,n))}}})},dragStop:function dragStop(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),define("taoQtiItem/qtiCreator/editor/gridEditor/resizable",["lodash","jquery","taoQtiItem/qtiCreator/editor/gridEditor/config","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/lib/jqueryui_dragdrop"],function(_,$,config,helper,qtiElements){"use strict";var _syncHandleHeight=function($row){var h=$row.height()-parseFloat($row.children("[class^=\"col-\"], [class*=\" col-\"]").css("margin-bottom"));$row.find(".grid-edit-resizable-zone").height(h)},_createResizables=function($el){var marginWidth=parseFloat($el.find("[class^=\"col-\"]:last, [class*=\" col-\"]:last").css("margin-left"));$el.find("[class^=\"col-\"], [class*=\" col-\"]").each(function(){var $col=$(this);if($col.parent().hasClass("fixed-grid-row"))return!0;if($col.children(".grid-edit-resizable-zone").length)return!0;var $nextCol=$col.next(),$row=$col.parent(".grid-row"),offset=$col.offset(),min=qtiElements.is($col.data("qti-class"),"interaction")?config.min.interaction:config.min.text,nextMin=qtiElements.is($nextCol.data("qti-class"),"interaction")?config.min.interaction:config.min.text,unitWidth=$row.width()/12,activeHeight=$row.height()-parseFloat($col.css("margin-bottom")),$activeZone=$("<div>",{class:"grid-edit-resizable-zone grid-edit-resizable-zone-active"}).css({top:0,right:-(marginWidth+(20-marginWidth)/2),width:20,height:activeHeight}),$handle=$("<span>",{class:"grid-edit-resizable-handle"});$activeZone.append($handle),$col.append($activeZone);var _syncOutlineHeight=function(){var h=$row.height()-parseFloat($col.css("margin-bottom"));$col.find(".grid-edit-resizable-outline").height(h),$activeZone.height(h)};$activeZone.draggable({containment:$nextCol.length?[offset.left+min*unitWidth-2*marginWidth+10,offset.top,offset.left+$col.outerWidth()+marginWidth+$nextCol.outerWidth()-nextMin*unitWidth-10-10,offset.top+$col.height()]:[offset.left+min*unitWidth-marginWidth-10-10,offset.top,$row.offset().left+$row.outerWidth()-marginWidth-10-12,offset.top+$col.height()],axis:"x",cursor:"col-resize",start:function start(){$col.trigger("resizestart.gridEdit");var $overlay=$("<div>",{class:"grid-edit-resizable-outline"});$nextCol.length?$overlay.width(parseFloat($col.outerWidth())+marginWidth+parseFloat($nextCol.outerWidth())):$overlay.css({width:"100%","border-right-width":0}),$(this).data("overlay",$overlay),$col.append($overlay),$handle.addClass("grid-edit-resizable-active"),$el.find(".grid-edit-resizable-zone-active").removeClass("grid-edit-resizable-zone-active"),_syncOutlineHeight()},drag:_.throttle(function(){var width=$(this).offset().left+10-offset.left,units=helper.getColUnits($col),nextUnits=$nextCol.length?helper.getColUnits($nextCol):0;$nextCol.length||$col.find(".grid-edit-resizable-outline").width($handle.offset().left-offset.left),width+0*marginWidth<(units-1)*unitWidth?(units--,_setColUnits($col,units),$nextCol.length&&(nextUnits++,_setColUnits($nextCol,nextUnits)),_syncOutlineHeight(),$col.trigger("resize.gridEdit")):width+marginWidth+20>(units+1)*unitWidth&&(units++,_setColUnits($col,units),$nextCol.length&&(nextUnits--,_setColUnits($nextCol,nextUnits)),_syncOutlineHeight(),$col.trigger("resize.gridEdit"))},config.throttle.resize),stop:function stop(){$col.find(".grid-edit-resizable-outline").remove(),_deleteResizables($el),_createResizables($el),$col.trigger("resizestop.gridEdit")}}).css("position","absolute")}),$el.off(".gridEdit.resizable").on("dragoverstart.gridEdit.resizable",function(){_deleteResizables($el)}).on("dragoverstop.gridEdit.resizable",function(){_createResizables($el)}).on("contentChange.gridEdit.resizable",".grid-row",function(){_deleteResizables($el),_createResizables($el)})},_deleteResizables=function($el){$el.find(".grid-edit-resizable-zone").remove()},_setColUnits=function($elt,newUnits){if($elt.attr("class").match(/col-([\d]+)/)){var oldUnits=$elt.attr("data-units"),$parentRow=$elt.parent(".grid-row"),totalUnits=$parentRow.attr("data-units");$parentRow.attr("data-units",totalUnits-oldUnits+newUnits),$elt.attr("data-units",newUnits),$elt.removeClass("col-"+oldUnits).addClass("col-"+newUnits)}else throw $.error("the element is not a grid column")};return{create:function create($element){_createResizables($element),$(window).off("resize.qtiEdit.resizable").on("resize.qtiEdit.resizable",function(){_deleteResizables($element),_createResizables($element)})},destroy:function destroy($element,preserveGlobalEvents){_deleteResizables($element),preserveGlobalEvents||$(window).off("resize.qtiEdit.resizable")},syncHandleHeight:function syncHandleHeight($row){$row.hasClass("grid-row")?_syncHandleHeight($row):$row.find(".grid-row").each(function(){_syncHandleHeight($(this))})}}}),define("taoQtiItem/qtiCreator/widgets/helpers/textWrapper",["jquery"],function($){function getSelection(){var selection;return window.getSelection?selection=window.getSelection():document.selection&&(selection=document.selection.createRange()),selection}function containElement(selection,range){if(1===range.commonAncestorContainer.nodeType)for(var selectedChildNodes=range.cloneContents().childNodes,i=0;i<selectedChildNodes.length;i++)if(selectedChildNodes[i].className&&-1<selectedChildNodes[i].className.indexOf("qti-choice"))return!0;return!1}function wrapSelection(wrap){var sel=getSelection();if(sel.rangeCount){var range=sel.getRangeAt(0).cloneRange();if(range.startOffset!==range.endOffset&&range.toString().trim()&&!containElement(sel,range))return range.surroundContents(wrap),sel.removeAllRanges(),sel.addRange(range),!0}return!1}function unwrapSelection($editable){var $wrapper=$editable.find("#selection-wrapper");$editable.trigger("beforeunwrap"),$wrapper.find("[data-role]").remove(),$wrapper.replaceWith(function(){return $(this).html()}),$editable.trigger("unwrapped")}var textWrapper={create:function create($editable){textWrapper.destroy($editable),$editable.on("mouseup.textwrapper",function(e){var $target=$(e.target);if(!($target.hasClass("html-editable-shield")||$target.hasClass("widget-box"))){var $wrapper=$("<span>",{id:"selection-wrapper",class:"inline-text-wrapper"});if(wrapSelection($wrapper[0])){var wrappedText=$wrapper.text().trim();$editable.trigger("wrapped",[$wrapper,wrappedText])}}}).on("mousedown.textwrapper",function(){unwrapSelection($editable)})},destroy:function destroy($editable){unwrapSelection($editable),$editable.off(".textwrapper")},unwrap:function unwrap($editable){unwrapSelection($editable)}};return textWrapper}),define("taoQtiItem/qtiCreator/editor/gridEditor/content",["jquery","lodash","taoQtiItem/qtiCreator/editor/gridEditor/resizable","taoQtiItem/qtiCreator/widgets/helpers/textWrapper"],function($,_,resizable,textWrapper){"use strict";var contentHelper={};return contentHelper.getContent=function(element,opts){var options=_.defaults({inner:!0},opts),$body=options.inner?$(element).clone():$("<div>",{class:"col-fictive content-helper-wrapper"}).append($(element).clone());return contentHelper.destroyGridWidgets($body,!0),contentHelper.serializeElements($body),$body.html()},contentHelper.getChangeCallback=function(container){return _.throttle(function(data){var $pseudoContainer=$("<div>").html(data),newBody=contentHelper.getContent($pseudoContainer);container.body(newBody)},800)},contentHelper.getChangeCallbackForBlockStatic=function(container){return _.throttle(function(data){var $pseudoContainer=$("<div>").html(data);$pseudoContainer.contents().each(function(){if(3===this.nodeType&&this.nodeValue.trim())return $pseudoContainer.wrapInner("<p>"),$pseudoContainer=$("<div>").html($pseudoContainer.html()),!1}),textWrapper.unwrap($pseudoContainer),container.body(contentHelper.getContent($pseudoContainer))},800)},contentHelper.serializeElements=function($el){var existingElements=[];return $el.find(".widget-box:not(.widget-box *)").each(function(){var $qtiElementWidget=$(this);if($qtiElementWidget.data("serial")){var serial=$qtiElementWidget.data("serial");$qtiElementWidget.replaceWith("{{"+serial+"}}"),existingElements.push(serial)}else if($qtiElementWidget.data("new")&&$qtiElementWidget.data("qti-class")){var qtiClass=$qtiElementWidget.data("qti-class");$qtiElementWidget.replaceWith("{{"+qtiClass+":new}}")}else throw"unknown qti-widget type"}),existingElements},contentHelper.destroyGridWidgets=function($elt,inClone){$elt.removeData("qti-grid-options"),$elt.find(".grid-row, [class*=\" col-\"], [class^=\"col-\"]").removeAttr("style").removeAttr("data-active").removeAttr("data-units"),$elt.children(".ui-draggable-dragging").remove(),resizable.destroy($elt,inClone),$elt.find(".contextual-popup").remove()},contentHelper}),define("tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/popup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"contextual-popup\" style=\"top:"+escapeExpression((stack1=(stack1=depth0&&depth0.popup,null==stack1||!1===stack1?stack1:stack1.top),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"px; left:"+escapeExpression((stack1=(stack1=depth0&&depth0.popup,null==stack1||!1===stack1?stack1:stack1.left),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"px\">\n    <div class=\"arrow\" style=\"left:"+escapeExpression((stack1=(stack1=depth0&&depth0.arrow,null==stack1||!1===stack1?stack1:stack1.left),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"px\"></div>\n    <div class=\"arrow-cover\" style=\"left:"+escapeExpression((stack1=(stack1=depth0&&depth0.arrow,null==stack1||!1===stack1?stack1:stack1.leftCover),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"px\"></div>\n    <div class=\"popup-content\">",(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    <div class=\"footer\">\n        <button class=\"btn btn-info small done\">done</button>\n        <a href=\"#\" class=\"btn cancel\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"cancel",options):helperMissing.call(depth0,"__","cancel",options)))+"\">cancel</a>\n    </div>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/content",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <li data-group-name=\"",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"><a href=\"#\" class=\"group-selector\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</a></li>\n        ",buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <div class=\"element-group\" data-group-name=\"",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            <ul class=\"element-list plain\">\n                ",stack1=helpers.each.call(depth0,depth0&&depth0.elements,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </ul>\n        </div>\n        ",buffer}function program4(depth0,data){var buffer="",stack1,helper;return buffer+="\n                <li data-qti-class=\"",(helper=helpers.qtiClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.qtiClass,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                    ",stack1=helpers["if"].call(depth0,depth0&&depth0.iconFont,{hash:{},inverse:self.program(7,program7,data),fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                    <span class=\"label truncate\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n                </li>\n                ",buffer}function program5(depth0,data){var buffer="",stack1,helper;return buffer+="\n                    <span class=\"icon ",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n                    ",buffer}function program7(depth0,data){var buffer="",stack1,helper;return buffer+="\n                    <img class=\"icon\" src=\"",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"/>\n                    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<div class=\"elementSelector\">\n\n    <ul class=\"group-list plain\">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.groups,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </ul>\n\n    <div class=\"element-group-container\">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.groups,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n\n</div>",buffer})}),define("taoQtiItem/qtiCreator/editor/elementSelector/selector",["jquery","lodash","tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/popup","tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/content"],function($,_,popupTpl,contentTpl){function _done($element){$element.hide(),$element.trigger("done.element-selector")}function _cancel($element){$element.hide(),$element.trigger("cancel.element-selector")}function _activatePanel2($container,groupName){var $trigger=$container.find(".group-list li[data-group-name=\""+groupName+"\"]");_activatePanel($container,$trigger)}function _activatePanel($container,$trigger){if(!$trigger.hasClass("active")){$trigger.addClass("active").siblings(".active").removeClass("active");var group=$trigger.data("group-name"),$group=$container.find(".element-group[data-group-name=\""+group+"\"]");$group.show().siblings(".element-group").hide()}}function _activateElement2($container,qtiClass){var $trigger=$container.find(".element-list li[data-qti-class=\""+qtiClass+"\"]");_activateElement($container,$trigger)}function _activateElement($container,$trigger){var qtiClass=$trigger.data("qti-class");$trigger.hasClass("active")||($container.find(".element-list li").removeClass("active"),$trigger.addClass("active"),$container.trigger("selected.element-selector",[qtiClass,$trigger]))}function _computePosition($anchor,$container){var arrowWidth=6,marginLeft=15,_anchor={top:$anchor.offset().top,left:$anchor.offset().left,w:$anchor.innerWidth(),h:$anchor.innerHeight()},_container={top:$container.offset().top,left:$container.offset().left,w:$container.innerWidth()},_popup={top:_anchor.h+15,left:-250+_anchor.w/2,w:500},offset=_anchor.left-_container.left;offset+marginLeft+_anchor.w/2<_popup.w/2?_popup.left=-offset+marginLeft:_container.w-(offset+_anchor.w/2+marginLeft)<_popup.w/2&&(_popup.left=-offset+_container.w-marginLeft-_popup.w);var _arrow={left:-_popup.left+_anchor.w/2-arrowWidth,leftCover:-_popup.left+_anchor.w/2-arrowWidth-6};return{popup:_popup,arrow:_arrow}}function _filterInteractions(interactions){var filtered=_.filter(interactions,function(interaction){var tags=interaction.tags;return"_container"===interaction.qtiClass?(block=interaction,interaction.tags[0]="Text Block",!1):!!(tags&&"Inline Interactions"!==tags[0])}),block;return block.tags[0]="Text Block",filtered.unshift(block),filtered}function _renderContent(interactions){var groups=[];return _.each(_filterInteractions(interactions),function(interaction){var groupName=interaction.tags[0],panel=_.find(groups,{name:groupName});panel||(panel={name:groupName,label:groupName.replace(/\sInteractions$/,""),elements:[]},groups.push(panel)),panel.elements.push({qtiClass:interaction.qtiClass,disabled:!!interaction.disabled,title:interaction.description,iconFont:/^icon-/.test(interaction.icon),icon:interaction.icon,label:interaction.label})}),contentTpl({groups:groups})}return{create:function($anchor,$container,interactions){var positions=_computePosition($anchor,$container),$element=$(popupTpl({popup:positions.popup,arrow:positions.arrow,content:_renderContent(interactions)}));return $anchor.find(".contextual-popup").remove(),$anchor.append($element),$element.off(".element-selector").on("click.element-selector",".group-list li",function(){var $trigger=$(this);_activatePanel($element,$trigger)}).on("click.element-selector",".element-list li",function(){_activateElement($element,$(this))}).on("click.element-selector",".done",function(){_done($element)}).on("click.element-selector",".cancel",function(){_cancel($element)}),{getPopup:function getPopup(){return $element},reposition:function reposition(){var pos=_computePosition($anchor,$container);$element.css({top:pos.popup.top,left:pos.popup.left}),$element.children(".arrow").css("left",pos.arrow.left),$element.children(".arrow-cover").css("left",pos.arrow.leftCover)},activatePanel:function activatePanel(groupName){_activatePanel2($element,groupName)},activateElement:function activateElement(qtiClass){_activateElement2($element,qtiClass)},done:function done(){_done($element)},cancel:function cancel(){_cancel($element)},show:function show(){$element.show()},destroy:function destroy(){$element.remove()}}},activateElement:_activateElement2,activatePanel:_activatePanel2}}),define("taoQtiItem/qtiCreator/widgets/Widget",["lodash","jquery","core/promise","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/invalidator","core/logger"],function(_,$,Promise,Element,invalidator,loggerFactory){'use strict';var _pushState=function(widget,stateName){var currentState=new widget.registeredStates[stateName](widget);widget.stateStack.push(currentState),currentState.init()},_popState=function(widget){var state=widget.stateStack.pop();state&&state.exit()},logger=loggerFactory("taoQtiItem/qtiCreator/widget");return{init:function init(element,$original,$form,options){var self=this;if(element instanceof Element)options=options||{},this.element=element,this.serial=element.getSerial(),this.$original=$original,this.$form=$form,this.stateStack=[],this.registeredStates={},this.buildContainer(),this.$original.data("widget",this),this.$container.data("widget",this),this.element.data("widget",this),this.offEvents(),_.each(this.getRequiredOptions(),function(opt){if(!options[opt])throw new Error("missing required option for image creator : "+opt)}),this.options=options,Promise.resolve(this.initCreator(options)).then(function(){_.isFunction(self.options.ready)&&self.options.ready.call(self,self),self.$container.trigger("ready.qti-widget",[self])}),this.options.state?this.changeState(this.options.state):this.changeState("sleep");else throw new Error("element is not a QTI Element");return this},getAreaBroker:function(){var element=this.element,renderer=element.getRenderer();if(renderer)return renderer.getAreaBroker()},getCreatorContext:function(){var element=this.element,renderer=element.getRenderer();if(renderer)return renderer.getCreatorContext()},getRequiredOptions:function getRequiredOptions(){return[]},buildContainer:function buildContainer(){throw new Error("method buildContainer must be implemented")},build:function build(element,$container,$form,options){return this.clone().init(element,$container,$form,options)},clone:function clone(){return _.clone(this)},initCreator:function initCreator(){var $interaction=this.$container.find(".qti-interaction"),serial=$interaction.data("serial");this.$container.on("resize.itemResizer",function(){$(window).trigger("resize.qti-widget."+serial)})},getCurrentState:function getCurrentState(){return _.last(this.stateStack)},changeState:function changeState(stateName){var self=this,currentState=this.getCurrentState(),state,superStateName,exitedStates,enteredStates,i;if(logger.info("changing state of "+this.serial+": "+(currentState||{}).name+" => "+stateName),this.registeredStates[stateName])state=new this.registeredStates[stateName];else throw new Error("unknown target state : "+stateName);if(currentState){if("map"===currentState.name&&"map"!==state.name&&this.$container.find("[data-has-tooltip]").each(function(j,el){$(el).data("$tooltip").hide()}),currentState.name===state.name)return this;if(0<=_.indexOf(state.superState,currentState.name))for(i=_.indexOf(state.superState,currentState.name)-1;0<=i;i--)superStateName=state.superState[i],_pushState(this,superStateName);else{if(0<=_.indexOf(currentState.superState,state.name)){for(i=0;i<=_.indexOf(currentState.superState,state.name);i++)_popState(self);return this}_popState(self),exitedStates=_.difference(currentState.superState,state.superState),_.each(exitedStates,function(){_popState(self)}),enteredStates=_.difference(state.superState,currentState.superState),_.eachRight(enteredStates,function(_superStateName){_pushState(self,_superStateName)})}}else _.eachRight(state.superState,function(_superStateName){_pushState(self,_superStateName)});return _pushState(this,stateName),this},registerState:function registerState(name,State){if(name&&State)this.registeredStates[name]=State;else throw new Error("missing required arguments in state registration")},registerStates:function registerStates(states){var self=this;_.forIn(states,function(State,name){self.registerState(name,State)})},afterStateInit:function afterStateInit(callback,ns){var evtName="afterStateInit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},beforeStateInit:function beforeStateInit(callback,ns){var evtName="beforeStateInit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},afterStateExit:function afterStateExit(callback,ns){var evtName="afterStateExit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},beforeStateExit:function beforeStateExit(callback,ns){var evtName="beforeStateExit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},offEvents:function offEvents(ns){var evtName=".qti-widget."+this.serial+(ns?"."+ns:"");$(document).off(evtName),this.$container.off("resize.itemResizer")},destroy:function destroy(){logger.info("destroying widget "+this.serial),this.changeState("sleep"),this.$container.find("[data-edit]").remove(),$("[data-widget-component="+this.serial+"]").remove(),this.offEvents()},rebuild:function rebuild(options){var element,postRenderOpts,$container,renderer;if(options=options||{},element=this.element,postRenderOpts={},_.isFunction(options.ready)&&(postRenderOpts.ready=options.ready),$container=null,$container=options.context&&options.context.length?options.context.find(".widget-box[data-serial="+element.serial+"]"):this.$container.length&&$.contains(document,this.$container[0])?this.$container:$(".widget-box[data-serial="+element.serial+"]"),this.destroy(),renderer=element.getRenderer(),renderer&&renderer.isRenderer){if("creatorRenderer"===renderer.name)return element.render($container),element.postRender(postRenderOpts),element.data("widget");throw new Error("The renderer is no longer the creatorRenderer")}else throw new Error("No renderer found to rebuild the widget")},refresh:function refresh(){var currentState=this.getCurrentState().name;this.rebuild({ready:function ready(widget){widget.changeState(currentState)}})},on:function on(qtiElementEventName,callback,live){var self=this,eventNames=qtiElementEventName.replace(/\s+/g," ").split(" "),$document=$(document);return _.each(eventNames,function(eventName){var eventNameToken=[eventName,"qti-widget",self.serial];live||eventNameToken.push(self.getCurrentState().name),$document.on(eventNameToken.join("."),function(e,data){callback.call(self,data)})}),this},isValid:function isValid(what,valid,why){var element=this.element;return"undefined"==typeof what?invalidator.isValid(element):void(valid?invalidator.valid(element,what):invalidator.invalid(element,what,why,this.getCurrentState().name))}}}),define("taoQtiItem/qtiCreator/editor/widgetToolbar",["jquery","i18n"],function($,__){'use strict';var defaultConfig=[[{title:"Question",class:"question-trigger",status:"off",fn:function fn(){var target=arguments[1],toolbar=arguments[2],responseButton=toolbar.find(".answer-trigger a"),answerEditors=target.find("[data-edit=\"answer\"]"),questionEditors=target.find("[data-edit=\"question\"]");responseButton.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),questionEditors.show(),answerEditors.hide(),target.data("mode","question")}},{title:"Answer",class:"answer-trigger",fn:function fn(){var target=arguments[1],toolbar=arguments[2],contentButton=toolbar.find(".question-trigger a"),answerEditors=target.find("[data-edit=\"answer\"]"),questionEditors=target.find("[data-edit=\"question\"]");contentButton.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),answerEditors.show(),questionEditors.hide(),target.data("mode","answer"),target.find("[contenteditable]").attr("contenteditable",!1),$(document).trigger("widgetBlur")}}],"spacer",[{icon:"bin",title:"Delete",fn:function fn(){var target=arguments[1],toolbar=arguments[2],msg=$("<span>",{text:__("You have deleted an element.")+" "}),undo=$("<a>",{text:__("Undo"),href:"#"}),icon=$("<span>",{class:"icon-info"}),closer=$("<span>",{title:"Remove Message",class:"icon-close close-trigger"}),feedback=$("<div>",{class:"feedback-info"}).hide();closer.on("click",function(){feedback.fadeOut(function(){feedback.remove(),target.remove(),toolbar.remove()})}),undo.on("click",function(e){e.preventDefault(),feedback.remove(),target.removeClass("deleted").fadeIn()}),feedback.append(icon),feedback.append(msg),feedback.append(undo),feedback.append(closer),target.before(feedback),toolbar.hide(),target.hide().addClass("deleted"),feedback.fadeIn(function(){setTimeout(function(){closer.trigger("click")},6500)})}}]],structure=function(type){return"/"===type?type="break":"-"===type?type="separator":" "===type?type="spacer":void 0,$("<span>",{class:"tlb-"+type})},bar=function(items,target,toolbar){var bar=$("<div>",{class:"tlb-bar"}),isTextButton=!items[0].icon,l=items.length,group,i;if(bar.append(structure("start")),isTextButton)for(i=0;i<l;i++)"string"===$.type(items[i])?bar.append(structure(items[i])):(items[i].target=target,items[i].toolbar=toolbar,bar.append(button(items[i],isTextButton)));else for(group=$("<div>",{class:"tlb-group"}),bar.append(group),i=0;i<l;i++)"string"===$.type(items[i])?group.append(structure(items[i])):(items[i].target=target,items[i].toolbar=toolbar,group.append(button(items[i],isTextButton)));return bar.append(structure("end")),bar},button=function(config,isTextButton){var status=config.status||"off",fn=config.fn||function(){},target=config.target||$(),toolbar=config.toolbar||$(),a,span,button,icon,text;return delete config.status,delete config.fn,delete config.target,delete config.toolbar,isTextButton?(text=__(config.title),delete config.title,config["class"]=config["class"]?config["class"]+" tlb-text-button-box":"tlb-text-button-box",button=$("<span>",config),a=$("<a>",{class:"tlb-text-button-"+status}),span=$("<span>",{class:"tlb-text",text:text}),button.append(a),a.append(span)):(icon="icon-"+config.icon.replace("icon-",""),delete config.icon,config["class"]=config["class"]?config["class"]+" tlb-button-"+status:"tlb-button-"+status,button=$("<a>",config),span=$("<span>",{class:icon}),button.append(span)),button.on("click.toolbar",function(e){return!(button.hasClass("tlb-text-button-disabled")||button.hasClass("tlb-button-disabled"))&&void(isTextButton?button.find("a").toggleClass("tlb-text-button-off").toggleClass("tlb-text-button-on"):button.toggleClass("tlb-button-off").toggleClass("tlb-button-on"),fn.apply(this,[e,target,toolbar]))}),button},handleConfig=function(config,extendDefaultConfig){return $.isArray(config)&&!config.length&&(config=!1),config?extendDefaultConfig&&(config=$.extend(defaultConfig,config)):config=defaultConfig,config},buildToolbar=function(config,target,tlbWrapper){var tlb=$("<div>",{class:"tlb"}),top=$("<div>",{class:"tlb-top"}),box=$("<div>",{class:"tlb-box"}),ic=config.length,i;for(top.append(box),tlb.append(top),i=0;i<ic;i++)"string"===$.type(config[i])?box.append(structure(config[i])):box.append(bar(config[i],target,tlbWrapper));return tlb.data("edit","toolbar"),tlb};return function(){return{attach:function attach(buttonConfig,barConfig){var defaultBarConfig={offsetTop:-2,title:"",extendDefaultConfig:!1,target:$()},target=$(barConfig.target),tlbWrapper=target.prop("tlb")||$("<div>",{class:"tlb-wrapper"}),toolbar,title,top;return target.prop("tlb")||(buttonConfig=handleConfig(buttonConfig,barConfig.extendDefaultConfig),barConfig=$.extend(defaultBarConfig,barConfig||{}),toolbar=buildToolbar(buttonConfig,target,tlbWrapper),barConfig.title&&(title=$("<span>",{text:barConfig.title,class:"tlb-title",title:barConfig.title}),tlbWrapper.append(title)),tlbWrapper.append(toolbar),target.prop("tlb",tlbWrapper),target.append(tlbWrapper),tlbWrapper.css("position","absolute"),tlbWrapper.css("display","none"),tlbWrapper.css("width","100%"),top=defaultBarConfig.offsetTop-tlbWrapper.height(),tlbWrapper.css("top",top)),tlbWrapper.fadeIn(),tlbWrapper}}}()}),define("taoQtiItem/qtiCreator/widgets/static/Widget",["jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/editor/widgetToolbar"],function($,Widget){"use strict";var StaticWidget=Widget.clone();return StaticWidget.initCreator=function(){Widget.initCreator.call(this),this.createToolbar()},StaticWidget.buildContainer=function(){var $wrap=$("<div>",{"data-serial":this.element.serial,class:"widget-box"});this.$original.wrap($wrap),this.$container=this.$original.parent()},StaticWidget.createToolbar=function(){return this},StaticWidget.getAssetManager=function(){if(!this.options||!this.options.assetManager)throw new Error("Asset Manager has not been set.");return this.options.assetManager},StaticWidget.createOkButton=function(){var _this=this;this.$container.append($("<button>",{class:"btn-info small",type:"button",text:"OK","data-edit":"active"}).css({margin:"5px 10px",display:"none"}).on("click.qti-widget",function(e){e.stopPropagation(),_this.changeState("sleep")}))},StaticWidget}),define("taoQtiItem/qtiCreator/widgets/states/factory",["jquery","lodash"],function($,_){var _isValidStateDefinition=function(state){return!!_.isFunction(state)&&!!(state.prototype.name&&state.prototype.superState)&&!!(_.isFunction(state.prototype.init)&&_.isFunction(state.prototype.exit))},_create=function(name,superStates,init,exit){var State=function(widget){this.widget=widget};return State.prototype.name=name,State.prototype.superState=superStates||[],init&&exit&&(State.prototype.init=function(){var $container=this.widget.$container;$container.data("edit")===name&&$container.show();var $editableWidgets=$container.find("[data-edit=\""+name+"\"]").filter(function(){var $parentWidget=$(this).closest(".widget-box");return!!($parentWidget.length&&$parentWidget[0]===$container[0])});$editableWidgets.show(),this.widget.$container.addClass("edit-"+name),$(document).trigger("beforeStateInit.qti-widget",[this.widget.element,this]),init.call(this),$(document).trigger("afterStateInit.qti-widget",[this.widget.element,this])},State.init=init,State.prototype.exit=function(){this.widget.$container.data("edit")===name&&this.widget.$container.hide(),this.widget.$container.find("[data-edit=\""+name+"\"]").hide(),this.widget.$container.removeClass("edit-"+name),$(document).trigger("beforeStateExit.qti-widget",[this.widget.element,this]),$(document).off([".qti-widget",name,this.widget.serial].join(".")),exit.call(this),$(document).trigger("afterStateExit.qti-widget",[this.widget.element,this])},State.exit=exit),State};return{create:function create(){var State,name,superStates,init,exit;if(_.isString(arguments[0])){if(name=arguments[0],_.isArray(arguments[1])){if(superStates=arguments[1],_.isFunction(arguments[2])&&_.isFunction(arguments[3]))init=arguments[2],exit=arguments[3],State=_create(name,superStates,init,exit);else throw new Error("the third and fourth arguments are expected to be functions: init() & exit()");}else if(superStates=[],_.isFunction(arguments[1])&&_.isFunction(arguments[2]))init=arguments[1],exit=arguments[2],State=_create(name,superStates,init,exit);else throw new Error("the second and third arguments are expected to be functions: init() & exit()");}else if(!_isValidStateDefinition(arguments[0]))throw new Error("invalid first argument : expected the state name (string) or a State (function)");else if(name=arguments[0].prototype.name,superStates=arguments[0].prototype.superState,_.isFunction(arguments[1])&&_.isFunction(arguments[2]))init=arguments[1],exit=arguments[2],State=_create(name,superStates,init,exit);else throw new Error("the second and third arguments are expected to be functions: init() & exit()");return State},extend:function extend(State,init,exit){var Clone=null,initFn,exitFn;if(_isValidStateDefinition(State))_.isFunction(init)&&(initFn=function(){State.init.call(this),init.call(this)}),_.isFunction(exit)&&(exitFn=function(){exit.call(this),State.exit.call(this)}),Clone=_create(State.prototype.name,State.prototype.superState,initFn,exitFn),_.forIn(State.prototype,function(prop,name){if(_.isFunction(prop)){if(initFn&&"init"===name||exitFn&&"exit"===name)return!0;Clone.prototype[name]=prop,Clone[name]=prop}});else throw new Error("invalid state to be cloned");return Clone},createBundle:function createBundle(){var stateBundle={},newStates=[],excluded=[];return 2<=arguments.length?(stateBundle=_.clone(arguments[0]),newStates=arguments[1],excluded=arguments[2]||excluded):newStates=arguments[0],_.each(newStates,function(state){_isValidStateDefinition(state)&&(stateBundle[state.prototype.name]=state)}),_.each(excluded,function(state){delete stateBundle[state]}),stateBundle},throwMissingRequiredImplementationError:function throwMissingRequiredImplementationError(functionName){throw new Error("Missing required implementation of the function "+functionName+"()")}}}),define("taoQtiItem/qtiCreator/widgets/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){'use strict';return stateFactory.create("sleep",function(){var widget=this.widget,$container=this.widget.$container;$container.on("mouseenter.sleep",function(e){e.stopPropagation(),$container.addClass("hover"),$container.parent().trigger("mouseleave")}).on("mouseleave.sleep",function(){$container.removeClass("hover"),$container.parent().trigger("mouseenter")}),widget.isValid()||widget.changeState("invalid")},function(){this.widget.$container.removeClass("hover").off(".sleep")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,SleepState){var StaticStateSleep=stateFactory.extend(SleepState,function(){var _widget=this.widget;_widget.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),_widget.changeState("active")})},function(){var _widget=this.widget;_widget.$container.off(".sleep")});return StaticStateSleep}),define("taoQtiItem/qtiCreator/widgets/helpers/content",["jquery","lodash","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content"],function($,_,creatorRenderer,containerHelper,gridContentHelper){'use strict';return{createElements:function(container,$container,data,callback){var $dummy=$("<div>").html(data);containerHelper.createElements(container,gridContentHelper.getContent($dummy),function(newElts){creatorRenderer.get().load(function(){var serial,elt,$placeholder,$widget,widget;for(serial in newElts)elt=newElts[serial],$placeholder=$container.find(".widget-box[data-new][data-qti-class="+elt.qtiClass+"]"),elt.setRenderer(this),elt.render($placeholder),elt.postRender(),widget=elt.data("widget"),$widget=widget.$original,$widget.trigger("contentChange.gridEdit"),_.isFunction(callback)&&callback(widget)},this.getUsedClasses())})},changeInnerWidgetState:function(outerWidget,state){var selector=[];_.each(["img","math","object","include"],function(qtiClass){selector.push("[data-html-editable] .widget-"+qtiClass)}),outerWidget.$container.find(selector.join(",")).each(function(){var innerWidget=$(this).data("widget");innerWidget&&innerWidget.changeState(state)})}}}),define("taoQtiItem/qtiCreator/widgets/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/content"],function($,stateFactory,contentHelper){'use strict';return stateFactory.create("active",function(){var _widget=this.widget,container=_widget.$container[0],item=_widget.element.getRootElement(),areaBroker=_widget.getAreaBroker(),$modalFeedbacksArea=$("#modalFeedbacks");areaBroker.getContentCreatorPanelArea().on("mousedown.active."+_widget.serial,function(e){container===e.target||$.contains(container,e.target)||areaBroker&&areaBroker.getEditorBarArea&&$.contains(areaBroker.getEditorBarArea().get(0),e.target)||$modalFeedbacksArea.length&&$.contains($modalFeedbacksArea[0],e.target)||"restore"===$(e.target).data("role")||$(e.target).closest(".widget-popup").length||_widget.changeState("sleep")}).on("beforesave.qti-creator.active",function(){_widget.changeState("sleep")}).on("styleedit.active",function(){_widget.changeState("sleep")}),$(document).on("open-preview.qti-item",function(){_widget.changeState("sleep")}),item&&item.data("widget")&&item.data("widget").$container.on("resizestart.gridEdit.active beforedragoverstart.gridEdit.active",function(){_widget.changeState("sleep")})},function(){var areaBroker=this.widget.getAreaBroker(),item;contentHelper.changeInnerWidgetState(this.widget,"sleep"),this.widget.$container.off(".active"),areaBroker.getContentCreatorPanelArea().off(".active."+this.widget.serial);var item=this.widget.element.getRootElement();item&&item.data("widget")&&item.data("widget").$container.off(".active")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function($,stateFactory,Active){'use strict';return stateFactory.extend(Active,function(){var _widget=this.widget,$container=_widget.$container;_widget.beforeStateInit(function(e,element,state){var serial=element.getSerial(),composingElts;("active"===state.name&&serial!==_widget.serial||"choice"===state.name)&&("rubricBlock"===_widget.element.qtiClass?(composingElts=_widget.element.getComposingElements(),!composingElts[element.serial]&&_widget.changeState("sleep")):_widget.changeState("sleep"))},"otherActive"),$container.on("mouseenter.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseenter.sleep")}).on("click.active",function(e){e.stopPropagation()})},function(){var _widget=this.widget,areaBroker=_widget.getAreaBroker();_widget.$container.off(".active"),areaBroker.getContentCreatorPanelArea().off(".active."+_widget.serial),_widget.offEvents("otherActive")})}),define("taoQtiItem/qtiCreator/widgets/states/Inactive",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("inactive",function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",helper,options;return buffer+="\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"You have deleted an element",options):helperMissing.call(depth0,"__","You have deleted an element",options)))+".\n    ",buffer}function program3(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"You have deleted",options):helperMissing.call(depth0,"__","You have deleted",options)))+" ",(helper=helpers.count)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.count,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"elements",options):helperMissing.call(depth0,"__","elements",options)))+".\n    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"feedback-info popup\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"icon-info\"></span>\n    ",stack1=(helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data},helper?helper.call(depth0,depth0&&depth0.count,1,options):helperMissing.call(depth0,"equal",depth0&&depth0.count,1,options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <a class=\"undo\" href=\"#\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"undo",options):helperMissing.call(depth0,"__","undo",options)))+"</a>\n    <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+"\" class=\"icon-close close-trigger\"></span>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/helpers/deletingState",["lodash","jquery","tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox"],function(_,$,deletingInfoTpl){'use strict';var _destroy=function($messageBox){$("body").off(".deleting"),$messageBox.remove()},undo=function($messageBox){$messageBox.trigger("undo.deleting"),_destroy($messageBox)},_bindEvents=function($messageBox){$("body").on("mousedown.deleting keydown.deleting",function(e){return e.ctrlKey||e.metaKey?(90==e.keyCode&&undo($messageBox),void e.preventDefault()):void(e.target!==$messageBox[0]&&!$.contains($messageBox[0],e.target)&&_confirmDeletion($messageBox,400))}),$messageBox.find("a.undo").on("click",function(e){e.preventDefault(),undo($messageBox)}),$messageBox.find(".close-trigger").on("click",function(e){e.preventDefault(),_confirmDeletion($messageBox,0)}),setTimeout(function(){_confirmDeletion($messageBox,1e3)},10000)},_confirmDeletion=function($messageBox,fadeDelay){$messageBox.length&&$.contains(document,$messageBox[0])&&($messageBox.trigger("confirm.deleting"),$messageBox.fadeOut(fadeDelay,function(){_destroy($messageBox)}))};return{createInfoBox:function createInfoBox(widgets){var $messageBox=$(deletingInfoTpl({serial:"widgets",count:widgets.length}));return $("body").append($messageBox),$messageBox.css({display:"block",position:"fixed",top:"50px",left:"50%","margin-left":"-200px",width:"400px",zIndex:999999}),_bindEvents($messageBox),_.each(widgets,function(w){w.on("beforeStateInit",function(){_confirmDeletion($messageBox,400)})}),$messageBox}}}),define("taoQtiItem/qtiCreator/helper/gridUnits",["lodash"],function(_){"use strict";var _Mathround6=Math.round;function distributeUnits(cols,min,max){max=max||12;var totalUnits=0,size=0,_cols={},ret={},minimized=[],decimals=[];for(var i in cols)_cols[i]=_.clone(cols[i]),totalUnits+=cols[i].units,size++;var avg=totalUnits/size;if(_cols[size+1]={elt:"middle",units:avg,min:min},totalUnits+_Mathround6(avg)>max){var refactoredTotalUnits=0;for(var i in _cols){var col=_cols[i],refactoredUnits=col.units*max/(max+avg);decimals[i]=_Mathround6(100*(refactoredUnits%1)),col.refactoredUnits=_Mathround6(refactoredUnits),col.min&&col.refactoredUnits<col.min&&(col.refactoredUnits=col.min,minimized[i]=!0),refactoredTotalUnits+=col.refactoredUnits}if(refactoredTotalUnits>max)for(var i,col;i<size+1&&(col=_cols[i],50<col.decimal&&col.refactoredUnits-1>col.min&&(col.refactoredUnits--,refactoredTotalUnits--),refactoredTotalUnits!==max);i++);var middleUnitValue=_cols[size+1].refactoredUnits,lastUnitValue=refactoredTotalUnits>max?max:middleUnitValue;delete _cols[size+1],ret={last:lastUnitValue,middle:middleUnitValue,cols:_cols,refactoredTotalUnits:refactoredTotalUnits}}else{var last=max-totalUnits;ret={last:last,middle:last,cols:{}}}return ret}function redistributeUnits(cols,max){max=max||12;var totalUnits=0,_cols=[],totalRefactoredUnits=0,negative=[],positive=[],ret=[];if(_.each(cols,function(col){_cols.push(col),totalUnits+=col.units}),totalUnits>max)throw"the total number of units exceed the maximum of "+max;return _.each(_cols,function(col){var refactoredUnits=col.units*max/totalUnits,rounded=_Mathround6(refactoredUnits);totalRefactoredUnits+=rounded,col.refactoredUnits=rounded,rounded>refactoredUnits?positive.push(col):negative.push(col)}),positive=_.sortBy(positive,"refactoredUnits"),negative=_.sortBy(negative,"refactoredUnits"),totalRefactoredUnits>max?_.eachRight(positive,function(col){if(col.refactoredUnits--,totalRefactoredUnits--,totalRefactoredUnits===max)return!1}):totalRefactoredUnits<max&&_.each(negative,function(col){if(col.refactoredUnits++,totalRefactoredUnits++,totalRefactoredUnits===max)return!1}),_.each(negative,function(col){ret.push(col)}),_.each(positive,function(col){ret.push(col)}),_cols}return{distribute:function distribute(cols,min,max){return distributeUnits(cols,min,max)},redistribute:function redistribute(cols,max){return redistributeUnits(cols,max)}}}),define("taoQtiItem/qtiCreator/widgets/states/Deleting",["lodash","jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/deletingState","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(_,$,stateFactory,deletingHelper,gridUnits,gridHelper,contentHelper){var DeletingState=stateFactory.create("deleting",function(){var element=this.widget.element;this.refactoredUnits=[],this.updateBody=!1,this.$elementToRemove=this.getElementToRemove(),this.hideWidget(),this.showMessage(element),element.data("deleting",!0),this.updateBody&&(this.item=element.getRootElement(),this.$item=this.item.data("widget").$container.find(".qti-itemBody"),this.$item.trigger("resize.qti-widget"))},function(){this.showWidget(),this.widget.element.data("deleting",!1),$("body").off(".deleting"),this.updateBody&&this.$item.trigger("resize.qti-widget")});DeletingState.prototype.getElementToRemove=function(){var $container=this.widget.$container;if($container.hasClass("qti-choice"))if("TH"===$container.prop("tagName")){if("THEAD"===$container.parent().parent().prop("tagName")){var $tbody=$container.closest("table.matrix").children("tbody"),$tds=$tbody.children("tr").find("td:last");return $container.add($tds)}if("TBODY"===$container.parent().parent().prop("tagName"))return $container.parent()}else return $container;if($container.hasClass("widget-inline"))return $container.add(this.widget.$original);var $col=$container.parent(),$subCol=$container.parent(".colrow");if($subCol.length){this.updateBody=!0;var $colMulti=$subCol.parent();if(1===$colMulti.find(".colrow").length)$col=$colMulti;else return $subCol}var $row=$col.parent(".grid-row");return $row.length?(this.updateBody=!0,1===$row.children().length?$row:$col):$container.hasClass("grid-row")?(this.updateBody=!0,$container):$container.hasClass("widget-block")||$container.hasClass("widget-blockInteraction")?$container:void 0},DeletingState.prototype.hideWidget=function(){var $elt=this.$elementToRemove;$elt.length&&($elt.hide(),_isCol($elt)&&(this.refactoredUnits=_redistributeUnits($elt)))};var _isCol=function($col){var attrClass=$col.attr("class");return attrClass&&/col-([\d]+)/.test(attrClass)},_redistributeUnits=function($col){var usedUnits=$col.data("units"),$otherCols=$col.siblings(),cols=[];return $otherCols.each(function(){var $col=$(this),units=$col.data("units");cols.push({elt:$col,units:units}),usedUnits+=units}),cols=gridUnits.redistribute(cols),_.each(cols,function(col){col.elt.removeClass("col-"+col.units).addClass("col-"+col.refactoredUnits),gridHelper.setUnitsFromClass(col.elt)}),$col.data("redistributedUnits",cols),cols};return DeletingState.prototype.showWidget=function(){var $elt=this.$elementToRemove;$elt.length&&$.contains(document,$elt[0])&&($elt.show(),_isCol($elt)&&_.each(this.refactoredUnits,function(col){col.elt.removeClass("col-"+col.refactoredUnits).addClass("col-"+col.units),gridHelper.setUnitsFromClass(col.elt)}))},DeletingState.prototype.showMessage=function(){var _this=this,_widget=this.widget,$messageBox=deletingHelper.createInfoBox([_widget]);$messageBox.on("confirm.deleting",function(){_this.deleteElement()}).on("undo.deleting",function(){try{_widget.changeState("question")}catch(e){_widget.changeState("active")}}),this.messageBox=$messageBox},DeletingState.prototype.deleteElement=function(){this.refactoredUnits=[],this.$elementToRemove.remove(),this.widget.destroy(),this.widget.element.remove(),this.updateBody&&this.item.body(contentHelper.getContent(this.$item))},DeletingState}),define("taoQtiItem/qtiCreator/widgets/static/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Deleting"],function(factory){return factory.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var TextBlockStateSleep=stateFactory.extend(SleepState,function(){},function(){});return TextBlockStateSleep}),define("taoQtiItem/qtiCreator/helper/ckConfigurator",["lodash","ui/ckeditor/ckConfigurator","mathJax"],function(_,ckConfigurator,mathJax){'use strict';var _defaults={qtiImage:!0,qtiMedia:!0,qtiInclude:!0,underline:!0,mathJax:!!mathJax};return{getConfig:function getConfig(editor,toolbarType,options){return ckConfigurator.getConfig(editor,toolbarType,_.defaults(options||{},_defaults))}}}),define("taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor",["lodash","i18n","jquery","ckeditor","core/promise","taoQtiItem/qtiCreator/helper/ckConfigurator","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/deletingState"],function(_,__,$,CKEditor,Promise,ckConfigurator,Element,contentHelper,deletingHelper){"use strict";function _buildEditor($editable,$editableContainer,options){var widget=(options.data||{}).widget,areaBroker=widget&&widget.getAreaBroker&&widget.getAreaBroker(),$toolbarArea=areaBroker&&areaBroker.getToolbarArea&&areaBroker.getToolbarArea(),ckConfig;if(options=_.defaults(options,_defaults),!($editable instanceof $)||!$editable.length)throw new Error("invalid jquery element for $editable");if(!($editableContainer instanceof $)||!$editableContainer.length)throw new Error("invalid jquery element for $editableContainer");return options.placeholder&&""!==options.placeholder&&($editable.is("input")?$editable.attr("placeholder",options.placeholder):$editable.attr("data-placeholder",options.placeholder)),ckConfig={dtdMode:"qti",autoParagraph:!1,removePlugins:options.removePlugins||"",enterMode:options.enterMode||CKEditor.ENTER_P,floatSpaceDockedOffsetY:10,sharedSpaces:{top:$toolbarArea&&$toolbarArea.attr("id")||"toolbar-top"},taoQtiItem:{insert:function insert(tempWidget){var $newContent=$(tempWidget).clone();options.data&&options.data.container&&options.data.widget&&contentHelper.createElements(options.data.container,$editable,_htmlEncode(this.getData()),function(createdWidget){var createdElement=createdWidget.element;_.isFunction(createdElement.initContainer)&&(createdElement.body($newContent.html()),createdWidget.rebuild(),createdWidget=createdElement.data("widget")),_activateInnerWidget(options.data.widget,createdWidget)})}},on:{instanceReady:function instanceReady(e){var widgets={},editor=e.editor;$editable.data("editor",editor),$editable.data("editor-options",options),editor.on("change",_.debounce(function(){_detectWidgetDeletion($editable,widgets,editor),_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData()))},100,{leading:!0})),managePlaceholder($editable,editor),options.data&&options.data.container&&($editable.data("qti-container",options.data.container),widgets=_rebuildWidgets(options.data.container,$editable,{restoreState:!0}),options.shieldInnerContent&&_shieldInnerContent($editable,options.data.widget)),options.autofocus&&_focus(editor),$editable.trigger("editorready",[editor]),$(".qti-item").trigger("toolbarchange")},blur:function blur(){$toolbarArea&&$toolbarArea.hide()},focus:function focus(){$toolbarArea&&$toolbarArea.show(),_.isFunction(options.focus)&&options.focus.call(this,_htmlEncode(this.getData())),$editable.trigger("editorfocus"),$(".qti-item").trigger("toolbarchange")},configLoaded:function configLoaded(e){var toolbarType="";options.toolbar&&_.isArray(options.toolbar)?ckConfig.toolbar=options.toolbar:toolbarType=getTooltypeFromContainer($editableContainer),"undefined"!=typeof options.qtiMedia&&(ckConfig.qtiMedia=options.qtiMedia),"undefined"!=typeof options.qtiImage&&(ckConfig.qtiImage=options.qtiImage),"undefined"!=typeof options.qtiInclude&&(ckConfig.qtiInclude=options.qtiInclude),"undefined"!=typeof options.highlight&&(ckConfig.highlight=options.highlight),e.editor.config=ckConfigurator.getConfig(e.editor,toolbarType,ckConfig)},afterPaste:function afterPaste(){}}},CKEditor.inline($editable[0],ckConfig)}function managePlaceholder($editable,editor){$editable.is("input")||(togglePlaceholder($editable),editor.on("change",function(){togglePlaceholder($editable)}))}function togglePlaceholder($editable){""!==$editable.text().trim()||$editable.find(["img","table","math","object","printedVariable",".tooltip-target"].join(",")).length?removePlaceholder($editable):$editable.addClass("cke-placeholder")}function removePlaceholder($editable){$editable.removeClass("cke-placeholder")}function getTooltypeFromContainer($editableContainer){var toolbarType="qtiFlow";return $editableContainer.hasClass("widget-blockInteraction")||$editableContainer.hasClass("widget-textBlock")||$editableContainer.hasClass("widget-rubricBlock")?toolbarType="qtiBlock":($editableContainer.hasClass("qti-prompt-container")||$editableContainer.hasClass("widget-hottext"))&&(toolbarType="qtiInline"),toolbarType}function _find($container,dataAttribute){var $collection;return $collection=$container.data(dataAttribute)?$container:$container.find("[data-"+dataAttribute+"=true]"),$collection}function _rebuildWidgets(container,$container,options){var widgets={};return options=options||{},_.each(_.values(container.elements),function(elt){var widget=elt.data("widget"),currentState=widget.getCurrentState().name;widgets[elt.serial]=widget.rebuild({context:$container,ready:function ready(widget){options.restoreState&&widget.changeState(currentState)}})}),$container.trigger("widgetCreated",[widgets,container]),widgets}function _findWidgetContainer($container,serial){return $container.find(".widget-box[data-serial="+serial+"]")}function _detectWidgetDeletion($container,widgets,editor){var deleted=[],container=$container.data("qti-container"),$widget;if(_.each(widgets,function(w){w.element.data("removed")||($widget=_findWidgetContainer($container,w.serial),!$widget.length&&deleted.push(w))}),deleted.length){var undoCmd=editor.getCommand("undo"),$messageBox=deletingHelper.createInfoBox(deleted);$messageBox.on("confirm.deleting",function(){_.each(deleted,function(w){w.element.remove(),w.destroy()}),editor.resetUndo()}).on("undo.deleting",function(){editor.undoManager.undo(),_rebuildWidgets(container,$container,{restoreState:!0}),_shieldInnerContent($container,container.data("widget"))}),undoCmd&&undoCmd.on("afterUndo",function(){$messageBox.find("a.undo").click()})}}function addShield($widget){var $shield=$("<button>",{class:"html-editable-shield"});return $widget.attr("contenteditable",!1),$widget.append($shield),$shield}function _shieldInnerContent($container,containerWidget){$container.find(".widget-box").each(function(){var $widget=$(this);addShield($widget).on("click",function(e){var innerWidget;e.stopPropagation(),innerWidget=$widget.data("widget"),_activateInnerWidget(containerWidget,innerWidget)})})}function _activateInnerWidget(containerWidget,innerWidget){var listenToWidgetCreation;containerWidget&&containerWidget.element&&containerWidget.element.qtiClass?(listenToWidgetCreation=function(){containerWidget.$container.on("widgetCreated."+innerWidget.serial,function(e,widgets){var targetWidget=widgets[innerWidget.serial];targetWidget&&(containerWidget.$container.off("widgetCreated."+innerWidget.serial),_.delay(function(){Element.isA(targetWidget.element,"interaction")?targetWidget.changeState("question"):targetWidget.changeState("active")},100))})},Element.isA(containerWidget.element,"_container")&&!containerWidget.element.data("stateless")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(containerWidget.element,"interaction")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(containerWidget.element,"choice")?(listenToWidgetCreation(),containerWidget.changeState("question")):Element.isA(containerWidget.element,"table")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(innerWidget.element,"choice")?innerWidget.changeState("choice"):innerWidget.changeState("active")):innerWidget.changeState("active")}function _htmlEncode(encodedStr){return encodedStr}function _focus(editor){var range;editor.editable()&&editor.editable().$.parentNode&&(editor.focus(),range=editor.createRange(),range.moveToElementEditablePosition(editor.editable(),!0),editor.getSelection().selectRanges([range]))}var _defaults={placeholder:__("some text ..."),shieldInnerContent:!0,passthroughInnerContent:!1,autofocus:!0},editorFactory;return CKEditor.disableAutoInline=!0,editorFactory={hasEditor:function($container){var hasEditor=!1;return _find($container,"html-editable").each(function(){return hasEditor=!!$(this).data("editor"),hasEditor}),hasEditor},buildEditor:function buildEditor($container,editorOptions){var buildTasks=[];return _find($container,"html-editable-container").each(function(){var $editableContainer=$(this),$editable=$editableContainer.find("[data-html-editable]");buildTasks.push(new Promise(function(resolve){$editable.attr("contenteditable",!0),_buildEditor($editable,$editableContainer,editorOptions),$editable.on("editorready",resolve)}))}),Promise.all(buildTasks)},destroyEditor:function destroyEditor($container){var destructTasks=[];return _find($container,"html-editable-container").each(function(){var $editableContainer=$(this),$editable=$editableContainer.find("[data-html-editable]"),editor,options;$editable.removeAttr("contenteditable"),$editable.data("editor")&&destructTasks.push(new Promise(function(resolve){editor=$editable.data("editor"),options=$editable.data("editor-options"),_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData())),removePlaceholder($editable),editor.on("destroy",function(){$editable.removeData("editor").removeData("editor-options"),$editable.data("qti-container")&&_rebuildWidgets($editable.data("qti-container"),$editable),$editable.trigger("editordestroyed"),resolve()}),editor.focusManager.blur(!0),editor.destroy()}))}),Promise.all(destructTasks)},getData:function getData($editable){var editor=$editable.data("editor");if(editor)return _htmlEncode(editor.getData());throw new Error("no editor attached to the DOM element")},setData:function setData($editable,data){var editor=$editable.data("editor");if(editor)_.isString(data)&&editor.setData(_.escape(data));else throw new Error("no editor attached to the DOM element")},focus:function focus($editable){_find($editable,"html-editable").each(function(){var editor=$(this).data("editor");editor&&_focus(editor)})}},editorFactory}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/text",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"textBlockCssClass\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Text Block CSS Class",options):helperMissing.call(depth0,"__","Text Block CSS Class",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Set a CSS class name in order to customize the display style.",options):helperMissing.call(depth0,"__","Set a CSS class name in order to customize the display style.",options)))+"</div>\n    <input type=\"text\" name=\"textBlockCssClass\" value=\"",(helper=helpers.textBlockCssClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.textBlockCssClass,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/static/text"],function(stateFactory,Active,htmlEditor,content,formElement,formTpl){'use strict';var TextActive=stateFactory.extend(Active,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return TextActive.prototype.buildEditor=function(){var widget=this.widget,$editableContainer=widget.$container,container=widget.element,changeCallback=content.getChangeCallback(container);$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:function change(data){changeCallback.call(this,data),data||widget.$form.find("[name=\"textBlockCssClass\"]").val("")},blur:function blur(){widget.changeState("sleep")},data:{widget:widget,container:container}})},TextActive.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},TextActive.prototype.initForm=function(){var widget=this.widget,$form=widget.$form,blockCls=widget.$container.find(".custom-text-box").attr("class");$form.html(formTpl({textBlockCssClass:(blockCls||"").replace("custom-text-box","").trim()})),formElement.initWidget($form),formElement.setChangeCallbacks($form,widget.element,{textBlockCssClass:function textBlockCssClass(element,value){var $block=widget.$container.find(".custom-text-box");value=value.trim(),"custom-text-box"===value&&(value=""),value?(!$block.length&&($block=widget.$container.find("[data-html-editable=\"true\"]").wrapInner("<div />").children()),$block.attr("class","custom-text-box "+value)):$block.children().unwrap()}})},TextActive}),define("taoQtiItem/qtiCreator/widgets/static/text/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/text/states/Sleep","taoQtiItem/qtiCreator/widgets/static/text/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"mini-tlb\" data-edit=\"",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"rgt tlb-button\" title=\"Delete\" data-role=\"delete\">\n        <span class=\"icon-bin\"></span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/text/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/text/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function($,Widget,states,toolbarTpl){var TextWidget=Widget.clone();return TextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},TextWidget.buildContainer=function(){var $wrap=$("<div>",{"data-serial":this.element.serial,"data-qti-class":"_container",class:"widget-box widget-block widget-textBlock"}).append($("<div>",{"data-html-editable":!0}));this.$original.wrapInner($wrap),this.$container=this.$original.children(".widget-box")},TextWidget.createToolbar=function(){var _this=this,$tlb=$(toolbarTpl({serial:this.serial,state:"active"}));return this.$container.append($tlb),$tlb.find("[data-role=\"delete\"]").on("click.widget-box",function(e){e.stopPropagation(),_this.changeState("deleting")}),this},TextWidget}),define("taoQtiItem/qtiCreator/editor/blockAdder/blockAdder",["jquery","lodash","tpl!taoQtiItem/qtiCreator/editor/blockAdder/tpl/addColumnRow","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/elementSelector/selector","taoQtiItem/qtiCreator/widgets/static/text/Widget"],function($,_,adderTpl,Element,creatorRenderer,containerHelper,contentHelper,elementSelector,TextWidget){'use strict';function _appendButton($widget){if(!$widget.children(".add-block-element").length&&!$widget.parent(".colrow.tmp").length){var $adder=$(adderTpl());$widget.append($adder),$adder.on("click mouseenter mouseleave",function(e){e.stopPropagation(),$(this).parent().trigger("mouseleave")})}}function _insertElement(qtiClass,$placeholder){$placeholder.removeAttr("id"),"rubricBlock"===qtiClass&&($placeholder=$placeholder.parent(".col-12").parent(".grid-row")),$placeholder.addClass("widget-box"),$placeholder.attr({"data-new":!0,"data-qti-class":qtiClass});var $widget=$placeholder.parent().closest(".widget-box, .qti-item"),$editable=$placeholder.closest("[data-html-editable], .qti-itemBody"),widget=$widget.data("widget"),element=widget.element,container=Element.isA(element,"_container")?element:element.getBody();if(!element||!$editable.length)throw new Error("cannot create new element");containerHelper.createElements(container,contentHelper.getContent($editable),function(newElts){var creator=creatorRenderer.get();creator.load(function(){for(var serial in newElts){var elt=newElts[serial],$colParent=$placeholder.parent(),$widget,widget;if(elt.setRenderer(this),Element.isA(elt,"_container")){$placeholder.replaceWith("<div class=\"text-block\"></div>");var $textBlock=$colParent.find(".text-block");$textBlock.html(elt.render()),widget=TextWidget.build(elt,$textBlock,creator.getOption("textOptionForm"),{ready:function ready(){this.$container.unwrap()}}),$widget=widget.$container}else elt.render($placeholder),elt.postRender(),widget=elt.data("widget"),$widget=Element.isA(elt,"blockInteraction")?widget.$container:widget.$original;$widget.trigger("contentChange.gridEdit"),$widget.trigger("resize.gridEdit")}},this.getUsedClasses())})}return{create:function(item,$editorPanel,interactions){function _getItemBody(){return $editorPanel.find(".qti-itemBody")}function _initInsertion($widget){var $wrap=$("<div class=\"colrow\"></div>"),$colRow=$widget.parent(".colrow");$itemEditorPanel.trigger("beforesave.qti-creator.active"),$colRow.length||($widget.wrap("<div class=\"colrow\"></div>"),$colRow=$widget.parent(".colrow")),$colRow.after($wrap),selector=elementSelector.create($wrap,$editorPanel,interactions),$editorPanel.off(".element-selector").on("selected.element-selector",function(e,qtiClass){var $placeholder=$("<div class=\"placeholder\">");widget&&(widget.element.remove(),widget=null,$wrap.find(".widget-box").remove()),$wrap.addClass("tmp").prepend($placeholder),_insertElement(qtiClass,$placeholder),selector.reposition()}).on("done.element-selector",function(){_done($wrap)}).on("cancel.element-selector",function(){_cancel($wrap)}),$itemEditorPanel.on("click.block-adder mousedown.block-adder",function(e){var popup=selector.getPopup()[0];popup===e.target||$.contains(popup,e.target)||_done($wrap)}),selector.activateElement("_container"),selector.activatePanel("Text Block"),_getItemBody().addClass("edit-inserting")}function _endInsertion(){selector.destroy(),selector=null,widget=null,$editorPanel.off(".element-selector"),_getItemBody().removeClass("edit-inserting"),item.body(contentHelper.getContent(_getItemBody())),$itemEditorPanel.off(".block-adder")}function _done($wrap){$wrap.removeClass("tmp"),_appendButton(widget.$container),_.defer(function(){widget.element.is("interaction")?widget.changeState("question"):widget.changeState("active"),_endInsertion()})}function _cancel($wrap){widget.element.remove(),$wrap.remove(),_endInsertion()}var $itemEditorPanel=$("#item-editor-panel"),selector,widget;$editorPanel.find(".widget-block, .widget-blockInteraction").each(function(){_appendButton($(this))}),$editorPanel.on("mousedown",".add-block-element .circle",function(e){e.preventDefault(),e.stopPropagation();var $widget=$(this).parents(".widget-box");_initInsertion($widget)}).on("ready.qti-widget",function(e,_widget){var qtiElement=_widget.element;(qtiElement.is("blockInteraction")||qtiElement.is("_container")||qtiElement.is("customInteraction"))&&(_appendButton(_widget.$container),selector&&_widget.$container.parent(".colrow.tmp").length&&(qtiElement.is("customInteraction")&&qtiElement.onPciReady(function(){selector.reposition()}),selector.reposition(),widget=_widget))})}}}),define("taoQtiItem/qtiCreator/editor/ckEditor/ckProtector",["jquery","i18n"],function($,__){'use strict';var ckeProtector=function(){var selector=".widget-box",observeContentChanges=function($context){var contextDomNode=$context[0],MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(!MutationObserver)contextDomNode.addEventListener("DOMCharacterDataModified",function(){$context.trigger("contentchange.protector")},!1);else{var observer=new MutationObserver(function(mutations){mutations.forEach(function(){$context.trigger("contentchange.protector")})});observer.observe(contextDomNode,{subtree:!0,characterData:!0})}},getSelector=function(){return selector},protect=function(context,selectorParam){selectorParam&&(selector=selectorParam),context.find(selector).each(function(){var widget=$(this),iWidth=widget.outerWidth(),iHeight=widget.outerHeight(),cover=$("<button class=\"cke-cover-up\">"),getProtectedWidgetBySerial=function(serial){return $("[data-serial=\""+serial+"\"]").each(function(){var widget=$(this);if(widget.parent().hasClass("cke-qti-wrapper"))return!1}),widget.length?widget:$()},positionCover=function(cover){var wrapper=getProtectedWidgetBySerial(cover.prop("serial")).parent(".cke-qti-wrapper"),iOffset=wrapper.offset();cover.css({left:iOffset.left,top:iOffset.top})},wrapper;return!widget.parent(".cke-qti-wrapper").length&&void(widget.find("*").each(function(){this.innerHTML||(this.innerHTML="&#8203;")}),widget.wrap($("<span class=\"cke-qti-wrapper\" />")),wrapper=widget.parent(),cover.css({width:iWidth,height:iHeight}),$("body").append(cover),wrapper.css({width:iWidth,height:iHeight}),wrapper.attr("contenteditable",!1),wrapper.prop("cover",cover),cover.prop("serial",widget.data("serial")),positionCover(cover),cover.attr("title",__("Click to display interaction widget")),cover.on("click",function(){var widget=getProtectedWidgetBySerial($(this).prop("serial"));$(document).trigger("removeprotection.ckprotector",{context:context,widget:widget})}),observeContentChanges(context),context.on("contentchange.protector",function(){positionCover(cover)}))})};return{protect:protect,unprotect:function unprotect(widget){widget.each(function(){var widget=$(this),wrapper=widget.parent(".cke-qti-wrapper");wrapper.length&&(wrapper.prop("cover").remove(),widget.unwrap())})},getSelector:getSelector}}();return ckeProtector}),define("taoQtiItem/qtiCreator/editor/ckEditor/groupToggler",["lodash","core/eventifier"],function(_,eventifier){'use strict';return function(){var _registry=[];return eventifier({register:function($trigger){var self=this,id=_.uniqueId("group-toggler-");return $trigger&&$trigger.length?($trigger.data("group-toggler-id")||($trigger.data("group-toggler-id",id).on("show.grouptoggler",function(){self.trigger("show",id)}),_registry.push({id:id,dom:$trigger})),this):(this.trigger("error","trigger does not exist"),this)}}).on("show",function(id){_.each(_registry,function(element){element.id!==id&&element.dom.trigger("showanother.grouptoggler",id)})})}}),define("tpl!taoQtiItem/qtiCreator/editor/colorPicker/tpl/popup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"color-picker-container sidebar-popup\">\n    <div class=\"sidebar-popup-title\">\n        <h3 style=\"font-size:13px;margin:0\"></h3>\n        <a class=\"closer\" href=\"#\"></a>\n    </div>\n    <div class=\"sidebar-popup-content\">\n        <div class=\"color-picker\"></div>\n        <input class=\"color-picker-input\" type=\"text\" value=\"#000000\">\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/editor/colorPicker/colorPicker",["jquery","lodash","i18n","taoQtiItem/qtiCreator/helper/popup","tpl!taoQtiItem/qtiCreator/editor/colorPicker/tpl/popup","lib/farbtastic/farbtastic"],function($,_,__,popup,popupTpl){'use strict';var _defaults={title:__("Color Picker"),offsetTop:-40};return{create:function($colorTrigger,config){config=_.defaults(config||{},_defaults);var $input=$colorTrigger.siblings("input"),color;config.color?(color=config.color,$input.val(color)):color=$input.val(),$colorTrigger.css("background-color",color);var $popup=$(popupTpl());$colorTrigger.data("color-picker",$popup),$("#item-editor-wrapper").append($popup),popup.init($colorTrigger,{popup:$popup}),$colorTrigger.on("open.popup",function(e,params){var $trigger=$(this),$container=$trigger.parents(".sidebar-popup"),color=$input.val(),$colorPicker=params.popup.find(".color-picker"),$colorPickerInput=params.popup.find(".color-picker-input"),title;params.popup.css({right:$(window).width()-$container.offset().left+2,top:$trigger.offset().top+config.offsetTop-$("#item-editor-wrapper").offset().top}),_.isFunction(config.title)?title=config.title.call(this):_.isString(config.title)&&(title=config.title),params.popup.find("h3").text(title),$colorPicker.farbtastic($colorPickerInput),$colorPickerInput.val(color).trigger("keyup"),config.color=color,params.popup.find(".closer").off("click").on("click",function(){params.popup.hide(),$colorPicker.off(".farbtastic")}),$colorPicker.off(".farbtastic").on("colorchange.farbtastic",function(e,color){$colorTrigger.css("background-color",color),$input.val(color).trigger("change")})}),$colorTrigger.on("close.popup",function(e,params){params.popup.find(".color-picker").off(".farbtastic")})},destroy:function($colorTrigger){$colorTrigger.off(".color-picker"),$colorTrigger.removeAttr("data-color-picker");var $popup=$colorTrigger.data("color-picker");$popup instanceof $&&$popup.remove()}}}),define("taoQtiItem/qtiCreator/model/Container",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Container"],function(_,editable,Container){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{afterCreate:function afterCreate(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>")},beforeRemove:function beforeRemove(){_.each(this.getComposingElements(),function(element){_.isFunction(element.beforeRemove)&&element.beforeRemove()})}}),Container.extend(methods)}),define("taoQtiItem/qtiCreator/editor/containerEditor",["lodash","jquery","core/promise","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Container","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/qtiClasses","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiItem/helper/simpleParser","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/xincludeRenderer","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor"],function(_,$,Promise,Loader,Container,Item,event,allQtiClasses,commonRenderer,xmlRenderer,simpleParser,creatorRenderer,xincludeRenderer,content,htmlEditor){"use strict";function parser($container){var data=simpleParser.parse($container.clone(),{ns:{math:"m"}});if(data.body)return data.body;throw new Error("invalid content for qti container")}function buildContainer($container){$container.wrapInner($("<div>",{class:"container-editor","data-html-editable":!0}))}function cleanup($container){var container=$container.data("container");return new Promise(function(resolve){container?($(document).off("."+container.serial),commonRenderer.load(["img","object","math","include","_container","printedVariable","_tooltip"],function(){$container.html(container.render(this)),resolve()}),$container.removeData("container")):resolve()})}function createFakeWidget($editableContainer,container,options){var widget={$container:$editableContainer,element:container,changeState:_.noop,getAreaBroker:function(){return options.areaBroker}};return container.data("widget",widget),widget}function buildEditor($editableContainer,container,options){$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,_.defaults(options||{},{shieldInnerContent:!1,passthroughInnerContent:!1,change:content.getChangeCallback(container),data:{widget:createFakeWidget($editableContainer,container,options),container:container}}))}function extractHtmlFromMarkup(markupStr,selector){var $found=$("<div>").html(markupStr).find(selector),ret=[];return $found.each(function(){ret.push($(this).html())}),ret}var _defaults={change:_.noop,markup:"",markupSelector:"",qtiMedia:!1};return event.initElementToWidgetListeners(),{create:function($container,options){var html,htmls,data,loader;options=_.defaults(options||{},_defaults),options.markup&&(html=options.markup,options.markupSelector&&(htmls=extractHtmlFromMarkup(html,options.markupSelector),html=htmls[0]||""),$container.html(html)),data=parser($container),loader=new Loader().setClassesLocation(allQtiClasses),loader.loadRequiredClasses(data,function(){var container=new Container,item,containerEditors,renderer;container.data("stateless",!0),$container.data("container",container),item=new Item().setElement(container),container.setRootElement(item),options.metadata&&_.each(options.metadata,function(value,name){item.data(name,value)}),options.related&&(containerEditors=options.related.data("container-editors")||[],containerEditors.push(container),options.related.data("container-editors",containerEditors)),this.loadContainer(container,data),renderer=creatorRenderer.get(options.resetRenderer,{},options.areaBroker),renderer.load(function(){var baseUrl=this.getOption("baseUrl");container.setRenderer(this),$container.html(container.render()),container.postRender(),_.each(container.getComposingElements(),function(element){"include"===element.qtiClass&&xincludeRenderer.render(element.data("widget"),baseUrl)}),buildContainer($container),buildEditor($container,container,{placeholder:options.placeholder||void 0,toolbar:options.toolbar||void 0,qtiMedia:options.qtiMedia,highlight:options.highlight,removePlugins:options.removePlugins||"",areaBroker:options.areaBroker,autofocus:options.autofocus||!1}),$container.off(".containereditor").on(event.getList("containereditor"+event.getNs()+event.getNsModel()).join(" "),_.throttle(function(){var editorContent=container.render(xmlRenderer.get());$container.trigger("containerchange.containereditor",[editorContent]),_.isFunction(options.change)&&options.change(editorContent)},600)),$container.trigger("editorready.containereditor")},["img","object","math","include","printedVariable","_container","_tooltip"])})},destroy:function($editableContainer){return htmlEditor.destroyEditor($editableContainer).then(function(){return $editableContainer.removeAttr("data-html-editable-container"),cleanup($editableContainer)})}}}),define("taoQtiItem/qtiCreator/editor/customInteractionRegistry",["taoQtiItem/portableElementRegistry/ciRegistry"],function(ciRegistry){"use strict";return console.warn("deprected use of \"taoQtiItem/qtiCreator/editor/customInteractionRegistry\", please use \"taoQtiItem/portableElementRegistry/ciRegistry\" now"),{get:function(id){var portableElement={};return console.warn("deprected use of \"taoQtiItem/qtiCreator/editor/customInteractionRegistry::get()\", please use \"taoQtiItem/portableElementRegistry/ciRegistry::get()\" now"),portableElement.manifest=ciRegistry.get(id),portableElement},getBaseUrl:function(id){return console.warn("deprected use of \"taoQtiItem/qtiCreator/editor/customInteractionRegistry::getBaseUrl()\", please use \"taoQtiItem/portableElementRegistry/ciRegistry::getBaseUrl()\" now"),this.get(id).manifest.baseUrl}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/arrow",["jquery","lodash"],function($,_){"use strict";var _removeArrows=function($col){$col.find(".grid-edit-insert-box").remove()},_arrowFall=function($insert,callback){var interval=null;$insert.on("mouseenter",function(e){var relY=e.pageY-$(this).offset().top-parseInt($(this).find(".grid-edit-insert-triangle").outerHeight())-parseInt($(this).find(".grid-edit-insert-square").outerHeight()),$arrow=$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square"),t=0;interval=setInterval(function(){var top=9.81*.5*Math.pow(t,2)/100;$arrow.css("top",top),top>relY&&(clearInterval(interval),callback()),t++},10)}).on("mouseleave",function(){$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square").css("top",0),clearInterval(interval)})};return{create:function($col,options){options=_.extend({insertZoneWidth:20,marginWidth:0},options);var $insertRight=$("<div>",{class:"grid-edit-insert-box"}).css({top:0,width:options.insertZoneWidth,right:-(options.marginWidth+(options.insertZoneWidth-options.marginWidth)/2),height:$col.parent(".grid-row").height()-parseFloat($col.css("margin-bottom"))}).append($("<div>",{class:"grid-edit-insert-square"})).append($("<div>",{class:"grid-edit-insert-triangle"})).append($("<div>",{class:"grid-edit-insert-line"})).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){$col.trigger("arrowenter.gridEdit.gridDragDrop",["right"]),_removeArrows($col)}),$insertLeft=$insertRight.clone().css({left:-(options.marginWidth+5),right:"auto"}).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){$col.trigger("arrowenter.gridEdit.gridDragDrop",["left"]),_removeArrows($col)});$col.append($insertRight).append($insertLeft),_arrowFall($insertRight,function(){$col.trigger("arrowenter.gridEdit.gridDragDrop",["right"]),_removeArrows($col)}),_arrowFall($insertLeft,function(){$col.trigger("arrowenter.gridEdit.gridDragDrop",["left"]),_removeArrows($col)})}}}),define("taoQtiItem/qtiCreator/editor/targetFinder",["jquery","lodash","ui/ckeditor/dtdHandler","taoQtiItem/qtiCreator/helper/qtiElements"],function($,_,dtdHandler,qtiElements){'use strict';var _qtiHtmlEditableTypes={itemBody:".widget-textBlock > [data-html-editable], .widget-textBlock .widget-table table[data-html-editable]",prompt:".qti-prompt[data-html-editable]",choice:".qti-choice [data-html-editable]"},targetFinder=function($,_,dh){var inheritedFunctions=function(){var fns={},fn;for(fn in dh)dh.hasOwnProperty(fn)&&dh[fn]instanceof Function&&(fns[fn]=dh[fn]);return fns}();return _.extend(inheritedFunctions,{getTargetsFor:function getTargetsFor(qtiClass,context){var $targets=$(),child,$qtiContainers;context=context||document.body,context=$(context),qtiElements.is(qtiClass,"inlineInteraction")?($qtiContainers=context.find(_qtiHtmlEditableTypes.itemBody),child="object"):($qtiContainers=context.find(_.values(_qtiHtmlEditableTypes).join(",")),$qtiContainers=context.find(_qtiHtmlEditableTypes.itemBody),child="math"===qtiClass?"object":"object.audio"===qtiClass||"object.video"===qtiClass?"object":qtiClass);var parents=dh.getParentsOf(child),parentSelector=parents.join(",");return $qtiContainers.each(function(){var $qtiContainer=$(this),$widget=$qtiContainer.closest(".widget-box");$qtiContainer.is(parentSelector)&&($targets=$targets.add($qtiContainer)),$targets=$targets.add($qtiContainer.find(parentSelector).not(function(){var $closest=$(this).closest(".widget-box");return $closest.length&&$closest[0]!==$widget[0]}))}),$targets}})}($,_,dtdHandler);return targetFinder}),define("taoQtiItem/qtiCreator/editor/gridEditor/droppable",["jquery","lodash","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/arrow","taoQtiItem/qtiCreator/editor/targetFinder"],function($,_,gridUnits,qtiElements,helper,arrow,targetFinder){"use strict";var _Mathmax11=Math.max;function _destroyDroppableInlines($el){$el.off(".gridEdit.gridDragDrop"),$el.find("span.qti-word-wrap").replaceWith(function(){return _.escape($(this).text())}),$el.find(".drop-target").removeClass("drop-target")}function _destroyDroppableBlocks($el){$el.off(".gridEdit.gridDragDrop");$el.removeClass("dropping").off(".gridEdit.gridDragDrop"),$el.find("[class^=\"col-\"], [class*=\" col-\"]").removeAttr("style"),_restoreTmpCol($el),$el.find(["#qti-block-element-placeholder",".new-col",".grid-row-new",".grid-edit-insert-box"].join(",")).remove()}function _getNewRow(){return $("<div>",{class:"grid-row grid-row-new","data-units":0})}function _getNewCol(){return $("<div>",{class:"new-col"})}function _restoreTmpCol($el){$el.find(".grid-row").each(function(){var $row=$(this),$children;$row.children(".new-col").attr("class","new-col").removeAttr("style"),$row.hasClass("grid-row-new")&&($children=$row.children(),1<$children.length&&($row.prev().append($children),$row.append($children.first()))),$row.children(":not(.new-col)").each(function(){var $col=$(this),originalClasses=$col.attr("data-original-class");originalClasses&&$col.attr("class",originalClasses).removeAttr("data-original-class")}),$row.removeAttr("data-active")})}var droppableGridEditor={createDroppableBlocks:function(qtiClass,$el,options){options=options||{};var minUnits="string"==typeof options.min?options.min:0,$colInitial=options.initialPosition instanceof $?options.initialPosition:null,ns=options.namespace?"."+options.namespace:"",data=options.data||{},$placeholder=$("<div>",{id:"qti-block-element-placeholder",class:"qti-droppable-block-hover"}),marginWidth=parseFloat($el.find("[class^=\"col-\"], [class*=\" col-\"]").last().css("margin-left")),isEmpty=0===$el.children(".grid-row").length;$el.addClass("dropping"),isEmpty?$el.append(_getNewRow().append(_getNewCol().addClass("col-12"))):$el.find(".grid-row").each(function(){var $row=$(this),cols=[],maxHeight=0,$cols=$row.children(":not(.new-col)").each(function(){$(this).before(_getNewCol().attr("data-index",$(this).index()/2)),maxHeight=_Mathmax11($(this).height(),maxHeight),cols.push({elt:$(this),units:parseInt($(this).attr("data-units"))})});$cols.last().after(_getNewCol().attr("data-index","last")),$cols.height(maxHeight),$row.data("distributed-units",gridUnits.distribute(cols,minUnits,12)),$row.before(_getNewRow().append(_getNewCol()))}).last().after(_getNewRow().append(_getNewCol()));var _appendPlaceholder=function($col){$col.length&&($placeholder.data("dropped",!0).show().parent().removeClass("col-12").parent().removeData("active"),$col.append($placeholder))},_resetPlaceholder=function(){$placeholder.parent().parent().removeData("active"),$placeholder.removeData("dropped").hide(),$el.append($placeholder)},_insertBetween=function($col,location){if("left"===location||"right"===location){_restoreTmpCol($el);var $row=$col.parent().attr("data-active",!0);$row.children(":not(.new-col)").each(function(){$(this).attr("data-original-class",$(this).attr("class"))});var distributedUnits=$row.data("distributed-units"),$newCol="left"===location?$col.prev():$col.next();if(_appendPlaceholder($newCol),12<distributedUnits.refactoredTotalUnits){var newUnit=$newCol.is(":last-child")&&distributedUnits.last?distributedUnits.last:distributedUnits.middle;$newCol.attr("class","new-col col-"+newUnit);var cumulatedUnits=0,index=$newCol.data("index"),_appendToNextRow=function($row,$newCol){$row.next().attr("data-active",!0).append($newCol)};if("last"===index)_appendToNextRow($row,$newCol);else for(var i in distributedUnits.cols){i==index&&(12<cumulatedUnits+newUnit&&_appendToNextRow($row,$newCol),cumulatedUnits+=newUnit);var col=distributedUnits.cols[i];12<cumulatedUnits+col.refactoredUnits&&_appendToNextRow($row,col.elt),col.elt.attr("class","col-"+col.refactoredUnits),cumulatedUnits+=col.refactoredUnits}}else $newCol.is(":last-child")&&distributedUnits.last?$newCol.attr("class","new-col col-"+distributedUnits.last):$newCol.attr("class","new-col col-"+distributedUnits.middle),_.each(distributedUnits.cols,function(col){col.elt.attr("class","col-"+col.refactoredUnits)});var h=_resetColsHeight($col);$placeholder.css("height","100%").parent().height(h)}},_resetColsHeight=function($col,self){var maxHeight=0;void 0===self&&(self=!0),$placeholder.css("height","auto").parent().removeAttr("style");var $cols=$col.siblings("[class^=\"col-\"]:not(.new-col), [class*=\" col-\"]:not(.new-col)").addBack();return $cols.removeAttr("style"),$cols.each(function(){maxHeight=_Mathmax11($(this).height(),maxHeight)}),$cols.height(maxHeight),self||$col.removeAttr("style"),maxHeight};if(_resetPlaceholder(),$colInitial&&$colInitial.length){var $prev=$colInitial.prevAll("[class^=\"col-\"], [class*=\" col-\"]").first(),$next=$colInitial.nextAll("[class^=\"col-\"], [class*=\" col-\"]").first();$prev.length?_insertBetween($prev,"right"):$next.length&&_insertBetween($next,"left")}$el.on("mouseover.gridEdit.gridDragDrop",function(){var $previousCol=$placeholder.parent(".new-col");_restoreTmpCol($el),_resetColsHeight($previousCol,!1);var $newCol=$el.find(".new-col:last").css("background","1px solid red");_appendPlaceholder($newCol),$newCol.addClass("col-12")}).on("mouseover.gridEdit.gridDragDrop",".grid-row",function(e){e.stopPropagation()}).on("mouseenter.gridEdit.gridDragDrop","[class^=\"col-\"]:not(.new-col), [class*=\" col-\"]:not(.new-col)",function(){var $col=$(this),$previousCol=$placeholder.parent(".new-col");_resetPlaceholder(),_restoreTmpCol($el),_resetColsHeight($previousCol,!1),_resetColsHeight($col),arrow.create($col,{marginWidth:marginWidth})}).on("arrowenter.gridEdit.gridDragDrop","[class^=\"col-\"]:not(.new-col), [class*=\" col-\"]:not(.new-col)",function(e,position){_insertBetween($(this),position)}).on("mousemove.gridEdit.gridDragDrop","[class^=\"col-\"]:not(.new-col), [class*=\" col-\"]:not(.new-col)",function(e){var $col=$(this),h=$col.height(),relY=e.pageY-$col.offset().top,$newRow=relY<h/2?$col.parent().prev():$col.parent().next();if(!$newRow.find("#qti-block-element-placeholder").length){var $newCol=$newRow.attr("data-active",!0).children(".new-col").addClass("col-12");$newCol.length?_appendPlaceholder($newCol):console.log("insert form col failure ",$col,$newRow)}}).on("mouseleave.gridEdit.gridDragDrop","[class^=\"col-\"], [class*=\" col-\"]",function(){$(this).find(".grid-edit-insert-box").remove()}).on("mouseleave.gridEdit.gridDragDrop",function(e){e.stopPropagation(),$placeholder.hide(),_resetPlaceholder(),_restoreTmpCol($el)}),$el.one("dragoverstop.gridEdit",function(){var $selectedCol,dropped;$el.off(".gridEdit.gridDragDrop"),$selectedCol=$placeholder.parent(".new-col"),dropped=!!$selectedCol.length,dropped&&($placeholder.removeAttr("id").removeClass("qti-droppable-block-hover"),$selectedCol.data("qti-class",qtiClass).removeClass("new-col").removeAttr("data-index"),helper.setUnitsFromClass($selectedCol),$selectedCol.parent(".grid-row-new").removeClass("grid-row-new"),$el.find(".grid-row[data-active=true]").each(function(){var $row=$(this);$row.removeClass("grid-row-new"),$row.children(":not(.new-col)").removeAttr("data-original-class").each(function(){helper.setUnitsFromClass($(this))})})),_destroyDroppableBlocks($el),dropped&&$placeholder.data("dropped")&&$el.trigger("dropped.gridEdit"+ns,[qtiClass,$placeholder,data])})}},_pulseTimer=null,_pulse=function($el){_pulseTimer&&clearInterval(_pulseTimer),setInterval(function(){$el.animate({opacity:.1},500,function(){$el.animate({opacity:.9},500)})},1000)};return droppableGridEditor.createDroppableInlines=function(qtiClass,$el,options){var ns=options.namespace?"."+options.namespace:"",data=options.data||{},$targets=targetFinder.getTargetsFor(qtiClass,$el),dropped=!1,_resetPlaceholder=function(){$placeholder.detach(),dropped=!1},_showPlaceholder=function(){return dropped=!0,$placeholder},$placeholder;$targets.addClass("drop-target"),$targets.contents().each(function(){3!==this.nodeType||this.nodeValue.match(/^\s+$/)||$(this).replaceWith($.map(this.nodeValue.split(/(\S+)/),function(w){return w.match(/^\s*$/)?document.createTextNode(w):$("<span>",{text:w,class:"qti-word-wrap"}).get()}))}),$placeholder=$("<span>",{id:"qti-inline-element-placeholder","data-inline":!0}),$placeholder.append($("<span>",{class:"cursor-h"})).append($("<span>",{class:"cursor-v"})),_pulse($placeholder),_resetPlaceholder($el),$el.on("mousemove.gridEdit.gridDragDrop","span.qti-word-wrap",function(e){var w=$(this).width(),parentOffset=$(this).offset(),relX=e.pageX-parentOffset.left;$placeholder,relX<w/2?$(this).before(_showPlaceholder()):$(this).after(_showPlaceholder())}).on("mouseover.gridEdit.gridDragDrop",function(e){var $target;e.stopPropagation(),$target=$(e.target),$target.hasClass("drop-target")&&!$target.find($placeholder).length?$target.append(_showPlaceholder()):$target[0]!==$placeholder[0]&&!$target.hasClass("qti-word-wrap")&&!$target.children(".qti-word-wrap").length&&_resetPlaceholder($el)}),$el.one("dragoverstop.gridEdit",function(){dropped&&$placeholder.removeAttr("id").removeAttr("class"),_destroyDroppableInlines($el),dropped?$el.trigger("dropped.gridEdit"+ns,[qtiClass,$placeholder,data]):($placeholder.remove(),$placeholder=null)})},droppableGridEditor.destroyDroppables=function($el){_destroyDroppableInlines($el),_destroyDroppableBlocks($el)},droppableGridEditor}),define("taoQtiItem/qtiCreator/editor/gridEditor/draggable",["jquery","lodash","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/droppable","taoQtiItem/lib/jqueryui_dragdrop"],function($,_,QtiElements,droppable){"use strict";var _insertableDefaultsOptions={helper:function helper(){return $(this).clone()}},_createInsertable=function($el,$to,opts){var options=_.defaults(opts,_insertableDefaultsOptions);createDraggable($el,$to,{helper:options.helper,namespace:"insertable"})},createDraggable=function($el,$to,opts){var options=_.defaults(opts,{distance:1,helper:"original"});$el.draggable({distance:parseInt(options.distance),helper:options.helper,appendTo:$(document.body),opacity:1,scroll:!1,cursor:"crosshair",cursorAt:{left:-5,bottom:-5},create:function create(){$(this).addClass("grid-draggable")},start:function start(e,ui){var qtiClass=$(this).data("qti-class");if($to.trigger("beforedragoverstart.gridEdit"),"function"==typeof options.start&&options.start.call(this,e,ui),$(this).removeClass("grid-draggable-active"),QtiElements.isInline(qtiClass))droppable.createDroppableInlines(qtiClass,$to,options);else if(QtiElements.isBlock(qtiClass))droppable.createDroppableBlocks(qtiClass,$to,options);else throw"undefined qti class";$to.trigger("dragoverstart.gridEdit")},stop:function stop(e,ui){$("body").css("cursor","auto"),ui.helper.remove(),"function"==typeof options.stop&&options.stop.call(this,e,ui),$to.trigger("dragoverstop.gridEdit")}}),$el.on("mousedown.gridDraggable.gridEdit",function(){$(this).addClass("grid-draggable-active")}).on("mouseup.gridDraggable.gridEdit",function(){$(this).removeClass("grid-draggable-active")})},_createMovable=function($el,$to){var $parent=$el.parent("[class^=\"col-\"], [class*=\" col-\"]");createDraggable($el,$to,{distance:5,initialPosition:$el.parent(),namespace:"movable",start:function start(){$el.hide(),$parent.data({"initial-position":!0,"initial-class":$parent.attr("class")}).attr("class","new-col")},helper:function helper(){return $(this).clone().addClass("grid-draggable-helper").css({height:$(this).height(),width:$(this).width()})},stop:function stop(){$el.data("grid-element-dropped")||$parent.attr("class",$parent.data("initial-class")),$el.data("grid-element-dropped",!1),$el.show()},data:{widget:$el.data("widget")}})};return{createInsertable:function createInsertable($el,$to,opts){_createInsertable($el,$to,opts)},createMovable:function createMovable($el,$to,opts){_createMovable($el,$to,opts)},destroy:function($el){$el.draggable("destroy"),$el.removeClass("grid-draggable"),$el.off(".gridDraggable")}}}),define("taoQtiItem/qtiCreator/editor/infoControlRegistry",["taoQtiItem/portableElementRegistry/icRegistry"],function(icRegistry){"use strict";return console.warn("deprected use of \"taoQtiItem/qtiCreator/editor/infoControlRegistry\", please use \"taoQtiItem/portableElementRegistry/icRegistry\" now"),{get:function(id){var portableElement={manifest:icRegistry.get(id)};return portableElement}}}),define("taoQtiItem/qtiCreator/editor/jquery.gridEditor",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/gridEditor/draggable","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function($,helper,contentHelper,draggable,_resizable){'use strict';function isCreated($elt){return"object"===_typeof2($elt.data("qti-grid-options"))}function create($elt,options){$elt.data("qti-grid-options",options),$elt.find(".grid-row").each(function(){$(this).children("[class*=\" col-\"], [class^=\"col-\"]").each(function(){helper.setUnitsFromClass($(this))})})}function _destroy2($elt){contentHelper.destroyGridWidgets($elt)}function _getContent($el){return contentHelper.getContent($el)}$.fn.gridEditor=function(options){var opts={},method="",args=[],ret=void 0;return"object"===_typeof2(options)?opts=$.extend({},$.fn.gridEditor.defaults,options):void 0===options?opts=$.extend({},$.fn.gridEditor.defaults):"string"==typeof options&&"function"==typeof methods[options]&&(method=options,args=Array.prototype.slice.call(arguments,1)),this.each(function(){var $this=$(this);method?isCreated($this)?ret=methods[method].apply($(this),args):$.error("call of method of gridEditor while it has not been initialized"):!isCreated($this)&&"object"===_typeof2(opts)&&create($this,opts)}),void 0===ret?this:ret},$.fn.gridEditor.defaults={elementClass:"itemBody"};var methods={addInsertables:function addInsertables($elts,options){var $grid=$(this);$elts.each(function(){draggable.createInsertable($(this),$grid,options)})},createMovables:function createMovables($elts){var $grid=$(this);$elts.each(function(){draggable.createMovable($(this),$grid)})},destroy:function destroy(){_destroy2($(this))},getContent:function getContent(){return _getContent($(this))},setContent:function(_setContent){function setContent(){return _setContent.apply(this,arguments)}return setContent.toString=function(){return _setContent.toString()},setContent}(function(content){content&&setContent($(this),content)}),resizable:function resizable(){_resizable.create($(this))}}}),define("taoQtiItem/qtiCreator/editor/MathEditor",["lodash","jquery","mathJax","ui/feedback"],function(_,$,MathJax,feedback){"use strict";var MathEditor=function(config){if(config=config||{},this.setMathML(config.mathML||""),this.tex=config.tex||"",this.display=config.display||"inline",this.processing=!1,this.$target=config.target||$(),config.buffer&&config.buffer instanceof $&&config.buffer.length)this.$buffer=config.buffer;else throw"missing required element in config \"buffer\""};MathEditor.prototype.setMathML=function(mathMLstr){return mathMLstr=_stripMathTags(mathMLstr),mathMLstr=_stripComments(mathMLstr),this.mathML=mathMLstr,this},MathEditor.prototype.setTex=function(texStr){return this.tex=texStr,this};var _processArguments=function(mathEditor,args){var ret={target:null,callback:null};if(_.each(args,function(arg){_.isFunction(arg)?ret.callback=arg:arg instanceof $&&(ret.target=arg)}),!ret.target)if(mathEditor.$target)ret.target=mathEditor.$target;else throw"no target defined for rendering";return ret};MathEditor.prototype.renderFromMathML=function(){var args=_processArguments(this,arguments);if("undefined"!=typeof MathJax){if(this.processing)return;var jaxQueue=MathJax.Hub.queue,mathStr=_wrapMathTags(this.mathML,"block"===this.display);this.$buffer.html(mathStr);var _this=this;jaxQueue.Push(["Typeset",MathJax.Hub,this.$buffer[0]],function(){var $script=_this.$buffer.find("script");_this.processing=!1,args.target.html(_this.$buffer.html()),$script.length&&(_this.mathML=_stripMathTags($script.html())),_this.$buffer.empty()}),args.callback&&jaxQueue.Push(args.callback)}},MathEditor.prototype.renderFromTex=function(){var args=_processArguments(this,arguments),_this=this,jaxQueue=MathJax.Hub.queue;"undefined"!=typeof MathJax&&("block"===this.display?_this.$buffer.text("\\[\\displaystyle{"+_this.tex+"}\\]"):_this.$buffer.text("\\(\\displaystyle{"+_this.tex+"}\\)"),jaxQueue.Push(["Typeset",MathJax.Hub,_this.$buffer[0]],function(){var texJax;try{args.target.html(_this.$buffer.html()),texJax=_getJaxByElement(_this.$buffer),_this.$buffer.empty(),"undefined"!=typeof texJax&&_this.texToMathML(texJax,function(mathML){_this.setMathML(_stripMathTags(mathML))})}catch(err){feedback().error("Mathjax error: "+err.message)}}),args.callback&&jaxQueue.Push(args.callback))};var _stripMathTags=function(mathMLstr){return mathMLstr=mathMLstr.replace(/<(\/)?math[^>]*>/g,""),mathMLstr=mathMLstr.replace(/^\s*[\r\n]/gm,""),mathMLstr=mathMLstr.replace(/\s*[\r\n]$/gm,""),mathMLstr},_stripComments=function(mathMLstr){return mathMLstr=mathMLstr.replace(/<!--.*?-->/g,""),mathMLstr=mathMLstr.replace(/&lt;!--.*?--&gt;/g,""),mathMLstr},_getJaxByElement=function($element){if($element instanceof $&&$element.length){var $script=$element.find("script");if($script.length&&$script[0].MathJax&&$script[0].MathJax.elementJax)return $script[0].MathJax.elementJax}},_wrapMathTags=function(mathMLstr,displayBlock){if(!mathMLstr.match(/<math[^>]*>/)){var display=displayBlock?" display=\"block\"":"";mathMLstr="<math"+display+">"+mathMLstr}return mathMLstr.match(/<\/math[^>]*>/)||(mathMLstr+="</math>"),mathMLstr};return MathEditor.prototype.texToMathML=function(texJax,callback){var _this=this,mathML="";try{mathML=_stripComments(texJax.root.toMathML(""))}catch(err){if(!err.restart)throw err;return MathJax.Callback.After(function(){_this.texToMathML(texJax,callback)},err.restart)}MathJax.Callback(callback)(mathML)},MathEditor}),define("taoQtiItem/lib/mathquill/mathquill",["jquery"],function(jQuery){var _StringfromCharCode3=String.fromCharCode,_Mathround7=Math.round;function noop(){}function variadic(fn){var numFixedArgs=fn.length-1;return function(){var args=__slice.call(arguments,0,numFixedArgs),varArg=__slice.call(arguments,numFixedArgs);return fn.apply(this,args.concat([varArg]))}}function iterator(generator){return variadic(function(fn,args){"function"!=typeof fn&&(fn=send(fn));var yield_=function(obj){return fn.apply(obj,[obj].concat(args))};return generator.call(this,yield_)})}function bind(cons){var args=__slice.call(arguments,1);return function(){return cons.apply(this,args)}}function pray(message,cond){if(!cond)throw new Error("prayer failed: "+message)}function prayDirection(dir){pray("a direction was passed",dir===-1||dir===1)}function prayWellFormed(parent,leftward,rightward){pray("a parent is always present",parent),pray("leftward is properly set up",function(){return leftward?leftward[1]===rightward&&leftward.parent===parent:parent.ends[-1]===rightward}()),pray("rightward is properly set up",function(){return rightward?rightward[-1]===leftward&&rightward.parent===parent:parent.ends[1]===leftward}())}function insistOnInterVer(){window.console&&console.warn("You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")}function MathQuill(el){return insistOnInterVer(),MQ1(el)}function getInterface(v){function MQ(el){if(!el||!el.nodeType)return null;var blockId=$(el).children(".mq-root-block").attr("mathquill-block-id"),ctrlr=blockId&&Node.byId[blockId].controller;return ctrlr?APIClasses[ctrlr.KIND_OF_MQ](ctrlr):null}function config(currentOptions,newOptions){for(var name in newOptions&&newOptions.handlers&&(newOptions.handlers={fns:newOptions.handlers,APIClasses:APIClasses}),newOptions)if(newOptions.hasOwnProperty(name)){var value=newOptions[name],processor=optionProcessors[name];currentOptions[name]=processor?processor(value):value}}if(!(MIN<=v&&v<=MAX))throw"Only interface versions between "+MIN+" and "+MAX+" supported. You specified: "+v;var APIClasses={};MQ.L=-1,MQ.R=1,MQ.config=function(opts){return config(Options.p,opts),this},MQ.registerEmbed=function(name,options){if(!/^[a-z][a-z0-9]*$/i.test(name))throw"Embed name must start with letter and be only letters and digits";EMBEDS[name]=options};var AbstractMathQuill=APIClasses.AbstractMathQuill=P(Progenote,function(_){_.init=function(ctrlr){this.__controller=ctrlr,this.__options=ctrlr.options,this.id=ctrlr.id,this.data=ctrlr.data},_.__mathquillify=function(classNames){var ctrlr=this.__controller,root=ctrlr.root,el=ctrlr.container;ctrlr.createTextarea();var contents=el.addClass(classNames).contents().detach();root.jQ=$("<span class=\"mq-root-block\"/>").attr("mathquill-block-id",root.id).appendTo(el),this.latex(contents.text()),this.revert=function(){return el.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(contents)}},_.config=function(opts){return config(this.__options,opts),this},_.el=function(){return this.__controller.container[0]},_.text=function(){return this.__controller.exportText()},_.latex=function(latex){return 0<arguments.length?(this.__controller.renderLatexMath(latex),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},_.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},_.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});for(var kind in MQ.prototype=AbstractMathQuill.prototype,APIClasses.EditableField=P(AbstractMathQuill,function(_,super_){_.__mathquillify=function(){return super_.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},_.focus=function(){return this.__controller.textarea.focus(),this},_.blur=function(){return this.__controller.textarea.blur(),this},_.write=function(latex){return this.__controller.writeLatex(latex),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},_.cmd=function(cmd){var ctrlr=this.__controller.notify(),cursor=ctrlr.cursor;if(/^\\[a-z]+$/i.test(cmd)){cmd=cmd.slice(1);var klass=LatexCmds[cmd];if(klass)cmd=klass(cmd),cursor.selection&&cmd.replaces(cursor.replaceSelection()),cmd.createLeftOf(cursor.show()),this.__controller.scrollHoriz();else;}else cursor.parent.write(cursor,cmd);return ctrlr.blurred&&cursor.hide().parent.blur(),this},_.select=function(){var ctrlr=this.__controller;for(ctrlr.notify("move").cursor.insAtRightEnd(ctrlr.root);ctrlr.cursor[-1];)ctrlr.selectLeft();return this},_.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},_.moveToDirEnd=function(dir){return this.__controller.notify("move").cursor.insAtDirEnd(dir,this.__controller.root),this},_.moveToLeftEnd=function(){return this.moveToDirEnd(-1)},_.moveToRightEnd=function(){return this.moveToDirEnd(1)},_.keystroke=function(keys){for(var keys=keys.replace(/^\s+|\s+$/g,"").split(/\s+/),i=0;i<keys.length;i+=1)this.__controller.keystroke(keys[i],{preventDefault:noop});return this},_.typedText=function(text){for(var i=0;i<text.length;i+=1)this.__controller.typedText(text.charAt(i));return this},_.dropEmbedded=function(pageX,pageY,options){var clientX=pageX-$(window).scrollLeft(),clientY=pageY-$(window).scrollTop(),el=document.elementFromPoint(clientX,clientY);this.__controller.seek($(el),pageX,pageY);var cmd=Embed().setOptions(options);cmd.createLeftOf(this.__controller.cursor)}}),MQ.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},MQ.EditableField.prototype=APIClasses.EditableField.prototype,API)(function(kind,defAPIClass){var APIClass=APIClasses[kind]=defAPIClass(APIClasses);MQ[kind]=function(el,opts){var mq=MQ(el);if(mq instanceof APIClass||!el||!el.nodeType)return mq;var ctrlr=Controller(APIClass.RootBlock(),$(el),Options());return ctrlr.KIND_OF_MQ=kind,APIClass(ctrlr).__mathquillify(opts,v)},MQ[kind].prototype=APIClass.prototype})(kind,API[kind]);return MQ}function RootBlockMixin(_){for(var names=["moveOutOf","deleteOutOf","selectOutOf","upOutOf","downOutOf"],i=0;i<names.length;i+=1)(function(name){_[name]=function(dir){this.controller.handle(name,dir)}})(names[i]);_.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function makeTextBlock(latex,tagName,attrs){return P(TextBlock,{ctrlSeq:latex,htmlTemplate:"<"+tagName+" "+attrs+">&0</"+tagName+">"})}function insLeftOfMeUnlessAtEnd(cursor){var cmd=this.parent,ancestorCmd=cursor;do{if(ancestorCmd[1])return cursor.insLeftOf(cmd);ancestorCmd=ancestorCmd.parent.parent}while(ancestorCmd!==cmd);cursor.insRightOf(cmd)}function DelimsMixin(_,super_){_.jQadd=function(){super_.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},_.reflow=function(){var height=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));scale(this.delimjQs,min(1+.2*(height-1),1.2),1.2*height)}}function bindCharBracketPair(open,ctrlSeq){var ctrlSeq=ctrlSeq||open,close=OPP_BRACKS[open],end=OPP_BRACKS[ctrlSeq];CharCmds[open]=bind(Bracket,-1,open,close,ctrlSeq,end),CharCmds[close]=bind(Bracket,1,open,close,ctrlSeq,end)}var min=Math.min,max=Math.max,__slice=[].slice,send=variadic(function(method,args){return variadic(function(obj,moreArgs){if(method in obj)return obj[method].apply(obj,args.concat(moreArgs))})}),P=function(prototype,ownProperty){function isObject(o){return"object"===_typeof2(o)}function isFunction(f){return"function"==typeof f}function SuperclassBare(){}return function P(_superclass,definition){function C(){var self=new Bare;return isFunction(self.init)&&self.init.apply(self,arguments),self}function Bare(){}void 0===definition&&(definition=_superclass,_superclass=Object),C.Bare=Bare;var _super=SuperclassBare[prototype]=_superclass[prototype],proto=Bare[prototype]=C[prototype]=C.p=new SuperclassBare,extensions;return proto.constructor=C,C.mixin=function(def){return Bare[prototype]=C[prototype]=P(C,def)[prototype],C},(C.open=function(def){if(extensions={},isFunction(def)?extensions=def.call(C,proto,_super,C,_superclass):isObject(def)&&(extensions=def),isObject(extensions))for(var ext in extensions)ownProperty.call(extensions,ext)&&(proto[ext]=extensions[ext]);return isFunction(proto.init)||(proto.init=_superclass),C})(definition)}}("prototype",{}.hasOwnProperty),L=-1,R=1,$=P(jQuery,function(_){_.insDirOf=function(dir,el){return dir===L?this.insertBefore(el.first()):this.insertAfter(el.last())},_.insAtDirEnd=function(dir,el){return dir===L?this.prependTo(el):this.appendTo(el)}}),Point=P(function(_){_.parent=0,_[L]=0,_[R]=0,_.init=function(parent,leftward,rightward){this.parent=parent,this[L]=leftward,this[R]=rightward},this.copy=function(pt){return Point(pt.parent,pt[L],pt[R])}}),Node=P(function(_){function uniqueNodeId(){return id+=1}_[L]=0,_[R]=0,_.parent=0;var id=0;this.byId={},_.init=function(){this.id=uniqueNodeId(),Node.byId[this.id]=this,this.ends={},this.ends[L]=0,this.ends[R]=0},_.dispose=function(){delete Node.byId[this.id]},_.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},_.jQ=$(),_.jQadd=function(jQ){return this.jQ=this.jQ.add(jQ)},_.jQize=function(jQ){function jQadd(el){if(el.getAttribute){var cmdId=el.getAttribute("mathquill-command-id"),blockId=el.getAttribute("mathquill-block-id");cmdId&&Node.byId[cmdId].jQadd(el),blockId&&Node.byId[blockId].jQadd(el)}for(el=el.firstChild;el;el=el.nextSibling)jQadd(el)}for(var jQ=$(jQ||this.html()),i=0;i<jQ.length;i+=1)jQadd(jQ[i]);return jQ},_.createDir=function(dir,cursor){prayDirection(dir);var node=this;return node.jQize(),node.jQ.insDirOf(dir,cursor.jQ),cursor[dir]=node.adopt(cursor.parent,cursor[L],cursor[R]),node},_.createLeftOf=function(el){return this.createDir(L,el)},_.selectChildren=function(leftEnd,rightEnd){return Selection(leftEnd,rightEnd)},_.bubble=iterator(function(yield_){for(var ancestor=this,result;ancestor&&(result=yield_(ancestor),!1!==result);ancestor=ancestor.parent);return this}),_.postOrder=iterator(function(yield_){return function recurse(descendant){descendant.eachChild(recurse),yield_(descendant)}(this),this}),_.isEmpty=function(){return 0===this.ends[L]&&0===this.ends[R]},_.children=function(){return Fragment(this.ends[L],this.ends[R])},_.eachChild=function(){var children=this.children();return children.each.apply(children,arguments),this},_.foldChildren=function(fold,fn){return this.children().fold(fold,fn)},_.withDirAdopt=function(dir,parent,withDir,oppDir){return Fragment(this,this).withDirAdopt(dir,parent,withDir,oppDir),this},_.adopt=function(parent,leftward,rightward){return Fragment(this,this).adopt(parent,leftward,rightward),this},_.disown=function(){return Fragment(this,this).disown(),this},_.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),Fragment=P(function(_){_.init=function(withDir,oppDir,dir){if(void 0===dir&&(dir=L),prayDirection(dir),pray("no half-empty fragments",!withDir==!oppDir),this.ends={},!!withDir){pray("withDir is passed to Fragment",withDir instanceof Node),pray("oppDir is passed to Fragment",oppDir instanceof Node),pray("withDir and oppDir have the same parent",withDir.parent===oppDir.parent),this.ends[dir]=withDir,this.ends[-dir]=oppDir;var accum=this.fold([],function(accum,el){return accum.push.apply(accum,el.jQ.get()),accum});this.jQ=this.jQ.add(accum)}},_.jQ=$(),_.withDirAdopt=function(dir,parent,withDir,oppDir){return dir===L?this.adopt(parent,withDir,oppDir):this.adopt(parent,oppDir,withDir)},_.adopt=function(parent,leftward,rightward){prayWellFormed(parent,leftward,rightward);var self=this;self.disowned=!1;var leftEnd=self.ends[L];if(!leftEnd)return this;var rightEnd=self.ends[R];return leftward||(parent.ends[L]=leftEnd),rightward?rightward[L]=rightEnd:parent.ends[R]=rightEnd,self.ends[R][R]=rightward,self.each(function(el){el[L]=leftward,el.parent=parent,leftward&&(leftward[R]=el),leftward=el}),self},_.disown=function(){var self=this,leftEnd=self.ends[L];if(!leftEnd||self.disowned)return self;self.disowned=!0;var rightEnd=self.ends[R],parent=leftEnd.parent;return prayWellFormed(parent,leftEnd[L],leftEnd),prayWellFormed(parent,rightEnd,rightEnd[R]),leftEnd[L]?leftEnd[L][R]=rightEnd[R]:parent.ends[L]=rightEnd[R],rightEnd[R]?rightEnd[R][L]=leftEnd[L]:parent.ends[R]=leftEnd[L],self},_.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},_.each=iterator(function(yield_){var self=this,el=self.ends[L];if(!el)return self;for(;el!==self.ends[R][R];el=el[R]){var result=yield_(el);if(!1===result)break}return self}),_.fold=function(fold,fn){return this.each(function(el){fold=fn.call(this,fold,el)}),fold}}),LatexCmds={},CharCmds={},Cursor=P(Point,function(_){_.init=function(initParent,options){this.parent=initParent,this.options=options;var jQ=this.jQ=this._jQ=$("<span class=\"mq-cursor\">&#8203;</span>");this.blink=function(){jQ.toggleClass("mq-blink")},this.upDownCache={}},_.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[R]?this.selection&&this.selection.ends[L][L]===this[L]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[R].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},_.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=$(),this},_.withDirInsertAt=function(dir,parent,withDir,oppDir){var oldParent=this.parent;this.parent=parent,this[dir]=withDir,this[-dir]=oppDir,oldParent!==parent&&oldParent.blur&&oldParent.blur()},_.insDirOf=function(dir,el){return prayDirection(dir),this.jQ.insDirOf(dir,el.jQ),this.withDirInsertAt(dir,el.parent,el[dir],el),this.parent.jQ.addClass("mq-hasCursor"),this},_.insLeftOf=function(el){return this.insDirOf(L,el)},_.insRightOf=function(el){return this.insDirOf(R,el)},_.insAtDirEnd=function(dir,el){return prayDirection(dir),this.jQ.insAtDirEnd(dir,el.jQ),this.withDirInsertAt(dir,el,0,el.ends[dir]),el.focus(),this},_.insAtLeftEnd=function(el){return this.insAtDirEnd(L,el)},_.insAtRightEnd=function(el){return this.insAtDirEnd(R,el)},_.jumpUpDown=function(from,to){var self=this;self.upDownCache[from.id]=Point.copy(self);var cached=self.upDownCache[to.id];if(cached)cached[R]?self.insLeftOf(cached[R]):self.insAtRightEnd(cached.parent);else{var pageX=self.offset().left;to.seek(pageX,self)}},_.offset=function(){var self=this,offset=self.jQ.removeClass("mq-cursor").offset();return self.jQ.addClass("mq-cursor"),offset},_.unwrapGramp=function(){var gramp=this.parent.parent,greatgramp=gramp.parent,rightward=gramp[R],cursor=this,leftward=gramp[L];if(gramp.disown().eachChild(function(uncle){uncle.isEmpty()||(uncle.children().adopt(greatgramp,leftward,rightward).each(function(cousin){cousin.jQ.insertBefore(gramp.jQ.first())}),leftward=uncle.ends[R])}),!this[R])if(this[L])this[R]=this[L][R];else for(;!this[R];)if(this.parent=this.parent[R],this.parent)this[R]=this.parent.ends[L];else{this[R]=gramp[R],this.parent=greatgramp;break}this[R]?this.insLeftOf(this[R]):this.insAtRightEnd(greatgramp),gramp.jQ.remove(),gramp[L].siblingDeleted&&gramp[L].siblingDeleted(cursor.options,R),gramp[R].siblingDeleted&&gramp[R].siblingDeleted(cursor.options,L)},_.startSelection=function(){for(var anticursor=this.anticursor=Point.copy(this),ancestors=anticursor.ancestors={},ancestor=anticursor;ancestor.parent;ancestor=ancestor.parent)ancestors[ancestor.parent.id]=ancestor},_.endSelection=function(){delete this.anticursor},_.select=function(){var anticursor=this.anticursor;if(this[L]===anticursor[L]&&this.parent===anticursor.parent)return!1;for(var ancestor=this;ancestor.parent;ancestor=ancestor.parent)if(ancestor.parent.id in anticursor.ancestors){var lca=ancestor.parent;break}pray("cursor and anticursor in the same tree",lca);var antiAncestor=anticursor.ancestors[lca.id],dir=R,leftEnd,rightEnd;if(ancestor[L]!==antiAncestor)for(var rightward=ancestor;rightward;rightward=rightward[R])if(rightward[R]===antiAncestor[R]){dir=L,leftEnd=ancestor,rightEnd=antiAncestor;break}return dir===R&&(leftEnd=antiAncestor,rightEnd=ancestor),leftEnd instanceof Point&&(leftEnd=leftEnd[R]),rightEnd instanceof Point&&(rightEnd=rightEnd[L]),this.hide().selection=lca.selectChildren(leftEnd,rightEnd),this.insDirOf(dir,this.selection.ends[dir]),this.selectionChanged(),!0},_.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},_.deleteSelection=function(){this.selection&&(this[L]=this.selection.ends[L][L],this[R]=this.selection.ends[R][R],this.selection.remove(),this.selectionChanged(),delete this.selection)},_.replaceSelection=function(){var seln=this.selection;return seln&&(this[L]=seln.ends[L][L],this[R]=seln.ends[R][R],delete this.selection),seln}}),Selection=P(Fragment,function(_,super_){_.init=function(){super_.init.apply(this,arguments),this.jQ=this.jQ.wrapAll("<span class=\"mq-selection\"></span>").parent()},_.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),super_.adopt.apply(this,arguments)},_.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},_.join=function(methodName){return this.fold("",function(fold,child){return fold+child[methodName]()})}}),Controller=P(function(_){_.init=function(root,container,options){this.id=root.id,this.data={},this.root=root,this.container=container,this.options=options,root.controller=this,this.cursor=root.cursor=Cursor(root,options)},_.handle=function(name,dir){var handlers=this.options.handlers;if(handlers&&handlers.fns[name]){var mq=handlers.APIClasses[this.KIND_OF_MQ](this);dir===L||dir===R?handlers.fns[name](dir,mq):handlers.fns[name](mq)}};var notifyees=[];this.onNotify=function(f){notifyees.push(f)},_.notify=function(){for(var i=0;i<notifyees.length;i+=1)notifyees[i].apply(this.cursor,arguments);return this}}),API={},Options=P(),optionProcessors={},Progenote=P(),EMBEDS={};MathQuill.prototype=Progenote.p,MathQuill.interfaceVersion=function(v){if(1!==v)throw"Only interface version 1 supported. You specified: "+v;return insistOnInterVer=function(){window.console&&console.warn("You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")},insistOnInterVer(),MathQuill},MathQuill.getInterface=getInterface;var MIN=getInterface.MIN=1,MAX=getInterface.MAX=2;MathQuill.noConflict=function(){return window.MathQuill=origMathQuill,MathQuill};var origMathQuill=window.MathQuill;window.MathQuill=MathQuill;var Parser=P(function(_,super_,Parser){function parseError(stream,message){throw stream=stream?"'"+stream+"'":"EOF","Parse Error: "+message+" at "+stream}_.init=function(body){this._=body},_.parse=function(stream){return this.skip(eof)._(""+stream,function(stream,result){return result},parseError)},_.or=function(alternative){pray("or is passed a parser",alternative instanceof Parser);var self=this;return Parser(function(stream,onSuccess,onFailure){return self._(stream,onSuccess,function(){return alternative._(stream,onSuccess,onFailure)})})},_.then=function(next){var self=this;return Parser(function(stream,onSuccess,onFailure){return self._(stream,function(newStream,result){var nextParser=next instanceof Parser?next:next(result);return pray("a parser is returned",nextParser instanceof Parser),nextParser._(newStream,onSuccess,onFailure)},onFailure)})},_.many=function(){var self=this;return Parser(function(stream,onSuccess){function success(newStream,x){return stream=newStream,xs.push(x),!0}function failure(){return!1}for(var xs=[];self._(stream,success,failure););return onSuccess(stream,xs)})},_.times=function(min,max){2>arguments.length&&(max=min);var self=this;return Parser(function(stream,onSuccess,onFailure){function success(newStream,x){return xs.push(x),stream=newStream,!0}function firstFailure(newStream,msg){return failure=msg,stream=newStream,!1}function secondFailure(){return!1}for(var xs=[],result=!0,i=0,failure;i<min;i+=1)if(result=self._(stream,success,firstFailure),!result)return onFailure(stream,failure);for(;i<max&&result;i+=1)result=self._(stream,success,secondFailure);return onSuccess(stream,xs)})},_.result=function(res){return this.then(succeed(res))},_.atMost=function(n){return this.times(0,n)},_.atLeast=function(n){var self=this;return self.times(n).then(function(start){return self.many().map(function(end){return start.concat(end)})})},_.map=function(fn){return this.then(function(result){return succeed(fn(result))})},_.skip=function(two){return this.then(function(result){return two.result(result)})};var string=this.string=function(str){var len=str.length;return Parser(function(stream,onSuccess,onFailure){var head=stream.slice(0,len);return head===str?onSuccess(stream.slice(len),head):onFailure(stream,"expected '"+str+"'")})},regex=this.regex=function(re){pray("regexp parser is anchored","^"===re.toString().charAt(1));return Parser(function(stream,onSuccess,onFailure){var match=re.exec(stream);if(match){var result=match[0];return onSuccess(stream.slice(result.length),result)}return onFailure(stream,"expected "+re)})},succeed=Parser.succeed=function(result){return Parser(function(stream,onSuccess){return onSuccess(stream,result)})},fail=Parser.fail=function(msg){return Parser(function(stream,_,onFailure){return onFailure(stream,msg)})},letter=Parser.letter=regex(/^[a-z]/i),letters=Parser.letters=regex(/^[a-z]*/i),digit=Parser.digit=regex(/^[0-9]/),digits=Parser.digits=regex(/^[0-9]*/),whitespace=Parser.whitespace=regex(/^\s+/),optWhitespace=Parser.optWhitespace=regex(/^\s*/),any=Parser.any=Parser(function(stream,onSuccess,onFailure){return stream?onSuccess(stream.slice(1),stream.charAt(0)):onFailure(stream,"expected any character")}),all=Parser.all=Parser(function(stream,onSuccess){return onSuccess("",stream)}),eof=Parser.eof=Parser(function(stream,onSuccess,onFailure){return stream?onFailure(stream,"expected EOF"):onSuccess(stream,stream)})}),saneKeyboardEvents=function(){function stringify(evt){var which=evt.which||evt.keyCode,keyVal=KEY_VALUES[which],modifiers=[],key;return(evt.ctrlKey&&modifiers.push("Ctrl"),evt.originalEvent&&evt.originalEvent.metaKey&&modifiers.push("Meta"),evt.altKey&&modifiers.push("Alt"),evt.shiftKey&&modifiers.push("Shift"),key=keyVal||_StringfromCharCode3(which),!modifiers.length&&!keyVal)?key:(modifiers.push(key),modifiers.join("-"))}var KEY_VALUES={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(el,handlers){function checkTextareaFor(checker){checkTextarea=checker,clearTimeout(timeoutId),timeoutId=setTimeout(checker)}function select(text){checkTextarea(),checkTextarea=noop,clearTimeout(timeoutId),textarea.val(text),text&&textarea[0].select&&textarea[0].select(),shouldBeSelected=!!text}function hasSelection(){var dom=textarea[0];return!!("selectionStart"in dom)&&dom.selectionStart!==dom.selectionEnd}function handleKey(){handlers.keystroke(stringify(keydown),keydown)}function onKeydown(e){keydown=e,keypress=null,shouldBeSelected&&checkTextareaFor(function(e){!(e&&"focusout"===e.type)&&textarea[0].select&&textarea[0].select(),checkTextarea=noop,clearTimeout(timeoutId)}),handleKey()}function onKeypress(e){keydown&&keypress&&handleKey(),keypress=e,checkTextareaFor(typedText)}function typedText(){if(!hasSelection()){var text=textarea.val();1===text.length?(textarea.val(""),handlers.typedText(text)):text&&textarea[0].select&&textarea[0].select()}}function pastedText(){var text=textarea.val();textarea.val(""),text&&handlers.paste(text)}var keydown=null,keypress=null,textarea=jQuery(el),target=jQuery(handlers.container||textarea),checkTextarea=noop,timeoutId;target.bind("keydown keypress input keyup focusout paste",function(e){checkTextarea(e)});var shouldBeSelected=!1;return target.bind({keydown:onKeydown,keypress:onKeypress,focusout:function(){keydown=keypress=null},paste:function(){textarea.focus(),checkTextareaFor(pastedText)}}),{select:select}}}();Controller.open(function(_){_.exportText=function(){return this.root.foldChildren("",function(text,child){return text+child.text()})}}),Controller.open(function(_){_.focusBlurEvents=function(){function windowBlur(){clearTimeout(blurTimeout),cursor.selection&&cursor.selection.jQ.addClass("mq-blur"),blur()}function blur(){cursor.hide().parent.blur(),ctrlr.container.removeClass("mq-focused"),$(window).off("blur",windowBlur)}var ctrlr=this,root=ctrlr.root,cursor=ctrlr.cursor,blurTimeout;ctrlr.textarea.focus(function(){ctrlr.blurred=!1,clearTimeout(blurTimeout),ctrlr.container.addClass("mq-focused"),cursor.parent||cursor.insAtRightEnd(root),cursor.selection?(cursor.selection.jQ.removeClass("mq-blur"),ctrlr.selectionChanged()):cursor.show()}).blur(function(){ctrlr.blurred=!0,blurTimeout=setTimeout(function(){root.postOrder("intentionalBlur"),cursor.clearSelection().endSelection(),blur()}),$(window).on("blur",windowBlur)}),ctrlr.blurred=!0,cursor.hide().parent.blur()}}),Controller.open(function(_){_.keystroke=function(key,evt){this.cursor.parent.keystroke(key,evt,this)}}),Node.open(function(_){_.keystroke=function(key,e,ctrlr){var cursor=ctrlr.cursor;switch(key){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":ctrlr.ctrlDeleteDir(L);break;case"Shift-Backspace":case"Backspace":ctrlr.backspace();break;case"Esc":case"Tab":return void ctrlr.escapeDir(R,key,e);case"Shift-Tab":case"Shift-Esc":return void ctrlr.escapeDir(L,key,e);case"End":ctrlr.notify("move").cursor.insAtRightEnd(cursor.parent);break;case"Ctrl-End":ctrlr.notify("move").cursor.insAtRightEnd(ctrlr.root);break;case"Shift-End":for(;cursor[R];)ctrlr.selectRight();break;case"Ctrl-Shift-End":for(;cursor[R]||cursor.parent!==ctrlr.root;)ctrlr.selectRight();break;case"Home":ctrlr.notify("move").cursor.insAtLeftEnd(cursor.parent);break;case"Ctrl-Home":ctrlr.notify("move").cursor.insAtLeftEnd(ctrlr.root);break;case"Shift-Home":for(;cursor[L];)ctrlr.selectLeft();break;case"Ctrl-Shift-Home":for(;cursor[L]||cursor.parent!==ctrlr.root;)ctrlr.selectLeft();break;case"Left":ctrlr.moveLeft();break;case"Shift-Left":ctrlr.selectLeft();break;case"Ctrl-Left":break;case"Right":ctrlr.moveRight();break;case"Shift-Right":ctrlr.selectRight();break;case"Ctrl-Right":break;case"Up":ctrlr.moveUp();break;case"Down":ctrlr.moveDown();break;case"Shift-Up":if(cursor[L])for(;cursor[L];)ctrlr.selectLeft();else ctrlr.selectLeft();case"Shift-Down":if(cursor[R])for(;cursor[R];)ctrlr.selectRight();else ctrlr.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":ctrlr.ctrlDeleteDir(R);break;case"Shift-Del":case"Del":ctrlr.deleteForward();break;case"Meta-A":case"Ctrl-A":for(ctrlr.notify("move").cursor.insAtRightEnd(ctrlr.root);cursor[L];)ctrlr.selectLeft();break;default:return;}e.preventDefault(),ctrlr.scrollHoriz()},_.moveOutOf=_.moveTowards=_.deleteOutOf=_.deleteTowards=_.unselectInto=_.selectOutOf=_.selectTowards=function(){pray("overridden or never called on this node")}}),Controller.open(function(_){function moveUpDown(self,dir){var cursor=self.notify("upDown").cursor,dirInto=dir+"Into",dirOutOf=dir+"OutOf";return cursor[R][dirInto]?cursor.insAtLeftEnd(cursor[R][dirInto]):cursor[L][dirInto]?cursor.insAtRightEnd(cursor[L][dirInto]):cursor.parent.bubble(function(ancestor){var prop=ancestor[dirOutOf];if(prop&&("function"==typeof prop&&(prop=ancestor[dirOutOf](cursor)),prop instanceof Node&&cursor.jumpUpDown(ancestor,prop),!0!==prop))return!1}),self}this.onNotify(function(e){("move"===e||"upDown"===e)&&this.show().clearSelection()}),_.escapeDir=function(dir,key,e){prayDirection(dir);var cursor=this.cursor;if(cursor.parent!==this.root&&e.preventDefault(),cursor.parent!==this.root)return cursor.parent.moveOutOf(dir,cursor),this.notify("move")},optionProcessors.leftRightIntoCmdGoes=function(updown){if(updown&&"up"!==updown&&"down"!==updown)throw"\"up\" or \"down\" required for leftRightIntoCmdGoes option, got \""+updown+"\"";return updown},_.moveDir=function(dir){prayDirection(dir);var cursor=this.cursor,updown=cursor.options.leftRightIntoCmdGoes;return cursor.selection?cursor.insDirOf(dir,cursor.selection.ends[dir]):cursor[dir]?cursor[dir].moveTowards(dir,cursor,updown):cursor.parent.moveOutOf(dir,cursor,updown),this.notify("move")},_.moveLeft=function(){return this.moveDir(L)},_.moveRight=function(){return this.moveDir(R)},_.moveUp=function(){return moveUpDown(this,"up")},_.moveDown=function(){return moveUpDown(this,"down")},this.onNotify(function(e){"upDown"!==e&&(this.upDownCache={})}),this.onNotify(function(e){"edit"===e&&this.show().deleteSelection()}),_.deleteDir=function(dir){prayDirection(dir);var cursor=this.cursor,hadSelection=cursor.selection;return this.notify("edit"),hadSelection||(cursor[dir]?cursor[dir].deleteTowards(dir,cursor):cursor.parent.deleteOutOf(dir,cursor)),cursor[L].siblingDeleted&&cursor[L].siblingDeleted(cursor.options,R),cursor[R].siblingDeleted&&cursor[R].siblingDeleted(cursor.options,L),cursor.parent.bubble("reflow"),this},_.ctrlDeleteDir=function(dir){prayDirection(dir);var cursor=this.cursor;return!cursor[L]||cursor.selection?ctrlr.deleteDir():(this.notify("edit"),Fragment(cursor.parent.ends[L],cursor[L]).remove(),cursor.insAtDirEnd(L,cursor.parent),cursor[L].siblingDeleted&&cursor[L].siblingDeleted(cursor.options,R),cursor[R].siblingDeleted&&cursor[R].siblingDeleted(cursor.options,L),cursor.parent.bubble("reflow"),this)},_.backspace=function(){return this.deleteDir(L)},_.deleteForward=function(){return this.deleteDir(R)},this.onNotify(function(e){"select"!==e&&this.endSelection()}),_.selectDir=function(dir){var cursor=this.notify("select").cursor,seln=cursor.selection;prayDirection(dir),cursor.anticursor||cursor.startSelection();var node=cursor[dir];node?seln&&seln.ends[dir]===node&&cursor.anticursor[-dir]!==node?node.unselectInto(dir,cursor):node.selectTowards(dir,cursor):cursor.parent.selectOutOf(dir,cursor),cursor.clearSelection(),cursor.select()||cursor.show()},_.selectLeft=function(){return this.selectDir(L)},_.selectRight=function(){return this.selectDir(R)}});var latexMathParser=function(){function joinBlocks(blocks){for(var firstBlock=blocks[0]||MathBlock(),i=1;i<blocks.length;i+=1)blocks[i].children().adopt(firstBlock,firstBlock.ends[R],0);return firstBlock}var string=Parser.string,regex=Parser.regex,letter=Parser.letter,any=Parser.any,optWhitespace=Parser.optWhitespace,succeed=Parser.succeed,fail=Parser.fail,variable=letter.map(function(c){return Letter(c)}),symbol=regex(/^[^${}\\_^]/).map(function(c){return VanillaSymbol(c)}),controlSequence=regex(/^[^\\a-eg-zA-Z]/).or(string("\\").then(regex(/^[a-z]+/i).or(regex(/^\s+/).result(" ")).or(any))).then(function(ctrlSeq){var cmdKlass=LatexCmds[ctrlSeq];return cmdKlass?cmdKlass(ctrlSeq).parser():fail("unknown command: \\"+ctrlSeq)}),command=controlSequence.or(variable).or(symbol),mathGroup=string("{").then(function(){return mathSequence}).skip(string("}")),mathBlock=optWhitespace.then(mathGroup.or(command.map(function(cmd){var block=MathBlock();return cmd.adopt(block,0,0),block}))),mathSequence=mathBlock.many().map(joinBlocks).skip(optWhitespace),optMathBlock=string("[").then(mathBlock.then(function(block){return"]"===block.join("latex")?fail():succeed(block)}).many().map(joinBlocks).skip(optWhitespace)).skip(string("]")),latexMath=mathSequence;return latexMath.block=mathBlock,latexMath.optBlock=optMathBlock,latexMath}();Controller.open(function(_){_.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/ig,"$1")},_.writeLatex=function(latex){var cursor=this.notify("edit").cursor,all=Parser.all,eof=Parser.eof,block=latexMathParser.skip(eof).or(all.result(!1)).parse(latex);if(block&&!block.isEmpty()){block.children().adopt(cursor.parent,cursor[L],cursor[R]);var jQ=block.jQize();jQ.insertBefore(cursor.jQ),cursor[L]=block.ends[R],block.finalizeInsert(cursor.options,cursor),block.ends[R][R].siblingCreated&&block.ends[R][R].siblingCreated(cursor.options,L),block.ends[L][L].siblingCreated&&block.ends[L][L].siblingCreated(cursor.options,R),cursor.parent.bubble("reflow")}return this},_.renderLatexMath=function(latex){var root=this.root,cursor=this.cursor,all=Parser.all,eof=Parser.eof,block=latexMathParser.skip(eof).or(all.result(!1)).parse(latex);root.eachChild("postOrder","dispose"),root.ends[L]=root.ends[R]=0,block&&block.children().adopt(root,0,0);var jQ=root.jQ;if(block){var html=block.join("html");jQ.html(html),root.jQize(jQ.children()),root.finalizeInsert(cursor.options)}else jQ.empty();delete cursor.selection,cursor.insAtRightEnd(root)},_.renderLatexText=function(latex){var root=this.root,cursor=this.cursor;root.jQ.children().slice(1).remove(),root.eachChild("postOrder","dispose"),root.ends[L]=root.ends[R]=0,delete cursor.selection,cursor.show().insAtRightEnd(root);var regex=Parser.regex,string=Parser.string,eof=Parser.eof,all=Parser.all,mathMode=string("$").then(latexMathParser).skip(string("$").or(eof)).map(function(block){var rootMathCommand=RootMathCommand(cursor);rootMathCommand.createBlocks();var rootMathBlock=rootMathCommand.ends[L];return block.children().adopt(rootMathBlock,0,0),rootMathCommand}),escapedDollar=string("\\$").result("$"),textChar=escapedDollar.or(regex(/^[^$]/)).map(VanillaSymbol),latexText=mathMode.or(textChar).many(),commands=latexText.skip(eof).or(all.result(!1)).parse(latex);if(commands){for(var i=0;i<commands.length;i+=1)commands[i].adopt(root,root.ends[R],0);root.jQize().appendTo(root.jQ),root.finalizeInsert(cursor.options)}}}),Controller.open(function(_){_.delegateMouseEvents=function(){var ultimateRootjQ=this.root.jQ;this.container.bind("mousedown.mathquill",function(e){function mousemove(e){target=$(e.target)}function docmousemove(e){cursor.anticursor||cursor.startSelection(),ctrlr.seek(target,e.pageX,e.pageY).cursor.select(),target=void 0}function mouseup(e){cursor.blink=blink,cursor.selection||(ctrlr.editable?cursor.show():textareaSpan.detach()),rootjQ.unbind("mousemove",mousemove),$(e.target.ownerDocument).unbind("mousemove",docmousemove).unbind("mouseup",mouseup)}var rootjQ=$(e.target).closest(".mq-root-block"),root=Node.byId[rootjQ.attr("mathquill-block-id")||ultimateRootjQ.attr("mathquill-block-id")],ctrlr=root.controller,cursor=ctrlr.cursor,blink=cursor.blink,textareaSpan=ctrlr.textareaSpan,textarea=ctrlr.textarea,target;ctrlr.blurred&&(!ctrlr.editable&&rootjQ.prepend(textareaSpan),textarea.focus()),e.preventDefault(),e.target.unselectable=!0,cursor.blink=noop,ctrlr.seek($(e.target),e.pageX,e.pageY).cursor.startSelection(),rootjQ.mousemove(mousemove),$(e.target.ownerDocument).mousemove(docmousemove).mouseup(mouseup)})}}),Controller.open(function(_){_.seek=function(target,pageX){var cursor=this.notify("select").cursor;if(target){var nodeId=target.attr("mathquill-block-id")||target.attr("mathquill-command-id");if(!nodeId){var targetParent=target.parent();nodeId=targetParent.attr("mathquill-block-id")||targetParent.attr("mathquill-command-id")}}var node=nodeId?Node.byId[nodeId]:this.root;return pray("nodeId is the id of some Node that exists",node),cursor.clearSelection().show(),node.seek(pageX,cursor),this.scrollHoriz(),this}}),Controller.open(function(_){_.scrollHoriz=function(){var cursor=this.cursor,seln=cursor.selection,rootRect=this.root.jQ[0].getBoundingClientRect();if(!seln){var x=cursor.jQ[0].getBoundingClientRect().left;if(x>rootRect.right-20)var scrollBy=x-(rootRect.right-20);else if(x<rootRect.left+20)var scrollBy=x-(rootRect.left+20);else return}else{var rect=seln.jQ[0].getBoundingClientRect(),overLeft=rect.left-(rootRect.left+20),overRight=rect.right-(rootRect.right-20);if(seln.ends[L]===cursor[R]){if(0>overLeft)var scrollBy=overLeft;else{if(!(0<overRight))return;if(rect.left-overRight<rootRect.left+20)var scrollBy=overLeft;else var scrollBy=overRight}}else if(0<overRight)var scrollBy=overRight;else{if(!(0>overLeft))return;if(rect.right-overLeft>rootRect.right-20)var scrollBy=overRight;else var scrollBy=overLeft}}this.root.jQ.stop().animate({scrollLeft:"+="+scrollBy},100)}}),Controller.open(function(_){Options.p.substituteTextarea=function(){return $("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},_.createTextarea=function(){var textareaSpan=this.textareaSpan=$("<span class=\"mq-textarea\"></span>"),textarea=this.options.substituteTextarea();if(!textarea.nodeType)throw"substituteTextarea() must return a DOM element, got "+textarea;textarea=this.textarea=$(textarea).appendTo(textareaSpan);var ctrlr=this;ctrlr.cursor.selectionChanged=function(){ctrlr.selectionChanged()},ctrlr.container.bind("copy",function(){ctrlr.setTextareaSelection()})},_.selectionChanged=function(){var ctrlr=this;forceIERedraw(ctrlr.container[0]),ctrlr.textareaSelectionTimeout===void 0&&(ctrlr.textareaSelectionTimeout=setTimeout(function(){ctrlr.setTextareaSelection()}))},_.setTextareaSelection=function(){this.textareaSelectionTimeout=void 0;var latex="";this.cursor.selection&&(latex=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(latex="$"+latex+"$")),this.selectFn(latex)},_.staticMathTextareaEvents=function(){function detach(){textareaSpan.detach(),ctrlr.blurred=!0}var ctrlr=this,root=ctrlr.root,cursor=ctrlr.cursor,textarea=ctrlr.textarea,textareaSpan=ctrlr.textareaSpan;this.container.prepend("<span class=\"mq-selectable\">$"+ctrlr.exportLatex()+"$</span>"),ctrlr.blurred=!0,textarea.bind("cut paste",!1).focus(function(){ctrlr.blurred=!1}).blur(function(){cursor.selection&&cursor.selection.clear(),setTimeout(detach)}),ctrlr.selectFn=function(text){textarea.val(text),text&&textarea.select()}},_.editablesTextareaEvents=function(){var ctrlr=this,root=ctrlr.root,cursor=ctrlr.cursor,textarea=ctrlr.textarea,textareaSpan=ctrlr.textareaSpan,keyboardEventsShim=saneKeyboardEvents(textarea,this);this.selectFn=function(text){keyboardEventsShim.select(text)},this.container.prepend(textareaSpan).on("cut",function(){cursor.selection&&setTimeout(function(){ctrlr.notify("edit"),cursor.parent.bubble("reflow")})}),this.focusBlurEvents()},_.typedText=function(ch){if("\n"===ch)return this.handle("enter");var cursor=this.notify().cursor;cursor.parent.write(cursor,ch),this.scrollHoriz()},_.paste=function(text){this.options.statelessClipboard&&("$"===text.slice(0,1)&&"$"===text.slice(-1)?text=text.slice(1,-1):text="\\text{"+text+"}"),this.writeLatex(text).cursor.show()}});var MathElement=P(Node,function(_){_.finalizeInsert=function(options,cursor){var self=this;self.postOrder("finalizeTree",options),self.postOrder("contactWeld",cursor),self.postOrder("blur"),self.postOrder("reflow"),self[R].siblingCreated&&self[R].siblingCreated(options,L),self[L].siblingCreated&&self[L].siblingCreated(options,R),self.bubble("reflow")}}),MathCommand=P(MathElement,function(_,super_){_.init=function(ctrlSeq,htmlTemplate,textTemplate){var cmd=this;super_.init.call(cmd),cmd.ctrlSeq||(cmd.ctrlSeq=ctrlSeq),htmlTemplate&&(cmd.htmlTemplate=htmlTemplate),textTemplate&&(cmd.textTemplate=textTemplate)},_.replaces=function(replacedFragment){replacedFragment.disown(),this.replacedFragment=replacedFragment},_.isEmpty=function(){return this.foldChildren(!0,function(isEmpty,child){return isEmpty&&child.isEmpty()})},_.parser=function(){var block=latexMathParser.block,self=this;return block.times(self.numBlocks()).map(function(blocks){self.blocks=blocks;for(var i=0;i<blocks.length;i+=1)blocks[i].adopt(self,self.ends[R],0);return self})},_.createLeftOf=function(cursor){var cmd=this,replacedFragment=cmd.replacedFragment;cmd.createBlocks(),super_.createLeftOf.call(cmd,cursor),replacedFragment&&(replacedFragment.adopt(cmd.ends[L],0,0),replacedFragment.jQ.appendTo(cmd.ends[L].jQ)),cmd.finalizeInsert(cursor.options),cmd.placeCursor(cursor)},_.createBlocks=function(){for(var cmd=this,numBlocks=cmd.numBlocks(),blocks=cmd.blocks=Array(numBlocks),i=0,newBlock;i<numBlocks;i+=1)newBlock=blocks[i]=MathBlock(),newBlock.adopt(cmd,cmd.ends[R],0)},_.placeCursor=function(cursor){cursor.insAtRightEnd(this.foldChildren(this.ends[L],function(leftward,child){return leftward.isEmpty()?leftward:child}))},_.moveTowards=function(dir,cursor,updown){var updownInto=updown&&this[updown+"Into"];cursor.insAtDirEnd(-dir,updownInto||this.ends[-dir])},_.deleteTowards=function(dir,cursor){this.isEmpty()?cursor[dir]=this.remove()[dir]:this.moveTowards(dir,cursor,null)},_.selectTowards=function(dir,cursor){cursor[-dir]=this,cursor[dir]=this[dir]},_.selectChildren=function(){return Selection(this,this)},_.unselectInto=function(dir,cursor){cursor.insAtDirEnd(-dir,cursor.anticursor.ancestors[this.id])},_.seek=function(pageX,cursor){function getBounds(node){var bounds={};return bounds[L]=node.jQ.offset().left,bounds[R]=bounds[L]+node.jQ.outerWidth(),bounds}var cmd=this,cmdBounds=getBounds(cmd);if(pageX<cmdBounds[L])return cursor.insLeftOf(cmd);if(pageX>cmdBounds[R])return cursor.insRightOf(cmd);var leftLeftBound=cmdBounds[L];cmd.eachChild(function(block){var blockBounds=getBounds(block);return pageX<blockBounds[L]?(pageX-leftLeftBound<blockBounds[L]-pageX?block[L]?cursor.insAtRightEnd(block[L]):cursor.insLeftOf(cmd):cursor.insAtLeftEnd(block),!1):pageX>blockBounds[R]?void(block[R]?leftLeftBound=blockBounds[R]:cmdBounds[R]-pageX<pageX-blockBounds[R]?cursor.insRightOf(cmd):cursor.insAtRightEnd(block)):(block.seek(pageX,cursor),!1)})},_.numBlocks=function(){var matches=this.htmlTemplate.match(/&\d+/g);return matches?matches.length:0},_.html=function(){var cmd=this,blocks=cmd.blocks,cmdId=" mathquill-command-id="+cmd.id,tokens=cmd.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);pray("no unmatched angle brackets",tokens.join("")===this.htmlTemplate);for(var i=0,token=tokens[0];token;i+=1,token=tokens[i])if("/>"===token.slice(-2))tokens[i]=token.slice(0,-2)+cmdId+"/>";else if("<"===token.charAt(0)){pray("not an unmatched top-level close tag","/"!==token.charAt(1)),tokens[i]=token.slice(0,-1)+cmdId+">";var nesting=1;do i+=1,token=tokens[i],pray("no missing close tags",token),"</"===token.slice(0,2)?nesting-=1:"<"===token.charAt(0)&&"/>"!==token.slice(-2)&&(nesting+=1);while(0<nesting)}return tokens.join("").replace(/>&(\d+)/g,function($0,$1){return" mathquill-block-id="+blocks[$1].id+">"+blocks[$1].join("html")})},_.latex=function(){return this.foldChildren(this.ctrlSeq,function(latex,child){return latex+"{"+(child.latex()||" ")+"}"})},_.textTemplate=[""],_.text=function(){var cmd=this,i=0;return cmd.foldChildren(cmd.textTemplate[i],function(text,child){i+=1;var child_text=child.text();return text&&"("===cmd.textTemplate[i]&&"("===child_text[0]&&")"===child_text.slice(-1)?text+child_text.slice(1,-1)+cmd.textTemplate[i]:text+child.text()+(cmd.textTemplate[i]||"")})}}),_Symbol=P(MathCommand,function(_,super_){_.init=function(ctrlSeq,html,text){text||(text=ctrlSeq&&1<ctrlSeq.length?ctrlSeq.slice(1):ctrlSeq),super_.init.call(this,ctrlSeq,html,[text])},_.parser=function(){return Parser.succeed(this)},_.numBlocks=function(){return 0},_.replaces=function(replacedFragment){replacedFragment.remove()},_.createBlocks=noop,_.moveTowards=function(dir,cursor){cursor.jQ.insDirOf(dir,this.jQ),cursor[-dir]=this,cursor[dir]=this[dir]},_.deleteTowards=function(dir,cursor){cursor[dir]=this.remove()[dir]},_.seek=function(pageX,cursor){pageX-this.jQ.offset().left<this.jQ.outerWidth()/2?cursor.insLeftOf(this):cursor.insRightOf(this)},_.latex=function(){return this.ctrlSeq},_.text=function(){return this.textTemplate},_.placeCursor=noop,_.isEmpty=function(){return!0}}),VanillaSymbol=P(_Symbol,function(_,super_){_.init=function(ch,html){super_.init.call(this,ch,"<span>"+(html||ch)+"</span>")}}),BinaryOperator=P(_Symbol,function(_,super_){_.init=function(ctrlSeq,html,text){super_.init.call(this,ctrlSeq,"<span class=\"mq-binary-operator\">"+html+"</span>",text)}}),MathBlock=P(MathElement,function(_,super_){_.join=function(methodName){return this.foldChildren("",function(fold,child){return fold+child[methodName]()})},_.html=function(){return this.join("html")},_.latex=function(){return this.join("latex")},_.text=function(){return this.ends[L]===this.ends[R]&&0!==this.ends[L]?this.ends[L].text():this.join("text")},_.keystroke=function(key,e,ctrlr){return ctrlr.options.spaceBehavesLikeTab&&("Spacebar"===key||"Shift-Spacebar"===key)?(e.preventDefault(),void ctrlr.escapeDir("Shift-Spacebar"===key?L:R,key,e)):super_.keystroke.apply(this,arguments)},_.moveOutOf=function(dir,cursor,updown){var updownInto=updown&&this.parent[updown+"Into"];!updownInto&&this[dir]?cursor.insAtDirEnd(-dir,this[dir]):cursor.insDirOf(dir,this.parent)},_.selectOutOf=function(dir,cursor){cursor.insDirOf(dir,this.parent)},_.deleteOutOf=function(dir,cursor){cursor.unwrapGramp()},_.seek=function(pageX,cursor){var node=this.ends[R];if(!node||node.jQ.offset().left+node.jQ.outerWidth()<pageX)return cursor.insAtRightEnd(this);if(pageX<this.ends[L].jQ.offset().left)return cursor.insAtLeftEnd(this);for(;pageX<node.jQ.offset().left;)node=node[L];return node.seek(pageX,cursor)},_.chToCmd=function(ch){var cons;return ch.match(/^[a-eg-zA-Z]$/)?Letter(ch):/^\d$/.test(ch)?Digit(ch):(cons=CharCmds[ch]||LatexCmds[ch])?cons(ch):VanillaSymbol(ch)},_.write=function(cursor,ch){var cmd=this.chToCmd(ch);cursor.selection&&cmd.replaces(cursor.replaceSelection()),cmd.createLeftOf(cursor.show())},_.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},_.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});API.StaticMath=function(APIClasses){return P(APIClasses.AbstractMathQuill,function(_,super_){this.RootBlock=MathBlock,_.__mathquillify=function(){return super_.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},_.init=function(){super_.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],APIClasses.MathField)},_.latex=function(){var returned=super_.latex.apply(this,arguments);return 0<arguments.length&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],APIClasses.MathField),returned}})};var RootMathBlock=P(MathBlock,RootBlockMixin);API.MathField=function(APIClasses){return P(APIClasses.EditableField,function(_,super_){this.RootBlock=RootMathBlock,_.__mathquillify=function(opts,interfaceVersion){return this.config(opts),1<interfaceVersion&&(this.__controller.root.reflow=noop),super_.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})};var TextBlock=P(Node,function(_,super_){function fuseChildren(self){self.jQ[0].normalize();var textPcDom=self.jQ[0].firstChild;pray("only node in TextBlock span is Text node",3===textPcDom.nodeType);var textPc=TextPiece(textPcDom.data);return textPc.jQadd(textPcDom),self.children().disown(),textPc.adopt(self,0,0)}_.ctrlSeq="\\text",_.replaces=function(replacedText){replacedText instanceof Fragment?this.replacedText=replacedText.remove().jQ.text():"string"==typeof replacedText&&(this.replacedText=replacedText)},_.jQadd=function(jQ){super_.jQadd.call(this,jQ),this.ends[L]&&this.ends[L].jQadd(this.jQ[0].firstChild)},_.createLeftOf=function(cursor){var textBlock=this;if(super_.createLeftOf.call(this,cursor),textBlock[R].siblingCreated&&textBlock[R].siblingCreated(cursor.options,L),textBlock[L].siblingCreated&&textBlock[L].siblingCreated(cursor.options,R),textBlock.bubble("reflow"),cursor.insAtRightEnd(textBlock),textBlock.replacedText)for(var i=0;i<textBlock.replacedText.length;i+=1)textBlock.write(cursor,textBlock.replacedText.charAt(i))},_.parser=function(){var textBlock=this,string=Parser.string,regex=Parser.regex,optWhitespace=Parser.optWhitespace;return optWhitespace.then(string("{")).then(regex(/^[^}]*/)).skip(string("}")).map(function(text){return TextPiece(text).adopt(textBlock,0,0),textBlock})},_.textContents=function(){return this.foldChildren("",function(text,child){return text+child.text})},_.text=function(){return"\""+this.textContents()+"\""},_.latex=function(){return"\\text{"+this.textContents()+"}"},_.html=function(){return"<span class=\"mq-text-mode\" mathquill-command-id="+this.id+">"+this.textContents()+"</span>"},_.moveTowards=function(dir,cursor){cursor.insAtDirEnd(-dir,this)},_.moveOutOf=function(dir,cursor){cursor.insDirOf(dir,this)},_.unselectInto=_.moveTowards,_.selectTowards=MathCommand.prototype.selectTowards,_.deleteTowards=MathCommand.prototype.deleteTowards,_.selectOutOf=function(dir,cursor){cursor.insDirOf(dir,this)},_.deleteOutOf=function(dir,cursor){this.isEmpty()&&cursor.insRightOf(this)},_.write=function(cursor,ch){if(cursor.show().deleteSelection(),"$"!==ch)cursor[L]?cursor[L].appendText(ch):TextPiece(ch).createLeftOf(cursor);else if(this.isEmpty())cursor.insRightOf(this),VanillaSymbol("\\$","$").createLeftOf(cursor);else if(!cursor[R])cursor.insRightOf(this);else if(!cursor[L])cursor.insLeftOf(this);else{var leftBlock=TextBlock(),leftPc=this.ends[L];leftPc.disown(),leftPc.adopt(leftBlock,0,0),cursor.insLeftOf(this),super_.createLeftOf.call(leftBlock,cursor)}},_.seek=function(pageX,cursor){cursor.hide();var textPc=fuseChildren(this),avgChWidth=this.jQ.width()/this.text.length,approxPosition=_Mathround7((pageX-this.jQ.offset().left)/avgChWidth);0>=approxPosition?cursor.insAtLeftEnd(this):approxPosition>=textPc.text.length?cursor.insAtRightEnd(this):cursor.insLeftOf(textPc.splitRight(approxPosition));for(var displ=pageX-cursor.show().offset().left,dir=displ&&0>displ?L:R,prevDispl=dir;cursor[dir]&&0<displ*prevDispl;)cursor[dir].moveTowards(dir,cursor),prevDispl=displ,displ=pageX-cursor.offset().left;if(dir*displ<-dir*prevDispl&&cursor[-dir].moveTowards(-dir,cursor),!cursor.anticursor)this.anticursorPosition=cursor[L]&&cursor[L].text.length;else if(cursor.anticursor.parent===this){var cursorPosition=cursor[L]&&cursor[L].text.length;if(this.anticursorPosition===cursorPosition)cursor.anticursor=Point.copy(cursor);else{if(this.anticursorPosition<cursorPosition){var newTextPc=cursor[L].splitRight(this.anticursorPosition);cursor[L]=newTextPc}else var newTextPc=cursor[R].splitRight(this.anticursorPosition-cursorPosition);cursor.anticursor=Point(this,newTextPc[L],newTextPc)}}},_.blur=function(){MathBlock.prototype.blur.call(this),fuseChildren(this)},_.focus=MathBlock.prototype.focus}),TextPiece=P(Node,function(_,super_){function endChar(dir,text){return text.charAt(dir===L?0:-1+text.length)}_.init=function(text){super_.init.call(this),this.text=text},_.jQadd=function(dom){this.dom=dom,this.jQ=$(dom)},_.jQize=function(){return this.jQadd(document.createTextNode(this.text))},_.appendText=function(text){this.text+=text,this.dom.appendData(text)},_.prependText=function(text){this.text=text+this.text,this.dom.insertData(0,text)},_.insTextAtDirEnd=function(text,dir){prayDirection(dir),dir===R?this.appendText(text):this.prependText(text)},_.splitRight=function(i){var newPc=TextPiece(this.text.slice(i)).adopt(this.parent,this,this[R]);return newPc.jQadd(this.dom.splitText(i)),this.text=this.text.slice(0,i),newPc},_.moveTowards=function(dir,cursor){prayDirection(dir);var ch=endChar(-dir,this.text),from=this[-dir];return from?from.insTextAtDirEnd(ch,dir):TextPiece(ch).createDir(-dir,cursor),this.deleteTowards(dir,cursor)},_.latex=function(){return this.text},_.deleteTowards=function(dir,cursor){1<this.text.length?dir===R?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),cursor[dir]=this[dir])},_.selectTowards=function(dir,cursor){prayDirection(dir);var anticursor=cursor.anticursor,ch=endChar(-dir,this.text);if(anticursor[dir]===this){var newPc=TextPiece(ch).createDir(dir,cursor);anticursor[dir]=newPc,cursor.insDirOf(dir,newPc)}else{var from=this[-dir];if(from)from.insTextAtDirEnd(ch,dir);else{var newPc=TextPiece(ch).createDir(-dir,cursor);newPc.jQ.insDirOf(-dir,cursor.selection.jQ)}1===this.text.length&&anticursor[-dir]===this&&(anticursor[-dir]=this[-dir])}return this.deleteTowards(dir,cursor)}});CharCmds.$=LatexCmds.text=LatexCmds.textnormal=LatexCmds.textrm=LatexCmds.textup=LatexCmds.textmd=TextBlock,LatexCmds.em=LatexCmds.italic=LatexCmds.italics=LatexCmds.emph=LatexCmds.textit=LatexCmds.textsl=makeTextBlock("\\textit","i","class=\"mq-text-mode\""),LatexCmds.strong=LatexCmds.bold=LatexCmds.textbf=makeTextBlock("\\textbf","b","class=\"mq-text-mode\""),LatexCmds.sf=LatexCmds.textsf=makeTextBlock("\\textsf","span","class=\"mq-sans-serif mq-text-mode\""),LatexCmds.tt=LatexCmds.texttt=makeTextBlock("\\texttt","span","class=\"mq-monospace mq-text-mode\""),LatexCmds.textsc=makeTextBlock("\\textsc","span","style=\"font-variant:small-caps\" class=\"mq-text-mode\""),LatexCmds.uppercase=makeTextBlock("\\uppercase","span","style=\"text-transform:uppercase\" class=\"mq-text-mode\""),LatexCmds.lowercase=makeTextBlock("\\lowercase","span","style=\"text-transform:lowercase\" class=\"mq-text-mode\"");var RootMathCommand=P(MathCommand,function(_,super_){_.init=function(cursor){super_.init.call(this,"$"),this.cursor=cursor},_.htmlTemplate="<span class=\"mq-math-mode\">&0</span>",_.createBlocks=function(){super_.createBlocks.call(this),this.ends[L].cursor=this.cursor,this.ends[L].write=function(cursor,ch){"$"===ch?this.isEmpty()?(cursor.insRightOf(this.parent),this.parent.deleteTowards(dir,cursor),VanillaSymbol("\\$","$").createLeftOf(cursor.show())):cursor[R]?cursor[L]?MathBlock.prototype.write.call(this,cursor,ch):cursor.insLeftOf(this.parent):cursor.insRightOf(this.parent):MathBlock.prototype.write.call(this,cursor,ch)}},_.latex=function(){return"$"+this.ends[L].latex()+"$"}}),RootTextBlock=P(RootMathBlock,function(_,super_){_.keystroke=function(key){return"Spacebar"===key||"Shift-Spacebar"===key?void 0:super_.keystroke.apply(this,arguments)},_.write=function(cursor,ch){if(cursor.show().deleteSelection(),"$"===ch)RootMathCommand(cursor).createLeftOf(cursor);else{var html;"<"===ch?html="&lt;":">"==ch&&(html="&gt;"),VanillaSymbol(ch,html).createLeftOf(cursor)}}});API.TextField=function(APIClasses){return P(APIClasses.EditableField,function(_,super_){this.RootBlock=RootTextBlock,_.__mathquillify=function(){return super_.__mathquillify.call(this,"mq-editable-field mq-text-mode")},_.latex=function(latex){return 0<arguments.length?(this.__controller.renderLatexText(latex),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})};CharCmds["\\"]=P(MathCommand,function(_,super_){_.ctrlSeq="\\",_.replaces=function(replacedFragment){this._replacedFragment=replacedFragment.disown(),this.isEmpty=function(){return!1}},_.htmlTemplate="<span class=\"mq-latex-command-input mq-non-leaf\">\\<span>&0</span></span>",_.textTemplate=["\\"],_.createBlocks=function(){super_.createBlocks.call(this),this.ends[L].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[L].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[L].write=function(cursor,ch){cursor.show().deleteSelection(),ch.match(/[a-z]/i)?VanillaSymbol(ch).createLeftOf(cursor):(this.parent.renderCommand(cursor),("\\"!==ch||!this.isEmpty())&&this.parent.parent.write(cursor,ch))},this.ends[L].keystroke=function(key,e,ctrlr){return"Tab"===key||"Enter"===key||"Spacebar"===key?(this.parent.renderCommand(ctrlr.cursor),void e.preventDefault()):super_.keystroke.apply(this,arguments)}},_.createLeftOf=function(cursor){if(super_.createLeftOf.call(this,cursor),this._replacedFragment){var el=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(e){return $(e.target=el).trigger(e),!1}).insertBefore(this.jQ).add(this.jQ)}},_.latex=function(){return"\\"+this.ends[L].latex()+" "},_.renderCommand=function(cursor){this.jQ=this.jQ.last(),this.remove(),this[R]?cursor.insLeftOf(this[R]):cursor.insAtRightEnd(this.parent);var latex=this.ends[L].latex();latex||(latex=" ");var cmd=LatexCmds[latex];cmd?(cmd=cmd(latex),this._replacedFragment&&cmd.replaces(this._replacedFragment),cmd.createLeftOf(cursor)):(cmd=TextBlock(),cmd.replaces(latex),cmd.createLeftOf(cursor),cursor.insRightOf(cmd),this._replacedFragment&&this._replacedFragment.remove())}});LatexCmds.notin=LatexCmds.cong=LatexCmds.equiv=LatexCmds.oplus=LatexCmds.otimes=P(BinaryOperator,function(_,super_){_.init=function(latex){super_.init.call(this,"\\"+latex+" ","&"+latex+";")}}),LatexCmds["\u2260"]=LatexCmds.ne=LatexCmds.neq=bind(BinaryOperator,"\\ne ","&ne;"),LatexCmds.ast=LatexCmds.star=LatexCmds.loast=LatexCmds.lowast=bind(BinaryOperator,"\\ast ","&lowast;"),LatexCmds.therefor=LatexCmds.therefore=bind(BinaryOperator,"\\therefore ","&there4;"),LatexCmds.cuz=LatexCmds.because=bind(BinaryOperator,"\\because ","&#8757;"),LatexCmds.prop=LatexCmds.propto=bind(BinaryOperator,"\\propto ","&prop;"),LatexCmds["\u2248"]=LatexCmds.asymp=LatexCmds.approx=bind(BinaryOperator,"\\approx ","&asymp;"),LatexCmds.isin=LatexCmds["in"]=bind(BinaryOperator,"\\in ","&isin;"),LatexCmds.ni=LatexCmds.contains=bind(BinaryOperator,"\\ni ","&ni;"),LatexCmds.notni=LatexCmds.niton=LatexCmds.notcontains=LatexCmds.doesnotcontain=bind(BinaryOperator,"\\not\\ni ","&#8716;"),LatexCmds.sub=LatexCmds.subset=bind(BinaryOperator,"\\subset ","&sub;"),LatexCmds.sup=LatexCmds.supset=LatexCmds.superset=bind(BinaryOperator,"\\supset ","&sup;"),LatexCmds.nsub=LatexCmds.notsub=LatexCmds.nsubset=LatexCmds.notsubset=bind(BinaryOperator,"\\not\\subset ","&#8836;"),LatexCmds.nsup=LatexCmds.notsup=LatexCmds.nsupset=LatexCmds.notsupset=LatexCmds.nsuperset=LatexCmds.notsuperset=bind(BinaryOperator,"\\not\\supset ","&#8837;"),LatexCmds.sube=LatexCmds.subeq=LatexCmds.subsete=LatexCmds.subseteq=bind(BinaryOperator,"\\subseteq ","&sube;"),LatexCmds.supe=LatexCmds.supeq=LatexCmds.supsete=LatexCmds.supseteq=LatexCmds.supersete=LatexCmds.superseteq=bind(BinaryOperator,"\\supseteq ","&supe;"),LatexCmds.nsube=LatexCmds.nsubeq=LatexCmds.notsube=LatexCmds.notsubeq=LatexCmds.nsubsete=LatexCmds.nsubseteq=LatexCmds.notsubsete=LatexCmds.notsubseteq=bind(BinaryOperator,"\\not\\subseteq ","&#8840;"),LatexCmds.nsupe=LatexCmds.nsupeq=LatexCmds.notsupe=LatexCmds.notsupeq=LatexCmds.nsupsete=LatexCmds.nsupseteq=LatexCmds.notsupsete=LatexCmds.notsupseteq=LatexCmds.nsupersete=LatexCmds.nsuperseteq=LatexCmds.notsupersete=LatexCmds.notsuperseteq=bind(BinaryOperator,"\\not\\supseteq ","&#8841;"),LatexCmds.N=LatexCmds.naturals=LatexCmds.Naturals=bind(VanillaSymbol,"\\mathbb{N}","&#8469;"),LatexCmds.P=LatexCmds.primes=LatexCmds.Primes=LatexCmds.projective=LatexCmds.Projective=LatexCmds.probability=LatexCmds.Probability=bind(VanillaSymbol,"\\mathbb{P}","&#8473;"),LatexCmds.Z=LatexCmds.integers=LatexCmds.Integers=bind(VanillaSymbol,"\\mathbb{Z}","&#8484;"),LatexCmds.Q=LatexCmds.rationals=LatexCmds.Rationals=bind(VanillaSymbol,"\\mathbb{Q}","&#8474;"),LatexCmds.R=LatexCmds.reals=LatexCmds.Reals=bind(VanillaSymbol,"\\mathbb{R}","&#8477;"),LatexCmds.C=LatexCmds.complex=LatexCmds.Complex=LatexCmds.complexes=LatexCmds.Complexes=LatexCmds.complexplane=LatexCmds.Complexplane=LatexCmds.ComplexPlane=bind(VanillaSymbol,"\\mathbb{C}","&#8450;"),LatexCmds.H=LatexCmds.Hamiltonian=LatexCmds.quaternions=LatexCmds.Quaternions=bind(VanillaSymbol,"\\mathbb{H}","&#8461;"),LatexCmds.quad=LatexCmds.emsp=bind(VanillaSymbol,"\\quad ","    "),LatexCmds.qquad=bind(VanillaSymbol,"\\qquad ","        "),LatexCmds.diamond=bind(VanillaSymbol,"\\diamond ","&#9671;"),LatexCmds.bigtriangleup=bind(VanillaSymbol,"\\bigtriangleup ","&#9651;"),LatexCmds.ominus=bind(VanillaSymbol,"\\ominus ","&#8854;"),LatexCmds.uplus=bind(VanillaSymbol,"\\uplus ","&#8846;"),LatexCmds.bigtriangledown=bind(VanillaSymbol,"\\bigtriangledown ","&#9661;"),LatexCmds.sqcap=bind(VanillaSymbol,"\\sqcap ","&#8851;"),LatexCmds.triangleleft=bind(VanillaSymbol,"\\triangleleft ","&#8882;"),LatexCmds.sqcup=bind(VanillaSymbol,"\\sqcup ","&#8852;"),LatexCmds.triangleright=bind(VanillaSymbol,"\\triangleright ","&#8883;"),LatexCmds.odot=LatexCmds.circledot=bind(VanillaSymbol,"\\odot ","&#8857;"),LatexCmds.bigcirc=bind(VanillaSymbol,"\\bigcirc ","&#9711;"),LatexCmds.dagger=bind(VanillaSymbol,"\\dagger ","&#0134;"),LatexCmds.ddagger=bind(VanillaSymbol,"\\ddagger ","&#135;"),LatexCmds.wr=bind(VanillaSymbol,"\\wr ","&#8768;"),LatexCmds.amalg=bind(VanillaSymbol,"\\amalg ","&#8720;"),LatexCmds.models=bind(VanillaSymbol,"\\models ","&#8872;"),LatexCmds.prec=bind(VanillaSymbol,"\\prec ","&#8826;"),LatexCmds.succ=bind(VanillaSymbol,"\\succ ","&#8827;"),LatexCmds.preceq=bind(VanillaSymbol,"\\preceq ","&#8828;"),LatexCmds.succeq=bind(VanillaSymbol,"\\succeq ","&#8829;"),LatexCmds.simeq=bind(VanillaSymbol,"\\simeq ","&#8771;"),LatexCmds.mid=bind(VanillaSymbol,"\\mid ","&#8739;"),LatexCmds.ll=bind(VanillaSymbol,"\\ll ","&#8810;"),LatexCmds.gg=bind(VanillaSymbol,"\\gg ","&#8811;"),LatexCmds.parallel=bind(VanillaSymbol,"\\parallel ","&#8741;"),LatexCmds.nparallel=bind(VanillaSymbol,"\\nparallel ","&#8742;"),LatexCmds.bowtie=bind(VanillaSymbol,"\\bowtie ","&#8904;"),LatexCmds.sqsubset=bind(VanillaSymbol,"\\sqsubset ","&#8847;"),LatexCmds.sqsupset=bind(VanillaSymbol,"\\sqsupset ","&#8848;"),LatexCmds.smile=bind(VanillaSymbol,"\\smile ","&#8995;"),LatexCmds.sqsubseteq=bind(VanillaSymbol,"\\sqsubseteq ","&#8849;"),LatexCmds.sqsupseteq=bind(VanillaSymbol,"\\sqsupseteq ","&#8850;"),LatexCmds.doteq=bind(VanillaSymbol,"\\doteq ","&#8784;"),LatexCmds.frown=bind(VanillaSymbol,"\\frown ","&#8994;"),LatexCmds.vdash=bind(VanillaSymbol,"\\vdash ","&#8870;"),LatexCmds.dashv=bind(VanillaSymbol,"\\dashv ","&#8867;"),LatexCmds.nless=bind(VanillaSymbol,"\\nless ","&#8814;"),LatexCmds.ngtr=bind(VanillaSymbol,"\\ngtr ","&#8815;"),LatexCmds.longleftarrow=bind(VanillaSymbol,"\\longleftarrow ","&#8592;"),LatexCmds.longrightarrow=bind(VanillaSymbol,"\\longrightarrow ","&#8594;"),LatexCmds.Longleftarrow=bind(VanillaSymbol,"\\Longleftarrow ","&#8656;"),LatexCmds.Longrightarrow=bind(VanillaSymbol,"\\Longrightarrow ","&#8658;"),LatexCmds.longleftrightarrow=bind(VanillaSymbol,"\\longleftrightarrow ","&#8596;"),LatexCmds.updownarrow=bind(VanillaSymbol,"\\updownarrow ","&#8597;"),LatexCmds.Longleftrightarrow=bind(VanillaSymbol,"\\Longleftrightarrow ","&#8660;"),LatexCmds.Updownarrow=bind(VanillaSymbol,"\\Updownarrow ","&#8661;"),LatexCmds.mapsto=bind(VanillaSymbol,"\\mapsto ","&#8614;"),LatexCmds.nearrow=bind(VanillaSymbol,"\\nearrow ","&#8599;"),LatexCmds.hookleftarrow=bind(VanillaSymbol,"\\hookleftarrow ","&#8617;"),LatexCmds.hookrightarrow=bind(VanillaSymbol,"\\hookrightarrow ","&#8618;"),LatexCmds.searrow=bind(VanillaSymbol,"\\searrow ","&#8600;"),LatexCmds.leftharpoonup=bind(VanillaSymbol,"\\leftharpoonup ","&#8636;"),LatexCmds.rightharpoonup=bind(VanillaSymbol,"\\rightharpoonup ","&#8640;"),LatexCmds.swarrow=bind(VanillaSymbol,"\\swarrow ","&#8601;"),LatexCmds.leftharpoondown=bind(VanillaSymbol,"\\leftharpoondown ","&#8637;"),LatexCmds.rightharpoondown=bind(VanillaSymbol,"\\rightharpoondown ","&#8641;"),LatexCmds.nwarrow=bind(VanillaSymbol,"\\nwarrow ","&#8598;"),LatexCmds.ldots=bind(VanillaSymbol,"\\ldots ","&#8230;"),LatexCmds.cdots=bind(VanillaSymbol,"\\cdots ","&#8943;"),LatexCmds.vdots=bind(VanillaSymbol,"\\vdots ","&#8942;"),LatexCmds.ddots=bind(VanillaSymbol,"\\ddots ","&#8945;"),LatexCmds.surd=bind(VanillaSymbol,"\\surd ","&#8730;"),LatexCmds.triangle=bind(VanillaSymbol,"\\triangle ","&#9651;"),LatexCmds.ell=bind(VanillaSymbol,"\\ell ","&#8467;"),LatexCmds.top=bind(VanillaSymbol,"\\top ","&#8868;"),LatexCmds.flat=bind(VanillaSymbol,"\\flat ","&#9837;"),LatexCmds.natural=bind(VanillaSymbol,"\\natural ","&#9838;"),LatexCmds.sharp=bind(VanillaSymbol,"\\sharp ","&#9839;"),LatexCmds.wp=bind(VanillaSymbol,"\\wp ","&#8472;"),LatexCmds.bot=bind(VanillaSymbol,"\\bot ","&#8869;"),LatexCmds.clubsuit=bind(VanillaSymbol,"\\clubsuit ","&#9827;"),LatexCmds.diamondsuit=bind(VanillaSymbol,"\\diamondsuit ","&#9826;"),LatexCmds.heartsuit=bind(VanillaSymbol,"\\heartsuit ","&#9825;"),LatexCmds.spadesuit=bind(VanillaSymbol,"\\spadesuit ","&#9824;"),LatexCmds.parallelogram=bind(VanillaSymbol,"\\parallelogram ","&#9649;"),LatexCmds.square=bind(VanillaSymbol,"\\square ","&#11036;"),LatexCmds.oint=bind(VanillaSymbol,"\\oint ","&#8750;"),LatexCmds.bigcap=bind(VanillaSymbol,"\\bigcap ","&#8745;"),LatexCmds.bigcup=bind(VanillaSymbol,"\\bigcup ","&#8746;"),LatexCmds.bigsqcup=bind(VanillaSymbol,"\\bigsqcup ","&#8852;"),LatexCmds.bigvee=bind(VanillaSymbol,"\\bigvee ","&#8744;"),LatexCmds.bigwedge=bind(VanillaSymbol,"\\bigwedge ","&#8743;"),LatexCmds.bigodot=bind(VanillaSymbol,"\\bigodot ","&#8857;"),LatexCmds.bigotimes=bind(VanillaSymbol,"\\bigotimes ","&#8855;"),LatexCmds.bigoplus=bind(VanillaSymbol,"\\bigoplus ","&#8853;"),LatexCmds.biguplus=bind(VanillaSymbol,"\\biguplus ","&#8846;"),LatexCmds.lfloor=bind(VanillaSymbol,"\\lfloor ","&#8970;"),LatexCmds.rfloor=bind(VanillaSymbol,"\\rfloor ","&#8971;"),LatexCmds.lceil=bind(VanillaSymbol,"\\lceil ","&#8968;"),LatexCmds.rceil=bind(VanillaSymbol,"\\rceil ","&#8969;"),LatexCmds.opencurlybrace=LatexCmds.lbrace=bind(VanillaSymbol,"\\lbrace ","{"),LatexCmds.closecurlybrace=LatexCmds.rbrace=bind(VanillaSymbol,"\\rbrace ","}"),LatexCmds.lbrack=bind(VanillaSymbol,"["),LatexCmds.rbrack=bind(VanillaSymbol,"]"),LatexCmds["\u222B"]=LatexCmds.int=LatexCmds.integral=bind(_Symbol,"\\int ","<big>&int;</big>"),LatexCmds.slash=bind(VanillaSymbol,"/"),LatexCmds.vert=bind(VanillaSymbol,"|"),LatexCmds.perp=LatexCmds.perpendicular=bind(VanillaSymbol,"\\perp ","&perp;"),LatexCmds.nabla=LatexCmds.del=bind(VanillaSymbol,"\\nabla ","&nabla;"),LatexCmds.hbar=bind(VanillaSymbol,"\\hbar ","&#8463;"),LatexCmds.AA=LatexCmds.Angstrom=LatexCmds.angstrom=bind(VanillaSymbol,"\\text\\AA ","&#8491;"),LatexCmds.ring=LatexCmds.circ=LatexCmds.circle=bind(VanillaSymbol,"\\circ ","&#8728;"),LatexCmds.bull=LatexCmds.bullet=bind(VanillaSymbol,"\\bullet ","&bull;"),LatexCmds.setminus=LatexCmds.smallsetminus=bind(VanillaSymbol,"\\setminus ","&#8726;"),LatexCmds.not=LatexCmds["\xAC"]=LatexCmds.neg=bind(VanillaSymbol,"\\neg ","&not;"),LatexCmds["\u2026"]=LatexCmds.dots=LatexCmds.ellip=LatexCmds.hellip=LatexCmds.ellipsis=LatexCmds.hellipsis=bind(VanillaSymbol,"\\dots ","&hellip;"),LatexCmds.converges=LatexCmds.darr=LatexCmds.dnarr=LatexCmds.dnarrow=LatexCmds.downarrow=bind(VanillaSymbol,"\\downarrow ","&darr;"),LatexCmds.dArr=LatexCmds.dnArr=LatexCmds.dnArrow=LatexCmds.Downarrow=bind(VanillaSymbol,"\\Downarrow ","&dArr;"),LatexCmds.diverges=LatexCmds.uarr=LatexCmds.uparrow=bind(VanillaSymbol,"\\uparrow ","&uarr;"),LatexCmds.uArr=LatexCmds.Uparrow=bind(VanillaSymbol,"\\Uparrow ","&uArr;"),LatexCmds.to=bind(BinaryOperator,"\\to ","&rarr;"),LatexCmds.rarr=LatexCmds.rightarrow=bind(VanillaSymbol,"\\rightarrow ","&rarr;"),LatexCmds.implies=bind(BinaryOperator,"\\Rightarrow ","&rArr;"),LatexCmds.rArr=LatexCmds.Rightarrow=bind(VanillaSymbol,"\\Rightarrow ","&rArr;"),LatexCmds.gets=bind(BinaryOperator,"\\gets ","&larr;"),LatexCmds.larr=LatexCmds.leftarrow=bind(VanillaSymbol,"\\leftarrow ","&larr;"),LatexCmds.impliedby=bind(BinaryOperator,"\\Leftarrow ","&lArr;"),LatexCmds.lArr=LatexCmds.Leftarrow=bind(VanillaSymbol,"\\Leftarrow ","&lArr;"),LatexCmds.harr=LatexCmds.lrarr=LatexCmds.leftrightarrow=bind(VanillaSymbol,"\\leftrightarrow ","&harr;"),LatexCmds.iff=bind(BinaryOperator,"\\Leftrightarrow ","&hArr;"),LatexCmds.hArr=LatexCmds.lrArr=LatexCmds.Leftrightarrow=bind(VanillaSymbol,"\\Leftrightarrow ","&hArr;"),LatexCmds.Re=LatexCmds.Real=LatexCmds.real=bind(VanillaSymbol,"\\Re ","&real;"),LatexCmds.Im=LatexCmds.imag=LatexCmds.image=LatexCmds.imagin=LatexCmds.imaginary=LatexCmds.Imaginary=bind(VanillaSymbol,"\\Im ","&image;"),LatexCmds.part=LatexCmds.partial=bind(VanillaSymbol,"\\partial ","&part;"),LatexCmds.infty=LatexCmds.infin=LatexCmds.infinity=bind(VanillaSymbol,"\\infty ","&infin;"),LatexCmds.alef=LatexCmds.alefsym=LatexCmds.aleph=LatexCmds.alephsym=bind(VanillaSymbol,"\\aleph ","&alefsym;"),LatexCmds.xist=LatexCmds.xists=LatexCmds.exist=LatexCmds.exists=bind(VanillaSymbol,"\\exists ","&exist;"),LatexCmds.and=LatexCmds.land=LatexCmds.wedge=bind(VanillaSymbol,"\\wedge ","&and;"),LatexCmds.or=LatexCmds.lor=LatexCmds.vee=bind(VanillaSymbol,"\\vee ","&or;"),LatexCmds.o=LatexCmds.O=LatexCmds.empty=LatexCmds.emptyset=LatexCmds.oslash=LatexCmds.Oslash=LatexCmds.nothing=LatexCmds.varnothing=bind(BinaryOperator,"\\varnothing ","&empty;"),LatexCmds.cup=LatexCmds.union=bind(BinaryOperator,"\\cup ","&cup;"),LatexCmds.cap=LatexCmds.intersect=LatexCmds.intersection=bind(BinaryOperator,"\\cap ","&cap;"),LatexCmds.deg=LatexCmds.degree=bind(VanillaSymbol,"\\degree ","&deg;"),LatexCmds.ang=LatexCmds.angle=bind(VanillaSymbol,"\\angle ","&ang;"),LatexCmds.measuredangle=bind(VanillaSymbol,"\\measuredangle ","&#8737;");var Digit=P(VanillaSymbol,function(_,super_){_.createLeftOf=function(cursor){cursor.options.autoSubscriptNumerals&&cursor.parent!==cursor.parent.parent.sub&&(cursor[L]instanceof Variable&&!1!==cursor[L].isItalic||cursor[L]instanceof SupSub&&cursor[L][L]instanceof Variable&&!1!==cursor[L][L].isItalic)?(LatexCmds._().createLeftOf(cursor),super_.createLeftOf.call(this,cursor),cursor.insRightOf(cursor.parent.parent)):super_.createLeftOf.call(this,cursor)}}),Variable=P(_Symbol,function(_,super_){_.init=function(ch,html){super_.init.call(this,ch,"<var>"+(html||ch)+"</var>")},_.text=function(){var text=this.ctrlSeq;return!this[L]||this[L]instanceof Variable||this[L]instanceof BinaryOperator||"\\ "===this[L].ctrlSeq||(text="*"+text),!this[R]||this[R]instanceof BinaryOperator||this[R]instanceof SupSub||(text+="*"),text}});Options.p.autoCommands={_maxLength:0},optionProcessors.autoCommands=function(cmds){if(!/^[a-z]+(?: [a-z]+)*$/i.test(cmds))throw"\""+cmds+"\" not a space-delimited list of only letters";for(var list=cmds.split(" "),dict={},maxLength=0,i=0,cmd;i<list.length;i+=1){if(cmd=list[i],2>cmd.length)throw"autocommand \""+cmd+"\" not minimum length of 2";if(LatexCmds[cmd]===OperatorName)throw"\""+cmd+"\" is a built-in operator name";dict[cmd]=1,maxLength=max(maxLength,cmd.length)}return dict._maxLength=maxLength,dict};var Letter=P(Variable,function(_,super_){function nonOperatorSymbol(node){return node instanceof _Symbol&&!(node instanceof BinaryOperator)}_.init=function(ch){return super_.init.call(this,this.letter=ch)},_.createLeftOf=function(cursor){var autoCmds=cursor.options.autoCommands,maxLength=autoCmds._maxLength;if(0<maxLength){for(var str=this.letter,l=cursor[L],i=1;l instanceof Letter&&i<maxLength;)str=l.letter+str,l=l[L],i+=1;for(;str.length;){if(autoCmds.hasOwnProperty(str)){for(var i=2,l=cursor[L];i<str.length;i+=1,l=l[L]);return Fragment(l,cursor[L]).remove(),cursor[L]=l[L],LatexCmds[str](str).createLeftOf(cursor)}str=str.slice(1)}}super_.createLeftOf.apply(this,arguments)},_.italicize=function(bool){return this.isItalic=bool,this.jQ.toggleClass("mq-operator-name",!bool),this},_.finalizeTree=_.siblingDeleted=_.siblingCreated=function(opts,dir){dir!==L&&this[R]instanceof Letter||this.autoUnItalicize(opts)},_.autoUnItalicize=function(opts){var autoOps=opts.autoOperatorNames;if(0!==autoOps._maxLength){for(var str=this.letter,l=this[L];l instanceof Letter;l=l[L])str=l.letter+str;for(var r=this[R];r instanceof Letter;r=r[R])str+=r.letter;Fragment(l[R]||this.parent.ends[L],r[L]||this.parent.ends[R]).each(function(el){el.italicize(!0).jQ.removeClass("mq-first mq-last"),el.ctrlSeq=el.letter});outer:for(var i=0,first=l[R]||this.parent.ends[L];i<str.length;i+=1,first=first[R])for(var len=min(autoOps._maxLength,str.length-i),word;0<len;len-=1)if(word=str.slice(i,i+len),autoOps.hasOwnProperty(word)){for(var j=0,letter=first;j<len;j+=1,letter=letter[R]){letter.italicize(!1);var last=letter}var isBuiltIn=BuiltInOpNames.hasOwnProperty(word);first.ctrlSeq=(isBuiltIn?"\\":"\\operatorname{")+first.ctrlSeq,last.ctrlSeq+=isBuiltIn?" ":"}",TwoWordOpNames.hasOwnProperty(word)&&last[L][L][L].jQ.addClass("mq-last"),nonOperatorSymbol(first[L])&&first.jQ.addClass("mq-first"),nonOperatorSymbol(last[R])&&last.jQ.addClass("mq-last"),i+=len-1,first=last;continue outer}}}}),BuiltInOpNames={},AutoOpNames=Options.p.autoOperatorNames={_maxLength:9},TwoWordOpNames={limsup:1,liminf:1,projlim:1,injlim:1};(function(){for(var mostOps="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),i=0;i<mostOps.length;i+=1)BuiltInOpNames[mostOps[i]]=AutoOpNames[mostOps[i]]=1;for(var builtInTrigs=["sin","cos","tan","arcsin","arccos","arctan","sinh","cosh","tanh","sec","csc","cot","coth"],i=0;i<builtInTrigs.length;i+=1)BuiltInOpNames[builtInTrigs[i]]=1;for(var autoTrigs=["sin","cos","tan","sec","cosec","csc","cotan","cot","ctg"],i=0;i<autoTrigs.length;i+=1)AutoOpNames[autoTrigs[i]]=AutoOpNames["arc"+autoTrigs[i]]=AutoOpNames[autoTrigs[i]+"h"]=AutoOpNames["ar"+autoTrigs[i]+"h"]=AutoOpNames["arc"+autoTrigs[i]+"h"]=1;for(var moreNonstandardOps=["gcf","hcf","lcm","proj","span"],i=0;i<moreNonstandardOps.length;i+=1)AutoOpNames[moreNonstandardOps[i]]=1})(),optionProcessors.autoOperatorNames=function(cmds){if(!/^[a-z]+(?: [a-z]+)*$/i.test(cmds))throw"\""+cmds+"\" not a space-delimited list of only letters";for(var list=cmds.split(" "),dict={},maxLength=0,i=0,cmd;i<list.length;i+=1){if(cmd=list[i],2>cmd.length)throw"\""+cmd+"\" not minimum length of 2";dict[cmd]=1,maxLength=max(maxLength,cmd.length)}return dict._maxLength=maxLength,dict};var OperatorName=P(_Symbol,function(_){_.init=function(fn){this.ctrlSeq=fn},_.createLeftOf=function(cursor){for(var fn=this.ctrlSeq,i=0;i<fn.length;i+=1)Letter(fn.charAt(i)).createLeftOf(cursor)},_.parser=function(){for(var fn=this.ctrlSeq,block=MathBlock(),i=0;i<fn.length;i+=1)Letter(fn.charAt(i)).adopt(block,block.ends[R],0);return Parser.succeed(block.children())}});for(var fn in AutoOpNames)AutoOpNames.hasOwnProperty(fn)&&(LatexCmds[fn]=OperatorName);LatexCmds.operatorname=P(MathCommand,function(_){_.createLeftOf=noop,_.numBlocks=function(){return 1},_.parser=function(){return latexMathParser.block.map(function(b){return b.children()})}}),LatexCmds.f=P(Letter,function(_,super_){_.init=function(){_Symbol.p.init.call(this,this.letter="f","<var class=\"mq-f\">f</var>")},_.italicize=function(bool){return this.jQ.html("f").toggleClass("mq-f",bool),super_.italicize.apply(this,arguments)}}),LatexCmds[" "]=LatexCmds.space=bind(VanillaSymbol,"\\ ","&nbsp;"),LatexCmds["'"]=LatexCmds.prime=bind(VanillaSymbol,"'","&prime;"),LatexCmds.backslash=bind(VanillaSymbol,"\\backslash ","\\"),CharCmds["\\"]||(CharCmds["\\"]=LatexCmds.backslash),LatexCmds.$=bind(VanillaSymbol,"\\$","$");var NonSymbolaSymbol=P(_Symbol,function(_,super_){_.init=function(ch,html){super_.init.call(this,ch,"<span class=\"mq-nonSymbola\">"+(html||ch)+"</span>")}});LatexCmds["@"]=NonSymbolaSymbol,LatexCmds["&"]=bind(NonSymbolaSymbol,"\\&","&amp;"),LatexCmds["%"]=bind(NonSymbolaSymbol,"\\%","%"),LatexCmds.alpha=LatexCmds.beta=LatexCmds.gamma=LatexCmds.delta=LatexCmds.zeta=LatexCmds.eta=LatexCmds.theta=LatexCmds.iota=LatexCmds.kappa=LatexCmds.mu=LatexCmds.nu=LatexCmds.xi=LatexCmds.rho=LatexCmds.sigma=LatexCmds.tau=LatexCmds.chi=LatexCmds.psi=LatexCmds.omega=P(Variable,function(_,super_){_.init=function(latex){super_.init.call(this,"\\"+latex+" ","&"+latex+";")}}),LatexCmds.phi=bind(Variable,"\\phi ","&#981;"),LatexCmds.phiv=LatexCmds.varphi=bind(Variable,"\\varphi ","&phi;"),LatexCmds.epsilon=bind(Variable,"\\epsilon ","&#1013;"),LatexCmds.epsiv=LatexCmds.varepsilon=bind(Variable,"\\varepsilon ","&epsilon;"),LatexCmds.piv=LatexCmds.varpi=bind(Variable,"\\varpi ","&piv;"),LatexCmds.sigmaf=LatexCmds.sigmav=LatexCmds.varsigma=bind(Variable,"\\varsigma ","&sigmaf;"),LatexCmds.thetav=LatexCmds.vartheta=LatexCmds.thetasym=bind(Variable,"\\vartheta ","&thetasym;"),LatexCmds.upsilon=LatexCmds.upsi=bind(Variable,"\\upsilon ","&upsilon;"),LatexCmds.gammad=LatexCmds.Gammad=LatexCmds.digamma=bind(Variable,"\\digamma ","&#989;"),LatexCmds.kappav=LatexCmds.varkappa=bind(Variable,"\\varkappa ","&#1008;"),LatexCmds.rhov=LatexCmds.varrho=bind(Variable,"\\varrho ","&#1009;"),LatexCmds.pi=LatexCmds.π=bind(NonSymbolaSymbol,"\\pi ","&pi;"),LatexCmds.lambda=bind(NonSymbolaSymbol,"\\lambda ","&lambda;"),LatexCmds.Upsilon=LatexCmds.Upsi=LatexCmds.upsih=LatexCmds.Upsih=bind(_Symbol,"\\Upsilon ","<var style=\"font-family: serif\">&upsih;</var>"),LatexCmds.Gamma=LatexCmds.Delta=LatexCmds.Theta=LatexCmds.Lambda=LatexCmds.Xi=LatexCmds.Pi=LatexCmds.Sigma=LatexCmds.Phi=LatexCmds.Psi=LatexCmds.Omega=LatexCmds.forall=P(VanillaSymbol,function(_,super_){_.init=function(latex){super_.init.call(this,"\\"+latex+" ","&"+latex+";")}});var LatexFragment=P(MathCommand,function(_){_.init=function(latex){this.latex=latex},_.createLeftOf=function(cursor){var block=latexMathParser.parse(this.latex);block.children().adopt(cursor.parent,cursor[L],cursor[R]),cursor[L]=block.ends[R],block.jQize().insertBefore(cursor.jQ),block.finalizeInsert(cursor.options,cursor),block.ends[R][R].siblingCreated&&block.ends[R][R].siblingCreated(cursor.options,L),block.ends[L][L].siblingCreated&&block.ends[L][L].siblingCreated(cursor.options,R),cursor.parent.bubble("reflow")},_.parser=function(){var frag=latexMathParser.parse(this.latex).children();return Parser.succeed(frag)}});LatexCmds["\xB9"]=bind(LatexFragment,"^1"),LatexCmds["\xB2"]=bind(LatexFragment,"^2"),LatexCmds["\xB3"]=bind(LatexFragment,"^3"),LatexCmds["\xBC"]=bind(LatexFragment,"\\frac14"),LatexCmds["\xBD"]=bind(LatexFragment,"\\frac12"),LatexCmds["\xBE"]=bind(LatexFragment,"\\frac34");var PlusMinus=P(BinaryOperator,function(_){_.init=VanillaSymbol.prototype.init,_.contactWeld=_.siblingCreated=_.siblingDeleted=function(opts,dir){if(dir!==R)return this.jQ[0].className=!this[L]||this[L]instanceof BinaryOperator?"":"mq-binary-operator",this}});LatexCmds["+"]=bind(PlusMinus,"+","+"),LatexCmds["\u2013"]=LatexCmds["-"]=bind(PlusMinus,"-","&minus;"),LatexCmds["\xB1"]=LatexCmds.pm=LatexCmds.plusmn=LatexCmds.plusminus=bind(PlusMinus,"\\pm ","&plusmn;"),LatexCmds.mp=LatexCmds.mnplus=LatexCmds.minusplus=bind(PlusMinus,"\\mp ","&#8723;"),CharCmds["*"]=LatexCmds.sdot=LatexCmds.cdot=bind(BinaryOperator,"\\cdot ","&middot;","*");var Inequality=P(BinaryOperator,function(_,super_){_.init=function(data,strict){this.data=data,this.strict=strict;var strictness=strict?"Strict":"";super_.init.call(this,data["ctrlSeq"+strictness],data["html"+strictness],data["text"+strictness])},_.swap=function(strict){this.strict=strict;var strictness=strict?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+strictness],this.jQ.html(this.data["html"+strictness]),this.textTemplate=[this.data["text"+strictness]]},_.deleteTowards=function(dir){return dir!==L||this.strict?void super_.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),less={ctrlSeq:"\\le ",html:"&le;",text:"\u2264",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},greater={ctrlSeq:"\\ge ",html:"&ge;",text:"\u2265",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};LatexCmds["<"]=LatexCmds.lt=bind(Inequality,less,!0),LatexCmds[">"]=LatexCmds.gt=bind(Inequality,greater,!0),LatexCmds["\u2264"]=LatexCmds.le=LatexCmds.leq=bind(Inequality,less,!1),LatexCmds["\u2265"]=LatexCmds.ge=LatexCmds.geq=bind(Inequality,greater,!1);var Equality=P(BinaryOperator,function(_,super_){_.init=function(){super_.init.call(this,"=","=")},_.createLeftOf=function(cursor){return cursor[L]instanceof Inequality&&cursor[L].strict?(cursor[L].swap(!1),void cursor[L].bubble("reflow")):void super_.createLeftOf.apply(this,arguments)}});LatexCmds["="]=Equality,LatexCmds["\xD7"]=LatexCmds.times=bind(BinaryOperator,"\\times ","&times;","[x]"),LatexCmds["\xF7"]=LatexCmds.div=LatexCmds.divide=LatexCmds.divides=bind(BinaryOperator,"\\div ","&divide;","[/]"),CharCmds["~"]=LatexCmds.sim=bind(BinaryOperator,"\\sim ","~","~");var forceIERedraw=noop,div=document.createElement("div"),div_style=div.style,transformPropNames={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1},scale,transformPropName;for(var prop in transformPropNames)if(prop in div_style){transformPropName=prop;break}transformPropName?scale=function(jQ,x,y){jQ.css(transformPropName,"scale("+x+","+y+")")}:"filter"in div_style?(forceIERedraw=function(el){el.className=el.className},scale=function(jQ,x,y){function calculateMarginRight(){jQ.css("marginRight",(innerjQ.width()-1)*(x-1)/x+"px")}x/=1+(y-1)/2,jQ.css("fontSize",y+"em"),jQ.hasClass("mq-matrixed-container")||jQ.addClass("mq-matrixed-container").wrapInner("<span class=\"mq-matrixed\"></span>");var innerjQ=jQ.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+x+",SizingMethod='auto expand')");calculateMarginRight();var intervalId=setInterval(calculateMarginRight);$(window).load(function(){clearTimeout(intervalId),calculateMarginRight()})}):scale=function(jQ,x,y){jQ.css("fontSize",y+"em")};var Style=P(MathCommand,function(_,super_){_.init=function(ctrlSeq,tagName,attrs){super_.init.call(this,ctrlSeq,"<"+tagName+" "+attrs+">&0</"+tagName+">")}});LatexCmds.mathrm=bind(Style,"\\mathrm","span","class=\"mq-roman mq-font\""),LatexCmds.mathit=bind(Style,"\\mathit","i","class=\"mq-font\""),LatexCmds.mathbf=bind(Style,"\\mathbf","b","class=\"mq-font\""),LatexCmds.mathsf=bind(Style,"\\mathsf","span","class=\"mq-sans-serif mq-font\""),LatexCmds.mathtt=bind(Style,"\\mathtt","span","class=\"mq-monospace mq-font\""),LatexCmds.underline=bind(Style,"\\underline","span","class=\"mq-non-leaf mq-underline\""),LatexCmds.overline=LatexCmds.bar=bind(Style,"\\overline","span","class=\"mq-non-leaf mq-overline\""),LatexCmds.overrightarrow=bind(Style,"\\overrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-right\""),LatexCmds.overleftarrow=bind(Style,"\\overleftarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-left\"");var TextColor=LatexCmds.textcolor=P(MathCommand,function(_,super_){_.setColor=function(color){this.color=color,this.htmlTemplate="<span class=\"mq-textcolor\" style=\"color:"+color+"\">&0</span>"},_.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},_.parser=function(){var self=this,optWhitespace=Parser.optWhitespace,string=Parser.string,regex=Parser.regex;return optWhitespace.then(string("{")).then(regex(/^[#\w\s.,()%-]*/)).skip(string("}")).then(function(color){return self.setColor(color),super_.parser.call(self)})}}),Class=LatexCmds["class"]=P(MathCommand,function(_,super_){_.parser=function(){var self=this,string=Parser.string,regex=Parser.regex;return Parser.optWhitespace.then(string("{")).then(regex(/^[-\w\s\\\xA0-\xFF]*/)).skip(string("}")).then(function(cls){return self.htmlTemplate="<span class=\"mq-class "+cls+"\">&0</span>",super_.parser.call(self)})}}),SupSub=P(MathCommand,function(_,super_){_.ctrlSeq="_{...}^{...}",_.createLeftOf=function(cursor){return!cursor[L]&&cursor.options.supSubsRequireOperand?void 0:super_.createLeftOf.apply(this,arguments)},_.contactWeld=function(cursor){for(var dir=L;dir;dir=!(dir!==L)&&R)if(this[dir]instanceof SupSub){for(var supsub="sub";supsub;supsub=!("sub"!==supsub)&&"sup"){var src=this[supsub],dest=this[dir][supsub];if(src){if(!dest)this[dir].addBlock(src.disown());else if(!src.isEmpty()){src.jQ.children().insAtDirEnd(-dir,dest.jQ);var children=src.children().disown(),pt=Point(dest,children.ends[R],dest.ends[L]);dir===L?children.adopt(dest,dest.ends[R],0):children.adopt(dest,0,dest.ends[L])}else var pt=Point(dest,0,dest.ends[L]);this.placeCursor=function(dest,src){return function(cursor){cursor.insAtDirEnd(-dir,dest||src)}}(dest,src)}}this.remove(),cursor&&cursor[L]===this&&(dir===R&&pt?pt[L]?cursor.insRightOf(pt[L]):cursor.insAtLeftEnd(pt.parent):cursor.insRightOf(this[dir]));break}this.respace()},Options.p.charsThatBreakOutOfSupSub="",_.finalizeTree=function(){this.ends[L].write=function(cursor,ch){if(cursor.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===ch)return;var cmd=this.chToCmd(ch);return cmd instanceof _Symbol?cursor.deleteSelection():cursor.clearSelection().insRightOf(this.parent),cmd.createLeftOf(cursor.show())}cursor[L]&&!cursor[R]&&!cursor.selection&&-1<cursor.options.charsThatBreakOutOfSupSub.indexOf(ch)&&cursor.insRightOf(this.parent),MathBlock.p.write.apply(this,arguments)}},_.moveTowards=function(dir,cursor){cursor.options.autoSubscriptNumerals&&!this.sup?cursor.insDirOf(dir,this):super_.moveTowards.apply(this,arguments)},_.deleteTowards=function(dir,cursor){if(cursor.options.autoSubscriptNumerals&&this.sub){var cmd=this.sub.ends[-dir];cmd instanceof _Symbol?cmd.remove():cmd&&cmd.deleteTowards(dir,cursor.insAtDirEnd(-dir,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(L,cursor.insAtLeftEnd(this.sub)),this.sup&&cursor.insDirOf(-dir,this))}else super_.deleteTowards.apply(this,arguments)},_.latex=function(){function latex(prefix,block){var l=block&&block.latex();return block?prefix+(1===l.length?l:"{"+(l||" ")+"}"):""}return latex("_",this.sub)+latex("^",this.sup)},_.respace=_.siblingCreated=_.siblingDeleted=function(opts,dir){dir===R||this.jQ.toggleClass("mq-limit","\\int "===this[L].ctrlSeq)},_.addBlock=function(block){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=block,block.adopt(this,this.sub,0).downOutOf=this.sub,block.jQ=$("<span class=\"mq-sup\"/>").append(block.jQ.children()).attr("mathquill-block-id",block.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=block,block.adopt(this,0,this.sup).upOutOf=this.sup,block.jQ=$("<span class=\"mq-sub\"></span>").append(block.jQ.children()).attr("mathquill-block-id",block.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append("<span style=\"display:inline-block;width:0\">&#8203;</span>"));for(var i=0;2>i;i+=1)(function(cmd,supsub,oppositeSupsub,updown){cmd[supsub].deleteOutOf=function(dir,cursor){if(cursor.insDirOf(this[dir]?-dir:dir,this.parent),!this.isEmpty()){var end=this.ends[dir];this.children().disown().withDirAdopt(dir,cursor.parent,cursor[dir],cursor[-dir]).jQ.insDirOf(-dir,cursor.jQ),cursor[-dir]=end}cmd.supsub=oppositeSupsub,delete cmd[supsub],delete cmd[updown+"Into"],cmd[oppositeSupsub][updown+"OutOf"]=insLeftOfMeUnlessAtEnd,delete cmd[oppositeSupsub].deleteOutOf,"sub"===supsub&&$(cmd.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,["sub","sup"][i],["sup","sub"][i],["down","up"][i])}});LatexCmds.subscript=LatexCmds._=P(SupSub,function(_,super_){_.supsub="sub",_.htmlTemplate="<span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",_.textTemplate=["_"],_.finalizeTree=function(){this.downInto=this.sub=this.ends[L],this.sub.upOutOf=insLeftOfMeUnlessAtEnd,super_.finalizeTree.call(this)}}),LatexCmds.superscript=LatexCmds.supscript=LatexCmds["^"]=P(SupSub,function(_,super_){_.supsub="sup",_.htmlTemplate="<span class=\"mq-supsub mq-non-leaf mq-sup-only\"><span class=\"mq-sup\">&0</span></span>",_.textTemplate=["^"],_.finalizeTree=function(){this.upInto=this.sup=this.ends[R],this.sup.downOutOf=insLeftOfMeUnlessAtEnd,super_.finalizeTree.call(this)}});var SummationNotation=P(MathCommand,function(_,super_){_.init=function(ch,html){_Symbol.prototype.init.call(this,ch,"<span class=\"mq-large-operator mq-non-leaf\"><span class=\"mq-to\"><span>&1</span></span><big>"+html+"</big><span class=\"mq-from\"><span>&0</span></span></span>")},_.createLeftOf=function(cursor){super_.createLeftOf.apply(this,arguments),cursor.options.sumStartsWithNEquals&&(Letter("n").createLeftOf(cursor),Equality().createLeftOf(cursor))},_.latex=function(){function simplify(latex){return 1===latex.length?latex:"{"+(latex||" ")+"}"}return this.ctrlSeq+"_"+simplify(this.ends[L].latex())+"^"+simplify(this.ends[R].latex())},_.parser=function(){for(var string=Parser.string,optWhitespace=Parser.optWhitespace,succeed=Parser.succeed,block=latexMathParser.block,self=this,blocks=self.blocks=[MathBlock(),MathBlock()],i=0;i<blocks.length;i+=1)blocks[i].adopt(self,self.ends[R],0);return optWhitespace.then(string("_").or(string("^"))).then(function(supOrSub){var child=blocks["_"===supOrSub?0:1];return block.then(function(block){return block.children().adopt(child,child.ends[R],0),succeed(self)})}).many().result(self)},_.finalizeTree=function(){this.downInto=this.ends[L],this.upInto=this.ends[R],this.ends[L].upOutOf=this.ends[R],this.ends[R].downOutOf=this.ends[L]}});LatexCmds["\u2211"]=LatexCmds.sum=LatexCmds.summation=bind(SummationNotation,"\\sum ","&sum;"),LatexCmds["\u220F"]=LatexCmds.prod=LatexCmds.product=bind(SummationNotation,"\\prod ","&prod;"),LatexCmds.coprod=LatexCmds.coproduct=bind(SummationNotation,"\\coprod ","&#8720;");var Fraction=LatexCmds.frac=LatexCmds.dfrac=LatexCmds.cfrac=LatexCmds.fraction=P(MathCommand,function(_){_.ctrlSeq="\\frac",_.htmlTemplate="<span class=\"mq-fraction mq-non-leaf\"><span class=\"mq-numerator\">&0</span><span class=\"mq-denominator\">&1</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",_.textTemplate=["(",")/(",")"],_.finalizeTree=function(){this.upInto=this.ends[R].upOutOf=this.ends[L],this.downInto=this.ends[L].downOutOf=this.ends[R]}}),LiveFraction=LatexCmds.over=CharCmds["/"]=P(Fraction,function(_,super_){_.createLeftOf=function(cursor){if(!this.replacedFragment){for(var leftward=cursor[L];leftward&&!(leftward instanceof BinaryOperator||leftward instanceof(LatexCmds.text||noop)||leftward instanceof SummationNotation||"\\ "===leftward.ctrlSeq||/^[,;:]$/.test(leftward.ctrlSeq));)leftward=leftward[L];leftward instanceof SummationNotation&&leftward[R]instanceof SupSub&&(leftward=leftward[R],leftward[R]instanceof SupSub&&leftward[R].ctrlSeq!=leftward.ctrlSeq&&(leftward=leftward[R])),leftward!==cursor[L]&&(this.replaces(Fragment(leftward[R]||cursor.parent.ends[L],cursor[L])),cursor[L]=leftward)}super_.createLeftOf.call(this,cursor)}}),SquareRoot=LatexCmds.sqrt=LatexCmds["\u221A"]=P(MathCommand,function(_,super_){_.ctrlSeq="\\sqrt",_.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-sqrt-prefix\">&radic;</span><span class=\"mq-non-leaf mq-sqrt-stem\">&0</span></span>",_.textTemplate=["sqrt(",")"],_.parser=function(){return latexMathParser.optBlock.then(function(optBlock){return latexMathParser.block.map(function(block){var nthroot=NthRoot();return nthroot.blocks=[optBlock,block],optBlock.adopt(nthroot,0,0),block.adopt(nthroot,optBlock,0),nthroot})}).or(super_.parser.call(this))},_.reflow=function(){var block=this.ends[R].jQ;scale(block.prev(),1,block.innerHeight()/+block.css("fontSize").slice(0,-2)-.1)}}),Vec=LatexCmds.vec=P(MathCommand,function(_){_.ctrlSeq="\\vec",_.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-vector-prefix\">&rarr;</span><span class=\"mq-vector-stem\">&0</span></span>",_.textTemplate=["vec(",")"]}),NthRoot=LatexCmds.nthroot=P(SquareRoot,function(_){_.htmlTemplate="<sup class=\"mq-nthroot mq-non-leaf\">&0</sup><span class=\"mq-scaled\"><span class=\"mq-sqrt-prefix mq-scaled\">&radic;</span><span class=\"mq-sqrt-stem mq-non-leaf\">&1</span></span>",_.textTemplate=["sqrt[","](",")"],_.latex=function(){return"\\sqrt["+this.ends[L].latex()+"]{"+this.ends[R].latex()+"}"}}),Bracket=P(P(MathCommand,DelimsMixin),function(_,super_){_.init=function(side,open,close,ctrlSeq,end){super_.init.call(this,"\\left"+ctrlSeq,void 0,[open,close]),this.side=side,this.sides={},this.sides[L]={ch:open,ctrlSeq:ctrlSeq},this.sides[R]={ch:close,ctrlSeq:end}},_.numBlocks=function(){return 1},_.html=function(){return this.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-paren"+(this.side===R?" mq-ghost":"")+"\">"+this.sides[L].ch+"</span><span class=\"mq-non-leaf\">&0</span><span class=\"mq-scaled mq-paren"+(this.side===L?" mq-ghost":"")+"\">"+this.sides[R].ch+"</span></span>",super_.html.call(this)},_.latex=function(){return"\\left"+this.sides[L].ctrlSeq+this.ends[L].latex()+"\\right"+this.sides[R].ctrlSeq},_.oppBrack=function(opts,node,expectedSide){return node instanceof Bracket&&node.side&&node.side!==-expectedSide&&("|"===this.sides[this.side].ch||node.side===-this.side)&&(!opts.restrictMismatchedBrackets||OPP_BRACKS[this.sides[this.side].ch]===node.sides[node.side].ch||{"(":"]","[":")"}[this.sides[L].ch]===node.sides[R].ch)&&node},_.closeOpposing=function(brack){brack.side=0,brack.sides[this.side]=this.sides[this.side],brack.delimjQs.eq(this.side===L?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},_.createLeftOf=function(cursor){if(!this.replacedFragment)var opts=cursor.options,brack=this.oppBrack(opts,cursor[L],L)||this.oppBrack(opts,cursor[R],R)||this.oppBrack(opts,cursor.parent.parent);if(brack){var side=this.side=-brack.side;this.closeOpposing(brack),brack===cursor.parent.parent&&cursor[side]&&(Fragment(cursor[side],cursor.parent.ends[side],-side).disown().withDirAdopt(-side,brack.parent,brack,brack[side]).jQ.insDirOf(side,brack.jQ),brack.bubble("reflow"))}else brack=this,side=brack.side,brack.replacedFragment?brack.side=0:cursor[-side]&&(brack.replaces(Fragment(cursor[-side],cursor.parent.ends[-side],side)),cursor[-side]=0),super_.createLeftOf.call(brack,cursor);side===L?cursor.insAtLeftEnd(brack.ends[L]):cursor.insRightOf(brack)},_.placeCursor=noop,_.unwrap=function(){this.ends[L].children().disown().adopt(this.parent,this,this[R]).jQ.insertAfter(this.jQ),this.remove()},_.deleteSide=function(side,outward,cursor){var parent=this.parent,sib=this[side],farEnd=parent.ends[side];if(side===this.side)return this.unwrap(),void(sib?cursor.insDirOf(-side,sib):cursor.insAtDirEnd(side,parent));var opts=cursor.options,wasSolid=!this.side;if(this.side=-side,this.oppBrack(opts,this.ends[L].ends[this.side],side)){this.closeOpposing(this.ends[L].ends[this.side]);var origEnd=this.ends[L].ends[side];this.unwrap(),origEnd.siblingCreated&&origEnd.siblingCreated(cursor.options,side),sib?cursor.insDirOf(-side,sib):cursor.insAtDirEnd(side,parent)}else{if(this.oppBrack(opts,this.parent.parent,side))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(outward&&wasSolid)return this.unwrap(),void(sib?cursor.insDirOf(-side,sib):cursor.insAtDirEnd(side,parent));this.sides[side]={ch:OPP_BRACKS[this.sides[this.side].ch],ctrlSeq:OPP_BRACKS[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(side===L?0:1).addClass("mq-ghost").html(this.sides[side].ch)}if(sib){var origEnd=this.ends[L].ends[side];Fragment(sib,farEnd,-side).disown().withDirAdopt(-side,this.ends[L],origEnd,0).jQ.insAtDirEnd(side,this.ends[L].jQ.removeClass("mq-empty")),origEnd.siblingCreated&&origEnd.siblingCreated(cursor.options,side),cursor.insDirOf(-side,sib)}else outward?cursor.insDirOf(side,this):cursor.insAtDirEnd(side,this.ends[L])}},_.deleteTowards=function(dir,cursor){this.deleteSide(-dir,!1,cursor)},_.finalizeTree=function(){this.ends[L].deleteOutOf=function(dir,cursor){this.parent.deleteSide(dir,!0,cursor)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===L?1:0).removeClass("mq-ghost"),this.side=0}},_.siblingCreated=function(opts,dir){dir===-this.side&&this.finalizeTree()}}),OPP_BRACKS={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};bindCharBracketPair("("),bindCharBracketPair("["),bindCharBracketPair("{","\\{"),LatexCmds.langle=bind(Bracket,L,"&lang;","&rang;","\\langle ","\\rangle "),LatexCmds.rangle=bind(Bracket,R,"&lang;","&rang;","\\langle ","\\rangle "),CharCmds["|"]=bind(Bracket,L,"|","|","|","|"),LatexCmds.left=P(MathCommand,function(_){_.parser=function(){var regex=Parser.regex,string=Parser.string,succeed=Parser.succeed,optWhitespace=Parser.optWhitespace;return optWhitespace.then(regex(/^(?:[([|]|\\\{)/)).then(function(ctrlSeq){var open="\\"===ctrlSeq.charAt(0)?ctrlSeq.slice(1):ctrlSeq;return latexMathParser.then(function(block){return string("\\right").skip(optWhitespace).then(regex(/^(?:[\])|]|\\\})/)).map(function(end){var close="\\"===end.charAt(0)?end.slice(1):end,cmd=Bracket(0,open,close,ctrlSeq,end);return cmd.blocks=[block],block.adopt(cmd,0,0),cmd})})})}}),LatexCmds.right=P(MathCommand,function(_){_.parser=function(){return Parser.fail("unmatched \\right")}});var Binomial=LatexCmds.binom=LatexCmds.binomial=P(P(MathCommand,DelimsMixin),function(_){_.ctrlSeq="\\binom",_.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-paren mq-scaled\">(</span><span class=\"mq-non-leaf\"><span class=\"mq-array mq-non-leaf\"><span>&0</span><span>&1</span></span></span><span class=\"mq-paren mq-scaled\">)</span></span>",_.textTemplate=["choose(",",",")"]}),Choose=LatexCmds.choose=P(Binomial,function(_){_.createLeftOf=LiveFraction.prototype.createLeftOf});LatexCmds.editable=LatexCmds.MathQuillMathField=P(MathCommand,function(_,super_){_.ctrlSeq="\\MathQuillMathField",_.htmlTemplate="<span class=\"mq-editable-field\"><span class=\"mq-root-block\">&0</span></span>",_.parser=function(){var self=this,string=Parser.string,regex=Parser.regex,succeed=Parser.succeed;return string("[").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("]")).map(function(name){self.name=name}).or(succeed()).then(super_.parser.call(self))},_.finalizeTree=function(){var ctrlr=Controller(this.ends[L],this.jQ,Options());ctrlr.KIND_OF_MQ="MathField",ctrlr.editable=!0,ctrlr.createTextarea(),ctrlr.editablesTextareaEvents(),ctrlr.cursor.insAtRightEnd(ctrlr.root),RootBlockMixin(ctrlr.root)},_.registerInnerField=function(innerFields,MathField){innerFields.push(innerFields[this.name]=MathField(this.ends[L].controller))},_.latex=function(){return this.ends[L].latex()},_.text=function(){return this.ends[L].text()}});var Embed=LatexCmds.embed=P(_Symbol,function(_){_.setOptions=function(options){function noop(){return""}return this.text=options.text||noop,this.htmlTemplate=options.htmlString||"",this.latex=options.latex||noop,this},_.parser=function(){var self=this;return string=Parser.string,regex=Parser.regex,succeed=Parser.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(name){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(data){return self.setOptions(EMBEDS[name](data))})})}}),MQ1=getInterface(1);for(var key in MQ1)(function(key,val){"function"==typeof val?(MathQuill[key]=function(){return insistOnInterVer(),val.apply(this,arguments)},MathQuill[key].prototype=val.prototype):MathQuill[key]=val})(key,MQ1[key]);return MathQuill}),define("tpl!taoQtiItem/qtiCreator/editor/mathInput/tpl/mathInput",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"math-input\">\n    <div class=\"math-input-toolbar\"></div>\n    <div class=\"math-input-form\">\n        <span class=\"math-input-mathquill\"></span>\n    </div>\n</div>"})}),define("css!taoQtiItem/lib/mathquill/mathquill",[],function(){}),define("taoQtiItem/qtiCreator/editor/mathInput/mathInput",["lodash","i18n","jquery","ui/component","taoQtiItem/lib/mathquill/mathquill","tpl!taoQtiItem/qtiCreator/editor/mathInput/tpl/mathInput","css!taoQtiItem/lib/mathquill/mathquill"],function(_,__,$,componentFactory,MathQuill,layoutTpl){'use strict';function createToolbar($container,mathField){$container.empty(),_.forOwn(allToolGroups,function(toolGroup){$container.append(createToolGroup(toolGroup.tools,toolGroup.id))}),$container.off("mousedown.mathInputWysiwyg").on("mousedown.mathInputWysiwyg",function(e){var $target=$(e.target),fn=$target.data("fn"),latex=$target.data("latex");e.stopPropagation(),e.preventDefault();"cmd"===fn?mathField.cmd(latex):"write"===fn?mathField.write(latex):void 0;mathField.focus()})}function createToolGroup(toolGroup,toolGroupId){var $toolGroup=$("<div>",{class:"math-input-toolgroup","data-identifier":toolGroupId});return toolGroup.forEach(function(toolId){var toolConfig=allTools[toolId];toolConfig.id=toolId,$toolGroup.append(createTool(toolConfig))}),$toolGroup}function createTool(config){return $("<button>",{class:"small btn-info math-input-tool","data-identifier":config.id,"data-latex":config.latex,"data-fn":config.fn,title:config.desc,html:config.label})}var allTools={frac:{label:"x/y",latex:"\\frac",fn:"cmd",desc:__("Fraction")},sqrt:{label:"&radic;",latex:"\\sqrt",fn:"cmd",desc:__("Square root")},exp:{label:"x&#8319;",latex:"^",fn:"cmd",desc:__("Exponent")},log:{label:"log",latex:"\\log",fn:"cmd",desc:__("Log")},ln:{label:"ln",latex:"\\ln",fn:"cmd",desc:__("Ln")},e:{label:"&#8494;",latex:"\\mathrm{e}",fn:"write",desc:__("Euler's constant")},infinity:{label:"&#8734;",latex:"\\infty",fn:"cmd",desc:__("Infinity")},lbrack:{label:"[",latex:"\\lbrack",fn:"cmd",desc:__("Left bracket")},rbrack:{label:"]",latex:"\\rbrack",fn:"cmd",desc:__("Right bracket")},pi:{label:"&pi;",latex:"\\pi",fn:"cmd",desc:__("Pi")},cos:{label:"cos",latex:"\\cos",fn:"cmd",desc:__("Cosinus")},sin:{label:"sin",latex:"\\sin",fn:"cmd",desc:__("Sinus")},lte:{label:"&le;",latex:"\\le",fn:"cmd",desc:__("Lower than or equal")},gte:{label:"&ge;",latex:"\\ge",fn:"cmd",desc:__("Greater than or equal")},times:{label:"&times;",latex:"\\times",fn:"cmd",desc:__("Multiply")},divide:{label:"&divide;",latex:"\\div",fn:"cmd",desc:__("Divide")},plusminus:{label:"&#177;",latex:"\\pm",fn:"cmd",desc:__("Plus/minus")}},allToolGroups=[{id:"functions",tools:["sqrt","frac","exp","log","ln"]},{id:"symbols",tools:["e","infinity","lbrack","rbrack"]},{id:"trigo",tools:["pi","sin","cos"]},{id:"comparison",tools:["lte","gte"]},{id:"operands",tools:["times","divide","plusminus"]}];return function(){return componentFactory({setLatex:function(latexString){this.mathField&&this.mathField.latex(latexString)},getLatex:function(){if(this.mathField)return this.mathField.latex()},_initMathQuill:function($element){var self=this,MQ=MathQuill.getInterface(2);this.mathField=MQ.MathField($element.get(0),{spaceBehavesLikeTab:!0,handlers:{edit:function(){self.trigger("change",self.mathField.latex())}}})}}).setTemplate(layoutTpl).on("render",function(){var $component=this.getElement(),$toolbar=$component.find(".math-input-toolbar"),$inputField=$component.find(".math-input-mathquill");this._initMathQuill($inputField),createToolbar($toolbar,this.mathField),$inputField.on("mousedown.mathInputWysiwyg",function(e){e.stopPropagation()})}).on("destroy",function(){var $component=this.getElement(),$toolbar=$component.find(".math-input-toolbar"),$inputField=$component.find(".math-input-mathquill");$toolbar.off(".mathInputWysiwyg"),$inputField.off(".mathInputWysiwyg"),this.mathField&&(this.mathField.revert().html(),this.mathField=null)})}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/choiceSelector",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <option value=\"",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    ",buffer}function program4(){return"selected=\"selected\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"choices-selector\">\n    <select ",stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"multiple=\"multiple\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enter choices\u2026",options):helperMissing.call(depth0,"__","Enter choices\u2026",options)))+"\" data-has-search=\"false\">\n    ",stack1=helpers.each.call(depth0,depth0&&depth0.options,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n\n    </select>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/editor/response/choiceSelector",["jquery","lodash","i18n","ui/component","tpl!taoQtiItem/qtiCreator/tpl/toolbars/choiceSelector","select2"],function($,_,__,component,choiceSelectorTpl){'use strict';function formatOption(state){var title=$(state.element).attr("title");return title?"<span title=\""+title+"\">"+state.text+"</span>":state.text}function createOptionTitle(content,threshold){var fullText=$("<div>",{html:content}).text().trim().replace(/\s+/g," "),shortText=fullText.substr(0,threshold);return 5>=fullText.length-shortText.length?fullText:shortText+"\u2026"}var _defaults={titleLength:0},init=function(){var selected=_.map(this.config.choices||[],function(c){return c.id()}),choices=this.config.interaction.getChoices(),response=this.config.interaction.getResponseDeclaration(),config=_.defaults(this.config||{},_defaults);config.multiple=response.isCardinality(["multiple","ordered"]),config.options=[],_.each(choices,function(choice){var id=choice.id(),choiceText="",option={value:id,label:id,selected:-1<selected.indexOf(id)};if(choice.is("containerChoice"))choiceText=choice.body();else if(choice.is("textVariableChoice"))choiceText=choice.val();else return;config.titleLength&&(option.title=createOptionTitle(choiceText,config.titleLength)),config.options.push(option)})},destroy=function(){this.$component.find("select").select2("destroy")},render=function(){var self=this,$selectBox=this.$component.find("select");$selectBox.select2({dropdownAutoWidth:!0,placeholder:$selectBox.attr("placeholder"),minimumResultsForSearch:-1,formatResult:formatOption,formatSelection:formatOption}).on("change",function(){var selection=$selectBox.select2("val");self.setSelectedChoices(_.isArray(selection)?selection:[selection]),self.trigger("change",self.getSelectedChoices())})};return function(config){var _selectedChoices={},choices={};_.each(config.interaction.getChoices(),function(choice){choices[choice.id()]=choice});return component({getSelectedChoices:function getSelectedChoices(){return _selectedChoices},setSelectedChoices:function setSelectedChoices(choicesId){_selectedChoices=_.map(choicesId,function(id){return choices[id]})}}).on("init",init).on("destroy",destroy).on("render",render).setTemplate(choiceSelectorTpl).init(config)}}),define("taoQtiItem/qtiCreator/editor/simpleContentEditableElement",["jquery","lodash"],function($,_){"use strict";return{create:function($container,selector,callback){function _init($elt){$elt.attr("contenteditable",!0).addClass("simple-editable")}_init($container.find(selector)),$container.on("mouseenter.simpleeditable",selector,_.throttle(function(){var $elt=$(this);$elt.attr("contenteditable")||_init($elt)},200)).on("keyup.simpleeditable",selector,_.throttle(function(){callback($(this).text())},200)).on("keydown.simpleeditable",selector,function(e){13===e.which&&(e.preventDefault(),$(this).blur())})},destroy:function($container){$container.find(".simple-editable").removeClass("simple-editable").removeAttr("contenteditable"),$container.off(".simpleeditable")}}}),define("taoQtiItem/qtiCreator/helper/devTools",["lodash","jquery","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/model/helper/event"],function(_,$,xmlRenderer,event){"use strict";var _formatXml=function(xml){return vkbeautify.xml(xml,"\t")},_printXml=function(rawXml,$destination){var $code=$(),xml=_formatXml(rawXml);xml=xml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),$destination.hasClass("language-markup")?$code=$destination:($code=$destination.find("code.language-markup"),!$code.length&&($code=$("<code>",{class:"language-markup"}),$destination.addClass("line-numbers").html($code))),$code.length&&($code.html(xml),Prism.highlightElement($code[0]))};return{listenStateChange:function(){$(document).on("afterStateInit.qti-widget",function(e,element,state){console.log("->state : "+state.name+" : "+element.serial)}).on("afterStateExit.qti-widget",function(e,element,state){console.log("<-state : "+state.name+" : "+element.serial)})},getStates:function(item){var states={},elements=item.getComposingElements();return _.each(elements,function(element){var widget=element.data("widget");widget&&(states[element.getSerial()]=widget.getCurrentState().name)}),states},liveXmlPreview:function(item,$destination){$(document).on(event.getList().join(" "),_.throttle(function(){var rawXml=xmlRenderer.render(item);_printXml(rawXml,$destination)},200))}}}),define("taoQtiItem/qtiCreator/helper/dummyElement",["jquery","lodash"],function($,_){'use strict';var dummyElement=function(){var types={maths:{icon:"maths",css:{width:40,height:24}},image:{icon:"image",css:{width:50,height:35}},video:{icon:"video",css:{width:200,height:150}},media:{icon:"media",css:{width:150,height:100}},include:{icon:"shared-file",css:{width:"100%",height:100}},printedVariable:{icon:"variable",css:{width:40,height:16}},_tooltip:{icon:"tooltip",css:{width:40,height:24}}};return{get:function get(arg){var options={element:"span",class:"dummy-element",css:{width:80,height:22}},element,$element,$icon,css,finalOptions;return arg&&($.isPlainObject(arg)?(arg.class&&(options.class+=" "+arg.class,delete arg.class),options=$.extend(!0,{},options,arg)):types[arg]&&(options=$.extend({},options,types[arg]))),$icon=!!options.icon&&$("<span>",{class:"icon-"+options.icon.replace("icon-","")}),element="<"+options.element+">",css=_.cloneDeep(options.css),css["font-size"]=css.height&&!css["font-size"]?.8*css.height:14,css["line-height"]=(css["font-size"]+2).toString()+"px",30<css.height&&(css["padding-top"]=.9*((css.height-css["font-size"])/2)),css.height&&100<css.height&&(css["background-size"]="auto"),finalOptions=_.cloneDeep(options),delete finalOptions.icon,delete finalOptions.element,delete finalOptions.css,$element=$(element,finalOptions).css(css),$icon&&$element.append($icon),$element}}}();return dummyElement}),define("ui/transformer",["jquery","lodash","lib/unmatrix/unmatrix"],function($,_,_unmatrix){'use strict';function _normalizeTransforms(transforms){for(var xy=["translate","scale"],i=xy.length;i--;)transforms[xy[i]]&&(_.isArray(transforms[xy[i]])&&2===transforms[xy[i]].length?(transforms[xy[i]+"X"]=transforms[xy[i]][0],transforms[xy[i]+"Y"]=transforms[xy[i]][1]):(transforms[xy[i]+"X"]=transforms[xy[i]],transforms[xy[i]+"Y"]=transforms[xy[i]]),delete transforms[xy[i]]);return transforms}function _transform($elem,transforms){var cssObj={},defaults=_unmatrix("none"),classNames=[],oriTrans;transforms=_normalizeTransforms(transforms),$elem.data("oriTrans")||(oriTrans=_getTransformation($elem[0]),oriTrans.origin=_getTransformOrigin($elem[0]),$elem.data("oriTrans",oriTrans)),cssObj[prefix+"transform"]="",_.forIn(transforms,function(value,key){return!!_.isNaN(value)||void(value=parseFloat(value),$elem.data("oriTrans").obj[key]!==defaults[key]&&(-1<key.indexOf("scale")?value*=$elem.data("oriTrans").obj[key]:value+=$elem.data("oriTrans").obj[key]),void 0!==defaults[key]&&value!==defaults[key]&&(-1<key.indexOf("translate")?value+="px":("rotate"===key||-1<key.indexOf("skew"))&&(value+="deg"),cssObj[prefix+"transform"]+=key+"("+value+") ",classNames.push("transform-"+key.replace(/(X|Y)$/i,""))))}),cssObj[prefix+"transform"]=$.trim(cssObj[prefix+"transform"]),$elem.css(cssObj),$elem.removeClass("transform-translate transform-rotate transform-skew transform-scale"),$elem.addClass(_.unique(classNames).join(" ")),$elem.trigger("transform.transformer",transforms)}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,_unmatrix=_unmatrix&&_unmatrix.hasOwnProperty("default")?_unmatrix["default"]:_unmatrix;var vendorPrefixes=["webkit","ms"],prefix=function(){var i=vendorPrefixes.length,style=window.getComputedStyle(document.body,null);if(style.getPropertyValue("transform"))return"";for(;i--;)if(style[vendorPrefixes[i]+"Transform"]!==void 0)return"-"+vendorPrefixes[i]+"-"}(),_getTransformation=function(elem){var _style=window.getComputedStyle(elem,null),matrix=_style.getPropertyValue("transform")||_style.getPropertyValue("-webkit-transform")||_style.getPropertyValue("-ms-transform")||"none",obj=_unmatrix(matrix);return{matrix:matrix,obj:obj}},_getTransformOrigin=function(elem){var _style=window.getComputedStyle(elem,null);return _style.getPropertyValue("transform-origin")||_style.getPropertyValue("-webkit-transform-origin")||_style.getPropertyValue("-ms-transform-origin")||"50% 50% 0"};return{translate:function($elem,valueX,valueY){valueY=valueY||valueX,_transform($elem,{translateX:valueX,translateY:valueY})},translateXY:function($elem,valueX,valueY){_transform($elem,{translateX:valueX,translateY:valueY})},translateX:function($elem,value){_transform($elem,{translateX:value})},translateY:function($elem,value){_transform($elem,{translateY:value})},rotate:function($elem,value){_transform($elem,{rotate:value})},skew:function($elem,value){_transform($elem,{skew:value})},scale:function($elem,valueX,valueY){valueY=valueY||valueX,_transform($elem,{scaleX:valueX,scaleY:valueY})},scaleX:function($elem,value){_transform($elem,{scaleX:value})},scaleY:function($elem,value){_transform($elem,{scaleY:value})},reset:function($elem){var cssObj={};$elem.data("oriTrans")&&(cssObj[prefix+"transform"]=$elem.data("oriTrans").matrix,cssObj[prefix+"transform-origin"]=$elem.data("oriTrans").origin,$elem.css(cssObj),$elem.removeClass("transform-translate transform-rotate transform-skew transform-scale"),$elem.trigger("reset.transformer",$elem.data("oriTrans")))},getTransformation:function(elem){return elem instanceof $&&(elem=elem[0]),_getTransformation(elem)},setTransformOrigin:function($elem,valueX,valueY){var cssObj={};cssObj[prefix+"transform-origin"]=valueY||0===valueY?valueX+" "+valueY:valueX,$elem.css(cssObj)}}}),define("ui/component/placeable",["lodash","ui/transformer"],function(_,transformer){'use strict';function makePlaceable(component,config){return _.assign(component,placeableComponent),component.off(".makePlaceable").on("init.makePlaceable",function(){_.defaults(this.config,config||{},defaultConfig)}).on("render.makePlaceable",function(){var $element=this.getElement();$element.css({position:"absolute"}),this.resetPosition()})}_=_&&_.hasOwnProperty("default")?_["default"]:_,transformer=transformer&&transformer.hasOwnProperty("default")?transformer["default"]:transformer;var defaultConfig={initialX:0,initialY:0},placeableComponent={_translate:function(xOffsetAbsolute,yOffsetAbsolute){var $element=this.getElement();transformer.translateXY($element,xOffsetAbsolute,yOffsetAbsolute),this._translateX=xOffsetAbsolute,this._translateY=yOffsetAbsolute,this._x=xOffsetAbsolute+this.config.initialX,this._y=yOffsetAbsolute+this.config.initialY,this.trigger("move",this._x,this._y)},center:function(){var $container=this.getContainer(),$element=this.getElement(),centerX,centerY;return this.is("rendered")&&!this.is("disabled")&&$container.length&&(centerX=$container.width()/2-$element.width()/2,centerY=$container.height()/2-$element.height()/2,this.moveTo(centerX,centerY),this.trigger("center",centerX,centerY)),this},moveBy:function(xOffsetRelative,yOffsetRelative){var xOffsetAbsolute,yOffsetAbsolute;return this.is("rendered")&&!this.is("disabled")&&(xOffsetAbsolute=this._translateX+xOffsetRelative,yOffsetAbsolute=this._translateY+yOffsetRelative,this._translate(xOffsetAbsolute,yOffsetAbsolute)),this},moveTo:function(x,y){var xOffsetAbsolute,yOffsetAbsolute;return this.is("rendered")&&!this.is("disabled")&&(xOffsetAbsolute=x-this.config.initialX,yOffsetAbsolute=y-this.config.initialY,this._translate(xOffsetAbsolute,yOffsetAbsolute)),this},moveToX:function(x){return this.moveTo(x,this._y)},moveToY:function(y){return this.moveTo(this._x,y)},resetPosition:function(){var $element=this.getElement();return this.is("rendered")&&($element.css({left:this.config.initialX,top:this.config.initialY}),this._translate(0,0)),this},getPosition:function(){var position;return this.is("rendered")&&(position={x:this._x||0,y:this._y||0}),position}};return makePlaceable.isPlaceable=function(component){return Object.keys(placeableComponent).every(function(method){return"function"==typeof component[method]})},makePlaceable}),define("ui/component/draggable",["lodash","interact","ui/component/placeable"],function(_,interact,makePlaceable){'use strict';var _Mathround8=Math.round;function makeDraggable(component,config){return makePlaceable.isPlaceable(component)||makePlaceable(component),component.off(".makeDraggable").on("init.makeDraggable",function(){_.defaults(this.config,config||{})}).on("render.makeDraggable",function(){var self=this,$element=this.getElement(),element=$element[0],rootNode=document.querySelector("html");this.config.dragRestriction||(this.config.dragRestriction=this.getContainer()[0]),interact(element).draggable({autoScroll:!0,restrict:{restriction:this.config.dragRestriction,elementRect:{left:0,right:1,top:0,bottom:1}},onmove:function(event){var xOffset=_Mathround8(event.dx),yOffset=_Mathround8(event.dy);self.moveBy(xOffset,yOffset),self.trigger("dragmove",xOffset,yOffset)}}).on("dragstart",function(){self.setState("moving",!0),self.trigger("dragstart")}).on("dragend",function(){self.setState("moving",!1),self.trigger("dragend")}),$element.off(".makeDraggable").on("click.makeDraggable",function(){_.delay(function(){self.is("sizing")||self.is("moving")||!rootNode||(rootNode.style.cursor="default")},25)})})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable,makeDraggable}),define("ui/component/resizable",["lodash","interact","ui/component/placeable"],function(_,interact,makePlaceable){'use strict';var _Mathmin9=Math.min,_Mathmax12=Math.max;function makeResizable(component,config){return _.assign(component,resizableComponent),makePlaceable.isPlaceable(component)||makePlaceable(component),component.off(".makeResizable").on("init.makeResizable",function(){_.defaults(this.config,config||{},defaultConfig)}).on("render.makeResizable",function(){var self=this,$element=this.getElement(),element=$element[0];this.config.resizeRestriction||(this.config.resizeRestriction=this.getContainer()[0]),interact(element).resizable({autoScroll:!0,restrict:{restriction:this.config.resizeRestriction},edges:this.config.edges}).on("resizemove",function(event){self.resizeTo(event.rect.width,event.rect.height,event.edges.left,event.edges.top)}).on("resizestart",function(){self.setState("sizing",!0),self.trigger("resizestart")}).on("resizeend",function(){self.setState("sizing",!1),self.trigger("resizeend")})})}_=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable;var defaultConfig={minWidth:50,minHeight:50,edges:{left:!0,right:!0,bottom:!0,top:!0}},resizableComponent={_getCappedValue:function(value,min,max){var capped=value;return _.isUndefined(max)||_.isNull(max)||(capped=_Mathmin9(capped,max)),_.isUndefined(min)||_.isNull(min)||(capped=_Mathmax12(capped,min)),capped},resizeTo:function(newWidth,newHeight,resizeFromLeft,resizeFromTop){var shouldMove=!1,currentSize,newX,newY,rightX,bottomY,position;return this.is("rendered")&&!this.is("disabled")&&(this.trigger("beforeresize",newWidth,newHeight,resizeFromLeft,resizeFromTop),currentSize=this.getSize(),newWidth=this._getCappedValue(newWidth,this.config.minWidth,this.config.maxWidth),newHeight=this._getCappedValue(newHeight,this.config.minHeight,this.config.maxHeight),position=this.getPosition(),resizeFromLeft&&newWidth!==currentSize.width&&(rightX=position.x+currentSize.width,newX=rightX-newWidth,shouldMove=!0),resizeFromTop&&newHeight!==currentSize.height&&(bottomY=position.y+currentSize.height,newY=bottomY-newHeight,shouldMove=!0),shouldMove&&this.moveTo(newX||position.x,newY||position.y),this.setSize(newWidth,newHeight),position=this.getPosition(),this.trigger("resize",newWidth,newHeight,resizeFromLeft,resizeFromTop,position.x,position.y)),this}};return makeResizable}),define("ui/stacker",["jquery"],function($){'use strict';function isElementValid($element){return $element instanceof $&&$element.length}function initScope(scope){indexes[scope]||(indexes[scope]=1000)}function isHighest($element,scope){var elementIndex=parseInt($element.css("z-index"),10);return elementIndex>=indexes[scope]}function getNext(scope){return indexes[scope]+=10,indexes[scope]}$=$&&$.hasOwnProperty("default")?$["default"]:$;var indexes={};return function(scope){return scope=scope||"global",initScope(scope),{bringToFront:function($element){isElementValid($element)&&!isHighest($element,scope)&&($element.get(0).style.zIndex=getNext(scope))},autoBringToFront:function($element){var self=this;isElementValid($element)&&($element.off("mousedown.stacker"),$element.on("mousedown.stacker",function(){self.bringToFront($element)}))},reset:function($element){isElementValid($element)&&($element.get(0).style.zIndex="auto")},getCurrent:function(){return indexes[scope]}}}}),define("ui/component/stackable",["lodash","ui/stacker"],function(_,stackerFactory){'use strict';function makeStackable(component,config){return _.assign(component,stackableComponent),component.off(".makeStackable").on("init.makeStackable",function(){_.defaults(this.config,config||{},defaultConfig),this._stacker=stackerFactory(this.config.stackingScope)}).on("show.makeStackable",function(){this.bringToFront()}).on("render.makeStackable",function(){var $element=this.getElement();this._stacker.reset($element),this._stacker.autoBringToFront($element),this.bringToFront()})}_=_&&_.hasOwnProperty("default")?_["default"]:_,stackerFactory=stackerFactory&&stackerFactory.hasOwnProperty("default")?stackerFactory["default"]:stackerFactory;var defaultConfig={stackingScope:""},stackableComponent={bringToFront:function(){var $element=this.getElement();this._stacker.bringToFront($element)}};return makeStackable}),define("css!ui/component/css/windowComponent",[],function(){}),define("ui/component/windowed",["lodash","i18n","jquery","ui/component/placeable","handlebars","lib/dompurify/purify","css!ui/component/css/windowComponent.css"],function(_,__,$$1,makePlaceable,Handlebars,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function windowTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function makeWindowed(component,config){return _.assign(component,windowedComponentAPI),makePlaceable.isPlaceable(component)||makePlaceable(component),component.setTemplate(windowTpl).off(".windowed").on("init.windowed",function(){_.defaults(this.config,config||{},defaultConfig),this.addPresets()}).on("render.windowed",function(){this._renderControls()}).on("destroy.windowed",function(){var $controlsArea=this.getControls();$controlsArea.off(".windowed")})}_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"window-component\">\n    <div class=\"window-component-title-bar\">\n        <div class=\"window-component-title\">",(helper=helpers.windowTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.windowTitle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\n        <div class=\"window-component-controls\"> </div>\n    </div>\n    <div class=\"window-component-body\"></div>\n</div>\n",buffer}),eventNs=".windowed",cssNs=".window-component",defaultConfig={hasCloser:!0,hasBin:!1},controlsPresets={bin:{id:"bin",order:100,icon:"bin",description:__("Delete"),event:"delete"},closer:{id:"closer",order:200,icon:"result-nok",description:__("Close"),event:"close",onclick:function(){this.hide()}}},windowedComponentAPI={getControls:function(){var $component=this.getElement();return $component.find(cssNs+"-controls")},getTitle:function(){var $component=this.getElement();return $component.find(cssNs+"-title")},getBody:function(){var $component=this.getElement();return $component.find(cssNs+"-body")},addControl:function(controlOptions){if(!_.isString(controlOptions.id)||_.isEmpty(controlOptions.id))throw new Error("control must have an id");if(!_.isString(controlOptions.icon)||_.isEmpty(controlOptions.icon))throw new Error("control must have an icon");if(!_.isFunction(controlOptions.onclick)&&!(_.isString(controlOptions.event)&&""!==controlOptions.event.trim()))throw new Error("control must have valid onclick or event parameter");return _.isArray(this._windowControls)||(this._windowControls=[]),this._windowControls.push(controlOptions),this},addPresets:function(){return this.config.hasCloser&&this.addControl(controlsPresets.closer),this.config.hasBin&&this.addControl(controlsPresets.bin),this},_renderControls:function(){var self=this,$controlsArea=this.getControls(),controlsCallbacks={},controlsEvents={};return _.isArray(this._windowControls)&&($controlsArea.empty(),this._windowControls.sort(function(a,b){return(a.order||0)-(b.order||0)}),this._windowControls.forEach(function(control){var $control=$$1("<button>",{class:"icon-"+control.icon,"data-control":control.id,title:control.description});$controlsArea.append($control),controlsCallbacks[control.id]=control.onclick,controlsEvents[control.id]=control.event}),$controlsArea.off("click"+eventNs).on("click"+eventNs,function(e){var controlId=$$1(e.target).data("control");e.stopPropagation(),_.isFunction(controlsCallbacks[controlId])&&controlsCallbacks[controlId].call(self),_.isString(controlsEvents[controlId])&&self.trigger(controlsEvents[controlId])})),this}};return makeWindowed}),define("taoQtiItem/qtiCreator/helper/windowPopup",["lodash","jquery","ui/component","ui/component/draggable","ui/component/resizable","ui/component/stackable","ui/component/windowed"],function(_,$,componentFactory,makeDraggable,makeResizable,makeStackable,makeWindowed){'use strict';var defaultConfig={draggable:!0,resizable:!0};return function(specs,config){var windowPopup;return config=_.defaults(config||{},defaultConfig),windowPopup=componentFactory(specs,config),config.draggable&&makeDraggable(windowPopup),config.resizable&&makeResizable(windowPopup),makeStackable(windowPopup,{stackingScope:"qti-creator"}),makeWindowed(windowPopup),windowPopup.on("render",function(){var $component=this.getElement();$component.addClass("window-popup")}),windowPopup}}),define("taoQtiItem/qtiItem/core/choices/Choice",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){var Choice=IdentifiedElement.extend({init:function init(serial,attributes){this._super(serial,attributes)},is:function is(qtiClass){return"choice"===qtiClass||this._super(qtiClass)},getInteraction:function getInteraction(){var ret=null,item=this.getRootElement(),found;return item&&(found=item.find(this.serial),found&&(ret=found.parent)),ret}});return Choice}),define("taoQtiItem/qtiItem/core/choices/Hotspot",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){var QtiHotspot=QtiChoice.extend({});return QtiHotspot}),define("taoQtiItem/qtiItem/core/choices/AssociableHotspot",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){var QtiAssociableHotspot=QtiHotspot.extend({qtiClass:"associableHotspot"});return QtiAssociableHotspot}),define("taoQtiItem/qtiCreator/model/choices/AssociableHotspot",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/AssociableHotspot"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{matchMax:0,matchMin:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/Gap",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){var QtiGap=QtiChoice.extend({qtiClass:"gap"});return QtiGap}),define("taoQtiItem/qtiCreator/model/choices/Gap",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/Gap"],function(_,editable,Gap){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{required:!1}}}),Gap.extend(methods)}),define("taoQtiItem/qtiItem/core/Object",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig){var QtiObject=Element.extend({qtiClass:"object",getMediaType:function getMediaType(){var type="undefined",mimetype=this.attr("type");return mimetype&&(0===mimetype.indexOf("video")?type="video":0===mimetype.indexOf("audio")?type="audio":0===mimetype.indexOf("image")?type="image":0===mimetype.indexOf("text/html")?type="html":type="object"),type},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};switch(this.getMediaType()){case"video":defaultData.video=!0;break;case"audio":defaultData.audio=!0;break;case"html":defaultData.html=!0;break;case"image":default:defaultData.object=!0;}return defaultData.attributes={data:renderer.resolveUrl(this.attr("data"))},defaultData.body=this._alt,this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function isEmpty(){return!this.attr("data")}});return QtiObject}),define("taoQtiItem/qtiItem/core/choices/GapImg",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/core/Object"],function(QtiChoice,QtiObject){var QtiGapImg=QtiChoice.extend({qtiClass:"gapImg",initObject:function initObject(object){this.object=object||new QtiObject},getObject:function getObject(){return this.object}});return QtiGapImg}),define("taoQtiItem/qtiCreator/model/choices/GapImg",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/GapImg"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{matchMin:0,matchMax:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/ContainerChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/Container"],function(Choice,Container){var ContainerChoice=Choice.extend({init:function init(serial,attributes){this._super(serial,attributes)},is:function is(qtiClass){return"containerChoice"===qtiClass||this._super(qtiClass)}});return Container.augment(ContainerChoice),ContainerChoice}),define("taoQtiItem/qtiItem/core/choices/GapText",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){'use strict';var QtiGapText=QtiContainerChoice.extend({qtiClass:"gapText"});return QtiGapText}),define("taoQtiItem/qtiCreator/model/choices/GapText",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/GapText"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{fixed:!1,matchMax:1,matchMin:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/HotspotChoice",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){var QtiHotspotChoice=QtiHotspot.extend({qtiClass:"hotspotChoice"});return QtiHotspotChoice}),define("taoQtiItem/qtiCreator/model/choices/HotspotChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/HotspotChoice"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/mixin/ContainerInline",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function initContainer(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="inlineStatic"}}),{augment:function augment(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/choices/Hottext",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Choice,Container){var Hottext=Choice.extend({qtiClass:"hottext"});return Container.augment(Hottext),Hottext}),define("taoQtiItem/qtiCreator/model/choices/Hottext",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/Hottext"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{fixed:!1}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/TextVariableChoice",["jquery","lodash","taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,QtiChoice,rendererConfig){var QtiTextVariableChoice=QtiChoice.extend({init:function init(serial,attributes,text){this._super(serial,attributes),this.val(text||"")},is:function is(qtiClass){return"textVariableChoice"===qtiClass||this._super(qtiClass)},val:function val(text){if("undefined"==typeof text)return this.text;if("string"==typeof text)this.text=text,$(document).trigger("choiceTextChange",{choice:this,text:text});else throw"text must be a string";return this},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={body:this.text};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return QtiTextVariableChoice}),define("taoQtiItem/qtiItem/core/choices/InlineChoice",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){var QtiInlineChoice=QtiTextVariableChoice.extend({qtiClass:"inlineChoice"});return QtiInlineChoice}),define("taoQtiItem/qtiCreator/model/choices/InlineChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/InlineChoice"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{fixed:!1,showHide:"show"}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){var QtiSimpleAssociableChoice=QtiContainerChoice.extend({qtiClass:"simpleAssociableChoice"});return QtiSimpleAssociableChoice}),define("taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{fixed:!1,showHide:"show",matchMax:0,matchMin:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/SimpleChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){var QtiSimpleChoice=QtiContainerChoice.extend({qtiClass:"simpleChoice"});return QtiSimpleChoice}),define("taoQtiItem/qtiCreator/model/choices/SimpleChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/SimpleChoice"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{fixed:!1,showHide:"show"}}}),Choice.extend(methods)}),define("taoQtiItem/qtiCreator/model/helper/portableElement",["lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(_,$,util){'use strict';return{getDefaultMethods:function(registry){return{getDefaultAttributes:function getDefaultAttributes(){return{}},getDefaultProperties:function getDefaultProperties(){var creator=registry.getCreator(this.typeIdentifier);return creator&&creator.module&&_.isFunction(creator.module.getDefaultProperties)?creator.getDefaultProperties(this):{}},afterCreate:function afterCreate(){var typeId=this.typeIdentifier,self=this,afterCreatePromise=registry.loadCreators({include:[typeId]}).then(function(){var creator=registry.getCreator(typeId),creatorModule=creator.module,response;creatorModule.getMarkupTemplate(),self.properties=creatorModule.getDefaultProperties(),creator.response&&_.size(creator.response)?(response=self.createResponse({cardinality:creator.response.cardinality}),creator.response.baseType&&response.attr("baseType",creator.response.baseType)):(self.attr("title",creator.label),!self.attr("id")&&self.attr("id",util.buildId(self.getRootElement(),typeId))),self.markup=self.renderMarkup(),self.setNamespace(creator.model,creator.xmlns),_.isFunction(creatorModule.afterCreate)&&creatorModule.afterCreate(self)});return afterCreatePromise},renderMarkup:function renderMarkup(){var creatorModule=registry.getCreator(this.typeIdentifier).module,markupTpl=creatorModule.getMarkupTemplate(),markupData=this.getDefaultMarkupTemplateData();return _.isFunction(creatorModule.getMarkupData)&&(markupData=creatorModule.getMarkupData(this,markupData)),markupTpl(markupData)},updateMarkup:function updateMarkup(){this.markup=this.renderMarkup()}}}}}),define("taoQtiItem/qtiCreator/model/helper/response",["lodash"],function(_){"use strict";return{removeChoice:function removeChoice(response,choice){var escapedIdentifier=choice.id().replace(/([.-])/g,"\\$1"),regex=new RegExp("([^a-z_-d.]*)("+escapedIdentifier+")([^a-z_-d.]*)");_.remove(response.correctResponse,function(entry){return entry.match(regex)});var mapEntries={};_.forIn(response.mapEntries,function(value,mapKey){mapKey.match(regex)||(mapEntries[mapKey]=value)}),response.mapEntries=mapEntries}}}),define("taoQtiItem/qtiItem/core/Img",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){var Img=Element.extend({qtiClass:"img",render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={src:renderer.resolveUrl(this.attr("src"))},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function isEmpty(){return!this.attr("src")}});return Img}),define("taoQtiItem/qtiCreator/model/Img",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Img"],function(_,editable,Img){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{src:"",alt:""}},afterCreate:function afterCreate(){this.data("responsive",!0)}}),Img.extend(methods)}),define("taoQtiItem/qtiItem/mixin/NamespacedElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){'use strict';var methods={getNamespace:function getNamespace(){var relatedItem,namespaces,ns;if(this.ns&&(this.ns.name||this.ns.uri))return _.clone(this.ns);if(relatedItem=this.getRootElement(),relatedItem){for(ns in namespaces=relatedItem.getNamespaces(),namespaces)if(0<namespaces[ns].indexOf(this.nsUriFragment))return{name:ns,uri:namespaces[ns]};return relatedItem.namespaces[this.defaultNsName]=this.defaultNsUri,{name:this.defaultNsName,uri:this.defaultNsUri}}return{}},setNamespace:function setNamespace(name,uri){this.ns={name:name,uri:uri}}};return{augment:function augment(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Include",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/mixin/NamespacedElement"],function(Element,Container,NamespacedElement){var Include=Element.extend({qtiClass:"include",defaultNsName:"xi",defaultNsUri:"http://www.w3.org/2001/XInclude",nsUriFragment:"XInclude",isEmpty:function isEmpty(){return!this.attr("href")||this.getBody().isEmpty()}});return Container.augment(Include),NamespacedElement.augment(Include),Include}),define("taoQtiItem/qtiCreator/model/Include",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Include"],function(_,editable,Include){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{}},afterCreate:function afterCreate(){this.getNamespace()}}),Include.extend(methods)}),define("taoQtiItem/qtiItem/core/variables/ResponseDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration","lodash"],function(VariableDeclaration,_){'use strict';var ResponseDeclaration=VariableDeclaration.extend({qtiClass:"responseDeclaration",init:function init(serial,attributes){this._super(serial,attributes),this.template="",this.mappingAttributes={},this.mapEntries={},this.correctResponse=null,this.feedbackRules={}},getFeedbackRules:function getFeedbackRules(){return _.values(this.feedbackRules)},getComposingElements:function getComposingElements(){var elts=this._super();return elts=_.extend(elts,this.feedbackRules),elts},toArray:function toArray(){var arr=this._super();return arr.howMatch=this.template,arr.correctResponses=this.correctResponse,arr.mapping=this.mapEntries,arr.mappingAttributes=this.mappingAttributes,arr.feedbackRules=_.map(this.feedbackRules,function(rule){return rule.toArray()}),arr},getInteraction:function getInteraction(){var interaction=null,responseId=this.id(),item=this.getRootElement(),interactions=item.getInteractions();return _.each(interactions,function(i){if(i.attributes.responseIdentifier===responseId)return interaction=i,!1}),interaction},isCardinality:function isCardinality(cardinalities){var comparison;if(_.isArray(cardinalities))comparison=cardinalities;else if(_.isString(cardinalities))cardinalities=[cardinalities];else return!1;return 0<=_.indexOf(comparison,this.attr("cardinality"))}});return ResponseDeclaration}),define("taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){'use strict';var SimpleFeedbackRule=Element.extend({qtiClass:"_simpleFeedbackRule",serial:"",rootElement:null,init:function init(serial,feedbackOutcome,feedbackThen,feedbackElse){this._super(serial,{}),this.condition="correct",this.comparedOutcome=null,this.comparedValue=0,this.feedbackOutcome=feedbackOutcome,this.feedbackThen=Element.isA(feedbackThen,"feedback")?feedbackThen:null,this.feedbackElse=Element.isA(feedbackElse,"feedback")?feedbackThen:null},setCondition:function setCondition(comparedOutcome,condition,comparedValue){var _comparedValues=[];if(Element.isA(comparedOutcome,"variableDeclaration"))switch(condition){case"correct":case"incorrect":if(Element.isA(comparedOutcome,"responseDeclaration"))this.comparedOutcome=comparedOutcome,this.condition=condition;else throw"invalid outcome type: must be a responseDeclaration";break;case"lt":case"lte":case"equal":case"gte":case"gt":if(null!==comparedValue&&void 0!==comparedValue)this.comparedOutcome=comparedOutcome,this.condition=condition,this.comparedValue=comparedValue;else throw"compared value must not be null";break;case"choices":if(Element.isA(comparedOutcome,"responseDeclaration")&&null!==comparedValue&&_.isArray(comparedValue)){var choices=_.values(comparedOutcome.getInteraction().getChoices());this.comparedOutcome=comparedOutcome,this.condition=condition,_.each(comparedValue,function(v){v instanceof Element?_comparedValues.push(v):_.isString(v)&&_.each(choices,function(c){if(c.attr("identifier")===v)return _comparedValues.push(c),!1})}),this.comparedValue=_comparedValues}else throw"compared value must not be null";break;default:throw"unknown condition type : ".condition;}else throw"invalid outcome type: must be a variableDeclaration";return this},setFeedbackElse:function setFeedbackElse(feedback){Element.isA(feedback,"feedback")&&(this.feedbackElse=feedback)},toArray:function toArray(){var val=this.comparedValue,_toString=function(){return val instanceof Element?val.attr("identifier"):val+""};return val=_.isArray(val)?_.map(val,_toString):_toString(val),{condition:this.condition,comparedOutcome:this.comparedOutcome.id(),comparedValue:val}}});return SimpleFeedbackRule}),define("taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",["jquery","lodash","ui/hider","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/variables/ResponseDeclaration","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/response/SimpleFeedbackRule","taoQtiItem/qtiItem/helper/response"],function($,_,hider,Element,ResponseDeclaration,editable,SimpleFeedbackRule,responseHelper){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{setTemplate:function setTemplate(template){var templateUri=responseHelper.getTemplateUriFromName(template);return templateUri&&this.template!==templateUri&&(this.template=templateUri,$(document).trigger("responseTemplateChange.qti-widget",{element:this,value:template})),this},getTemplate:function getTemplate(){return this.template},resetCorrect:function resetCorrect(){return this.correctResponse=null,$(document).trigger("correctResponseChange.qti-widget",{element:this,value:null}),this},setCorrect:function setCorrect(value){return _.isString(value)&&(value=[value]),this.correctResponse=value,$(document).trigger("correctResponseChange.qti-widget",{element:this,value:value}),this},getCorrect:function getCorrect(){return _.clone(this.correctResponse)},setMappingAttribute:function setMappingAttribute(name,value){this.mappingAttributes[name]=value,$(document).trigger("mappingAttributeChange.qti-widget",{element:this,key:name,value:value})},removeMappingAttribute:function removeMappingAttribute(name){delete this.mappingAttributes[name],$(document).trigger("mappingAttributeChange.qti-widget",{element:this,key:name,value:null})},getMappingAttribute:function getMappingAttribute(name){return this.mappingAttributes[name]},toggleMappingForm:function(){var mappingDisabled=_.isEmpty(this.mapEntries),$panel=this.renderer.getAreaBroker().getPropertyPanelArea();$(".response-mapping-attributes input",$panel).each(function(){$(this).attr("disabled",mappingDisabled)}),hider.toggle($(".response-mapping-attributes",$panel),!mappingDisabled),hider.toggle($(".response-mapping-info",$panel),mappingDisabled)},setMapEntry:function setMapEntry(mapKey,mappedValue,caseSensitive){if(mappedValue=parseFloat(mappedValue),caseSensitive=!!caseSensitive,!isNaN(mappedValue)){if("multiple"===this.attr("cardinality")&&"pair"===this.attr("baseType")){var mapKeys=mapKey.split(" "),mapKeysReverse=mapKeys[1]+" "+mapKeys[0];this.mapEntries[mapKeysReverse]?this.mapEntries[mapKeysReverse]=mappedValue:this.mapEntries[mapKey]=mappedValue}else this.mapEntries[mapKey]=mappedValue;this.toggleMappingForm(),$(document).trigger("mapEntryChange.qti-widget",{element:this,mapKey:mapKey,mappedValue:mappedValue,caseSensitive:caseSensitive})}else throw"the mapped value is not a number";return this},removeMapEntry:function removeMapEntry(mapKey,canBeEmpty){if("undefined"==typeof canBeEmpty&&(canBeEmpty=!1),mapKey||canBeEmpty){if("multiple"===this.attr("cardinality")&&"pair"===this.attr("baseType")){var mapKeys=mapKey.split(" "),mapKeysReverse=mapKeys[1]+" "+mapKeys[0];delete this.mapEntries[mapKeysReverse]}delete this.mapEntries[mapKey],this.toggleMappingForm(),$(document).trigger("mapEntryRemove.qti-widget",{element:this,mapKey:mapKey})}return this},getMapEntries:function getMapEntries(){return _.clone(this.mapEntries)},removeMapEntries:function removeMapEntries(){_(this.mapEntries).keys().forEach(this.removeMapEntry,this)},createFeedbackRule:function createFeedbackRule(){var item=this.getRootElement(),outcome=item.createOutcomeDeclaration({identifier:"FEEDBACK",cardinality:"single",baseType:"identifier"}),modalFeedback=item.createModalFeedback({identifier:"feedbackModal",outcomeIdentifier:outcome.id()},this),rule=new SimpleFeedbackRule("",outcome,modalFeedback);rule.setCondition(this,"correct"),this.feedbackRules[rule.getSerial()]=rule;var renderer=this.getRenderer();return renderer&&(rule.setRenderer(renderer),modalFeedback.setRenderer(renderer)),$(document).trigger("feedbackRuleCreated.qti-widget",{element:this,rule:rule}),rule},getFeedbackRule:function getFeedbackRule(serial){return this.feedbackRules[serial]},getFeedbackRules:function getFeedbackRules(){return _.clone(this.feedbackRules)},setCondition:function setCondition(rule,condition,value){rule.setCondition(this,condition,value),$(document).trigger("feedbackRuleConditionChange.qti-widget",{element:this,rule:rule,condition:condition,value:value})},deleteFeedbackRule:function deleteFeedbackRule(rule){var item=this.getRootElement(),ret;return item.remove("outcomes",rule.feedbackOutcome),item.remove("modalFeedbacks",rule.feedbackThen),item.remove("modalFeedbacks",rule.feedbackElse||""),ret=this.remove("feedbackRules",rule),$(document).trigger("feedbackRuleRemoved.qti-widget",{element:this,rule:rule}),ret},createFeedbackElse:function createFeedbackElse(rule){var modalFeedback;if(Element.isA(rule,"_simpleFeedbackRule")){modalFeedback=this.getRootElement().createModalFeedback({identifier:"feedbackModal",outcomeIdentifier:rule.feedbackOutcome.id()},this),rule.setFeedbackElse(modalFeedback);var renderer=this.getRenderer();renderer&&modalFeedback.setRenderer(renderer),$(document).trigger("feedbackRuleElseCreated.qti-widget",{element:this,rule:rule,modalFeedback:modalFeedback})}return modalFeedback},deleteFeedbackElse:function deleteFeedbackElse(rule){this.getRootElement().remove("modalFeedbacks",rule.feedbackElse),rule.feedbackElse=null,$(document).trigger("feedbackRuleElseRemoved.qti-widget",{element:this,rule:rule})},getDefaultAttributes:function getDefaultAttributes(){return{}}}),ResponseDeclaration.extend(methods)}),define("taoQtiItem/qtiCreator/model/mixin/editableInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/variables/ResponseDeclaration","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,ResponseDeclaration,event,responseHelper){'use strict';return{removeChoice:function(choice){var serial="",c;return"string"==typeof choice?serial=choice:Element.isA(choice,"choice")&&(serial=choice.getSerial()),this.choices[serial]&&(c=this.choices[serial],delete this.choices[serial],responseHelper.removeChoice(this.getResponseDeclaration(),c),event.choiceDeleted(c,this)),this},createResponse:function(attrs,template){var response=new ResponseDeclaration,item,renderer,outcomeScore;return attrs&&response.attr(attrs),item=this.getRootElement(),item.addResponseDeclaration(response),response.buildIdentifier("RESPONSE",!1),response.setTemplate(template||"MATCH_CORRECT"),this.attr("responseIdentifier",response.id()),outcomeScore=item.getOutcomeDeclaration("SCORE"),outcomeScore||(outcomeScore=item.createOutcomeDeclaration({cardinality:"single",baseType:"float"}),outcomeScore.buildIdentifier("SCORE",!1)),response.mappingAttributes.defaultValue=0,renderer=this.getRenderer(),renderer&&response.setRenderer(renderer),response},deleteResponse:function(){var response=this.getResponseDeclaration();return response&&this.getRootElement().deleteResponseDeclaration(response),this.removeAttr("responseIdentifier"),this},beforeRemove:function(){var serial=this.serial,interactions=this.getRootElement().getInteractions();this.deleteResponse(),2===_.size(interactions)&&_.forEach(interactions,function(interaction){var response=interaction.getResponseDeclaration();response&&interaction.serial!==serial&&"endAttemptInteraction"!==interaction.qtiClass&&(interaction.attr("responseIdentifier","RESPONSE"),response.id("RESPONSE"))})}}}),define("taoQtiItem/qtiItem/core/interactions/Interaction",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig,util){'use strict';var QtiInteraction=Element.extend({init:function init(serial,attributes){this._super(serial,attributes),this.choices={}},is:function is(qtiClass){return"interaction"===qtiClass||this._super(qtiClass)},addChoice:function addChoice(choice){return choice.setRootElement(this.getRootElement()||null),this.choices[choice.getSerial()]=choice,this},getChoices:function getChoices(){var choices={};for(var i in this.choices)choices[i]=this.choices[i];return choices},getChoice:function getChoice(serial){var ret=null;return this.choices[serial]&&(ret=this.choices[serial]),ret},getChoiceByIdentifier:function getChoiceByIdentifier(identifier){for(var i in this.choices)if(this.choices[i].id()===identifier)return this.choices[i];return null},getComposingElements:function getComposingElements(){var elts=this._super();for(var serial in this.choices)Element.isA(this.choices[serial],"choice")&&(elts[serial]=this.choices[serial],elts=_.extend(elts,this.choices[serial].getComposingElements()));return elts},find:function find(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,"choices",serial)),found},getResponseDeclaration:function getResponseDeclaration(){var response=null,responseId=this.attr("responseIdentifier");if(responseId){var item=this.getRootElement();if(item)response=item.getResponseDeclaration(responseId);else throw"cannot get response of an interaction out of its item context"}return response},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={_type:this.qtiClass.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()}),choices:[],choiceShuffle:!0};if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;var choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),interactionData={interaction:{serial:this.serial,attributes:this.attributes}},_this=this;_.each(choices,function(choice){if(Element.isA(choice,"choice"))try{var renderedChoice=choice.render(_.clone(interactionData,!0),null,choice.qtiClass+"."+_this.qtiClass,renderer);defaultData.choices.push(renderedChoice)}catch(e){}});var tplName=args.subclass?this.qtiClass+"."+args.subclass:this.qtiClass;return this._super(_.merge(defaultData,args.data),args.placeholder,tplName,renderer)},postRender:function postRender(data,altClassName,renderer){var self=this;return renderer=renderer||this.getRenderer(),_(this.getChoices()).filter(function(elt){return Element.isA(elt,"choice")}).map(function(choice){return choice.postRender({},choice.qtiClass+"."+self.qtiClass,renderer)}).value().concat(this._super(data,altClassName,renderer))},setResponse:function setResponse(values){var ret=null,renderer=this.getRenderer();if(renderer)ret=renderer.setResponse(this,values);else throw"no renderer found for the interaction "+this.qtiClass;return ret},getResponse:function getResponse(){var ret=null,renderer=this.getRenderer();if(renderer)ret=renderer.getResponse(this);else throw"no renderer found for the interaction "+this.qtiClass;return ret},resetResponse:function resetResponse(){var ret=null,renderer=this.getRenderer();if(renderer)ret=renderer.resetResponse(this);else throw"no renderer found for the interaction "+this.qtiClass;return ret},getState:function getState(){var ret=null,renderer=this.getRenderer();if(renderer)_.isFunction(renderer.getState)&&(ret=renderer.getState(this));else throw"no renderer found for the interaction "+this.qtiClass;return ret},setState:function setState(state){var renderer=this.getRenderer();if(renderer)_.isFunction(renderer.setState)&&renderer.setState(this,state);else throw"no renderer found for the interaction "+this.qtiClass},clear:function clear(){var renderer=this.getRenderer();if(renderer&&_.isFunction(renderer.destroy))return renderer.destroy(this)},toArray:function toArray(){var arr=this._super();for(var serial in arr.choices={},this.choices)Element.isA(this.choices[serial],"choice")&&(arr.choices[serial]=this.choices[serial].toArray());return arr},getNormalMaximum:function(){return!1}});return QtiInteraction}),define("taoQtiItem/qtiItem/core/interactions/Prompt",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Element,Container){var Prompt=Element.extend({qtiClass:"prompt"});return Container.augment(Prompt),Prompt}),define("taoQtiItem/qtiItem/core/interactions/BlockInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/core/interactions/Prompt","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Interaction,Prompt,_,rendererConfig){'use strict';var BlockInteraction=Interaction.extend({init:function init(serial,attributes){this._super(serial,attributes),this.prompt=new Prompt("")},is:function is(qtiClass){return"blockInteraction"===qtiClass||this._super(qtiClass)},getComposingElements:function getComposingElements(){var elts=this._super();return elts=_.extend(elts,this.prompt.getComposingElements()),elts[this.prompt.getSerial()]=this.prompt,elts},find:function find(serial){return this._super(serial)||this.prompt.find(serial)},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={prompt:this.prompt.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function postRender(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),[].concat(this.prompt.postRender({},"",renderer)).concat(this._super(data,altClassName,renderer))},toArray:function toArray(){var arr=this._super();return arr.prompt=this.prompt.toArray(),arr}});return BlockInteraction}),define("taoQtiItem/qtiItem/core/interactions/AssociateInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){'use strict';var AssociateInteraction=BlockInteraction.extend({qtiClass:"associateInteraction",getNormalMaximum:function(){return maxScore.associateInteractionBased(this,{possiblePairs:function(associateInteraction){var pairs=[],choices=maxScore.getMatchMaxOrderedChoices(associateInteraction.getChoices()),i,j;for(i=0;i<choices.length;i++)for(j=i;j<choices.length;j++)pairs.push([choices[i].id,choices[j].id]);return pairs}(this)})}});return AssociateInteraction}),define("taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/AssociateInteraction","taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice"],function($,_,editable,editableInteraction,Interaction,Choice){var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{shuffle:!1,maxAssociations:0,minAssociations:0}},afterCreate:function afterCreate(){this.createChoice(),this.createChoice(),this.createResponse({baseType:"pair",cardinality:"multiple"})},createChoice:function createChoice(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){'use strict';var ChoiceInteraction=BlockInteraction.extend({qtiClass:"choiceInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}});return ChoiceInteraction}),define("taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/model/choices/SimpleChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{shuffle:!1,maxChoices:0,minChoices:0,orientation:"vertical"}},afterCreate:function afterCreate(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"multiple"})},createChoice:function createChoice(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/InlineInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction"],function(Interaction){'use strict';return Interaction.extend({is:function is(qtiClass){return"inlineInteraction"===qtiClass||this._super(qtiClass)}})}),define("taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(InlineInteraction){return InlineInteraction.extend({qtiClass:"endAttemptInteraction"})}),define("taoQtiItem/qtiCreator/model/interactions/EndAttemptInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction","i18n"],function(_,editable,editableInteraction,Interaction,__){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{title:__("End Attempt")}},afterCreate:function afterCreate(){this.createResponse({baseType:"boolean",cardinality:"single"})},createChoice:function createChoice(){throw new Error("end attempt interaction has no choice")}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/maxScore"],function(_,BlockInteraction,rendererConfig,maxScore){'use strict';var ExtendedTextInteraction=BlockInteraction.extend({qtiClass:"extendedTextInteraction",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={multiple:!1,maxStringLoop:[]},response=this.getResponseDeclaration(),i;if(this.attr("maxStrings")&&("multiple"===response.attr("cardinality")||"ordered"===response.attr("cardinality")))for(defaultData.multiple=!0,i=0;i<this.attr("maxStrings");i++)defaultData.maxStringLoop.push(i+"");return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getNormalMaximum:function(){return maxScore.textEntryInteractionBased(this)}});return ExtendedTextInteraction}),define("taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{format:"plain"}},afterCreate:function afterCreate(){this.createResponse({baseType:"string",cardinality:"single"})},createChoice:function createChoice(){throw"extendedTextInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ContainerInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/mixin/Container"],function(BlockInteraction,Container){var ContainerInteraction=BlockInteraction.extend({});return Container.augment(ContainerInteraction),ContainerInteraction}),define("taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(ContainerInteraction,maxScore){'use strict';var GapMatchInteraction=ContainerInteraction.extend({qtiClass:"gapMatchInteraction",getGaps:function(){return this.getBody().getElements("gap")},getNormalMaximum:function(){return maxScore.gapMatchInteractionBased(this)}});return GapMatchInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GapMatchInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GapMatchInteraction","taoQtiItem/qtiCreator/model/choices/GapText","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,editable,editableInteraction,Interaction,Choice,event,responseHelper){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{shuffle:!1}},afterCreate:function afterCreate(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>"),this.createChoice(),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},getNextPlaceholder:function(){for(var allChoices=this.getChoices(),existingChoicesLabels=_.map(allChoices,function(choice){var choiceBody=choice.getBody()||{};return choiceBody.bdy}),placeHolderIndex=1,placeHolder="choice #"+placeHolderIndex;-1!==existingChoicesLabels.indexOf(placeHolder);)placeHolderIndex++,placeHolder="choice #"+placeHolderIndex;return placeHolder},createChoice:function createChoice(text){var choice=new Choice;return this.addChoice(choice),choice.body(text||this.getNextPlaceholder()).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},createGap:function createGap(attr,body){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("gap"),choice.body(body),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},removeChoice:function removeChoice(element){var serial="",c;return"string"==typeof element?serial=element:Element.isA(element,"gap")?serial=element.serial:Element.isA(element,"gapText")&&(serial=element.serial),(c=this.getBody().getElement(serial))?(this.getBody().removeElement(c),responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)):(c=this.getChoice(serial))&&(delete this.choices[serial],responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),this}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ObjectInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/Object"],function(QtiBlockInteraction,QtiObject){var QtiObjectInteraction=QtiBlockInteraction.extend({initObject:function initObject(object){this.object=object||new QtiObject},getObject:function getObject(){return this.object}});return QtiObjectInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(QtiObjectInteraction,_,rendererConfig){var QtiGraphicInteraction=QtiObjectInteraction.extend({render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={backgroundImage:this.object.getAttributes(),object:this.object.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return QtiGraphicInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){'use strict';var GraphicAssociateInteraction=GraphicInteraction.extend({qtiClass:"graphicAssociateInteraction",getNormalMaximum:function(){return maxScore.associateInteractionBased(this,{possiblePairs:function(associateInteraction){var pairs=[],choices=maxScore.getMatchMaxOrderedChoices(associateInteraction.getChoices()),i,j;for(i=0;i<choices.length;i++)for(j=i;j<choices.length;j++)i!==j&&pairs.push([choices[i].id,choices[j].id]);return pairs}(this)})}});return GraphicAssociateInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/model/choices/AssociableHotspot"],function($,_,editable,editableInteraction,Interaction,AssociableHotspot){'use strict';var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{maxAssociations:0,minAssociations:0}},afterCreate:function afterCreate(){var relatedItem=this.getRootElement(),isResponsive=relatedItem.data("responsive");!0===isResponsive&&this.addClass("responsive"),this.createResponse({baseType:"pair",cardinality:"multiple"})},createChoice:function createChoice(attr){var choice=new AssociableHotspot("",attr);return this.addChoice(choice),choice.buildIdentifier("associablehotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/maxScore","taoQtiItem/qtiItem/helper/response"],function(GraphicInteraction,Element,_,rendererConfig,maxScore){'use strict';var GraphicGapMatchInteraction=GraphicInteraction.extend({qtiClass:"graphicGapMatchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.gapImgs={}},addGapImg:function(gapImg){Element.isA(gapImg,"gapImg")&&(gapImg.setRootElement(this.getRootElement()||null),this.gapImgs[gapImg.getSerial()]=gapImg)},removeGapImg:function(gapImg){var serial="";return"string"==typeof gapImg?serial=gapImg:Element.isA(gapImg,"gapImg")&&(serial=gapImg.getSerial()),delete this.gapImgs[serial],this},getGapImgs:function(){return _.clone(this.gapImgs)},getGapImg:function(serial){return this.gapImgs[serial]},getChoiceByIdentifier:function(identifier){var choice=this._super(identifier);return choice||(choice=_.find(this.gapImgs,function(elt){return elt&&elt.id()===identifier})),choice},getComposingElements:function(){var elts=this._super(),serial;for(serial in this.gapImgs)elts[serial]=this.gapImgs[serial],elts=_.extend(elts,this.gapImgs[serial].getComposingElements());return elts},find:function(serial){var found=this._super(serial);return!found&&this.gapImgs[serial]&&(found={parent:this,element:this.gapImgs[serial]}),found},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={gapImgs:[]},gapImgs=this.getGapImgs(),serial;for(serial in gapImgs)Element.isA(gapImgs[serial],"choice")&&defaultData.gapImgs.push(gapImgs[serial].render({},null,"",renderer));return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var arr=this._super(),serial,gapImgs;for(serial in arr.gapImgs={},gapImgs=this.getGapImgs(),gapImgs)arr.gapImgs[serial]=gapImgs[serial].toArray();return arr},getNormalMaximum:function(){return maxScore.associateInteractionBased(this,{possiblePairs:function(graphicGapInteraction){var pairs=[],matchSet1=maxScore.getMatchMaxOrderedChoices(graphicGapInteraction.getGapImgs()),matchSet2=maxScore.getMatchMaxOrderedChoices(graphicGapInteraction.getChoices());return _.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs}(this),checkInfinitePair:!0})}});return GraphicGapMatchInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/model/choices/GapImg","taoQtiItem/qtiCreator/model/choices/AssociableHotspot"],function($,_,editable,editableInteraction,Interaction,GapImg,AssociableHotspot){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{afterCreate:function afterCreate(){var relatedItem=this.getRootElement(),isResponsive=relatedItem.data("responsive");!0===isResponsive&&this.addClass("responsive"),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createGapImg:function createGapImg(object,label){var gapImg=new GapImg;return gapImg.object.attributes=object,label&&gapImg.attr("objectLabel",label),this.gapImgs||(this.gapImgs=[]),this.addGapImg(gapImg),gapImg.buildIdentifier("gapimg"),this.getRenderer()&&gapImg.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:gapImg,interaction:this}),gapImg},createChoice:function createChoice(attr){var choice=new AssociableHotspot("",attr);return this.addChoice(choice),choice.buildIdentifier("associablehotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){'use strict';var GraphicOrderInteraction=GraphicInteraction.extend({qtiClass:"graphicOrderInteraction",getNormalMaximum:function(){return maxScore.orderInteractionBased(this)}});return GraphicOrderInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/model/choices/HotspotChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{}},afterCreate:function afterCreate(){var relatedItem=this.getRootElement(),isResponsive=relatedItem.data("responsive");!0===isResponsive&&this.addClass("responsive"),this.createResponse({baseType:"identifier",cardinality:"ordered"})},createChoice:function createChoice(attr){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("hotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/HotspotInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){'use strict';var HotspotInteraction=GraphicInteraction.extend({qtiClass:"hotspotInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}});return HotspotInteraction}),define("taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/HotspotInteraction","taoQtiItem/qtiCreator/model/choices/HotspotChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{maxChoices:0,minChoices:0}},afterCreate:function afterCreate(){var relatedItem=this.getRootElement(),isResponsive=relatedItem.data("responsive");!0===isResponsive&&this.addClass("responsive"),this.createResponse({baseType:"identifier",cardinality:"single"})},createChoice:function createChoice(attr){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("hotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/HottextInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/maxScore"],function(ContainerInteraction,Element,maxScore){'use strict';var HottextInteraction=ContainerInteraction.extend({qtiClass:"hottextInteraction",getChoices:function getChoices(){return this.getBody().getElements("hottext")},getChoice:function getChoice(serial){var element=this.getBody().getElement(serial);return Element.isA(element,"choice")?element:null},getNormalMaximum:function(){return maxScore.choiceInteractionBased(this)}});return HottextInteraction}),define("taoQtiItem/qtiCreator/model/interactions/HottextInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/HottextInteraction","taoQtiItem/qtiCreator/model/choices/Hottext","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,editable,editableInteraction,Interaction,Choice,event,responseHelper){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{maxChoices:0,minChoices:0}},afterCreate:function afterCreate(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>"),this.createResponse({baseType:"identifier",cardinality:"multiple"})},createChoice:function createChoice(attr,body){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("hottext"),choice.body(body),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},removeChoice:function removeChoice(hottext){var serial="",c;return"string"==typeof hottext?serial=hottext:Element.isA(hottext,"hottext")&&(serial=hottext.getSerial()),c=this.getBody().getElement(serial),c&&(this.getBody().removeElement(c),responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),this}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(InlineInteraction,maxScore){'use strict';var InlineChoiceInteraction=InlineInteraction.extend({qtiClass:"inlineChoiceInteraction",getNormalMaximum:function(){return maxScore.choiceInteractionBased(this,{maxChoices:1})}});return InlineChoiceInteraction}),define("taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/model/choices/InlineChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{shuffle:!1,required:!1}},afterCreate:function afterCreate(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"single"})},createChoice:function createChoice(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.val("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/MatchInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,SimpleAssociableChoice,_,rendererConfig,util,maxScore){'use strict';var MatchInteraction=BlockInteraction.extend({qtiClass:"matchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.choices=[{},{}]},addChoice:function(choice,matchSet){matchSet=parseInt(matchSet),this.choices[matchSet]&&(choice.setRootElement(this.getRootElement()||null),this.choices[matchSet][choice.getSerial()]=choice)},getChoices:function(matchSet){return matchSet=parseInt(matchSet),this.choices[matchSet]?_.clone(this.choices[matchSet]):_.clone(this.choices)},getChoice:function(serial){return this.choices[0][serial]||this.choices[1][serial]||null},getChoiceByIdentifier:function(identifier){var i,matchSet,serial;for(i=0;2>i;i++)for(serial in matchSet=this.getChoices(i),matchSet)if(matchSet[serial]instanceof SimpleAssociableChoice&&matchSet[serial].id()===identifier)return matchSet[serial];return null},getComposingElements:function(){var elts=this._super(),i,matchSet,serial;for(i=0;2>i;i++)for(serial in matchSet=this.getChoices(i),matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&(elts[serial]=matchSet[serial],elts=_.extend(elts,matchSet[serial].getComposingElements()));return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["choices.0","choices.1"],serial)),found},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={matchSet1:[],matchSet2:[]},interactionData={interaction:{serial:this.serial,attributes:this.attributes}},choices,i,matchSet,serial;if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;for(choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),i=0;2>i;i++)for(serial in matchSet=choices[i],matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&defaultData["matchSet"+(i+1)].push(matchSet[serial].render(_.clone(interactionData,!0),null,"simpleAssociableChoice.matchInteraction",renderer));return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),_(this.getChoices()).map(function(choices){return _(choices).filter(function(choice){return choice instanceof SimpleAssociableChoice}).map(function(choice){return choice.postRender({},"simpleAssociableChoice.matchInteraction",renderer)}).value()}).flatten(!0).value().concat(this._super(data,altClassName,renderer))},toArray:function(){var arr=this._super(),i,matchSet,serial;for(arr.choices={0:{},1:{}},i=0;2>i;i++)for(serial in matchSet=this.getChoices(i),matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&(arr.choices[i][serial]=matchSet[serial].toArray());return arr},getNormalMaximum:function(){return maxScore.associateInteractionBased(this,{possiblePairs:function(matchInteraction){var pairs=[],matchSet1=maxScore.getMatchMaxOrderedChoices(matchInteraction.getChoices(0)),matchSet2=maxScore.getMatchMaxOrderedChoices(matchInteraction.getChoices(1));return _.forEach(matchSet1,function(choice1){_.forEach(matchSet2,function(choice2){pairs.push([choice1.id,choice2.id])})}),pairs}(this)})}});return MatchInteraction}),define("taoQtiItem/qtiCreator/model/interactions/MatchInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/MatchInteraction","taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,editable,editableInteraction,Interaction,Choice,event,responseHelper){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{shuffle:!1,maxAssociations:0,minAssociations:0}},afterCreate:function afterCreate(){this.createChoice(0),this.createChoice(0),this.createChoice(1),this.createChoice(1),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createChoice:function createChoice(matchSet,attr){var choice=new Choice("",attr);this.addChoice(choice,matchSet);var rank=_.size(this.getChoices(matchSet));return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},removeChoice:function removeChoice(choice){var serial="",c;return"string"==typeof choice?serial=choice:Element.isA(choice,"choice")&&(serial=choice.getSerial()),c=this.choices[0][serial]||this.choices[1][serial]||null,c&&(delete this.choices[0][serial],delete this.choices[1][serial],responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),this}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/MediaInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/ObjectInteraction","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,ObjectInteraction,rendererConfig){'use strict';var MediaInteraction=ObjectInteraction.extend({qtiClass:"mediaInteraction",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={object:this.object.render({},null,"",renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return MediaInteraction}),define("taoQtiItem/qtiCreator/model/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/MediaInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{autostart:!1,minPlays:0,maxPlays:0,loop:!1}},afterCreate:function afterCreate(){this.createResponse({baseType:"integer",cardinality:"single"})},createChoice:function createChoice(){throw"mediaInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/OrderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){'use strict';var OrderInteraction=BlockInteraction.extend({qtiClass:"orderInteraction",getNormalMaximum:function(){return maxScore.orderInteractionBased(this)}});return OrderInteraction}),define("taoQtiItem/qtiCreator/model/interactions/OrderInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/OrderInteraction","taoQtiItem/qtiCreator/model/choices/SimpleChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{shuffle:!1,orientation:"vertical"}},afterCreate:function afterCreate(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"ordered"})},createChoice:function createChoice(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/mixin/CustomElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){var methods={prop:function(name,value){if(name)if(void 0!==value)this.properties[name]=value;else if("object"===_typeof2(name))for(var prop in name)this.prop(prop,name[prop]);else if("string"==typeof name)return void 0===this.properties[name]?void 0:this.properties[name];return this},removeProp:function removeProp(propNames){var _this=this;return"string"==typeof propNames&&(propNames=[propNames]),_.each(propNames,function(propName){delete _this.attributes[propName]}),this},getProperties:function getProperties(){return _.clone(this.properties)},getMarkupNamespace:function getMarkupNamespace(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRootElement();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function setMarkupNamespace(name,uri){this.markupNs={name:name,uri:uri}}};return{augment:function augment(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/interactions/CustomInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Interaction,CustomElement,NamespacedElement,rendererConfig){var CustomInteraction=Interaction.extend({qtiClass:"customInteraction",defaultNsName:"pci",defaultNsUri:"http://www.imsglobal.org/xsd/portableCustomInteraction",nsUriFragment:"portableCustomInteraction",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function init(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.pciReadyCallbacks=[]},is:function is(qtiClass){return"customInteraction"===qtiClass||this._super(qtiClass)},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pci:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function toArray(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},getMarkupNamespace:function getMarkupNamespace(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRootElement();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function setMarkupNamespace(name,uri){this.markupNs={name:name,uri:uri}},onPciReady:function onPciReady(callback){this.pciReadyCallbacks.push(callback),this.data("pci")&&this.triggerPciReady()},triggerPciReady:function triggerPciReady(){var _this=this,pci=this.data("pci");if(pci)_.each(this.pciReadyCallbacks,function(fn){fn.call(_this,pci)}),this.pciReadyCallbacks=[],this.data("pciReady",!0);else throw"cannot trigger pci ready when no pci is actually attached to the interaction"},onPci:function onPci(event,callback){return this.onPciReady(function(pci){if(_.isFunction(pci.on))pci.on(event,callback);else throw"the pci does not implement on() function"}),this},offPci:function offPci(event){return this.onPciReady(function(pci){if(_.isFunction(pci.off))pci.off(event);else throw"the pci does not implement off() function"}),this},triggerPci:function triggerPci(event,args){return this.onPciReady(function(pci){if(_.isFunction(pci.off))pci.trigger(event,args);else throw"the pci does not implement off() function"}),this}});return CustomElement.augment(CustomInteraction),NamespacedElement.augment(CustomInteraction),CustomInteraction}),define("taoQtiItem/qtiCreator/model/interactions/PortableCustomInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiCreator/model/helper/portableElement","taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/qtiItem/core/interactions/CustomInteraction"],function(_,editable,editableInteraction,portableElement,ciRegistry,Interaction){"use strict";var _throwMissingImplementationError=function(pci,fnName){throw fnName+" not available for pci of type "+pci.typeIdentifier},methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,portableElement.getDefaultMethods(ciRegistry)),_.extend(methods,{createChoice:function createChoice(){var creator=ciRegistry.getCreator(this.typeIdentifier);return _.isFunction(creator.createChoice)?creator.createChoice(this):void _throwMissingImplementationError(this,"createChoice")},getDefaultMarkupTemplateData:function getDefaultMarkupTemplateData(){return{responseIdentifier:this.attr("responseIdentifier")}}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(GraphicInteraction,maxScore){'use strict';var SelectPointInteraction=GraphicInteraction.extend({qtiClass:"selectPointInteraction",getNormalMaximum:function(){return maxScore.selectPointInteractionBased(this)}});return SelectPointInteraction}),define("taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/SelectPointInteraction"],function($,_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{maxChoices:0,minChoices:0}},afterCreate:function afterCreate(){var relatedItem=this.getRootElement(),isResponsive=relatedItem.data("responsive");!0===isResponsive&&this.addClass("responsive"),this.createResponse({baseType:"point",cardinality:"multiple"},"MAP_RESPONSE_POINT")}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/SliderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(BlockInteraction,maxScore){'use strict';var SliderInteraction=BlockInteraction.extend({qtiClass:"sliderInteraction",getNormalMaximum:function(){return maxScore.sliderInteractionBased(this)}});return SliderInteraction}),define("taoQtiItem/qtiCreator/model/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/SliderInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{lowerBound:0,upperBound:100,orientation:"horizontal",reverse:!1,step:1,stepLabel:!1}},afterCreate:function afterCreate(){this.createResponse({baseType:"integer",cardinality:"single"})},createChoice:function createChoice(){throw"sliderInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction","taoQtiItem/qtiItem/helper/maxScore"],function(InlineInteraction,maxScore){'use strict';var TextEntryInteraction=InlineInteraction.extend({qtiClass:"textEntryInteraction",getNormalMaximum:function(){return maxScore.textEntryInteractionBased(this)}});return TextEntryInteraction}),define("taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/TextEntryInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{base:10,placeholderText:""}},afterCreate:function afterCreate(){this.createResponse({baseType:"string",cardinality:"single"})},createChoice:function createChoice(){throw new Error("text entry interaction has no choice")}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/UploadInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(InlineInteraction){var UploadInteraction=InlineInteraction.extend({qtiClass:"uploadInteraction"});return UploadInteraction}),define("taoQtiItem/qtiCreator/model/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/UploadInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{}},afterCreate:function afterCreate(){this.createResponse({baseType:"file",cardinality:"single"})},createChoice:function createChoice(){throw"uploadInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/Math",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/mixin/NamespacedElement"],function($,_,Element,rendererConfig,NamespacedElement){'use strict';function _stripMathTags(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":"")+"math[^>]*>","g");return mathML.replace(regex,"").replace(/^\s*[\r\n]/gm,"").replace(/\s*[\r\n]$/gm,"")}function _stripNamespace(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":""),"g");return mathML.replace(regex,"<$1")}function _isEmptyMathML(mathStr){var hasContent=!1,$math,mathText;return mathStr&&mathStr.trim()&&($math=$($.parseHTML(mathStr)),mathText=$math.text(),hasContent=_.isString(mathText)&&!!mathText.trim()),!hasContent}var Math;return Math=Element.extend({qtiClass:"math",defaultNsName:"m",defaultNsUri:"http://www.w3.org/1998/Math/MathML",nsUriFragment:"MathML",init:function init(serial,attributes){this._super(serial,attributes),this.ns=null,this.mathML="",this.annotations={}},setAnnotation:function setAnnotation(encoding,value){this.annotations[encoding]=_.unescape(value)},getAnnotation:function getAnnotation(encoding){return this.annotations[encoding]},removeAnnotation:function removeAnnotation(encoding){delete this.annotations[encoding]},setMathML:function setMathML(mathML){var ns=this.getNamespace(),nsName=ns.name&&ns.uri?ns.name:"";mathML=_stripMathTags(mathML,nsName),ns&&(mathML=_stripNamespace(mathML,nsName)),this.mathML=mathML},getMathML:function getMathML(){return this.mathML},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),tag=this.qtiClass,raw=this.mathML,body=raw,ns=this.getNamespace(),annotations="",encoding,defaultData;for(encoding in this.annotations)annotations+="<annotation encoding=\""+encoding+"\">"+_.escape(this.annotations[encoding])+"</annotation>";return annotations&&(0<raw.indexOf("</semantics>")?raw=raw.replace("</semantics>",annotations+"</semantics>"):raw="<semantics>"+raw+annotations+"</semantics>"),ns&&ns.name&&(body=raw.replace(/<(\/)?([^!<])/g,"<$1"+ns.name+":$2"),tag=ns.name+":"+tag),body=body.replace(/<!--.*?-->/g,""),body=body.replace(/&lt;!--.*?--&gt;/g,""),defaultData={block:"block"===this.attr("display"),body:body,raw:raw,tag:tag,ns:ns},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function isEmpty(){return _isEmptyMathML(this.mathML)&&(!this.annotations.latex||!this.annotations.latex.trim())}}),NamespacedElement.augment(Math),Math}),define("taoQtiItem/qtiCreator/model/Math",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Math"],function(_,editable){"use strict";var _Mathextend=(0,eval)("this").Math.extend,methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{}},afterCreate:function afterCreate(){this.getNamespace()}}),_Mathextend(methods)}),define("taoQtiItem/qtiCreator/model/Object",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Object"],function(_,editable,Object){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{data:"",type:""}}}),Object.extend(methods)}),define("taoQtiItem/qtiCreator/model/pciCreatorContext",["lodash"],function(_){"use strict";var _pciModels={};return{register:function register(pciModel){_pciModels[pciModel.getTypeIdentifier()]=pciModel},createPciInstance:function createPciInstance(pciTypeIdentifier){if(_pciModels[pciTypeIdentifier])return _.cloneDeep(_pciModels[pciTypeIdentifier])}}}),define("taoQtiItem/qtiItem/core/PortableInfoControl",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,CustomElement,NamespacedElement,rendererConfig){'use strict';var PortableInfoControl=Element.extend({qtiClass:"infoControl",defaultNsName:"pic",defaultNsUri:"http://www.imsglobal.org/xsd/portableInfoControl",nsUriFragment:"portableInfoControl",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function init(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.readyStack=[]},is:function is(qtiClass){return"infoControl"===qtiClass||this._super(qtiClass)},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pic:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getState:function(){var ret=null,renderer=this.getRenderer();return renderer&&_.isFunction(renderer.getState)&&(ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.getState)&&renderer.setState(this,state)},toArray:function toArray(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},onReady:function(cb){this.readyStack.push(cb),this.data("_ready")&&this.data("pic")&&this.triggerReady()},triggerReady:function(){var self=this;_.forEach(this.readyStack,function(cb){cb.call(self,self.data("pic"))}),this.readyStack=[],this.data("_ready",!0)}});return CustomElement.augment(PortableInfoControl),NamespacedElement.augment(PortableInfoControl),PortableInfoControl}),define("taoQtiItem/qtiCreator/model/PortableInfoControl",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/helper/portableElement","taoQtiItem/portableElementRegistry/icRegistry","taoQtiItem/qtiItem/core/PortableInfoControl"],function(_,editable,portableElement,icRegistry,PortableInfoControl){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,portableElement.getDefaultMethods(icRegistry)),_.extend(methods,{getDefaultMarkupTemplateData:function getDefaultMarkupTemplateData(){return{}}}),PortableInfoControl.extend(methods)}),define("taoQtiItem/qtiItem/core/PrintedVariable",["taoQtiItem/qtiItem/core/Element"],function(Element){'use strict';var PrintedVariable=Element.extend({qtiClass:"printedVariable"});return PrintedVariable}),define("taoQtiItem/qtiCreator/model/PrintedVariable",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/PrintedVariable"],function(_,editable,PrintedVariable){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{format:"%2g",powerForm:!1,base:10,index:-1,delimiter:";",field:"",mappingIndicator:"="}},isEmpty:function(){return!this.attr("identifier")}}),PrintedVariable.extend(methods)}),define("taoQtiItem/qtiItem/core/RubricBlock",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/Container"],function(Element,Container){var RubricBlock=Element.extend({qtiClass:"rubricBlock",isEmpty:function(){return!(this.bdy&&this.bdy.body())}});return Container.augment(RubricBlock),RubricBlock}),define("taoQtiItem/qtiCreator/model/RubricBlock",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/RubricBlock"],function(_,editable,RubricBlock){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function getDefaultAttributes(){return{view:["candidate"],use:""}}}),RubricBlock.extend(methods)}),define("taoQtiItem/qtiItem/mixin/ContainerTable",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){'use strict';var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function initContainer(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="table"}}),{augment:function augment(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Table",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerTable"],function(_,Element,Container){'use strict';var Table=Element.extend({qtiClass:"table"});return Container.augment(Table),Table=Table.extend({body:function body(newBody){return _.isString(newBody)&&(newBody=newBody.replace("<table>","").replace("</table>","")),this._super(newBody)}}),Table}),define("taoQtiItem/qtiCreator/model/Table",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Table"],function(_,editable,Table){"use strict";var methods={};return _.extend(methods,editable),Table.extend(methods)}),define("taoQtiItem/qtiItem/core/Tooltip",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,ContainerInline,rendererConfig){'use strict';var Tooltip=Element.extend({qtiClass:"_tooltip",init:function init(serial,attributes,newContent){this._super(serial,attributes),this.content(newContent||"")},content:function(newContent){if("undefined"==typeof newContent)return this.tooltipContent;if("string"==typeof newContent)this.tooltipContent=newContent;else throw new Error("newContent must be a string");return this},render:function render(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={content:this.tooltipContent};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return ContainerInline.augment(Tooltip),Tooltip}),define("taoQtiItem/qtiCreator/model/Tooltip",["lodash","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Tooltip"],function(_,util,editable,PrintedVariable){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{init:function init(serial,attributes,newContent){this._super(serial,attributes,newContent)},isEmpty:function(){return!this.body()||!this.bdy},afterCreate:function afterCreate(){var tooltipContentId=util.buildSerial(this.qtiClass+"-");this.attr("aria-describedby",tooltipContentId)},body:function body(newBody){return"&nbsp;"===newBody&&(newBody=""),this._super(newBody)}}),PrintedVariable.extend(methods)}),define("taoQtiItem/qtiCreator/plugins/content/blockAdder",["lodash","core/plugin","taoQtiItem/qtiCreator/editor/blockAdder/blockAdder","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/portableElementRegistry/ciRegistry"],function(_,pluginFactory,blockAdder,qtiElements,ciRegistry){'use strict';return pluginFactory({name:"blockAdder",init:function(){var interactions=qtiElements.getAvailableAuthoringElements()||{};_.forIn(ciRegistry.getAllVersions(),function(versions,typeId){var data=ciRegistry.getAuthoringData(typeId,{enabledOnly:!0});data&&data.tags&&(interactions[data.qtiClass]=data)}),this.interations=interactions},render:function(){blockAdder.create(this.getHost().getItem(),this.getAreaBroker().getItemPanelArea(),this.interations)}})}),define("taoQtiItem/qtiCreator/plugins/navigation/back",["jquery","i18n","core/plugin","ui/hider","tpl!taoQtiItem/qtiCreator/plugins/button"],function($,__,pluginFactory,hider,buttonTpl){'use strict';return pluginFactory({name:"back",init:function(){var itemCreator=this.getHost();itemCreator.on("exit",function(){window.history.back()}),this.$element=$(buttonTpl({icon:"left",title:__("Back to Manage Items"),text:__("Manage Items"),cssClass:"back-action"})).on("click",function(e){e.preventDefault(),itemCreator.trigger("exit")}),this.hide()},render:function(){var $container=this.getAreaBroker().getMenuLeftArea();$container.append(this.$element),this.show()},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiItem/qtiCreator/widgets/choices/Widget",["taoQtiItem/qtiCreator/widgets/Widget"],function(Widget){var ChoiceWidget=Widget.clone();return ChoiceWidget.buildContainer=function(){this.$container=this.$original},ChoiceWidget.initCreator=function(){if(Widget.initCreator.call(this),this.interaction=this.element.getInteraction(),!this.interaction)throw new Error("cannot find related interaction");this.listenToInteractionStates()},ChoiceWidget.listenToInteractionStates=function(){var _this=this;this.beforeStateInit(function(e,element,state){if(element.is("interaction")&&element.getSerial()===_this.interaction.getSerial()&&state.name!==_this.getCurrentState().name)switch(state.name){case"answer":case"sleep":case"question":_this.changeState(state.name);break;case"delete":_this.changeState("sleep");}}),this.beforeStateExit(function(e,element,state){element.is("interaction")&&element.getSerial()===_this.interaction.getSerial()&&"choice"===state.name&&_this.changeState("question")})},ChoiceWidget}),define("taoQtiItem/qtiCreator/widgets/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("answer",["active"],function(){throw new Error("state \"answer\" prototype init method must be implemented")},function(){throw new Error("state \"answer\" prototype exit method must be implemented")})}),define("taoQtiItem/qtiCreator/widgets/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){'use strict';return stateFactory.create("choice",["question","active"],function(){throw new Error("state \"choice\" prototype init method must be implemented")},function(){throw new Error("state \"choice\" prototype exit method must be implemented")})}),define("taoQtiItem/qtiCreator/widgets/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("correct",["answer","active"],function(){throw new Error("state \"correct\" prototype init method must be implemented")},function(){throw new Error("state \"correct\" prototype exit method must be implemented")})}),define("taoQtiItem/qtiCreator/widgets/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("map",["answer","active"],function(){throw new Error("state \"map\" prototype init method must be implemented")},function(){throw new Error("state \"map\" prototype exit method must be implemented")})}),define("taoQtiItem/qtiCreator/widgets/states/NoRp",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){'use strict';return stateFactory.create("norp",["answer","active"],function(){throw new Error("state \"norp\" prototype init method must be implemented")},function(){throw new Error("state \"norp\" prototype exit method must be implemented")})}),define("taoQtiItem/qtiCreator/widgets/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("question",["active"],function(){throw new Error("state \"question\" prototype init method must be implemented")},function(){throw new Error("state \"question\" prototype exit method must be implemented")})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/invalidInfoBox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"feedback-warning popup\" data-widget-component=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"icon-warning\"></span>\n    ",stack1=(helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"There is an incomplete element in your item: please click on it to complete it.",options):helperMissing.call(depth0,"__","There is an incomplete element in your item: please click on it to complete it.",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/states/Invalid",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","tpl!taoQtiItem/qtiCreator/tpl/notifications/invalidInfoBox"],function($,stateFactory,invalidInfoBoxTpl){return stateFactory.create("invalid",["sleep"],function(){this.widget.$container.addClass("invalid"),this.$messageBox=$(invalidInfoBoxTpl({serial:this.widget.serial})),$(".qti-item").append(this.$messageBox)},function(){this.widget.$container.removeClass("invalid"),this.$messageBox.remove()})}),define("taoQtiItem/qtiCreator/widgets/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/states/Deleting","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/states/NoRp","taoQtiItem/qtiCreator/widgets/states/Question","taoQtiItem/qtiCreator/widgets/states/Sleep","taoQtiItem/qtiCreator/widgets/states/Invalid"],function(factory){'use strict';return factory.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,Sleep){var ChoiceStateSleep=stateFactory.create(Sleep,function(){},function(){});return ChoiceStateSleep}),define("taoQtiItem/qtiCreator/widgets/choices/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function(stateFactory,Active){var ChoiceStateActive=stateFactory.create(Active,function(){},function(){});return ChoiceStateActive}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"mini-tlb\" data-edit=\"question\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"rgt tlb-button\" title=\"Delete\" data-role=\"delete\">\n        <span class=\"icon-bin\"></span>\n    </div>\n    <div class=\"rgt tlb-button\" data-role=\"shuffle-pin\" title=\"Shuffle/Pin\" style=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.interactionShuffle,{hash:{},inverse:self.program(3,function(){return"display:none;"},data),fn:self.program(1,function(){return""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n        <span class=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.fixed,{hash:{},inverse:self.program(7,function(){return"icon-shuffle"},data),fn:self.program(5,function(){return"icon-pin"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"></span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/choices/helpers/formElement",["jquery"],function($){return{initShufflePinToggle:function initShufflePinToggle(widget){var $container=widget.$container,choice=widget.element,interaction=choice.getInteraction(),$shuffleToggle=$container.find("[data-role=\"shuffle-pin\"]");$shuffleToggle.off("mousedown").on("mousedown",function(e){e.stopPropagation();var $icon=$(this).children();0===$icon.length&&($icon=$(this)),$icon.hasClass("icon-shuffle")?($icon.removeClass("icon-shuffle").addClass("icon-pin"),choice.attr("fixed",!0)):($icon.removeClass("icon-pin").addClass("icon-shuffle"),choice.attr("fixed",!1))});var _toggleVisibility=function(show){show?$shuffleToggle.show():$shuffleToggle.hide(),$(".qti-item").trigger("toolbarchange",{callee:"formElementHelper"})};_toggleVisibility(interaction.attr("shuffle")),widget.on("attributeChange",function(data){data.element.serial===interaction.serial&&"shuffle"===data.key&&_toggleVisibility(data.value)})},initDelete:function initDelete(widget){var $container=widget.$container;$container.find("[data-role=\"delete\"]:not([data-html-editable] *)").on("mousedown",function(e){e.stopPropagation(),widget.changeState("deleting")})}}}),define("taoQtiItem/qtiCreator/widgets/choices/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,contentToolbarTpl,formElement){var ChoiceStateQuestion=stateFactory.create(QuestionState,function(){var _widget=this.widget;_widget.$container.on("click.question",function(){_widget.changeState("choice")}).on("mouseenter.question",function(){$(this).addClass("hover")}).on("mouseleave.question",function(){$(this).removeClass("hover")}),this.createToolbar().show()},function(){this.removeToolbar(),this.widget.$container.off(".question")});return ChoiceStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$container=_widget.$container,choice=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *"),interaction;return $toolbar.length||(interaction=choice.getInteraction(),$toolbar=$(contentToolbarTpl({choiceSerial:choice.getSerial(),interactionSerial:interaction.getSerial(),fixed:choice.attr("fixed"),interactionShuffle:interaction.attr("shuffle")})),$container.append($toolbar),formElement.initShufflePinToggle(_widget),formElement.initDelete(_widget)),$toolbar},ChoiceStateQuestion.prototype.removeToolbar=function(){this.widget.$container.find(".mini-tlb[data-edit=question]").remove()},ChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer"],function(stateFactory,Answer){var ChoiceStateAnswer=stateFactory.create(Answer,function(){},function(){});return ChoiceStateAnswer}),define("taoQtiItem/qtiCreator/widgets/choices/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/choices/states/Sleep","taoQtiItem/qtiCreator/widgets/choices/states/Active","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/states/Answer"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiItem/core/Element"],function(stateFactory,Choice,Element){var ChoiceStateChoice=stateFactory.create(Choice,function(){var _widget=this.widget;_widget.beforeStateInit(function(e,element,state){Element.isA(element,"choice")&&_widget.interaction.getChoice(element.serial)?"choice"===state.name&&element.serial!==_widget.serial?_widget.changeState("question"):"active"===state.name&&_widget.changeState("question"):(element.is("img")||element.is("math")||element.is("object"))&&"active"===state.name&&_widget.changeState("question")},"otherActive"),this.initForm(),this.widget.$form.show()},function(){this.widget.$form.empty().hide(),this.widget.offEvents("otherActive")});return ChoiceStateChoice.prototype.initForm=function(){stateFactory.throwMissingRequiredImplementationError("initForm")},ChoiceStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n           name=\"identifier\"\n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n           placeholder=\"e.g. my-choice_1\"\n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"required\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.required,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"required",options):helperMissing.call(depth0,"__","required",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options):helperMissing.call(depth0,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options)))+"\n    </span>\n</div>\n\n<h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shape position",options):helperMissing.call(depth0,"__","Shape position",options)))+"</h3>\n\n<div class=\"panel\">\n    <label for=\"x\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Left",options):helperMissing.call(depth0,"__","Left",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"x\" value=\"",(helper=helpers.x)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.x,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>\n\n<div class=\"panel\">\n    <label for=\"y\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Top",options):helperMissing.call(depth0,"__","Top",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"y\" value=\"",(helper=helpers.y)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.y,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>\n\n<div class=\"panel\">\n    <label for=\"width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>\n\n<div class=\"panel\">\n    <label for=\"height\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/helpers/identifier",["lodash"],function(_){var _updateChoiceIdentifierInResponse=function(response,oldId,newId){var escapedOldId=oldId.replace(/([.-])/g,"\\$1"),regex=new RegExp("([^\\s]*\\s+|^)("+escapedOldId+")(\\s+[^\\s]*|$)");for(var i in response.correctResponse)response.correctResponse[i]=response.correctResponse[i].replace(regex,"$1"+newId+"$3");var mapEntries={};_.forIn(response.mapEntries,function(value,mapKey){mapKey=mapKey.replace(regex,"$1"+newId+"$3"),mapEntries[mapKey]=value}),response.mapEntries=mapEntries},_updateChoiceIdentifier=_.throttle(function(choice,newId,response){var oldId=choice.id();if(oldId!==newId){_updateChoiceIdentifierInResponse(response,oldId,newId),choice.id(newId);var interaction=_get("interactionFromChoice",choice,function(){return choice.getInteraction()});try{var $choiceContainer=choice.getContainer(null,choice.qtiClass+"."+interaction.qtiClass);$choiceContainer.attr("data-identifier",choice.id()),$choiceContainer.find("input").val(choice.id())}catch(ex){}}},500),_cache=[],_setCache=function(cache,element,value){_cache[cache]||(_cache[cache]={}),_cache[cache][element.getSerial()]=value},_getCache=function(cache,element){var serial=element.getSerial();return serial&&_cache[cache]&&_cache[cache][serial]?_cache[cache][serial]:null},_get=function(cache,element,callback){var ret=_getCache(cache,element);return ret||(ret=callback.call(element),_setCache(cache,element,ret)),ret};return{updateChoiceIdentifier:function updateChoiceIdentifier(choice,value){if(value=value.trim(),value){var response=_get("responseFromChoice",choice,function(){var interaction=_get("interactionFromChoice",choice,function(){return choice.getInteraction()});return interaction.getResponseDeclaration()});_updateChoiceIdentifier(choice,value,response)}},updateResponseIdentifier:function updateResponseIdentifier(){throw"to be implemented"}}}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gap","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiItem/core/Element"],function(stateFactory,Choice,formTpl,formElement,identifierHelper,Element){var GapStateChoice=stateFactory.extend(Choice,function(){var _widget=this.widget;_widget.beforeStateInit(function(e,element,state){Element.isA(element,"gap")&&_widget.interaction.getBody().getElement(element.serial)&&("choice"===state.name&&element.serial!==_widget.serial?_widget.changeState("question"):"active"===state.name&&_widget.changeState("question"))},"otherActive")},function(){this.widget.offEvents("otherActive")});return GapStateChoice.prototype.initForm=function(){var $form=this.widget.$form,interaction=this.widget.element;$form.html(formTpl({serial:interaction.getSerial(),identifier:interaction.id(),required:!!interaction.attr("required")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{identifier:identifierHelper.updateChoiceIdentifier,required:formElement.getAttributeChangeCallback()})},GapStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"mini-tlb\" data-edit=\"",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"rgt tlb-button\" title=\"Delete\" data-role=\"delete\">\n        <span class=\"icon-bin\"></span>\n    </span>\n</span>",buffer})}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,gapTpl,formElement){var GapStateQuestion=stateFactory.extend(QuestionState);return GapStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$container=_widget.$container,gap=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *");return $toolbar.length||($toolbar=$(gapTpl({serial:gap.getSerial(),state:"question"})),$container.append($toolbar),formElement.initDelete(_widget)),$toolbar},GapStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/gap/states/Choice","taoQtiItem/qtiCreator/widgets/choices/gap/states/Question"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/gap/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/gap/states/states"],function(Widget,states){var GapWidget=Widget.clone();return GapWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},GapWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box"),this.$container.attr("contenteditable",!1)},GapWidget}),define("taoQtiItem/qtiCreator/renderers/choices/Gap",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/Gap","taoQtiItem/qtiCreator/widgets/choices/gap/Widget"],function(_,Gap,GapWidget){'use strict';var CreatorGap=_.clone(Gap);return CreatorGap.render=function(choice,options){GapWidget.build(choice,Gap.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorGap}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n           name=\"identifier\"\n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n           placeholder=\"e.g. my-choice_1\"\n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n\n<div class=\"panel\">\n    <h3 class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed number of uses",options):helperMissing.call(depth0,"__","Allowed number of uses",options)))+"\n    </h3>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",options):helperMissing.call(depth0,"__","The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",options)))+"\n    </span>\n\n    <!--not supported yet-->\n    <div style=\"display:none;\">\n        <label for=\"matchMin\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+"</label>\n        <input name=\"matchMin\" value=\"",(helper=helpers.matchMin)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMin,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\"1\" data-min=\"0\" data-max=\"100\" type=\"text\" />\n    </div>\n\n    <div>\n        <label for=\"matchMax\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+"</label>\n        <input name=\"matchMax\" value=\"",(helper=helpers.matchMax)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMax,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\"1\" data-min=\"0\" data-max=\"100\" type=\"text\" />\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(stateFactory,Choice,formTpl,formElement,identifierHelper,htmlEditor,contentHelper){'use strict';var SimpleAssociableChoiceStateChoice=stateFactory.extend(Choice,function(){this.buildEditor()},function(){this.destroyEditor()});return SimpleAssociableChoiceStateChoice.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,choice=_widget.element,callbacks;$form.html(formTpl({serial:choice.getSerial(),identifier:choice.id(),matchMin:choice.attr("matchMin"),matchMax:choice.attr("matchMax")})),formElement.initWidget($form),callbacks=formElement.getMinMaxAttributeCallbacks(this.widget.$form,"matchMin","matchMax"),callbacks.identifier=identifierHelper.updateChoiceIdentifier,formElement.setChangeCallbacks($form,choice,callbacks)},SimpleAssociableChoiceStateChoice.prototype.buildEditor=function(){var _widget=this.widget,container=_widget.element.getBody(),$editableContainer=_widget.$container;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget}})},SimpleAssociableChoiceStateChoice.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},SimpleAssociableChoiceStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/Choice",["jquery","lodash","ckeditor","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice","taoQtiItem/qtiItem/core/Element"],function($,_,CKEditor,stateFactory,Choice,SimpleAssociableChoice,Element){'use strict';var GapTextStateChoice=stateFactory.extend(Choice,function(){var _widget=this.widget;_widget.beforeStateInit(function(e,element,state){Element.isA(element,"choice")&&_widget.interaction.getBody().getElement(element.serial)&&"choice"===state.name&&element.serial!==_widget.serial&&_widget.changeState("question")},"otherActive")},function(){this.widget.offEvents("otherActive")});return GapTextStateChoice.prototype.initForm=function(){SimpleAssociableChoice.prototype.initForm.call(this)},GapTextStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/Question",["jquery","lodash","ckeditor","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function($,_,CKEditor,stateFactory,Question,Element,htmlEditor,contentHelper){'use strict';var GapTextStateQuestion=stateFactory.extend(Question,function(){this.buildEditor()},function(){this.destroyEditor()});return GapTextStateQuestion.prototype.initForm=_.noop(),GapTextStateQuestion.prototype.buildEditor=function(){var _widget=this.widget,container=_widget.element.getBody(),$editableContainer=_widget.$container;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget},toolbar:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]}],qtiMedia:!1,qtiInclude:!1,enterMode:CKEditor.ENTER_BR}),$editableContainer.on("keypress.qti-widget",function(e){13===e.which&&(e.preventDefault(),$(this).blur())})},GapTextStateQuestion.prototype.destroyEditor=function(){var _widget=this.widget,interaction=_widget.interaction,$editableContainer=_widget.$container,$editable=$editableContainer.find("[data-html-editable]"),placeholder;htmlEditor.getData($editable)&&""!==htmlEditor.getData($editable)||(placeholder=interaction.getNextPlaceholder(),htmlEditor.setData($editable,placeholder)),$editableContainer.off(".qti-widget"),htmlEditor.destroyEditor(this.widget.$container)},GapTextStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/gapText/states/Choice","taoQtiItem/qtiCreator/widgets/choices/gapText/states/Question"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/gapText/states/states"],function(Widget,states){var GapTextWidget=Widget.clone();return GapTextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},GapTextWidget}),define("taoQtiItem/qtiCreator/renderers/choices/GapText",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","taoQtiItem/qtiCreator/widgets/choices/gapText/Widget"],function(_,GapText,GapTextWidget){'use strict';var CreatorGapText=_.clone(GapText);return CreatorGapText.render=function(choice,options){GapTextWidget.build(choice,GapText.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorGapText}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n           name=\"identifier\"\n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n           placeholder=\"e.g. my-choice_1\"\n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(stateFactory,Choice,formTpl,formElement,identifierHelper,htmlEditor,contentHelper){'use strict';var SimpleChoiceStateChoice=stateFactory.extend(Choice,function(){this.buildEditor()},function(){this.destroyEditor()});return SimpleChoiceStateChoice.prototype.initForm=function(){var _widget=this.widget;_widget.$form.html(formTpl({serial:_widget.element.getSerial(),identifier:_widget.element.id()})),formElement.initWidget(_widget.$form),formElement.setChangeCallbacks(_widget.$form,_widget.element,{identifier:identifierHelper.updateChoiceIdentifier})},SimpleChoiceStateChoice.prototype.buildEditor=function(){var _widget=this.widget,container=_widget.element.getBody(),$editableContainer=_widget.$container;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget}})},SimpleChoiceStateChoice.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},SimpleChoiceStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(stateFactory,Choice,SimpleChoice){var HottextStateChoice=stateFactory.extend(Choice);return HottextStateChoice.prototype.initForm=function(){SimpleChoice.prototype.initForm.call(this)},HottextStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"mini-tlb\" data-edit=\"",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"tlb-button\" title=\"Restore\" data-role=\"restore\">\n        <span class=\"icon-undo\" data-role=\"restore\"></span>\n    </span>\n</span>",buffer})}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/Question",["lodash","jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext"],function(_,$,stateFactory,QuestionState,gapTpl){'use strict';var HottextStateQuestion=stateFactory.extend(QuestionState);return HottextStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$container=_widget.$container,hottext=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *");return $toolbar.length||($toolbar=$(gapTpl({serial:hottext.getSerial(),state:"question"})),$container.append($toolbar),$toolbar.find("[data-role=restore]").on("mousedown.question",function(){var inlineStaticElements=hottext.getElements(),parent=hottext.parent(),newBody=parent.body().replace(hottext.placeholder(),hottext.body()),hottextHtmlReplacement=_.reduce(inlineStaticElements,function(hottextBody,elt){return parent.setElement(elt),hottext.removeElement(elt),hottextBody.replace(elt.placeholder(),elt.render())},hottext.body());_widget.destroy(),hottext.remove(),parent.body(newBody),$container.replaceWith(hottextHtmlReplacement),_.each(inlineStaticElements,function(elt){elt.postRender()})})),$toolbar},HottextStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/hottext/states/Choice","taoQtiItem/qtiCreator/widgets/choices/hottext/states/Question"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/hottext/states/states"],function(Widget,states){var HottextWidget=Widget.clone();return HottextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},HottextWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box"),this.$container.attr("contenteditable",!1),this.$original.find(".hottext-checkmark > input").prop("disabled","disabled")},HottextWidget}),define("taoQtiItem/qtiCreator/renderers/choices/Hottext",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext","taoQtiItem/qtiCreator/widgets/choices/hottext/Widget"],function(_,Hottext,HottextWidget){'use strict';var CreatorHottext=_.clone(Hottext);return CreatorHottext.render=function(choice,options){HottextWidget.build(choice,Hottext.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorHottext});define("taoQtiItem/qtiCreator/renderers/choices/InlineChoice",function(){}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,contentToolbarTpl,formElement){'use strict';var SimpleAssociableChoiceStateQuestion=stateFactory.extend(QuestionState);return SimpleAssociableChoiceStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$container=_widget.$container,choice=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *"),interaction;return $toolbar.length||(interaction=choice.getInteraction(),$toolbar=$(contentToolbarTpl({choiceSerial:choice.getSerial(),interactionSerial:interaction.getSerial(),fixed:choice.attr("fixed"),interactionShuffle:interaction.attr("shuffle")})),$container.children(".inner-wrapper").append($toolbar),formElement.initShufflePinToggle(_widget),formElement.initDelete(_widget)),$toolbar},SimpleAssociableChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget",["jquery","taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states"],function($,Widget,states){var SimpleAssociableChoiceWidget=Widget.clone();return SimpleAssociableChoiceWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),this.$container.wrapInner($("<div>",{class:"inner-wrapper"})),this.$container.closest("table.matrix").find("input[type=checkbox]:enabled").prop("disabled","disabled")},SimpleAssociableChoiceWidget}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(_,SimpleAssociableChoice,SimpleChoiceWidget){'use strict';var CreatorSimpleChoice=_.clone(SimpleAssociableChoice);return CreatorSimpleChoice.render=function(choice,options){SimpleChoiceWidget.build(choice,SimpleAssociableChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleChoice}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(_,SimpleAssociableChoice,SimpleAssociableChoiceWidget){'use strict';var CreatorSimpleAssociableChoice=_.clone(SimpleAssociableChoice);return CreatorSimpleAssociableChoice.render=function(choice,options){SimpleAssociableChoiceWidget.build(choice,SimpleAssociableChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleAssociableChoice}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Question",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(_,stateFactory,Question){'use strict';var SimpleChoiceStateQuestion=stateFactory.extend(Question);return SimpleChoiceStateQuestion.prototype.initForm=_.noop(),SimpleChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states"],function(Widget,states){var SimpleChoiceWidget=Widget.clone();return SimpleChoiceWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states);var $realLabel=this.$container.find(".real-label");$realLabel.children("input").attr("disabled","disabled")},SimpleChoiceWidget}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(_,SimpleChoice,SimpleChoiceWidget){'use strict';var CreatorSimpleChoice=_.clone(SimpleChoice);return CreatorSimpleChoice.render=function(choice,options){SimpleChoiceWidget.build(choice,SimpleChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleChoice}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(_,SimpleChoice,SimpleChoiceWidget){'use strict';var CreatorSimpleChoice=_.clone(SimpleChoice);return CreatorSimpleChoice.render=function(choice,options){SimpleChoiceWidget.build(choice,SimpleChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/container",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="<div data-html-editable=\"true\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>",buffer}function program3(depth0,data){var buffer="",stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return stack1=(helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data},helper?helper.call(depth0,depth0&&depth0.contentModel,"blockStatic",options):helperMissing.call(depth0,"equal",depth0&&depth0.contentModel,"blockStatic",options)),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCreator/renderers/Container",["tpl!taoQtiItem/qtiCreator/tpl/container"],function(tpl){'use strict';return{qtiClass:"_container",template:tpl}}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var ImgStateSleep=stateFactory.extend(SleepState,function(){},function(){});return ImgStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/img",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"src\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n    <input type=\"text\" name=\"src\" value=\"",(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n    <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n</div>\n\n<div class=\"panel\">\n    <label for=\"alt\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Alt Text",options):helperMissing.call(depth0,"__","Alt Text",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The text to be displayed if the image is not available.",options):helperMissing.call(depth0,"__","The text to be displayed if the image is not available.",options)))+"</div>\n    <input type=\"text\" name=\"alt\" value=\"",(helper=helpers.alt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.alt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" placeholder=\"e.g. House with a garden\"/>\n</div>\n\n<div class=\"change-alt-modal-feedback modal\">\n    <div class=\"modal-body clearfix\">\n        <p>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Would you like to replace the alt text",options):helperMissing.call(depth0,"__","Would you like to replace the alt text",options)))+"</p>\n        <p class=\"alt-text\"></p>\n\n        <div class=\"rgt\">\n            <button class=\"btn-regular small cancel\" type=\"button\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No",options):helperMissing.call(depth0,"__","No",options)))+"</button>\n            <button class=\"btn-info small save\" type=\"button\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Yes",options):helperMissing.call(depth0,"__","Yes",options)))+"</button>\n        </div>\n    </div>\n</div>\n\n<div data-role=\"advanced\" style=\"display:none\">\n    \n    <hr/>\n    \n<!--\n    <div class=\"panel\">\n\n        <label for=\"align\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Alignment",options):helperMissing.call(depth0,"__","Alignment",options)))+"</label>\n        <select name=\"align\" class=\"select2\" data-has-search=\"false\">\n            <option value=\"default\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"default",options):helperMissing.call(depth0,"__","default",options)))+"</option>\n            <option value=\"left\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"left",options):helperMissing.call(depth0,"__","left",options)))+"</option>\n            <option value=\"right\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"right",options):helperMissing.call(depth0,"__","right",options)))+"</option>\n        </select>\n    </div>-->\n    \n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Size and position",options):helperMissing.call(depth0,"__","Size and position",options)))+"</h3>\n    <div class=\"panel img-resizer\"></div>\n    \n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/helpers/inline",["lodash","taoQtiItem/qtiCreator/helper/dummyElement","ui/validator/validators"],function(_,dummyElement,validators){var _qtiClassToDummies={math:"maths",img:"image",object:"media"},inlineHelper={checkFileExists:function checkFileExists(widget,fileSrcAttrName,baseUrl){var element=widget.element;validators.validators.fileExists.validate(element.attr(fileSrcAttrName),function(fileExists){fileExists||(element.attr(fileSrcAttrName,""),inlineHelper.togglePlaceholder(widget))},{baseUrl:baseUrl||""})},togglePlaceholder:function togglePlaceholder(widget,opts){var options=_.defaults(opts||{},{container:widget.$original,type:widget.element.qtiClass}),$container=options.container,$placeholder=$container.siblings(".dummy-element");if(widget.element.isEmpty()){$container.hide();var type=_qtiClassToDummies[options.type]||options.type;$placeholder.length||($placeholder=dummyElement.get(type),$container.after($placeholder)),$placeholder.show()}else $container.show(),$placeholder.hide();widget.$container.trigger("contentChange.qti-widget")},positionFloat:function positionFloat(widget,position){var $container=widget.$container,elt=widget.element;$container.removeClass("rgt lft"),elt.removeClass("rgt"),elt.removeClass("lft");"right"===position?($container.addClass("rgt"),elt.addClass("rgt")):"left"===position?($container.addClass("lft"),elt.addClass("lft")):void 0}};return inlineHelper}),define("util/image",[],function(){'use strict';return{getSize:function(src,timeout,cb){var img=document.createElement("img"),timeoutId;"function"==typeof timeout&&(cb=timeout,timeout=2),img.onload=function(){timeoutId&&(clearTimeout(timeoutId),cb({width:img.naturalWidth||img.width,height:img.naturalHeight||img.height}))},img.onerror=function(){timeoutId&&(clearTimeout(timeoutId),cb(null))},timeoutId=setTimeout(function(){cb(null)},1e3*timeout),img.src=src}}}),define("ui/mediaEditor/plugins/mediaDimension/helper",["lib/gamp/gamp"],function(gamp){'use strict';gamp=gamp&&gamp.hasOwnProperty("default")?gamp["default"]:gamp;var parseVal=function(val,precision){return"string"==typeof val&&(val=parseFloat(val)),val||(val=0),gamp.round(val,precision)},getActualRatio=function(conf){var ratio;return 0<conf.sizeProps.px.current.width&&0<conf.sizeProps.px.current.height&&(conf.sizeProps.ratio.current=gamp.round(conf.sizeProps.px.current.width/conf.sizeProps.px.current.height,conf.precision)),ratio=conf.denyCustomRatio?conf.sizeProps.ratio.natural:conf.sizeProps.ratio.current,ratio?ratio:1},applyNewPercent=function(val,conf){return conf.sizeProps["%"].current.width=val,100<conf.sizeProps["%"].current.width&&(conf.sizeProps["%"].current.width=100),1>conf.sizeProps["%"].current.width&&(conf.sizeProps["%"].current.width=1),conf},calculateByWidth=function(conf,width,maxWidth){var ratio=getActualRatio(conf),val=parseVal(width,conf.precision);return conf.sizeProps.px.current.width=val,conf=applyNewPercent(gamp.round(100*val/maxWidth,conf.precision),conf),conf.syncDimensions?conf.sizeProps.px.current.height=gamp.round(val/ratio,conf.precision):getActualRatio(conf),conf},calculateByHeight=function(conf,height,maxWidth){var ratio=getActualRatio(conf),val=parseVal(height,conf.precision);return conf.sizeProps.px.current.height=val,conf.syncDimensions?(conf.sizeProps.px.current.width=gamp.round(val*ratio,conf.precision),conf=applyNewPercent(gamp.round(100*val/maxWidth,conf.precision),conf)):getActualRatio(conf),conf},setPercent=function(conf,percent,maxWidth){return percent=parseVal(percent,conf.precision),0>percent?percent=0:100<percent&&(percent=100),conf=applyNewPercent(gamp.round(percent,conf.precision),conf),conf.sizeProps.ratio.current=conf.sizeProps.ratio.natural,conf.sizeProps.px.current.width=gamp.round(maxWidth*conf.sizeProps["%"].current.width/100,conf.precision),conf.sizeProps.px.current.height=gamp.round(conf.sizeProps.px.current.width/conf.sizeProps.ratio.natural,conf.precision),conf};return{applyDimensions:function(conf,dimensions){return conf.precision=conf&&conf.hasOwnProperty("precision")?parseInt(conf.precision,10):5,dimensions&&(dimensions.hasOwnProperty("width")&&(conf=calculateByWidth(conf,dimensions.width,dimensions.maxWidth)),dimensions.hasOwnProperty("height")&&(conf=calculateByHeight(conf,dimensions.height,dimensions.maxWidth)),dimensions.hasOwnProperty("percent")&&(conf=setPercent(conf,dimensions.percent,dimensions.maxWidth))),conf},round:function(val,precision){return gamp.round(val,0<precision&&100>precision?precision:5)},getMediaContainerWidth:function(media){return media.$container.innerWidth()}}}),define("css!ui/mediaEditor/plugins/mediaDimension/style",[],function(){}),define("ui/mediaEditor/plugins/mediaDimension/mediaDimensionComponent",["jquery","lodash","ui/component","handlebars","i18n","lib/dompurify/purify","ui/mediaEditor/plugins/mediaDimension/helper","nouislider","ui/tooltip","css!ui/mediaEditor/plugins/mediaDimension/style.css"],function($$1,_,component,Handlebars,__,DOMPurify,helper){'use strict';var _Mathround9=Math.round;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function tpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function mediaDimensionFactory($container,media,config){var calculateCurrentSizes=function(conf){var mediaContainerWidth=helper.getMediaContainerWidth(media);return helper.applyDimensions(conf,{width:mediaContainerWidth<conf.sizeProps.px.natural.width?mediaContainerWidth:conf.sizeProps.px.natural.width,maxWidth:helper.getMediaContainerWidth(media)})},mediaDimensionComponent=component({reset:function(){var syncDim=initialConfig.syncDimensions;return this.is("rendered")&&(initialConfig.sizeProps.px.current.width=media.$node[0].naturalWidth,initialConfig.sizeProps.px.current.height=media.$node[0].naturalHeight,initialConfig.sizeProps.ratio.current=initialConfig.sizeProps.ratio.natural,initialConfig.syncDimensions=!0,initialConfig=calculateCurrentSizes(initialConfig),mediaDimensionComponent.update(),initialConfig.syncDimensions=syncDim,this.trigger("reset",initialConfig)),this},update:function(){$slider.val(initialConfig.sizeProps["%"].current.width),$fields["%"].width.val(_Mathround9(initialConfig.sizeProps["%"].current.width)),$fields.px.width.val(_Mathround9(initialConfig.sizeProps.px.current.width)),$fields.px.height.val(_Mathround9(initialConfig.sizeProps.px.current.height)),this.trigger("change",initialConfig)}},defaultConfig),isInsignificantEnd=function(val){return"string"!=typeof val&&(val+=""),val.match(/\.[0]*$/)},initBlocks=function($elt){var _blocks={},$responsiveToggleField=$elt.find(".media-mode-switch"),checkMode=function(){$responsiveToggleField.is(":checked")?(initialConfig.responsive=!0,_blocks.px.hide(),_blocks["%"].show(),initialConfig.sizeProps.currentUtil="%"):(initialConfig.responsive=!1,_blocks["%"].hide(),_blocks.px.show(),initialConfig.sizeProps.currentUtil="px"),$fields&&($fields["%"].width.val()>$slider.max&&$fields["%"].width.val($slider.max),initialConfig=helper.applyDimensions(initialConfig,{percent:$fields["%"].width.val(),maxWidth:helper.getMediaContainerWidth(media)}),mediaDimensionComponent.update())};return initialConfig.showResponsiveToggle||$elt.addClass("media-sizer-responsivetoggle-off"),_(["px","%"]).forEach(function(unit){_blocks[unit]=$elt.find(".media-sizer-"+("px"===unit?"pixel":"percent")),_blocks[unit].prop("unit",unit),_blocks[unit].find("input").data("unit",unit)}),$responsiveToggleField.on("click",function(){checkMode()}),$responsiveToggleField.prop("checked",initialConfig.responsive),checkMode(),_blocks},initSyncBtn=function($elt){var $mediaSizer=$elt.find(".media-sizer"),$btn=$elt.find(".media-sizer-sync");return initialConfig.showSync||($btn.hide(),$mediaSizer.addClass("media-sizer-sync-off")),$btn.on("click",function(){var $sizerEl=$$1(this).parents(".media-sizer");$sizerEl.toggleClass("media-sizer-synced"),initialConfig.syncDimensions=$sizerEl.hasClass("media-sizer-synced")}),$btn},initResetBtn=function($elt){var $btn=$elt.find(".media-sizer-reset");return initialConfig.showReset||$elt.find(".media-sizer").addClass("media-sizer-reset-off"),$btn.on("click",function(e){return e.preventDefault(),mediaDimensionComponent.reset(),!1}),$btn},initFields=function(){var dimensions=["width","height"],_fields={},field;return _($blocks).forOwn(function($block,unit){_fields[unit]={},$blocks[unit].find("input").each(function(){_(dimensions).forEach(function(dim){field=$blocks[unit].find("[name=\""+dim+"\"]"),_fields[unit][dim]=field.length?field:$$1("<input>"),_fields[unit][dim].prop({unit:unit,dimension:dim}),_fields[unit][dim].val(initialConfig.sizeProps[unit].current[dim]),_fields[unit][dim].on("keydown",function(e){var $field=$$1(this),c=e.keyCode,specChars=function(){var chars=[8,37,39,46];return-1===$field.val().indexOf(".")&&(chars.push(190),chars.push(110)),chars}(),allowed=_.contains(specChars,c)||48<=c&&57>=c||96<=c&&105>=c;return allowed||e.preventDefault(),allowed}),_fields[unit][dim].on("keyup blur sliderchange",function(){var $field=$$1(this),value=$field.val().replace(/,/g,"."),newDimensions;$field.val(value),isInsignificantEnd(value)||(value>$field.data("max")?($field.val($field.data("max")),value=$field.data("max")+""):value<$field.data("min")&&($field.val($field.data("min")),value=$field.data("min")+""),"%"===$field.prop("unit")?(initialConfig.sizeProps["%"].current.width=value,newDimensions={percent:value}):"height"===$field.prop("dimension")?newDimensions={height:value}:newDimensions={width:value},newDimensions.maxWidth=helper.getMediaContainerWidth(media),initialConfig=helper.applyDimensions(initialConfig,newDimensions),mediaDimensionComponent.update())})})})}),_fields},initSlider=function($elt){var slider;return slider=$elt.find(".media-sizer-slider"),slider.prop("unit","%"),slider.noUiSlider({start:initialConfig.sizeProps.slider.start,range:{min:initialConfig.sizeProps.slider.min,max:initialConfig.sizeProps.slider.max}}).on("slide",function(){var percent=parseFloat($$1(this).val()+"");helper.applyDimensions(initialConfig,{percent:percent,maxWidth:helper.getMediaContainerWidth(media)}),mediaDimensionComponent.update()}),slider},$blocks,$slider,$fields,$template,initialConfig;return mediaDimensionComponent.on("init",function(){var mediaProps={px:{current:{width:media.width,height:media.height},natural:{width:media.$node[0].naturalWidth?media.$node[0].naturalWidth:media.width,height:media.$node[0].naturalHeight?media.$node[0].naturalHeight:media.height}},"%":{current:{width:100}}};initialConfig=this.getConfig(),initialConfig.sizeProps=_.defaults(mediaProps,initialConfig.sizeProps,defaultConfig.sizeProps),initialConfig.sizeProps.ratio.natural=helper.round(initialConfig.sizeProps.px.natural.width/initialConfig.sizeProps.px.natural.height,initialConfig.precision),initialConfig.responsive="undefined"==typeof initialConfig.responsive||initialConfig.responsive,initialConfig.sizeProps.currentUtil=initialConfig.responsive?"%":"px",this.render($container)}).on("render",function(){var $mediaSizer;initialConfig=this.getConfig(),$template=$$1(tpl({responsive:initialConfig.responsive})),$template.appendTo(this.getContainer()),$mediaSizer=$template.find(".media-sizer"),!0!==initialConfig.syncDimensions||$mediaSizer.hasClass("media-sizer-synced")||$mediaSizer.addClass("media-sizer-synced"),$blocks=initBlocks($template),$slider=initSlider($template),$fields=initFields(),initSyncBtn($template),initResetBtn($template),"undefined"==typeof media.width?initialConfig=calculateCurrentSizes(initialConfig):initialConfig.responsive?initialConfig=helper.applyDimensions(initialConfig,{percent:media.width,maxWidth:helper.getMediaContainerWidth(media)}):(initialConfig.sizeProps.px.current={width:media.width,height:media.height},initialConfig.sizeProps["%"].current.width=helper.round(100*media.width/helper.getMediaContainerWidth(media),initialConfig.precision)),mediaDimensionComponent.update()}).on("destroy",function(){$template.remove()}),_.defer(function(){mediaDimensionComponent.init(config)}),mediaDimensionComponent}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,component=component&&component.hasOwnProperty("default")?component["default"]:component,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,helper=helper&&helper.hasOwnProperty("default")?helper["default"]:helper,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"media-sizer media-sizer-synced\">\n\n    <div class=\"media-sizer-responsive-toggle\">\n        <label>\n        <input type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.responsive,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"media-mode-switch\"/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Responsive mode",options):helperMissing.call(depth0,"__","Responsive mode",options)))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"warning\"></span>\n\n        <div class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Media resize along with their container, e.g. 50% means half of the container size not half of the media size.",options):helperMissing.call(depth0,"__","Media resize along with their container, e.g. 50% means half of the container size not half of the media size.",options)))+"\n        </div>\n    </div>\n\n\n    <div class=\"media-sizer-percent\">\n        <label for=\"media-sizer-percent-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Size",options):helperMissing.call(depth0,"__","Size",options)))+"</label>\n        <span class=\"item-editor-unit-input-box\" style=\"display:-moz-box;\">\n            <input type=\"text\" name=\"width\" id=\"media-sizer-percent-width\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty;\"/>\n            <span class=\"unit-indicator\">%</span>\n        </span>\n\n        <div class=\"media-sizer-reset media-sizer-reset-percent\" data-unit=\"percent\">\n            <span class=\"icon-reset\"></span>\n        </div>\n\n        <div class=\"media-sizer-slider-box\">\n            <div class=\"media-sizer-slider\"></div>\n        </div>\n    </div>\n\n    <div class=\"media-sizer-pixel\">\n        <div class=\"media-sizer-sync\">\n            <span class=\"icon-link\"></span>\n        </div>\n        <div>\n            <label for=\"media-sizer-pixel-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+"</label>\n            <span class=\"item-editor-unit-input-box\" style=\"display:-moz-box;\">\n                <input type=\"text\" name=\"width\" id=\"media-sizer-pixel-width\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty;\"/>\n                <span class=\"unit-indicator\">px</span>\n            </span>\n            </div>\n        <div>\n            <label for=\"media-sizer-pixel-height\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+"</label>\n            <span class=\"item-editor-unit-input-box\" style=\"display:-moz-box;\">\n                <input type=\"text\" name=\"height\" id=\"media-sizer-pixel-height\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty;\"/>\n                <span class=\"unit-indicator\">px</span>\n            </span>\n        </div>\n        <div class=\"media-sizer-reset media-sizer-reset-pixel\" data-unit=\"pixel\">\n            <span class=\"icon-reset\"></span>\n        </div>\n    </div>\n</div>\n",buffer}),defaultConfig={showResponsiveToggle:!0,showSync:!0,showReset:!0,sizeProps:{px:{current:{width:0,height:0}},"%":{current:{width:0,height:null}},ratio:{natural:1,current:1},currentUtil:"%",slider:{min:1,max:100,start:100}},denyCustomRatio:!1,syncDimensions:!0,width:0,height:0,minWidth:0,maxWidth:0,precision:5};return mediaDimensionFactory}),define("ui/mediaEditor/mediaEditorComponent",["jquery","lodash","ui/component","ui/mediaEditor/plugins/mediaDimension/mediaDimensionComponent","handlebars","i18n","lib/dompurify/purify"],function($$1,_,component,mediaDimensionComponent,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function tpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function mediaEditorFactory($container,media,config){var plugins=[],mediaEditorComponent=component({},defaultConfig);return mediaEditorComponent.setTemplate(tpl).on("init",function(){if(!media||!media.$node||!media.$node.length)throw new Error("mediaEditorComponent requires media.$node");if(!media||!media.$container||!media.$container.length)throw new Error("mediaEditorComponent requires media.$container");this.render($container)}).on("render",function(){var self=this,$dimensionTools=$$1(".media-dimension",this.getTemplate()),plugin;this.getConfig().mediaDimension.active&&(plugin=mediaDimensionComponent($dimensionTools,media,{responsive:media.responsive}).on("change",function(conf){media.responsive=conf.responsive,conf.responsive?(media.width=conf.sizeProps["%"].current.width,media.height=null):(media.width=conf.sizeProps.px.current.width,media.height=conf.sizeProps.px.current.height),self.trigger("change",media)}),plugins.push(plugin))}).on("destroy",function(){_.forEach(plugins,function(plugin){plugin.destroy()})}),_.defer(function(){mediaEditorComponent.init(config)}),mediaEditorComponent}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,component=component&&component.hasOwnProperty("default")?component["default"]:component,mediaDimensionComponent=mediaDimensionComponent&&mediaDimensionComponent.hasOwnProperty("default")?mediaDimensionComponent["default"]:mediaDimensionComponent,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,stack1;return buffer+="<div class=\"media-editor\">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.mediaAlignment,null==stack1||!1===stack1?stack1:stack1.active),{hash:{},inverse:self.noop,fn:self.program(1,function(){return"<div class=\"media-align\"></div>"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.mediaDimension,null==stack1||!1===stack1?stack1:stack1.active),{hash:{},inverse:self.noop,fn:self.program(3,function(){return"<div class=\"media-dimension\"></div>"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n",buffer}),defaultConfig={mediaDimension:{active:!1}};return mediaEditorFactory}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Active",["jquery","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/img","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","taoQtiItem/qtiItem/helper/util","lodash","util/image","ui/mediaEditor/mediaEditorComponent","core/mimetype","ui/resourcemgr","nouislider","ui/tooltip"],function($,__,stateFactory,Active,formTpl,formElement,inlineHelper,itemUtil,_,imageUtil,mediaEditorComponent,mimeType){'use strict';var mediaEditor=null,ImgStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()}),_extractLabel=function(fileName){return fileName.replace(/\.[^.]+$/,"").replace(/^(.*)\//,"").replace(/\W/," ").substr(0,255)};ImgStateActive.prototype.initForm=function(){var _widget=this.widget,$img=_widget.$original,$form=_widget.$form,img=_widget.element,baseUrl=_widget.options.baseUrl;$form.html(formTpl({baseUrl:baseUrl||"",src:img.attr("src"),alt:img.attr("alt")})),_initAdvanced(_widget),_initMediaSizer(_widget),_initAlign(_widget),_initUpload(_widget),formElement.initWidget($form),formElement.setChangeCallbacks($form,img,{src:_.throttle(function(img,value){img.attr("src",value),$img.hasClass("hidden")||$img.addClass("hidden"),$img.attr("src",_widget.getAssetManager().resolve(value)),$img.trigger("contentChange.qti-widget").change(),inlineHelper.togglePlaceholder(_widget),_initAdvanced(_widget),1===img.attr("off-media-editor")?img.removeAttr("off-media-editor"):_initMediaSizer(_widget)},1e3),alt:function alt(img,value){img.attr("alt",value)},longdesc:formElement.getAttributeChangeCallback(),align:function align(img,value){inlineHelper.positionFloat(_widget,value)}})};var _initAlign=function(widget){var align="default";widget.element.hasClass("rgt")?align="right":widget.element.hasClass("lft")&&(align="left"),inlineHelper.positionFloat(widget,align),widget.$form.find("select[name=align]").val(align)},_getMedia=function(imgQtiElement,$imgNode,cb){"undefined"==typeof imgQtiElement.data("responsive")&&(imgQtiElement.attr("width")&&!/[0-9]+%/.test(imgQtiElement.attr("width"))?imgQtiElement.data("responsive",!1):imgQtiElement.data("responsive",!0)),"undefined"!=typeof imgQtiElement.attr("original-width")&&"undefined"!=typeof imgQtiElement.attr("original-height")&&"undefined"!=typeof imgQtiElement.attr("type")&&"undefined"!=typeof imgQtiElement.attr("src")&&"undefined"!=typeof imgQtiElement.attr("width")&&"undefined"!=typeof imgQtiElement.attr("height")?cb({$node:$imgNode,type:imgQtiElement.attr("type"),src:imgQtiElement.attr("src"),width:imgQtiElement.attr("width"),height:imgQtiElement.attr("height"),responsive:imgQtiElement.data("responsive")}):mimeType.getResourceType($imgNode.attr("src"),function(err,type){imgQtiElement.attr("type",type),cb({$node:$imgNode,type:imgQtiElement.attr("type"),src:imgQtiElement.attr("src"),width:imgQtiElement.attr("width"),height:imgQtiElement.attr("height"),responsive:imgQtiElement.data("responsive")})})},_initMediaSizer=function(widget){var img=widget.element,$src=widget.$form.find("input[name=src]"),$mediaResizer=widget.$form.find(".img-resizer"),$mediaSpan=widget.$container,$img=widget.$original;mediaEditor&&mediaEditor.destroy(),$src.val()&&_getMedia(img,$img,function(media){media.$container=$mediaSpan.parents(".widget-box"),mediaEditor=mediaEditorComponent($mediaResizer,media,{mediaDimension:{active:!0}}).on("change",function(nMedia){media=nMedia,$img.prop("style",null),$img.removeAttr("style"),img.data("responsive",media.responsive),_(["width","height"]).each(function(sizeAttr){var val;""===media[sizeAttr]||"undefined"==typeof media[sizeAttr]||null===media[sizeAttr]?(img.removeAttr(sizeAttr),$mediaSpan.css(sizeAttr,"")):(val=Math.round(media[sizeAttr]),media.responsive?(val+="%",img.attr(sizeAttr,val),$img.attr(sizeAttr,"100%")):img.attr(sizeAttr,val),$mediaSpan.css(sizeAttr,val)),widget.$container.trigger("contentChange.qti-widget")}),$img.removeClass("hidden")})})},_initAdvanced=function(widget){var $form=widget.$form,src=widget.element.attr("src");src?$form.find("[data-role=advanced]").show():$form.find("[data-role=advanced]").hide()},_initUpload=function(widget){var $form=widget.$form,options=widget.options,img=widget.element,$uploadTrigger=$form.find("[data-role=\"upload-trigger\"]"),$src=$form.find("input[name=src]"),$alt=$form.find("input[name=alt]"),_openResourceMgr=function(){$uploadTrigger.resourcemgr({title:__("Please select an image file from the resource manager. You can add files from your computer with the button \"Add file(s)\"."),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:[{mime:"image/jpeg"},{mime:"image/png"},{mime:"image/gif"},{mime:"image/svg+xml"},{mime:"application/x-gzip",extension:"svgz"}]},pathParam:"path",select:function select(e,files){var file,alt,confirmBox,cancel,save;files&&files.length&&(file=files[0].file,alt=files[0].alt,$src.val(file),""===$.trim($alt.val())?(""===alt&&(alt=_extractLabel(file)),img.attr("alt",alt),$alt.val(alt).trigger("change")):(confirmBox=$(".change-alt-modal-feedback",$form),cancel=confirmBox.find(".cancel"),save=confirmBox.find(".save"),$(".alt-text",confirmBox).html("\""+$alt.val()+"\"<br>with<br>\""+alt+"\" ?"),confirmBox.modal({width:500}),save.off("click").on("click",function(){img.attr("alt",alt),$alt.val(alt).trigger("change"),confirmBox.modal("close")}),cancel.off("click").on("click",function(){confirmBox.modal("close")})),_.defer(function(){img.attr("off-media-editor",1),$src.trigger("change")}))},open:function open(){$src.data("$tooltip")&&$src.blur().data("$tooltip").hide()},close:function close(){$src.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$src.val()||_openResourceMgr()};return ImgStateActive}),define("taoQtiItem/qtiCreator/widgets/static/img/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/img/states/Sleep","taoQtiItem/qtiCreator/widgets/static/img/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/helpers/widget",["jquery","lodash"],function($,_){'use strict';return{buildInlineContainer:function buildInlineContainer(widget){var float="",$wrap;widget.element.hasClass("lft")?float=" lft":widget.element.hasClass("rgt")&&(float=" rgt"),$wrap=$("<span>",{"data-serial":widget.element.serial,class:"widget-box widget-inline widget-"+widget.element.qtiClass+float,"data-qti-class":widget.element.qtiClass,contenteditable:"false"}),widget.$container=widget.$original.wrap($wrap).parent()},buildBlockContainer:function buildBlockContainer(widget){var $wrap=$("<div>",{"data-serial":widget.element.serial,class:"widget-box widget-block widget-"+widget.element.qtiClass,"data-qti-class":widget.element.qtiClass});widget.$container=widget.$original.wrap($wrap).parent()},createToolbar:function createToolbar(widget,toolbarTpl){var $tlb;if(_.isFunction(toolbarTpl))$tlb=$(toolbarTpl({serial:widget.serial,state:"active"})),widget.$container.append($tlb),$tlb.find("[data-role=\"delete\"]").on("click.widget-box",function(e){e.stopPropagation(),widget.changeState("deleting")});else throw new Error("the toolbarTpl must be a handlebars function")}}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/media",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"mini-tlb\" data-edit=\"",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"rgt tlb-button\" title=\"Delete\" data-role=\"delete\">\n        <span class=\"icon-bin\"></span>\n    </span>\n</span>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/img/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/img/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,Widget,states,helper,toolbarTpl,inlineHelper){'use strict';var ImgWidget=Widget.clone();return ImgWidget.initCreator=function(options){var self=this,img=this.element;this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this),inlineHelper.checkFileExists(this,"src",options.baseUrl),$("#item-editor-scope").on("filedelete.resourcemgr."+this.element.serial,function(e,src){self.getAssetManager().resolve(img.attr("src"))===self.getAssetManager().resolve(src)&&(img.attr("src",""),inlineHelper.togglePlaceholder(self))})},ImgWidget.destroy=function(){$("#item-editor-scope").off("."+this.element.serial)},ImgWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager","assetManager"]},ImgWidget.buildContainer=function(){return helper.buildInlineContainer(this),this.$container.css({width:this.element.attr("width"),height:this.element.attr("height")}),this.$original[0]&&(this.$original[0].setAttribute("width","100%"),this.$original[0].removeAttribute("height")),this},ImgWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},ImgWidget}),define("taoQtiItem/qtiCreator/renderers/Img",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Img","taoQtiItem/qtiCreator/widgets/static/img/Widget"],function(_,Renderer,Widget){'use strict';var CreatorImg=_.clone(Renderer);return CreatorImg.render=function(img,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),Widget.build(img,Renderer.getContainer(img),this.getOption("bodyElementOptionForm"),options)},CreatorImg}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"href\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the shared stimulus.",options):helperMissing.call(depth0,"__","The file path to the shared stimulus.",options)))+"</div>\n    <input type=\"text\" name=\"href\" value=\"",(helper=helpers.href)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.href,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty;\" readonly/>\n    <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select shared stimulus",options):helperMissing.call(depth0,"__","Select shared stimulus",options)))+"</button>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/include/states/Active",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/include","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/helper/xincludeRenderer","ui/resourcemgr","ui/tooltip"],function($,_,__,stateFactory,Active,formTpl,formElement,xincludeRenderer){'use strict';var IncludeStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()});IncludeStateActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,include=_widget.element,baseUrl=_widget.options.baseUrl;$form.html(formTpl({baseUrl:baseUrl||"",href:include.attr("href")})),_initUpload(_widget),formElement.initWidget($form)};var _initUpload=function(widget){var $form=widget.$form,options=widget.options,$uploadTrigger=$form.find("[data-role=\"upload-trigger\"]"),$href=$form.find("input[name=href]"),_openResourceMgr=function(){$uploadTrigger.resourcemgr({title:__("Please select a shared stimulus file from the resource manager."),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl+"?exclude=local",browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,disableUpload:!0,params:{uri:options.uri,lang:options.lang,filters:"application/qti+xml"},pathParam:"path",select:function select(e,files){var file;files&&files.length&&(file=files[0].file,$href.val(file),xincludeRenderer.render(widget,options.baseUrl,file),_.defer(function(){$href.trigger("change")}))},open:function open(){$href.data("$tooltip")&&$href.blur().data("$tooltip").hide()},close:function close(){$href.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$href.on("click",_openResourceMgr),$href.val()||_openResourceMgr()};return IncludeStateActive}),define("taoQtiItem/qtiCreator/widgets/static/include/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/include/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/include/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/include/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,Widget,states,helper,toolbarTpl,inlineHelper){'use strict';var IncludeWidget=Widget.clone();return IncludeWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},IncludeWidget.destroy=function(){$("#item-editor-scope").off("."+this.element.serial)},IncludeWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},IncludeWidget.buildContainer=function(){return helper.buildBlockContainer(this),this.$container.css({width:this.element.attr("width"),height:this.element.attr("height")}),this.$original.removeAttr("data-serial"),this.$original[0].setAttribute("width","100%"),this.$original[0].setAttribute("height","100%"),this},IncludeWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},IncludeWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"qti-include\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("taoQtiItem/qtiCreator/renderers/Include",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Include","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCreator/widgets/static/include/Widget","tpl!taoQtiItem/qtiCreator/tpl/include"],function(_,Renderer,containerHelper,Widget,tpl){'use strict';var CreatorXInclude=_.clone(Renderer);return CreatorXInclude.template=tpl,CreatorXInclude.getContainer=containerHelper.get,CreatorXInclude.render=function(include,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),Widget.build(include,containerHelper.get(include),this.getOption("bodyElementOptionForm"),options)},CreatorXInclude}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"common-tlb\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"tlb-button\" title=\"move\" data-role=\"move\">\n        <span class=\"icon-grip\"></span>\n    </span>\n</span>",buffer})}),define("taoQtiItem/qtiCreator/widgets/helpers/movable",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/draggable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip"],function($,draggable,gripTpl){return{create:function create(widget){var item=widget.element.getRootElement(),$container=widget.$container,$grip=$(gripTpl({serial:widget.serial})),$itemBody;$container.append($grip),$grip.on("mouseenter.qti-widget",function(){$itemBody&&$itemBody.length||($itemBody=item.data("widget").$container),draggable.createMovable($container,$itemBody)}).on("mouseleave.qti-widget",function(){draggable.destroy($container)})}}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",helper,options;return buffer+="\n        <div class=\"state-switcher\">\n            <span class=\"selected\" data-state=\"question\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Question",options):helperMissing.call(depth0,"__","Question",options)))+"</span>\n            <span class=\"separator\"> | </span>\n            <span class=\"link\" data-state=\"answer\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response",options):helperMissing.call(depth0,"__","Response",options)))+"</span>\n        </div>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"tlb-wrapper\" style=\"\" data-edit=\"active\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span class=\"tlb-title\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <div class=\"tlb\">\n        <div class=\"rgt tlb-button\" data-role=\"delete\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"delete",options):helperMissing.call(depth0,"__","delete",options)))+"\">\n            <span class=\"icon-bin\"></span>\n        </div>\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.switcher,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<button class=\"btn-info small widget-ok\" data-edit=\"active\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"done",options):helperMissing.call(depth0,"__","done",options)))+"</button>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/Widget",["lodash","jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/helpers/movable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton"],function(_,$,Widget,movable,toolbarTpl,okButtonTpl){function _convertToTitle(str){return str=str.replace(/[A-Z]/g,function(match){return" "+match.toUpperCase()}),str.charAt(0).toUpperCase()+str.substr(1)}var InteractionWidget=Widget.clone();return InteractionWidget.init=function(element,$container,$form,$responseForm,options){return Widget.init.call(this,element,$container,$form,options),this.$responseForm=$responseForm,this},InteractionWidget.build=function(element,$container,$form,$responseForm,options){return this.clone().init(element,$container,$form,$responseForm,options)},InteractionWidget.initCreator=function(){Widget.initCreator.call(this),this.createToolbar({}),this.createOkButton(),this.listenToChoiceStates()},InteractionWidget.buildContainer=function(){var $wrap=$("<div>",{"data-serial":this.element.serial,class:"widget-box widget-blockInteraction clearfix","data-qti-class":this.element.qtiClass}),$interactionContainer=this.$original.wrap($wrap);return this.$container=$interactionContainer.parent(),this},InteractionWidget.createToolbar=function(options){options=_.defaults(options||{},{title:_convertToTitle(this.element.qtiClass)});var _this=this,$toolbar;return $toolbar=$(toolbarTpl({title:options.title,serial:this.element.serial,switcher:!!this.registeredStates.answer})),this.$container.append($toolbar),$toolbar.hide(),$toolbar.find("[data-role=\"delete\"]").click(function(e){e.stopPropagation(),_this.changeState("deleting")}),this.registeredStates.answer&&($toolbar.on("click",".link",function(){var $link=$(this),state=$link.data("state");$link.siblings(".selected").removeClass("selected").addClass("link"),$link.removeClass("link").addClass("selected"),_this.changeState(state)}),this.beforeStateInit(function(e,element,state){if(element.getSerial()===_this.serial){var $link=$toolbar.find(".link[data-state=\""+state.name+"\"]");$link.length&&($link.siblings(".selected").removeClass("selected").addClass("link"),$link.removeClass("link").addClass("selected"))}})),this},InteractionWidget.createOkButton=function(){var _this=this,$ok=$(okButtonTpl()).on("click.qti-widget",function(e){e.stopPropagation(),_this.changeState("sleep")});this.$container.append($ok)},InteractionWidget.listenToChoiceStates=function(){var _this=this;this.afterStateInit(function(e,element,state){var currentState=_this.getCurrentState();if(element.is("choice")&&_this.element.getChoice(element.getSerial())&&currentState&&state.name!==currentState.name)switch(state.name){case"choice":_this.changeState(state.name);}})},InteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,SleepState){var InteractionStateSleep=stateFactory.extend(SleepState,function(){var _widget=this.widget;_widget.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),_widget.changeState("question")})},function(){var _widget=this.widget;_widget.$container.off(".sleep")});return InteractionStateSleep}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","lodash"],function(stateFactory,Active,_){var _containsInModalFeedbackElts=function(response,searchSerial){var found=!1,modalFeedbacks=[];return _.each(response.feedbackRules,function(rule){rule.feedbackThen&&"modalFeedback"===rule.feedbackThen.qtiClass&&modalFeedbacks.push(rule.feedbackThen),rule.feedbackElse&&"modalFeedback"===rule.feedbackElse.qtiClass&&modalFeedbacks.push(rule.feedbackElse)}),_.each(modalFeedbacks,function(fb){var elt=fb.getBody().getElement(searchSerial);if(elt)return found=!0,!1}),found},InteractionStateActive=stateFactory.extend(Active,function(){var _widget=this.widget,$container=_widget.$container,interaction=_widget.element,response=interaction.getResponseDeclaration();$container.attr("contenteditable",!1),_widget.beforeStateInit(function(e,element,state){var serial=element.getSerial();if("modalFeedback"===element.qtiClass)return!1;if("active"===state.name&&serial!==_widget.serial){var composingElts=interaction.getComposingElements(),inModalFeedback=_containsInModalFeedbackElts(response,serial);composingElts[serial]||inModalFeedback||_widget.changeState("sleep")}},"otherActive"),$container.on("mouseenter.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseenter.sleep")}).on("click.active",function(e){e.stopPropagation()})},function(){this.widget.offEvents("otherActive")});return InteractionStateActive}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<li class=\"add-option\" data-edit=\"question\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"add-option\">\n    <span class=\"icon-add\"></span>\n    ",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</li>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice","i18n"],function($,stateFactory,Question,addChoiceTpl,__){var InteractionStateQuestion=stateFactory.create(Question,function(){this.initForm(),this.widget.$form.show(),this.addNewChoiceButton(this.widget)},function(){this.widget.$form.empty().hide()});return InteractionStateQuestion.prototype.addNewChoiceButton=function(){var widget=this.widget,$choiceArea=widget.$container.find(".choice-area"),interaction=widget.element;$choiceArea.length&&!$choiceArea.children(".add-option").length&&($choiceArea.append(addChoiceTpl({serial:this.serial,text:__("Add choice")})),$choiceArea.children(".add-option").show().on("click.qti-widget",function(e){e.stopPropagation();var choice=interaction.createChoice(),$newChoicePlaceholder=$("<li>"),qtiChoiceClassName=choice.qtiClass+"."+interaction.qtiClass,tplData={interaction:{serial:interaction.serial,attributes:interaction.attributes}};$(this).before($newChoicePlaceholder),choice.render(tplData,$newChoicePlaceholder,qtiChoiceClassName),choice.postRender({ready:function ready(widget){widget.changeState("choice")}},qtiChoiceClassName)}))},InteractionStateQuestion.prototype.initForm=function(){stateFactory.throwMissingRequiredImplementationError("initForm")},InteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Choice",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/helpers/content"],function($,stateFactory,Choice,contentHelper){var InteractionStateChoice=stateFactory.create(Choice,function(){var _widget=this.widget;_widget.$container.on("click.choice",function(e){$(e.target).closest(".qti-choice").length||_widget.changeState("question")}),contentHelper.changeInnerWidgetState(this.widget,"sleep")},function(){this.widget.$container.off(".choice")});return InteractionStateChoice}),define("tpl!taoQtiItem/qtiCreator/widgets/component/minMax/minMax",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="\n            <label>\n                <input type=\"checkbox\" name=\""+escapeExpression((stack1=(stack1=depth0&&depth0.min,null==stack1||!1===stack1?stack1:stack1.fieldName),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"-toggler\"  />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        ",buffer}function program3(depth0){var buffer="",stack1;return buffer+="\n            <label>\n                <input type=\"checkbox\" name=\""+escapeExpression((stack1=(stack1=depth0&&depth0.max,null==stack1||!1===stack1?stack1:stack1.fieldName),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"-toggler\" />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,stack1,helper,options;return buffer+="<div class=\"min-max\">\n    <div>\n        <label for=\""+escapeExpression((stack1=(stack1=depth0&&depth0.min,null==stack1||!1===stack1?stack1:stack1.fieldName),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" class=\"spinner\" >"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+"</label>\n\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.min,null==stack1||!1===stack1?stack1:stack1.toggler),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <input\n            type=\"text\"\n            name=\""+escapeExpression((stack1=(stack1=depth0&&depth0.min,null==stack1||!1===stack1?stack1:stack1.fieldName),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"\n            value=\""+escapeExpression((stack1=(stack1=depth0&&depth0.min,null==stack1||!1===stack1?stack1:stack1.value),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"\n            data-increment=\"1\"\n            data-min=\"",(helper=helpers.lowerThreshold)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.lowerThreshold,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n            data-max=\"",(helper=helpers.upperThreshold)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperThreshold,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n        />\n\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">"+escapeExpression((stack1=(stack1=depth0&&depth0.min,null==stack1||!1===stack1?stack1:stack1.helpMessage),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</span>\n    </div>\n    <div>\n        <label for=\""+escapeExpression((stack1=(stack1=depth0&&depth0.max,null==stack1||!1===stack1?stack1:stack1.fieldName),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" class=\"spinner\" >"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+"</label>\n\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.max,null==stack1||!1===stack1?stack1:stack1.toggler),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <input\n            type=\"text\"\n            name=\""+escapeExpression((stack1=(stack1=depth0&&depth0.max,null==stack1||!1===stack1?stack1:stack1.fieldName),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"\n            value=\""+escapeExpression((stack1=(stack1=depth0&&depth0.max,null==stack1||!1===stack1?stack1:stack1.value),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"\n            data-increment=\"1\"\n            data-min=\"",(helper=helpers.lowerThreshold)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.lowerThreshold,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n            data-max=\"",(helper=helpers.upperThreshold)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperThreshold,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n        />\n\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">"+escapeExpression((stack1=(stack1=depth0&&depth0.max,null==stack1||!1===stack1?stack1:stack1.helpMessage),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/component/minMax/minMax",["jquery","lodash","i18n","ui/component","ui/incrementer","ui/tooltip","tpl!taoQtiItem/qtiCreator/widgets/component/minMax/minMax"],function($,_,__,component,incrementer,tooltip,minMaxTpl){'use strict';var _Mathmax13=Math.max,defaultConfig={min:{fieldName:"minChoices",value:0,toggler:!0,helpMessage:__("The minimum number of choices that the candidate is required to select to form a valid response.")},max:{fieldName:"maxChoices",value:0,toggler:!0,helpMessage:__("The maximum number of choices that the candidate is required to select to form a valid response.")},lowerThreshold:1,upperThreshold:4,syncValues:!0};return function(container,setUpConfig){var controls={min:{},max:{}},fields={min:"min",max:"max"},isFieldSupported=function(field){if(!_.contains(fields,field))throw new TypeError("Unknown field \""+field+"\". Please set \"min\" or \"max\"");return!0},minMax=component({getFields:function(){return fields},getValue:function(field){var config=this.getConfig();if(isFieldSupported(field))return this.is("rendered")?_.parseInt(controls[field].input.val()):config[field].value},getMinValue:function(){return this.getValue(fields.min)},getMaxValue:function(){return this.getValue(fields.max)},setValue:function(field,value){var config=this.getConfig(),intValue=_.parseInt(value);if(isFieldSupported(field)&&_.isNumber(intValue)&&intValue>=config.lowerThreshold&&intValue<=config.upperThreshold){if(this.is("rendered")&&controls[field].input.val()!==intValue)return controls[field].input.val(intValue).trigger("change");config[field].value=intValue}return this},setMinValue:function(value){return this.setValue(fields.min,value)},setMaxValue:function(value){return this.setValue(fields.max,value)},updateThresholds:function(lower,upper){var config=this.getConfig(),fieldOptions;return _.isNumber(lower)&&_.isNumber(upper)&&upper>lower&&(config.lowerThreshold=_.parseInt(lower),config.upperThreshold=_.parseInt(upper),this.is("rendered")&&(fieldOptions={min:config.lowerThreshold,max:config.upperThreshold},controls.min.input.incrementer("options",fieldOptions),this.isFieldEnabled("min")&&controls.min.input.keyup(),controls.max.input.incrementer("options",fieldOptions),this.isFieldEnabled("max")&&controls.max.input.keyup())),this},isFieldEnabled:function(field){var config=this.getConfig();return!!isFieldSupported(field)&&(!0!==config[field].toggler||0<this.getValue(field))},enableField:function(field,initialValue){return isFieldSupported(field)&&this.is("rendered")&&!this.isFieldEnabled(field)&&(controls[field].input.val(1<initialValue?initialValue:1).incrementer("enable").trigger("change"),this.trigger("enable"+field),this.syncValues()),this},disableField:function(field){var config=this.getConfig();return isFieldSupported(field)&&this.is("rendered")&&!0===config[field].toggler&&this.isFieldEnabled(field)&&(controls[field].input.val(0).incrementer("disable").trigger("change"),this.trigger("disable"+field)),this},syncValues:function(fromField){var config=this.getConfig(),minValue,maxValue;return fromField=fromField||fields.min,isFieldSupported(fromField)&&this.is("rendered")&&config.syncValues&&(minValue=this.getMinValue(),maxValue=this.getMaxValue(),0<minValue&&0<maxValue&&(fromField===fields.max&&minValue>maxValue&&this.setMinValue(maxValue),fromField===fields.min&&minValue>maxValue&&this.setMaxValue(minValue))),this}},defaultConfig).setTemplate(minMaxTpl).on("init",function(){container&&this.render(container)}).on("render",function(){var self=this,$element=this.getElement(),config=this.getConfig(),setUpFieldListener=function(field){var fieldConfig,fieldControl;isFieldSupported(field)&&(fieldConfig=config[field],fieldControl=controls[field],fieldControl.input=$("[name="+fieldConfig.fieldName+"]",$element),fieldConfig.toggler&&(fieldControl.toggler=$("[name="+fieldConfig.fieldName+"-toggler]",$element),0<fieldConfig.value?fieldControl.toggler.prop("checked",!0):self.disableField(field),fieldControl.toggler.on("change",function(){$(this).prop("checked")?self.enableField(field,_Mathmax13(1,self.getMinValue())):self.disableField(field),self.trigger("change")})),fieldControl.input.on("change",function(){self.syncValues(field),self.trigger("change")}))};incrementer($element),tooltip.lookup($element),setUpFieldListener(fields.min),setUpFieldListener(fields.max),this.syncValues()});return _.defer(function(){var deepConfig=_.cloneDeep(setUpConfig||{});deepConfig.min&&(deepConfig.min=_.defaults(setUpConfig.min,defaultConfig.min)),deepConfig.max&&(deepConfig.max=_.defaults(setUpConfig.max,defaultConfig.max)),minMax.init(deepConfig)}),minMax}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1;return buffer+="\n        <option value=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">"+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"</option>\n        ",buffer}function program3(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n<hr/>\n\n<div class=\"response-mapping-attributes",stack1=helpers["if"].call(depth0,depth0&&depth0.mappingDisabled,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n    <div class=\"panel min-max-panel\" data-editx=\"map\">\n        <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Score range",options):helperMissing.call(depth0,"__","Score range",options)))+"</h3>\n    </div>\n\n    <div class=\"panel\" data-editx=\"map\">\n        <label for=\"defaultValue\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Mapping default",options):helperMissing.call(depth0,"__","Mapping default",options)))+"</label>\n        <input name=\"defaultValue\" value=\"",(helper=helpers.defaultValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.defaultValue,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,depth0&&depth0.mappingDisabled,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"score\" type=\"text\" data-validate=\"$notEmpty; $numeric;\" data-validate-option=\"$lazy; $event(type=keyup)\" />\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The default value from the target set to be used when no explicit mapping for a source value is given.",options):helperMissing.call(depth0,"__","The default value from the target set to be used when no explicit mapping for a source value is given.",options)))+"</span>\n    </div>\n</div>\n<div class=\"response-mapping-info",stack1=helpers.unless.call(depth0,depth0&&depth0.mappingDisabled,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n    <p class=\"feedback-info\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The mapping options are available when at least one map entry is defined.",options):helperMissing.call(depth0,"__","The mapping options are available when at least one map entry is defined.",options)))+"</p>\n</div>\n\n<div class=\"panel\" data-editx=\"map\">\n    <label>\n        <input name=\"defineCorrect\" type=\"checkbox\" data-role=\"defineCorrect\"",stack1=helpers["if"].call(depth0,depth0&&depth0.defineCorrect,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define correct response",options):helperMissing.call(depth0,"__","Define correct response",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define the correct response.",options):helperMissing.call(depth0,"__","Define the correct response.",options)))+"</span>\n</div>\n",buffer}function program4(){return" hidden"}function program6(){return" disabled=\"true\""}function program8(){return" checked=\"checked\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response identifier",options):helperMissing.call(depth0,"__","Response identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n           name=\"identifier\"\n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n           placeholder=\"e.g. RESPONSE\"\n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n\n<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response processing",options):helperMissing.call(depth0,"__","Response processing",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select the way the response of your interaction should be processed",options):helperMissing.call(depth0,"__","Select the way the response of your interaction should be processed",options)))+"</div>\n\n    <select name=\"template\" class=\"select2\" data-has-search=\"false\">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.templates,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.editMapping,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.editFeedbacks,{hash:{},inverse:self.noop,fn:self.program(10,function(){return"\n<hr/>\n\n<div class=\"panel feedbackRule-panel\"></div>\n"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data,depth1){var buffer="",stack1,helper,options;return buffer+="\n            <option value=\"",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=(helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data},helper?helper.call(depth0,depth0&&depth0.name,depth1&&depth1.condition,options):helperMissing.call(depth0,"equal",depth0&&depth0.name,depth1&&depth1.condition,options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n            ",buffer}function program2(){return"selected=\"selected\""}function program6(depth0,data){var buffer="",helper,options;return buffer+="\n    <a title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add else feedback",options):helperMissing.call(depth0,"__","Add else feedback",options)))+"\" href=\"#\" class=\"adder feedbackRule-add-else\">else</a>\n    ",buffer}function program8(depth0,data){var buffer="",helper,options;return buffer+="\n     <div class=\"feedbackRule-then-else\">\n            <span class=\"feedbackRule-desc i\">else</span>\n            <button class=\"btn-info small\" type=\"button\" data-feedback=\"else\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Feedback",options):helperMissing.call(depth0,"__","Feedback",options)))+"</button>\n            <span class=\"feedbackRule-button-delete icon-bin\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Delete else statement",options):helperMissing.call(depth0,"__","Delete else statement",options)))+"\" data-role=\"else\"></span>\n        </div>\n    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"feedbackRule-container\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"feedbackRule-rule-if\">\n        <span class=\"feedbackRule-desc i\">if</span>\n        <select class=\"feedbackRule-condition select2\" data-has-search=\"false\">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.availableConditions,{hash:{},inverse:self.noop,fn:self.programWithDepth(1,program1,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </select>\n        <input class=\"feedbackRule-compared-value score\" type=\"text\" value=\"",(helper=helpers.comparedValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.comparedValue,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.hideScore,{hash:{},inverse:self.noop,fn:self.program(4,function(){return"style=\"display:none\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n    </div>\n    <div class=\"feedbackRule-then-else\">\n        <span class=\"feedbackRule-desc i\">then</span>\n        <button class=\"btn-info small\" type=\"button\" data-feedback=\"then\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Feedback",options):helperMissing.call(depth0,"__","Feedback",options)))+"</button>\n    </div>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.addElse,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.feedbackElse,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <span class=\"feedbackRule-button-delete icon-bin\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Delete this modal feedback",options):helperMissing.call(depth0,"__","Delete this modal feedback",options)))+"\" data-role=\"rule\"></span>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<h3 class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Modal Feedbacks",options):helperMissing.call(depth0,"__","Modal Feedbacks",options)))+"</h3>\n<span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n<span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Modal feedback is shown to the candidate directly following response processing.",options):helperMissing.call(depth0,"__","Modal feedback is shown to the candidate directly following response processing.",options)))+"</span>\n<div class=\"feedbackRules\">\n    <p><i>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"None defined yet.",options):helperMissing.call(depth0,"__","None defined yet.",options)))+"</i></p>\n</div>\n<a href=\"#\" class=\"adder feedbackRule-add\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add a modal feedback",options):helperMissing.call(depth0,"__","Add a modal feedback",options)))+"</a>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/core/Element","ui/tooltip"],function($,_,__,formElement,Element,tooltip){'use strict';var _scoreTooltipContent={required:__("This is required"),invalid:__("The score format is not numeric")};return{init:function(widget){formElement.initWidget(widget.$form)},syncMaxChoices:function(widget,attributeNameMin,attributeNameMax,getMax){var _syncMaxChoices=function(){var newOptions={max:getMax(widget.element.getChoices())};$min.incrementer("options",newOptions).keyup(),$max.incrementer("options",newOptions).keyup()},$min,$max;attributeNameMin=attributeNameMin||"minChoices",attributeNameMax=attributeNameMax||"maxChoices",getMax=getMax||_.size,$min=widget.$form.find("input[name="+attributeNameMin+"]"),$max=widget.$form.find("input[name="+attributeNameMax+"]"),widget.on("choiceCreated",function(data){data.interaction.serial===widget.element.serial&&_syncMaxChoices()}).on("deleted",function(data){data.parent.serial===widget.element.serial&&Element.isA(data.element,"choice")&&_syncMaxChoices()})},setScore:function($scoreInput,options){var value,score,key,formElementTooltip;options=_.defaults(options||{},{required:!1,empty:function empty(){},set:function set(){},key:function(){return $(this).attr("name")},tooltipContent:_scoreTooltipContent}),"undefined"==typeof $scoreInput.data("$tooltip")&&(formElementTooltip=tooltip.error($scoreInput," ",{trigger:"manual"}),$scoreInput.data("$tooltip",formElementTooltip)),value=$scoreInput.val(),score=parseFloat(value),key=options.key.call($scoreInput[0]),""===value?options.required?($scoreInput.data("$tooltip").updateTitleContent(options.tooltipContent.required),$scoreInput.data("$tooltip").show()):($scoreInput.data("$tooltip").hide(),options.empty(key)):isNaN(score)?($scoreInput.data("$tooltip").updateTitleContent(options.tooltipContent.invalid),$scoreInput.data("$tooltip").show()):($scoreInput.data("$tooltip").hide(),options.set(key,score))}}}),define("taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackConditions",["lodash","i18n","jquery","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/editor/response/choiceSelector"],function(_,__,$,formElement,choiceSelector){'use strict';function _resetScore(fbRule,$select){$select.siblings(".feedbackRule-compared-value").val("0")}function onSetScore(fbRule,$select){var response=fbRule.comparedOutcome,condition=this.name,$comparedValue=$select.siblings(".feedbackRule-compared-value");formElement.setScore($comparedValue,{required:!0,set:function set(key,value){response.setCondition(fbRule,condition,value)}})}function onUnsetCorrect(fbRule,$select){_resetScore(fbRule,$select)}function initCompare(fbRule,$select){var response=fbRule.comparedOutcome;$select.siblings(".feedbackRule-compared-value").show().off("keyup.modal-feedback-condition").on("keyup.modal-feedback-condition",".feedbackRule-compared-value",function(){var fbRule=response.getFeedbackRule($(this).parents(".feedbackRule-container").data("serial"));formElement.setScore($(this),{required:!0,set:function set(key,value){response.setCondition(fbRule,fbRule.condition,value)}})})}function hideScore(fbRule,$select){$select.siblings(".feedbackRule-compared-value").hide()}var _availableConditions=[{name:"correct",label:__("correct"),init:hideScore,onSet:onSetScore,onUnset:onUnsetCorrect},{name:"incorrect",label:__("incorrect"),init:hideScore,onSet:onSetScore,onUnset:onUnsetCorrect},{name:"choices",label:__("choices"),init:function(fbRule,$select){hideScore(fbRule,$select);var condition=this.name,response=fbRule.comparedOutcome,interaction=response.getInteraction(),$choiceSelectorContainer=$("<div>",{class:"choiceSelectorContainer"}).insertAfter($select),cSelector=choiceSelector({renderTo:$choiceSelectorContainer,interaction:interaction,choices:fbRule.comparedValue||[],titleLength:30});$choiceSelectorContainer.data("choice-selector",cSelector),cSelector.on("change",function(selectedChoices){response.setCondition(fbRule,condition,selectedChoices||[])})},onSet:function(fbRule){var response=fbRule.comparedOutcome,interaction=response.getInteraction(),intialValue=[],choice;response.isCardinality(["multiple","ordered"])||(choice=_.head(_.values(interaction.getChoices())),choice&&(intialValue=[choice])),fbRule.comparedOutcome.setCondition(fbRule,this.name,intialValue)},onUnset:function(fbRule,$select){_resetScore(fbRule,$select),this.destroy($select)},destroy:function destroy($select){var $cContainer=$select.next(".choiceSelectorContainer"),choiceSelector=$cContainer.data("choice-selector");choiceSelector&&(choiceSelector.destroy(),$cContainer.remove())},filter:function(response){var interaction=response.getInteraction();return interaction.is("choiceInteraction")||interaction.is("inlineChoiceInteraction")}},{name:"lt",label:"<",init:initCompare,onSet:onSetScore},{name:"lte",label:"<=",init:initCompare,onSet:onSetScore},{name:"equal",label:"=",init:initCompare,onSet:onSetScore},{name:"gte",label:">=",init:initCompare,onSet:onSetScore},{name:"gt",label:">",init:initCompare,onSet:onSetScore}];return{get:function(response){return _.filter(_availableConditions,function(condition){return!_.isFunction(condition.filter)||condition.filter(response)})}}}),define("taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule",["lodash","jquery","ui/selecter","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel","taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackConditions"],function(_,$,selecter,ruleTpl,panelTpl,modalFeedbackConditions){'use strict';var _renderFeedbackRule=function(feedbackRule){var feedbackElse=feedbackRule.feedbackElse,feedbackElseSerial;feedbackElse&&(feedbackElseSerial=feedbackElse.serial);var availableConditions=modalFeedbackConditions.get(feedbackRule.comparedOutcome),rule=ruleTpl({availableConditions:availableConditions,serial:feedbackRule.serial,condition:feedbackRule.condition,comparedValue:feedbackRule.comparedValue,feedbackThen:feedbackRule.feedbackThen.serial,feedbackElse:feedbackElseSerial,addElse:!feedbackElse,hideScore:"correct"===feedbackRule.condition||"incorrect"===feedbackRule.condition||"choices"===feedbackRule.condition}),$rule=$(rule);selecter($rule);var condition=_.find(availableConditions,{name:feedbackRule.condition});return condition.init(feedbackRule,$rule.find("select.feedbackRule-condition")),$rule},_initFeedbackEventListener=function($feedbacksPanel,response){var $feedbacks=$feedbacksPanel.find(".feedbackRules");$feedbacksPanel.on("click",".feedbackRule-add",function(e){e.preventDefault();var feedbackRule=response.createFeedbackRule(),$lastRule=$feedbacks.children(".feedbackRule-container:last");$lastRule.length?$lastRule.after(_renderFeedbackRule(feedbackRule)):$feedbacks.html(_renderFeedbackRule(feedbackRule))}).on("click",".feedbackRule-add-else",function(e){e.preventDefault();var $fbContainer=$(this).parents(".feedbackRule-container"),fbSerial=$fbContainer.data("serial"),fbRule=response.getFeedbackRule(fbSerial),fbModal=response.createFeedbackElse(fbRule);$fbContainer.replaceWith(_renderFeedbackRule(fbRule))}).on("click",".feedbackRule-button-delete",function(){var $deleteButton=$(this),$fbContainer=$deleteButton.parents(".feedbackRule-container"),fbSerial=$fbContainer.data("serial"),fbRule=response.getFeedbackRule(fbSerial);switch($deleteButton.data("role")){case"rule":response.deleteFeedbackRule(fbRule),$fbContainer.remove();break;case"else":response.deleteFeedbackElse(fbRule),$fbContainer.replaceWith(_renderFeedbackRule(fbRule));}}).on("change",".feedbackRule-condition",function(){var $select=$(this),condition=$select.val(),availableConditions=modalFeedbackConditions.get(response),fbRule=response.getFeedbackRule($(this).parents(".feedbackRule-container").data("serial")),newCondition=_.find(availableConditions,{name:condition}),oldCondition=_.find(availableConditions,{name:fbRule.condition});oldCondition&&_.isFunction(oldCondition.onUnset)&&oldCondition.onUnset(fbRule,$select),newCondition&&_.isFunction(newCondition.onSet)&&newCondition.onSet(fbRule,$select),newCondition.init(fbRule,$select)}).on("click","[data-feedback]",function(){var $btn=$(this),fbRule=response.getFeedbackRule($btn.parents(".feedbackRule-container").data("serial")),modalFeedback,modalFeedbackWidget;switch($btn.data("feedback")){case"then":modalFeedback=fbRule.feedbackThen;break;case"else":modalFeedback=fbRule.feedbackElse;}modalFeedback&&(modalFeedbackWidget=_getModalFeedbackWidget(modalFeedback),modalFeedbackWidget.changeState("active"))})},_widgets={},_getModalFeedbackWidget=function(modalFeedback){var $feedbacksContainer=$("#modalFeedbacks");return _widgets[modalFeedback.serial]||($feedbacksContainer.append(modalFeedback.render()),modalFeedback.postRender(),_widgets[modalFeedback.serial]=modalFeedback.data("widget")),_widgets[modalFeedback.serial]};return{initFeedbacksPanel:function initFeedbacksPanel($feedbacksPanel,response){$feedbacksPanel.html(panelTpl());var $feedbackRules=$feedbacksPanel.find(".feedbackRules"),feedbackRules=response.getFeedbackRules();feedbackRules&&_.size(feedbackRules)&&($feedbackRules.empty(),_.each(feedbackRules,function(feedbackRule){$feedbackRules.append(_renderFeedbackRule(feedbackRule))})),_initFeedbackEventListener($feedbacksPanel,response)},renderFeedbackRule:_renderFeedbackRule}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState",["jquery","lodash","i18n","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm","taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule"],function($,_,__,responseHelper,formElement,minMaxComponentFactory,responseFormTpl,modalFeedbackRule){'use strict';var _saveCallbacks={mappingAttr:function(response,value,key){""===value?response.removeMappingAttribute(key):response.setMappingAttribute(key,value)}},getAvailableTemplates=function(){return{CUSTOM:__("custom"),MATCH_CORRECT:__("match correct"),MAP_RESPONSE:__("map response"),MAP_RESPONSE_POINT:__("map response"),NONE:__("none")}},_getAvailableRpTemplates=function(interaction,filteredTemplates){var rp=interaction.getRootElement().responseProcessing,allTemplates=getAvailableTemplates(),templates={};switch(_.isEmpty(filteredTemplates)?templates=allTemplates:_.forEach(filteredTemplates,function(templateName){allTemplates[templateName]&&(templates[templateName]=allTemplates[templateName])}),interaction.qtiClass){case"orderInteraction":case"graphicOrderInteraction":case"extendedTextInteraction":case"sliderInteraction":case"uploadInteraction":case"mediaInteraction":case"endAttemptInteraction":delete templates.MAP_RESPONSE,delete templates.MAP_RESPONSE_POINT;break;case"selectPointInteraction":delete templates.MATCH_CORRECT,delete templates.MAP_RESPONSE;break;default:delete templates.MAP_RESPONSE_POINT;}return"templateDriven"===rp.processingType&&delete templates.CUSTOM,templates},answerStateHelper={forward:function(widget){var response=widget.element.getResponseDeclaration();responseHelper.isUsingTemplate(response,"MATCH_CORRECT")?widget.changeState("correct"):responseHelper.isUsingTemplate(response,"MAP_RESPONSE")||responseHelper.isUsingTemplate(response,"MAP_RESPONSE_POINT")?widget.changeState("map"):responseHelper.isUsingTemplate(response,"NONE")?widget.changeState("norp"):widget.changeState("custom")},defineCorrect:function(response,newDefineCorrectActive){var defineCorrectActive=!1,template=responseHelper.getTemplateNameFromUri(response.template),corrects=response.getCorrect();return _.isUndefined(newDefineCorrectActive)?"MAP_RESPONSE"===template||"MAP_RESPONSE_POINT"===template?_.isUndefined(response.data("defineCorrect"))?(defineCorrectActive=corrects&&_.size(corrects),response.data("defineCorrect",defineCorrectActive)):defineCorrectActive=!!response.data("defineCorrect"):"MATCH_CORRECT"===template&&(defineCorrectActive=!0):(!newDefineCorrectActive&&(response.correctResponse=[]),response.data("defineCorrect",newDefineCorrectActive)),defineCorrectActive},initResponseForm:function(widget,options){var interaction=widget.element,item=interaction.getRootElement(),rp=item.responseProcessing,response=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(response.template),editMapping=0<=_.indexOf(["MAP_RESPONSE","MAP_RESPONSE_POINT"],template),defineCorrect=answerStateHelper.defineCorrect(response),_toggleCorrectWidgets=function(show){var $correctWidgets=widget.$container.find("[data-edit=correct]");show?$correctWidgets.show():$correctWidgets.hide()};options=_.defaults(options||{},{rpTemplates:[]}),template&&"custom"!==rp.processingType||(template="CUSTOM"),widget.$responseForm.html(responseFormTpl({identifier:response.id(),serial:response.getSerial(),defineCorrect:defineCorrect,editMapping:editMapping,editFeedbacks:"CUSTOM"!==template,mappingDisabled:_.isEmpty(response.mapEntries),template:template,templates:_getAvailableRpTemplates(interaction,options.rpTemplates),defaultValue:response.getMappingAttribute("defaultValue")})),widget.$responseForm.find("select[name=template]").val(template),editMapping&&_toggleCorrectWidgets(defineCorrect),minMaxComponentFactory(widget.$responseForm.find(".response-mapping-attributes > .min-max-panel"),{min:{fieldName:"lowerBound",value:_.parseInt(response.getMappingAttribute("lowerBound"))||0,helpMessage:__("Minimal  score for this interaction.")},max:{fieldName:"upperBound",value:_.parseInt(response.getMappingAttribute("upperBound"))||0,helpMessage:__("Maximal score for this interaction.")},lowerThreshold:0,upperThreshold:Number.MAX_SAFE_INTEGER,syncValues:!0});var formChangeCallbacks={identifier:function identifier(res,value){response.id(value),interaction.attr("responseIdentifier",value)},defaultValue:_saveCallbacks.mappingAttr,template:function(res,value){rp.setProcessingType("templateDriven"),response.setTemplate(value),answerStateHelper.forward(widget),answerStateHelper.initResponseForm(widget)},defineCorrect:function(res,value){_toggleCorrectWidgets(value),answerStateHelper.defineCorrect(response,!!value)}};_.assign(formChangeCallbacks,formElement.getMinMaxAttributeCallbacks(response,"lowerBound","upperBound",{attrMethodNames:{set:"setMappingAttribute",remove:"removeMappingAttribute"}})),formElement.setChangeCallbacks(widget.$responseForm,response,formChangeCallbacks),modalFeedbackRule.initFeedbacksPanel($(".feedbackRule-panel",widget.$responseForm),response),widget.$responseForm.trigger("initResponseForm"),formElement.initWidget(widget.$responseForm)},isCorrectDefined:function(widget){var response=widget.element.getResponseDeclaration();return!!_.size(response.getCorrect())}};return answerStateHelper}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/content"],function(stateFactory,Answer,answerStateHelper,contentHelper){'use strict';var InteractionStateAnswer=stateFactory.create(Answer,function(){this.widget.$container.addClass("runtime"),this.initResponseForm(),answerStateHelper.forward(this.widget),this.widget.$responseForm.show(),contentHelper.changeInnerWidgetState(this.widget,"inactive")},function(){this.widget.$container.removeClass("runtime"),this.widget.$responseForm.empty().hide(),contentHelper.changeInnerWidgetState(this.widget,"sleep")});return InteractionStateAnswer.prototype.initResponseForm=function(){answerStateHelper.initResponseForm(this.widget)},InteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct"],function(stateFactory,Correct){var InteractionStateCorrect=stateFactory.create(Correct,function(){},function(){});return InteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Map,answerState){'use strict';var InteractionStateMap=stateFactory.create(Map,function(){var $correctWidgets=this.widget.$container.find("[data-edit=\"correct\"]");answerState.isCorrectDefined(this.widget)?$correctWidgets.show():$correctWidgets.hide()},function(){this.widget.$container.find("[data-edit=\"correct\"]").hide()});return InteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/states/NoRp",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/NoRp","taoQtiItem/qtiCreator/helper/xmlRenderer"],function(stateFactory,NoRp,xmlRenderer){'use strict';return stateFactory.create(NoRp,function(){var interaction=this.widget.element,item=interaction.getRootElement(),rp=item.responseProcessing,rpXml=xmlRenderer.render(rp);rpXml.trim()||(item.removeOutcome("SCORE"),item.removeOutcome("MAXSCORE"))},function(){var interaction=this.widget.element,item=interaction.getRootElement(),outcomeScore=item.getOutcomeDeclaration("SCORE"),rp=item.responseProcessing,rpXml=xmlRenderer.render(rp);rpXml&&!outcomeScore&&(outcomeScore=item.createOutcomeDeclaration({cardinality:"single",baseType:"float"}),outcomeScore.buildIdentifier("SCORE",!1))})}),define("taoQtiItem/qtiCreator/widgets/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("custom",["answer","active"],function(){throw new Error("state \"custom\" prototype init method must be implemented")},function(){throw new Error("state \"custom\" prototype exit method must be implemented")})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="<span class=\"message\">",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<span class=\"overlay\">\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.message,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</span>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Custom","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay","i18n"],function(stateFactory,Custom,overlayTpl,__){var InteractionStateCustom=stateFactory.create(Custom,function(){this.widget.$container.append(overlayTpl({message:__("Custom Response Processing Mode")}));this.widget.$container.find("[data-edit=map], [data-edit=correct]").hide()},function(){this.widget.$container.children(".overlay").remove()});return InteractionStateCustom}),define("taoQtiItem/qtiCreator/widgets/interactions/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/states/Active","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/states/Map","taoQtiItem/qtiCreator/widgets/interactions/states/NoRp","taoQtiItem/qtiCreator/widgets/interactions/states/Custom"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","i18n"],function($,stateFactory,Question,htmlEditor,contentHelper,__){'use strict';var BlockInteractionStateQuestion=stateFactory.extend(Question,function(){this.buildPromptEditor()},function(){this.destroyPromptEditor()});return BlockInteractionStateQuestion.prototype.buildPromptEditor=function(){var _widget=this.widget,$editableContainer=_widget.$container.find(".qti-prompt-container"),$editable=$editableContainer.find(".qti-prompt"),container=_widget.element.prompt.getBody();$editableContainer.attr("data-html-editable-container",!0),$editable.attr("data-html-editable",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{placeholder:__("define prompt"),change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget}})},BlockInteractionStateQuestion.prototype.destroyPromptEditor=function(){var $editableContainer=this.widget.$container.find(".qti-prompt-container");htmlEditor.destroyEditor($editableContainer)},BlockInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label>\n        <input name=\"shuffle\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \u201Cshuffled\u201D of \u201Cfixed\u201D individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \u201Cshuffled\u201D of \u201Cfixed\u201D individually.",options)))+"\n    </span>\n</div>\n\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Number of associations",options):helperMissing.call(depth0,"__","Number of associations",options)))+"</h3>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(_,stateFactory,Question,formElement,minMaxComponentFactory,formTpl,sizeAdapter){'use strict';var AssociateInteractionStateQuestion=stateFactory.extend(Question);return AssociateInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,$form=this.widget.$form,interaction=this.widget.element;$form.html(formTpl({shuffle:!!interaction.attr("shuffle")})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{fieldName:"minAssociations",value:_.parseInt(interaction.attr("minAssociations"))||1,toggler:!1},max:{fieldName:"maxAssociations",value:_.parseInt(interaction.attr("maxAssociations"))||1,toggler:!1},lowerThreshold:0,upperThreshold:100}).on("change",function(){}),formElement.initWidget($form);var callbacks=formElement.getMinMaxAttributeCallbacks($form,"minAssociations","maxAssociations");callbacks.shuffle=formElement.getAttributeChangeCallback(),formElement.setChangeCallbacks($form,interaction,callbacks),sizeAdapter.adaptSize(widget),widget.on("choiceCreated",function(){sizeAdapter.adaptSize(widget)})},AssociateInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(stateFactory,Choice,sizeAdapter){'use strict';var AssociateInteractionStateChoice=stateFactory.extend(Choice,function(){var widget=this.widget;widget.on("containerBodyChange contentChange choiceCreated",function(){sizeAdapter.adaptSize(widget)})},function(){});return AssociateInteractionStateChoice}),define("taoQtiItem/qtiCreator/widgets/helpers/placeholder",["jquery"],function($){'use strict';function setPlaceholder(el,value){return value="undefined"==typeof value?"":""+value,$(el).attr("placeholder",value)}function getResponseDeclaration(widget){var interaction=widget.element;return interaction&&interaction.getResponseDeclaration()}return{score:function(widget,value){var response=getResponseDeclaration(widget);response&&"undefined"==typeof value&&(value=response.getMappingAttribute("defaultValue")),widget&&widget.$container&&setPlaceholder(widget.$container.find(".score"),value)}}}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget",["lodash","i18n","taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCreator/widgets/helpers/placeholder"],function(_,__,commonRenderer,sizeAdapter,instructionMgr,placeholder){'use strict';var ResponseWidget={create:function create(widget,responseMappingMode){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),responseMappingMode?(instructionMgr.appendInstruction(widget.element,__("Please define association pairs and their scores below.")),interaction.responseMappingMode=!0,widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&placeholder.score(widget,data.value)}),placeholder.score(widget)):instructionMgr.appendInstruction(widget.element,__("Please define the correct association pairs below.")),commonRenderer.render(interaction),sizeAdapter.adaptSize(widget)},setResponse:function setResponse(interaction,response){var responseDeclaration=interaction.getResponseDeclaration();commonRenderer.setResponse(interaction,ResponseWidget.formatResponse(response,responseDeclaration.attr("cardinality"))),sizeAdapter.adaptSize(interaction.data("widget"))},destroy:function destroy(widget){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),delete interaction.responseMappingMode,commonRenderer.renderEmptyPairs(interaction),sizeAdapter.adaptSize(widget)},getResponseSummary:function getResponseSummary(responseDeclaration){var pairs=[],correctResponse=_.values(responseDeclaration.getCorrect()),mapEntries=responseDeclaration.getMapEntries();return _.each(correctResponse,function(pair){var sortedIdPair=pair.split(" ").sort(),sortedIdPairKey=sortedIdPair.join(" ");pairs[sortedIdPairKey]={pair:sortedIdPair,correct:!0,score:void 0}}),_.forIn(mapEntries,function(score,pair){var sortedIdPair=pair.split(" ").sort(),sortedIdPairKey=sortedIdPair.join(" ");pairs[sortedIdPairKey]?pairs[sortedIdPairKey].score=score:pairs[sortedIdPairKey]={pair:sortedIdPair,correct:!1,score:score}}),pairs},formatResponse:function formatResponse(response,cardinality){var formatedRes;return formatedRes="single"===cardinality?{base:{pair:[]}}:{list:{pair:[]}},_.each(response,function(pairString){var pair=pairString.split(" ");"single"===cardinality?formatedRes.base.pair=pair:formatedRes.list.pair.push(pair)}),formatedRes},unformatResponse:function unformatResponse(formatedResponse){var res=[];return formatedResponse.list&&formatedResponse.list.pair?_.each(formatedResponse.list.pair,function(pair){res.push(pair.join(" "))}):formatedResponse.base&&formatedResponse.base.pair&&res.push(formatedResponse.base.pair.join(" ")),res}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var AssociateInteractionStateCorrect=stateFactory.create(Correct,function(){var interaction=this.widget.element,response=interaction.getResponseDeclaration();responseWidget.create(this.widget,!1),responseWidget.setResponse(interaction,_.values(response.getCorrect())),this.widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(responseWidget.unformatResponse(data.response))})},function(){this.widget.$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget)});return AssociateInteractionStateCorrect}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"mini-tlb\" data-edit=\"answer\" data-for=\"",(helper=helpers.choiceSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceSerial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <label class=\"tlb-button right\" title=\"This answer is correct\" data-edit=\"correct\">\n        <input \n            type=\"checkbox\" \n            data-role=\"correct\"\n            name=\"correct_",(helper=helpers.interactionSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.interactionSerial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"[]\" \n            value=\"",(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n    </label>\n    <label class=\"tlb-button right\" title=\"Score of this answer\" data-edit=\"map\">\n        <input value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" data-role=\"score\" data-for=\"",(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" name=\"score\" class=\"score\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty; $event(type=keyup)\" />\n    </label>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","taoQtiItem/qtiCreator/widgets/helpers/placeholder","tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer"],function($,_,stateFactory,Map,responseWidget,placeholder,responseToolbarTpl){'use strict';var AssociateInteractionStateCorrect=stateFactory.create(Map,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget,!0),this.bindResponseChangeListener(),responseWidget.setResponse(interaction,_.keys(responseWidget.getResponseSummary(response))),placeholder.score(_widget)},function(){this.widget.$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget),this.widget.$container.find(".mini-tlb").remove()});return AssociateInteractionStateCorrect.prototype.bindResponseChangeListener=function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration(),_saveCorrect=function(){var correct=[];$("input[name=\"correct_"+_widget.serial+"[]\"]:checked").each(function(){correct.push($(this).data("pairIdentifier"))}),response.setCorrect(correct)};_widget.$container.on("responseChange.qti-widget",function(e,data,extraData){var $miniToolbar;if("added"===extraData.type){var pair=[],pairs=[],$filled=extraData.$pair.children(".filled");if(2===$filled.length){pairs=responseWidget.getResponseSummary(response),$filled.each(function(){var serial=$(this).data("serial"),choice=interaction.getChoice(serial);pair.push(choice.id())}),pair.sort();var pairIdentifier=pair.join(" ");$miniToolbar=extraData.$pair.children(".mini-tlb"),$miniToolbar.length||(extraData.$pair.append(responseToolbarTpl({interactionSerial:interaction.getSerial(),choiceSerial:"n/a",choiceIdentifier:"n/a"})),$miniToolbar=extraData.$pair.children(".mini-tlb")),$miniToolbar.show(),$miniToolbar.data("pairIdentifier",pairIdentifier);var $correct=$miniToolbar.find("[data-role=correct]").data("pairIdentifier",pairIdentifier);pairs[pairIdentifier]&&pairs[pairIdentifier].correct?$correct.prop("checked",!0):$correct.prop("checked",!1);var $score=$miniToolbar.find("[data-role=score]").data("pairIdentifier",pairIdentifier);pairs[pairIdentifier]&&pairs[pairIdentifier].score&&$score.val(pairs[pairIdentifier].score)}}else $miniToolbar=extraData.$pair.children(".mini-tlb"),$miniToolbar.hide(),response.removeMapEntry($miniToolbar.data("pairIdentifier")),$miniToolbar.removeData("pairIdentifier"),$miniToolbar.find("[data-role=correct]").prop("checked",!1).removeData("pairIdentifier"),$miniToolbar.find("[data-role=score]").val("").removeData("pairIdentifier"),_saveCorrect();placeholder.score(_widget)}),placeholder.score(_widget),_widget.$container.find(".result-area").on("change","[data-role=correct]",_saveCorrect).on("keyup","[data-role=score]",function(){var $score=$(this);response.setMapEntry($score.data("pairIdentifier"),$score.val())})},AssociateInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(Widget,states,sizeAdapter){'use strict';var AssociateInteractionWidget=Widget.clone();return AssociateInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),sizeAdapter.adaptSize(this)},AssociateInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget"],function(_,AssociateInteraction,AssociateInteractionWidget){'use strict';var CreatorAssociateInteraction=_.clone(AssociateInteraction);return CreatorAssociateInteraction.render=function(interaction,options){AssociateInteraction.renderEmptyPairs(interaction),AssociateInteractionWidget.build(interaction,AssociateInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorAssociateInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(){return"checked=\"checked\""}function program3(){return"checked"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label>\n        <input name=\"shuffle\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \"shuffled\" of \"fixed\" individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \"shuffled\" of \"fixed\" individually.",options)))+"\n    </span>\n</div>\n\n<hr/>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+"</h3>\n</div>\n<hr/>\n<div class=\"panel\">\n    <label>\n        <input name=\"eliminable\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.eliminable,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allow elimination",options):helperMissing.call(depth0,"__","Allow elimination",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If this box is checked the student will be able to eliminate choices.",options):helperMissing.call(depth0,"__","If this box is checked the student will be able to eliminate choices.",options)))+"\n    </span>\n</div>\n\n<hr/>\n\n\n<div class=\"panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"List Style",options):helperMissing.call(depth0,"__","List Style",options)))+"</h3>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Use this if you want the list of choices to be prefixed (e.g. 1,2,3 a,b,c)",options):helperMissing.call(depth0,"__","Use this if you want the list of choices to be prefixed (e.g. 1,2,3 a,b,c)",options)))+"\n        </span>\n\n    <select data-list-style/>\n</div>\n\n\n<hr/>\n<div class=\"panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Orientation",options):helperMissing.call(depth0,"__","Orientation",options)))+"</h3>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Display the choices either horizontally or vertically",options):helperMissing.call(depth0,"__","Display the choices either horizontally or vertically",options)))+"\n        </span>\n    <div>\n        <label class=\"smaller-prompt\">\n            <input type=\"radio\" name=\"orientation\" value=\"vertical\" ",stack1=helpers.unless.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n            <span class=\"icon-radio\"></span>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Vertical",options):helperMissing.call(depth0,"__","Vertical",options)))+"\n        </label>\n        <br>\n        <label class=\"smaller-prompt\">\n            <input type=\"radio\" name=\"orientation\" value=\"horizontal\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n            <span class=\"icon-radio\"></span>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Horizontal",options):helperMissing.call(depth0,"__","Horizontal",options)))+"\n        </label>\n    </div>\n</div>",buffer})}),define("ui/liststyler",["jquery","lodash","core/pluginifier","util/capitalize"],function($,_,Pluginifier,capitalize){'use strict';function populate(selectBox,selectedStyle){_.forOwn(listStyles,function(symbol,style){selectBox.options.add(new Option(capitalize(style.replace(/-/g," ")),style,!1,style===selectedStyle))})}function formatState(state){var symbol=listStyles[state.id];return $("<span/>",{text:state.text,"data-symbol":symbol})}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,capitalize=capitalize&&capitalize.hasOwnProperty("default")?capitalize["default"]:capitalize;var currStyle="",defaults={selected:null},listStyles={none:"",disc:"\u25CF",circle:"\u25CB",square:"\u25FD",decimal:"1","decimal-leading-zero":"01","lower-alpha":"a","upper-alpha":"A","lower-roman":"i","upper-roman":"I","lower-greek":"\u03B1",armenian:"\u0531",georgian:"\u10D0"};Pluginifier.register("liststyler",{init:function(options){return this.each(function(){var $elt=$(this);options=$.extend(!0,{},defaults,options),populate(this,options.selected),currStyle=options.selected,$elt.on("change",function(){$elt.trigger("stylechange.liststyler",{newStyle:this.value,oldStyle:currStyle}),currStyle=this.value}),$elt.select2({formatResult:formatState,width:"element",minimumResultsForSearch:1/0}),$elt.trigger("create.liststyler")})},destroy:function(){this.each(function(){var $elt=$(this);$elt.trigger("destroy.liststyler")})}})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","ui/liststyler"],function(_,stateFactory,Question,formElement,minMaxComponentFactory,formTpl,sizeAdapter){'use strict';function getListStyle(interaction){var className=interaction.attr("class")||"",listStyle=className.match(/\blist-style-[\w-]+/);return _.isNull(listStyle)?null:listStyle.pop().replace("list-style-","")}var ChoiceInteractionStateQuestion=stateFactory.extend(Question),listStylePrefix="list-style-";return ChoiceInteractionStateQuestion.prototype.initForm=function(updateCardinality){var widget=this.widget,$form=widget.$form,interaction=widget.element,currListStyle=getListStyle(interaction),$choiceArea=widget.$container.find(".choice-area"),callbacks;$form.html(formTpl({shuffle:!!interaction.attr("shuffle"),horizontal:"horizontal"===interaction.attr("orientation"),eliminable:/\beliminable\b/.test(interaction.attr("class"))})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{value:_.parseInt(interaction.attr("minChoices"))||0},max:{value:_.parseInt(interaction.attr("maxChoices"))||0},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),$form.find("[data-list-style]").liststyler({selected:currListStyle}).on("stylechange.liststyler",function(e,data){interaction.removeClass(listStylePrefix+data.oldStyle),$choiceArea.removeClass(listStylePrefix+data.oldStyle),"none"!==data.newStyle&&(interaction.addClass(listStylePrefix+data.newStyle),$choiceArea.addClass(listStylePrefix+data.newStyle))}),$form.find("[name=\"eliminable\"]").on("change.eliminable",function(){interaction.toggleClass("eliminable",this.checked),widget.$original.toggleClass("eliminable",this.checked),interaction.toggleClass("eliminability-deselected",!this.checked)}),formElement.initWidget($form),callbacks=formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices",{updateCardinality:updateCardinality}),callbacks.shuffle=formElement.getAttributeChangeCallback(),callbacks.orientation=function(interaction,value){interaction.attr("orientation",value),"horizontal"===value?$choiceArea.addClass("horizontal"):$choiceArea.removeClass("horizontal")},formElement.setChangeCallbacks($form,interaction,callbacks),widget.on("attributeChange",function(data){var $checkboxIcons=widget.$container.find(".real-label > span");data.element.serial===interaction.serial&&"maxChoices"===data.key&&(1===parseInt(data.value)?$checkboxIcons.removeClass("icon-checkbox").addClass("icon-radio"):$checkboxIcons.removeClass("icon-radio").addClass("icon-checkbox"))}),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget),widget.on("choiceCreated",function(){"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget)})},ChoiceInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(stateFactory,Choice,sizeAdapter){'use strict';var ChoiceInteractionStateChoice=stateFactory.extend(Choice,function(){var widget=this.widget;widget.on("containerBodyChange contentChange choiceCreated",function(){"horizontal"===widget.element.attr("orientation")&&sizeAdapter.adaptSize(widget)})},function(){});return ChoiceInteractionStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"mini-tlb\" data-edit=\"answer\" data-for=\"",(helper=helpers.choiceSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceSerial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <label class=\"tlb-button right\" title=\"Score of this answer\" data-edit=\"map\">\n        <input value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n       title=\"Score of this answer\" \n       type=\"text\" \n       data-for=\"",(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n       name=\"score\" \n       class=\"score\" \n       placeholder = \"",(helper=helpers.placeholder)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholder,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n       data-validate=\"$numeric\" \n       data-validate-option=\"$allowEmpty; $event(type=keyup)\" />\n    </label>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"mini-tlb-label\" data-edit=\"answer\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.show,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"style=\"display:block;\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <label class=\"right\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</label>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label"],function($,_,__,commonRenderer,instructionMgr,pciResponse,formElement,answerStateHelper,sizeAdapter,scoreTpl,labelTpl){'use strict';var _fixInputs=function(widget){1===widget.element.attr("maxChoices")?widget.$container.find(".real-label > :checkbox").replaceWith(function(){var $checkbox=$(this);return $("<input>",{type:"radio",value:$checkbox.attr("value"),name:$checkbox.attr("name")})}):widget.$container.find(".real-label > :radio").replaceWith(function(){var $radio=$(this);return $("<input>",{type:"checkbox",value:$radio.attr("value"),name:$radio.attr("name")})})},ResponseWidget={create:function create(widget,responseMappingMode){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),_fixInputs(widget),responseMappingMode?(instructionMgr.appendInstruction(widget.element,__("Please define the correct response and the score below.")),interaction.data("responseMappingMode",!0),ResponseWidget.createScoreWidgets(widget),ResponseWidget.createCorrectWidgets(widget)):(instructionMgr.appendInstruction(widget.element,__("Please define the correct response below.")),ResponseWidget.createCorrectWidgets(widget)),commonRenderer.render(interaction),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget)},setResponse:function setResponse(interaction,response){commonRenderer.setResponse(interaction,pciResponse.serialize(_.values(response),interaction)),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(interaction.data("widget"))},destroy:function destroy(widget){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.removeData("responseMappingMode"),widget.$container.off("responseChange.qti-widget"),widget.$container.find(".real-label > input").attr("disabled","disabled"),widget.$container.find(".mini-tlb-label[data-edit=answer], .mini-tlb[data-edit=answer]").remove(),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget)},createScoreWidgets:function createScoreWidgets(widget){var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),defaultValue=response.getMappingAttribute("defaultValue"),$label=$(labelTpl({label:__("score"),show:!0})).css({right:3,left:"auto"});$container.find(".qti-choice:first .pseudo-label-box").append($label),$container.find(".qti-choice").each(function(){var $choice=$(this),id=$choice.data("identifier"),serial=$choice.data("serial"),$score;$score=$(scoreTpl({serial:interaction.getSerial(),choiceSerial:serial,choiceIdentifier:id,score:mapEntries[id]?mapEntries[id]:"",placeholder:defaultValue})),$choice.find(".pseudo-label-box").append($score),$score.show().on("click",function(e){e.stopPropagation(),e.preventDefault()})});var $scores=$container.find(".score");widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&$scores.attr("placeholder",data.value)}),formElement.setChangeCallbacks($container,response,{score:function score(response,value){var key=$(this).data("for");""===value?response.removeMapEntry(key):response.setMapEntry(key,value,!0)}})},createCorrectWidgets:function createCorrectWidgets(widget){var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),$corrects=$container.find(".real-label > input");$container.find(".qti-choice:first .pseudo-label-box").append(labelTpl({label:__("correct"),show:!1})),$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(pciResponse.unserialize(data.response,interaction))});var _toggleCorrectInputs=function(show){show?$corrects.removeAttr("disabled"):$corrects.attr("disabled","disabled").prop("checked",!1)};_toggleCorrectInputs(answerStateHelper.defineCorrect(response)),widget.on("metaChange",function(data){data.element.serial===response.serial&&"defineCorrect"===data.key&&_toggleCorrectInputs(data.value)})},formatResponse:function formatResponse(response){return pciResponse.serialize(_.values(response))},unformatResponse:function unformatResponse(formatedResponse){return pciResponse.unserialize(formatedResponse)}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var ChoiceInteractionStateCorrect=stateFactory.create(Correct,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget),responseWidget.setResponse(interaction,_.values(response.getCorrect()))},function(){responseWidget.destroy(this.widget)});return ChoiceInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(stateFactory,Map,responseWidget,_){'use strict';var ChoiceInteractionStateMap=stateFactory.create(Map,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget,!0),responseWidget.setResponse(interaction,_.values(response.getCorrect()))},function(){responseWidget.destroy(this.widget)});return ChoiceInteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(Widget,states,sizeAdapter){'use strict';var ChoiceInteractionWidget=Widget.clone();return ChoiceInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),"horizontal"===this.element.attr("orientation")&&sizeAdapter.adaptSize(this)},ChoiceInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget"],function(_,ChoiceInteraction,ChoiceInteractionWidget){'use strict';var CreatorChoiceInteraction=_.clone(ChoiceInteraction);return CreatorChoiceInteraction.render=function(interaction,options){ChoiceInteractionWidget.build(interaction,ChoiceInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorChoiceInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget"],function(Widget){var InlineInteractionWidget=Widget.clone();return InlineInteractionWidget.destroy=function(){this.$original.off(".qti-widget"),this.$container.remove(),this.offEvents()},InlineInteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){var InlineInteractionStateSleep=stateFactory.create(SleepState,function(){var _widget=this.widget,$container=this.widget.$original;$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),_widget.changeState("question")}),$container.on("mouseenter.sleep",function(){$container.addClass("hover"),$container.parent().trigger("mouseleave.sleep")}).on("mouseleave.sleep",function(){$container.removeClass("hover"),$container.parent().trigger("mouseenter.sleep")})},function(){this.widget.$original.removeClass("hover").off(".sleep")});return InlineInteractionStateSleep}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Active"],function($,_,stateFactory,Active){var InteractionStateActive=stateFactory.extend(Active,function(){var _this=this;$(window).on("resize.active",_.throttle(function(){_this.positionWidget()},200)),this.positionWidget()},function(){$(window).off(".active"),this.widget.$container.hide()});return InteractionStateActive.prototype.positionWidget=function(){var _widget=this.widget,itemOffset=_widget.$itemContainer.offset(),originalOffset=_widget.$original.offset();_widget.$container.show().css({position:"absolute",top:originalOffset.top-itemOffset.top-22,left:originalOffset.left-itemOffset.left-32})},InteractionStateActive}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/endAttempt",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n<div class=\"panel\">\n    <label for=\"restrictedIdentifier\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response identifier",options):helperMissing.call(depth0,"__","Response identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select a response identifier from the list.",options):helperMissing.call(depth0,"__","Select a response identifier from the list.",options)))+"</span>\n    <select name=\"restrictedIdentifier\" class=\"select2\" data-has-search=\"false\">\n    \t",stack1=helpers.each.call(depth0,depth0&&depth0.restrictedIdentifiers,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n",buffer}function program2(depth0,data){var buffer="",stack1,helper;return buffer+="\n    \t\t<option value=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    \t",buffer}function program3(){return"selected=\"selected\""}function program5(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response identifier",options):helperMissing.call(depth0,"__","Response identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the response identifier. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the response identifier. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\" \n           name=\"responseIdentifier\" \n           value=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n           placeholder=\"e.g. END_ATTEMPT\" \n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.responseSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseSerial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return stack1=helpers["if"].call(depth0,depth0&&depth0.hasRestrictedIdentifier,{hash:{},inverse:self.program(5,program5,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Label",options):helperMissing.call(depth0,"__","Label",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The button label.",options):helperMissing.call(depth0,"__","The button label.",options)))+"</div>\n\n    <input type=\"text\" \n           name=\"title\" \n           value=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n           placeholder=\"e.g. End Attempt\" \n           data-validate=\"$notEmpty;\">\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/Question",["lodash","jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/endAttempt"],function(_,$,stateFactory,Question,formElement,formTpl){'use strict';function _prepareRestrictedIdentifier(widget){var ret={},interaction=widget.element,response=interaction.getResponseDeclaration(),responseIdentifier=interaction.attr("responseIdentifier"),config=widget.options.config,defaultIdentifier="",isset="",i=0;return config&&config.responseIdentifiers&&(_.forIn(config.responseIdentifiers,function(title,identifier){i||(defaultIdentifier=identifier);var selected=responseIdentifier.match(new RegExp("^("+identifier+")(_[0-9]*)?$"));ret[identifier]={identifier:identifier,title:title,selected:selected},selected&&(isset=!0),i++}),!isset&&(response.buildIdentifier(defaultIdentifier,!1),interaction.attr("responseIdentifier",response.id()))),ret}var EndAttemptInteractionStateQuestion=stateFactory.extend(Question,function(){var $mainOption=this.widget.$container.find(".main-option"),$original=this.widget.$original;$(document).on("choiceTextChange.qti-widget.question",function(){$original.width($mainOption.width())})},function(){$(document).off(".qti-widget.question")});return EndAttemptInteractionStateQuestion.prototype.addNewChoiceButton=function(){},EndAttemptInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,$title=_widget.$container.find(".endAttemptInteraction-placeholder"),interaction=_widget.element,response=interaction.getResponseDeclaration(),restrictedIdentifiers=_prepareRestrictedIdentifier(_widget),hasRestrictedIdentifier=!!_.size(restrictedIdentifiers);$form.html(formTpl({hasRestrictedIdentifier:hasRestrictedIdentifier,restrictedIdentifiers:restrictedIdentifiers,responseSerial:response.serial,responseIdentifier:interaction.attr("responseIdentifier"),title:interaction.attr("title")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{title:function title(interaction,_title){interaction.attr("title",_title),$title.html(_title),_widget.$original.html(_title)},responseIdentifier:function responseIdentifier(interaction,identifier){response.id(identifier),interaction.attr("responseIdentifier",identifier)},restrictedIdentifier:function restrictedIdentifier(interaction,identifier){response.buildIdentifier(identifier,!1),interaction.attr("responseIdentifier",response.id())}})},EndAttemptInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/Question"],function(factory,states){'use strict';return factory.createBundle(states,arguments,["map"])}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"widget-box widget-inline widget-endAttemptInteraction qti-interaction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-edit=\"active\">\r\n    <span class=\"btn small btn-info endAttemptInteraction-placeholder\">\r\n        "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.title),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\r\n    </span>\r\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/Widget",["lodash","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction"],function(_,InteractionWidget,states,interactionTpl){'use strict';var EndAttemptInteractionWidget=InteractionWidget.clone();return EndAttemptInteractionWidget.initCreator=function(){this.registerStates(states),InteractionWidget.initCreator.call(this),this.$container.find(".tlb-title").remove()},EndAttemptInteractionWidget.renderInteraction=function(){var interaction=this.element,tplData={tag:interaction.qtiClass,serial:interaction.serial,attributes:interaction.attributes};return interactionTpl(tplData)},EndAttemptInteractionWidget.buildContainer=function(){var previous,next;this.$original.length&&(previous=this.$original[0].previousSibling,next=this.$original[0].nextSibling,(!previous||3===previous.nodeType&&""===previous.nodeValue||3!==previous.nodeType)&&this.$original.before("&nbsp;"),(!next||3===next.nodeType&&""===next.nodeValue||3!==next.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-endAttemptInteraction[data-serial="+this.element.getSerial()+"]")},EndAttemptInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction.placeholder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"widget-box btn small btn-info endAttemptInteraction-placeholder\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"endAttemptInteraction\">\n    "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.title),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\n</span>",buffer})}),define("taoQtiItem/qtiCreator/renderers/interactions/EndAttemptInteraction",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction","taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction.placeholder"],function($,_,EndAttemptInteraction,EndAttemptInteractionWidget,tpl){'use strict';var CreatorEndAttemptInteraction=_.clone(EndAttemptInteraction);return CreatorEndAttemptInteraction.template=tpl,CreatorEndAttemptInteraction.render=function(interaction,options){options=options||{};var interactionsConfig=this.getOption("interactions");interactionsConfig.endAttempt&&(options.config=interactionsConfig.endAttempt),EndAttemptInteractionWidget.build(interaction,$(".endAttemptInteraction-placeholder[data-serial=\""+interaction.serial+"\"]"),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorEndAttemptInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    \t\t<option value=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    \t",buffer}function program2(){return"selected=\"selected\""}function program4(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <option value=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n        ",buffer}function program6(){return"style=\"display:none\""}function program8(depth0,data){var stack1,helper;return(helper=helpers.patternMask)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.patternMask,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}function program10(depth0,data){var buffer="",stack1,helper;return buffer+="value=\"",(helper=helpers.maxLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxLength,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program12(depth0,data){var buffer="",stack1,helper;return buffer+="value=\"",(helper=helpers.maxWords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxWords,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program14(depth0,data){var stack1,helper;return(helper=helpers.expectedLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expectedLength,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}function program16(depth0,data){var stack1,helper;return(helper=helpers.expectedLines)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expectedLines,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"format\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Format",options):helperMissing.call(depth0,"__","Format",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Used to control the format of the text entered by the candidate.",options):helperMissing.call(depth0,"__","Used to control the format of the text entered by the candidate.",options)))+"</span>\n    <select name=\"format\" class=\"select2\" data-has-search=\"false\">\n    \t",stack1=helpers.each.call(depth0,depth0&&depth0.formats,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n<hr>\n<div class=\"panel\">\n    <h3 class=\"full-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Contraints",options):helperMissing.call(depth0,"__","Contraints",options)))+"</h3>\n    <select name=\"constraint\" class=\"select2\" data-has-search=\"false\">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.constraints,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n<div class=\"panel extendedText\">\n    \n    <div class=\"constraint constraint-pattern\" ",stack1=helpers.unless.call(depth0,(stack1=(stack1=depth0&&depth0.constraints,null==stack1||!1===stack1?stack1:stack1.pattern),null==stack1||!1===stack1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        <label>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pattern",options):helperMissing.call(depth0,"__","Pattern",options)))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid",options):helperMissing.call(depth0,"__","If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid",options)))+"</span>\n        <input type=\"text\" name=\"patternMask\" value=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.patternMask,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"/>\n    </div>\n    \n    <div class=\"constraint constraint-maxLength\" ",stack1=helpers.unless.call(depth0,(stack1=(stack1=depth0&&depth0.constraints,null==stack1||!1===stack1?stack1:stack1.maxLength),null==stack1||!1===stack1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        <label class=\"spinner\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max length",options):helperMissing.call(depth0,"__","Max length",options)))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"We will use the patternMask to do this, to be compliant with the IMS standard",options):helperMissing.call(depth0,"__","We will use the patternMask to do this, to be compliant with the IMS standard",options)))+"</span>\n        <input type=\"text\" data-min=\"0\" data-increment=\"1\" class=\"incrementer\" name=\"maxLength\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n    </div>\n    \n    <div class=\"constraint constraint-maxWords\" ",stack1=helpers.unless.call(depth0,(stack1=(stack1=depth0&&depth0.constraints,null==stack1||!1===stack1?stack1:stack1.maxWords),null==stack1||!1===stack1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        <label class=\"spinner\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max words",options):helperMissing.call(depth0,"__","Max words",options)))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"We will use the patternMask to do this, to be compliant with the IMS standard",options):helperMissing.call(depth0,"__","We will use the patternMask to do this, to be compliant with the IMS standard",options)))+"</span>\n        <input type=\"text\" data-min=\"0\" data-increment=\"1\" class=\"incrementer\" name=\"maxWords\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n    </div>\n</div>\n<hr>\n<div class=\"panel extendedText\">\n    <h3 class=\"full-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Recommendations",options):helperMissing.call(depth0,"__","Recommendations",options)))+"</h3>\n    <label class=\"spinner\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Length",options):helperMissing.call(depth0,"__","Length",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters.",options):helperMissing.call(depth0,"__","Provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters.",options)))+"</span>\n    <input type=\"text\" data-min=\"0\" data-increment=\"1\" class=\"incrementer\" name=\"expectedLength\" value=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.expectedLength,{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"/>\n    <label for=\"\" class=\"spinner\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Lines",options):helperMissing.call(depth0,"__","Lines",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Provides a hint to the candidate as to the expected number of lines of input required. A line is expected to have about 72 characters.",options):helperMissing.call(depth0,"__","Provides a hint to the candidate as to the expected number of lines of input required. A line is expected to have about 72 characters.",options)))+"</span>\n    <input type=\"text\" class=\"incrementer\" data-min=\"0\" data-increment=\"1\" name=\"expectedLines\" value=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.expectedLines,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/patternMask","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText"],function($,_,__,stateFactory,Question,formElement,renderer,patternMaskHelper,formTpl){'use strict';var ExtendedTextInteractionStateQuestion=stateFactory.extend(Question,function(){renderer.disable(this.widget.element)},function(){renderer.enable(this.widget.element)});return ExtendedTextInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element,format=interaction.attr("format"),patternMask=interaction.attr("patternMask"),expectedLength=parseInt(interaction.attr("expectedLength"),10),expectedLines=parseInt(interaction.attr("expectedLines"),10),maxWords=parseInt(patternMaskHelper.parsePattern(patternMask,"words"),10),maxChars=parseInt(patternMaskHelper.parsePattern(patternMask,"chars"),10),formats={plain:{label:__("Plain text"),selected:!1},preformatted:{label:__("Pre-formatted text"),selected:!1},xhtml:{label:__("XHTML"),selected:!1}},constraints={none:{label:__("None"),selected:!0},maxLength:{label:__("Max Length"),selected:!1},maxWords:{label:__("Max Words"),selected:!1},pattern:{label:__("Pattern"),selected:!1}},$inputs;!isNaN(maxWords)&&0<maxWords?(constraints.none.selected=!1,constraints.maxWords.selected=!0):!isNaN(maxChars)&&0<maxChars?(constraints.none.selected=!1,constraints.maxLength.selected=!0):null!==patternMask&&void 0!==patternMask&&""!==patternMask&&(constraints.none.selected=!1,constraints.pattern.selected=!0),formats[format]&&(formats[format].selected=!0),$form.html(formTpl({formats:formats,patternMask:patternMask,maxWords:maxWords,maxLength:maxChars,expectedLength:expectedLength,expectedLines:expectedLines,constraints:constraints})),formElement.initWidget($form),$inputs={maxLength:$form.find("[name=\"maxLength\"]"),maxWords:$form.find("[name=\"maxWords\"]"),patternMask:$form.find("[name=\"patternMask\"]")};var callbacks={};callbacks.format=function(interaction,attrValue){var response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect()),previousFormat=interaction.attr("format");renderer.destroy(interaction),interaction.attr("format",attrValue),renderer.render(interaction),"xhtml"===previousFormat&&"undefined"!=typeof correctResponse[0]&&response.setCorrect($("<p>"+correctResponse[0]+"</p>").text())},callbacks.constraint=function(interaction,attrValue){$(".constraint",$form).hide("500"),$(".constraint-"+attrValue,$form).show("1000"),"none"===attrValue&&($("input",$form).val(""),interaction.attr("patternMask",null))},callbacks.maxWords=function(interaction,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)||interaction.attr("patternMask",patternMaskHelper.createMaxWordPattern(newValue)),$inputs.maxLength.val(""),$inputs.patternMask.val(interaction.attr("patternMask"))},callbacks.maxLength=function(interaction,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)||interaction.attr("patternMask",patternMaskHelper.createMaxCharPattern(newValue)),$inputs.maxWords.val(""),$inputs.patternMask.val(interaction.attr("patternMask"))},callbacks.patternMask=function(interaction,attrValue){interaction.attr("patternMask",attrValue),$inputs.maxWords.val(""),$inputs.maxLength.val("")},callbacks.expectedLength=function(interaction,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)?interaction.attr("expectedLength",-1):interaction.attr("expectedLength",attrValue)},callbacks.expectedLines=function(interactions,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)?interaction.attr("expectedLines",-1):interaction.attr("expectedLines",attrValue)},formElement.setChangeCallbacks($form,interaction,callbacks)},ExtendedTextInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function(_,__,stateFactory,Correct,renderer,instructionMgr){'use strict';var _createResponseWidget=function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect());renderer.enable(interaction),renderer.setText(interaction,correctResponse[0]),instructionMgr.appendInstruction(interaction,__("Please type the correct response below.")),widget.$container.on("responseChange.qti-widget",function(){renderer.getResponse(interaction).base.string?response.setCorrect([renderer.getResponse(interaction).base.string]):response.resetCorrect()})},_destroyResponseWidget=function(widget){var interaction=widget.element;renderer.clearText(interaction),instructionMgr.removeInstructions(widget.element),widget.$container.off("responseChange.qti-widget")},ExtendedTextInteractionStateCorrect=stateFactory.create(Correct,function(){_createResponseWidget(this.widget)},function(){_destroyResponseWidget(this.widget)});return ExtendedTextInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction"],function(stateFactory,Sleep,renderer){'use strict';var ExtendedTextInteractionStateSleep=stateFactory.extend(Sleep,function(){renderer.disable(this.widget.element)},function(){});return ExtendedTextInteractionStateSleep}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/NoRp",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/NoRp","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction"],function(stateFactory,NoRp,renderer){'use strict';return stateFactory.extend(NoRp,function(){renderer.disable(this.widget.element)},function(){renderer.enable(this.widget.element)})}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/NoRp"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states"],function(Widget,states){'use strict';var ExtendedTextInteractionWidget=Widget.clone();return ExtendedTextInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},ExtendedTextInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget"],function(_,ExtendedTextInteraction,ExtendedTextInteractionWidget){'use strict';var CreatorExtendedTextInteraction=_.clone(ExtendedTextInteraction);return CreatorExtendedTextInteraction.render=function(interaction,options){ExtendedTextInteraction.render(interaction),ExtendedTextInteractionWidget.build(interaction,ExtendedTextInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorExtendedTextInteraction}),define("taoQtiItem/qtiCreator/widgets/helpers/selectionWrapper",["jquery"],function($){'use strict';return function(options){function searchQtiElement(rootNode){var childNodes=rootNode.childNodes,currentNode,i;for(i=0;i<childNodes.length;i++)currentNode=childNodes[i],!containQtiElement&&isElement(currentNode)&&(isQtiElement(currentNode)?containQtiElement=!0:searchQtiElement(currentNode))}function isElement(node){return node.nodeType===window.Node.ELEMENT_NODE}function isQtiElement(node){return node.className&&(-1<node.className.indexOf("qti-choice")||-1<node.className.indexOf("_tooltip"))}function isRangeValid(range){return $.contains($container.get(0),range.commonAncestorContainer)||$container.get(0).isSameNode(range.commonAncestorContainer)}var $container=options.$container,allowQtiElements=options.allowQtiElements,selection=window.getSelection(),containQtiElement;return{canWrap:function(){var range=!selection.isCollapsed&&selection.getRangeAt(0);return!!range&&(containQtiElement=!1,allowQtiElements||searchQtiElement(range.cloneContents()),""!==range.toString().trim()&&isRangeValid(range)&&!containQtiElement)},wrapWith:function($wrapper){var range=selection.getRangeAt(0);if(this.canWrap())try{return range.surroundContents($wrapper[0]),selection.removeAllRanges(),!0}catch(err){}return!1}}}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/gapMatch",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label>\n        <input name=\"shuffle\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \"shuffled\" of \"fixed\" individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \"shuffled\" of \"fixed\" individually.",options)))+"\n    </span>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap-create",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<div class=\"rgt tlb-button\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Create gap",options):helperMissing.call(depth0,"__","Create gap",options)))+"\" data-role=\"create-gap\">\n    <span class=\"icon-magicwand\"></span>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"mini-tlb\" data-edit=\"",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"cke-launcher-tlb\"></div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Question",["jquery","lodash","i18n","ui/feedback","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/selectionWrapper","taoQtiItem/qtiCreator/model/choices/GapText","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/gapMatch","tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap-create","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger"],function($,_,__,feedback,stateFactory,Question,htmlEditor,gridContentHelper,formElement,htmlContentHelper,selectionWrapper,Choice,formTpl,newGapTpl,toolbarTpl){'use strict';var GapMatchInteractionStateQuestion=stateFactory.extend(Question,function(){this.buildEditor(),this.syncCardinality(),this.preventSingleChoiceDeletion()},function(){this.destroyEditor(),this.widget.offEvents("question")});return GapMatchInteractionStateQuestion.prototype.buildEditor=function(){var self=this,_widget=this.widget,container=_widget.element.getBody(),$container=_widget.$container,$editableContainer=$container.find(".qti-flow-container"),$bodyTlb;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||($bodyTlb=$(toolbarTpl({serial:_widget.serial,state:"question"})),$editableContainer.append($bodyTlb),$bodyTlb.show(),self.initGapCreator(),$container.find(".gapmatch-content").html("..."),htmlEditor.buildEditor($editableContainer,{shieldInnerContent:!1,change:gridContentHelper.getChangeCallbackForBlockStatic(container),data:{container:container,widget:_widget}}),$container.find(".gapmatch-content").empty())},GapMatchInteractionStateQuestion.prototype.destroyEditor=function(){var $container=this.widget.$container,$flowContainer=$container.find(".qti-flow-container"),$editable=$container.find(".qti-flow-container [data-html-editable]");$container.find(".gapmatch-content").html("..."),htmlEditor.destroyEditor($flowContainer),$container.find(".gapmatch-content").empty(),$flowContainer.find(".mini-tlb[data-role=cke-launcher-tlb]").remove(),$editable.off("gapcreator")},GapMatchInteractionStateQuestion.prototype.initGapCreator=function(){var self=this,interactionWidget=this.widget,$editable=interactionWidget.$container.find(".qti-flow-container [data-html-editable]"),$flowContainer=interactionWidget.$container.find(".qti-flow-container"),$toolbar=$flowContainer.find(".mini-tlb[data-role=cke-launcher-tlb]"),$newGapBtn=$(newGapTpl()),$newGap=$("<span>",{class:"widget-box","data-new":!0,"data-qti-class":"gap"}),wrapper=selectionWrapper({$container:$editable,allowQtiElements:!1});$toolbar.append($newGapBtn),$newGapBtn.hide(),$editable.on("mouseup.gapcreator",function(){wrapper.canWrap()?$newGapBtn.show():$newGapBtn.hide()}).on("blur.gapcreator",function(){$newGapBtn.hide()}),$newGapBtn.on("mousedown.gapcreator",function(){$newGapBtn.hide(),wrapper.wrapWith($newGap)?(self.createChoiceFromSelection($newGap),self.replaceSelectionWithGap()):feedback().error(__("Cannot create gap from this selection. Please check that you do not have partially selected elements."))})},GapMatchInteractionStateQuestion.prototype.createChoiceFromSelection=function($newChoiceContent){var interactionWidget=this.widget,interaction=interactionWidget.element,$addChoiceBtn=interactionWidget.$container.find(".choice-area .add-option"),qtiEltsRegexp=/{{(\w+?)}}/gm,$nestedWidgets,nestedElts,newChoiceElt,newChoiceBody,newChoiceWidget,serial;for($nestedWidgets=$newChoiceContent.find("[class^=\"widget-\"],[class*=\" widget-\"]"),$nestedWidgets&&0<$nestedWidgets.length&&$nestedWidgets.each(function(){var eltSerial=$(this).data("serial"),elt=interaction.getElement(eltSerial),eltWidget=elt.data("widget");$(this).replaceWith(elt.placeholder()),eltWidget.destroy()}),newChoiceBody=$newChoiceContent.html(),newChoiceElt=interaction.createChoice(newChoiceBody);null!==(nestedElts=qtiEltsRegexp.exec(newChoiceBody));)serial=nestedElts[1],newChoiceElt.setElement(interaction.getElement(serial)),interaction.removeElement(serial);$addChoiceBtn.before(newChoiceElt.render()),newChoiceElt.postRender(),newChoiceWidget=newChoiceElt.data("widget"),newChoiceWidget.changeState("choice")},GapMatchInteractionStateQuestion.prototype.replaceSelectionWithGap=function(){var interactionWidget=this.widget,interaction=interactionWidget.element,$editable=interactionWidget.$container.find(".qti-flow-container [data-html-editable]"),newGapElt;htmlContentHelper.createElements(interaction.getBody(),$editable,htmlEditor.getData($editable),function(newGapWidget){newGapElt=newGapWidget.element,newGapElt.render(newGapElt.getContainer()),newGapElt.postRender(),interaction.setElement(newGapElt),newGapWidget.destroy(),newGapWidget=newGapElt.data("widget"),newGapWidget.changeState("choice")})},GapMatchInteractionStateQuestion.prototype.syncCardinality=function(){var interaction=this.widget.element,response=interaction.getResponseDeclaration(),updateCardinality=function(data){var choice=data.element||data.choice,cardinality;"gap"===choice.qtiClass&&(cardinality=1===_.size(interaction.getGaps())?"single":"multiple",response.attr("cardinality",cardinality))};this.widget.on("elementCreated",updateCardinality).on("deleted",updateCardinality)},GapMatchInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({shuffle:!!interaction.attr("shuffle")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{shuffle:formElement.getAttributeChangeCallback()})},GapMatchInteractionStateQuestion.prototype.preventSingleChoiceDeletion=function(){var interaction=this.widget.element,$container=this.widget.$container,_toggleDeleteButtonVisibility=function(){var choiceCount=0,$deleteButtons=$container.find(".choice-area .qti-choice [data-role=delete]");_.each(interaction.getChoices(),function(choice){choice.data("deleting")||choiceCount++}),1>=choiceCount?$deleteButtons.hide():$deleteButtons.show()};_toggleDeleteButtonVisibility(),this.widget.on("deleted",_toggleDeleteButtonVisibility).on("choiceCreated",_toggleDeleteButtonVisibility),this.widget.afterStateInit(function(e,element,state){"deleting"===state.name&&element.is("gapText")&&_toggleDeleteButtonVisibility()},"question"),this.widget.afterStateExit(function(e,element,state){"deleting"===state.name&&element.is("gapText")&&_toggleDeleteButtonVisibility()},"question")},GapMatchInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){var GapMatchInteractionStateCorrect=stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please fill the gap with the correct choices.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.invoke(corrects,String.prototype.split," "),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list";data.response&&data.response[type]&&("base"==type?response.setCorrect(data.response.base.directedPair.join(" ")):response.setCorrect(_.map(data.response.list.directedPair,function(pair){return pair.join(" ")})))})},function(){var widget=this.widget,interaction=this.widget.element;widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction)});return GapMatchInteractionStateCorrect}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreMappingForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n                    <option value=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</option> \n                    ",buffer}function program5(depth0){var buffer="",stack1;return buffer+="\n            ",stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,stack1,helper,options;return buffer+="<div class=\"form-container\">\n        <h1>",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h1>\n\n        <hr />\n        <div class=\"panel grid-row\">\n            <h2>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add new pairs",options):helperMissing.call(depth0,"__","Add new pairs",options)))+":</h2>\n        </div> \n        <div class=\"panel grid-row\">\n            <div class=\"col-4\">\n                <select class=\"select2 new-pair-left\" data-placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select a ",options):helperMissing.call(depth0,"__","Select a ",options))),(helper=helpers.leftTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.leftTitle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                    <option></option>\n                    ",stack1=helpers.each.call(depth0,depth0&&depth0.pairLeft,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </select>\n             </div>\n             <div class=\"col-4\">\n                <select class=\"select2 new-pair-right\"  data-placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select a ",options):helperMissing.call(depth0,"__","Select a ",options))),(helper=helpers.rightTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.rightTitle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                    <option></option>\n                    ",stack1=helpers.each.call(depth0,depth0&&depth0.pairRight,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </select>\n             </div>\n             <div class=\"col-1\">\n                &nbsp;\n            </div>\n             <div class=\"col-2\">\n                <button class=\"pair-adder btn-info small\"><span class=\"icon-add\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add",options):helperMissing.call(depth0,"__","Add",options)))+"</button>\n            </div> \n        </div>\n        <hr />\n        <div class=\"panel grid-row heading\">\n             <div class=\"col-4\">",(helper=helpers.leftTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.leftTitle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\n             <div class=\"col-3\">",(helper=helpers.rightTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.rightTitle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\n            \n            <div class=\"col-2\" data-edit=\"correct\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.defineCorrect,{hash:{},inverse:self.noop,fn:self.program(3,function(){return"style=\"display:block\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n                <span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Correct",options):helperMissing.call(depth0,"__","Correct",options)))+"</span>\n                <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n                <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Is this pair the correct response?",options):helperMissing.call(depth0,"__","Is this pair the correct response?",options)))+"</span>\n            </div>\n\n            <div class=\"col-2\">\n                <span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Score",options):helperMissing.call(depth0,"__","Score",options)))+"</span>\n                <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n                <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Set the score for this response",options):helperMissing.call(depth0,"__","Set the score for this response",options)))+"</span>\n            </div>\n            <div class=\"col-1\"></div>\n        </div>\n\n        <div class=\"panel pairs\">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.pairs,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </div>\n\n        <hr />\n\n        <span class=\"arrow\"></span>\n        <span class=\"arrow-cover\"></span>\n    </div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"grid-row\">\n    <div class=\"col-4\">\n       ",(helper=helpers.left)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.left,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    <div class=\"col-3\">\n       ",(helper=helpers.right)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.right,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    \n    <div class=\"col-2\" data-edit=\"correct\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.defineCorrect,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"style=\"display:block\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        <label>\n            <input name=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"-correct\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(3,function(){return" checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n            <span class=\"icon-checkbox\"></span>\n        </label>\n    </div>\n\n    <div class=\"col-2\">\n        <input type=\"text\" \n               value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n               name=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"-score\" \n               class=\"score\" \n               ",stack1=helpers["if"].call(depth0,depth0&&depth0.defaultScore,{hash:{},inverse:self.noop,fn:self.program(5,function(){return"data-default=\"true\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="  \n               data-validate=\"$numeric\" \n               data-validate-option=\"$allowEmpty; $event(type=keyup)\" \n        />\n    </div>\n    <div class=\"col-1\">\n        <a href=\"#\" class=\"pair-deleter\" id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"-delete\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove pair",options):helperMissing.call(depth0,"__","Remove pair",options)))+"\"><span class=\"icon-bin\"></span></a>\n    </div>\n</div>",buffer})}),define("ui/tooltipster",["ui/tooltip"],function(tooltip){'use strict';return tooltip=tooltip&&tooltip.hasOwnProperty("default")?tooltip["default"]:tooltip,tooltip}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreMappingForm","tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreForm","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/tooltipster","ui/selecter"],function($,_,__,formTpl,pairTpl,answerStateHelper,formElementHelper,tooltipster,selecter){'use strict';function createPopup($container){var $element=$("<div class=\"mapping-editor arrow-top-left\"></div>"),width=$container.innerWidth(),height=$container.innerHeight();return $(".mapping-editor",$container).remove(),$element.css({top:height-30,width:width-100}).appendTo($container),$element}var separator={html:"::",qti:" "};return function(widget,options){function adder($container){var $adder=$(".pair-adder",$container),$left=$(".new-pair-left",$container),$right=$(".new-pair-right",$container),$options=$(".select2 > option",$container);$left.on("change",function(){var currentLeft=$left.select2("val"),currentRight=$right.select2("val");$options.removeProp("disabled"),_(pairs).where({leftId:currentLeft}).forEach(function(pair){$right.find("option[value=\""+pair.rightId+"\"]").prop("disabled",!0)}),_(pairs).where({rightId:currentRight}).forEach(function(pair){$left.find("option[value=\""+pair.leftId+"\"]").prop("disabled",!0)}),"pair"===options.type&&_(pairs).where({rightId:currentLeft}).forEach(function(pair){$right.find("option[value=\""+pair.leftId+"\"]").prop("disabled",!0)})}),$right.on("change",function(){var currentRight=$right.select2("val"),currentLeft=$left.select2("val");$options.removeProp("disabled"),_(pairs).where({rightId:currentRight}).forEach(function(pair){$left.find("option[value=\""+pair.leftId+"\"]").prop("disabled",!0)}),_(pairs).where({leftId:currentLeft}).forEach(function(pair){$right.find("option[value=\""+pair.rightId+"\"]").prop("disabled",!0)}),"pair"===options.type&&_(pairs).where({leftId:currentRight}).forEach(function(pair){$left.find("option[value=\""+pair.rightId+"\"]").prop("disabled",!0)})}),$adder.on("click",function(e){var lval=$left.select2("val"),rval=$right.select2("val"),key;$options.removeProp("disabled"),e.preventDefault(),lval&&rval&&(key=options.isDirectedPairFlipped?rval+separator.qti+lval:lval+separator.qti+rval,pairScoringForm.addPair(key),$left.select2("val",""),$right.select2("val",""))})}function deleter($container){$container.off("click",".pair-deleter").on("click",".pair-deleter",function(e){var $elt,key;e.preventDefault(),$elt=$(this),key=$elt.attr("id").replace(/-delete$/,"").replace(separator.html,separator.qti),pairScoringForm.removePair(key),$elt.closest(".grid-row").remove()})}function preparePairs(entries){var defaultScore=parseFloat(response.mappingAttributes.defaultValue);return _.map(entries,function(value,key){return formatPair(value,key,parseFloat(value)===defaultScore)})}function formatPair(score,key,defaultScore){var pair=key.split(separator.qti),choice=options.isDirectedPairFlipped?pair[0]:pair[1],gap=options.isDirectedPairFlipped?pair[1]:pair[0];return{id:key.replace(separator.qti,separator.html),score:score,defaultScore:!!defaultScore,leftId:gap,rightId:choice,left:_.isFunction(options.formatLeft)?options.formatLeft(gap):gap,right:_.isFunction(options.formatRight)?options.formatRight(choice):choice,defineCorrect:answerStateHelper.defineCorrect(response),correct:_.contains(_.values(response.getCorrect()),key)}}function updateFormBindings(){var callbacks={},corrects=_.values(response.getCorrect());$form.length&&(widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&_.forEach(pairs,function(pair){var $score=$("[name=\""+pair.id+"-score\"]",$form);$score.data("default")&&($score.val(data.value),response.setMapEntry(pair.id.replace(separator.html,separator.qti),data.value))})}),_.forEach(pairs,function(pair){var id=pair.id.replace(separator.html,separator.qti);callbacks[pair.id+"-score"]=function(response,value){$("[name=\""+pair.id+"-score\"]",$form).removeAttr("data-default").removeData("default"),response.setMapEntry(id,value)},callbacks[pair.id+"-correct"]=function(response,value){!0===value?!_.contains(corrects,id)&&corrects.push(id):corrects=_.without(corrects,id),response.setCorrect(corrects)}}),formElementHelper.setChangeCallbacks($form,response,callbacks))}var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),$popup=[],pairs=[],pairScoringForm={load:function(){var mapEntries=response.getMapEntries();return $popup.length?$popup.empty():$popup=createPopup($container),options&&(options.entries?(pairs=preparePairs(options.entries),response.removeMapEntries(),_.forEach(pairs,function(pair){("undefined"==typeof pair.score||null===pair.score)&&(pair.score=response.mappingAttributes.defaultValue||0),response.setMapEntry(pair.id.replace(separator.html,separator.qti),pair.score)})):pairs=preparePairs(mapEntries),$form=$(formTpl({title:options.title||__("Pair scoring"),leftTitle:options.leftTitle||__("Choices"),rightTitle:options.rightTitle||__("Gap"),defineCorrect:answerStateHelper.defineCorrect(response),scoreMin:response.getMappingAttribute("lowerBound"),scoreMax:response.getMappingAttribute("upperBound"),pairs:_.map(pairs,pairTpl),pairLeft:_.isFunction(options.pairLeft)?options.pairLeft():_.values(interaction.getChoices()),pairRight:_.isFunction(options.pairRight)?options.pairRight():_.values(interaction.getGapImgs())})),updateFormBindings(),$popup.append($form),selecter($popup),tooltipster($popup),deleter($popup),adder($popup)),this},addPair:function(key){var score=response.mappingAttributes.defaultValue,pair=formatPair(score,key,!0);return pairs.push(pair),response.setMapEntry(key,score),$(".pairs",$popup).append(pairTpl(pair)),updateFormBindings(),_.isFunction(options.add)&&options.add(key),this},removePair:function(key){return _.remove(pairs,{id:key.replace(separator.qti,separator.html)}),response.removeMapEntry(key),_.isFunction(options.remove)&&options.remove(key),this},destroy:function destroy(){$popup.length&&$popup.remove(),$("#item-editor-panel").css("overflow","")}},$form;return pairScoringForm.load()}}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,PciResponse,scoringFormFactory){function displayGaps($container){$(".gapmatch-content",$container).removeClass("filled").addClass("gap-info").each(function(){var $elt=$(this);$elt.text($elt.data("identifier"))})}function updateForm(widget,entries){var interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),formatedChoices=_.transform(interaction.getChoices(),function(acc,choice){acc[choice.id()]=choice.id()},{}),options={leftTitle:__("Choice"),rightTitle:__("Gap"),type:"directedPair",pairLeft:function pairLeft(){return _.map(interaction.getChoices(),function(choice){return{id:choice.id(),value:choice.id()}})},pairRight:function pairRight(){return _.map(interaction.getGaps(),function(gap){return{id:gap.id(),value:gap.id()}})},formatLeft:function formatLeft(value){return formatedChoices[value]||value}};entries&&(options.entries=_.transform(entries,function(result,value){result[value]=mapEntries[value]===void 0?response.mappingAttributes.defaultValue:mapEntries[value]},{})),interaction.pairScoringForm=scoringFormFactory(widget,options)}return stateFactory.create(Map,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect()),currentResponses=0===_.size(response.getMapEntries())?corrects:_.keys(response.getMapEntries());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please fill the gap with the texts below, then edit the score for each pair.")),interaction.responseMappingMode=!0,commonRenderer.render.call(interaction.getRenderer(),interaction),displayGaps(widget.$container),0===_.size(response.getMapEntries())?updateForm(widget,corrects):updateForm(widget),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list",pairs,entries;data&&data.response&&data.response[type]&&(pairs=_.invoke(data.response[type].directedPair,Array.prototype.join," "),entries=_.keys(response.getMapEntries()),_(pairs).difference(entries).forEach(interaction.pairScoringForm.addPair,interaction.pairScoringForm)),displayGaps(widget.$container)})},function(){var widget=this.widget,interaction=widget.element;widget.$container.off("responseChange.qti-widget"),interaction.pairScoringForm&&interaction.pairScoringForm.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction)})}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/states"],function(Widget,states){var GapMatchInteractionWidget=Widget.clone();return GapMatchInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},GapMatchInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/Widget"],function(_,GapMatchInteraction,GapMatchInteractionWidget){'use strict';var CreatorGapMatchInteraction=_.clone(GapMatchInteraction);return CreatorGapMatchInteraction.render=function(interaction,options){GapMatchInteractionWidget.build(interaction,GapMatchInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGapMatchInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement"],function($,_,__,graphic,dummyElement){'use strict';return{createPaper:function createPaper(_resize2){var $container=this.$original,$item=$container.parents(".qti-item"),background=this.element.object.attributes,serial=this.element.serial,paper;return background.data?(paper=graphic.responsivePaper("graphic-paper-"+serial,serial,{width:background.width,height:background.height,img:this.options.assetManager.resolve(background.data),imgId:"bg-image-"+serial,container:$container,resize:function resize(){"function"==typeof _resize2&&_resize2.apply(this,arguments)}}),$item.on("resize.gridEdit."+serial,function(){$container.trigger("resize.qti-widget."+serial)})):this._createPlaceholder(),paper},_createPlaceholder:function _createPlaceholder(){var self=this,$container=this.$original,$imageBox=$container.find(".main-image-box"),$editor=$container.find(".image-editor"),diff=$editor.outerWidth()-$editor.width()+($container.outerWidth()-$container.width())+1;dummyElement.get({icon:"image",css:{width:$container.innerWidth()-diff,height:200},title:__("Select an image first.")}).click(function(){var $upload=$("[data-role=\"upload-trigger\"]",self.$form);$upload.length&&$upload.trigger("click")}).appendTo($imageBox)},createChoices:function createChoices(){_.forEach(this.element.getChoices(),this._currentChoices,this)},_currentChoices:function _currentChoices(choice){graphic.createElement(this.element.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,touchEffect:!1})}}}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){'use strict';return stateFactory.extend(SleepState,function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(!0===data.value?interaction.addClass("responsive"):interaction.removeClass("responsive"),widget.rebuild())})},function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)})}),define("tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",helper,options;return buffer+="\n        <li class=\"separator\"></li>\n        <li data-type=\"target\"><span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Drop the target to select a point",options):helperMissing.call(depth0,"__","Drop the target to select a point",options)))+"\" class=\"icon-target\"></span></li>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"image-sidebar\">\n    <ul class=\"none forms\">\n        <li data-type=\"rect\"><span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw a rectangle on the image",options):helperMissing.call(depth0,"__","Draw a rectangle on the image",options)))+"\" class=\"icon-rectangle\"></span></li>\n        <li data-type=\"circle\"><span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw a circle on the image",options):helperMissing.call(depth0,"__","Draw a circle on the image",options)))+"\" class=\"icon-circle\"></span></li>\n        <li data-type=\"ellipse\"><span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw an ellipsis on the image",options):helperMissing.call(depth0,"__","Draw an ellipsis on the image",options)))+"\" class=\"icon-ellipsis\"></span></li>\n        <li data-type=\"path\"><span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw a free form on the image",options):helperMissing.call(depth0,"__","Draw a free form on the image",options)))+"\" class=\"icon-free-form\"></span></li>\n    \n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.showTarget,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <li class=\"separator\"></li>\n        <li class=\"bin disabled\"><span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove the selected shape",options):helperMissing.call(depth0,"__","Remove the selected shape",options)))+"\" class=\"icon-bin\"></span></li>\n    </ul>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar",["jquery","lodash","tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar"],function($,_,sidebarTmpl){'use strict';return{create:function($container,showTarget){var $imageEditor=$container.find(".image-editor"),serial=$container.data("serial"),$sideBar=$(sidebarTmpl({showTarget:!!showTarget}));$imageEditor.prepend($sideBar);var $forms=$("li[data-type]",$sideBar),$bin=$("li.bin",$sideBar),activate=function($form){$forms.filter(".active").each(function(){deactivate($(this))}),$form.addClass("active"),$sideBar.trigger("shapeactive.qti-widget",[$form,$form.data("type")])},deactivate=function($form){$form.removeClass("active"),$sideBar.trigger("shapedeactive.qti-widget",[$form,$form.data("type")])};return $sideBar.on("enablebin.qti-widget",function(){$bin.removeClass("disabled").on("click",function(e){e.preventDefault(),$sideBar.trigger("bin.qti-widget")})}),$sideBar.on("disablebin.qti-widget",function(){$bin.addClass("disabled").off("click")}),$forms.click(function(e){e.preventDefault();var $form=$(this);$form.hasClass("active")?deactivate($form):activate($form)}),$sideBar},remove:function($container){var $sideBar=$(".image-sidebar",$container);$sideBar.length&&($sideBar.remove(),$container.off("resize.qti-widget.sidebar"))}}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers",["jquery","lodash","raphael"],function($,_,Raphael){return function shapeHandlers(paper,element){return _.map(function(element){var scaleFactor=paper.w<paper.width?1:paper.w/paper.width,bbox=element.getBBox(),size=(25<bbox.width?6:4)*scaleFactor,half=size/2,halfWidth=bbox.width/2,halfHeight=bbox.height/2,coords;switch(element.type){case"circle":coords={midTop:[bbox.x+halfWidth-half,bbox.y-size,size,size],midRight:[bbox.x+bbox.width,bbox.y+halfHeight-half,size,size],midBot:[bbox.x+halfWidth-half,bbox.y+bbox.height,size,size],midLeft:[bbox.x-size,bbox.y+halfHeight-half,size,size]};break;case"path":coords={},_.forEach(Raphael.parsePathString(element.attr("path")),function(segment,index){3===segment.length&&(coords["point"+index]=segment.slice(1).concat(half))});break;case"rect":case"ellipse":coords={topLeft:[bbox.x-size,bbox.y-size,size,size],midTop:[bbox.x+halfWidth-half,bbox.y-size,size,size],topRight:[bbox.x+bbox.width,bbox.y-size,size,size],midRight:[bbox.x+bbox.width,bbox.y+halfHeight-half,size,size],botRight:[bbox.x+bbox.width,bbox.y+bbox.height,size,size],midBot:[bbox.x+halfWidth-half,bbox.y+bbox.height,size,size],botLeft:[bbox.x-size,bbox.y+bbox.height,size,size],midLeft:[bbox.x-size,bbox.y+halfHeight-half,size,size]};}return coords}(element),function(handlerCoords,name){var cursor,constraints,hshape;return"path"===element.type?(cursor="move",hshape="circle"):(hshape="rect","topLeft"===name?(cursor="nw-resize",constraints={ix:!0,iy:!0}):"midTop"===name?(cursor="ns-resize",constraints={iy:!0}):"topRight"===name?(cursor="ne-resize",constraints={x:!0,iy:!0}):"midRight"===name?(cursor="ew-resize",constraints={x:!0}):"botRight"===name?cursor="se-resize":"midBot"===name?(cursor="ns-resize",constraints={y:!0}):"botLeft"===name?(cursor="sw-resize",constraints={ix:!0,y:!0}):"midLeft"===name?(cursor="ew-resize",constraints={ix:!0}):void 0),paper[hshape].apply(paper,handlerCoords).attr({fill:"#eeeeee",cursor:cursor}).data("constraints",constraints)})}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function($,_){var _Mathpow2=Math.pow,shapeResizer={rect:function(options){var start=options.start,stop=options.stop,constraints=options.constraints,dest={};return(!constraints||constraints.x)&&(dest.width=stop.x-start.x,0>dest.width&&(dest.x=stop.x,dest.width*=-1)),(!constraints||constraints.y)&&(dest.height=stop.y-start.y,0>dest.height&&(dest.y=stop.y,dest.height*=-1)),constraints&&constraints.ix&&(dest.x=stop.x,dest.width=start.width-(stop.x-start.x),0>dest.width&&(dest.x=stop.x,dest.width*=-1)),constraints&&constraints.iy&&(dest.y=stop.y,dest.height=start.height-(stop.y-start.y),0>dest.height&&(dest.y=stop.y,dest.height*=-1)),10>dest.width&&(dest.width=10),10>dest.height&&(dest.height=10),dest},circle:function(options){var start=options.start,stop=options.stop,rw=stop.x>start.x?stop.x-start.x:start.x-stop.x,rh=stop.y>start.y?stop.y-start.y:start.y-stop.y,r=Math.floor(Math.sqrt(_Mathpow2(rw,2)+_Mathpow2(rh,2)));return{r:5>r?5:r}},ellipse:function(options){var dest={},boxDest=this.rect(options);return boxDest.x&&(dest.x=boxDest.x),boxDest.y&&(dest.y=boxDest.y),boxDest.width&&(dest.rx=boxDest.width/2),boxDest.height&&(dest.ry=boxDest.height/2),dest},path:function(options){var dest={};return options.path&&options.start&&(dest.path="",_.forEach(options.path,function(point,index){dest.path+=point[0],3===point.length&&(index===options.pointIndex||0===options.pointIndex&&1===index?dest.path+=options.stop.x+" "+options.stop.y:dest.path+=point[1]+" "+point[2])})),dest}};return function(element,options){var resizer;element&&element.type&&options.stop&&(resizer=_.bind(shapeResizer[element.type],shapeResizer),!options.start&&(options.start=function(){var startPoint;switch(element.type){case"circle":startPoint={x:element.attrs.cx,y:element.attrs.cy};break;case"ellipse":case"rect":startPoint=element.getBBox();}return startPoint}(element)),_.isFunction(resizer)&&(element.attr(resizer(options)),_.isFunction(options.resized)&&options.resized.call(element)))}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover",["jquery","lodash"],function($,_){var shapeMover={rect:function(start,stop){return{x:stop.x-start.x,y:stop.y-start.y}},circle:function(start,stop){return{cx:stop.x,cy:stop.y}},ellipse:function(start,stop){return{cx:stop.x,cy:stop.y}},path:function(start,stop){var dest={path:""};return _.forEach(start.path,function(point){dest.path+=point[0],3===point.length&&(dest.path+=point[1]+stop.x-start.x+","+(point[2]+stop.y-start.y))}),dest}};return function(element,start,stop){var mover;element&&element.type&&(mover=_.bind(shapeMover[element.type],shapeMover),_.isFunction(mover)&&element.animate(mover(start,stop)))}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function($,_,graphicHelper){return function pathBuilder(paper){return{_path:null,closed:!1,set:null,points:[],getPath:function getPath(){return this._path},start:function start(point){return this.points=[],this.add(point)},add:function add(point){var self=this,scaleFactor=paper.w<paper.width?1:paper.w/paper.width,stop;return stop=paper.circle(point.x,point.y,3*scaleFactor).attr({stroke:"black","stroke-width":1,fill:"white",opacity:.7,cursor:"pointer"}).click(function(e){e.preventDefault(),e.stopPropagation(),2<self.points.length&&(this.attr("fill","green"),self.close())}),0===this.points.length&&(stop.attr("fill","red"),this.set=paper.set(),this._path=paper.path("M"+point.x+","+point.y).attr(graphicHelper._style.active).attr("opacity",.3),this.set.push(this._path)),this.points.push(point),this.set.push(stop),this._path.animate({path:this._path.attr("path")+"L"+point.x+","+point.y}),this},close:function close(){return this._path.attr({path:this._path.attr("path")+"Z"}).attr(graphicHelper._style.active).attr("opacity",1),this.set.forEach(function(elt){"circle"===elt.type&&elt.remove()}),this.closed=!0,_.isFunction(this.closeCb)&&this.closeCb(),this},onClose:function onClose(closeCb){return this.closeCb=closeCb,this}}}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function($,_,graphicHelper,shapeHandlers,shapeResizer,shapeMover,pathBuilder){return function(options){var paper=options.paper,background=options.background,$container=options.$container,isResponsive=options.isResponsive||!1,type=options.type||"rect";return{states:{drawing:!1},_events:{},on:function(eventName,cb){_.isFunction(cb)&&(this._events[eventName]=cb)},is:function(state){return!0===this.states[state]},setState:function(state,value){this.states[state]=value},start:function start(){switch(type){case"path":this.startDrawingPath();break;case"target":this.startPositionTarget();break;default:this.startWithMouse();}},startPositionTarget:function(){var self=this;self.setState("drawing",!0),background.click(function(e){e.preventDefault(),e.stopPropagation();var point=graphicHelper.getPoint(e,paper,$container,isResponsive);graphicHelper.createTarget(paper,{point:point,create:function(target){self.setState("drawing",!1),background.unclick(),self._events["created.qti-widget"]&&self._events["created.qti-widget"].call(this,target)},remove:!1,hover:!1})})},startDrawingPath:function(){var self=this,builder=pathBuilder(paper);self.setState("drawing",!0),builder.onClose(function(){self.setState("drawing",!1),background.unclick(),self._events["created.qti-widget"]&&self._events["created.qti-widget"].call(this,builder.getPath())}),background.click(function(e){e.preventDefault(),e.stopPropagation(),self.is("drawing")&&builder.add(graphicHelper.getPoint(e,paper,$container,isResponsive))})},startWithMouse:function(){function created(){self.setState("drawing",!1),background.unmousedown().unmousemove().unmouseup(),shape.unmousedown().unmouseup().unmousemove(),self._events["created.qti-widget"]&&self._events["created.qti-widget"].call(this,shape)}function resize(event){self.is("drawing")&&shapeResizer(shape,{start:startPoint,stop:graphicHelper.getPoint(event,paper,$container,isResponsive)})}var self=this,smoothResize=_.throttle(resize,10),startPoint,shape;background.mousedown(function(event){event.preventDefault(),self.is("drawing")||(self.setState("drawing",!0),startPoint=graphicHelper.getPoint(event,paper,$container,isResponsive),shape=graphicHelper.createElement(paper,type,[startPoint.x,startPoint.y,25,25],{style:"creator",hover:!1,touchEffect:!1,qtiCoords:!1}),shape.mouseup(created),background.mouseup(created),shape.mousemove(smoothResize),background.mousemove(smoothResize))})},stop:function stop(){background.unmousedown().unmousemove().unmouseup().unclick()}}}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function($,_,graphicHelper,shapeHandlers,shapeResizer,shapeMover){return function shapeEditor(shape,options){var paper=options.paper,background=options.background,$container=options.$container,isResponsive=options.isResponsive||!1;return{shape:null,handlers:[],states:{drawing:!1,handling:!1,resizing:!1,moving:!1},_events:{},on:function(eventName,cb){return _.isFunction(cb)&&(this._events[eventName]=cb),this},trigger:function trigger(eventName){return _.isFunction(this._events[eventName])&&this._events[eventName].apply(this,Array.prototype.slice.call(arguments,1)),this},is:function(state){return!0===this.states[state]},setState:function(state,value){return this.states[state]=value,this},_init:function _init(shape){var self=this;return shape&&shape.type&&(self.shape=shape,background.click(function(){!self.is("resizing")&&self.is("handling")&&self.quitHandling()}),self.shape.click(function(){self.is("resizing")||(self.is("handling")?self.quitHandling():self.enterHandling())})),this},enterHandling:function(){function startResize(){var handler=this,bbox;self.setState("resizing",!0).trigger("shapechanging.qti-widget"),self.layer=self.shape.clone(),self.layer.attr(graphicHelper._style.basic),self.layer.attr("cursor",handler.attrs.cursor),bbox=self.layer.getBBox(),self.layerTxt=graphicHelper.createShapeText(paper,self.layer,{style:"layer-pos-text",content:parseInt(bbox.width,10)+" x "+parseInt(bbox.height,10)}),"path"===self.shape.type&&_.forEach(self.shape.attr("path"),function(point,index){if(3===point.length&&point[1]===this.attr("cx")&&point[2]===this.attr("cy"))return this.pointIndex=index,!1},handler),_.invoke(_.reject(_.clone(self.handlers),function(elt){return elt===handler}),"hide")}function resize(dx,dy,x,y,event){var stopPoint,options;self.is("resizing")&&(stopPoint=graphicHelper.getPoint(event,paper,$container,isResponsive),options={stop:stopPoint,constraints:this.data("constraints"),resized:_.throttle(function(){var bbox=this.getBBox();self.layerTxt.attr("text",parseInt(bbox.width,10)+" x "+parseInt(bbox.height,10))},100)},"path"===self.shape.type&&(options.start=_.pick(this.attrs,["cx","cy"]),options.path=self.layer.attr("path"),options.pointIndex=this.pointIndex),shapeResizer(self.layer,options),"circle"===this.type?this.animate({cx:stopPoint.x,cy:stopPoint.y}):this.animate(stopPoint))}function resized(){self.shape.animate(_.pick(self.layer.attrs,["x","y","cx","cy","r","rx","ry","width","height","path"]),200,function(){self.setState("resizing",!1).trigger("shapechange.qti-widget")}),self.layer.remove(),self.layerTxt.remove(),_.invoke(self.handlers,"remove"),self.handlers=[]}function keyResize(code){var attr,stop,start;if(!self.is("moving")){switch(self.setState("moving",!0),_.invoke(self.handlers,"remove"),attr=shape.attr(),self.shape.type){case"rect":start={x:0,y:0},stop={x:39===code?attr.x+1:37===code?attr.x-1:attr.x,y:40===code?attr.y+1:38===code?attr.y-1:attr.y};break;case"ellipse":case"circle":start={x:0,y:0},stop={x:39===code?attr.cx+1:37===code?attr.cx-1:attr.cx,y:40===code?attr.cy+1:38===code?attr.cy-1:attr.cy};break;case"path":start={path:attr.path},stop={};}shapeMover(self.shape,start,stop),self.setState("moving",!1).trigger("shapechange.qti-widget")}}function startMove(x,y,event){self.setState("moving",!0).trigger("shapechanging.qti-widget");var mousePoint=graphicHelper.getPoint(event,paper,$container,isResponsive);this.startPoint={x:mousePoint.x-this.attr("x"),y:mousePoint.y-this.attr("y")},"path"===this.type&&(this.startPoint.path=this.attr("path")),self.shape.attr("cursor","move"),background.attr("cursor","move"),_.invoke(self.handlers,"remove")}function move(dx,dy,x,y,event){self.is("moving")&&shapeMover(this,this.startPoint,graphicHelper.getPoint(event,paper,$container,isResponsive))}function moved(){delete this.startPoint,self.shape.attr("cursor","pointer"),background.attr("cursor","default"),self.setState("moving",!1).trigger("shapechange.qti-widget")}var self=this;if(self.setState("handling",!0).trigger("enterhandling.qti-widget"),"set"!==self.shape.type){self.handlers=shapeHandlers(paper,self.shape),_.forEach(self.handlers,function(handler){handler.drag(resize,startResize,resized)}),self.shape.drag(move,startMove,moved);var keyResizer=_.throttle(keyResize,20);return $(document).on("keydown.qti-widget",function(e){var code=e.which;37<=code&&40>=code&&(e.preventDefault(),keyResizer(code))}),this}},quitHandling:function(){return $(document).off("keydown.qti-widget"),this.shape.undrag(),_.invoke(this.handlers,"remove"),this.handlers=[],this.setState("moving",!1).setState("resizing",!1).setState("handling",!1).trigger("quithandling.qti-widget"),this},removeShape:function(){var id,data;return this.shape&&(this.quitHandling(),id=this.shape.id,data=this.shape.data,this.shape.remove(),this.trigger("remove.qti-widget",id,data)),this},destroy:function(){return this.is("handling")&&this.quitHandling(),this.shape&&(this.shape.unclick(),background.unclick()),this.shape=null,this.handlers=[],this._events={},this}}._init(shape)}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor"],function($,_,GraphicHelper,shapeSideBar,shapeFactory,shapeEditor){return function(widget,options){return{editors:[],create:function create(){function editShape(shape,enterHandling){var editor=shapeEditor(shape,shapeOptions);editor.on("enterhandling.qti-widget",function(){_.invoke(_.reject(editors,editor),"quitHandling"),$sideBar.trigger("enablebin.qti-widget").on("bin.qti-widget",function(){editor.removeShape(),editor.destroy(),editors=_.reject(editors,editor),editor=void 0}),_.isFunction(options.enterHandling)&&options.enterHandling(shape)}).on("shapechanging.qti-widget",function(){_.isFunction(options.shapeChanging)&&options.shapeChanging(shape)}).on("shapechange.qti-widget",function(){_.isFunction(options.shapeChange)&&options.shapeChange(shape)}).on("quithandling.qti-widget",function(){_.isFunction(options.quitHandling)&&options.quitHandling(shape),$sideBar.trigger("disablebin.qti-widget").off("click").off("bin.qti-widget")}).on("remove.qti-widget",function(id,data){_.isFunction(options.shapeRemoved)&&options.shapeRemoved(id,data),_.remove(currents,id)}),editors.push(editor),enterHandling&&editor.enterHandling()}function createShape(type,created){var factory=factories[type];factories[type]||(factory=shapeFactory(_.merge({type:type},shapeOptions)),factories[type]=factory),factory.on("created.qti-widget",created),factory.start()}function editCreatedShape(type,shape,enterHandling){var layer,set;"target"===type?(layer=paper.getById("layer-"+shape.id),set=paper.set(shape,layer),set.id=shape.id,set.data=shape.data(),editShape(set,enterHandling)):editShape(shape,enterHandling)}var editors=this.editors,factories={},$container=widget.$container,$original=widget.$original,interaction=widget.element,paper=interaction.paper,image=paper.getById("bg-image-"+interaction.serial),currents=options.currents||_.pluck(interaction.getChoices(),"serial"),shapeOptions={paper:interaction.paper,background:image,$container:$container.find(".main-image-box"),isResponsive:$original.hasClass("responsive")},$sideBar=shapeSideBar.create($original,!!options.target);$sideBar.on("shapeactive.qti-widget",function(e,$form,type){createShape(type,function(shape){_.isFunction(options.shapeCreated)&&options.shapeCreated(shape,type),$form.removeClass("active"),editCreatedShape(type,shape)})}),$sideBar.on("shapedeactive.qti-widget",function(e,$form,type){factories&&factories[type]&&factories[type].stop()}),_.forEach(currents,function(id){var element=paper.getById(id);element&&(element.attr(GraphicHelper._style.creator).unmouseover().unmouseout(),/^target/.test(element.id)?editCreatedShape("target",element):editCreatedShape(element.type,element,!1))})},destroy:function destroy(){var $container=widget.$original,interaction=widget.element,paper=interaction.paper,currents=options.currents||_.pluck(interaction.getChoices(),"serial");shapeSideBar.remove($container),_.invoke(this.editors,"destroy"),_.forEach(currents,function(id){var element=paper.getById(id);element&&element.attr(GraphicHelper._style.basic).hover(function(){element.flashing||GraphicHelper.updateElementState(this,"hover")},function(){element.flashing||GraphicHelper.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")})})}}}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager",["jquery","lodash","i18n","util/image","ui/resourcemgr"],function($,_,__,imageUtil){'use strict';return function($element,options){$element.resourcemgr({title:options.title,appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:"image/jpeg,image/png,image/gif"},pathParam:"path",select:function select(e,files){var selected;0<files.length&&(selected=files[0],imageUtil.getSize(options.baseUrl+encodeURIComponent(files[0].file),function(size){$element.trigger("selected.upload",{selected:selected,size:size})}))}})}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector",["jquery","lodash","i18n","util/image","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","ui/resourcemgr","ui/tooltip"],function($,_,__,imageUtil,resourceManager){'use strict';return function($form,options){var $upload=$("[data-role=\"upload-trigger\"]",$form),$src=$("input[name=data]",$form),$width=$("input[name=width]",$form),$height=$("input[name=height]",$form),$type=$("input[name=type]",$form);options.title=options.title?options.title:__("Please select a background picture for your interaction from the resource manager.                      You can add new files from your computer with the button \"Add file(s)\".");var _openResourceMgr=function(){$upload.on("selected.upload",function(e,args){args.size&&0<=args.size.width&&($width.val(args.size.width).trigger("change"),$height.val(args.size.height).trigger("change")),$type.val(args.selected.mime).trigger("change"),_.defer(function(){$src.val(args.selected.file).trigger("change")})}).on("open",function(){$src.trigger("open..imageSelector"),$src.data("$tooltip")&&$src.blur().data("$tooltip").hide()}).on("close",function(){$src.trigger("close..imageSelector")}),resourceManager($upload,options)};$upload.on("click",_openResourceMgr),$src.val()||_openResourceMgr()}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"data\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n        <input type=\"text\" name=\"data\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n    </div>\n\n    <div class=\"panel media-sizer-panel\">\n        <!-- media sizer goes here -->\n    </div>\n    <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n    <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n\n\n    <input name=\"type\" value=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" readonly />\n\n</div>\n<div class=\"panel min-max-panel\">\n\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed associations",options):helperMissing.call(depth0,"__","Allowed associations",options)))+"</h3>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"identifier",options):helperMissing.call(depth0,"__","identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n           name=\"identifier\"\n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n           placeholder=\"e.g. my-hotspot_1\"\n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed number of matches",options):helperMissing.call(depth0,"__","Allowed number of matches",options)))+"</h3>\n</div>\n\n<div class=\"panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shape position",options):helperMissing.call(depth0,"__","Shape position",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"x\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Left",options):helperMissing.call(depth0,"__","Left",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n        <input name=\"x\" value=\"",(helper=helpers.x)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.x,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n    </div>\n\n    <div class=\"panel\">\n        <label for=\"y\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Top",options):helperMissing.call(depth0,"__","Top",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n        <input name=\"y\" value=\"",(helper=helpers.y)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.y,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n    </div>\n\n    <div class=\"panel\">\n        <label for=\"width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n        <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n    </div>\n\n    <div class=\"panel\">\n        <label for=\"height\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n        <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n    </div>\n</div>",buffer})}),define("ui/mediasizer",["jquery","lodash","core/pluginifier","handlebars","i18n","lib/dompurify/purify","nouislider","ui/tooltip"],function($$1,_,Pluginifier,Handlebars,__,DOMPurify){'use strict';var _Mathmax14=Math.max;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function tpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function _round(value,precision){var factor=Math.pow(10,precision);return Math.round(value*factor)/factor}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"media-sizer media-sizer-synced\">\n\n    <div class=\"media-sizer-responsive-toggle\">\n        <label>\n        <input type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.responsive,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"media-mode-switch\"/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Responsive mode",options):helperMissing.call(depth0,"__","Responsive mode",options)))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"warning\"></span>\n\n        <div class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Media resize along with their container, e.g. 50% means half of the container size not half of the media size.",options):helperMissing.call(depth0,"__","Media resize along with their container, e.g. 50% means half of the container size not half of the media size.",options)))+"\n        </div>\n    </div>\n\n\n    <div class=\"media-sizer-percent\">\n        <label for=\"media-sizer-percent-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Size",options):helperMissing.call(depth0,"__","Size",options)))+"</label>\n        <span class=\"item-editor-unit-input-box\">\n            <input type=\"text\" name=\"width\" id=\"media-sizer-percent-width\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty;\"/>\n        </span>\n\n        <div class=\"media-sizer-reset media-sizer-reset-percent\" data-unit=\"percent\">\n            <span class=\"icon-reset\"></span>\n        </div>\n\n        <div class=\"media-sizer-slider-box\">\n            <div class=\"media-sizer-slider\"></div>\n        </div>\n    </div>\n\n    <div class=\"media-sizer-pixel\">\n        <label for=\"media-sizer-pixel-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+"</label>\n        <span class=\"item-editor-unit-input-box\">\n            <input type=\"text\" name=\"width\" id=\"media-sizer-pixel-width\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty;\"/>\n        </span>\n\n        <label for=\"media-sizer-pixel-height\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+"</label>\n        <span class=\"item-editor-unit-input-box\">\n            <input type=\"text\" name=\"height\" id=\"media-sizer-pixel-height\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty;\"/>\n        </span>\n\n        <div class=\"media-sizer-sync\">\n            <span class=\"icon-link\"></span>\n        </div>\n\n        <div class=\"media-sizer-reset media-sizer-reset-pixel\" data-unit=\"pixel\">\n            <span class=\"icon-reset\"></span>\n        </div>\n\n        <div class=\"media-sizer-slider-box\">\n            <div class=\"media-sizer-slider\"></div>\n            <div class=\"media-sizer-cover\"></div>\n        </div>\n    </div>\n</div>",buffer}),ns="mediasizer",dataNs="ui."+ns,defaults={disableClass:"disabled",applyToMedium:!0,denyCustomRatio:!0,responsive:!0,showResponsiveToggle:!0,showReset:!0,showSync:!0},MediaSizer;MediaSizer={_publicArgs:function($elt,options){var params=this._getValues($elt);return params.$target=options.target||$$1(),params.$resetBtn=options.$resetBtn,params},_getSizeProps:function($elt){var options=$elt.data(dataNs),minWidth=_.isNumber(options.minWidth)?options.minWidth:0,$medium,naturalWidth,naturalHeight,containerWidth,displaySize,maxWidth;return options.hasTarget?($medium=options.target,displaySize=$medium[0].getBoundingClientRect(),options.width=displaySize.width,options.height=displaySize.height,naturalWidth=$medium[0].naturalWidth||options.width,naturalHeight=$medium[0].naturalHeight||options.height,containerWidth=function(){var $parentContainer=options.parentSelector?$medium.parents(options.parentSelector):$medium.parent().parent(),_maxWidth;return options.maxWidth?options.maxWidth:(_maxWidth=$parentContainer.css("max-width"),"none"===_maxWidth?$parentContainer.innerWidth():parseInt(_maxWidth))}()):(naturalWidth=options.width,naturalHeight=options.height,containerWidth=options.maxWidth||options.width),maxWidth=_Mathmax14(containerWidth,naturalWidth),{px:{natural:{width:naturalWidth,height:naturalHeight},current:{width:options.width,height:options.height}},"%":{natural:{width:100,height:null},current:{width:100*options.width/containerWidth,height:null}},ratio:{natural:naturalWidth/naturalHeight,current:options.width/options.height},containerWidth:containerWidth,sliders:{"%":{min:100*minWidth/maxWidth,max:100,start:100*options.width/containerWidth},px:{min:minWidth,max:maxWidth,start:+options.width}},currentUnit:"%"}},_initSyncBtn:function($elt){var options=$elt.data(dataNs),$mediaSizer=$elt.find(".media-sizer"),self=this,$syncBtn=$elt.find(".media-sizer-sync");return options.showSync||($syncBtn.hide(),$mediaSizer.addClass("media-sizer-sync-off")),$syncBtn.on("click",function(){$mediaSizer.toggleClass("media-sizer-synced"),options.syncDimensions=$mediaSizer.hasClass("media-sizer-synced"),options.syncDimensions&&self._sync($elt,options.$fields.px.width,"blur")}),$syncBtn},_initResetBtn:function($elt){var options=$elt.data(dataNs),$resetBtn=$elt.find(".media-sizer-reset");return options.showReset||$elt.find(".media-sizer").addClass("media-sizer-reset-off"),$resetBtn.on("click",function(){options.$fields.px.width.val(options.originalSizeProps.px.current.width).trigger("sliderchange")}),$resetBtn},_initBlocks:function($elt){var options=$elt.data(dataNs),_blocks={},$responsiveToggleField=$elt.find(".media-mode-switch"),self=this,_checkMode=function(){$responsiveToggleField.is(":checked")?(_blocks.px.hide(),_blocks["%"].show(),options.sizeProps.currentUnit="%",options.$fields&&options.$fields["%"].width.val()>options.sizeProps.sliders["%"].max&&(options.$fields["%"].width.val(options.sizeProps.sliders["%"].max),self._sync($elt,options.$fields["%"].width,"blur"))):(_blocks["%"].hide(),_blocks.px.show(),options.sizeProps.currentUnit="px")};return options.showResponsiveToggle||$elt.find(".media-sizer").addClass("media-sizer-responsivetoggle-off"),_(["px","%"]).forEach(function(unit){_blocks[unit]=$elt.find(".media-sizer-"+("px"===unit?"pixel":"percent")),_blocks[unit].prop("unit",unit),_blocks[unit].find("input").data("unit",unit).after($$1("<span>",{class:"unit-indicator",text:unit}))}),$responsiveToggleField.on("click",function(){_checkMode(),$elt.trigger("responsiveswitch."+ns,[$responsiveToggleField.is(":checked")]),$elt.trigger("sizechange."+ns,self._publicArgs($elt,options))}),_checkMode(),_blocks},_initSliders:function($elt){var options=$elt.data(dataNs),_sliders={};return _(options.$blocks).forOwn(function($block,unit){_sliders[unit]=$block.find(".media-sizer-slider"),_sliders[unit].prop("unit",unit),_sliders[unit].noUiSlider({start:options.sizeProps.sliders[unit].start,range:{min:options.sizeProps.sliders[unit].min,max:options.sizeProps.sliders[unit].max}}).on("slide",function(){var $slider=$$1(this),_unit=$slider.prop("unit");options.$fields[_unit].width.val(_round($slider.val(),0)).trigger("sliderchange")})}),_sliders},_sync:function($elt,$field,eventType){var self=this,options=$elt.data(dataNs),unit=$field.prop("unit"),dimension=$field.prop("dimension"),value=parseFloat($field.val()),heightValue,ratio,otherBlockUnit,otherBlockWidthValue,otherBlockHeightValue,currentValues;if(eventType="sliderchange"===eventType?"sliderEvent":"fieldEvent",!isNaN(value)){if(0<options.sizeProps.px.current.width&&0<options.sizeProps.px.current.height&&(options.sizeProps.ratio.current=options.sizeProps.px.current.width/options.sizeProps.px.current.height),ratio=options.denyCustomRatio?options.sizeProps.ratio.natural:options.sizeProps.ratio.current,ratio=ratio?ratio:1,"height"===dimension&&"px"===unit)if(options.sizeProps.px.current.height=value,options.syncDimensions)options.sizeProps.px.current.width=value*ratio,options.sizeProps.ratio.current=options.sizeProps.px.current.width/options.sizeProps.px.current.height,options.$fields.px.width.val(_round(options.sizeProps.px.current.width,0)),value=parseFloat(options.$fields.px.width.val());else return options.sizeProps["%"].current.height=null,options.applyToMedium&&(currentValues=this._getValues($elt),options.target.attr("width",currentValues.width),options.target.attr("height",currentValues.height)),void $elt.trigger("sizechange."+ns,this._publicArgs($elt,options));"px"===unit?(otherBlockUnit="%",otherBlockWidthValue=100*value/options.sizeProps.containerWidth):(otherBlockUnit="px",otherBlockWidthValue=value*options.sizeProps.containerWidth/100),options.sizeProps[unit].current.width=value,options.sizeProps[otherBlockUnit].current.width=otherBlockWidthValue,options.syncDimensions&&(heightValue=value/ratio,otherBlockHeightValue=otherBlockWidthValue/ratio,options.sizeProps[unit].current.height=heightValue,options.$fields[unit].height.val(_round(heightValue,0)),options.sizeProps[otherBlockUnit].current.height=otherBlockHeightValue,options.$fields[otherBlockUnit].height.val(_round(otherBlockHeightValue,0))),"sliderEvent"!==eventType&&options.$sliders[unit].val(value),options.$sliders[otherBlockUnit].val(otherBlockWidthValue),options.$fields[otherBlockUnit].width.val(_round(otherBlockWidthValue,0)),options.sizeProps["%"].current.height=null,options.applyToMedium&&(currentValues=this._getValues($elt),options.target.attr("width",currentValues.width),options.target.attr("height",currentValues.height||"auto")),$elt.trigger("sizechange."+ns,self._publicArgs($elt,options))}},_initFields:function($elt){var options=$elt.data(dataNs),dimensions=["width","height"],_fields={},self=this,field;return _(options.$blocks).forOwn(function($block,unit){_fields[unit]={},options.$blocks[unit].find("input").each(function(){_(dimensions).forEach(function(dim){field=options.$blocks[unit].find("[name=\""+dim+"\"]"),_fields[unit][dim]=field.length?field:$$1("<input>"),_fields[unit][dim].prop({unit:unit,dimension:dim}),_fields[unit][dim].val(_round(options.sizeProps[unit].current[dim],0)),_fields[unit][dim].data({min:0,max:options.sizeProps.sliders[unit].max}),_fields[unit][dim].on("keydown",function(e){var $field=$$1(this),c=e.keyCode,specChars=function(){var chars=[8,37,39,46];return-1===$field.val().indexOf(".")&&(chars.push(190),chars.push(110)),chars}();return _.contains(specChars,c)||48<=c&&57>=c||96<=c&&105>=c}),_fields[unit][dim].on("keyup blur sliderchange",function(e){var $field=$$1(this),value=$field.val().replace(/,/g,".");$field.val(value),value>$field.data("max")?$field.val($field.data("max")):value<$field.data("min")&&$field.val($field.data("min")),self._sync($elt,$$1(this),e.type)})})})}),_fields},_getValues:function($elt){var options=$elt.data(dataNs),attr={};return _.forOwn(options.sizeProps[options.sizeProps.currentUnit].current,function(value,dimension){value=_.isNull(value)?"":_round(value,0).toString(),"%"===options.sizeProps.currentUnit&&""!==value&&(value+=options.sizeProps.currentUnit),attr[dimension]=value}),attr},init:function(options){return options=$$1.extend(!0,{},defaults,options),this.each(function(){var $elt=$$1(this);if(options.hasTarget=options.target&&options.target.length,options.width=options.width||options.naturalWidth,options.height=options.height||options.naturalHeight,options.naturalWidth=options.naturalWidth||options.width,options.naturalHeight=options.naturalHeight||options.height,options.hasSize=options.width&&options.height&&_.isFinite(+options.width)&&_.isFinite(+options.height),!options.hasTarget&&!options.hasSize)throw new Error("MediaSizer::init() You must either set width and height or a target element");else if(!options.hasTarget&&options.applyToMedium)throw new Error("MediaSizer::init() options.applyToMedium can only be true if a target element is provided");else options.hasTarget&&options.hasSize&&(delete options.width,delete options.height,options.hasSize=!1);$elt.data(dataNs)||($elt.html(tpl({responsive:"undefined"==typeof options.responsive||!!options.responsive})),$elt.data(dataNs,options),options.sizeProps=MediaSizer._getSizeProps($elt),options.originalSizeProps=_.cloneDeep(options.sizeProps),options.syncDimensions=$elt.find(".media-sizer").hasClass("media-sizer-synced"),options.$blocks=MediaSizer._initBlocks($elt),options.$fields=MediaSizer._initFields($elt),options.$sliders=MediaSizer._initSliders($elt),options.$syncBtn=MediaSizer._initSyncBtn($elt),options.$resetBtn=MediaSizer._initResetBtn($elt),$elt.trigger("create."+ns,MediaSizer._publicArgs($elt,options)))})},destroy:function(){this.each(function(){var $elt=$$1(this);$elt.trigger("destroy."+ns)})}},Pluginifier.register(ns,MediaSizer)}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage",["util/url","util/image","ui/mediasizer"],function(url,imageUtil){'use strict';function setupMediaSizer(widget){var $mediaSizer=widget.$form.find(".media-sizer-panel");return $mediaSizer.empty().mediasizer({target:widget.$original.find(".svggroup svg image"),showResponsiveToggle:!1,showSync:!1,responsive:!1,parentSelector:widget.$original.attr("id"),applyToMedium:!1,maxWidth:parseInt(widget.element.object.attr("width"),10)}),$mediaSizer.on("sizechange.mediasizer",function(e,params){var width=parseInt(params.width,10),height=parseInt(params.height,10);widget.element.object.attr("width",width),widget.element.object.attr("height",height),widget.$original.trigger("resize.qti-widget."+widget.serial,[width,height])}),$mediaSizer}return{setupImage:function(widget){var $bgImage=widget.$original.find(".svggroup svg image");widget.$original.hasClass("responsive")||!!$bgImage.length&&setupMediaSizer(widget)},setChangeCallbacks:function(widget,formElement,callbacks){callbacks=callbacks||{},callbacks.data=function(interaction,value){interaction.object.attr("data",url.encodeAsXmlAttr(value)),imageUtil.getSize(widget.options.assetManager.resolve(value),function(size){size&&(interaction.object.attr("width",size.width),interaction.object.attr("height",size.height)),widget.rebuild({ready:function ready(widgetReady){widgetReady.changeState("question")}})})},callbacks.width=function(interaction,value){interaction.object.attr("width",parseInt(value,10))},callbacks.height=function(interaction,value){interaction.object.attr("height",parseInt(value,10))},callbacks.type=function(interaction,value){value&&""!==value?interaction.object.attr("type",value):interaction.object.removeAttr("type")},formElement.setChangeCallbacks(widget.$form,widget.element,callbacks,{validateOnInit:!1})}}}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage"],function($,_,__,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,minMaxComponentFactory,identifierHelper,formTpl,choiceFormTpl,panel,bgImage){'use strict';var _Mathround10=Math.round,GraphicAssociateInteractionStateQuestion=stateFactory.extend(Question,function(){function enterChoiceForm(serial){var choice=interaction.getChoice(serial),element,bbox;if(choice){element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),minMaxComponentFactory($choiceForm.find(".min-max-panel"),{min:{fieldName:"matchMin",value:_.parseInt(choice.attr("matchMin"))||0,helpMessage:__("The minimum number of choices this choice must be associated with to form a valid response.")},max:{fieldName:"matchMax",value:_.parseInt(choice.attr("matchMax"))||0,helpMessage:__("The maximum number of choices this choice may be associated with.")},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),formElement.initWidget($choiceForm);var callbacks=formElement.getMinMaxAttributeCallbacks($choiceForm,"matchMin","matchMax");callbacks.identifier=identifierHelper.updateChoiceIdentifier,callbacks.fixed=formElement.getAttributeChangeCallback(),formElement.setChangeCallbacks($choiceForm,choice,callbacks),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm)}}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}var widget=this.widget,interaction=widget.element,paper=interaction.paper,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar"),$left,$top,$width,$height;paper&&(widget._editor=shapeEditor(widget,{shapeCreated:function shapeCreated(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function shapeRemoved(id){interaction.removeChoice(id)},enterHandling:function enterHandling(shape){enterChoiceForm(shape.id)},quitHandling:function quitHandling(){leaveChoiceForm()},shapeChange:function shapeChange(shape){var choice=interaction.getChoice(shape.id),bbox;choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create())},function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("graphicAssociateInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0))});return GraphicAssociateInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form,getMaxPairs=function(choices){return 0<choices?_Mathround10(choices*(choices-1)/2):0};$form.html(formTpl({baseUrl:options.baseUrl,data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{fieldName:"minAssociations",value:_.parseInt(interaction.attr("minAssociations"))||0,helpMessage:__("The minimum number of associations that the candidate is required to make to form a valid response.")},max:{fieldName:"maxAssociations",value:_.parseInt(interaction.attr("maxAssociations"))||0,helpMessage:__("The maximum number of associations that the candidate is allowed to make.")},upperThreshold:getMaxPairs(_.size(interaction.getChoices()))}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,getMaxPairs(_.size(interaction.getChoices())))})}),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks($form,"minAssociations","maxAssociations"))},GraphicAssociateInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){'use strict';return stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please set the correct associations by linking the choices.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.invoke(corrects,String.prototype.split," "),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){data.response&&data.response.list&&response.setCorrect(_.map(data.response.list.pair,function(pair){return pair.join(" ")}))}))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,scoringFormFactory){'use strict';function removePaths(interaction){_.delay(function(){_.forEach(interaction._vsets,function(vset){_.invoke(vset,"remove")}),interaction._vsets=[]},500)}function showChoicesId(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&graphicHelper.createShapeText(interaction.paper,element,{shapeClick:!0,content:choice.id()}).transform("t0,-10").toFront()})}function updateForm(widget,entries){var interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),getPairValues=function(){return _.map(interaction.getChoices(),function(choice){return{id:choice.id(),value:choice.id()}})},options={leftTitle:__("left"),rightTitle:__("right"),type:"pair",pairLeft:getPairValues,pairRight:getPairValues};entries&&(options.entries=_.transform(entries,function(result,value){result[value]=mapEntries[value]===void 0?response.mappingAttributes.defaultValue:mapEntries[value]},{})),interaction.pairScoringForm=scoringFormFactory(widget,options)}return stateFactory.create(Map,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect()),currentResponses=0===_.size(response.getMapEntries())?corrects:_.keys(response.getMapEntries());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Create assocations and fill the score in the form below")),interaction.responseMappingMode=!0,commonRenderer.render.call(interaction.getRenderer(),interaction),showChoicesId(interaction),0===_.size(response.getMapEntries())?updateForm(widget,corrects):updateForm(widget),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list",pairs,entries;data&&data.response&&data.response[type]&&(pairs=_.invoke(data.response[type].pair,Array.prototype.join," "),entries=_.keys(response.getMapEntries()),_(pairs).difference(entries).forEach(interaction.pairScoringForm.addPair,interaction.pairScoringForm),removePaths(interaction))}))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),interaction.pairScoringForm&&interaction.pairScoringForm.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states"],function($,_,__,Widget,GraphicWidget,states){'use strict';var GraphicAssociateInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function initCreator(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(),paper&&(this.element.paper=paper,this.createChoices())},destroy:function destroy(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)}});return GraphicAssociateInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget"],function(_,GraphicAssociateInteraction,GraphicAssociateInteractionWidget){'use strict';var CreatorGraphicAssociateInteraction=_.clone(GraphicAssociateInteraction);return CreatorGraphicAssociateInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),GraphicAssociateInteractionWidget.build(interaction,GraphicAssociateInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGraphicAssociateInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){'use strict';return stateFactory.extend(SleepState,function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(!0===data.value?interaction.addClass("responsive"):interaction.removeClass("responsive"),widget.rebuild())})},function(){var widget=this.widget;$(".image-editor.solid, .block-listing.source",widget.$container).css("min-width",0)})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"data\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n        <input type=\"text\" name=\"data\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n    </div>\n\n    <div class=\"panel media-sizer-panel\">\n        <!-- media sizer goes here -->\n    </div>\n<input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n<input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n\n    <input type=\"hidden\" name=\"type\" value=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"identifier",options):helperMissing.call(depth0,"__","identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n            name=\"identifier\"\n            value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n            placeholder=\"e.g. my-hotspot_1\"\n            data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n<div class=\"panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Choice Image",options):helperMissing.call(depth0,"__","Choice Image",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"data\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n        <input type=\"text\" name=\"data\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n    </div>\n\n    <div class=\"panel media-sizer-panel\">\n        <!-- media sizer goes here -->\n    </div>\n\n    <input name=\"type\" type=\"hidden\" value=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" />\n</div>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max. number of matches",options):helperMissing.call(depth0,"__","Max. number of matches",options)))+" </h3>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,__,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,identifierHelper,minMaxComponentFactory,formTpl,choiceFormTpl,gapImgFormTpl,mediaTlbTpl,panel,resourceManager,bgImage){"use strict";function applyMediasizerValues(params,factor){factor=factor||1,params.$target.css({width:params.width*factor,height:params.height*factor}).attr("width",params.width).attr("height",params.height)}var GraphicGapMatchInteractionStateQuestion;return GraphicGapMatchInteractionStateQuestion=stateFactory.extend(Question,function(){function setUpGapImg(gapImgObj){var $gapList=$("ul.source",widget.$original),$addOption=$(".empty",$gapList),$gapImgBox=$("[data-serial=\""+gapImgObj.serial+"\"]",$gapList),$deleteBtn=$(mediaTlbTpl());$gapImgBox.length||($gapImgBox=$(gapImgObj.render()).insertBefore($addOption)),$deleteBtn.appendTo($gapImgBox).show().click(function(e){e.preventDefault(),e.stopPropagation(),$gapImgBox.remove(),interaction.removeGapImg(gapImgObj)}),enterGapImgForm(gapImgObj.serial),$gapImgBox.off("click").on("click",function(){$gapImgBox.hasClass("active")?($gapImgBox.removeClass("active"),leaveChoiceForm()):($(".active",$gapList).removeClass("active"),$gapImgBox.addClass("active"),enterGapImgForm(gapImgObj.serial))})}function enterChoiceForm(serial){var choice=interaction.getChoice(serial),element,bbox,callbacks;choice&&(element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),minMaxComponentFactory($choiceForm.find(".min-max-panel"),{min:{fieldName:"matchMin",value:_.parseInt(choice.attr("matchMin"))||0,helpMessage:__("The minimum number of choices this choice must be associated with to form a valid response.")},max:{fieldName:"matchMax",value:_.parseInt(choice.attr("matchMax"))||0,helpMessage:__("The maximum number of choices this choice may be associated with.")},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),formElement.initWidget($choiceForm),callbacks=formElement.getMinMaxAttributeCallbacks($choiceForm,"matchMin","matchMax"),callbacks.identifier=identifierHelper.updateChoiceIdentifier,callbacks.fixed=formElement.getAttributeChangeCallback(),formElement.setChangeCallbacks($choiceForm,choice,callbacks),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm))}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}function enterGapImgForm(serial){var gapImg=interaction.getGapImg(serial),callbacks,initMediasizer,$gapImgBox,$gapImgElem,$mediaSizer;gapImg&&($choiceForm.empty().html(gapImgFormTpl({identifier:gapImg.id(),fixed:gapImg.attr("fixed"),serial:serial,baseUrl:options.baseUrl,data:gapImg.object.attr("data"),width:gapImg.object.attr("width"),height:gapImg.object.attr("height"),type:gapImg.object.attr("type")})),minMaxComponentFactory($choiceForm.find(".min-max-panel"),{min:{fieldName:"matchMin",value:_.parseInt(gapImg.attr("matchMin"))||0,helpMessage:__("The minimum number of choices this choice must be associated with to form a valid response.")},max:{fieldName:"matchMax",value:_.parseInt(gapImg.attr("matchMax"))||0,helpMessage:__("The maximum number of choices this choice may be associated with.")},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),$gapImgBox=$("li[data-serial=\""+gapImg.serial+"\"]"),$gapImgElem=$gapImgBox.find("img"),$mediaSizer=$choiceForm.find(".media-sizer-panel").on("create.mediasizer",function(e,params){params.width=$gapImgElem.attr("width"),params.height=$gapImgElem.attr("height"),applyMediasizerValues(params,widget.$original.data("factor"))}),initMediasizer=function(){$gapImgElem.width($gapImgElem.attr("width")),$gapImgElem.height($gapImgElem.attr("height")),$mediaSizer.empty().mediasizer({target:$gapImgElem,showResponsiveToggle:!1,showSync:!1,responsive:!1,parentSelector:$gapImgBox,applyToMedium:!1,maxWidth:interaction.object.attr("width")})},$gapImgElem.get(0)&&$gapImgElem.get(0).complete?initMediasizer():$gapImgElem.one("load",initMediasizer),imageSelector($choiceForm,gapImgSelectorOptions),formElement.initWidget($choiceForm),callbacks=formElement.getMinMaxAttributeCallbacks($choiceForm,"matchMin","matchMax"),callbacks.identifier=identifierHelper.updateChoiceIdentifier,callbacks.fixed=formElement.getAttributeChangeCallback(),callbacks.data=function(element,value){gapImg.object.attr("data",value),setUpGapImg(gapImg)},$mediaSizer.on("sizechange.mediasizer",function(e,params){applyMediasizerValues(params,widget.$original.data("factor")),gapImg.object.attr("width",params.width),gapImg.object.attr("height",params.height)}),callbacks.type=function(element,value){value&&""!==value?gapImg.object.attr("type",value):interaction.object.removeAttr("type")},formElement.setChangeCallbacks($choiceForm,gapImg,callbacks),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),"function"==typeof window.scroll&&window.scroll(0,$choiceForm.offset().top))}var widget=this.widget,interaction=widget.element,options=widget.options,paper=interaction.paper,gapImgSelectorOptions=_.clone(options),$choiceForm,$formChoicePanel,$formInteractionPanel,$left,$top,$width,$height;gapImgSelectorOptions.title=gapImgSelectorOptions.title?gapImgSelectorOptions.title:__("Please select a choice picture for your interaction from the resource manager.                   You can add new files from your computer with the button \"Add file(s)\"."),paper&&($choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar"),widget._editor=shapeEditor(widget,{shapeCreated:function shapeCreated(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function shapeRemoved(id){interaction.removeChoice(id)},enterHandling:function enterHandling(shape){enterChoiceForm(shape.id)},quitHandling:function quitHandling(){leaveChoiceForm()},shapeChange:function shapeChange(shape){var choice=interaction.getChoice(shape.id),bbox;choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create(),_.forEach(interaction.getGapImgs(),setUpGapImg),function(){var $gapList=$("ul.source",widget.$original),$addOption=$("<li class=\"empty add-option\"><div><span class=\"icon-add\"></span></div></li>");$addOption.on("click",function(){var gapImgObj=interaction.createGapImg({});gapImgObj.object.removeAttr("type"),$addOption.on("selected.upload",function(e,args){$addOption.off("selected.upload"),gapImgObj.object.attr("data",args.selected.file),gapImgObj.object.attr("type",args.selected.mime),gapImgObj.object.attr("width",args.size.width),gapImgObj.object.attr("height",args.size.height),setUpGapImg(gapImgObj)}),resourceManager($addOption,gapImgSelectorOptions)}),$addOption.appendTo($gapList)}(),$(window).on("resize.changestate",function(){widget.changeState("sleep")}))},function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("graphicGapMatchInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$("ul.source .empty",widget.$original).remove(),widget.$container.find(".qti-gapImg").removeClass("active").find(".mini-tlb").remove(),$(".image-editor.solid, .block-listing.source",widget.$container).css("min-width",0))}),GraphicGapMatchInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;$form.html(formTpl({baseUrl:options.baseUrl,data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement)},GraphicGapMatchInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){'use strict';return stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please fill the gap with the correct choices below.")),widget.createGapImgs(),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.invoke(corrects,String.prototype.split," "),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){data.response&&data.response.list&&response.setCorrect(_.map(data.response.list.directedPair,function(pair){return pair.join(" ")}))}))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(_.bind(widget.scaleGapList,widget)),widget.createChoices(),widget.createGapImgs())})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,scoringFormFactory){'use strict';var removeGapFillers=function(interaction){_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.remove()}),interaction.gapFillers=[]},showChoicesId=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&graphicHelper.createShapeText(interaction.paper,element,{shapeClick:!0,content:choice.id()})})},updateForm=function(widget,entries){var interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),gapSrcs=_.transform(interaction.getGapImgs(),function(acc,gapImg){gapImg.object&&gapImg.object.attr("data")&&(acc[gapImg.id()]=widget.options.baseUrl+gapImg.object.attr("data"))},{}),options={leftTitle:__("Gap"),rightTitle:__("Choice"),type:"directedPair",pairLeft:function pairLeft(){return _.map(interaction.getGapImgs(),function(gap){return{id:gap.id(),value:gap.id()}})},formatLeft:function formatLeft(id){var formated="";return gapSrcs[id]&&(formated+="<img height='1em' src='"+gapSrcs[id]+"' /> "),formated+=id,formated},pairRight:function pairRight(){return _.map(interaction.getChoices(),function(choice){return{id:choice.id(),value:choice.id()}})},isDirectedPairFlipped:commonRenderer.isDirectedPairFlipped};entries&&(options.entries=_.transform(entries,function(result,value){result[value]="undefined"==typeof mapEntries[value]?response.mappingAttributes.defaultValue:mapEntries[value]},{})),interaction.pairScoringForm=scoringFormFactory(widget,options)};return stateFactory.create(Map,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please fill the gap with the images below, then edit the score for each gap/image pair.")),interaction.responseMappingMode=!0,widget.createGapImgs(),commonRenderer.render.call(interaction.getRenderer(),interaction),showChoicesId(interaction),0===_.size(response.getMapEntries())?updateForm(widget,corrects):updateForm(widget),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list",pairs,entries;data&&data.response&&data.response[type]&&(pairs=_.map(data.response[type].directedPair,function(pair){return commonRenderer.isDirectedPairFlipped?pair.reverse().join(" "):pair.join(" ")}),entries=_.keys(response.getMapEntries()),_(pairs).difference(entries).forEach(interaction.pairScoringForm.addPair,interaction.pairScoringForm)),removeGapFillers(interaction)}))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),interaction.pairScoringForm&&interaction.pairScoringForm.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(_.bind(widget.scaleGapList,widget)),widget.createChoices(),widget.createGapImgs())})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg"],function($,_,__,Widget,GraphicWidget,states){'use strict';var GraphicGapMatchInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function initCreator(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(_.bind(this.scaleGapList,this)),paper&&(this.element.paper=paper,this.createChoices(),this.createGapImgs())},destroy:function destroy(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)},scaleGapList:function scaleGapList(newSize,factor){var $container=this.$original,$gapList=$("ul.source",$container);$gapList.css("max-width",newSize+"px"),factor&&1!==factor&&($gapList.find("img").each(function(){var $img=$(this);$img.width($img.attr("width")*factor),$img.height($img.attr("height")*factor)}),$container.data("factor",factor))},createGapImgs:function createGapImgs(){var interaction=this.element,$container=this.$original,$gapList=$("ul.source",$container);$gapList.empty(),_.forEach(interaction.gapImgs,function(gapImg){$gapList.append(gapImg.render())})}});return GraphicGapMatchInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget"],function(_,GraphicGapMatchInteraction,GraphicGapMatchInteractionWidget){'use strict';var CreatorGraphicGapMatchInteraction=_.clone(GraphicGapMatchInteraction);return CreatorGraphicGapMatchInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),GraphicGapMatchInteractionWidget.build(interaction,GraphicGapMatchInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGraphicGapMatchInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function($,stateFactory,SleepState){'use strict';return stateFactory.extend(SleepState,function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(!0===data.value?interaction.addClass("responsive"):interaction.removeClass("responsive"),widget.rebuild())})},function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"data\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n        <input type=\"text\" name=\"data\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n    </div>\n\n    <div class=\"panel media-sizer-panel\">\n        <!-- media sizer goes here -->\n    </div>\n    <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n    <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n\n\n    <input name=\"type\" value=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" readonly />\n\n</div>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+"</h3>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"identifier",options):helperMissing.call(depth0,"__","identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n\n    <input type=\"text\"\n           name=\"identifier\"\n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n           placeholder=\"e.g. my-hotspot_1\"\n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n\n<h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shape position",options):helperMissing.call(depth0,"__","Shape position",options)))+"</h3>\n\n<div class=\"panel\">\n    <label for=\"x\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Left",options):helperMissing.call(depth0,"__","Left",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"x\" value=\"",(helper=helpers.x)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.x,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>\n\n<div class=\"panel\">\n    <label for=\"y\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Top",options):helperMissing.call(depth0,"__","Top",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"y\" value=\"",(helper=helpers.y)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.y,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>\n\n<div class=\"panel\">\n    <label for=\"width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>\n\n<div class=\"panel\">\n    <label for=\"height\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+"</div>\n    <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" readonly />\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage"],function($,_,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,minMaxComponentFactory,identifierHelper,formTpl,choiceFormTpl,panel,bgImage){'use strict';var GraphicOrderInteractionStateQuestion=stateFactory.extend(Question,function(){function enterChoiceForm(serial){var choice=interaction.getChoice(serial),element,bbox;choice&&(element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),formElement.initWidget($choiceForm),formElement.setChangeCallbacks($choiceForm,choice,{identifier:identifierHelper.updateChoiceIdentifier,fixed:formElement.getAttributeChangeCallback()}),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm))}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}var widget=this.widget,interaction=widget.element,paper=interaction.paper,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar"),$left,$top,$width,$height;paper&&(widget._editor=shapeEditor(widget,{shapeCreated:function shapeCreated(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function shapeRemoved(id){interaction.removeChoice(id)},enterHandling:function enterHandling(shape){enterChoiceForm(shape.id)},quitHandling:function quitHandling(){leaveChoiceForm()},shapeChange:function shapeChange(shape){var choice=interaction.getChoice(shape.id),bbox;choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create(),$(window).on("resize.changestate",function(){widget.changeState("sleep")}),widget.on("attributeChange",function(data){"maxChoices"===data.key&&widget.renderOrderList()}))},function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("graphicOrderInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0))});return GraphicOrderInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;$form.html(formTpl({baseUrl:options.baseUrl,data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{value:_.parseInt(interaction.attr("minChoices"))||0},max:{value:_.parseInt(interaction.attr("maxChoices"))||0},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices",{updateCardinality:!1}))},GraphicOrderInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){'use strict';return stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please order the choices below to set the correct answer")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(PciResponse.unserialize(data.response,interaction))}))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(_.bind(widget.scaleOrderList,widget)),widget.createChoices(),widget.renderOrderList())})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states"],function($,_,__,Widget,GraphicWidget,states){var GraphicOrderInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function initCreator(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(_.bind(this.scaleOrderList,this)),paper&&(this.element.paper=paper,this.createChoices(),this.renderOrderList())},destroy:function destroy(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)},scaleOrderList:function scaleOrderList(newSize){$("ul.block-listing",this.$original).css("max-width",newSize+"px")},renderOrderList:function(){var interaction=this.element,size=_.size(interaction.getChoices()),min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),$orderList=$("ul.block-listing",this.$original);0<max&&max<size?size=max:0<min&&min<size&&(size=min),$orderList.empty(),_.times(size,function(index){var position=index+1,$orderer=$("<li class=\"selectable\" data-number=\""+position+"\">"+position+"</li>");0===index&&$orderer.addClass("active"),$orderList.append($orderer)})}});return GraphicOrderInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget"],function(_,GraphicOrderInteraction,GraphicOrderInteractionWidget){'use strict';var CreatorGraphicOrderInteraction=_.clone(GraphicOrderInteraction);return CreatorGraphicOrderInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),GraphicOrderInteractionWidget.build(interaction,GraphicOrderInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGraphicOrderInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function($,stateFactory,SleepState){'use strict';return stateFactory.extend(SleepState,function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(!0===data.value?interaction.addClass("responsive"):interaction.removeClass("responsive"),widget.rebuild())})},function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"data\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n        <input type=\"text\" name=\"data\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n    </div>\n\n    <div class=\"panel media-sizer-panel\">\n        <!-- media sizer goes here -->\n    </div>\n    <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n    <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n\n\n        <input name=\"type\" value=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" readonly />\n\n</div>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+"</h3>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage"],function($,_,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,minMaxComponentFactory,identifierHelper,formTpl,choiceFormTpl,panel,bgImage){'use strict';var HotspotInteractionStateQuestion=stateFactory.extend(Question,function(){function enterChoiceForm(serial){var choice=interaction.getChoice(serial),element,bbox;choice&&(element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),formElement.initWidget($choiceForm),formElement.setChangeCallbacks($choiceForm,choice,{identifier:identifierHelper.updateChoiceIdentifier,fixed:formElement.getAttributeChangeCallback()}),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm))}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}var widget=this.widget,interaction=widget.element,paper=interaction.paper,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar"),$left,$top,$width,$height;paper&&(widget._editor=shapeEditor(widget,{shapeCreated:function shapeCreated(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function shapeRemoved(id){interaction.removeChoice(id)},enterHandling:function enterHandling(shape){enterChoiceForm(shape.id)},quitHandling:function quitHandling(){leaveChoiceForm()},shapeChange:function shapeChange(shape){var choice=interaction.getChoice(shape.id),bbox;choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create(),$(window).on("resize.changestate",function(){widget.changeState("sleep")}))},function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("hotspotInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$(".image-editor.solid, .block-listing.source",widget.$container).css("min-width",0))});return HotspotInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;$form.html(formTpl({baseUrl:options.baseUrl,data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{value:_.parseInt(interaction.attr("minChoices"))||0},max:{value:_.parseInt(interaction.attr("maxChoices"))||0},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices"))},HotspotInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){'use strict';return stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please select the correct hotspot choices below.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(PciResponse.unserialize(data.response,interaction))}))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup",["jquery","lodash"],function($){var _Mathround11=Math.round;return function(paper,shape,$container,isResponsive){var margin=10,$shape=$(shape.node),$element=$("<div class=\"mapping-editor arrow-left-top\"></div>"),boxOffset=$container.offset(),offset=$shape.offset(),bbox=shape.getBBox(),width=bbox.width,wfactor;return isResponsive&&(wfactor=paper.w/paper.width,width=_Mathround11(width*(2-wfactor))),$element.css({top:offset.top-boxOffset.top-margin,left:offset.left-boxOffset.left+width+margin}).appendTo($container),$element}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        <div class=\"panel\" data-edit=\"correct\">\n            <label>\n                "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Correct",options):helperMissing.call(depth0,"__","Correct",options)))+"\n                <input name=\"correct\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n            <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n            <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Is this choice the correct response?",options):helperMissing.call(depth0,"__","Is this choice the correct response?",options)))+"</span>\n        </div>\n",buffer}function program2(){return" checked=\"checked\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<a class=\"closer\" href=\"#\" data-close=\":parent .mapping-editor\"></a>\n    <div class=\"form-container\">\n        <h2>",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h2>\n\n",stack1=helpers.unless.call(depth0,depth0&&depth0.noCorrect,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        <div class=\"panel\">\n            <label for=\"score\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Score",options):helperMissing.call(depth0,"__","Score",options)))+"</label>\n            <input value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" data-for=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" name=\"score\" class=\"score\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty; $event(type=keyup)\" />\n            <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n            <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Set the score for this response",options):helperMissing.call(depth0,"__","Set the score for this response",options)))+"</span>\n        </div>\n        <span class=\"arrow\"></span>\n        <span class=\"arrow-cover\"></span>\n    </div>",buffer})}),define("ui/deleter",["jquery","lodash","i18n","core/pluginifier","core/dataattrhandler","handlebars","lib/dompurify/purify"],function($$1,_,__,Pluginifier,DataAttrHandler,Handlebars,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function undoTmpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function listenDataAttr($container){new DataAttrHandler("delete",{container:$container,listenerEvent:"click",namespace:"ui.deleter",bubbled:!0}).init(function($elt,$target){var options={target:$target,bindEvent:!1,undo:!0},confirm=$elt.data("delete-confirm"),undo=$elt.data("delete-undo");confirm&&(options.confirm=!0,options.undo=!1,0<confirm.length&&(options.confirmMessage=confirm)),null!==undo&&void 0!==undo&&(!1===undo?options.undo=!1:(options.confirm=!1,options.undo=!0,0<undo.length&&(options.undoMessage=undo))),$elt.deleter(options)}).trigger(function($elt){$elt.deleter("delete")})}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,DataAttrHandler=DataAttrHandler&&DataAttrHandler.hasOwnProperty("default")?DataAttrHandler["default"]:DataAttrHandler,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"undobox feedback-info\">\n    <span class=\"icon-info\"></span>\n        ",(helper=helpers.undoMessage)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.undoMessage,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n        <a class=\"undo\" href=\"#\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Undo",options):helperMissing.call(depth0,"__","Undo",options)))+"</a>\n    <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+"\" class=\"icon-close\" data-close=\":parent .undobox\"></span>\n</div>\n",buffer}),ns="deleter",dataNs="ui."+ns,defaults={bindEvent:"click",undo:!1,undoTimeout:5e3,undoMessage:__("Element deleted."),undoContainer:!1,confirm:!1,confirmMessage:__("Are you sure you want to delete it?"),disableClass:"disabled"},deleter={init:function(options){return options=_.defaults(options,defaults),this.each(function(){var $elt=$$1(this);$elt.data(dataNs)||($elt.data(dataNs,options),!1!==options.bindEvent&&$elt.on(options.bindEvent,function(e){e.preventDefault(),deleter._delete($elt)}),$elt.trigger("create."+ns))})},_delete:function($elt){var performDelete=!0,options=$elt.data(dataNs),realRemove=function(){performDelete&&$target&&($target.remove(),$evtTrigger.trigger("deleted."+ns))},$target,$parent,$evtTrigger,$placeholder,$undoBox,undoRemove,timeout;options&&!$elt.hasClass(options.disableClass)&&($target=options.target,!0===options.confirm&&(performDelete=window.confirm(options.confirmMessage)),performDelete&&($parent=$target.parent(),$evtTrigger=0<$target.has($elt).length?$parent:$elt,$elt.trigger("delete."+ns,[$target]),$target.trigger("delete",[options.undo]),$placeholder=$$1("<span style=\"display:none;\" />").insertAfter($target),$target.detach(),options.undo?($$1(document).off(".unundo."+ns),$undoBox=deleter._createUndoBox(options),$undoBox.find(".undo").click(function(e){e.preventDefault(),"number"==typeof timeout&&clearTimeout(timeout),performDelete=!1,$undoBox.remove(),$target.insertBefore($placeholder),$placeholder.remove(),$elt.trigger("undo."+ns,[$target]),$target.trigger("undo."+ns)}),undoRemove=function(){$undoBox&&$undoBox.length&&($undoBox.remove(),$placeholder.remove()),realRemove(),$$1(document).off(".unundo."+ns)},$$1(document).one("mousedown.unundo."+ns,function(e){return e.preventDefault(),e.stopImmediatePropagation(),0!==$undoBox.find(e.target).length&&$$1(e.target).hasClass("undo")||"number"!=typeof timeout||(clearTimeout(timeout),undoRemove()),_.delay(function(){$$1(e.target).trigger("mousedown")},10),!1}),timeout=setTimeout(function(){undoRemove()},options.undoTimeout)):realRemove()))},_createUndoBox:function(options){var $undoContainer=options.undoContainer||$$1("#feedback-messages-main");return $undoContainer.length||($undoContainer=$$1("<div id=\"feedback-messages-main\" class=\"tao-scope\"></div>").appendTo("body")),$$1(undoTmpl(options)).appendTo($undoContainer)},destroy:function(){this.each(function(){var $elt=$$1(this),options=$elt.data(dataNs);!1!==options.bindEvent&&$elt.off(options.bindEvent),$elt.removeData(dataNs),$elt.trigger("destroy."+ns)})}};return Pluginifier.register(ns,deleter,{expose:["delete"]}),listenDataAttr}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/deleter","ui/tooltipster"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,answerStateHelper,grahicScorePopup,mappingFormTpl,formElement,deleter,tooltipster){'use strict';function initResponseMapping(widget){var scoreTexts={},interaction=widget.element,$container=widget.$original,isResponsive=$container.hasClass("responsive"),$imageBox=$(".main-image-box",$container),response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),corrects=_.values(response.getCorrect());_.forEach(interaction.getChoices(),function(choice){var shape=interaction.paper.getById(choice.serial),$popup=grahicScorePopup(interaction.paper,shape,$imageBox,isResponsive),score=mapEntries[choice.id()]||response.mappingAttributes.defaultValue||"0";scoreTexts[choice.serial]=graphicHelper.createShapeText(interaction.paper,shape,{id:"score-"+choice.serial,content:score,style:"score-text-default",shapeClick:!0}).data("default",!0);var $form=$(mappingFormTpl({identifier:choice.id(),correctDefined:answerStateHelper.isCorrectDefined(widget),correct:_.contains(response.getCorrect(),choice.id()),score:score,scoreMin:response.getMappingAttribute("lowerBound"),scoreMax:response.getMappingAttribute("upperBound")}));formElement.setChangeCallbacks($form,response,{score:function(response,value){var scoreText=scoreTexts[choice.serial];""===value?(response.removeMapEntry(choice.id()),scoreText.attr({text:response.mappingAttributes.defaultValue}).data("default",!0)):(response.setMapEntry(choice.id(),value,!0),scoreText.attr({text:value}).data("default",!1))},correct:function correct(response,value){!0===value?!_.contains(corrects,choice.id())&&(corrects.push(choice.id()),shape.active=!0,graphicHelper.updateElementState(shape,"active")):(corrects=_.without(corrects,choice.id()),shape.active=!1,graphicHelper.updateElementState(shape,"basic")),response.setCorrect(corrects)}}),shape.click(function(){$(".mapping-editor",$container).hide(),$popup.show()}),$popup.append($form)}),deleter($container),tooltipster($container),interaction.paper.getById("bg-image-"+interaction.serial).click(function(){$(".mapping-editor",$container).hide()}),$(".mapping-editor",$container).on("click",".closer",function(){$(this).parent(".mapping-editor").hide()}),widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&_.forEach(scoreTexts,function(scoreText){!0===scoreText.data("default")&&scoreText.attr({text:data.value})})})}return stateFactory.create(Map,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction);interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please the score of each hotspot choice.")),interaction.responseMappingMode=!0,interaction.paper=widget.createPaper(),widget.createChoices(),initResponseMapping(widget),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states"],function($,_,__,Widget,GraphicWidget,states){'use strict';var HotspotInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function initCreator(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(),paper&&(this.element.paper=paper,this.createChoices())},destroy:function destroy(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)}});return HotspotInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget"],function(_,HotspotInteraction,HotspotInteractionWidget){'use strict';var CreatorHotspotInteraction=_.clone(HotspotInteraction);return CreatorHotspotInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),HotspotInteractionWidget.build(interaction,HotspotInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorHotspotInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+"</h3>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext-create",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<div class=\"rgt tlb-button\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Create hottext",options):helperMissing.call(depth0,"__","Create hottext",options)))+"\" data-role=\"create-hottext\">\n    <span class=\"icon-magicwand\"></span>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","taoQtiItem/qtiCreator/widgets/helpers/selectionWrapper","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hottext","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext-create"],function($,_,stateFactory,Question,htmlEditor,gridContentHelper,htmlContentHelper,formElement,minMaxComponentFactory,selectionWrapper,formTpl,toolbarTpl,newHottextBtnTpl){'use strict';var HottextInteractionStateQuestion=stateFactory.extend(Question,function(){this.buildEditor()},function(){this.destroyEditor()});return HottextInteractionStateQuestion.prototype.buildEditor=function(){var self=this,_widget=this.widget,container=_widget.element.getBody(),$container=_widget.$container,$editableContainer=$container.find(".qti-flow-container"),$bodyTlb;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||($bodyTlb=$(toolbarTpl({serial:_widget.serial,state:"question"})),$editableContainer.append($bodyTlb),$bodyTlb.show(),self.initHottextCreator(),htmlEditor.buildEditor($editableContainer,{shieldInnerContent:!1,change:gridContentHelper.getChangeCallbackForBlockStatic(container),data:{container:container,widget:_widget}}))},HottextInteractionStateQuestion.prototype.destroyEditor=function(){var $container=this.widget.$container,$flowContainer=$container.find(".qti-flow-container"),$editable=$container.find(".qti-flow-container [data-html-editable]");$editable.off("hottextcreator"),htmlEditor.destroyEditor($flowContainer),$flowContainer.find(".mini-tlb[data-role=cke-launcher-tlb]").remove()},HottextInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,$form=widget.$form,interaction=widget.element,callbacks;$form.html(formTpl()),minMaxComponentFactory($form.find(".min-max-panel"),{min:{value:_.parseInt(interaction.attr("minChoices"))||0},max:{value:_.parseInt(interaction.attr("maxChoices"))||0},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),formElement.initWidget($form),callbacks=formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices"),formElement.setChangeCallbacks($form,interaction,callbacks)},HottextInteractionStateQuestion.prototype.initHottextCreator=function(){var self=this,interactionWidget=this.widget,$editable=interactionWidget.$container.find(".qti-flow-container [data-html-editable]"),$flowContainer=interactionWidget.$container.find(".qti-flow-container"),$toolbar=$flowContainer.find(".mini-tlb[data-role=cke-launcher-tlb]"),$newHottextBtn=$(newHottextBtnTpl()),$newHottext=$("<span>",{class:"widget-box","data-new":!0,"data-qti-class":"hottext"}),wrapper=selectionWrapper({$container:$editable,allowQtiElements:!1});$toolbar.append($newHottextBtn),$newHottextBtn.hide(),$editable.on("mouseup.hottextcreator",function(){wrapper.canWrap()?$newHottextBtn.show():$newHottextBtn.hide()}).on("blur.hottextcreator",function(){$newHottextBtn.hide()}),$newHottextBtn.on("mousedown.hottextcreator",function(){$newHottextBtn.hide(),wrapper.wrapWith($newHottext)&&self.createNewHottext($newHottext.clone())})},HottextInteractionStateQuestion.prototype.createNewHottext=function($hottextContent){var interactionWidget=this.widget,interaction=interactionWidget.element,$editable=interactionWidget.$container.find(".qti-flow-container [data-html-editable]"),allowedInlineStaticElts=["math"],$inlineStaticWidgets,newHottextElt,newHottextBody;htmlContentHelper.createElements(interaction.getBody(),$editable,htmlEditor.getData($editable),function(newHottextWidget){newHottextElt=newHottextWidget.element,$inlineStaticWidgets=$hottextContent.find(allowedInlineStaticElts.map(function(qtiClass){return".widget-"+qtiClass}).join(",")),$inlineStaticWidgets&&0<$inlineStaticWidgets.length&&$inlineStaticWidgets.each(function(){var serial=$(this).data("serial"),elt=interaction.getElement(serial),eltWidget=elt.data("widget");interaction.removeElement(elt),newHottextElt.setElement(elt),$(this).replaceWith(elt.placeholder()),eltWidget.destroy()}),newHottextBody=_.escape($hottextContent.text()),""!==newHottextBody.trim()&&(newHottextElt.body(newHottextBody),newHottextElt.render(newHottextElt.getContainer()),newHottextElt.postRender(),newHottextWidget.destroy(),newHottextWidget=newHottextElt.data("widget"),newHottextWidget.changeState("choice"))})},HottextInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){'use strict';return stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();this.widget.$original.find(".hottext-checkmark > input").removeProp("disabled"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please select the correct hottext choices below.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(PciResponse.unserialize(data.response,interaction))})},function(){var widget=this.widget,interaction=widget.element;this.widget.$original.find(".hottext-checkmark > input").prop("disabled","disabled"),widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction)})}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/placeholder","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,stateFactory,Map,commonRenderer,answerStateHelper,instructionMgr,formElement,placeholder,PciResponse){'use strict';function toggleCorrectState($container,enable){enable?$(".hottext-checkmark > input",$container).removeProp("disabled").removeClass("disabled"):$(".hottext-checkmark > input",$container).prop("disabled",!0).prop("checked",!1).addClass("disabled")}function createScoreForm(interaction,$container){var callbacks={},response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries();$(".hottext",$container).on("click",function(e){($(e.target).hasClass("score")||!1===answerStateHelper.defineCorrect(response))&&(e.preventDefault(),e.stopImmediatePropagation())}),_.forEach(interaction.getChoices(),function(choice){var id=choice.serial+"-score",$hottext=$("[data-serial=\""+choice.serial+"\"]",$container),$score;$hottext.length&&($score=$("<input type='text' name='"+id+"' class='score' title='"+__("Score value")+"' data-validate='$numeric' data-validate-option='$allowEmpty; $event(type=keyup)' />"),$score.val("undefined"==typeof mapEntries[choice.id()]?"":mapEntries[choice.id()]),$hottext.append($score),callbacks[id]=function(res,value){""===value?res.removeMapEntry(choice.id()):res.setMapEntry(choice.id(),value,!0)})}),formElement.setChangeCallbacks($container,response,callbacks)}return stateFactory.create(Map,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please enter the score for the given hottexts.")),interaction.responseMappingMode=!0,createScoreForm(interaction,widget.$container),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(corrects,interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list";data&&data.response&&data.response[type]&&response.setCorrect(data.response[type].identifier)}),widget.on("metaChange",function(meta){"defineCorrect"===meta.key&&(toggleCorrectState(widget.$container,meta.value),!1===meta.value&&response.setCorrect([]))}),toggleCorrectState(widget.$container,answerStateHelper.defineCorrect(response)),widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&placeholder.score(widget,data.value)}),placeholder.score(widget)},function(){var widget=this.widget,interaction=widget.element,$container=widget.$container;$container.off("responseChange.qti-widget"),$(".score",$container).remove(),toggleCorrectState($container,!0),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),this.widget.$original.find(".hottext-checkmark > input").prop("disabled","disabled")})}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/states"],function(Widget,states){var HottextInteractionWidget=Widget.clone();return HottextInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},HottextInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/HottextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/Widget"],function(_,HottextInteraction,HottextInteractionWidget){'use strict';var CreatorHottextInteraction=_.clone(HottextInteraction);return CreatorHottextInteraction.render=function(interaction,options){HottextInteractionWidget.build(interaction,HottextInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorHottextInteraction}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement","lodash"],function($,stateFactory,QuestionState,formElement,_){'use strict';var ChoiceStateQuestion=stateFactory.extend(QuestionState,function(){this.buildEditor()},function(){this.destroyEditor()});return ChoiceStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$toolbar=_widget.$container.find("td:last");return formElement.initShufflePinToggle(_widget),formElement.initDelete(_widget),$toolbar},ChoiceStateQuestion.prototype.buildEditor=function(){var _widget=this.widget;_widget.$container.find(".editable-content").attr("contentEditable",!0).on("keyup.qti-widget",_.throttle(function(){_widget.element.val(_.escape($(this).text())),_widget.$original.width($(this).width())},200)).on("focus.qti-widget",function(){_widget.changeState("choice")}).on("keypress.qti-widget",function(e){13===e.which&&(e.preventDefault(),$(this).blur(),_widget.changeState("question"))})},ChoiceStateQuestion.prototype.destroyEditor=function(){this.widget.$container.find(".editable-content").removeAttr("contentEditable").off("keyup.qti-widget")},ChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier"],function(stateFactory,Choice,formTpl,formElement,identifierHelper){var InlineChoiceStateChoice=stateFactory.extend(Choice);return InlineChoiceStateChoice.prototype.initForm=function(){var _widget=this.widget;_widget.$form.html(formTpl({serial:_widget.element.getSerial(),identifier:_widget.element.id()})),formElement.setChangeCallbacks(_widget.$form,_widget.element,{identifier:identifierHelper.updateChoiceIdentifier})},InlineChoiceStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states"],function(Widget,states){var InlineChoiceWidget=Widget.clone();return InlineChoiceWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},InlineChoiceWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(){return"checked=\"checked\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label>\n        <input name=\"shuffle\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \u201Cshuffled\u201D of \u201Cfixed\u201D individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \u201Cshuffled\u201D of \u201Cfixed\u201D individually.",options)))+"\n    </span>\n</div>\n<div class=\"panel\">\n    <label>\n        <input name=\"required\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.required,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"required",options):helperMissing.call(depth0,"__","required",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options):helperMissing.call(depth0,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options)))+"\n    </span>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice"],function($,stateFactory,Question,formElement,formTpl){var InlineChoiceInteractionStateQuestion=stateFactory.extend(Question,function(){var $mainOption=this.widget.$container.find(".main-option"),$original=this.widget.$original;$(document).on("choiceTextChange.qti-widget.question",function(){$original.width($mainOption.width())})},function(){$(document).off(".qti-widget.question")});return InlineChoiceInteractionStateQuestion.prototype.addNewChoiceButton=function(){var _widget=this.widget,$addChoice=_widget.$container.find(".add-option"),interaction=_widget.element;$addChoice.data("initialized")||($addChoice.on("click.qti-widget",function(e){e.stopPropagation();var choice=interaction.createChoice();$(this).closest("tr").before(_widget.renderChoice(choice)),_widget.buildChoice(choice,{ready:function ready(widget){widget.changeState("question")}})}),$addChoice.data("initialized",!0))},InlineChoiceInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({shuffle:!!interaction.attr("shuffle"),required:!!interaction.attr("required")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{shuffle:formElement.getAttributeChangeCallback(),required:formElement.getAttributeChangeCallback()})},InlineChoiceInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCreator/widgets/helpers/placeholder"],function($,_,__,CommonRenderer,placeholder){'use strict';return{create:function create(widget,responseMappingMode,callback){var self=this,interaction=widget.element,$placeholder=$("<select>"),$responseWidget=widget.$container.find(".widget-response").append($placeholder);this.commonRenderer=new CommonRenderer({shuffleChoices:!1,themes:!1}),responseMappingMode&&(widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&placeholder.score(widget,data.value)}),placeholder.score(widget)),this.commonRenderer.load(function(){interaction.render({},$placeholder,"",this),interaction.postRender({allowEmpty:!1,placeholderText:__("select correct choice")},"",this),callback.call(self,this),$responseWidget.siblings(".padding").width($responseWidget.width()+50)},["inlineChoice","inlineChoiceInteraction"])},setResponse:function setResponse(widget,response){this.commonRenderer.setResponse(widget.element,this.formatResponse(response))},destroy:function destroy(widget){widget.$container.find(".widget-response").empty(),widget.$container.find(".padding").removeAttr("style")},formatResponse:function formatResponse(response){return _.isString(response)||(response=_.values(response),response&&response.length&&(response=response[0])),{base:{identifier:response}}},unformatResponse:function unformatResponse(formatedResponse){var response=[];return formatedResponse.base&&formatedResponse.base.identifier&&response.push(formatedResponse.base.identifier),response}}}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var InlineChoiceInteractionStateCorrect=stateFactory.create(Correct,function(){var _widget=this.widget,response=this.widget.element.getResponseDeclaration();_widget.$container.find("table").hide(),responseWidget.create(_widget,!1,function(){responseWidget.setResponse(_widget,_.values(response.getCorrect())),_widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(responseWidget.unformatResponse(data.response))})})},function(){var $container=this.widget.$container;$container.find("table").show(),$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget)});return InlineChoiceInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/helper/interactionHelper","lodash"],function($,stateFactory,Map,responseWidget,formElement,interactionHelper,_){var AssociateInteractionStateCorrect=stateFactory.create(Map,function(){var _widget=this.widget,$container=_widget.$container,interaction=_widget.element,response=interaction.getResponseDeclaration();$container.find("[data-edit=map]").show();var correct=_.values(response.getCorrect());if(correct.length){var selectedChoice=interaction.getChoiceByIdentifier(correct.pop());selectedChoice&&$container.find("input[name=correct][value=\""+selectedChoice.serial+"\"]").prop("checked",!0)}_.forEach(response.getMapEntries(),function(score,choice){var element=interaction.getChoiceByIdentifier(choice);element&&$container.find("input[name=score][data-for=\""+element.serial+"\"]").val(score)}),formElement.setChangeCallbacks($container,response,{correct:function(response,value){response.setCorrect(interactionHelper.serialToIdentifier(interaction,value))},score:function(response,value){var score=parseFloat(value);isNaN(score)||response.setMapEntry(interactionHelper.serialToIdentifier(interaction,$(this).data("for")),score)}}),responseWidget.create(_widget,!0,function(){responseWidget.setResponse(_widget,_.values(response.getCorrect())),_widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(responseWidget.unformatResponse(data.response))})})},function(){var $container=this.widget.$container;$container.find("table").show(),$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget)});return AssociateInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/NoRp",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/NoRp"],function(stateFactory,NoRp){'use strict';return stateFactory.extend(NoRp,function(){this.widget.$container.find(".qti-choice").hide()},function(){this.widget.$container.find(".qti-choice").show()})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/NoRp"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<div class=\"widget-box widget-inline widget-inlineChoiceInteraction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-edit=\"active\">\n    <div class=\"qti-interaction qti-inlineChoiceInteraction\">\n        <table>\n            <colgroup>\n                <col class=\"text\">\n                <col class=\"icon\">\n                <col class=\"icon\">\n            </colgroup>\n            <tbody>\n                <tr>\n                    <td class=\"main-option\"><div>-- "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"edit choices",options):helperMissing.call(depth0,"__","edit choices",options)))+" --<span class=\"icon-down\"></span></div></td>\n                    <td class=\"icon-title\" data-edit=\"map\">correct</td>\n                    <td class=\"icon-title\" data-edit=\"map\">score</td>\n                </tr>\n                ",options={hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                <tr data-edit=\"question\">\n                    <td>\n                        <div class=\"add-option\">\n                            <span class=\"icon-add\"></span>\n                            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add choice",options):helperMissing.call(depth0,"__","Add choice",options)))+"\n                        </div>\n                    </td>\n                    <td colspan=\"2\"></td>\n                </tr>\n            </tbody>\n        </table>\n        <div>\n            <div class=\"widget-response\" data-edit=\"correct\"></div>\n            <div class=\"padding\"></div>\n        </div>\n    </div>\n</div>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<tr class=\"widget-box widget-inlineChoice qti-choice\" data-edit=\"active\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <td class=\"option\"><div class=\"editable-content\" contenteditable=\"true\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div></td>\n    <td class=\"mini-tlb\">\n        <span data-edit=\"question\" class=\"tlb-button\">\n            <span  class=\"icon-",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.fixed),{hash:{},inverse:self.program(3,function(){return"shuffle"},data),fn:self.program(1,function(){return"pin"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-role=\"shuffle-pin\" style=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.interactionShuffle,{hash:{},inverse:self.program(7,function(){return"display:none;"},data),fn:self.program(5,function(){return""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"></span>\n        </span>\n        <label data-edit=\"map\">\n            <input name=\"correct\" type=\"radio\" value=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            <span class=\"icon-radio\"></span>\n        </label>\n    </td>\n    <td class=\"mini-tlb\">\n        <span data-edit=\"question\" class=\"icon-bin\" data-role=\"delete\"></span>\n        <input class=\"score\" name=\"score\" data-edit=\"map\" value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty; $event(type=keyup)\"/>\n    </td>\n</tr>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice"],function(_,Element,InteractionWidget,ChoiceWidget,states,inlineChoiceInteractionTpl,inlineChoiceTpl){var InlineChoiceInteractionWidget=InteractionWidget.clone();return InlineChoiceInteractionWidget.initCreator=function(options){var _this=this;this.registerStates(states),InteractionWidget.initCreator.call(this),this.$choiceOptionForm=options.choiceOptionForm,_.each(this.element.getChoices(),function(choice){_this.buildChoice(choice)}),this.$container.find(".tlb-title").remove()},InlineChoiceInteractionWidget.renderChoice=function(choice,shuffleChoice){var tplData={tag:choice.qtiClass,serial:choice.serial,attributes:choice.attributes,body:_.unescape(choice.text),interactionShuffle:shuffleChoice};return inlineChoiceTpl(tplData)},InlineChoiceInteractionWidget.renderInteraction=function(){var _this=this,interaction=this.element,shuffleChoice=interaction.attr("shuffle"),tplData={tag:interaction.qtiClass,serial:interaction.serial,attributes:interaction.attributes,choices:[]};return _.each(interaction.getChoices(),function(choice){Element.isA(choice,"choice")&&tplData.choices.push(_this.renderChoice(choice,shuffleChoice))}),inlineChoiceInteractionTpl(tplData)},InlineChoiceInteractionWidget.buildChoice=function(choice,options){ChoiceWidget.build(choice,this.$container.find(".widget-inlineChoice[data-serial=\""+choice.serial+"\"]"),this.$choiceOptionForm,options)},InlineChoiceInteractionWidget.buildContainer=function(){var previous,next;this.$original.length&&(previous=this.$original[0].previousSibling,next=this.$original[0].nextSibling,(!previous||3===previous.nodeType&&""===previous.nodeValue||3!==previous.nodeType)&&this.$original.before("&nbsp;"),(!next||3===next.nodeType&&""===next.nodeValue||3!==next.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-inlineChoiceInteraction[data-serial="+this.element.getSerial()+"]")},InlineChoiceInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<span class=\"widget-box inlineChoiceInteraction-placeholder\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"inlineChoiceInteraction\">\n    <label>-- "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"edit choices",options):helperMissing.call(depth0,"__","edit choices",options)))+" --</label>\n    <span class=\"icon-down\"></span>\n</span>",buffer})}),define("taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder"],function($,_,InlineChoiceInteraction,InlineChoiceInteractionWidget,tpl){'use strict';var CreatorInlineChoiceInteraction=_.clone(InlineChoiceInteraction);return CreatorInlineChoiceInteraction.template=tpl,CreatorInlineChoiceInteraction.render=function(interaction,options){options=options||{},options.choiceOptionForm=this.getOption("choiceOptionForm"),InlineChoiceInteractionWidget.build(interaction,$(".inlineChoiceInteraction-placeholder[data-serial=\""+interaction.serial+"\"]"),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorInlineChoiceInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"clearfix add-options\" data-edit=\"question\">\n    <div class=\"rgt\">\n        <span class=\"add-option\" data-role=\"add-row\"><span class=\"icon-add\"></span>Add new row</span>\n        <span class=\"add-option\" data-role=\"add-col\"><span class=\"icon-add\"></span>Add new column</span>\n    </div>\n</div>"})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<tr>\n    ",(helper=helpers.choice)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choice,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=(helper=helpers["for"]||depth0&&depth0["for"],options={hash:{},inverse:self.noop,fn:self.program(1,function(){return"\n    <td>\n        <label>\n            <input type=\"checkbox\" >\n            <span class=\"icon-checkbox cross\"></span>\n        </label>\n    </td>\n    "},data),data:data},helper?helper.call(depth0,0,depth0&&depth0.otherMatchSetCount,1,options):helperMissing.call(depth0,"for",0,depth0&&depth0.otherMatchSetCount,1,options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</tr>",buffer})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<td>\n    <label>\n        <input type=\"checkbox\" >\n        <span class=\"icon-checkbox cross\"></span>\n    </label>\n</td>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function($,_,stateFactory,Question,AssociateInteractionQuestionState,adderTpl,rowTpl,cellTpl,sizeAdapter){'use strict';var MatchInteractionStateQuestion=stateFactory.extend(Question);return MatchInteractionStateQuestion.prototype.initForm=AssociateInteractionQuestionState.prototype.initForm,MatchInteractionStateQuestion.prototype.addNewChoiceButton=function(){var widget=this.widget,interaction=widget.element,$matchArea=widget.$container.find(".match-interaction-area"),_postRender=function(choice){choice.postRender({ready:function ready(widget){widget.changeState("question")}},"simpleAssociableChoice.matchInteraction")};$matchArea.find(".add-option").length||($matchArea.append(adderTpl()),$matchArea.find(".add-options").show(),$matchArea.find(".add-option[data-role=add-col]").on("click",function(){var choice=interaction.createChoice(0);$matchArea.find("thead > tr").append(choice.render("simpleAssociableChoice.matchInteraction")),$matchArea.find("tbody > tr").append(cellTpl({})),_postRender(choice)}),$matchArea.find(".add-option[data-role=add-row]").on("click",function(){var choice=interaction.createChoice(1);$matchArea.find("tbody").append(rowTpl({choice:choice.render("simpleAssociableChoice.matchInteraction"),otherMatchSetCount:_.size(interaction.choices[0])})),_postRender(choice)})),$(".qti-item").on("toolbarchange",function(){$matchArea.find("tbody .mini-tlb").each(function(){var $toolbar=$(this);"false"!==$toolbar.parent().attr("contenteditable")&&$toolbar.css({left:-1*($toolbar.width()+10),top:-1})})}),$matchArea.find("tr ").each(function(){var $elements=$(this).find("[data-html-editable=\"true\"]");widget.on("containerBodyChange",function(){sizeAdapter.adaptSize($elements)})})},MatchInteractionStateQuestion}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<input value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n       title=\"Score of this answer\" \n       type=\"text\" \n       data-for=\"",(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n       name=\"score\" \n       class=\"score\" \n       placeholder = \"",(helper=helpers.placeholder)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholder,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n       data-validate=\"$numeric\" \n       data-validate-option=\"$allowEmpty; $event(type=keyup)\" />",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget",["jquery","taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score","lodash","i18n"],function($,commonRenderer,instructionMgr,formElement,scoreTpl,_,__){'use strict';var ResponseWidget={create:function create(widget,responseMappingMode){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),responseMappingMode?(instructionMgr.appendInstruction(widget.element,__("Please define the correct response and the score below.")),interaction.data("responseMappingMode",!0),ResponseWidget.createScoreWidgets(widget),ResponseWidget.createCorrectWidgets(widget)):(instructionMgr.appendInstruction(widget.element,__("Please define the correct response below.")),ResponseWidget.createCorrectWidgets(widget)),commonRenderer.render(interaction),widget.$container.find("table.matrix input[type=checkbox]").removeProp("disabled").attr("data-edit","correct").attr("data-role","correct")},setResponse:function setResponse(interaction,response){commonRenderer.setResponse(interaction,ResponseWidget.formatResponse(response))},destroy:function destroy(widget){var interaction=widget.element;interaction.removeData("responseMappingMode"),widget.$container.find("table.matrix input[type=checkbox]").prop("disabled","disabled"),widget.$container.find("table.matrix .score").remove(),widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction)},createScoreWidgets:function createScoreWidgets(widget){var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),defaultValue=response.getMappingAttribute("defaultValue");$container.find("table.matrix td>label").each(function(){var pairId=commonRenderer.inferValue(this).join(" ");$(this).append(scoreTpl({serial:interaction.getSerial(),choiceIdentifier:pairId,score:mapEntries[pairId]?mapEntries[pairId]:"",placeholder:defaultValue}))});var $scores=$container.find("table.matrix .score");$scores.on("click",function(e){e.stopPropagation(),e.preventDefault()}),widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&$scores.attr("placeholder",data.value)}),formElement.setChangeCallbacks($container,response,{score:function score(response,value){var key=$(this).data("for");""===value?response.removeMapEntry(key):response.setMapEntry(key,value,!0)}})},createCorrectWidgets:function createCorrectWidgets(widget){var interaction=widget.element,response=interaction.getResponseDeclaration();widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(ResponseWidget.unformatResponse(data.response))})},formatResponse:function formatResponse(response){var formatedRes={list:{directedPair:[]}};if(1===_.size(response)){var pair=_.values(response).pop().split(" ");formatedRes={base:{directedPair:pair}}}else formatedRes={list:{directedPair:[]}},_.each(response,function(pairString){var pair=pairString.split(" ");formatedRes.list.directedPair.push(pair)});return formatedRes},unformatResponse:function unformatResponse(formatedResponse){var res=[];return formatedResponse.list&&formatedResponse.list.directedPair?_.each(formatedResponse.list.directedPair,function(pair){res.push(pair.join(" "))}):formatedResponse.base&&formatedResponse.base.directedPair&&res.push(formatedResponse.base.directedPair.join(" ")),res}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var MatchInteractionStateCorrect=stateFactory.create(Correct,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget),responseWidget.setResponse(interaction,_.values(response.getCorrect()))},function(){responseWidget.destroy(this.widget)});return MatchInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function($,stateFactory,Map,responseWidget,_){var MatchInteractionStateMap=stateFactory.create(Map,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget,!0),responseWidget.setResponse(interaction,_.values(response.getCorrect())),_widget.on("metaChange",function(meta){"defineCorrect"===meta.key&&(meta.value?$(".match-interaction-area input[type=\"checkbox\"]",_widget.$container).removeProp("disabled").removeClass("disabled"):$(".match-interaction-area input[type=\"checkbox\"]",_widget.$container).prop("disabled",!0).prop("checked",!1).addClass("disabled"),!1===meta.value&&response.setCorrect([]))})},function(){responseWidget.destroy(this.widget)});return MatchInteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states"],function(Widget,states){var MatchInteractionWidget=Widget.clone();return MatchInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},MatchInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget"],function(_,MatchInteraction,MatchInteractionWidget){'use strict';var CreatorMatchInteraction=_.clone(MatchInteraction);return CreatorMatchInteraction.render=function(interaction,options){MatchInteractionWidget.build(interaction,MatchInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorMatchInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(){return"checked=\"checked\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n    <div>\n        <label>\n            <div>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Media file path or YouTube video address",options):helperMissing.call(depth0,"__","Media file path or YouTube video address",options)))+"</div>\n            <input type=\"text\" name=\"data\" placeholder=\"Please select media file\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty;\"/>\n            <div><button class='selectMediaFile btn-info small block'>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select media file",options):helperMissing.call(depth0,"__","Select media file",options)))+"</button></div>\n        </label>\n    </div>\n\n\n    <div class=\"panel media-sizer-panel\">\n      <!-- media sizer goes here -->\n    </div>\n\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"autostart\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.autostart,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Autostart",options):helperMissing.call(depth0,"__","Autostart",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",options):helperMissing.call(depth0,"__","The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",options)))+"\n    </span>\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"loop\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.loop,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Loop",options):helperMissing.call(depth0,"__","Loop",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n       "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",options):helperMissing.call(depth0,"__","The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",options)))+"\n    </span>\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"pause\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.pause,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n       "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enable the test taker to pause and restart the playing.",options):helperMissing.call(depth0,"__","Enable the test taker to pause and restart the playing.",options)))+"\n    </span>\n</div>\n\n<div class=\"panel\">\n    <div>\n        <label for=\"maxPlays\" class=\"spinner\">Max plays count</label>\n        <input name=\"maxPlays\" value=\"",(helper=helpers.maxPlays)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxPlays,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"large\" data-increment=\"1\" data-min=\"0\" data-max=\"1000\" type=\"text\" />\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",options):helperMissing.call(depth0,"__","The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",options)))+"\n        </span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","ui/resourcemgr","ui/mediasizer","ui/tooltip"],function($,_,__,stateFactory,Question,formElement,formTpl){'use strict';var MediaInteractionStateQuestion=stateFactory.extend(Question,function(){this.widget.renderInteraction()},function(){this.widget.destroyInteraction()});return MediaInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,$form=widget.$form,$container=widget.$original,options=widget.options,interaction=widget.element,isAudio=!1,reRender=_.debounce(function(){interaction.attr("responseIdentifier",interaction.attr("responseIdentifier")),widget.destroyInteraction(),widget.renderInteraction()},1e3),switchToAudio=function(){isAudio=!0,$heightContainer.hide(),interaction.object.attr("height",30)},switchToVideo=function(){isAudio&&(isAudio=!1,interaction.object.attr("height",270),$heightContainer.show())},callbacks,$heightContainer;$form.html(formTpl({autostart:!!interaction.attr("autostart"),loop:!!interaction.attr("loop"),maxPlays:parseInt(interaction.attr("maxPlays"),10),pause:interaction.hasClass("pause"),data:interaction.object.attr("data"),type:interaction.object.attr("type"),width:interaction.object.attr("width"),height:interaction.object.attr("height")})),formElement.initWidget($form),$heightContainer=$(".height-container",$form),$form.find(".media-sizer-panel").on("sizechange.mediasizer",function(){$(this).find("input").trigger("change")}).mediasizer({showResponsiveToggle:!1,showSync:!1,showReset:!1,responsive:!1,applyToMedium:!1,width:interaction.object.attr("width"),height:interaction.object.attr("height"),minWidth:50,maxWidth:$container.innerWidth()}),function(){/audio/.test(interaction.object.attr("type"))?switchToAudio():switchToVideo()}(),callbacks={autostart:function(boundInteraction,attrValue,attrName){interaction.attr(attrName,attrValue),reRender()},loop:function(boundInteraction,attrValue,attrName){interaction.attr(attrName,attrValue),reRender()},maxPlays:function(boundInteraction,attrValue,attrName){interaction.attr(attrName,attrValue),reRender()},pause:function(boundInteraction,attrValue){attrValue?!$container.hasClass("pause")&&($container.addClass("pause"),interaction.addClass("pause")):($container.removeClass("pause"),interaction.removeClass("pause"))},width:function(boundInteraction,attrValue,attrName){interaction.object.attr(attrName,attrValue),reRender()},height:function(boundInteraction,attrValue,attrName){isAudio||(interaction.object.attr(attrName,attrValue),reRender())},data:function(boundInteraction,attrValue,attrName){var value;interaction.object.attr(attrName)!==attrValue&&(interaction.object.attr(attrName,attrValue),value=$.trim(attrValue).toLowerCase(),/^http(s)?:\/\/(www\.)?youtu/.test(value)?(interaction.object.attr("type","video/youtube"),switchToVideo()):/audio/.test(interaction.object.attr("type"))?switchToAudio():switchToVideo(),interaction.object&&(!interaction.object.attr("width")||0>=parseInt(interaction.object.attr("width"),10))&&interaction.object.attr("width",widget.$original.innerWidth()),reRender())}},formElement.setChangeCallbacks($form,interaction,callbacks,{invalidate:!0}),function(){var $src=$form.find("input[name=data]"),$uploadTrigger=$form.find(".selectMediaFile"),openResourceMgr=function(){$uploadTrigger.resourcemgr({title:__("Please select a media file (video or audio) from the resource manager. You can add files from your computer with the button \"Add file(s)\"."),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:"video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg,application/ogg,audio/aac,audio/wav,audio/flac"},pathParam:"path",select:function select(e,files){files&&files.length?(interaction.object.attr("type",files[0].mime),$src.val(files[0].file).trigger("change")):$src.trigger("noselection")},open:function open(){$src.data("$tooltip")&&$src.blur().data("$tooltip").hide()},close:function close(){$src.blur()}})};$uploadTrigger.on("click",openResourceMgr),$src.val()||openResourceMgr()}()},MediaInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Answer",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer"],function($,_,__,stateFactory,Answer){'use strict';return stateFactory.extend(Answer,function(){this.widget.renderInteraction()},function(){this.widget.destroyInteraction()})}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(_,stateFactory,SleepState){return stateFactory.extend(SleepState,function(){this.widget.renderInteraction(),this.widget.$original.append("<div class=\"overlay\"></div>")},function(){this.widget.destroyInteraction(),this.widget.$original.children(".overlay").remove()})}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep"],function(factory,states){'use strict';return factory.createBundle(states,arguments,["map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget",["jquery","lodash","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction"],function($,_,Widget,states,commonRenderer){var MediaInteractionWidget=_.extend(Widget.clone(),{initCreator:function initCreator(){var self=this,$container=this.$original,$item=$container.parents(".qti-item");this.registerStates(states),Widget.initCreator.call(this),$item.off("."+this.element.serial).on("resize."+this.element.serial,_.throttle(function(){var width=$container.innerWidth();0<width&&(self.element.object.attr("width",$container.innerWidth()),self.destroyInteraction(),self.renderInteraction())},100))},destroy:function destroy(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize."+this.element.serial),Widget.destroy.call(this)},renderInteraction:function renderInteraction(){var $container=this.$original,interaction=this.element;commonRenderer.render.call(interaction.getRenderer(),interaction,{features:"full",controlPlaying:!1})},destroyInteraction:function destroyInteraction(){var interaction=this.element;commonRenderer.resetResponse.call(interaction.getRenderer(),interaction),commonRenderer.destroy.call(interaction.getRenderer(),interaction)}});return MediaInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"qti-interaction qti-blockInteraction qti-mediaInteraction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n\t",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\t<div class=\"instruction-container\"></div>\n    <div class=\"media-container\"></div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction"],function(_,MediaInteraction,MediaInteractionWidget,tpl){'use strict';return MediaInteraction=_.clone(MediaInteraction),MediaInteraction.template=tpl,MediaInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),MediaInteractionWidget.build(interaction,MediaInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},MediaInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/order",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(){return"checked"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label>\n        <input name=\"shuffle\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \"shuffled\" of \"fixed\" individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be \"shuffled\" of \"fixed\" individually.",options)))+"\n    </span>\n</div>\n\n<hr/>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+"</h3>\n</div>\n<hr/>\n\n<div class=\"panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Orientation",options):helperMissing.call(depth0,"__","Orientation",options)))+"</h3>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Display the choices either horizontally or vertically",options):helperMissing.call(depth0,"__","Display the choices either horizontally or vertically",options)))+"\n        </span>\n    <div>\n        <label class=\"smaller-prompt\">\n            <input type=\"radio\" name=\"orientation\" value=\"vertical\" ",stack1=helpers.unless.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n            <span class=\"icon-radio\"></span>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Vertical",options):helperMissing.call(depth0,"__","Vertical",options)))+"\n        </label>\n        <br>\n        <label class=\"smaller-prompt\">\n            <input type=\"radio\" name=\"orientation\" value=\"horizontal\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n            <span class=\"icon-radio\"></span>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Horizontal",options):helperMissing.call(depth0,"__","Horizontal",options)))+"\n        </label>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/order","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","ui/liststyler"],function(_,stateFactory,Question,formElement,minMaxComponentFactory,formTpl,sizeAdapter){'use strict';var OrderInteractionStateQuestion=stateFactory.extend(Question);return OrderInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,$form=this.widget.$form,interaction=this.widget.element,$choiceArea=this.widget.$container.find(".choice-area"),callbacks;$form.html(formTpl({shuffle:!!interaction.attr("shuffle"),horizontal:"horizontal"===interaction.attr("orientation")})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{value:_.parseInt(interaction.attr("minChoices"))||0},max:{value:_.parseInt(interaction.attr("maxChoices"))||0},upperThreshold:_.size(interaction.getChoices())}).on("render",function(){var self=this;widget.on("choiceCreated choiceDeleted",function(data){data.interaction.serial===interaction.serial&&self.updateThresholds(1,_.size(interaction.getChoices()))})}),formElement.initWidget($form),callbacks=formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices",{updateCardinality:!1}),callbacks.shuffle=formElement.getAttributeChangeCallback(),callbacks.orientation=function(interaction,value){interaction.attr("orientation",value),"horizontal"===value?$choiceArea.addClass("horizontal"):$choiceArea.removeClass("horizontal")},formElement.setChangeCallbacks($form,interaction,callbacks),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget),widget.on("choiceCreated",function(){"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget)})},OrderInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","lodash","i18n"],function(stateFactory,Correct,commonRenderer,instructionMgr,_,__){var InlineChoiceInteractionStateCorrect=stateFactory.create(Correct,function(){_createResponseWidget(this.widget)},function(){_destroyResponseWidget(this.widget)}),_createResponseWidget=function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect());instructionMgr.appendInstruction(widget.element,__("Please define the correct order in the box to the right.")),commonRenderer.render(widget.element),commonRenderer.setResponse(interaction,_formatResponse(correctResponse)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(_unformatResponse(data.response))})},_destroyResponseWidget=function(widget){widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(widget.element),commonRenderer.destroy(widget.element)},_formatResponse=function(response){return{list:{identifier:response}}},_unformatResponse=function(formatedResponse){var res=[];return formatedResponse.list&&formatedResponse.list.identifier&&(res=formatedResponse.list.identifier),res};return InlineChoiceInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states"],function(Widget,states){var OrderInteractionWidget=Widget.clone();return OrderInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},OrderInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget"],function(_,OrderInteraction,OrderInteractionWidget){'use strict';var CreatorOrderInteraction=_.clone(OrderInteraction);return CreatorOrderInteraction.render=function(interaction,options){OrderInteractionWidget.build(interaction,OrderInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorOrderInteraction}),define("taoQtiItem/qtiCreator/renderers/interactions/PortableCustomInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction","taoQtiItem/portableElementRegistry/ciRegistry","taoQtiItem/qtiCreator/helper/commonRenderer"],function(_,Renderer,ciRegistry,commonRenderer){'use strict';var CreatorCustomInteraction=_.clone(Renderer);return CreatorCustomInteraction.render=function(interaction,options){var pciCreator=ciRegistry.getCreator(interaction.typeIdentifier).module;options=options||{},options.baseUrl=this.getOption("baseUrl"),options.mediaManager=this.getOption("mediaManager"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),Renderer.render.call(commonRenderer.get(),interaction),pciCreator&&pciCreator.getWidget().build(interaction,Renderer.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorCustomInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){'use strict';return stateFactory.extend(SleepState,function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(!0===data.value?interaction.addClass("responsive"):interaction.removeClass("responsive"))})},function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+"</h3>\n\n    <div class=\"panel\">\n        <label for=\"data\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+"</div>\n        <input type=\"text\" name=\"data\" value=\"",(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+"</button>\n    </div>\n\n    <div class=\"panel media-sizer-panel\">\n        <!-- media sizer goes here -->\n    </div>\n    <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n    <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" />\n\n\n    <input name=\"type\" value=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"hidden\" readonly />\n</div>\n<div class=\"panel min-max-panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+"</h3>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/component/minMax/minMax","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,__,stateFactory,Question,imageSelector,formElement,minMaxComponentFactory,formTpl,bgImage){'use strict';var SelectPointInteractionStateQuestion=stateFactory.extend(Question,function(){},function(){var widget=this.widget,interaction=widget.element,valid=!!interaction.object.attr("data");widget.isValid("selectPointInteraction",valid)});return SelectPointInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;$form.html(formTpl({baseUrl:options.baseUrl,data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),minMaxComponentFactory($form.find(".min-max-panel"),{min:{value:_.parseInt(interaction.attr("minChoices"))||0,helpMessage:__("The minimum number of choices that the candidate is required to select to form a valid response.")},max:{value:_.parseInt(interaction.attr("maxChoices"))||0,helpMessage:__("The maximum number of choices that the candidate is allowed to select.")},upperThreshold:1/0}),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices"))},SelectPointInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/incrementer","ui/tooltip"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,answerStateHelper,shapeEditor,grahicScorePopup,mappingFormTpl,formElement,incrementer,tooltip){var _Mathround12=Math.round;function areaId(area){return area.shape+"-"+area.coords.replace(/,*/g,"-")}function getAreaIndex(response,id){var found=!1;return _.forEach(response.mapEntries,function(area,index){if(areaId(area)===id)return found=index,!1}),found}function setCurrentResponses(widget){var interaction=widget.element,$container=widget.$original,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());_.forEach(response.mapEntries,function(area){var shape=widget.createResponseArea(area.shape,area.coords);setUpScoringArea(widget,area,shape,!1)}),answerStateHelper.defineCorrect(response)&&corrects.length&&_.forEach(corrects,function(correct){var point=correct.split(" ");if(2<=point.length){var target=graphicHelper.createTarget(interaction.paper,{point:{x:point[0],y:point[1]}});widget._targets.push(target.id)}}),interaction.paper.getById("bg-image-"+interaction.serial).click(function(){$(".-mapping-editor",$container).hide()})}function createEditor(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),$container=widget.$original,editor=shapeEditor(widget,{currents:response.mapEntries.map(areaId).concat(widget._targets),target:!0,shapeCreated:function shapeCreated(shape,type){var point,corrects,area;"target"===type?(point=shape.data("target"),corrects=response.getCorrect()||[],corrects.push(qtiPoint(point)),response.setCorrect(corrects)):(area={shape:"path"===type?"poly":type,coords:graphicHelper.qtiCoords(shape),mappedValue:response.mappingAttributes.defaultValue||"0"},setUpScoringArea(widget,area,shape,!0),response.mapEntries.push(area))},shapeRemoved:function shapeRemoved(id,data){var scoreElt;/^target/.test(id)&&data.target?response.setCorrect(_.without(response.getCorrect(),qtiPoint(data.target))):(scoreElt=interaction.paper.getById("score-"+id),scoreElt&&scoreElt.remove(),$("#score-popup-"+id).remove(),_.remove(response.mapEntries,function(area){return id&&areaId(area)===id}))},enterHandling:function enterHandling(shape){var $scorePopup=$("#score-popup-"+shape.id),$reference=$(".icon-help",$scorePopup);"set"===shape.type?shape.forEach(function(setElt){if("path"===setElt.type)return void setElt.attr(graphicHelper._style["target-hover"])}):(shape.toFront(),$scorePopup.show(),$(".mapping-editor",$container).on("click",".closer",function(){$scorePopup.hide()}),!$reference.data("$tooltip")&&tooltip.lookup($scorePopup))},quitHandling:function quitHandling(shape){if("set"===shape.type)shape.forEach(function(setElt){if("path"===setElt.type)return void setElt.attr(graphicHelper._style["target-success"])});else{var scoreElt=interaction.paper.getById("score-"+shape.id);scoreElt&&scoreElt.show().toFront(),$("#score-popup-"+shape.id).hide()}},shapeChanging:function shapeChanging(shape){var scoreElt=interaction.paper.getById("score-"+shape.id);scoreElt&&scoreElt.remove(),$("#score-popup-"+shape.id).remove()},shapeChange:function shapeChange(shape){var index=getAreaIndex(response,shape.id),mapEntry;!1!==index&&(mapEntry=response.mapEntries[index],response.mapEntries[index].coords=graphicHelper.qtiCoords(shape),setUpScoringArea(widget,mapEntry,shape,mapEntry.mappedValue===response.mappingAttributes.defaultValue),shape.id=areaId(mapEntry))}});return editor.create(),editor}function qtiPoint(point){return _Mathround12(point.x)+" "+_Mathround12(point.y)}function setUpScoringArea(widget,area,shape,defaults){var interaction=widget.element,$container=widget.$original,isResponsive=$container.hasClass("responsive"),response=interaction.getResponseDeclaration(),id=areaId(area),$imageBox=$(".main-image-box",$container),$popup=grahicScorePopup(interaction.paper,shape,$imageBox,isResponsive),score=area.mappedValue||response.mappingAttributes.defaultValue||"0",scoreElt=graphicHelper.createShapeText(interaction.paper,shape,{id:"score-"+id,content:area.mappedValue+"",style:"score-text-default",title:__("Score value"),shapeClick:!0});scoreElt.data("default",!!defaults),shape.id=id,$popup.attr("id","score-popup-"+id);var $form=$(mappingFormTpl({score:area.mappedValue,scoreMin:response.getMappingAttribute("lowerBound"),scoreMax:response.getMappingAttribute("upperBound"),noCorrect:!0}));formElement.setChangeCallbacks($form,response,{score:function(response,value){""===value?scoreElt.attr({text:response.mappingAttributes.defaultValue}).data("default",!0):scoreElt.attr({text:value}).data("default",!1),area.mappedValue=parseFloat(value)}}),$form.appendTo($popup)}function listenResponseAttrChange(widget){var interaction=widget.element,$container=widget.$container,$target=$container.find("[data-type=\"target\"]"),$separator=$target.prev(".separator");widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&interaction.paper.forEach(function(element){/^score/.test(element.id)&&!0===element.data("default")&&element.attr({text:data.value})})}),widget.on("metaChange",function(data){"defineCorrect"===data.key&&(data.value?($target.show(),$separator.show()):($target.hide(),$separator.hide(),_.forEach(widget._targets,function(targetId){var target=interaction.paper.getById(targetId),layer=interaction.paper.getById("layer-"+targetId);target.remove(),layer.remove()})))})}return stateFactory.create(Map,function(){var widget=this.widget,interaction=widget.element,$container=widget.$original,response=interaction.getResponseDeclaration();widget._targets=[];interaction.paper&&(commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please create areas that correspond to the response and associate them a score.\nYou can also position the target to the exact point as the correct response.")),interaction.responseMappingMode=!0,_.isPlainObject(response.mapEntries)&&(response.mapEntries=_.values(response.mapEntries)),interaction.paper=widget.createPaper(),setCurrentResponses(widget),widget._editor=createEditor(widget),listenResponseAttrChange(widget))},function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget._editor&&widget._editor.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=this.widget.createPaper())})}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function($,_,__,Widget,GraphicWidget,states,graphicHelper){var SelectPointInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function initCreator(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(),paper&&(this.element.paper=paper)},destroy:function destroy(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)},createResponseArea:function createResponseArea(shapeType,coords){return graphicHelper.createElement(this.element.paper,shapeType,coords,{touchEffect:!1})}});return SelectPointInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget"],function(_,SelectPointInteraction,SelectPointInteractionWidget){'use strict';var CreatorSelectPointInteraction=_.clone(SelectPointInteraction);return CreatorSelectPointInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),SelectPointInteractionWidget.build(interaction,SelectPointInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorSelectPointInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"lowerBound\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Lower Bound",options):helperMissing.call(depth0,"__","Lower Bound",options)))+"</label>\n    <input name=\"lowerBound\" value=\"",(helper=helpers.lowerBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.lowerBound,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\"1\" type=\"text\" />\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The lower bound of the slider",options):helperMissing.call(depth0,"__","The lower bound of the slider",options)))+"</span>\n    <label for=\"upperBound\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Upper Bound",options):helperMissing.call(depth0,"__","Upper Bound",options)))+"</label>\n    <input name=\"upperBound\" value=\"",(helper=helpers.upperBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperBound,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\"1\" type=\"text\" />\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The upper bound of the slider",options):helperMissing.call(depth0,"__","The upper bound of the slider",options)))+"</span>\n</div>\n\n<div class=\"panel\">\n    <label for=\"step\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Step",options):helperMissing.call(depth0,"__","Step",options)))+"</label>\n    <input name=\"step\" value=\"",(helper=helpers.step)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.step,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\"1\" data-min=\"0\" data-max=\"",(helper=helpers.upperBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperBound,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" />\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The number of units corresponding to a step on the slider",options):helperMissing.call(depth0,"__","The number of units corresponding to a step on the slider",options)))+"</span>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider"],function(stateFactory,Question,formElement,formTpl){var SliderInteractionStateQuestion=stateFactory.extend(Question);return SliderInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({lowerBound:parseFloat(interaction.attr("lowerBound")),upperBound:parseFloat(interaction.attr("upperBound")),orientation:interaction.attr("orientation"),reverse:!!interaction.attr("reverse"),step:parseInt(interaction.attr("step")),stepLabel:!!interaction.attr("stepLabel")})),formElement.initWidget($form);var callbacks={};callbacks.lowerBound=function(interaction,attrValue){interaction.attr("lowerBound",parseFloat(attrValue));var lowerBound=interaction.attr("lowerBound"),upperBound=interaction.attr("upperBound"),sliderLength=upperBound-lowerBound,step=interaction.attr("step"),reverse=!!interaction.attr("reverse");lowerBound>upperBound&&(callbacks.upperBound(interaction,lowerBound),_widget.$form.find("input[name=\"upperBound\"]").val(lowerBound)),sliderLength<step&&0<=sliderLength&&(callbacks.step(interaction,sliderLength),_widget.$form.find("input[name=\"step\"]").val(sliderLength)),_widget.$container.find(reverse?".slider-max":".slider-min").text(attrValue),_widget.$container.find("span.qti-slider-cur-value").text(lowerBound),_widget.$container.find(".qti-slider").noUiSlider({range:{min:lowerBound,max:upperBound}},!0),_widget.$container.find(".qti-slider").val(lowerBound)},callbacks.upperBound=function(interaction,attrValue){interaction.attr("upperBound",parseFloat(attrValue));var lowerBound=interaction.attr("lowerBound"),upperBound=interaction.attr("upperBound"),sliderLength=upperBound-lowerBound,step=interaction.attr("step"),reverse=!!interaction.attr("reverse");upperBound<lowerBound&&(callbacks.lowerBound(interaction,upperBound),_widget.$form.find("input[name=\"lowerBound\"]").val(upperBound)),sliderLength<step&&0<=sliderLength&&(callbacks.step(interaction,sliderLength),_widget.$form.find("input[name=\"step\"]").val(sliderLength)),_widget.$form.find("input[name=\"step\"]").incrementer("options",{max:upperBound}),_widget.$container.find(reverse?".slider-min":".slider-max").text(attrValue),_widget.$container.find(".qti-slider").noUiSlider({range:{min:interaction.attr("lowerBound"),max:interaction.attr("upperBound")}},!0)},callbacks.orientation=function(interaction,attrValue){interaction.attr("orientation",attrValue);var orientation=interaction.attr("orientation")?interaction.attr("orientation"):"horizontal",reverse=interaction.attr("reverse");_widget.$container.find(".qti-slider").noUiSlider({orientation:interaction.attr("orientation")},!0)},callbacks.reverse=function(interaction,attrValue){interaction.attr("reverse",!!attrValue);var reverse=interaction.attr("reverse"),lowerBound=parseInt(interaction.attr("lowerBound")),upperBound=parseInt(interaction.attr("upperBound")),$sliderElt=_widget.$container.find(".qti-slider"),start=reverse?upperBound:lowerBound;$sliderElt.noUiSlider({start:start},!0),_widget.$container.find("span.qti-slider-cur-value").text(lowerBound),_widget.$container.find(".slider-min").text(reverse?upperBound:lowerBound),_widget.$container.find(".slider-max").text(reverse?lowerBound:upperBound)},callbacks.step=function(interaction,attrValue){var lowerBound=interaction.attr("lowerBound"),upperBound=interaction.attr("upperBound"),currentStep=parseInt(attrValue),sliderLength=upperBound-lowerBound;sliderLength>=currentStep&&(interaction.attr("step",currentStep),_widget.$container.find(".qti-slider").noUiSlider({step:interaction.attr("step")},!0),_widget.$form.find("input[name=\"step\"]").incrementer("options",{max:sliderLength}))},callbacks.stepLabel=function(interaction,attrValue){if(interaction.attr("stepLabel",!!attrValue),_widget.$container.find("span.slider-middle").remove(),interaction.attr("stepLabel")){var upperBound=interaction.attr("upperBound"),lowerBound=interaction.attr("lowerBound"),step=interaction.attr("step"),reverse=interaction.attr("reverse"),steps=parseInt((upperBound-lowerBound)/step),middleStep=parseInt(steps/2),middleValue=reverse?upperBound-middleStep*step:lowerBound+middleStep*step;_widget.$container.find(".slider-min").after("<span class=\"slider-middle\" style=\"left:"+100/steps*middleStep+"%\">"+middleValue+"</span>")}},formElement.setChangeCallbacks($form,interaction,callbacks)},SliderInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","lodash","i18n"],function(stateFactory,Correct,commonRenderer,instructionMgr,_,__){var SliderInteractionStateCorrect=stateFactory.create(Correct,function(){_createResponseWidget(this.widget)},function(){_destroyResponseWidget(this.widget)}),_createResponseWidget=function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect());commonRenderer.setResponse(interaction,_formatResponse(correctResponse));var $sliderElt=widget.$container.find(".qti-slider");$sliderElt.removeAttr("disabled"),instructionMgr.appendInstruction(interaction,__("Please define the correct response using the slider.")),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(_unformatResponse(data.response))})},_destroyResponseWidget=function(widget){var $sliderElt=widget.$container.find(".qti-slider"),lowerBound=widget.element.attributes.lowerBound;$sliderElt.attr("disabled","disabled"),$sliderElt.val(lowerBound),widget.$container.find("span.qti-slider-cur-value").text(""+lowerBound),instructionMgr.removeInstructions(widget.element),widget.$container.off("responseChange.qti-widget")},_formatResponse=function(response){return{base:{integer:response}}},_unformatResponse=function(formatedResponse){return[formatedResponse.base.integer]};return SliderInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states"],function(Widget,states){var SliderInteractionWidget=Widget.clone();return SliderInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),this.$container.find(".qti-slider").attr("disabled","disabled")},SliderInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget"],function(_,SliderInteraction,SliderInteractionWidget){'use strict';var CreatorSliderInteraction=_.clone(SliderInteraction);return CreatorSliderInteraction.render=function(interaction,options){SliderInteraction.render(interaction),SliderInteractionWidget.build(interaction,SliderInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorSliderInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\r\n        <option value=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\r\n        ",buffer}function program2(){return"selected=\"selected\""}function program4(){return"style=\"display:none\""}function program6(depth0,data){var stack1,helper;return(helper=helpers.patternMask)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.patternMask,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}function program8(depth0,data){var buffer="",stack1,helper;return buffer+="value=\"",(helper=helpers.maxLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxLength,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program10(depth0,data){var stack1,helper;return(helper=helpers.expectedLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expectedLength,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\r\n    <label for=\"base\" class=\"spinner\">Base</label>\r\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\r\n    <input name=\"base\" value=\"",(helper=helpers.base)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.base,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-increment=\"1\" data-min=\"1\" data-max=\"100\" type=\"text\" />\r\n    <span class=\"tooltip-content\">\r\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",options):helperMissing.call(depth0,"__","If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",options)))+"\r\n    </span>\r\n</div>\r\n\r\n<div class=\"panel\">\r\n    <label for=\"placeholderText\" class=\"spinner\">Placeholder Text</label>\r\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\r\n    <input name=\"placeholderText\" value=\"",(helper=helpers.placeholderText)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholderText,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" />\r\n    <span class=\"tooltip-content\">\r\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",options):helperMissing.call(depth0,"__","In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",options)))+"\r\n    </span>\r\n</div>\r\n\r\n<hr>\r\n\r\n<div class=\"panel\">\r\n    <h3 class=\"full-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Contraints",options):helperMissing.call(depth0,"__","Contraints",options)))+"</h3>\r\n    <select name=\"constraint\" class=\"select2\" data-has-search=\"false\">\r\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.constraints,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n    </select>\r\n</div>\r\n\r\n<div class=\"panel extendedText\">\r\n    \r\n    <div class=\"constraint constraint-pattern\" ",stack1=helpers.unless.call(depth0,(stack1=(stack1=depth0&&depth0.constraints,null==stack1||!1===stack1?stack1:stack1.pattern),null==stack1||!1===stack1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\r\n        <label>\r\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pattern",options):helperMissing.call(depth0,"__","Pattern",options)))+"\r\n        </label>\r\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\r\n        <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid",options):helperMissing.call(depth0,"__","If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid",options)))+"</span>\r\n        <input type=\"text\" name=\"patternMask\" value=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.patternMask,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"/>\r\n    </div>\r\n    \r\n    <div class=\"constraint constraint-maxLength\" ",stack1=helpers.unless.call(depth0,(stack1=(stack1=depth0&&depth0.constraints,null==stack1||!1===stack1?stack1:stack1.maxLength),null==stack1||!1===stack1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\r\n        <label class=\"spinner\">\r\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max length",options):helperMissing.call(depth0,"__","Max length",options)))+"\r\n        </label>\r\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\r\n        <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"We will use the patternMask to do this, to be compliant with the IMS standard",options):helperMissing.call(depth0,"__","We will use the patternMask to do this, to be compliant with the IMS standard",options)))+"</span>\r\n        <input type=\"text\" data-min=\"0\" data-increment=\"1\" class=\"incrementer\" name=\"maxLength\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\r\n    </div>\r\n</div>\r\n\r\n<hr>\r\n\r\n<div class=\"panel extendedText\">\r\n    <h3 class=\"full-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Recommendations",options):helperMissing.call(depth0,"__","Recommendations",options)))+"</h3>\r\n    <div class=\"panel\">\r\n        <label for=\"expectedLength\" class=\"spinner\">Length</label>\r\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\r\n        <input name=\"expectedLength\" value=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.expectedLength,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-increment=\"1\" data-min=\"1\" data-max=\"100\" type=\"text\" />\r\n        <span class=\"tooltip-content\">\r\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",options):helperMissing.call(depth0,"__","Provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",options)))+"\r\n        </span>\r\n    </div>\r\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question",["jquery","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/helpers/patternMask","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry"],function($,__,stateFactory,Question,formElement,patternMaskHelper,formTpl){'use strict';var TextEntryInteractionStateQuestion=stateFactory.extend(Question);return TextEntryInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element,patternMask=interaction.attr("patternMask"),maxChars=parseInt(patternMaskHelper.parsePattern(patternMask,"chars"),10),constraints={none:{label:__("None"),selected:!0},maxLength:{label:__("Max Length"),selected:!1},pattern:{label:__("Pattern"),selected:!1}},$inputs;!isNaN(maxChars)&&0<maxChars?(constraints.none.selected=!1,constraints.maxLength.selected=!0):null!==patternMask&&void 0!==patternMask&&""!==patternMask&&(constraints.none.selected=!1,constraints.pattern.selected=!0),$form.html(formTpl({base:parseInt(interaction.attr("base")),placeholderText:interaction.attr("placeholderText"),expectedLength:parseInt(interaction.attr("expectedLength")),constraints:constraints,patternMask:patternMask,maxLength:maxChars})),formElement.initWidget($form),$inputs={maxLength:$form.find("[name=\"maxLength\"]"),patternMask:$form.find("[name=\"patternMask\"]")},formElement.setChangeCallbacks($form,interaction,{base:formElement.getAttributeChangeCallback(),placeholderText:formElement.getAttributeChangeCallback(),expectedLength:function(interaction,attrValue){interaction.attr("expectedLength",isNaN(parseInt(attrValue,10))?0:attrValue)},constraint:function(interaction,attrValue){$(".constraint",$form).hide("500"),$(".constraint-"+attrValue,$form).show("1000"),"none"===attrValue&&($("input",$form).val(""),interaction.attr("patternMask",null))},patternMask:function(interaction,attrValue){interaction.attr("patternMask",attrValue),$inputs.maxLength.val("")},maxLength:function(interaction,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)||interaction.attr("patternMask",patternMaskHelper.createMaxCharPattern(newValue)),$inputs.patternMask.val(interaction.attr("patternMask"))}})},TextEntryInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","lodash","i18n"],function($,stateFactory,Correct,instructionMgr,_,__){'use strict';var TextEntryInteractionStateCorrect=stateFactory.create(Correct,function(){var $container=this.widget.$container,response=this.widget.element.getResponseDeclaration(),correct=_.values(response.getCorrect()).pop()||"";$container.find("tr[data-edit=correct] input[name=correct]").focus().val(correct),$container.on("keyup.correct","tr[data-edit=correct] input[name=correct]",function(){var value=$(this).val();value?response.setCorrect(value):response.resetCorrect()}),instructionMgr.appendInstruction(this.widget.element,__("Please type the correct response in the box below."))},function(){this.widget.$container.off(".correct"),instructionMgr.removeInstructions(this.widget.element)});return TextEntryInteractionStateCorrect}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<tr class=\"\" data-edit=\"map\">\r\n    <td data-text><input type=\"text\" name=\"text\" value=\"",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-old-text=\"",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"/></td>\r\n    <td class=\"mini-tlb\" colspan=\"2\">\r\n        <label>\r\n            <input name=\"correct\" type=\"radio\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\r\n            <span class=\"icon-radio\"></span>\r\n        </label>\r\n        <input name=\"score\" class=\"score\" value=\"",(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$numeric\" data-validate-option=\"$allowEmpty; $event(type=keyup)\"/>\r\n        <span class=\"icon-bin\" data-role=\"delete-option\"></span>\r\n    </td>\r\n</tr>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry","lodash"],function($,stateFactory,Map,formElement,optionTpl,_){var _getRelatedTextKey=function($elt){return $elt.closest("tr").find("input[name=text]").val()},TextEntryInteractionStateMap=stateFactory.create(Map,function(){this.initMapEntries(),this.initFormCallbacks(),this.hideCorrectInput()},function(){this.widget.$container.off(".map"),this.widget.$container.find("tr[data-edit=map]:not([data-add-option])").remove()});return TextEntryInteractionStateMap.prototype.hideCorrectInput=function(){var $correct=this.widget.$container.find("tr[data-edit=correct]");this.widget.on("metaChange",function(data){"defineCorrect"===data.key&&$correct.hide()}),$correct.hide(),_.delay(function(){$correct.hide()},200)},TextEntryInteractionStateMap.prototype.initFormCallbacks=function(){var $container=this.widget.$container,response=this.widget.element.getResponseDeclaration();formElement.setChangeCallbacks($container,response,{text:_.throttle(function(response,value){var $text=$(this),oldText=$text.data("old-text"),$tr=$text.closest("tr"),correct=!!$tr.find("input[name=correct]:checked").length,score=parseInt($tr.find(".score").val());isNaN(score)||(response.removeMapEntry(oldText,!0),response.setMapEntry(value,score),$text.data("old-text",value),correct&&response.setCorrect(value))},600),correct:function correct(response){var text=_getRelatedTextKey($(this));response.setCorrect(text)},score:function(response,value){var text=_getRelatedTextKey($(this)),score=parseFloat(value);isNaN(score)||response.setMapEntry(text,score)}})},TextEntryInteractionStateMap.prototype.initMapEntries=function(){var _this=this,response=this.widget.element.getResponseDeclaration(),correctValue=_.values(response.getCorrect()).pop(),$container=this.widget.$container,$addOption=$container.find("tr[data-add-option]"),appendOption=function(text,score){var $newOption=$(optionTpl({text:text||"",score:score||0,correct:text===correctValue}));$newOption.show(),$addOption.before($newOption),preventNullMapEntries()},preventNullMapEntries=function(){var $deleteButtons=$container.find("tbody [data-role=delete-option]");1===$deleteButtons.length?$deleteButtons.css("visibility","hidden"):$deleteButtons.css("visibility","visible")};_.size(response.mapEntries)||(response.mapEntries={"":0}),_.forIn(response.mapEntries,function(score,text){appendOption(text,score)}),$container.on("click.map","[data-role=delete-option]",function(){var $del=$(this),text=_getRelatedTextKey($del),correct=!!$del.closest("tr").find("input[name=correct]:checked").length;response.removeMapEntry(text,!0),$del.closest("tr").remove(),preventNullMapEntries(),correct&&response.resetCorrect()}).on("click.map",".add-option",function(){appendOption("",0),_this.initFormCallbacks()})},TextEntryInteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"widget-box widget-inline widget-textEntryInteraction qti-interaction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-edit=\"active\">\r\n    <div class=\"qti-interaction qti-textEntryInteraction\">\r\n        <table>\r\n            <colgroup>\r\n                <col class=\"text\">\r\n                <col class=\"icon\">\r\n                <col class=\"icon\">\r\n            </colgroup>\r\n            <tbody>\r\n                <tr data-edit=\"question\">\r\n                    <td class=\"main-option\"></td>\r\n                    <td colspan=\"2\"></td>\r\n                </tr>\r\n                <tr data-edit=\"correct\">\r\n                    <td data-text>\r\n                        <div class=\"instruction-container\"></div>\r\n                        <input type=\"text\" name=\"correct\" value=\"",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" /></td>\r\n                    <td class=\"mini-tlb\" colspan=\"2\">\r\n                    </td>\r\n                </tr>\r\n                <tr data-add-option data-edit=\"map\">\r\n                    <td>\r\n                        <div class=\"add-option\">\r\n                            <span class=\"icon-add\"></span>\r\n                            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add another option",options):helperMissing.call(depth0,"__","Add another option",options)))+"\r\n                        </div>\r\n                    </td>\r\n                    <td colspan=\"2\"></td>\r\n                </tr>\r\n                <tr data-edit=\"custom\">\r\n                    <td colspan=\"3\">\r\n                        <!-- Input solely provides visual in response state -->\r\n                        <input type=\"text\" />\r\n                    </td>\r\n                </tr>\r\n                <tr data-edit=\"norp\">\r\n                    <td colspan=\"3\">\r\n                        <!-- Input solely provides visual in response state -->\r\n                        <input type=\"text\" disabled=\"disabled\"/>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget",["lodash","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction"],function(_,InteractionWidget,states,interactionTpl){var TextEntryInteractionWidget=InteractionWidget.clone();return TextEntryInteractionWidget.initCreator=function(){this.registerStates(states),InteractionWidget.initCreator.call(this),this.$container.find(".tlb-title").remove()},TextEntryInteractionWidget.renderInteraction=function(){var interaction=this.element,tplData={tag:interaction.qtiClass,serial:interaction.serial,attributes:interaction.attributes};return interactionTpl(tplData)},TextEntryInteractionWidget.buildContainer=function(){var previous,next;this.$original.length&&(previous=this.$original[0].previousSibling,next=this.$original[0].nextSibling,(!previous||3===previous.nodeType&&""===previous.nodeValue||3!==previous.nodeType)&&this.$original.before("&nbsp;"),(!next||3===next.nodeType&&""===next.nodeValue||3!==next.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-textEntryInteraction[data-serial="+this.element.getSerial()+"]")},TextEntryInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"widget-box textEntryInteraction-placeholder\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"textEntryInteraction\">\r\n    <label>&nbsp;</label>\r\n</span>",buffer})}),define("taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder"],function($,_,TextEntryInteraction,TextEntryInteractionWidget,tpl){'use strict';var CreatorTextEntryInteraction=_.clone(TextEntryInteraction);return CreatorTextEntryInteraction.template=tpl,CreatorTextEntryInteraction.render=function(interaction,options){options=options||{},TextEntryInteractionWidget.build(interaction,$(".textEntryInteraction-placeholder[data-serial=\""+interaction.serial+"\"]"),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorTextEntryInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    \t\t<option value=\"",(helper=helpers.mime)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mime,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    \t",buffer}function program2(){return"selected=\"selected\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"MIME-type",options):helperMissing.call(depth0,"__","MIME-type",options)))+"</h3>\n<span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n<div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The MIME-type attribute describes which kind of file may be uploaded.",options):helperMissing.call(depth0,"__","The MIME-type attribute describes which kind of file may be uploaded.",options)))+"</div>\n\n<div class=\"reset-group\">\n    <select name=\"type\" class=\"select2\" multiple data-has-search=\"false\">\n    \t",stack1=helpers.each.call(depth0,depth0&&depth0.types,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/helpers/uploadMime","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload"],function(_,__,stateFactory,Question,formElement,uploadHelper,formTpl){'use strict';var UploadInteractionStateQuestion=stateFactory.extend(Question);return UploadInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element,callbacks={},types=uploadHelper.getMimeTypes(),selectedMime="",preselected=uploadHelper.getExpectedTypes(interaction);for(var i in types.unshift({mime:"any/kind",label:__("-- Any kind of file --")}),""===interaction.attr("type")&&delete interaction.attributes.type,types)0<=_.indexOf(preselected,types[i].mime)&&(types[i].selected=!0,selectedMime=types[i].mime);$form.html(formTpl({types:types})),formElement.initWidget($form);var $select=$form.find("[name=\"type\"]");$select.select2({width:"100%",formatNoMatches:function formatNoMatches(){return __("Enter a select MIME-type")}}),callbacks.type=function(interaction,attrValue){uploadHelper.setExpectedTypes(interaction,attrValue)},formElement.setChangeCallbacks($form,interaction,callbacks)},UploadInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question"],function(factory,states){'use strict';return factory.createBundle(states,arguments,["map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states"],function(Widget,states){var UploadInteractionWidget=Widget.clone();return UploadInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},UploadInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program3(depth0,data){var stack1,helper;return(helper=helpers["visible-file-upload-preview"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["visible-file-upload-preview"],stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"qti-interaction qti-blockInteraction qti-uploadInteraction\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n\t",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\t<div class=\"instruction-container\"></div>\n    <div class=\"fixed-grid-row file-upload lft\">\n        <span class=\"btn-info small col-4\"></span>\n        <span class=\"file-name placeholder col-8 truncate\"></span>\n    </div>\n    <div class=\"file-upload-preview lft ",stack1=helpers["if"].call(depth0,depth0&&depth0.isPreviewable,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n        <p class=\"nopreview\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No preview available",options):helperMissing.call(depth0,"__","No preview available",options)))+"</p>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction"],function(_,UploadInteraction,UploadInteractionWidget,tpl){'use strict';return UploadInteraction=_.clone(UploadInteraction),UploadInteraction.template=tpl,UploadInteraction.render=function(interaction,options){UploadInteraction.resetGui(interaction),UploadInteractionWidget.build(interaction,UploadInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},UploadInteraction}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n    <div class=\"panel\">\n        <label for=\"xml:lang\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Language",options):helperMissing.call(depth0,"__","Language",options)))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define item language.",options):helperMissing.call(depth0,"__","Define item language.",options)))+"\n        </span>\n        <select name=\"xml:lang\" class=\"select2\" data-has-search=\"false\">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.languagesList,{hash:{},inverse:self.noop,fn:self.programWithDepth(4,program4,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </select>\n    </div>\n",buffer}function program4(depth0,data,depth1){var buffer="",stack1,helper,options;return buffer+="\n                <option value=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",stack1=(helper=helpers.equal||depth1&&depth1.equal,options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},helper?helper.call(depth0,null==data||!1===data?data:data.key,depth1&&depth1["xml:lang"],options):helperMissing.call(depth0,"equal",null==data||!1===data?data:data.key,depth1&&depth1["xml:lang"],options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">"+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"</option>\n            ",buffer}function program5(){return" selected=\"selected\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",options):helperMissing.call(depth0,"__","The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",options)))+"</div>\n\n    <input type=\"text\" \n           name=\"identifier\" \n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n           placeholder=\"e.g. my-item_123456\" \n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n    \n</div>\n\n<div class=\"panel\">\n    <label for=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Title",options):helperMissing.call(depth0,"__","Title",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The item of the qti item. It is currently used as a meta data only. It is required by the QTI standard.",options):helperMissing.call(depth0,"__","The item of the qti item. It is currently used as a meta data only. It is required by the QTI standard.",options)))+"</div>\n\n    <input type=\"text\" \n           name=\"title\" \n           value=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n           placeholder=\"e.g. My Item A\" \n           data-validate=\"$notEmpty;\">\n    \n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"timeDependent\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.timeDependent,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Time dependent",options):helperMissing.call(depth0,"__","Time dependent",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define whether the item should be time dependent on delivery.",options):helperMissing.call(depth0,"__","Define whether the item should be time dependent on delivery.",options)))+"\n    </span>\n</div>\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.languagesList,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("taoQtiItem/qtiCreator/widgets/item/states/Active",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/item","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(_,stateFactory,Active,formTpl,formElement){'use strict';var ItemStateActive=stateFactory.create(Active,function(){var _widget=this.widget,item=_widget.element,$form=_widget.$form,areaBroker=this.widget.getAreaBroker();$form.html(formTpl({serial:item.getSerial(),identifier:item.id(),title:item.attr("title"),timeDependent:!!item.attr("timeDependent"),"xml:lang":item.attr("xml:lang"),languagesList:item.data("languagesList")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,item,{identifier:formElement.getAttributeChangeCallback(),title:function(i,title){item.attr("title",title),areaBroker.getTitleArea().text(item.attr("title"))},timeDependent:formElement.getAttributeChangeCallback(),"xml:lang":formElement.getAttributeChangeCallback()})},_.noop);return ItemStateActive}),define("taoQtiItem/qtiCreator/widgets/item/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/item/states/Active"],function(factory){return factory.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/item/Widget",["lodash","i18n","jquery","core/promise","util/url","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/item/states/states","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/helper/devTools","taoQtiItem/qtiCreator/widgets/static/text/Widget","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiItem/helper/xmlNsHandler","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","taoQtiItem/qtiCreator/editor/jquery.gridEditor"],function(_,__,$,Promise,urlUtil,Widget,states,Element,creatorRenderer,containerHelper,contentHelper,xmlRenderer,devTools,TextWidget,styleEditor,xmlNsHandler,genericFeedbackPopup){'use strict';function hasUnsupportedInteraction(xml){var $qti=$(xml);return 0<$qti.find("div.qti-interaction.qti-customInteraction[data-serial]").length}var ItemWidget=Widget.clone();ItemWidget.initCreator=function(config){var self=this;if(this.registerStates(states),Widget.initCreator.call(this),!config||!config.uri)throw new Error("missing required config parameter uri in item widget initialization");return this.saveItemUrl=config.saveItemUrl,this.renderer=config.renderer,this.itemUri=config.uri,new Promise(function(resolve){self.initTextWidgets(function(){this.initGridEditor(),this.debug({state:!1,xml:!1}),resolve()})})},ItemWidget.buildContainer=function(){this.$container=this.$original},ItemWidget.save=function(){var self=this;return new Promise(function(resolve,reject){function rejectError(err){"Error"===err.type&&(err=new Error(__("The item has not been saved!")+(err.message?"\n"+err.message:""))),reject(err)}var xml;return xml=xmlNsHandler.restoreNs(xmlRenderer.render(self.element),self.element.getNamespaces()),hasUnsupportedInteraction(xml)?reject(new Error(__("The item cannot be saved because it contains an unsupported custom interaction."))):void $.ajax({url:urlUtil.build(self.saveItemUrl,{uri:self.itemUri}),type:"POST",contentType:"text/xml",dataType:"json",data:xml}).done(function(data){!data||data.success?resolve(data):rejectError(data)}).fail(rejectError)})},ItemWidget.initUiComponents=function(){var _widget=this,element=_widget.element,$saveBtn=$("#save-trigger"),$previewBtn=$(".preview-trigger");_widget.on("metaChange",function(data){if(data.element.getSerial()===element.getSerial()&&"invalid"===data.key){var invalid=element.data("invalid");_.size(invalid)?$saveBtn.addClass("disabled"):$saveBtn.removeClass("disabled")}},!0)},ItemWidget.initGridEditor=function(){var _this=this,item=this.element,$itemBody=this.$container.find(".qti-itemBody"),$itemEditorPanel=$("#item-editor-panel");$itemBody.gridEditor(),$itemBody.gridEditor("resizable"),$itemBody.gridEditor("addInsertables",$(".tool-list > [data-qti-class]:not(.disabled)"),{helper:function helper(){return $(this).find(".icon").clone().addClass("dragging")}}),$itemBody.on("beforedragoverstart.gridEdit",function(){$itemEditorPanel.addClass("dragging"),$itemBody.removeClass("hoverable").addClass("inserting")}).on("dragoverstop.gridEdit",function(){$itemEditorPanel.removeClass("dragging"),$itemBody.addClass("hoverable").removeClass("inserting")}).on("dropped.gridEdit.insertable",function(e,qtiClass,$placeholder){$placeholder.removeAttr("id"),"rubricBlock"===qtiClass&&($placeholder=$placeholder.parent(".col-12").parent(".grid-row")),$placeholder.addClass("widget-box"),$placeholder.attr({"data-new":!0,"data-qti-class":qtiClass});var $widget=$placeholder.parent().closest(".widget-box, .qti-item"),$editable=$placeholder.closest("[data-html-editable], .qti-itemBody"),widget=$widget.data("widget"),element=widget.element,container=Element.isA(element,"_container")?element:element.getBody();if(!element||!$editable.length)throw new Error("cannot create new element");containerHelper.createElements(container,contentHelper.getContent($editable),function(newElts){creatorRenderer.get().load(function(){var self=this;_.forEach(newElts,function(elt){var $colParent=$placeholder.parent(),$widget,widget;elt.setRenderer(self),Element.isA(elt,"_container")?($colParent.empty(),$colParent.html(elt.render()),widget=_this.initTextWidget(elt,$colParent),$widget=widget.$container):(elt.render($placeholder),elt.postRender(),widget=elt.data("widget"),$widget=Element.isA(elt,"blockInteraction")?widget.$container:widget.$original),$widget.trigger("contentChange.gridEdit"),$widget.trigger("resize.gridEdit"),Element.isA(elt,"interaction")?widget.changeState("question"):widget.changeState("active")})},this.getUsedClasses())})}).on("resizestop.gridEdit",function(){item.body($itemBody.gridEditor("getContent"))})},ItemWidget.initTextWidgets=function(callback){var _this=this,item=this.element,$originalContainer=this.$container,i=1,subContainers=[];callback=callback||_.noop,$originalContainer.find(".qti-itemBody > .grid-row").each(function(){var $row=$(this);$row.hasClass("widget-box")||$row.children().each(function(){var $col=$(this),isTextBlock=!1;$col.contents().each(function(){if(3===this.nodeType&&this.nodeValue&&this.nodeValue.trim())return isTextBlock=!0,!1});var $widget=$col.children();(1<$widget.length||!$widget.hasClass("widget-blockInteraction"))&&($widget.hasClass("colrow")?$widget.each(function(){var $subElement=$(this),$subWidget=$subElement.children();(1<$subWidget.length||!$subWidget.hasClass("widget-blockInteraction"))&&($subElement.attr("data-text-block-id","text-block-"+i),i++)}):isTextBlock=!0),isTextBlock&&($col.attr("data-text-block-id","text-block-"+i),i++)})});var $clonedContainer=$originalContainer.clone();$clonedContainer.find(".qti-itemBody > .grid-row [data-text-block-id]").each(function(){var $originalTextBlock=$(this),textBlockId=$originalTextBlock.data("text-block-id"),$subContainer=$originalTextBlock.clone(),subContainerElements=contentHelper.serializeElements($subContainer),subContainerBody=$subContainer.html();$originalTextBlock.removeAttr("data-text-block-id").html("{{_container:new}}"),subContainers.push({body:subContainerBody,elements:subContainerElements,$original:$originalContainer.find("[data-text-block-id=\""+textBlockId+"\"]").removeAttr("data-text-block-id")})}),contentHelper.serializeElements($clonedContainer);var serializedItemBody=$clonedContainer.find(".qti-itemBody").html(),itemBody=item.getBody();subContainers.length?containerHelper.createElements(itemBody,serializedItemBody,function(newElts){if(_.size(newElts)!==subContainers.length)throw"number of sub-containers mismatch";else _.each(newElts,function(container){var containerData=subContainers.shift(),containerElements=_detachElements(itemBody,containerData.elements);container.setElements(containerElements,containerData.body),_this.initTextWidget(container,containerData.$original)}),_.defer(function(){callback.call(_this)})}):callback.call(_this)};var _detachElements=function(container,elements){var containerElements={};return _.each(elements,function(elementSerial){containerElements[elementSerial]=container.elements[elementSerial],delete container.elements[elementSerial]}),containerElements};ItemWidget.initTextWidget=function(container,$col){return TextWidget.build(container,$col,this.renderer.getOption("textOptionForm"),{})},ItemWidget.debug=function(options){if(options=options||{},options.state&&devTools.listenStateChange(),options.xml){var $code=$("<code>",{class:"language-markup"}),$pre=$("<pre>",{class:"line-numbers"}).append($code);$("#item-editor-wrapper").append($pre),devTools.liveXmlPreview(this.element,$code)}};return ItemWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}function program3(depth0){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1)),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"tao-scope qti-item item-editor-item clearfix\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n    <div id=\"modalFeedbacks\"></div>\n    <div",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" class=\"qti-itemBody item-editor-drop-area hoverable",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/renderers/Item",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/Item","taoQtiItem/qtiCreator/widgets/item/Widget","tpl!taoQtiItem/qtiCreator/tpl/item"],function($,_,CommonRenderer,Widget,tpl){'use strict';var CreatorItem=_.clone(CommonRenderer),_normalizeItemBody=function($itemBody){return $itemBody.children().each(function(){var $child=$(this);$child.hasClass("grid-row")||$child.hasClass("qti-infoControl")||$child.wrap("<div class=\"grid-row\"><div class=\"col-12\"></div></div>")}),$itemBody};return CreatorItem.template=tpl,CreatorItem.render=function(item,options){var $itemContainer=CommonRenderer.getContainer(item);return _normalizeItemBody($itemContainer.find(".qti-itemBody")),options=options||{},options.state="active",options.renderer=this,Widget.build(item,$itemContainer,this.getOption("itemOptionForm"),options)},CreatorItem}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var MathStateSleep=stateFactory.extend(SleepState,function(){},function(){});return MathStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/math",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n\n<div class=\"panel\">\n    <label for=\"display\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Display",options):helperMissing.call(depth0,"__","Display",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"How the math expression should be displayed.",options):helperMissing.call(depth0,"__","How the math expression should be displayed.",options)))+"</div>\n\n    <select name=\"display\" class=\"select2\" data-has-search=\"false\">\n        <option value=\"inline\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"inline",options):helperMissing.call(depth0,"__","inline",options)))+"</option>\n        <option value=\"block\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"block",options):helperMissing.call(depth0,"__","block",options)))+"</option>\n    </select>\n</div>\n\n<div class=\"panel\">\n    <label for=\"editMode\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Editing Mode",options):helperMissing.call(depth0,"__","Editing Mode",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"How the math expression should be edited",options):helperMissing.call(depth0,"__","How the math expression should be edited",options)))+".</div>\n\n    <select name=\"editMode\" class=\"select2\" data-has-search=\"false\">\n        <option value=\"latex\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"LaTeX",options):helperMissing.call(depth0,"__","LaTeX",options)))+"</option>\n        <option value=\"mathml\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"MathML",options):helperMissing.call(depth0,"__","MathML",options)))+"</option>\n    </select>\n\n</div>\n\n<div class=\"panel\" data-role=\"latex\" style=\"display:none;\">\n    <label for=\"sidebar-latex-field\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Latex",options):helperMissing.call(depth0,"__","Latex",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",options):helperMissing.call(depth0,"__","Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",options)))+"</div>\n\n    <input id=\"sidebar-latex-field\" type=\"text\" name=\"latex\" value=\"",(helper=helpers.latex)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.latex,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" placeholder=\"e.g. e^{i \\pi} = -1\"/>\n\n    <div class=\"panel\">\n        <button class=\"btn-info small block popup-btn\" data-control=\"latex\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Large editor",options):helperMissing.call(depth0,"__","Large editor",options)))+"</button>\n        <button class=\"btn-info small block popup-btn\" data-control=\"latexWysiwyg\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"WYSIWYG editor",options):helperMissing.call(depth0,"__","WYSIWYG editor",options)))+"</button>\n    </div>\n</div>\n\n<div class=\"panel\" data-role=\"mathml\" style=\"display:none;\">\n    <label for=\"sidebar-mathml-field\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"MathML",options):helperMissing.call(depth0,"__","MathML",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Edit math expression using MathML",options):helperMissing.call(depth0,"__","Edit math expression using MathML",options)))+"</div>\n\n    <textarea id=\"sidebar-mathml-field\" name=\"mathml\">",(helper=helpers.mathml)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mathml,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</textarea>\n\n    <div class=\"panel\">\n        <button class=\"btn-info small block popup-btn\" data-control=\"mathml\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Large editor",options):helperMissing.call(depth0,"__","Large editor",options)))+"</button>\n    </div>\n\n    <div class=\"math-buffer\" style=\"visibility:hidden;\"></div>\n</div>\n\n",buffer}function program3(depth0,data){var buffer="",helper,options;return buffer+="\n<div class=\"panel\">\n    "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"MathJax is not installed.",options):helperMissing.call(depth0,"__","MathJax is not installed.",options)))+"\n</div>\n",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.mathjax,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/mathPopup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<textarea class=\"math-popup-input math-popup-input-",(helper=helpers.popupMode)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.popupMode,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" name=\"",(helper=helpers.popupMode)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.popupMode,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"-large\" placeholder=\"",(helper=helpers.placeholder)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholder,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></textarea>",buffer})}),define("util/position",[],function(){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}return{isInside:function(container,element){var containerCoords,elementCoords;if(container instanceof HTMLElement&&element instanceof HTMLElement&&(containerCoords=container.getBoundingClientRect(),elementCoords=element.getBoundingClientRect(),"object"===_typeof(containerCoords)&&"object"===_typeof(elementCoords)))return elementCoords.top>=containerCoords.top&&elementCoords.top<=containerCoords.bottom&&elementCoords.left>=containerCoords.left&&elementCoords.left<=containerCoords.right&&elementCoords.bottom<=containerCoords.bottom&&elementCoords.bottom>=containerCoords.top&&elementCoords.right<=containerCoords.right&&elementCoords.right>=containerCoords.left},isOver:function(container,element){var containerCoords,elementCoords;if(container instanceof HTMLElement&&element instanceof HTMLElement&&(containerCoords=container.getBoundingClientRect(),elementCoords=element.getBoundingClientRect(),"object"===_typeof(containerCoords)&&"object"===_typeof(elementCoords)))return elementCoords.top>=containerCoords.top&&elementCoords.top<=containerCoords.bottom&&elementCoords.left>=containerCoords.left&&elementCoords.left<=containerCoords.right}}}),define("css!ui/dynamicComponent/css/dynamicComponent",[],function(){}),define("ui/dynamicComponent",["jquery","lodash","interact","ui/component","ui/component/stackable","ui/transformer","ui/interactUtils","util/position","lib/uuid","handlebars","i18n","lib/dompurify/purify","css!ui/dynamicComponent/css/dynamicComponent.css"],function($$1,_,interact,componentFactory,makeStackable,transformer,interactUtils,position,uuid,Handlebars,__,DOMPurify){'use strict';var _Mathmax15=Math.max;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function layoutTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,componentFactory=componentFactory&&componentFactory.hasOwnProperty("default")?componentFactory["default"]:componentFactory,makeStackable=makeStackable&&makeStackable.hasOwnProperty("default")?makeStackable["default"]:makeStackable,interactUtils=interactUtils&&interactUtils.hasOwnProperty("default")?interactUtils["default"]:interactUtils,position=position&&position.hasOwnProperty("default")?position["default"]:position,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"dynamic-component-container\">\n    <div class=\"dynamic-component-title-bar\">\n        <i class=\"title-bar-icon\"></i>\n        <a title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close",options):helperMissing.call(depth0,"__","Close",options)))+"\" class=\"closer\" href=\"#\"></a>\n    </div>\n    <div class=\"dynamic-component-content\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.draggableContainer,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"\n        <div class=\"dynamic-component-layer\"></div>\n        "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.resizable,{hash:{},inverse:self.noop,fn:self.program(3,function(){return"\n    <div class=\"dynamic-component-resize-container\">\n        <div class=\"dynamic-component-resize-wrapper\">\n            <div class=\"dynamic-component-resize\"></div>\n        </div>\n    </div>\n    "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer}),_defaults={resizable:!0,draggable:!0,width:240,height:360,minWidth:150,maxWidth:600,minHeight:100,maxHeight:900,largeWidthThreshold:380,smallWidthThreshold:200,draggableContainer:"parent",preserveAspectRatio:!0,top:0,left:0,proportionalResize:!1},dynamicComponent={reset:function(){return this.is("rendered")&&!this.is("disabled")&&(this.resetPosition(),this.resetSize(),this.trigger("reset")),this},resetPosition:function(){var $element=this.getElement();return this.is("rendered")&&!this.is("disabled")&&(interactUtils.restoreOriginalPosition($element),this.setCoords(),$element.css({left:this.config.left,top:this.config.top}),this.trigger("move",this.position)),this},setCoords:function(){var $element=this.getElement();this.position.x=parseFloat($element.attr("data-x"))+this.config.left,this.position.y=parseFloat($element.attr("data-y"))+this.config.top},setContentSize:function(width,height){var $element,$titleBar;return this.is("rendered")&&!this.is("disabled")&&($element=this.getElement(),$titleBar=$$1(".dynamic-component-title-bar",$element),this.config.width=width+$element.outerWidth()-$element.width(),this.config.height=height+$element.outerHeight()-$element.height()+$titleBar.outerHeight(),this.resetSize()),this},resetSize:function(){var self=this,$element,$content,$titleBar;return this.is("rendered")&&!this.is("disabled")&&($element=this.getElement(),$content=$$1(".dynamic-component-content",$element),$titleBar=$$1(".dynamic-component-title-bar",$element),$element.css({width:this.config.width+"px",height:this.config.height+"px"}),_.defer(function(){self.position.width=self.config.width,self.position.height=self.config.height,self.position.contentWidth=$titleBar.width(),self.position.contentHeight=$element.height()-$titleBar.outerHeight(),$content.css({width:self.position.contentWidth+"px",height:self.position.contentHeight+"px"}),self.trigger("resize",self.position)})),this}},dynComponentFactory=function(specs,defaults){var component;return defaults=_.defaults(defaults||{},_defaults),specs=_.defaults(specs||{},dynamicComponent),component=componentFactory(specs,defaults).setTemplate(layoutTpl).on("init",function(){this.id=uuid()}).on("render",function(){function getRestriction(){var draggableContainer=getDraggableContainer();return draggableContainer?{restriction:draggableContainer,endOnly:!1}:{restriction:"parent",endOnly:!1}}function getDraggableContainer(){var draggableContainer=config.draggableContainer;return draggableContainer instanceof $$1&&draggableContainer.length&&(draggableContainer=draggableContainer[0]),draggableContainer}function _resizeItem(e){var width=e.rect.width,height=e.rect.height,$parent=config.draggableContainer||$element.parent(),elementOffset=$element.offset(),parentOffset=$parent.offset(),dimensions=calculateSize(width,height);width=calculateOverlap(dimensions.width,elementOffset.left,parentOffset.left,$parent.width()),height=calculateOverlap(dimensions.height,elementOffset.top,parentOffset.top,$parent.height()),null!==height&&null!==width&&(width<=config.smallWidthThreshold?$element.addClass("small").removeClass("large"):width>=config.largeWidthThreshold?$element.addClass("large").removeClass("small"):$element.removeClass("small").removeClass("large"),interactUtils.moveElement($element,width>config.minWidth&&width<config.maxWidth?e.deltaRect.left:0,height>config.minHeight&&height<config.maxHeight?e.deltaRect.top:0),self.position.width=width,self.position.height=height,self.setCoords(),$element.css({width:width+"px",height:height+"px"}),_.defer(function(){self.position.contentWidth=$titleBar.width(),self.position.contentHeight=$element.height()-$titleBar.outerHeight(),$content.css({width:self.position.contentWidth+"px",height:self.position.contentHeight+"px"}),self.trigger("resize",self.position)}))}function calculateOverlap(side,elOffset,parentOffset,parentValue){var result=side,fullSizeSide=elOffset+side,fullSizeParent=parentOffset+parentValue;return fullSizeSide>fullSizeParent&&(config.proportionalResize?result=null:result-=fullSizeSide-fullSizeParent),result}function calculateSize(width,height){var scaleRate;return config.proportionalResize&&(scaleRate=_Mathmax15(width/config.minWidth,height/config.minHeight),width=config.minWidth*scaleRate,height=config.minHeight*scaleRate),width<config.minWidth?width=config.minWidth:width>config.maxWidth&&(width=config.maxWidth),height<config.minHeight?height=config.minHeight:height>config.maxHeight&&(height=config.maxHeight),{width:width,height:height}}var self=this,$element=this.getElement(),config=this.config,$content=$$1(".dynamic-component-content",$element),$titleBar=$$1(".dynamic-component-title-bar",$element),$contentOverlay=$$1(".dynamic-component-layer",$element),$resizeControll=$$1(".dynamic-component-resize-wrapper",$element),pixelRatio=window.devicePixelRatio,interactElement;self.position={x:this.config.left,y:this.config.top,width:this.config.width,height:this.config.height},this.resetPosition(),this.resetSize(),$titleBar.on("click touchstart",".closer",function(e){e.preventDefault(),self.hide()}).on("click touchstart",".reset",function(e){e.preventDefault(),self.resetSize()}),this.trigger("rendercontent",$content),interactElement=interact($element[0]),config.draggable&&(interactElement.draggable({inertia:!1,autoScroll:!0,manualStart:!0,restrict:_.merge(getRestriction(),{elementRect:{left:0,right:1,top:0,bottom:1}}),onmove:function(event){interactUtils.moveElement($element,event.dx,event.dy),self.setCoords(),self.trigger("move",self.position)},onend:function(){self.setCoords()}}),interact($titleBar[0]).on("down",function(event){var interaction=event.interaction,handle=event.currentTarget;interaction.start({name:"drag",edges:{top:handle.dataset.top,left:handle.dataset.left,bottom:handle.dataset.bottom,right:handle.dataset.right}},interactElement,$element[0])}),$$1(window).on("resize.dynamic-component-"+self.id,function(){var container;window.devicePixelRatio!==pixelRatio&&(pixelRatio=window.devicePixelRatio,container=getDraggableContainer(),!1===position.isInside(container,$element[0])&&self.resetPosition())})),config.resizable&&interactElement.resizable({preserveAspectRatio:config.preserveAspectRatio,autoScroll:!0,restrict:getRestriction(),edges:{left:!1,right:".dynamic-component-resize-wrapper",bottom:".dynamic-component-resize-wrapper",top:!1},onmove:_resizeItem}),interactElement.on("dragstart resizeinertiastart",function(){$contentOverlay.addClass("dragging-active"),$content.addClass("moving"),$titleBar.addClass("moving")}).on("dragend",function(){$contentOverlay.removeClass("dragging-active"),$content.removeClass("moving"),$titleBar.removeClass("moving")}).on("resizestart",function(){$contentOverlay.addClass("dragging-active"),$resizeControll.addClass("resizing"),$content.addClass("sizing")}).on("resizeend",function(){$contentOverlay.removeClass("dragging-active"),$resizeControll.removeClass("resizing"),$content.removeClass("sizing")}),$element.on("mousedown",function(){/\-resize/.test($$1("html").css("cursor"))&&!$contentOverlay.hasClass("dragging-active")&&$contentOverlay.addClass("dragging-active")})}).on("destroy",function(){$$1(window).off("resize.dynamic-component-"+this.id)}),makeStackable(component,{stackingScope:defaults.stackingScope})};return dynComponentFactory}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/helper/windowPopup","taoQtiItem/qtiCreator/editor/MathEditor","taoQtiItem/qtiCreator/editor/mathInput/mathInput","tpl!taoQtiItem/qtiCreator/tpl/forms/static/math","tpl!taoQtiItem/qtiCreator/tpl/forms/static/mathPopup","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/dynamicComponent","lodash","i18n","mathJax","ui/tooltip"],function($,stateFactory,Active,windowPopupFactory,MathEditor,mathInputFactory,formTpl,popupFormTpl,formElement,inlineHelper,dynamicComponent,_,__,mathJax,tooltip){'use strict';function _attachMathmlWarning($mathField){var tooltipContent=__("Currently conversion from MathML to LaTeX is not available. Editing MathML here will have the LaTex code discarded."),widgetTooltip;$mathField.data("$tooltip")||(widgetTooltip=tooltip.error($mathField,tooltipContent,{trigger:"manual"}),$mathField.data("$tooltip",widgetTooltip))}var _throttle=300,MathActive;return MathActive=stateFactory.extend(Active,function(){this.initForm()},function(){_.invoke(this.popups,"destroy"),this.popups=null,this.fields&&this.fields.$mathml&&(this.fields.$mathml.data("$tooltip").dispose(),this.fields.$mathml.removeData("$tooltip")),this.fields=null,this.widget.$form.empty()}),MathActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,math=_widget.element,mathML=math.mathML||"",tex=math.getAnnotation("latex")||"",display=math.attr("display")||"inline",editMode="latex",areaBroker=this.widget.getAreaBroker(),$popupsContainer;!tex.trim()&&mathML.trim()&&(editMode="mathml"),$form.html(formTpl({mathjax:!!mathJax,editMode:editMode,latex:tex,mathml:mathML})),mathJax&&(this.fields={$mathml:$form.find("textarea[name=mathml]"),$latex:$form.find("input[name=latex]")},_attachMathmlWarning(this.fields.$mathml),$form.find("select[name=editMode]").val(editMode),$form.find("select[name=display]").val(display),this._toggleMode(editMode),$popupsContainer=areaBroker.getContainer(),this.popups={latexWysiwyg:this.createLatexWysiwygPopup(),latex:this.createLargeEditorPopup("latex"),mathml:this.createLargeEditorPopup("mathml")},_.forOwn(this.popups,function(popup){popup.init().render($popupsContainer).center().hide()}),formElement.initWidget($form),this.initFormChangeListener())},MathActive.prototype.initFormChangeListener=function(){var self=this,_widget=this.widget,$container=_widget.$container,$form=_widget.$form,math=_widget.element,mathML=math.mathML,tex=math.getAnnotation("latex"),display=math.attr("display")||"inline",mathEditor;mathEditor=new MathEditor({tex:tex,mathML:mathML,display:display,buffer:$form.find(".math-buffer"),target:_widget.$original}),formElement.setChangeCallbacks($form,math,{display:function(m,value){"block"===value?m.attr("display","block"):m.removeAttr("display"),_widget.rebuild({ready:function ready(widget){widget.changeState("active")}})},editMode:function editMode(m,value){self._toggleMode(value)},latex:_.throttle(function(m,value){mathEditor.setTex(value).renderFromTex(function(){m.setAnnotation("latex",value),self.fields&&self.fields.$mathml.val(mathEditor.mathML),m.setMathML(mathEditor.mathML),inlineHelper.togglePlaceholder(_widget),$container.change()})},_throttle),mathml:_.throttle(function(m,value){var hasChanged=value!==mathEditor.mathML;mathEditor.setMathML(value).renderFromMathML(function(){m.setMathML(mathEditor.mathML),hasChanged&&(self.fields&&self.fields.$latex.val(""),m.removeAnnotation("latex")),inlineHelper.togglePlaceholder(_widget),$container.change()})},_throttle)}),$form.find(".popup-btn").on("click",function(e){var $target=$(e.target),targetPopup=$target.data("control");self.popups[targetPopup]&&self.popups[targetPopup].show()})},MathActive.prototype.createLatexWysiwygPopup=function(){var self=this;return windowPopupFactory({},{windowTitle:"LaTeX (WYSIWYG)",width:640,height:280,minWidth:460,maxWidth:960,minHeight:220,maxHeight:640}).on("render",function(){var $popupContent=this.getBody();this.mathInput=mathInputFactory().init().render($popupContent).on("change",function(latex){self.fields.$latex.val(latex),self.fields.$latex.trigger("keyup")})}).on("show",function(){var currentLatex=self.fields.$latex.val(),mathInput=this.mathInput;_.defer(function(){mathInput.setLatex(currentLatex)}),self._disableForm()}).on("hide",function(){self._enableForm()})},MathActive.prototype.createLargeEditorPopup=function(popupMode){var self=this,popupOptions={windowTitle:"latex"===popupMode?"LaTeX":"MathML",width:640,height:320,minWidth:240,maxWidth:960,minHeight:160,maxHeight:640},smallField=self.fields["$"+popupMode];return windowPopupFactory({},popupOptions).on("render",function(){var $popupContent=this.getBody();this.$popupField=$(popupFormTpl({popupMode:popupMode,placeholder:smallField.attr("placeholder")})),$popupContent.append(this.$popupField),this.$popupField.on("mousedown",function(e){e.stopPropagation()}).on("keyup",function(e){smallField.val($(e.target).val()),smallField.trigger("keyup")})}).on("show",function(){this.$popupField.val(smallField.val()),"mathml"===popupMode&&self.fields.$mathml.data("$tooltip").hide(),self._disableForm()}).on("hide",function(){self._enableForm()})},MathActive.prototype._enableForm=function(){this.widget.$form.find("button,input,select,textarea").prop("disabled",!1)},MathActive.prototype._disableForm=function(){this.widget.$form.find("button,input,select,textarea").prop("disabled",!0)},MathActive.prototype._toggleMode=function(mode){var self=this,_widget=this.widget,$form=_widget.$form,panels={$mathml:$form.children(".panel[data-role=\"mathml\"]"),$latex:$form.children(".panel[data-role=\"latex\"]")};switch(mode){case"latex":{panels.$latex.show(),panels.$mathml.hide(),this.fields.$mathml.data("$tooltip").hide();break}case"mathml":{panels.$latex.hide(),panels.$mathml.show(),this.fields.$latex.val()&&(this.fields.$mathml.data("$tooltip").show(),this.fields.$mathml.on("keyup.mathWarning",function(){self.fields.$mathml.data("$tooltip").hide(),self.fields.$mathml.off(".mathWarning")}));break}}},MathActive}),define("taoQtiItem/qtiCreator/widgets/static/math/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/math/states/Sleep","taoQtiItem/qtiCreator/widgets/static/math/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/math/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/math/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(Widget,states,helper,toolbarTpl,inlineHelper){var MathWidget=Widget.clone();return MathWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},MathWidget.buildContainer=function(){return"block"===this.element.attr("display")?helper.buildBlockContainer(this):helper.buildInlineContainer(this),this},MathWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},MathWidget}),define("taoQtiItem/qtiCreator/renderers/Math",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Math","taoQtiItem/qtiCreator/widgets/static/math/Widget","taoQtiItem/qtiItem/core/Element"],function(_,Renderer,Widget,Element){'use strict';function isEditable(element){var parent=element.parent();return!Element.isA(parent,"hottext")}var CreatorMath=_.clone(Renderer);return CreatorMath.render=function(math,options){isEditable(math)&&(Renderer.render(math),Widget.build(math,Renderer.getContainer(math),this.getOption("bodyElementOptionForm"),options))},CreatorMath}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,SleepState){return stateFactory.create(SleepState,function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    \t\t<option value=\"",(helper=helpers.cssClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cssClass,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    \t",buffer}function program2(){return"selected=\"selected\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options):helperMissing.call(depth0,"__","The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore (\"_\") and contain only Letters, underscores, hyphens (\"-\"), period (\".\", a.k.a. full-stop), Digits, CombiningChars and Extenders.",options)))+"</div>\n    <input type=\"text\" \n           name=\"identifier\" \n           value=\"",(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" \n           placeholder=\"e.g. modal-feedback_1\" \n           data-validate=\"$notEmpty; $qtiIdentifier; $availableIdentifier(serial=",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+");\">\n</div>\n<div class=\"panel\">\n    <label for=\"feedbackStyle\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Feedback Style",options):helperMissing.call(depth0,"__","Feedback Style",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select predefined feedback style from the list.",options):helperMissing.call(depth0,"__","Select predefined feedback style from the list.",options)))+"</span>\n    <select name=\"feedbackStyle\" class=\"select2\" data-has-search=\"false\">\n    \t",stack1=helpers.each.call(depth0,depth0&&depth0.feedbackStyles,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiItem/helper/container","lodash","i18n","jquery","ui/modal"],function(stateFactory,Active,commonRenderer,formTpl,formElement,htmlEditor,contentHelper,containerHelper,_,__,$){'use strict';function _prepareFeedbackStyles(widget){var styles=[{cssClass:"",title:__("standard")},{cssClass:"positive",title:__("positive")},{cssClass:"negative",title:__("negative")}];return _(styles).filter(function(style){return void 0!==style.cssClass}).map(function(style){return containerHelper.hasEncodedData(widget.element,"modalFeedback",style.cssClass)&&(style.selected=!0),style}).value()}var buildTitleEditor=function($title,element,htmleditor){$title.on("edit.inplacer",function(){htmleditor.setReadOnly(!0)}).on("leave.inplacer",function(){htmleditor.setReadOnly(!1)}).inplacer({target:$("#qti-title")}).attr("title",__("Edit modal feedback title")).on("change",function(){element.attr("title",$(this).text())})},destroyTitleEditor=function($title){$title.inplacer("destroy"),$title.off(".inplacer")},buildBodyEditor=function(widget){var $editableContainer=widget.$container.find(".modal-body"),element=widget.element,container=element.getBody();$editableContainer.attr("data-html-editable-container",!0),$editableContainer.one("editorready",function(e,editor){buildTitleEditor(widget.$original.find(".qti-title"),element,editor)}),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{placeholder:__("Edit modal feedback"),change:contentHelper.getChangeCallback(container),data:{container:container,widget:widget}})},destroyBodyEditor=function(widget){htmlEditor.destroyEditor(widget.$container.find(".modal-body")),destroyTitleEditor(widget.$original.find(".qti-title"))},indices=function(){var selectors={sidebar:"#item-editor-item-widget-bar",cke:".cke",ckeBase:".cke_inner",ckeNose:".cke_nose",ckeToolbar:".cke_toolbar"},elements={},selector;return{raise:function raise(baseIndex){var $elem,index;for(selector in baseIndex=parseInt(baseIndex,10),selectors)$elem=$(selectors[selector]),index=parseInt($elem.css("z-index"),10),isNaN(index)&&(index=100),elements[selector]={element:$elem,index:index},$elem.css("z-index",elements[selector].index+baseIndex)},reset:function reset(){if(!1)for(selector in elements)elements[selector].element.css("z-index",elements[selector].index)}}}(),_ckeIsReady=function($editable){var dfd=new $.Deferred,poll=function(){var editor=$editable.data("editor");editor?dfd.resolve():setTimeout(poll,200)};return poll(),dfd.promise()},ModalFeedbackStateActive=stateFactory.extend(Active,function(){var _widget=this.widget,$container=this.widget.$container,$editable=$container.find("[data-html-editable]");$container.modal({startClosed:!0,width:commonRenderer.width,top:200}),$container.modal("open"),$container.css({height:"auto",position:"fixed"}),buildBodyEditor(_widget),$.when(_ckeIsReady($editable)).then(function(){indices.raise($container.css("z-index"))}),$container.on("closed.modal",function(){_widget.changeState("sleep")}),this.widget.offEvents("otherActive"),this.initForm(),this.widget.$form.show()},function(){var $container=this.widget.$container;destroyBodyEditor(this.widget),$container.off("opened.modal").off(".active"),$container.modal("close"),indices.reset(),$container.find(".tlb-button.active[data-role=cke-launcher]").click(),this.widget.$form.empty().hide()});return ModalFeedbackStateActive.prototype.initForm=function(){var _widget=this.widget,$container=_widget.$container,feedbackStyles=_prepareFeedbackStyles(_widget);_widget.$form.html(formTpl({serial:_widget.element.getSerial(),identifier:_widget.element.id(),feedbackStyles:feedbackStyles})),formElement.initWidget(_widget.$form),formElement.setChangeCallbacks(_widget.$form,_widget.element,{identifier:function identifier(fb,value){fb.id(value)},feedbackStyle:function feedbackStyle(fb,newValue){var oldValue=containerHelper.getEncodedData(_widget.element,"modalFeedback");containerHelper.setEncodedData(fb,"modalFeedback",newValue),oldValue&&$container.removeClass(oldValue),$container.addClass(newValue),containerHelper.setEncodedDataToDom($container.find(".cke_editable"),"modalFeedback",newValue,oldValue)}})},ModalFeedbackStateActive}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton"],function($,Widget,states,okButtonTpl){'use strict';var ModalFeedbackWidget=Widget.clone();return ModalFeedbackWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states),this.createOkButton()},ModalFeedbackWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box")},ModalFeedbackWidget.createToolbar=function(){return this},ModalFeedbackWidget.createOkButton=function(){var _this=this;this.$container.append($(okButtonTpl()).on("click.qti-widget",function(e){e.stopPropagation(),_this.changeState("sleep")}))},ModalFeedbackWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/modal",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div id=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" class=\"",stack1=helpers.unless.call(depth0,depth0&&depth0.inline,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"modal "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-modalFeedback ",(helper=helpers.feedbackStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.feedbackStyle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <h2 class=\"qti-title modal-title\">"+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.title),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</h2>\n    <div class=\"modal-body\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/renderers/ModalFeedback",["lodash","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/modal"],function(_,Renderer,Widget,modalTpl){'use strict';var ModalFeedback=_.clone(Renderer);return ModalFeedback.template=modalTpl,ModalFeedback.render=function(modalFeedback,options){options=options||{},Widget.build(modalFeedback,Renderer.getContainer(modalFeedback),this.getOption("modalFeedbackOptionForm"),options)},ModalFeedback}),define("taoQtiItem/qtiCreator/widgets/static/object/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){'use strict';var ObjectStateSleep=stateFactory.create(SleepState,function(){},function(){});return ObjectStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <div>\n        <label for=\"src\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+"</label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the object.",options):helperMissing.call(depth0,"__","The file path to the object.",options)))+"</div>\n        <input type=\"text\" name=\"src\" value=\"",(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty; $fileExists(baseUrl=",(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")\"/>\n        <button class=\"btn-info small block\" data-role=\"upload-trigger\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select object",options):helperMissing.call(depth0,"__","Select object",options)))+"</button>\n    </div>\n</div>\n\n<div class=\"panel\">\n    <div>\n        <label for=\"width\" class=\"spinner\">Width</label>\n        <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" class=\"large\" data-increment=\"10\" data-min=\"10\"\n               data-max=\"1920\"/>\n    </div>\n    <div>\n        <label for=\"height\" class=\"spinner\">Height</label>\n        <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" class=\"large\" data-increment=\"10\" data-min=\"10\"\n               data-max=\"1080\"/>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/object/states/Active",["lodash","jquery","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/object","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/previewer","ui/resourcemgr","ui/tooltip"],function(_,$,__,stateFactory,Active,formTpl,formElement,inlineHelper){'use strict';var _config={renderingThrottle:1e3,fileFilters:"image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg,application/ogg,audio/aac,application/pdf"},ObjectStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()}),refreshRendering=_.throttle(function(widget){var obj=widget.element,$container=widget.$original,previewOptions={url:obj.renderer.resolveUrl(obj.attr("data")),mime:obj.attr("type")};obj.attr("height")&&(previewOptions.height=obj.attr("height")),obj.attr("width")&&(previewOptions.width=obj.attr("width")),previewOptions.url&&previewOptions.mime&&$container.previewer(previewOptions)},_config.renderingThrottle);ObjectStateActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,qtiObject=_widget.element,baseUrl=_widget.options.baseUrl;$form.html(formTpl({baseUrl:baseUrl||"",src:qtiObject.attr("data"),alt:qtiObject.attr("alt"),height:qtiObject.attr("height"),width:qtiObject.attr("width")})),_initUpload(_widget),formElement.initWidget($form),formElement.setChangeCallbacks($form,qtiObject,{src:function src(object,value){qtiObject.attr("data",value),inlineHelper.togglePlaceholder(_widget),refreshRendering(_widget)},width:function width(object,value){var val=parseInt(value,10);_.isNaN(val)?qtiObject.removeAttr("width"):qtiObject.attr("width",val),refreshRendering(_widget)},height:function height(object,value){var val=parseInt(value,10);_.isNaN(val)?qtiObject.removeAttr("height"):qtiObject.attr("height",val),refreshRendering(_widget)},alt:function alt(qtiObject,value){qtiObject.attr("alt",value)},align:function align(qtiObject,value){inlineHelper.positionFloat(_widget,value)}})};var _initUpload=function(widget){var $form=widget.$form,options=widget.options,qtiObject=widget.element,$uploadTrigger=$form.find("[data-role=\"upload-trigger\"]"),$src=$form.find("input[name=src]"),_openResourceMgr=function(){$uploadTrigger.resourcemgr({title:__("Please select a media file from the resource manager. You can add files from your computer with the button \"Add file(s)\"."),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:_config.fileFilters},pathParam:"path",select:function select(e,files){var file,type;files&&files.length&&(file=files[0].file,type=files[0].mime,qtiObject.attr("type",type),$src.val(file).trigger("change"))},open:function open(){$src.data("$tooltip")&&$src.blur().data("$tooltip").hide()},close:function close(){$src.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$src.val()||_openResourceMgr()};return ObjectStateActive}),define("taoQtiItem/qtiCreator/widgets/static/object/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/object/states/Sleep","taoQtiItem/qtiCreator/widgets/static/object/states/Active"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/object/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/object/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline","i18n"],function(Widget,states,helper,toolbarTpl,inlineHelper){'use strict';var ObjectWidget=Widget.clone();return ObjectWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},ObjectWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},ObjectWidget.buildContainer=function(){return helper.buildBlockContainer(this),this},ObjectWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},ObjectWidget}),define("taoQtiItem/qtiCreator/renderers/Object",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Object","taoQtiItem/qtiCreator/widgets/static/object/Widget"],function(_,Renderer,Widget){'use strict';var CreatorObject=_.clone(Renderer);return CreatorObject.render=function(object,options){Renderer.render(object),options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),Widget.build(object,Renderer.getContainer(object),this.getOption("bodyElementOptionForm"),options)},CreatorObject}),define("taoQtiItem/qtiCreator/renderers/PortableInfoControl",["lodash","taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl","taoQtiItem/portableElementRegistry/icRegistry","taoQtiItem/qtiCreator/helper/commonRenderer"],function(_,Renderer,icRegistry,commonRenderer){'use strict';var CreatorPortableInfoControl=_.clone(Renderer);return CreatorPortableInfoControl.render=function(infoControl,options){var self=this;return new Promise(function(resolve,reject){Renderer.render.call(commonRenderer.get(),infoControl).then(function(){var picCreator=icRegistry.getCreator(infoControl.typeIdentifier).module;picCreator&&(options=options||{},options.baseUrl=self.getOption("baseUrl"),options.uri=self.getOption("uri"),options.lang=self.getOption("lang"),options.mediaManager=self.getOption("mediaManager"),options.assetManager=self.getAssetManager(),picCreator.getWidget().build(infoControl,Renderer.getContainer(infoControl),self.getOption("bodyElementOptionForm"),options)),resolve()}).catch(function(error){reject("Error initializing the creator : "+error)})})},CreatorPortableInfoControl}),define("taoQtiItem/qtiCreator/widgets/static/printedVariable/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){'use strict';var PrintedVariableStateSleep=stateFactory.extend(SleepState);return PrintedVariableStateSleep}),define("util/typeCaster",["lodash"],function(_){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_;return{strToBool:function(value,defaultValue){return _.isBoolean(value)?value:_.isString(value)?"true"===value.toLowerCase():defaultValue||!1}}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/printedVariable",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <option value=\"",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n        ",buffer}function program2(){return" selected"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Printed Variable",options):helperMissing.call(depth0,"__","Printed Variable",options)))+"</h3>\n\n    <label for=\"identifier\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select the outcome variable you want to display.",options):helperMissing.call(depth0,"__","Select the outcome variable you want to display.",options)))+".\n    </div>\n\n    <select name=\"identifier\" class=\"select2\" data-has-search=\"false\">\n        <option value=\"\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select",options):helperMissing.call(depth0,"__","Select",options)))+"</option>\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.outcomes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n\n</div>\n\n<div class=\"panel\">\n    <label for=\"format\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Format",options):helperMissing.call(depth0,"__","Format",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The format conversion specifier to use when converting numerical values to strings. See QTI Number Formatting Rules for details.",options):helperMissing.call(depth0,"__","The format conversion specifier to use when converting numerical values to strings. See QTI Number Formatting Rules for details.",options)))+"\n    </div>\n\n    <input id=\"format\" type=\"text\" name=\"format\" value=\"",(helper=helpers.format)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.format,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"/>\n</div>\n\n<div class=\"panel\">\n    <label for=\"powerForm\" class=\"has-icon\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Power form",options):helperMissing.call(depth0,"__","Power form",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the variable value is a float and powerForm is set to 'false', the variable will be rendered using the 'e' or 'E' format. If the powerform is set to 'true', the form 'e+n' is changed to 'x 10n'.",options):helperMissing.call(depth0,"__","If the variable value is a float and powerForm is set to 'false', the variable will be rendered using the 'e' or 'E' format. If the powerform is set to 'true', the form 'e+n' is changed to 'x 10n'.",options)))+"\n    </div>\n\n    <input id=\"powerForm\" type=\"checkbox\" name=\"powerForm\" value=\"true\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.powerForm,{hash:{},inverse:self.noop,fn:self.program(4,function(){return" checked=\"checked\""},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n</div>\n\n<div class=\"panel\">\n    <label for=\"base\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Base",options):helperMissing.call(depth0,"__","Base",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The number base to use when converting integer variables to strings with the i conversion type code.",options):helperMissing.call(depth0,"__","The number base to use when converting integer variables to strings with the i conversion type code.",options)))+"\n    </div>\n\n    <input name=\"base\" type=\"text\" data-increment=\"1\" data-min=\"0\" value=\"",(helper=helpers.base)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.base,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>\n\n<div class=\"panel\">\n    <label for=\"index\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Index",options):helperMissing.call(depth0,"__","Index",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The index to use when displaying a variable of ordered cardinality. If a variable of ordered cardinality is to be displayed and index is not set, all the values in the container are displayed.",options):helperMissing.call(depth0,"__","The index to use when displaying a variable of ordered cardinality. If a variable of ordered cardinality is to be displayed and index is not set, all the values in the container are displayed.",options)))+"\n    </div>\n\n    <input name=\"index\" type=\"text\" data-increment=\"1\" data-min=\"-1\" value=\"",(helper=helpers.index)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.index,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>\n\n<div class=\"panel\">\n    <label for=\"delimiter\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Delimiter",options):helperMissing.call(depth0,"__","Delimiter",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The delimiter to use between values when displaying variables of ordered, multiple or record cardinality. \";\" is default when delimiter is not declared. Implementations can override this default with personal preferences or locale settings.",options):helperMissing.call(depth0,"__","The delimiter to use between values when displaying variables of ordered, multiple or record cardinality. \";\" is default when delimiter is not declared. Implementations can override this default with personal preferences or locale settings.",options)))+"\n    </div>\n\n    <input name=\"delimiter\" type=\"text\" value=\"",(helper=helpers.delimiter)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.delimiter,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>\n\n<div class=\"panel\">\n    <label for=\"field\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Field",options):helperMissing.call(depth0,"__","Field",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The field specifier to use when displaying variables of record cardinality.",options):helperMissing.call(depth0,"__","The field specifier to use when displaying variables of record cardinality.",options)))+"\n    </div>\n\n    <input name=\"field\" type=\"text\" value=\"",(helper=helpers.field)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.field,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>\n\n<div class=\"panel\">\n    <label for=\"mappingIndicator\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Mapping Indicator",options):helperMissing.call(depth0,"__","Mapping Indicator",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The mapping indicator to use between field name and field value when displaying variables of record cardinality. \"=\" is default when mappingIndicator is not declared. Implementations can override this default with personal preferences or locale settings.",options):helperMissing.call(depth0,"__","The mapping indicator to use between field name and field value when displaying variables of record cardinality. \"=\" is default when mappingIndicator is not declared. Implementations can override this default with personal preferences or locale settings.",options)))+"\n    </div>\n\n    <input name=\"mappingIndicator\" type=\"text\" value=\"",(helper=helpers.mappingIndicator)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mappingIndicator,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/printedVariable/states/Active",["jquery","lodash","i18n","util/typeCaster","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/printedVariable","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,_,__,typeCaster,stateFactory,Active,formTpl,formElement,inlineHelper){'use strict';var PrintedVariableStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()});return PrintedVariableStateActive.prototype.initForm=function(){var _widget=this.widget,printedVarEl=_widget.element,$printedVarDom=_widget.$original,$form=_widget.$form,rootElement=printedVarEl.getRootElement(),outcomes=_.isFunction(rootElement.data("getOutcomes"))&&rootElement.data("getOutcomes")();outcomes=(outcomes||[]).map(function(entry){var selected=printedVarEl.attr("identifier")===entry;return{value:entry,name:entry,selected:selected}}),$form.html(formTpl({outcomes:outcomes,format:printedVarEl.attr("format"),powerForm:typeCaster.strToBool(printedVarEl.attr("powerForm")),base:printedVarEl.attr("base"),index:printedVarEl.attr("index"),delimiter:printedVarEl.attr("delimiter"),field:printedVarEl.attr("field"),mappingIndicator:printedVarEl.attr("mappingIndicator")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,printedVarEl,{identifier:function identifier(pv,value,name){printedVarEl.attr(name,value),$printedVarDom.html(value),inlineHelper.togglePlaceholder(_widget)},format:formElement.getAttributeChangeCallback(),powerForm:formElement.getAttributeChangeCallback(),base:formElement.getAttributeChangeCallback(),index:formElement.getAttributeChangeCallback(),delimiter:formElement.getAttributeChangeCallback(),field:formElement.getAttributeChangeCallback(),mappingIndicator:formElement.getAttributeChangeCallback()})},PrintedVariableStateActive}),define("taoQtiItem/qtiCreator/widgets/static/printedVariable/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/printedVariable/states/Sleep","taoQtiItem/qtiCreator/widgets/static/printedVariable/states/Active"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/printedVariable/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/printedVariable/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,Widget,states,helper,toolbarTpl,inlineHelper){'use strict';var PrintedVariable=Widget.clone();return PrintedVariable.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},PrintedVariable.buildContainer=function(){return helper.buildInlineContainer(this),this},PrintedVariable.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},PrintedVariable}),define("tpl!taoQtiItem/qtiCreator/tpl/printedVariable",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var stack1;return escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<span data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"printedVariable\">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</span>",buffer})}),define("taoQtiItem/qtiCreator/renderers/PrintedVariable",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/PrintedVariable","taoQtiItem/qtiCreator/widgets/static/printedVariable/Widget","tpl!taoQtiItem/qtiCreator/tpl/printedVariable"],function($,_,Renderer,Widget,tpl){'use strict';var CreatorPrintedVariable=_.clone(Renderer);return CreatorPrintedVariable.template=tpl,CreatorPrintedVariable.render=function(printedVariable,options){options=options||{},Widget.build(printedVariable,Renderer.getContainer(printedVariable),this.getOption("bodyElementOptionForm"),null,options)},CreatorPrintedVariable}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var RubriBlockStateSleep=stateFactory.extend(SleepState,function(){},function(){});return RubriBlockStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,stack1,helper,options;return buffer+="<!--currently only visible to the candidate-->\n<div class=\"panel\">\n    <label for=\"view\">Visible by</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",options):helperMissing.call(depth0,"__","A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",options)))+"\n    </div>\n    <select name=\"view\" class=\"select2\" data-has-search=\"false\">\n        <option value=\"author\">author</option>\n        <option value=\"candidate\">candidate</option>\n        <option value=\"proctor\">proctor</option>\n        <option value=\"scorer\">scorer</option>\n        <option value=\"testConstructor\">test constructor</option>\n        <option value=\"tutor\">tutor</option>\n    </select>\n</div>\n\n<div class=\"panel\">\n    <label for=\"use\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Description",options):helperMissing.call(depth0,"__","Description",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",options):helperMissing.call(depth0,"__","The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",options)))+"</div>\n    <input type=\"text\" name=\"use\" value=\"",(helper=helpers.use)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.use,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(stateFactory,Active,htmlEditor,content,formTpl,formElement){var RubricBlockStateActive=stateFactory.extend(Active,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return RubricBlockStateActive.prototype.buildEditor=function(){var widget=this.widget,$editableContainer=widget.$container,container=widget.element.getBody();$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:content.getChangeCallback(container),data:{widget:widget,container:container}})},RubricBlockStateActive.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},RubricBlockStateActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({view:interaction.attr("view"),use:interaction.attr("use")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{view:formElement.getAttributeChangeCallback(),use:formElement.getAttributeChangeCallback()})},RubricBlockStateActive}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function($,Widget,states,toolbarTpl){var RubricBlockWidget=Widget.clone();return RubricBlockWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box widget-rubricBlock")},RubricBlockWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},RubricBlockWidget.createToolbar=function(){var $tlb=$(toolbarTpl({serial:this.serial,state:"active"})),_this=this;return this.$container.find(".qti-rubricBlock-body").append($tlb),$tlb.find("[data-role=\"delete\"]").on("click.widget-box",function(e){e.stopPropagation(),_this.changeState("deleting")}),this},RubricBlockWidget}),define("taoQtiItem/qtiCreator/renderers/RubricBlock",["lodash","taoQtiItem/qtiCommonRenderer/renderers/RubricBlock","taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget"],function(_,Renderer,Widget){'use strict';var CreatorRubricBlock=_.clone(Renderer);return CreatorRubricBlock.render=function(rubricBlock,options){Widget.build(rubricBlock,Renderer.getContainer(rubricBlock),this.getOption("bodyElementOptionForm"),options)},CreatorRubricBlock}),define("taoQtiItem/qtiCreator/widgets/static/table/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){'use strict';var TableStateSleep=stateFactory.extend(SleepState,function(){},function(){});return TableStateSleep}),define("ui/tableModel",["lodash","jquery"],function(_,$){'use strict';return _=_&&_.hasOwnProperty("default")?_["default"]:_,$=$&&$.hasOwnProperty("default")?$["default"]:$,function($table){function update(){var rowsInOrder=[].concat($table.find("thead tr").toArray()).concat($table.find("tbody tr").toArray()).concat($table.find("tfoot tr").toArray());cellsByRow=[],rowsInOrder.forEach(function(row){var $row=$(row),$rowCells=$row.find("th,td");cellsByRow.push($rowCells)})}function getRowCount(){return cellsByRow.length}function getRowCells(index){return 0>index&&(index+=cellsByRow.length),cellsByRow[index]||$()}function getColCount(){return cellsByRow[0].length}function getColCells(index){var columnCells=[];return _.isFinite(index)&&cellsByRow.forEach(function($row){var cell=$row.get(index);cell&&columnCells.push(cell)}),columnCells.length?$(columnCells):$()}var cellsByRow;if($table&&$table.is("table"))update();else throw new TypeError("$table should contain a reference to a table element");return{getRowCount:getRowCount,getRowCells:getRowCells,getColCount:getColCount,getColCells:getColCells,update:update}}}),define("ui/component/alignable",["lodash","ui/component/placeable"],function(_,makePlaceable){'use strict';function makeAlignable(component,config){return _.assign(component,alignableComponent),makePlaceable.isPlaceable(component)||makePlaceable(component),component.off(".makeAlignable").on("init.makeAlignable",function(){_.defaults(this.config,config||{},defaultConfig)})}_=_&&_.hasOwnProperty("default")?_["default"]:_,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable;var defaultConfig={},alignDefaults={hPos:"center",vPos:"center"},alignableComponent={alignWith:function($element,options){var alignedCoords=this._getAlignedCoords($element,options);return this.moveTo(alignedCoords.x,alignedCoords.y)},hAlignWith:function($element,hPos,hOrigin,hOffset){var alignedCoords=this._getAlignedCoords($element,{hPos:hPos,hOrigin:hOrigin,hOffset:hOffset});return this.moveToX(alignedCoords.x)},vAlignWith:function($element,vPos,vOrigin,vOffset){var alignedCoords=this._getAlignedCoords($element,{vPos:vPos,vOrigin:vOrigin,vOffset:vOffset});return this.moveToY(alignedCoords.y)},_getAlignedCoords:function($element,options){var $container=this.getContainer(),componentOuterSize,containerOffset,elementOffset,elementWidth,elementHeight,x,y,hPos,vPos,hOrigin,vOrigin;switch(options=options||{},componentOuterSize=this.getOuterSize(),containerOffset=$container.offset(),elementOffset=$element.offset(),elementWidth=$element.outerWidth(),elementHeight=$element.outerHeight(),hPos=options.hPos||alignDefaults.hPos,vPos=options.vPos||alignDefaults.vPos,hOrigin=options.hOrigin||this._getDefaultHOrigin(options.hPos),vOrigin=options.vOrigin||this._getDefaultVOrigin(options.vPos),x=elementOffset.left-containerOffset.left,y=elementOffset.top-containerOffset.top,hPos){case"center":{x+=elementWidth/2;break}case"right":{x+=elementWidth;break}}switch(hOrigin){case"center":{x-=componentOuterSize.width/2;break}case"right":{x-=componentOuterSize.width;break}}switch(x+=options.hOffset||0,vPos){case"center":{y+=elementHeight/2;break}case"bottom":{y+=elementHeight;break}}switch(vOrigin){case"center":{y-=componentOuterSize.height/2;break}case"bottom":{y-=componentOuterSize.height;break}}return y+=options.vOffset||0,{x:x,y:y}},_getDefaultHOrigin:function(hPos){var hOrigin;switch(hPos){default:case"center":{hOrigin="center";break}case"left":{hOrigin="right";break}case"right":{hOrigin="left";break}}return hOrigin},_getDefaultVOrigin:function(vPos){var vOrigin;switch(vPos){default:case"center":{vOrigin="center";break}case"top":{vOrigin="bottom";break}case"bottom":{vOrigin="top";break}}return vOrigin}};return makeAlignable}),define("tpl!taoQtiItem/qtiCreator/widgets/static/table/components/tableActions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"table-tlb table-col-tlb\">\n    <div class=\"rgt tlb-button\" title=\"Insert Row\" data-role=\"insertRow\">\n        <span class=\"icon-row\"></span>\n    </div>\n    <div class=\"rgt tlb-button\" title=\"Insert Column\" data-role=\"insertCol\">\n        <span class=\"icon-column\"></span>\n    </div>\n    <div class=\"rgt tlb-button\" title=\"",(helper=helpers.deleteTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deleteTitle,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-role=\"colRowDelete\">\n        <span class=\"icon-bin\"></span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/table/components/tableActions",["lodash","jquery","ui/component","ui/component/alignable","tpl!taoQtiItem/qtiCreator/widgets/static/table/components/tableActions"],function(_,$,componentFactory,makeAlignable,tpl){'use strict';function triggerEvent(eventName){var self=this;return function(event){event.stopPropagation(),self.trigger(eventName)}}function mousedown(){return function(event){event.stopPropagation()}}var defaultConfig={delete:!0,insertRow:!1,insertCol:!1,deleteTitle:"Delete"},tableActionsApi={hideDelete:function(){var $component=this.getElement(),$delete=$component.find("[data-role=\"colRowDelete\"]");$delete.hide()},showDelete:function(){var $component=this.getElement(),$delete=$component.find("[data-role=\"colRowDelete\"]");$delete.show()}};return function(config){var tableActionsComponent;return config=_.defaults(config||{},defaultConfig),tableActionsComponent=componentFactory(tableActionsApi,config).setTemplate(tpl).on("render",function(){var self=this,$component=this.getElement(),$delete=$component.find("[data-role=\"colRowDelete\"]"),$insertRow=$component.find("[data-role=\"insertRow\"]"),$insertCol=$component.find("[data-role=\"insertCol\"]");this.config.delete?$delete.on("mousedown",mousedown()).on("click",triggerEvent.call(self,"delete")).on("mouseenter",triggerEvent.call(self,"deleteMouseEnter")).on("mouseleave",triggerEvent.call(self,"deleteMouseLeave")):$delete.hide(),this.config.insertRow?$insertRow.on("mousedown",mousedown()).on("click",triggerEvent.call(self,"insertRow")).on("mouseenter",triggerEvent.call(self,"insertRowMouseEnter")).on("mouseleave",triggerEvent.call(self,"insertRowMouseLeave")):$insertRow.hide(),this.config.insertCol?$insertCol.on("mousedown",mousedown()).on("click",triggerEvent.call(self,"insertCol")).on("mouseenter",triggerEvent.call(self,"insertColMouseEnter")).on("mouseleave",triggerEvent.call(self,"insertColMouseLeave")):$insertCol.hide()}),makeAlignable(tableActionsComponent),tableActionsComponent.init()}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <option value=\"",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n        ",buffer}function program2(){return" selected=\"selected\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"panel\">\n    <label for=\"hAlign\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Alignment",options):helperMissing.call(depth0,"__","Alignment",options)))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Choose the horizontal alignment for the table.",options):helperMissing.call(depth0,"__","Choose the horizontal alignment for the table.",options)))+"\n    </div>\n    <select name=\"hAlign\" class=\"select2\" data-has-search=\"false\">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.hAlignOptions,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/table/states/Active",["lodash","jquery","i18n","ckeditor","ui/tableModel","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/widgets/static/table/components/tableActions","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/static/table"],function(_,$,__,ckEditor,tableModelFactory,stateFactory,Active,tableActionsFactory,htmlEditor,contentHelper,formElement,formTpl){'use strict';function getChangeCallback(container){return _.throttle(function(data){var $tableTagContent=$(data).children(),$pseudoContainer=$("<div>").html($tableTagContent),newBody=contentHelper.getContent($pseudoContainer);container.body(newBody)},400)}function addClassOnCurrentRow(editor,className){var currentCellPos=getCurrentCellPos(editor),$currentCol;currentCellPos&&($currentCol=tableModel.getRowCells(currentCellPos.y),$currentCol.addClass(className))}function addClassOnCurrentCol(editor,className){var currentCellPos=getCurrentCellPos(editor),$currentCol;currentCellPos&&($currentCol=tableModel.getColCells(currentCellPos.x),$currentCol.addClass(className))}function clearCellClasses($editable,className){$editable.find("th, td").removeClass(className)}function updateTable(editor,$editableContainer){tableModel.update(),1===tableModel.getRowCount()?rowActions.hideDelete():rowActions.showDelete(),1===tableModel.getColCount()?colActions.hideDelete():colActions.showDelete(),displayTableActions(editor,$editableContainer)}function hideTableActions(){colActions&&colActions.hide(),rowActions&&rowActions.hide()}function displayTableActions(editor,$tableContainer){var selectedCells=getSelection(editor),$currentCell;selectedCells&&1!==selectedCells.length?hideTableActions():($currentCell=$(selectedCells[0].$),colActions.show().hAlignWith($currentCell,"center").vAlignWith($tableContainer,"top"),rowActions.show().hAlignWith($tableContainer,"left").vAlignWith($currentCell,"center"))}function getCurrentCellPos(editor){var selectedCells=getSelection(editor),currentCell;if(selectedCells&&1===selectedCells.length)return currentCell=selectedCells[0].$,{x:currentCell.cellIndex,y:currentCell.parentNode.rowIndex}}function getSelection(editor){var selection=editor.getSelection(),tabletools=window.CKEDITOR.plugins.tabletools;if(selection&&tabletools)return tabletools.getSelectedCells(selection)}var css={deleteColRow:"hoverDelete",insertRowAfter:"insertRowAfter",insertColAfter:"insertColAfter",hAlignCenter:"table-center",hAlignRight:"table-right"},TableStateActive=stateFactory.extend(Active,function(){this.initForm(),this.buildEditor()},function(){this.widget.$form.empty(),this.destroyEditor()}),tableModel,colActions,rowActions;return TableStateActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,table=_widget.element,$container=_widget.$container,hAlignOptions;hAlignOptions=[{name:__("Left"),value:"left"},{name:__("Center"),value:"center",selected:table.hasClass(css.hAlignCenter)},{name:__("Right"),value:"right",selected:table.hasClass(css.hAlignRight)}],$form.html(formTpl({hAlignOptions:hAlignOptions})),formElement.initWidget($form),formElement.setChangeCallbacks($form,table,{hAlign:function hAlign(t,value){switch(hideTableActions(),t.removeClass(css.hAlignRight),t.removeClass(css.hAlignCenter),$container.removeClass(css.hAlignRight+" "+css.hAlignCenter),value){case"center":{t.addClass(css.hAlignCenter),$container.addClass(css.hAlignCenter);break}case"right":{t.addClass(css.hAlignRight),$container.addClass(css.hAlignRight);break}}}})},TableStateActive.prototype.buildEditor=function(){var _widget=this.widget,container=_widget.element.getBody(),$itemPanel=_widget.getAreaBroker().getItemPanelArea(),$editableContainer=_widget.$container,$editable=$editableContainer.find(".qti-table-container"),$tablePropTrigger=$editableContainer.find("[data-role=\"cke-table-properties\"]");$editableContainer.attr("data-html-editable-container",!0),$editable.attr("data-html-editable",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{placeholder:"",change:getChangeCallback(container),removePlugins:"magicline",data:{container:container,widget:_widget},blur:function blur(){_widget.changeState("sleep")}}),$editable.on("editorready.tableActive",function(event,editor){tableModel=tableModelFactory($editable.find("table")),$tablePropTrigger.on("click.tableActive",function(e){e.stopPropagation(),hideTableActions(),editor.execCommand("taoqtitableProperties")}),colActions=tableActionsFactory({insertCol:!0,deleteTitle:"Delete column"}).on("delete",function(){editor.execCommand("columnDelete"),updateTable(editor,$editableContainer),hideTableActions()}).on("deleteMouseEnter",function(){addClassOnCurrentCol(editor,css.deleteColRow)}).on("deleteMouseLeave",function(){clearCellClasses($editable,css.deleteColRow)}).on("insertCol",function(){editor.execCommand("columnInsertAfter"),clearCellClasses($editable,css.insertColAfter),this.trigger("insertColMouseEnter"),updateTable(editor,$editableContainer)}).on("insertColMouseEnter",function(){addClassOnCurrentCol(editor,css.insertColAfter)}).on("insertColMouseLeave",function(){clearCellClasses($editable,css.insertColAfter)}).render($itemPanel).hide(),rowActions=tableActionsFactory({insertRow:!0,deleteTitle:"Delete row"}).on("delete",function(){editor.execCommand("rowDelete"),updateTable(editor,$editableContainer),hideTableActions()}).on("deleteMouseEnter",function(){addClassOnCurrentRow(editor,css.deleteColRow)}).on("deleteMouseLeave",function(){clearCellClasses($editable,css.deleteColRow)}).on("insertRow",function(){editor.execCommand("rowInsertAfter"),clearCellClasses($editable,css.insertRowAfter),this.trigger("insertRowMouseEnter"),updateTable(editor,$editableContainer)}).on("insertRowMouseEnter",function(){addClassOnCurrentRow(editor,css.insertRowAfter)}).on("insertRowMouseLeave",function(){clearCellClasses($editable,css.insertRowAfter)}).render($itemPanel).hide(),$editableContainer.on("keyup.tableActive mouseup.tableActive",function(){displayTableActions(editor,$editableContainer)})}).on("editordestroyed.tableActive",function(){$tablePropTrigger.length&&$tablePropTrigger.off(".tableActive")})},TableStateActive.prototype.destroyEditor=function(){var _widget=this.widget,$editableContainer=_widget.$container,$editable=$editableContainer.find("[data-html-editable=\"true\"]");clearCellClasses($editable,css.insertColAfter),clearCellClasses($editable,css.insertRowAfter),clearCellClasses($editable,css.deleteColRow),htmlEditor.destroyEditor($editableContainer),$editableContainer.off(".tableActive"),$editable.off(".tableActive"),$editable.attr("data-html-editable",!1),$editableContainer.attr("data-html-editable-container",!1),tableModel=null,colActions&&(colActions.destroy(),colActions=null),rowActions&&(rowActions.destroy(),rowActions=null)},TableStateActive}),define("taoQtiItem/qtiCreator/widgets/static/table/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/table/states/Sleep","taoQtiItem/qtiCreator/widgets/static/table/states/Active"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"mini-tlb\" data-edit=\"",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-for=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"rgt tlb-button\" title=\"Delete\" data-role=\"delete\">\n        <span class=\"icon-bin\"></span>\n    </div>\n    <div class=\"rgt tlb-button\" data-role=\"cke-table-properties\" title=\"Table properties\">\n        <span class=\"icon-table\"></span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/table/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/table/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/table"],function($,Widget,states,helper,toolbarTpl){'use strict';var TableWidget=Widget.clone();return TableWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},TableWidget.buildContainer=function(){var table=this.element;return helper.buildBlockContainer(this),table.attr("class")&&this.$container.addClass(table.attr("class")),this},TableWidget.createToolbar=function(){var self=this,$tlb=$(toolbarTpl({serial:this.serial,state:"active"}));return this.$container.append($tlb),$tlb.find("[data-role=\"delete\"]").on("click.widget-box",function(e){e.stopPropagation(),self.changeState("deleting")}),this},TableWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+=" summary=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.summary),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div\n    class=\"qti-table-container\"\n    data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n    data-qti-class=\"table\"\n    >\n    <table class=\"qti-table\" data-html-editable=\"true\"",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.summary),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </table>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/renderers/Table",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Table","taoQtiItem/qtiCreator/widgets/static/table/Widget","tpl!taoQtiItem/qtiCreator/tpl/table"],function(_,Renderer,Widget,tpl){'use strict';var CreatorTable=_.clone(Renderer);return CreatorTable.template=tpl,CreatorTable.render=function(table,options){Widget.build(table,Renderer.getContainer(table),this.getOption("bodyElementOptionForm"),options||{})},CreatorTable}),define("taoQtiItem/qtiCreator/widgets/static/tooltip/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){'use strict';return stateFactory.extend(SleepState)}),define("ui/component/containable",["lodash","ui/component/placeable"],function(_,makePlaceable){'use strict';function makeContainable(component,config){return _.assign(component,containableComponent),makePlaceable.isPlaceable(component)||makePlaceable(component),component.off(".makeContainable").on("init.makeContainable",function(){_.defaults(this.config,config||{},defaultConfig)})}_=_&&_.hasOwnProperty("default")?_["default"]:_,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable;var defaultConfig={},containableComponent={containIn:function($container,options){var self=this;return self.off("move.makeContainable").on("move.makeContainable",function(){self.off("move.makeContainable"),self._containComponent($container,options),self.containIn($container,options)}),self},_containComponent:function($container,optionsParam){var options=optionsParam||{},position=this.getPosition(),size=this.getOuterSize(),containerSize={width:$container.innerWidth(),height:$container.innerHeight()},newX=position.x,newY=position.y,paddingTop=options.paddingTop||options.padding||0,paddingRight=options.paddingRight||options.padding||0,paddingBottom=options.paddingBottom||options.padding||0,paddingLeft=options.paddingLeft||options.padding||0;position.x<paddingLeft?newX=0+paddingLeft:position.x+size.width>containerSize.width-paddingRight&&(newX=containerSize.width-size.width-paddingRight),position.y<paddingTop?newY=0+paddingTop:position.y+size.height>containerSize.height-paddingBottom&&(newY=containerSize.height-size.height-paddingBottom),(newX!==position.x||newY!==position.y)&&(this.moveTo(newX,newY),this.trigger("contained",newX,newY))}};return makeContainable}),define("tpl!taoQtiItem/qtiCreator/widgets/helpers/widgetPopup/popupControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<button title=\"",(helper=helpers.description)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.description,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"btn-info small widget-popup-control\" data-control=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</button>",buffer})}),define("taoQtiItem/qtiCreator/widgets/helpers/widgetPopup/widgetPopup",["lodash","i18n","jquery","ui/component","ui/component/alignable","ui/component/containable","ui/component/windowed","tpl!taoQtiItem/qtiCreator/widgets/helpers/widgetPopup/popupControl"],function(_,__,$,componentFactory,makeAlignable,makeContainable,makeWindowed,popupControlTpl){'use strict';var eventNs=".wigetpopup",defaultConfig={alignable:!1,containable:!1,autoContain:!0,popupControls:{done:!1}},popupControlsPresets={done:{id:"done",event:"done",text:__("done"),description:__("Done")}},widgetPopupApi={renderPopupControls:function(){var self=this,controlsEvents={},$controlsArea=this.$popupControls,control;_.each(this.config.popupControls,function(isActive,controlId){control=popupControlsPresets[controlId],isActive&&control&&($controlsArea.append($(popupControlTpl(control))),controlsEvents[controlId]=control.event)}),$controlsArea.off("click"+eventNs).on("click"+eventNs,function(e){var controlId=$(e.target).data("control");e.stopPropagation(),_.isString(controlsEvents[controlId])&&self.trigger(controlsEvents[controlId])})},autoContain:function(){var $container;if(!this.config.areaBroker)throw new Error("an areaBroker must be given to enable autoContain");$container=this.config.areaBroker.getItemPanelArea(),this.containIn($container,{padding:10,paddingTop:40})}};return function(specs,config){var widgetPopup;return config=_.defaults(config||{},defaultConfig),specs=_.defaults(specs||{},widgetPopupApi),widgetPopup=componentFactory(specs,config),makeWindowed(widgetPopup),config.alignable&&makeAlignable(widgetPopup),config.containable&&makeContainable(widgetPopup),widgetPopup.on("render",function(){var $component=this.getElement();$component.addClass("widget-popup"),this.$popupControls=$("<div>",{class:"widget-popup-controls-area"}),$component.append(this.$popupControls),this.renderPopupControls(),config.containable&&config.autoContain&&this.autoContain()}).on("destroy",function(){var $controlsArea=this.$popupControls;$controlsArea.off(eventNs)}),widgetPopup}}),define("tpl!taoQtiItem/qtiCreator/widgets/static/tooltip/components/editorField",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper;return(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div data-html-editable-container=\"true\">\n    <div title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"",(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.className,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-html-editable=\"true\">",stack1=helpers["if"].call(depth0,depth0&&depth0.content,{hash:{},inverse:self.program(3,function(){return"&nbsp;"},data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/tooltip/components/editorField",["lodash","jquery","ckeditor","ui/component","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/widgets/static/tooltip/components/editorField"],function(_,$,ckEditor,componentFactory,htmlEditor,contentHelper,tpl){'use strict';var defaultConfig={preventEnter:!1};return function(config){var tooltip,EditorFieldComponent,widget;return config=_.defaults(config||{},defaultConfig),EditorFieldComponent=componentFactory({buildEditor:function(){var self=this,$component=self.getElement(),changeCallback=_.noop;_.isFunction(self.config.change)&&(changeCallback=_.throttle(function(data){self.config.change.call(self,data)},500)),htmlEditor.hasEditor($component)||htmlEditor.buildEditor($component,{placeholder:config.placeholder||"",change:changeCallback,removePlugins:"magicline,taotooltip",data:{container:tooltip,widget:widget},toolbar:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]}],autofocus:!1,blur:function blur(){widget.changeState("sleep")}}).then(function(){!0===config.focus&&htmlEditor.focus($component)}),config.preventEnter&&$component.on("keypress.editorfield",function(e){13===e.which&&(e.preventDefault(),$(this).blur())})},destroyEditor:function(){var $component=this.getElement();htmlEditor.destroyEditor($component),$component.off(".editorfield")}},config).setTemplate(tpl).on("init",function(){if(!this.config.tooltip)throw new Error("tooltip instance must be given in the config");tooltip=this.config.tooltip,widget=tooltip.data("widget")}).on("render",function(){this.buildEditor()}).on("destroy",function(){this.destroyEditor()}),EditorFieldComponent.init()}}),define("tpl!taoQtiItem/qtiCreator/widgets/static/tooltip/components/tooltipEditor",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"qti-tooltip-editor\">\n    <div class=\"tooltip-editor-content-container\">\n        <div class=\"tooltip-editor-tip\"></div>\n    </div>\n    <div class=\"tooltip-editor-target-container\"></div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/static/tooltip/components/tooltipEditor",["lodash","i18n","jquery","taoQtiItem/qtiCreator/widgets/helpers/widgetPopup/widgetPopup","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/static/tooltip/components/editorField","tpl!taoQtiItem/qtiCreator/widgets/static/tooltip/components/tooltipEditor"],function(_,__,$,widgetPopupFactory,contentHelper,editorFieldFactory,tpl){'use strict';var widgetPopupConfig={popupControls:{done:!0},windowTitle:__("Tooltip editor"),alignable:!0,containable:!0,hasCloser:!1,hasBin:!0};return function(config){var tooltip,tooltipEditorComponent;return config=_.defaults(config||{},widgetPopupConfig),tooltipEditorComponent=widgetPopupFactory({},config).on("init",function(){if(!this.config.tooltip)throw new Error("tooltip instance must be given in the config");tooltip=this.config.tooltip,this.config.target=tooltip.body(),this.config.content=tooltip.content()}).on("render",function(){var self=this,$body=self.getBody(),fieldToFocus=tooltip.body()?"content":"target",$targetEditorContainer,$contentEditorContainer,$closeBtn;$body.append($(tpl())),$targetEditorContainer=$body.find(".tooltip-editor-target-container"),$contentEditorContainer=$body.find(".tooltip-editor-content-container"),$closeBtn=$body.find(".widget-ok"),$closeBtn.on("click",function(e){e.stopPropagation(),self.trigger("close")}),self.targetEditor=editorFieldFactory({tooltip:tooltip,title:__("Tooltip Target"),className:"tooltip-editor-target",placeholder:__("Enter tooltip target"),content:tooltip.body(),focus:"target"==fieldToFocus,preventEnter:!0,change:function change(newBody){tooltip.body(newBody)}}).render($targetEditorContainer),self.contentEditor=editorFieldFactory({tooltip:tooltip,title:__("Tooltip Content"),className:"tooltip-editor-content",placeholder:__("Enter tooltip content"),content:tooltip.content(),focus:"content"==fieldToFocus,change:function change(newContent){tooltip.content(newContent)}}).render($contentEditorContainer)}).on("destroy",function(){var self=this,$component=self.getElement(),$closeBtn=$component.find(".widget-ok");$closeBtn.off("click"),this.contentEditor.destroy(),this.targetEditor.destroy()}),tooltipEditorComponent.init()}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<div class=\"panel\">\n    <em>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"no configuration property needed",options):helperMissing.call(depth0,"__","no configuration property needed",options)))+"</em>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/static/tooltip/states/Active",["lodash","jquery","i18n","ckeditor","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/static/helpers/inline","taoQtiItem/qtiCreator/widgets/static/tooltip/components/tooltipEditor","tpl!taoQtiItem/qtiCreator/tpl/forms/static/tooltip"],function(_,$,__,ckEditor,stateFactory,Active,htmlEditor,contentHelper,inlineHelper,tooltipEditorFactory,formTpl){'use strict';var TooltipStateActive=stateFactory.extend(Active,function(){this.initForm(),this.buildEditor()},function(){this.destroyEditor()}),tooltipEditor;return TooltipStateActive.prototype.initForm=function(){this.widget.$form.html(formTpl())},TooltipStateActive.prototype.buildEditor=function(){var self=this,_widget=self.widget,creatorContext=_widget.getCreatorContext(),$itemPanel=_widget.getAreaBroker().getItemPanelArea(),$tooltipContainer=_widget.$container,tooltip=_widget.element;tooltipEditor=tooltipEditorFactory({tooltip:tooltip,areaBroker:_widget.getAreaBroker()}).on("delete",self.destroyTooltip.bind(self)).on("done",function(){_widget.changeState("sleep")}).render($itemPanel).show(),self.alignEditorOn($tooltipContainer),creatorContext.on("resize.tooltipEditor",function(){self.alignEditorOn($tooltipContainer)})},TooltipStateActive.prototype.alignEditorOn=function($tooltipContainer){tooltipEditor&&tooltipEditor.alignWith($tooltipContainer,{hPos:"center",vPos:"bottom",vOrigin:"bottom",hOffset:-5,vOffset:53})},TooltipStateActive.prototype.destroyTooltip=function(){var self=this,_widget=self.widget,tooltip=_widget.element,$tooltipContainer=_widget.$container,parent=tooltip.parent(),newParentBody=parent.body().replace(tooltip.placeholder(),tooltip.body());_widget.destroy(),tooltip.remove(),parent.body(newParentBody),$tooltipContainer.replaceWith(tooltip.body())},TooltipStateActive.prototype.destroyEditor=function(){var _widget=this.widget,creatorContext=_widget.getCreatorContext(),tooltip=_widget.element,$tooltip=_widget.$original;$tooltip.html(tooltip.body()||"&nbsp;"),tooltipEditor&&(tooltipEditor.hide(),tooltipEditor.destroy(),tooltipEditor=null),inlineHelper.togglePlaceholder(_widget),creatorContext.off(".tooltipeditor")},TooltipStateActive}),define("taoQtiItem/qtiCreator/widgets/static/tooltip/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/tooltip/states/Sleep","taoQtiItem/qtiCreator/widgets/static/tooltip/states/Active"],function(factory,states){'use strict';return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/tooltip/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/tooltip/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,Widget,states,helper,inlineHelper){'use strict';var TooltipWidget=Widget.clone();return TooltipWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},TooltipWidget.buildContainer=function(){return helper.buildInlineContainer(this),this},TooltipWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<span data-serial=\"",(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-qti-class=\"_tooltip\" data-role=\"tooltip-target\">",stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.program(3,function(){return"&nbsp;"},data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>",buffer})}),define("taoQtiItem/qtiCreator/renderers/Tooltip",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Tooltip","taoQtiItem/qtiCreator/widgets/static/tooltip/Widget","tpl!taoQtiItem/qtiCreator/tpl/tooltip"],function(_,Renderer,Widget,tpl){'use strict';var CreatorTooltip=_.clone(Renderer);return CreatorTooltip.template=tpl,CreatorTooltip.render=function(tooltip,options){Widget.build(tooltip,Renderer.getContainer(tooltip),this.getOption("bodyElementOptionForm"),options||{})},CreatorTooltip}),define("tpl!taoQtiItem/qtiCreator/widgets/helpers/pciMediaManager/propertiesForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(){return"checked=\"checked\""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,stack1,helper,options;return buffer+="<div class=\"panel\">\n\n    <div>\n        <label>\n            <input type=\"text\" name=\"uri\" placeholder=\"Please select media file\" value=\"",(helper=helpers.uri)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.uri,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-validate=\"$notEmpty;\"/>\n            <div><button class='selectMediaFile btn-info small block'>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select media file",options):helperMissing.call(depth0,"__","Select media file",options)))+"</button></div>\n        </label>\n    </div>\n\n    <div>\n        <label for=\"width\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+"</label>\n        <input name=\"width\" value=\"",(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" class=\"large\" data-increment=\"1\" data-min=\"50\" data-max=\"1920\" />\n    </div>\n\n    <div class=\"height-container\">\n        <label for=\"height\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+"</label>\n        <input name=\"height\" value=\"",(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"text\" class=\"large\" data-increment=\"1\" data-min=\"30\" data-max=\"1080\" />\n    </div>\n\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"autostart\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.autostart,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Autostart",options):helperMissing.call(depth0,"__","Autostart",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",options):helperMissing.call(depth0,"__","The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",options)))+"\n    </span>\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"loop\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.loop,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Loop",options):helperMissing.call(depth0,"__","Loop",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n       "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",options):helperMissing.call(depth0,"__","The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",options)))+"\n    </span>\n</div>\n\n<div class=\"panel\">\n    <label>\n        <input name=\"pause\" type=\"checkbox\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.pause,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        <span class=\"icon-checkbox\"></span>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+"\n    </label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <span class=\"tooltip-content\">\n       "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enable the test taker to pause and restart the playing.",options):helperMissing.call(depth0,"__","Enable the test taker to pause and restart the playing.",options)))+"\n    </span>\n</div>\n\n<div class=\"panel\">\n    <div>\n        <label for=\"maxPlays\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max plays count",options):helperMissing.call(depth0,"__","Max plays count",options)))+"</label>\n        <input name=\"maxPlays\" value=\"",(helper=helpers.maxPlays)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxPlays,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"large\" data-increment=\"1\" data-min=\"0\" data-max=\"1000\" type=\"text\" />\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",options):helperMissing.call(depth0,"__","The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",options)))+"\n        </span>\n    </div>\n</div>\n\n<div class=\"panel\">\n    <div>\n        <label for=\"replayTimeout\" class=\"spinner\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Replay timeout",options):helperMissing.call(depth0,"__","Replay timeout",options)))+"</label>\n        <input name=\"replayTimeout\" value=\"",(helper=helpers.replayTimeout)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.replayTimeout,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"large\" data-increment=\"1\" data-min=\"0\" data-max=\"1000\" type=\"text\" />\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In seconds. Delay during which the replay of the media is allowed. Once reached, the media is disabled and cannot be played anymore.",options):helperMissing.call(depth0,"__","In seconds. Delay during which the replay of the media is allowed. Once reached, the media is disabled and cannot be played anymore.",options)))+"\n        </span>\n    </div>\n</div>",buffer})}),define("taoQtiItem/qtiCreator/widgets/helpers/pciMediaManager/pciMediaManager",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCreator/widgets/helpers/pciMediaManager/propertiesForm"],function(_,__,$,formTpl){'use strict';return function(widget){function switchToAudio(){isAudio=!0,$heightContainer.hide(),mediaProps.height=30}function switchToVideo(){isAudio&&(isAudio=!1,mediaProps.height=270,$heightContainer.show())}function switchMode(){/audio/.test(mediaProps.type)?switchToAudio():switchToVideo()}function setUpUploader(){var $src=$form.find("input[name=uri]"),$uploadTrigger=$form.find(".selectMediaFile");$uploadTrigger.on("click",function(){$uploadTrigger.resourcemgr({title:__("Please select a media file (video or audio) from the resource manager. You can add files from your computer with the button \"Add file(s)\"."),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:"video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg,application/ogg,audio/aac,audio/wav,audio/flac"},pathParam:"path",select:function(e,files){files&&files.length&&(mediaProps.type=files[0].mime,$form.find("input[name=uri]").val(files[0].file).trigger("change"))},open:function(){$src.data("$tooltip")&&$src.blur().data("$tooltip").hide()},close:function(){$src.blur()}})})}var $form=widget.$form,options=widget.options,interaction=widget.element,isAudio=!1,mediaProps=interaction.properties.media||{},configChangeCallback,$heightContainer;return mediaProps=_.defaults(mediaProps,{autostart:!1,loop:!1,maxPlays:2,replayTimeout:5,pause:!1,uri:null,type:null,height:270,width:480}),interaction.properties.media=mediaProps,configChangeCallback=_.debounce(function(boundInteraction,value,name){mediaProps[name]=value,boundInteraction.triggerPci("configChange",[boundInteraction.getProperties()])},500),{init:function(){$heightContainer=$(".height-container",$form),switchMode(),setUpUploader()},getForm:function(){return formTpl({autostart:!!mediaProps.autostart,loop:!!mediaProps.loop,maxPlays:parseInt(mediaProps.maxPlays,10),replayTimeout:parseInt(mediaProps.replayTimeout,10),pause:!!mediaProps.pause,uri:mediaProps.uri,type:mediaProps.type,width:mediaProps.width,height:mediaProps.height})},getChangeCallbacks:function(){return{autostart:configChangeCallback,loop:configChangeCallback,maxPlays:configChangeCallback,replayTimeout:configChangeCallback,pause:configChangeCallback,width:configChangeCallback,height:function(boundInteraction,value,name){isAudio||configChangeCallback(boundInteraction,value,name)},uri:function(boundInteraction,value){mediaProps.uri!==value&&(mediaProps.uri=value,value=$.trim(value).toLowerCase(),/^http(s)?:\/\/(www\.)?youtu/.test(value)?(mediaProps.type="video/youtube",switchToVideo()):/audio/.test(mediaProps.type)?switchToAudio():switchToVideo(),mediaProps&&(!mediaProps.width||0>=parseInt(mediaProps.width,10))&&(mediaProps.width=widget.$original.innerWidth()),boundInteraction.triggerPci("configChange",[boundInteraction.getProperties()]))}}}}}}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","jquery","lib/farbtastic/farbtastic"],function(stateFactory,Question,$){var CustomInteractionStateQuestion=stateFactory.extend(Question);return CustomInteractionStateQuestion.prototype.initColorPickers=function(){var $colorTriggers=this.widget.$form.find(".color-trigger:not([data-color-picker=initialized])");$colorTriggers.each(function(){var $colorTrigger=$(this),$input=$colorTrigger.siblings("input"),color=$input.val();$colorTrigger.css("background-color",color)}),$colorTriggers.on("click.color-picker",function(){var $colorTrigger=$(this),$context=$colorTrigger.closest(".item-editor-color-picker"),$container=$context.find(".color-picker-container").show(),$colorPicker=$container.find(".color-picker"),$colorPickerInput=$container.find(".color-picker-input"),$input=$colorTrigger.siblings("input[type=\"hidden\"]"),color=$input.val(),$itemEditorWidgetBar=$("#item-editor-item-widget-bar");$container.css({right:$itemEditorWidgetBar.width()+2,top:$colorTrigger.offset().top-$container.width()/2-$itemEditorWidgetBar.offset().top}),$colorPicker.farbtastic(".color-picker-input",$context),$colorPickerInput.val(color).trigger("keyup"),$container.find(".closer").off("click").on("click",function(){$container.hide(),$colorPicker.off(".farbtastic")}),$colorPicker.off(".farbtastic").on("colorchange.farbtastic",function(e,color){$colorTrigger.css("background-color",color),$input.val(color).trigger("change")})}),$colorTriggers.attr("data-color-picker","initialized")},CustomInteractionStateQuestion.prototype.destroyColorPickers=function(){var $colorTriggers=this.widget.$form.find(".color-trigger");$colorTriggers.off(".color-picker"),$colorTriggers.removeAttr("data-color-picker")},CustomInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay"],function(stateFactory,SleepState,overlayTpl){return stateFactory.extend(SleepState,function(){this.widget.$container.append(overlayTpl())},function(){this.widget.$container.children(".overlay").remove()})}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Sleep"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/portableElementRegistry/ciRegistry","lodash"],function(Widget,ciRegistry,_){var CustomInteractionWidget=Widget.clone();return CustomInteractionWidget.initCreator=function(){Widget.initCreator.call(this)},CustomInteractionWidget.createToolbar=function(options){var creator=ciRegistry.getAuthoringData(this.element.typeIdentifier);return options=_.defaults(options||{},{title:creator.label}),Widget.createToolbar.call(this,options)},CustomInteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var GapMatchInteractionStateAnswer=stateFactory.extend(Answer,function(){answerStateHelper.forward(this.widget)},function(){});return GapMatchInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer){return stateFactory.extend(Answer,function(){this.widget.changeState("map")},function(){})}),define("taoQtiItem/qtiCreator/widgets/static/portableInfoControl/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states"],function(factory,states){'use strict';return factory.createBundle(states,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/static/portableInfoControl/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget"],function(Widget){'use strict';var InfoControlWidget=Widget.clone();return InfoControlWidget.initCreator=function(){Widget.initCreator.call(this)},InfoControlWidget}),define("taoQtiItem/qtiItem/core/choices/TextEntry",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){var QtiTextEntry=QtiTextVariableChoice.extend({qtiClass:"textEntry"});return QtiTextEntry}),define("taoQtiItem/qtiItem/core/feedbacks/Feedback",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){var Feedback=IdentifiedElement.extend({is:function is(qtiClass){return"feedback"===qtiClass||this._super(qtiClass)}});return Feedback}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(Feedback){var FeedbackBlock=Feedback.extend({});return FeedbackBlock}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(Feedback){var FeedbackInline=Feedback.extend({});return FeedbackInline}),define("taoQtiItem/qtiItem/helper/EventMgr",["lodash"],function(_){return function(){var events={};this.get=function(event){return event&&events[event]?_.clone(events[event]):[]},this.on=function(event,callback){var tokens=event.split(".");if(tokens[0]){var name=tokens.shift();events[name]=events[name]||[],events[name].push({ns:tokens,callback:callback})}},this.off=function(event){event&&events[event]&&(events[event]=[])},this.trigger=function(event,data){events[event]&&_.each(events[event],function(e){e.callback.apply({type:event,ns:[]},data)})}}}),define("taoQtiItem/qtiItem/helper/pci",["lodash"],function(_){return{getRawValues:function getRawValues(pciVar){if(_.isPlainObject(pciVar)){if(pciVar.base!==void 0)return _.values(pciVar.base);if(pciVar.list)return _.values(pciVar.list)}throw"unsupported type "}}}),define("taoQtiItem/qtiItem/helper/modalFeedback",["jquery","lodash","taoQtiItem/qtiItem/helper/pci","taoQtiItem/qtiItem/helper/container"],function($,_,pci,containerHelper){'use strict';var getFeedbackMessageSignature=function(feedback){return(""+feedback.body()+feedback.attr("title")).toLowerCase().trim().replace(/x-tao-[a-zA-Z0-9\-._\s]*/g,"")},extractDisplayInfo=function(interaction){var $interactionContainer=interaction.getContainer(),responseIdentifier=interaction.attr("responseIdentifier"),messageGroupId,$displayContainer;return interaction.is("inlineInteraction")?($displayContainer=$interactionContainer.closest("[class*=\" col-\"], [class^=\"col-\"]"),messageGroupId=$displayContainer.attr("data-messageGroupId"),!messageGroupId&&(messageGroupId=_.uniqueId("inline_message_group_"),$displayContainer.attr("data-messageGroupId",messageGroupId))):(messageGroupId=responseIdentifier,$displayContainer=$interactionContainer),{responseIdentifier:responseIdentifier,interactionContainer:$interactionContainer,displayContainer:$displayContainer,messageGroupId:messageGroupId,order:-1}},getInteractionsDisplayInfo=function(item){var interactionsDisplayInfo=[],$itemContainer=item.getContainer(),interactionOrder=0;return _.forEach(item.getComposingElements(),function(element){element.is("interaction")&&interactionsDisplayInfo.push(extractDisplayInfo(element))}),$itemContainer.find(".qti-interaction").each(function(){var self=this;_.forEach(interactionsDisplayInfo,function(_interactionInfo){if(_interactionInfo.interactionContainer[0]===self)return _interactionInfo.order=interactionOrder,!1}),interactionOrder++}),interactionsDisplayInfo=_.sortBy(interactionsDisplayInfo,"order"),interactionsDisplayInfo};return{getFeedbacks:function(item,itemSession){var messages={},$itemContainer=item.getContainer(),$itemBody=$(".qti-itemBody",$itemContainer),interactionsDisplayInfo=getInteractionsDisplayInfo(item),renderingQueue=[];return _.forEach(item.modalFeedbacks,function(feedback){var outcomeIdentifier=feedback.attr("outcomeIdentifier"),order=-1,feedbackIds,message,$container,comparedOutcome,_currentMessageGroupId,interactionInfo;if(itemSession[outcomeIdentifier]){if(feedbackIds=pci.getRawValues(itemSession[outcomeIdentifier]),!_.contains(feedbackIds,feedback.id()))return!0;if(message=getFeedbackMessageSignature(feedback),comparedOutcome=containerHelper.getEncodedData(feedback,"relatedOutcome"),interactionInfo=_.find(interactionsDisplayInfo,{responseIdentifier:comparedOutcome}),comparedOutcome&&interactionInfo?($container=interactionInfo.displayContainer,_currentMessageGroupId=interactionInfo.messageGroupId,order=interactionInfo.order):($container=$itemBody,_currentMessageGroupId="__item__"),messages[_currentMessageGroupId]||(messages[_currentMessageGroupId]=[]),_.contains(messages[_currentMessageGroupId],message))return!0;messages[_currentMessageGroupId].push(message),renderingQueue.push({feedback:feedback,$container:$container,order:order})}}),renderingQueue=_.sortBy(renderingQueue,"order"),renderingQueue}}}),define("taoQtiItem/qtiItem/helper/Parser",["jquery"],function($){return function Parser(){var _$xml=null;this.loadXML=function(xml){_$xml=$.parseXML(xml)},this.getDOM=function(){return _$xml}}}),define("tpl!taoQtiItem/qtiRunner/tpl/inlineModalFeedbackPreviewButton",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<li class=\"small btn-info action action-button rgt\" id=\"preview-feedback-ok-button\">\n    <a class=\"li-inner\" href=\"#\">\n        <span class=\"label\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"OK",options):helperMissing.call(depth0,"__","OK",options)))+"</span>\n    </a>\n</li>",buffer})}),define("tpl!taoQtiItem/qtiRunner/tpl/inlineModalFeedbackDeliveryButton",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<li data-control=\"feedback-ok\" class=\"small btn-info action forward\" title=\"Feedback ok and ready to proceed.\">\n    <a class=\"li-inner\" href=\"#\">\n        <span class=\"icon-result-ok\"></span>\n        <span class=\"text\">OK</span>\n    </a>\n</li>"})}),define("taoQtiItem/qtiRunner/modalFeedback/inlineRenderer",["lodash","jquery","context","taoQtiItem/qtiItem/helper/pci","taoQtiItem/qtiItem/helper/container","tpl!taoQtiItem/qtiRunner/tpl/inlineModalFeedbackPreviewButton","tpl!taoQtiItem/qtiRunner/tpl/inlineModalFeedbackDeliveryButton","iframeNotifier","core/promise"],function(_,$,context,pci,containerHelper,previewOkBtn,deliveryOkBtn,iframeNotifier,Promise){'use strict';function getQtiContainer(){for(var me=window,$container=null,max=10;me&&me.__knownParent__&&max--;)if(me=me.parent,me&&me.$&&($container=me.$("#qti-content"),$container.length))return $container;return null}function autoscroll(element){var $element=$(element),$container=getQtiContainer(),currentScrollTop,minScrollTop,maxScrollTop,scrollTop;$element.length&&$container&&(currentScrollTop=$container.scrollTop(),maxScrollTop=$element.offset().top,minScrollTop=maxScrollTop-$container.height()+$element.outerHeight(),scrollTop=Math.max(Math.min(maxScrollTop,currentScrollTop),minScrollTop),scrollTop!==currentScrollTop&&$container.animate({scrollTop:scrollTop}))}function extractDisplayInfo(interaction){var $interactionContainer=interaction.getContainer(),responseIdentifier=interaction.attr("responseIdentifier"),messageGroupId,$displayContainer;return interaction.is("inlineInteraction")?($displayContainer=$interactionContainer.closest("[class*=\" col-\"], [class^=\"col-\"]"),messageGroupId=$displayContainer.attr("data-messageGroupId"),!messageGroupId&&(messageGroupId=_.uniqueId("inline_message_group_"),$displayContainer.attr("data-messageGroupId",messageGroupId))):(messageGroupId=responseIdentifier,$displayContainer=$interactionContainer),{responseIdentifier:responseIdentifier,interactionContainer:$interactionContainer,displayContainer:$displayContainer,messageGroupId:messageGroupId,order:-1}}function getInteractionsDisplayInfo(item){var interactionsDisplayInfo=[],$itemContainer=item.getContainer(),interactionOrder=0;return _.each(item.getComposingElements(),function(element){var responseIdentifier;element.is("interaction")&&(responseIdentifier=element.attr("responseIdentifier"),interactionsDisplayInfo.push(extractDisplayInfo(element)))}),$itemContainer.find(".qti-interaction").each(function(){var interactionContainer=this;_.each(interactionsDisplayInfo,function(_interactionInfo){if(_interactionInfo.interactionContainer[0]===interactionContainer)return _interactionInfo.order=interactionOrder,!1}),interactionOrder++}),interactionsDisplayInfo=_.sortBy(interactionsDisplayInfo,"order"),interactionsDisplayInfo}function clearModalFeedbacks($itemContainer){$itemContainer.find(".qti-modalFeedback").remove()}function renderModalFeedback(feedback,loader,renderer,$container,$itemContainer,renderedCallback){renderer.load(function(){var $modalFeedback=$(feedback.render({inline:!0})),done=function(){renderedCallback({identifier:feedback.id(),serial:feedback.getSerial(),dom:$modalFeedback})};$container.append($modalFeedback),Promise.race([Promise.all(_.map(feedback.getComposingElements(),function(elt){return elt.postRender({},"",renderer).pop()})),new Promise(function(resolve,reject){_.delay(reject,timeout,new Error("Post rendering ran out of time."))})]).then(done).catch(function(err){throw done(),new Error("Error in post rendering : "+err)})},loader.getLoadedClasses())}function replaceControl(renderedFeebacks,$itemContainer,callback){var $scope,$controls,$toggleContainer;window.parent&&window.parent.parent&&window.parent.parent.$?$itemContainer.parents(".tao-preview-scope").length?($scope=window.parent.parent.$("#preview-console"),$controls=$scope.find(".preview-console-header .action-bar li:visible"),$toggleContainer=$scope.find(".console-button-action-bar"),initControlToggle(renderedFeebacks,$itemContainer,$controls,$toggleContainer,previewOkBtn,callback)):($scope=window.parent.parent.$("body.qti-test-scope .bottom-action-bar"),$controls=$scope.find("li:visible"),$toggleContainer=$scope.find(".navi-box-list"),initControlToggle(renderedFeebacks,$itemContainer,$controls,$toggleContainer,deliveryOkBtn,callback)):($scope=$itemContainer.find("#modalFeedbacks"),initControlToggle(renderedFeebacks,$itemContainer,$(),$scope,previewOkBtn,callback))}function initControlToggle(renderedFeebacks,$itemContainer,$controls,$toggleContainer,toggleButtonTemplate,callback){var $ok=$(toggleButtonTemplate()).click(function(){_.each(renderedFeebacks,function(fb){fb.dom.hide()}),uncover([$itemContainer]),$ok.remove(),$controls.show(),callback()});$controls.hide(),$toggleContainer.append($ok),cover([$itemContainer])}function cover(interactionContainers){var $cover=$("<div class=\"interaction-cover modal-bg\">");_.each(interactionContainers,function($interaction){$interaction.append($cover)})}function uncover(interactionContainers){_.each(interactionContainers,function($interaction){$interaction.find(".interaction-cover").remove()})}function getFeedbackMessageSignature(feedback){return(""+feedback.body()+feedback.attr("title")).toLowerCase().trim().replace(/x-tao-[a-zA-Z0-9\-._\s]*/g,"")}var timeout=1e3*(0<context.timeout?context.timeout+1:30);return{showFeedbacks:function(item,loader,renderer,itemSession,onCloseCallback,onShowCallback){var interactionsDisplayInfo=getInteractionsDisplayInfo(item),messages={},renderedFeebacks=[],renderingQueue=[],$itemContainer=item.getContainer(),$itemBody=$itemContainer.children(".qti-itemBody"),firstFeedback;return _.each(item.modalFeedbacks,function(feedback){var outcomeIdentifier=feedback.attr("outcomeIdentifier"),order=-1,feedbackIds,message,$container,comparedOutcome,_currentMessageGroupId,interactionInfo;if(itemSession[outcomeIdentifier]){if(feedbackIds=pci.getRawValues(itemSession[outcomeIdentifier]),-1===_.indexOf(feedbackIds,feedback.id()))return!0;if(message=getFeedbackMessageSignature(feedback),comparedOutcome=containerHelper.getEncodedData(feedback,"relatedOutcome"),interactionInfo=_.find(interactionsDisplayInfo,{responseIdentifier:comparedOutcome}),comparedOutcome&&interactionInfo?($container=interactionInfo.displayContainer,_currentMessageGroupId=interactionInfo.messageGroupId,order=interactionInfo.order):($container=$itemBody,_currentMessageGroupId="__item__"),messages[_currentMessageGroupId]||(messages[_currentMessageGroupId]=[]),0<=_.indexOf(messages[_currentMessageGroupId],message))return!0;messages[_currentMessageGroupId].push(message),renderingQueue.push({feedback:feedback,$container:$container,order:order})}}),renderingQueue.length&&(renderingQueue=_.sortBy(renderingQueue,"order"),clearModalFeedbacks($itemContainer),_.each(renderingQueue,function(renderingToken){renderModalFeedback(renderingToken.feedback,loader,renderer,renderingToken.$container,$itemContainer,function(renderingData){firstFeedback||(firstFeedback=$(renderingData.dom)),$("img",renderingData.dom).on("load",function(){iframeNotifier.parent("itemcontentchange")}),renderedFeebacks.push(renderingData),renderedFeebacks.length===renderingQueue.length&&(iframeNotifier.parent("itemcontentchange"),firstFeedback&&autoscroll(firstFeedback),_.isFunction(onShowCallback)&&onShowCallback())})}),replaceControl(renderedFeebacks,$itemContainer,onCloseCallback)),renderingQueue.length}}}),define("taoQtiItem/qtiRunner/modalFeedback/modalRenderer",["lodash","jquery","async","taoQtiItem/qtiItem/helper/pci"],function(_,$,async,pci){'use strict';function renderModalFeedback(feedback,loader,renderer,renderedCallback,closeCallback){var $feedbackBox=$("#modalFeedbacks"),$feedback;feedback.is("modalFeedback")&&renderer.load(function(){$feedback=$feedbackBox.find("#"+feedback.getSerial()),$feedback.length?$feedback.modal():($feedback=feedback.render(),$feedbackBox.append($feedback)),renderedCallback(),feedback.postRender({callback:closeCallback})},loader.getLoadedClasses())}function getFeedbackMessageSignature(feedback){return(""+feedback.body()+feedback.attr("title")).toLowerCase().trim().replace(/x-tao-[a-zA-Z0-9\-._\s]*/g,"")}return{showFeedbacks:function(item,loader,renderer,itemSession,onCloseCallback,onShowCallback){var messages=[],feedbacksToBeDisplayed=[],count;if(_.each(item.modalFeedbacks,function(feedback){var outcomeIdentifier=feedback.attr("outcomeIdentifier"),feedbackIds,message;itemSession[outcomeIdentifier]&&(feedbackIds=pci.getRawValues(itemSession[outcomeIdentifier]),message=getFeedbackMessageSignature(feedback),0<=_.indexOf(feedbackIds,feedback.id())&&-1===_.indexOf(messages,message)&&(feedbacksToBeDisplayed.push(feedback),messages.push(message)))}),count=feedbacksToBeDisplayed.length,count){var callstack=[];_.eachRight(feedbacksToBeDisplayed,function(feedback){var endCallback;0===callstack.length&&(endCallback=function(){onCloseCallback()}),callstack.push(function(cb){renderModalFeedback(feedback,loader,renderer,function(){cb(null)},endCallback)})}),async.series(callstack,function(){_.isFunction(onShowCallback)&&onShowCallback()})}return count}}}),define("taoQtiItem/qtiRunner/core/QtiRunner",["jquery","lodash","context","module","core/promise","iframeNotifier","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiRunner/modalFeedback/inlineRenderer","taoQtiItem/qtiRunner/modalFeedback/modalRenderer"],function($,_,context,module,Promise,iframeNotifier,ItemLoader,modalFeedbackInline,modalFeedbackModal){'use strict';var timeout=1e3*(0<context.timeout?context.timeout+1:30),QtiRunner=function(){this.item=null,this.rpEngine=null,this.renderer=null,this.loader=null,this.itemApi=void 0};return QtiRunner.prototype.updateItemApi=function(){var responses=this.getResponses(),states=this.getStates(),variables=[];for(var key in states){var value=states[key];if(value.response&&"undefined"!=typeof value.response.base)for(var property in value.response.base)if("file"==property){var file=value.response.base.file;value.response={base:{file:{name:file.name,mime:"qti+application/octet-stream",data:"cXRpX2ZpbGVfZGF0YXR5cGVfcGxhY2Vob2xkZXJfZGF0YQ=="}}}}variables[key]=value}this.itemApi.setVariables(variables),this.itemApi.saveResponses(responses),this.itemApi.resultApi.setQtiRunner(this)},QtiRunner.prototype.setItemApi=function(itemApi){this.itemApi=itemApi;var that=this,oldStateVariables=JSON.stringify(itemApi.stateVariables);itemApi.onKill(function(killCallback){that.updateItemApi();var newStateVariables=JSON.stringify(itemApi.stateVariables);oldStateVariables!==newStateVariables||itemApi.serviceApi.getHasBeenPaused()?itemApi.submit(function(){itemApi.serviceApi.setHasBeenPaused(!1),killCallback(0)}):killCallback(0)})},QtiRunner.prototype.setRenderer=function(renderer){if(renderer.isRenderer)this.renderer=renderer;else throw"invalid renderer"},QtiRunner.prototype.getLoader=function(){return this.loader||(this.loader=new ItemLoader),this.loader},QtiRunner.prototype.loadItemData=function(data,callback){var self=this;this.getLoader().loadItemData(data,function(item){self.item=item,callback(self.item)})},QtiRunner.prototype.loadElements=function(elements,callback){if(this.getLoader().item)this.getLoader().loadElements(elements,callback);else throw"QtiRunner : cannot load elements in empty item"},QtiRunner.prototype.renderItem=function(data,done){var self=this;done=_.isFunction(done)?done:_.noop;var render=function(){if(!self.item)throw"cannot render item: empty item";if(self.renderer)self.renderer.load(function(){self.item.setRenderer(self.renderer),self.item.render({},$("#qti_item")),Promise.race([Promise.all(self.item.postRender()),new Promise(function(resolve,reject){_.delay(reject,timeout,new Error("Post rendering ran out of time."))})]).then(function(){self.item.getContainer().on("responseChange",function(e,data){data.interaction&&data.interaction.attr("responseIdentifier")&&data.response&&iframeNotifier.parent("responsechange",[data.interaction.attr("responseIdentifier"),data.response])}),self.initInteractionsResponse(),self.listenForThemeChange(),done()}).catch(function(err){throw done(),new Error("Error in post rendering : "+err)})},self.getLoader().getLoadedClasses());else throw"cannot render item: no rendered set"};"object"===_typeof2(data)?this.loadItemData(data,render):render()},QtiRunner.prototype.initInteractionsResponse=function(){var self=this;if(self.item){var interactions=self.item.getInteractions();for(var i in interactions){var interaction=interactions[i],responseId=interaction.attr("responseIdentifier");self.itemApi.getVariable(responseId,function(values){if(values)interaction.setState(values),iframeNotifier.parent("stateready",[responseId,values]);else{var states=self.getStates();_.indexOf(states,responseId)&&(self.itemApi.setVariable(responseId,states[responseId]),interaction.setState(states[responseId]),iframeNotifier.parent("stateready",[responseId,states[responseId]]))}})}}},QtiRunner.prototype.listenForThemeChange=function(){var self=this,$container=this.renderer.getContainer(this.item);$container.length||($container=$(".qti-item")),$container.off("themechange").on("themechange",function(e,themeName){var themeLoader=self.renderer.getThemeLoader();themeName=themeName||e.originalEvent.detail,themeLoader&&themeLoader.change(themeName)})},QtiRunner.prototype.validate=function(){this.updateItemApi(),this.itemApi.finish()},QtiRunner.prototype.getResponses=function(){var responses={},interactions=this.item.getInteractions();return _.forEach(interactions,function(interaction){var response={};try{response=interaction.getResponse()}catch(e){console.error(e)}responses[interaction.attr("responseIdentifier")]=response}),responses},QtiRunner.prototype.getStates=function(){var states={},interactions=this.item.getInteractions();return _.forEach(interactions,function(interaction){var state={};try{state=interaction.getState()}catch(e){console.error(e)}states[interaction.attr("responseIdentifier")]=state}),states},QtiRunner.prototype.setResponseProcessing=function(callback){this.rpEngine=callback},QtiRunner.prototype.showFeedbacks=function(itemSession,callback,onShowCallback){var inlineDisplay=!!module.config().inlineModalFeedback;return inlineDisplay?modalFeedbackInline.showFeedbacks(this.item,this.getLoader(),this.renderer,itemSession,callback,onShowCallback):modalFeedbackModal.showFeedbacks(this.item,this.getLoader(),this.renderer,itemSession,callback,onShowCallback)},QtiRunner}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/properties",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+=" key=\"",(helper=helpers.key)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.key,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program3(depth0,data,depth1){var buffer="",stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.key,{hash:{},inverse:self.program(6,program6,data),fn:self.programWithDepth(4,program4,data,depth1),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program4(depth0,data,depth2){var buffer="",stack1,helper;return buffer+="<"+escapeExpression((stack1=depth2&&depth2.ns,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"entry key=\"",(helper=helpers.key)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.key,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</"+escapeExpression((stack1=depth2&&depth2.ns,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"entry>\n        ",buffer}function program6(depth0,data){var buffer="",stack1,helper;return buffer+="\n            ",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<",(helper=helpers.ns)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.ns,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"properties",stack1=helpers["if"].call(depth0,depth0&&depth0.key,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.each.call(depth0,depth0&&depth0.entries,{hash:{},inverse:self.noop,fn:self.programWithDepth(3,program3,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</",(helper=helpers.ns)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.ns,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"properties>",buffer})}),define("taoQtiItem/qtiXmlRenderer/helper/portableElementTpl",["lodash","handlebars","tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/properties"],function(_,Handlebars,propertiesTpl){'use strict';function renderPortableElementProperties(properties,ns,name){var entries=[];return _.forIn(properties,function(value,key){_.isObject(value)?entries.push({value:renderPortableElementProperties(value,ns,key)}):entries.push({key:key,value:value})}),propertiesTpl({entries:entries,ns:ns,key:name})}function renderImsPortableElementProperties(properties,ns,name){var entries=[];return _.forIn(properties,function(value,key){entries.push({key:key,value:_.isObject(value)||_.isArray(value)?JSON.stringify(value):value})}),propertiesTpl({entries:entries,ns:ns,key:name})}Handlebars.registerHelper("portableElementProperties",function(properties,ns){return renderPortableElementProperties(properties,ns,"")}),Handlebars.registerHelper("imsPortableElementProperties",function(properties,ns){return renderImsPortableElementProperties(properties,ns,"")})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/element",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",buffer}function program2(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program4(depth0,data){var buffer="",stack1,helper;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"associableHotspot",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"gap",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/choices/gapImg",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,self=this,stack1,helper;return buffer+="<gapImg",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.renderedObject)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.renderedObject,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</gapImg>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiXmlRenderer/tpl/choices/gapImg"],function(tpl){return{qtiClass:"gapImg",template:tpl,getData:function getData(gapImg,data){return data.renderedObject=gapImg.object.render(this),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"gapText",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"hotspotChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"hottext",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"inlineChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"simpleAssociableChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"simpleChoice",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/container",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/Container",["tpl!taoQtiItem/qtiXmlRenderer/tpl/container"],function(tpl){var xhtmlEntities=function(html){return html.replace(/&nbsp;/g,"&#160;")},xhtmlEncode=function(encodedStr){var returnValue="";return encodedStr&&(returnValue=encodedStr,returnValue=returnValue.replace(/<br([^>]*)?>/ig,"<br />"),returnValue=returnValue.replace(/<hr([^>]*)?>/ig,"<hr />"),returnValue=returnValue.replace(/(<img([^>]*)?\s?[^\/]>)+/ig,function($0){return $0.replace(">"," />")})),returnValue};return{qtiClass:"_container",template:tpl,getData:function getData(container,data){return data.body=xhtmlEntities(data.body),data.body=xhtmlEncode(data.body),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/element","taoQtiItem/qtiItem/helper/container"],function(_,tpl,containerHelper){'use strict';function encodeOutcomeInfo(fb){var relatedResponse=fb.data("relatedResponse");relatedResponse&&relatedResponse.attr("identifier")&&containerHelper.setEncodedData(fb,"relatedOutcome",relatedResponse.attr("identifier"))}return{qtiClass:"modalFeedback",template:tpl,getData:function(fb,data){return encodeOutcomeInfo(fb),data.body=fb.getBody().render(this),data.attributes.title=_.escape(data.attributes.title),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Img",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(_,tpl){'use strict';return{qtiClass:"img",template:tpl,getData:function getData(item,data){return data.attributes=_.mapValues(data.attributes,function(val){return _.isString(val)?_.escape(val):val}),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/Include",["tpl!taoQtiItem/qtiXmlRenderer/tpl/include"],function(tpl){return{qtiClass:"include",template:tpl,getData:function getData(xi,data){var ns=xi.getNamespace();return ns&&ns.name&&(data.tag=ns.name+":include"),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1,helper;return(helper=helpers.object)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.object,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.object,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"associateInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"choiceInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/EndAttemptInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"endAttemptInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"extendedTextInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"gapMatchInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"graphicAssociateInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<graphicGapMatchInteraction",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",(helper=helpers.object)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.object,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.gapImgs)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.gapImgs,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.gapImgs||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</graphicGapMatchInteraction>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/graphicGapMatchInteraction"],function(tpl){return{qtiClass:"graphicGapMatchInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"graphicOrderInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"hotspotInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/hottextInteraction"],function(tpl){return{qtiClass:"hottextInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"inlineChoiceInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <simpleMatchSet>\n        ",options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.matchSet1)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet1,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.matchSet1||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </simpleMatchSet>\n    <simpleMatchSet>\n        ",options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.matchSet2)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet2,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.matchSet2||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </simpleMatchSet>\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/matchInteraction"],function(tpl){return{qtiClass:"matchInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program7(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n    ",(helper=helpers.object)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.object,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/mediaInteraction"],function(tpl){return{qtiClass:"mediaInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"orderInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/main",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<customInteraction ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.portableCustomInteraction)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.portableCustomInteraction,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</customInteraction>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/oat",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="";return buffer+="\n            <lib id=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\"/>\n            ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<portableCustomInteraction customInteractionTypeIdentifier=\"",(helper=helpers.typeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.typeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" hook=\"",(helper=helpers.entryPoint)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.entryPoint,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" xmlns=\"http://www.imsglobal.org/xsd/portableCustomInteraction\">\n    <resources>\n        <libraries>\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.libraries,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </libraries>\n    </resources>\n    ",stack1=(helper=helpers.portableElementProperties||depth0&&depth0.portableElementProperties,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.properties,"",options):helperMissing.call(depth0,"portableElementProperties",depth0&&depth0.properties,"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <markup xmlns=\"http://www.w3.org/1999/xhtml\">\n        ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </markup>\n</portableCustomInteraction>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/ims",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+=" primaryConfiguration=\"",(helper=helpers.primaryConfiguration)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.primaryConfiguration,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+=" fallbackConfiguration=\"",(helper=helpers.fallbackConfiguration)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.fallbackConfiguration,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program5(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <module id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",stack1=helpers["if"].call(depth0,depth0&&depth0.primaryPath,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.fallbackPath,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/>\n        ",buffer}function program6(depth0,data){var buffer="",stack1,helper;return buffer+=" primaryPath=\"",(helper=helpers.primaryPath)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.primaryPath,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program8(depth0,data){var buffer="",stack1,helper;return buffer+=" fallbackPath=\"",(helper=helpers.fallbackPath)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.fallbackPath,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<portableCustomInteraction customInteractionTypeIdentifier=\"",(helper=helpers.typeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.typeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" xmlns=\"http://www.imsglobal.org/xsd/portableCustomInteraction_v1\">\n    ",stack1=(helper=helpers.imsPortableElementProperties||depth0&&depth0.imsPortableElementProperties,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.properties,"",options):helperMissing.call(depth0,"imsPortableElementProperties",depth0&&depth0.properties,"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <modules",stack1=helpers["if"].call(depth0,depth0&&depth0.primaryConfiguration,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.fallbackConfiguration,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.modules,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </modules>\n    <markup xmlns=\"http://www.w3.org/1999/xhtml\">\n        ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </markup>\n</portableCustomInteraction>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/PortableCustomInteraction",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/main","tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/oat","tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/ims"],function(_,tpl,oatTpl,imsTpl){'use strict';var templates={"http://www.imsglobal.org/xsd/portableCustomInteraction":oatTpl,"http://www.imsglobal.org/xsd/portableCustomInteraction_v1":imsTpl};return{qtiClass:"customInteraction",template:tpl,getData:function(interaction,data){var ns=interaction.getNamespace();return data.markup=interaction.markup,data.portableCustomInteraction=_.isFunction(templates[ns.uri])?templates[ns.uri].call(null,data):"",data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"prompt",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"selectPointInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"sliderInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"textEntryInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"uploadInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1;return stack1=helpers["if"].call(depth0,null==data||!1===data?data:data.key,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" ",buffer}function program2(depth0,data){var buffer="",stack1;return buffer+="xmlns:"+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\"",buffer}function program4(depth0){var buffer="";return buffer+="xmlns=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\"",buffer}function program6(depth0,data){var stack1,helper,options;return stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),stack1||0===stack1?stack1:""}function program8(depth0){var buffer="",stack1;return buffer+="\n        ",stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer}function program10(depth0,data){var buffer="",stack1,helper;return buffer+=" class=\"",(helper=helpers["class"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["class"],stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"",buffer}function program14(depth0,data){var buffer="",stack1,helper;return buffer+="\n            ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",buffer}function program16(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,blockHelperMissing=helpers.blockHelperMissing,stack1,helper,options;return buffer+="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<assessmentItem \n    ",stack1=helpers.each.call(depth0,depth0&&depth0.namespaces,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",(helper=helpers.xsi)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.xsi,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"schemaLocation=\"",(helper=helpers.schemaLocations)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.schemaLocations,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",options={hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data},(helper=helpers.responses)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.responses,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.responses||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data},(helper=helpers.outcomes)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.outcomes,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.outcomes||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data},(helper=helpers.stylesheets)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.stylesheets,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.stylesheets||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    \n    <itemBody",stack1=helpers["if"].call(depth0,depth0&&depth0["class"],{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.program(14,program14,data),fn:self.program(12,function(){return"\n            <div class=\"empty\"></div>\n        "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </itemBody>\n    \n    ",(helper=helpers.responseProcessing)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseProcessing,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data},(helper=helpers.feedbacks)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.feedbacks,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.feedbacks||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    \n    ",(helper=helpers.apipAccessibility)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.apipAccessibility,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</assessmentItem>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/Item",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/item"],function(_,tpl){'use strict';return{qtiClass:"assessmentItem",template:tpl,getData:function getData(item,data){var self=this,defaultData={class:data.attributes.class||"",responses:[],outcomes:[],stylesheets:[],feedbacks:[],namespaces:item.getNamespaces(),schemaLocations:"",xsi:"xsi:",empty:item.isEmpty(),responseProcessing:item.responseProcessing?item.responseProcessing.render(self):"",apipAccessibility:item.getApipAccessibility()||""};return _.forIn(item.getSchemaLocations(),function(url,uri){defaultData.schemaLocations+=uri+" "+url+" "}),defaultData.schemaLocations=defaultData.schemaLocations.trim(),_.forEach(item.responses,function(response){defaultData.responses.push(response.render(self))}),_.forEach(item.outcomes,function(outcome){(defaultData.responseProcessing||"SCORE"!==outcome.id())&&defaultData.outcomes.push(outcome.render(self))}),_.forEach(item.stylesheets,function(stylesheet){defaultData.stylesheets.push(stylesheet.render(self))}),_.forEach(item.modalFeedbacks,function(feedback){defaultData.feedbacks.push(feedback.render(self))}),data=_.merge({},data||{},defaultData),delete data.attributes.class,data.attributes=_.mapValues(data.attributes,function(val){return _.isString(val)?_.escape(val):val}),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Math",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"math",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="<object",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</object>",buffer}function program2(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program4(depth0,data){var buffer="",stack1;return buffer+="<object",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helperMissing=helpers.helperMissing,self=this,stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/Object",["tpl!taoQtiItem/qtiXmlRenderer/tpl/object"],function(tpl){'use strict';return{qtiClass:"object",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/outcomeDeclaration",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program5(depth0,data){var buffer="",stack1;return buffer+=">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.defaultValue,null==stack1||!1===stack1?stack1:stack1.length),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</outcomeDeclaration>",buffer}function program6(depth0,data){var buffer="",stack1;return buffer+="<defaultValue>\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.defaultValue,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</defaultValue>\n    ",buffer}function program7(depth0){var buffer="";return buffer+="<value>"+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"</value>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<outcomeDeclaration",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,function(){return"/>\n"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/outcomeDeclaration"],function(_,tpl){'use strict';return{qtiClass:"outcomeDeclaration",template:tpl,getData:function getData(outcomeDeclaration,data){var defaultValue=[],defaultData;return _.isUndefined(outcomeDeclaration.defaultValue)||("object"===_typeof2(outcomeDeclaration.defaultValue)?defaultValue=_.values(outcomeDeclaration.defaultValue):defaultValue=[outcomeDeclaration.defaultValue]),defaultData={empty:!_.size(defaultValue),defaultValue:defaultValue},_.merge(data||{},defaultData)}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/portableInfoControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="";return buffer+="\n                <lib id=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\"/>\n                ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,stack1,helper,options;return buffer+="<infoControl ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <portableInfoControl infoControlTypeIdentifier=\"",(helper=helpers.typeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.typeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" hook=\"",(helper=helpers.entryPoint)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.entryPoint,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" xmlns=\"http://www.imsglobal.org/xsd/portableInfoControl\">\n        <resources>\n            <libraries>\n                ",stack1=helpers.each.call(depth0,depth0&&depth0.libraries,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </libraries>\n        </resources>\n        ",stack1=(helper=helpers.portableElementProperties||depth0&&depth0.portableElementProperties,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.properties,"",options):helperMissing.call(depth0,"portableElementProperties",depth0&&depth0.properties,"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        <markup xmlns=\"http://www.w3.org/1999/xhtml\">\n            ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </markup>\n    </portableInfoControl>\n</infoControl>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/PortableInfoControl",["tpl!taoQtiItem/qtiXmlRenderer/tpl/portableInfoControl","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiXmlRenderer/helper/portableElementTpl"],function(tpl,util){'use strict';return{qtiClass:"infoControl",template:tpl,getData:function getData(infoControl,data){return data.markup=infoControl.markup,infoControl.attr("id")||infoControl.attr("id",util.buildId(infoControl.getRootElement(),infoControl.typeIdentifier)),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/printedVariable",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1;return buffer+="\n    <printedVariable ",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n",buffer}function program2(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helperMissing=helpers.helperMissing,self=this,stack1;return stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1.identifier),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/PrintedVariable",["tpl!taoQtiItem/qtiXmlRenderer/tpl/printedVariable"],function(tpl){'use strict';return{qtiClass:"printedVariable",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responseDeclaration",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0,data){var buffer="",stack1;return buffer+=">",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.defaultValue,null==stack1||!1===stack1?stack1:stack1.length),{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.correctResponse,null==stack1||!1===stack1?stack1:stack1.length),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.isAreaMapping,{hash:{},inverse:self.program(18,program18,data),fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </responseDeclaration>",buffer}function program4(depth0,data){var buffer="",stack1;return buffer+="\n    <defaultValue>",stack1=helpers.each.call(depth0,depth0&&depth0.defaultValue,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </defaultValue>\n    ",buffer}function program5(depth0){var buffer="",stack1;return buffer+="\n        <value><![CDATA[",stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer+="]]></value>\n        ",buffer}function program7(depth0,data){var buffer="",stack1;return buffer+="\n    <correctResponse>",stack1=helpers.each.call(depth0,depth0&&depth0.correctResponse,{hash:{},inverse:self.noop,fn:self.programWithDepth(8,program8,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </correctResponse>\n    ",buffer}function program8(depth0,data,depth1){var buffer="",stack1;return stack1=helpers["if"].call(depth0,depth1&&depth1.isRecord,{hash:{},inverse:self.program(5,program5,data),fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program9(depth0,data){var buffer="",stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.value,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",buffer}function program10(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <value fieldIdentifier=\"",(helper=helpers.fieldIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.fieldIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" baseType=\"",(helper=helpers.baseType)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseType,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"><![CDATA[",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="]]></value>\n        ",buffer}function program12(depth0,data){var buffer="",stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.hasMapEntries,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program13(depth0,data){var buffer="",stack1;return buffer+="<areaMapping",stack1=helpers.each.call(depth0,depth0&&depth0.mappingAttributes,{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers.each.call(depth0,depth0&&depth0.mapEntries,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </areaMapping>\n        ",buffer}function program14(depth0,data){var buffer="",stack1;return buffer+=" "+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\"",buffer}function program16(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <areaMapEntry shape=\"",(helper=helpers.shape)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.shape,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" coords=\"",(helper=helpers.coords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.coords,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" mappedValue=\"",(helper=helpers.mappedValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mappedValue,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />",buffer}function program18(depth0,data){var buffer="",stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.hasMapEntries,{hash:{},inverse:self.noop,fn:self.program(19,program19,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",buffer}function program19(depth0,data){var buffer="",stack1;return buffer+="<mapping",stack1=helpers.each.call(depth0,depth0&&depth0.mappingAttributes,{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers.each.call(depth0,depth0&&depth0.mapEntries,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </mapping>\n        ",buffer}function program20(depth0,data){var buffer="",stack1;return buffer+="\n            <mapEntry mapKey=\""+escapeExpression((stack1=null==data||!1===data?data:data.key,"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\" mappedValue=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\" caseSensitive=\"false\"/>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",self=this,escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<responseDeclaration ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,function(){return"/>"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responseDeclaration"],function(_,tpl){return{qtiClass:"responseDeclaration",template:tpl,getData:function getData(responseDeclaration,data){var defaultData={empty:!_.size(responseDeclaration.mapEntries)&&!_.size(responseDeclaration.correctResponse)&&!_.size(responseDeclaration.defaultValue),correctResponse:_.values(responseDeclaration.correctResponse),isAreaMapping:"point"===responseDeclaration.attributes.baseType,mappingAttributes:responseDeclaration.mappingAttributes,hasMapEntries:_.size(responseDeclaration.mapEntries),mapEntries:responseDeclaration.mapEntries,defaultValue:responseDeclaration.defaultValue,isRecord:"record"===responseDeclaration.attributes.cardinality};return _.merge(defaultData,data||{})}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responseProcessing",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return(helper=helpers.xml)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.xml,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+="<responseProcessing template=\"",(helper=helpers.template)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.template,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"/>",buffer}function program5(depth0,data){var buffer="",stack1,helper,options;return buffer+="<responseProcessing>\n    ",options={hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data},(helper=helpers.responseRules)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.responseRules,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.responseRules||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",options={hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data},(helper=helpers.feedbackRules)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.feedbackRules,stack1="function"===_typeof2(helper)?helper.call(depth0,options):helper),helpers.feedbackRules||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseProcessing>",buffer}function program6(depth0){var stack1;return stack1="function"===_typeof2(depth0)?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing,stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.custom,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.template,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.templateDriven,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/match_correct",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            <correct identifier=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n        </match>\n        <setOutcomeValue identifier=\"",(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            <sum>\n                <variable identifier=\"",(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n                <baseValue baseType=\"integer\">1</baseValue>\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<responseCondition>\n    <responseIf>\n        <not>\n            <isNull>\n                <variable identifier=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            </isNull>\n        </not>\n        <setOutcomeValue identifier=\"",(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            <sum>\n                <variable identifier=\"",(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n                <mapResponse identifier=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response_point",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<responseCondition>\n    <responseIf>\n        <not>\n            <isNull>\n                <variable identifier=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            </isNull>\n        </not>\n        <setOutcomeValue identifier=\"",(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            <sum>\n                <variable identifier=\"",(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n                <mapResponsePoint identifier=\"",(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responseProcessing","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/match_correct","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response_point"],function(_,tpl,correctTpl,mapTpl,mapPointTpl){'use strict';var _renderRpTpl=function(rpTpl,data){var ret="";switch(rpTpl){case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct":case"MATCH_CORRECT":ret=correctTpl(data);break;case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response":case"MAP_RESPONSE":ret=mapTpl(data);break;case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point":case"MAP_RESPONSE_POINT":ret=mapPointTpl(data);break;case"no_response_processing":case"NONE":ret="";break;default:throw new Error("unknown rp template : "+rpTpl);}return ret},_renderInteractionRp=function(interaction){var ret="",response=interaction.getResponseDeclaration();return response.template&&(ret=_renderRpTpl(response.template,{responseIdentifier:response.id(),outcomeIdentifier:"SCORE"})),ret},_renderFeedbackRules=function(renderer,response){var ret=[];return _.forEach(response.getFeedbackRules(),function(rule){ret.push(rule.render(renderer))}),ret};return{qtiClass:"responseProcessing",template:tpl,getData:function getData(responseProcessing,data){var defaultData={},self=this,interactions,response;switch(responseProcessing.processingType){case"custom":defaultData.custom=!0,defaultData.xml=responseProcessing.xml;break;case"templateDriven":if(interactions=responseProcessing.getRootElement().getInteractions(),1===interactions.length&&(response=interactions[0].getResponseDeclaration(),0===_.size(response.getFeedbackRules())&&"RESPONSE"===response.id())){"no_response_processing"!==response.template&&(defaultData.template=response.template);break}defaultData.responseRules=[],_.forEach(interactions,function(interaction){var responseRule=_renderInteractionRp(interaction);_.isString(responseRule)&&responseRule.trim()&&defaultData.responseRules.push(responseRule)}),defaultData.feedbackRules=[],_.forEach(interactions,function(interaction){defaultData.feedbackRules=_.union(defaultData.feedbackRules,_renderFeedbackRules(self,interaction.getResponseDeclaration()))}),(defaultData.responseRules.length||defaultData.feedbackRules.length)&&(defaultData.templateDriven=!0);}return _.merge(data||{},defaultData)}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper;return(helper=helpers.rule)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.rule,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_condition",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1;return stack1=helpers["if"].call(depth0,depth0&&depth0.mapResponsePoint,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program2(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <mapResponsePoint identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />",buffer}function program4(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <mapResponse identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />",buffer}function program6(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <variable identifier=\"",(helper=helpers.outcome)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcome,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />",buffer}function program8(depth0){var buffer="",stack1;return buffer+="\n    <responseElse>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<responseCondition>\n    <responseIf>\n        <",(helper=helpers.condition)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.condition,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",stack1=helpers["if"].call(depth0,depth0&&depth0.response,{hash:{},inverse:self.program(6,program6,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            <baseValue baseType=\"float\">",(helper=helpers.comparedValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.comparedValue,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</baseValue>\n        </",(helper=helpers.condition)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.condition,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.then),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_correct",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="\n    <responseElse>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            <correct identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n        </match>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.then),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_incorrect",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="",stack1;return buffer+="\n    <responseElse>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<responseCondition>\n    <responseIf>\n        <not>\n            <match>\n                <variable identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n                <correct identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            </match>\n        </not>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.then),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>",buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_choices",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier=\"",(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" />\n            ",stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.program(5,program5,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </match>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.then),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>\n",buffer}function program2(depth0,data){var buffer="",stack1;return buffer+="\n            <multiple>\n                ",stack1=helpers.each.call(depth0,depth0&&depth0.choices,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </multiple>\n            ",buffer}function program3(depth0){var buffer="";return buffer+="\n                <baseValue baseType=\"identifier\">"+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"</baseValue>\n                ",buffer}function program5(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <baseValue baseType=\"identifier\">",(helper=helpers.choice)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choice,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</baseValue>\n            ",buffer}function program7(depth0){var buffer="",stack1;return buffer+="\n    <responseElse>\n        <setOutcomeValue identifier=\""+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1.outcome),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">\n            <baseValue baseType=\"identifier\">"+escapeExpression((stack1=(stack1=depth0&&depth0.feedback,null==stack1||!1===stack1?stack1:stack1["else"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers.unless.call(depth0,depth0&&depth0.noData,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_condition","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_correct","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_incorrect","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_choices"],function(_,tpl,tplCondition,tplCorrect,tplIncorrect,tplChoices){return{qtiClass:"_simpleFeedbackRule",template:tpl,getData:function getData(rule,data){var template=null,ruleXml="",tplData={response:rule.comparedOutcome.id(),feedback:{outcome:rule.feedbackOutcome.id(),then:rule.feedbackThen.id(),else:rule.feedbackElse?rule.feedbackElse.id():""}},_values;switch(rule.condition){case"correct":template=tplCorrect;break;case"incorrect":template=tplIncorrect;break;case"lt":case"lte":case"equal":case"gte":case"gt":template=tplCondition,tplData.condition=rule.condition,tplData.comparedValue=rule.comparedValue;break;case"choices":template=tplChoices,tplData.condition=rule.condition,tplData.multiple=rule.comparedOutcome.isCardinality(["multiple","ordered"]),_values=[],_.each(rule.comparedValue,function(choice){choice.parent()&&_values.push(choice.id())}),tplData.multiple?tplData.choices=_values:_values.length?tplData.choice=_.head(_values):tplData.noData=!0;break;default:throw new Error("unknown condition in simple feedback rule rendering : "+rule.condition);}return template&&(ruleXml=template(tplData)),_.merge(data||{},{rule:ruleXml})}}}),define("taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element","lodash"],function(tpl,_){return{qtiClass:"rubricBlock",template:tpl,getData:function getData(rubricBlock,data){var newData={view:data.attributes.view?_.values(data.attributes.view).join(" "):""};return _.merge(data||{},newData)}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"stylesheet",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/table",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper,options;return buffer+=" ",stack1=(helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.attributes,"="," ","\"",options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ","\"",options)),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,self=this,stack1,helper;return buffer+="<table",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</table>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/Table",["tpl!taoQtiItem/qtiXmlRenderer/tpl/table"],function(tpl){'use strict';return{qtiClass:"table",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span data-role=\"tooltip-target\" aria-describedby=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["aria-describedby"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span><span data-role=\"tooltip-content\" aria-hidden=\"true\" id=\""+escapeExpression((stack1=(stack1=depth0&&depth0.attributes,null==stack1||!1===stack1?stack1:stack1["aria-describedby"]),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"\">",(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>",buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/Tooltip",["tpl!taoQtiItem/qtiXmlRenderer/tpl/tooltip"],function(tpl){'use strict';return{qtiClass:"_tooltip",template:tpl}}),function(c){var d=document,s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}("/*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n/* Style of advanced components */\n/* toggler */\n.toggler:after {\n    margin-left: 3px;\n    position: relative;\n    top: 2px;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e611\";\n}\n\n.toggler.opened:after {\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e610\";\n}\n\n.toggled {\n    display: none;\n}\n\n/* Adder */\n.adder:before {\n    margin-right: 5px;\n    font-size: 10.5px;\n    font-size: 1.05rem;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e636\";\n}\n\n/* Closer / Deleter */\n.closer:before, .deleter:before {\n    margin-right: 5px;\n    font-size: 10.5px;\n    font-size: 1.05rem;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e637\";\n}\n\n.undobox {\n    display: block;\n    position: fixed;\n    top: 50px;\n    left: 50%;\n    margin-left: -200px;\n    width: 400px;\n    z-index: 100005;\n}\n\n/* Incrementer and duration */\ninput[data-increment], input.duration-ctrl {\n    width: 40px !important;\n    min-width: 40px !important;\n    text-align: right;\n}\n\n.duration-ctrl-wrapper, .incrementer-ctrl-wrapper {\n    position: relative;\n    display: inline-block;\n    border: 1px solid #ddd;\n    border-radius: 2px;\n    border-radius: 2px;\n}\n\n.duration-ctrl-wrapper .incrementer, .incrementer-ctrl-wrapper .incrementer {\n    text-align: right;\n    border: none;\n    padding-right: 18px;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl {\n    border-left: 1px #ddd solid;\n    display: inline-block;\n    height: 100%;\n    position: absolute;\n    right: 0;\n    top: 0;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a {\n    outline: 0 !important;\n    cursor: pointer;\n    display: inline-block;\n    line-height: 13px;\n    color: #222;\n    background: #f3f1ef;\n    padding: 0 4px 0 4px;\n    font-size: 10.5px;\n    font-size: 1.05rem;\n    position: absolute;\n    right: 0;\n    height: 50%;\n    text-align: center;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc {\n    top: 0;\n    border-top-right-radius: 2px;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec {\n    top: 50%;\n    border-bottom-right-radius: 2px;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc:before, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc:before {\n    position: relative;\n    bottom: 0px;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e610\";\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec:before, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec:before {\n    position: relative;\n    top: 0px;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e611\";\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a:hover, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a:hover {\n    background-color: #3e7da7;\n    color: white;\n}\n\n.duration-ctrl-wrapper ~ .separator {\n    padding: 0 3px;\n    text-align: center;\n    opacity: .7;\n}\n\n/* InPlacer */\n[data-in-place], .inplace {\n    cursor: pointer;\n    min-height: 1em;\n}\n\n[data-in-place] input, .inplace input {\n    cursor: auto;\n}\n\n[data-in-place]:hover, .inplace:hover {\n    border: dotted 1px #3e7da7;\n}\n\n/* ListBox  */\nul.listbox {\n    margin: .1em 0;\n    padding: 0;\n    list-style-type: none;\n    display: block;\n}\n\nul.listbox > li {\n    white-space: no-wrap;\n    position: relative;\n    min-width: 75%;\n    border: solid 1px #ddd;\n    border-bottom-width: 0;\n    vertical-align: top;\n    margin: 0;\n    padding: .3em 2em .3em .2em;\n    background-color: #f3f1ef;\n    min-height: 1.5em;\n}\n\nul.listbox > li > .closer, ul.listbox > li > .deleter {\n    position: absolute;\n    right: 5px;\n    top: 0;\n}\n\nul.listbox > li:first-child {\n    border-radius: 2px 2px 0 0;\n}\n\nul.listbox > li:last-child {\n    border-radius: 0 0 2px 2px;\n    border-bottom-width: 1px;\n}\n\nul.listbox > li.placeholder {\n    background: none;\n    margin: .5em;\n    opacity: 0.6;\n}\n\n/* Modal styles */\n.modal {\n    background-color: white;\n    border: 1px solid #ddd;\n    box-shadow: 3px 3px 5px #666666;\n    height: auto;\n    opacity: 0;\n    top: -1000px;\n    padding: 40px;\n    position: fixed;\n    z-index: 105002;\n    margin: auto;\n    left: 0;\n    right: 0;\n    overflow: hidden;\n}\n\n.modal .modal-close {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    cursor: pointer;\n    font-weight: bold;\n    color: #222;\n    font-size: 20px;\n    font-size: 2rem;\n}\n\n.modal .modal-close:hover {\n    opacity: 0.6;\n}\n\n.modal .modal-body h4 {\n    font-size: 16px;\n    font-size: 1.6rem;\n    margin-top: 0;\n    margin-bottom: 8px;\n}\n\n.modal .modal-body .content, .modal .modal-body .message {\n    margin-bottom: 8px;\n}\n\n.modal .modal-body .buttons {\n    top: 16px;\n    position: relative;\n}\n\n.modal .modal-body .buttons button {\n    border-radius: 2px;\n    margin-left: 8px;\n    height: 36px;\n    text-shadow: none;\n    text-transform: uppercase;\n    color: #0e5d91 !important;\n    background: none;\n}\n\n.modal .modal-body .buttons button:focus, .modal .modal-body .buttons button:hover {\n    background: #dbe7ef;\n}\n\n.modal[class^=\"icon-\"]:before, .modal[class*=\" icon-\"]:before {\n    font-size: 44px;\n    font-size: 4.4rem;\n    color: #0e5d91;\n    position: absolute;\n}\n\n.modal[class^=\"icon-\"].icon-result-nok:before, .modal[class*=\" icon-\"].icon-result-nok:before {\n    color: #ba122b;\n}\n\n.modal[class^=\"icon-\"].icon-warning:before, .modal[class*=\" icon-\"].icon-warning:before {\n    color: #c96043;\n}\n\n.modal[class^=\"icon-\"].icon-result-ok:before, .modal[class*=\" icon-\"].icon-result-ok:before {\n    color: #0e914b;\n}\n\n.modal[class^=\"icon-\"].error:before, .modal[class*=\" icon-\"].error:before {\n    color: #ba122b;\n}\n\n.modal[class^=\"icon-\"].danger:before, .modal[class*=\" icon-\"].danger:before {\n    color: #c96043;\n}\n\n.modal[class^=\"icon-\"].warning:before, .modal[class*=\" icon-\"].warning:before {\n    color: #d8ae5b;\n}\n\n.modal[class^=\"icon-\"].info:before, .modal[class*=\" icon-\"].info:before {\n    color: #0e5d91;\n}\n\n.modal[class^=\"icon-\"].success:before, .modal[class*=\" icon-\"].success:before {\n    color: #0e914b;\n}\n\n.modal[class^=\"icon-\"] .modal-body, .modal[class*=\" icon-\"] .modal-body {\n    font-family: \"Franklin Gothic\", \"Franklin Gothic Medium\", \"Source Sans Pro\", sans-serif !important;\n    line-height: 1.4;\n    margin-left: 8.5rem;\n}\n\n.modal-bg {\n    background: none repeat scroll 0 0 black;\n    opacity: 0.45;\n    -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity=45)\";\n    filter: alpha(opacity=45);\n    display: none;\n    position: fixed;\n    height: 100%;\n    width: 100%;\n    left: 0;\n    top: 0;\n    z-index: 100001;\n    overflow: hidden;\n}\n\n/* Button groups */\nul[data-button-group], ul.button-group {\n    list-style-type: none;\n    padding: 0;\n    background-color: white;\n    border: 1px solid #ddd;\n    border-radius: 1px;\n    margin: 0 2px 2px 0;\n    display: inline-block;\n    border-radius: 2px;\n    font-size: 12px;\n    font-size: 1.2rem;\n}\n\nul[data-button-group] > li, ul.button-group > li {\n    border: 0 none;\n    color: #222;\n    cursor: pointer;\n    display: inline-block;\n    float: left;\n    min-width: 26px;\n    padding: 4px 6px;\n    text-align: center;\n    text-decoration: none !important;\n}\n\nul[data-button-group] > li.active, ul.button-group > li.active {\n    color: white;\n    background-color: #0e5d91;\n    transition: all 0.4s ease;\n}\n\nul[data-button-group] > li:hover, ul.button-group > li:hover {\n    color: white;\n    background-color: #3e7da7;\n    transition: all 0.4s ease;\n}\n\nul[data-button-group] > li.separator, ul.button-group > li.separator {\n    background-color: #ddd;\n    float: left;\n    height: 18px;\n    margin: 5px 2px 0 2px;\n    width: 1px;\n    min-width: 1px;\n    padding: 0;\n}\n\nul[data-button-group] > li[class^=\"icon-\"], ul[data-button-group] > li[class*=\" icon-\"], ul.button-group > li[class^=\"icon-\"], ul.button-group > li[class*=\" icon-\"] {\n    height: 16px;\n    margin-top: 1px;\n    width: 16px;\n    padding-top: 2px;\n}\n\n/* Media Preview */\n.previewer {\n    background-color: white;\n    margin: 5px;\n    min-width: 280px;\n    min-height: 200px;\n    text-align: center;\n}\n\n.previewer .nopreview {\n    color: #ddd;\n    text-align: center;\n    font-size: 20px;\n    font-size: 2rem;\n}\n\n.previewer .nopreview:before {\n    font-size: 60px;\n    font-size: 6rem;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e670\";\n    display: block !important;\n}\n\n/* Progress bar */\n.progressbar {\n    height: 2em;\n    text-align: left;\n    border: none;\n    height: 0.8em;\n    background-color: white;\n    border: 1px solid #ddd;\n}\n\n.progressbar > span {\n    height: 100%;\n    border: none;\n    background-color: #3e7da7;\n    display: block;\n    color: white;\n    transition: width 0.4s ease 0s;\n}\n\n.progressbar.info > span {\n    background-color: #0e5d91;\n}\n\n.progressbar.success > span {\n    background-color: #0e914b;\n}\n\n.progressbar.warning > span {\n    background-color: #d8ae5b;\n}\n\n.progressbar.error > span {\n    background-color: #ba122b;\n}\n\n/*# sourceMappingURL=components.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.mediaplayer {\n    position: relative;\n    border: 1px solid #333333;\n    border-radius: 2px;\n    border-radius: 2px;\n    background: black;\n}\n\n.mediaplayer .icon-sound:before {\n    content: \"\\e6af\";\n}\n\n.mediaplayer .icon-mute:before {\n    content: \"\\e69e\";\n}\n\n.mediaplayer .error {\n    display: none;\n}\n\n.mediaplayer .player {\n    position: relative;\n}\n\n.mediaplayer .player iframe {\n    pointer-events: none;\n}\n\n.mediaplayer .player .overlay {\n    position: absolute;\n    z-index: 1;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    opacity: 1;\n    background: transparent none;\n}\n\n.mediaplayer .player .action {\n    position: absolute;\n    z-index: 2;\n    top: 50%;\n    left: 50%;\n    width: 64px;\n    height: 64px;\n    margin-top: -32px;\n    margin-left: -32px;\n    text-align: center;\n    text-decoration: none;\n    display: none;\n    font-size: 64px;\n    font-size: 6.4rem;\n    color: white;\n}\n\n.mediaplayer .player .action .icon {\n    border-radius: 10px;\n    padding: 6px 12px;\n    background-color: black;\n    opacity: 0.2;\n}\n\n.mediaplayer .player .action .icon:hover {\n    opacity: 0.6;\n}\n\n.mediaplayer .controls {\n    visibility: hidden;\n    position: relative;\n    padding: 5px;\n    display: table;\n    table-layout: fixed;\n    width: 100%;\n    border-top: 1px solid #333333;\n}\n\n.mediaplayer .controls .bar {\n    display: table-row;\n}\n\n.mediaplayer .controls .control {\n    display: table-cell;\n}\n\n.mediaplayer .controls .actions {\n    position: relative;\n    transition: all, 0.1, ease-in-out, 0s;\n}\n\n.mediaplayer .controls .actions .action {\n    text-align: center;\n    line-height: 2.2rem;\n    width: 2.2rem;\n    height: 2.2rem;\n    text-decoration: none;\n    color: gainsboro;\n    transition: all, 0.2, ease-in-out, 0s;\n}\n\n.mediaplayer .controls .actions .action:hover {\n    opacity: 1;\n}\n\n.mediaplayer .controls .actions .action .icon {\n    line-height: 2.2rem;\n}\n\n.mediaplayer .controls .actions .play {\n    opacity: 0.7;\n    border-right: 1px solid #333333;\n}\n\n.mediaplayer .controls .actions .mute {\n    opacity: 0.8;\n    border-left: 1px solid #333333;\n}\n\n.mediaplayer .controls .slider {\n    cursor: pointer;\n    border: 1px solid #ddd;\n    border-radius: 2px;\n    border-radius: 10px;\n    transition: all, 0.1, ease-in-out, 0s;\n    background: white;\n}\n\n.mediaplayer .controls .slider .noUi-background {\n    border-radius: 10px;\n    background: white;\n}\n\n.mediaplayer .controls .slider.noUi-connect, .mediaplayer .controls .slider .noUi-connect {\n    border-radius: 10px;\n    background: #333333;\n}\n\n.mediaplayer .controls .slider .noUi-handle {\n    width: 11px;\n    height: 11px;\n    border: 1px solid #ddd;\n    border-radius: 2px;\n    border-radius: 10px;\n    background: #858585;\n}\n\n.mediaplayer .controls .slider .noUi-handle:hover {\n    background: #5c5c5c;\n}\n\n.mediaplayer .controls .slider .noUi-handle:after {\n    display: none;\n}\n\n.mediaplayer .controls .slider.noUi-horizontal {\n    height: 9px;\n}\n\n.mediaplayer .controls .slider.noUi-horizontal .noUi-handle {\n    top: -2px;\n}\n\n.mediaplayer .controls .slider.noUi-vertical {\n    width: 9px;\n}\n\n.mediaplayer .controls .slider.noUi-vertical .noUi-handle {\n    left: -2px;\n}\n\n.mediaplayer .controls .infos {\n    cursor: default;\n    margin: 0 1rem;\n    line-height: 2.2rem;\n    color: #999;\n    font-size: 10px;\n    font-size: 1rem;\n    font-weight: bold;\n}\n\n.mediaplayer .controls .infos [data-control=\"time-end\"]:before {\n    content: ' / ';\n}\n\n.mediaplayer .controls .timer {\n    width: 8rem;\n    text-align: center;\n}\n\n.mediaplayer .controls .seek {\n    position: relative;\n    height: 1rem;\n    margin-top: 5px;\n    padding-left: 1rem;\n}\n\n.mediaplayer .controls .playback {\n    margin-right: 1rem;\n    width: 2.2rem;\n}\n\n.mediaplayer .controls .sound {\n    width: 2.2rem;\n    height: 2.2rem;\n}\n\n.mediaplayer .controls .sound .volume {\n    cursor: default;\n    position: absolute;\n    z-index: 3;\n    background-color: black;\n    padding: 0 10px 0 10px;\n    height: 0;\n    top: 0;\n    left: -1px;\n    opacity: 0;\n    border: solid 1px #333333;\n    transition: height 300ms ease-out, top 300ms ease-out, opacity 50ms linear 250ms;\n}\n\n.mediaplayer .controls .sound .volume.up, .mediaplayer .controls .sound .volume.down {\n    height: 120px;\n    padding: 10px 10px 5px 10px;\n    opacity: 1;\n}\n\n.mediaplayer .controls .sound .volume.up .slider, .mediaplayer .controls .sound .volume.down .slider {\n    opacity: 1;\n    transition: opacity 50ms linear 200ms;\n    transition: opacity 50ms linear 200ms;\n}\n\n.mediaplayer .controls .sound .volume.up {\n    top: -125px;\n    transition: height 300ms ease-out 50ms, top 300ms ease-out 50ms, opacity 50ms linear;\n}\n\n.mediaplayer .controls .sound .volume.down {\n    top: 29px;\n    transition: height 300ms ease-out 50ms, opacity 50ms linear;\n}\n\n.mediaplayer .controls .sound .slider {\n    opacity: 0;\n}\n\n.mediaplayer .controls .sound .slider .noUi-handle {\n    cursor: pointer;\n    width: 9px;\n    height: 9px;\n}\n\n.mediaplayer .controls .sound .slider.noUi-horizontal {\n    width: 50px;\n    height: 7px;\n}\n\n.mediaplayer .controls .sound .slider.noUi-vertical {\n    width: 7px;\n    height: 100px;\n}\n\n.mediaplayer .controls [data-control=\"play\"] {\n    display: none;\n}\n\n.mediaplayer .controls [data-control=\"pause\"] {\n    display: none;\n}\n\n.mediaplayer .controls [data-control=\"mute\"] {\n    display: inline-block;\n}\n\n.mediaplayer .controls [data-control=\"unmute\"] {\n    display: none;\n}\n\n.mediaplayer.video .sound .volume, .mediaplayer.youtube .sound .volume {\n    width: 2.2rem;\n    bottom: 2.2rem;\n    right: 0;\n}\n\n.mediaplayer.audio .sound .volume {\n    height: 2.2rem;\n    right: 2.2rem;\n    bottom: 0;\n}\n\n.mediaplayer.ready .controls {\n    visibility: visible;\n}\n\n.mediaplayer.ready.paused.canplay .overlay {\n    cursor: pointer;\n}\n\n.mediaplayer.ready.paused.canplay .player:hover [data-control=\"play\"] {\n    display: inline-block;\n}\n\n.mediaplayer.ready.paused.canplay.youtube.ended .player:hover [data-control=\"play\"] {\n    display: none;\n}\n\n.mediaplayer.ready.playing.canpause .overlay {\n    cursor: pointer;\n}\n\n.mediaplayer.ready.playing.canpause .player:hover [data-control=\"pause\"] {\n    display: inline-block;\n}\n\n.mediaplayer.playing.canpause .controls [data-control=\"pause\"] {\n    display: inline-block;\n}\n\n.mediaplayer.paused.canplay .controls [data-control=\"play\"] {\n    display: inline-block;\n}\n\n.mediaplayer.paused.canplay .controls [data-control=\"pause\"] {\n    display: none;\n}\n\n.mediaplayer.muted .controls [data-control=\"mute\"] {\n    display: none;\n}\n\n.mediaplayer.muted .controls [data-control=\"unmute\"] {\n    display: inline-block;\n}\n\n.mediaplayer.nogui .player iframe {\n    pointer-events: inherit;\n}\n\n.mediaplayer.nogui .overlay {\n    display: none !important;\n}\n\n.mediaplayer.nogui .controls {\n    display: none !important;\n}\n\n.mediaplayer.error .media, .mediaplayer.error .controls {\n    display: none;\n}\n\n.mediaplayer.error .error {\n    display: table;\n    text-align: center;\n    width: 100%;\n    height: 100%;\n}\n\n.mediaplayer.error .error .message {\n    color: #ba122b;\n    display: table-cell;\n    vertical-align: middle;\n}\n\n.mediaplayer.loading::before {\n    content: '';\n    box-sizing: border-box;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 30px;\n    height: 30px;\n    margin-top: -15px;\n    margin-left: -15px;\n    border-radius: 50%;\n    border: 1px solid #ccc;\n    border-top-color: #07d;\n    animation: spinner .6s linear infinite;\n}\n\n@keyframes spinner {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n/*# sourceMappingURL=player.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.document-viewer .pdf-viewer {\n    position: relative;\n    background-color: #f9f8f7;\n}\n\n.document-viewer .pdf-viewer .pdf-bar {\n    position: relative;\n    display: box;\n    display: -webkit-flexbox;\n    display: flexbox;\n    display: -ms-flex;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    flex-pack: start;\n    justify-content: flex-start;\n    flex-line-pack: start;\n    align-content: flex-start;\n    flex-align: stretch;\n    align-items: stretch;\n    -moz-flex-direction: row;\n    -o-flex-direction: row;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: baseline;\n    background-color: #f3f1ef;\n    color: #222;\n    padding: 2px;\n}\n\n.document-viewer .pdf-viewer .pdf-bar label {\n    font-size: 12px;\n    font-size: 1.2rem;\n    padding: 0;\n    margin: 0;\n}\n\n.document-viewer .pdf-viewer .pdf-info {\n    padding: 0 2px;\n    margin-right: 2px;\n}\n\n.document-viewer .pdf-viewer .pdf-info .info {\n    display: inline-block;\n}\n\n.document-viewer .pdf-viewer .pdf-info .info[data-control=\"pdf-page-num\"] {\n    width: 3rem;\n    margin: 0 2px;\n    text-align: right;\n    font-size: 12px;\n    font-size: 1.2rem;\n    background-color: #f9f8f7;\n    border: 1px solid #c2c1bf;\n}\n\n.document-viewer .pdf-viewer .pdf-info .info[data-control=\"pdf-page-count\"] {\n    font-weight: bold;\n}\n\n.document-viewer .pdf-viewer [data-control=\"pdf-search\"] .icon, .document-viewer .pdf-viewer .pdf-find-bar .icon {\n    padding: 0;\n    margin: 0;\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar {\n    position: absolute;\n    z-index: 1;\n    top: 35px;\n    left: 8px;\n    padding: 4px 8px;\n    background-color: #f9f8f7;\n    border: 1px solid #c2c1bf;\n    border-radius: 4px;\n    -ms-box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n    -o-box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n    box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar::before, .document-viewer .pdf-viewer .pdf-find-bar::after {\n    bottom: 100%;\n    border: solid transparent;\n    content: \" \";\n    height: 0;\n    width: 0;\n    position: absolute;\n    pointer-events: none;\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar::before {\n    left: 13px;\n    margin-left: -9px;\n    border-bottom-color: #c2c1bf;\n    border-width: 9px;\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar::after {\n    left: 13px;\n    margin-left: -8px;\n    border-bottom-color: #f9f8f7;\n    border-width: 8px;\n}\n\n.document-viewer .pdf-viewer .pdf-search-info .pdf-search-position {\n    padding: 4px 8px;\n    font-family: \"Franklin Gothic\", \"Franklin Gothic Medium\", \"Source Sans Pro\", sans-serif;\n    font-size: 12px;\n    font-size: 1.2rem;\n    border-radius: 4px;\n    background-color: #cfdfe9;\n    color: #0e5d91;\n}\n\n.document-viewer .pdf-viewer .pdf-search-info .pdf-search-loop {\n    padding-left: 10px;\n    font-size: 10px;\n    font-size: 1rem;\n    font-style: italic;\n    color: #4e4e4e;\n}\n\n.document-viewer .pdf-viewer .pdf-container {\n    position: relative;\n    overflow-y: auto;\n}\n\n.document-viewer .pdf-viewer .pdf-container.highlight-all .highlight {\n    background-color: #0e5d91;\n}\n\n.document-viewer .pdf-viewer .pdf-page {\n    position: relative;\n    margin: 0 auto;\n}\n\n.document-viewer .pdf-viewer .pdf-content {\n    margin: 0;\n    padding: 0;\n    display: block;\n}\n\n.document-viewer .pdf-viewer .pdf-text {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    overflow: hidden;\n    opacity: 0.2;\n    line-height: 1.0;\n}\n\n.document-viewer .pdf-viewer .pdf-text > div {\n    color: transparent;\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    transform-origin: 0% 0%;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight {\n    margin: -1px;\n    padding: 1px;\n    border-radius: 4px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.begin {\n    -webkit-border-top-right-radius: 0px;\n    -webkit-border-bottom-right-radius: 0px;\n    -moz-border-radius-topright: 0px;\n    -moz-border-radius-bottomright: 0px;\n    border-top-right-radius: 0px;\n    border-bottom-right-radius: 0px;\n    -webkit-border-bottom-right-radius: 0px;\n    -webkit-border-bottom-left-radius: 0px;\n    -moz-border-radius-bottomright: 0px;\n    -moz-border-radius-bottomleft: 0px;\n    border-bottom-right-radius: 0px;\n    border-bottom-left-radius: 0px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.end {\n    -webkit-border-top-left-radius: 0px;\n    -webkit-border-top-right-radius: 0px;\n    -moz-border-radius-topleft: 0px;\n    -moz-border-radius-topright: 0px;\n    border-top-left-radius: 0px;\n    border-top-right-radius: 0px;\n    -webkit-border-top-left-radius: 0px;\n    -webkit-border-bottom-left-radius: 0px;\n    -moz-border-radius-topleft: 0px;\n    -moz-border-radius-bottomleft: 0px;\n    border-top-left-radius: 0px;\n    border-bottom-left-radius: 0px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.middle {\n    border-radius: 0px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.selected {\n    background-color: #0e914b;\n}\n\n/*# sourceMappingURL=documentViewer.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n/* tooltip */\n.resourcemgr {\n    position: relative;\n    width: 90%;\n    height: 100%;\n    max-width: 1400px;\n}\n\n#mediaManager .resourcemgr.modal {\n    max-height: 700px;\n    top: 40px !important;\n    bottom: 40px;\n    padding: 0;\n}\n\n.resourcemgr > h2 {\n    font-size: 15px;\n    font-size: 1.5rem;\n    margin: 20px 40px 10px;\n    height: 40px;\n}\n\n.resourcemgr .file-wrapper {\n    overflow-y: auto;\n    margin: 0 40px;\n    height: calc(100% - 40px - 30px - 40px);\n    display: box;\n    display: -webkit-flexbox;\n    display: flexbox;\n    display: -ms-flex;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    flex-pack: start;\n    justify-content: flex-start;\n    flex-line-pack: start;\n    align-content: flex-start;\n    flex-align: stretch;\n    align-items: stretch;\n}\n\n.resourcemgr .file-browser {\n    -ms-order: 0;\n    order: 0;\n    flex-item-align: stretch;\n    align-self: stretch;\n    flex: 0 0 260px;\n}\n\n.resourcemgr .file-preview {\n    -ms-order: 0;\n    order: 0;\n    flex-item-align: stretch;\n    align-self: stretch;\n    flex: 0 0 300px;\n}\n\n.resourcemgr .file-selector {\n    -ms-order: 0;\n    order: 0;\n    flex-item-align: stretch;\n    align-self: stretch;\n    flex: 1 1 auto;\n    flex: 1 1;\n    max-width: calc(100% - 560px);\n}\n\n.resourcemgr .file-browser, .resourcemgr .file-selector, .resourcemgr .file-preview {\n    position: relative;\n    vertical-align: top;\n    height: 100% !important;\n    color: #222;\n}\n\n.resourcemgr .file-browser h1, .resourcemgr .file-selector h1, .resourcemgr .file-preview h1 {\n    font-size: 16px;\n    font-size: 1.6rem;\n    line-height: 1.6;\n    color: #222;\n    margin-top: 1px;\n    padding: 5px;\n    height: 38px;\n}\n\n.resourcemgr .file-browser h2, .resourcemgr .file-selector h2, .resourcemgr .file-preview h2 {\n    font-size: 13px;\n    font-size: 1.3rem;\n    line-height: 1.3;\n    background-color: #D4D5D7;\n    color: #222;\n    margin-top: 1px;\n    padding: 6px;\n    position: relative;\n    clear: both;\n}\n\n.resourcemgr .file-browser h2.toggler, .resourcemgr .file-selector h2.toggler, .resourcemgr .file-preview h2.toggler {\n    cursor: pointer;\n}\n\n.resourcemgr .file-browser h2.toggler:after, .resourcemgr .file-selector h2.toggler:after, .resourcemgr .file-preview h2.toggler:after {\n    position: absolute;\n    right: 15px;\n    top: 3px;\n}\n\n.resourcemgr .file-browser {\n    background-color: #f3f1ef;\n}\n\n.resourcemgr .file-browser > h1 {\n    background-color: #D4D5D7;\n}\n\n.resourcemgr .file-browser .file-browser-wrapper {\n    overflow: auto;\n    height: calc(100% - 50px);\n}\n\n.resourcemgr .file-browser ul {\n    list-style-type: none;\n    padding-left: 5px;\n}\n\n.resourcemgr .file-browser ul ul {\n    padding-left: 18px;\n}\n\n.resourcemgr .file-browser ul li a {\n    color: #222;\n    white-space: nowrap;\n}\n\n.resourcemgr .file-browser ul li a:before {\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e60c\";\n    margin: 0 3px;\n}\n\n.resourcemgr .file-browser ul li a.opened:before {\n    font-style: italic;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e60d\";\n}\n\n.resourcemgr .file-browser ul li.active > a {\n    background-color: #ecf2f6;\n}\n\n.resourcemgr .file-preview {\n    background-color: #f3f1ef;\n}\n\n.resourcemgr .file-preview > h1 {\n    background-color: #D4D5D7;\n}\n\n.resourcemgr .file-preview .file-properties {\n    padding: 0 5px;\n}\n\n.resourcemgr .file-preview .previewer {\n    height: 300px;\n    overflow: hidden;\n}\n\n.resourcemgr .file-preview .actions {\n    text-align: center;\n    margin-bottom: 10px;\n}\n\n.resourcemgr .file-selector {\n    position: relative;\n    border: solid 1px #fff;\n    border-top: none;\n    border-bottom: none;\n    background-color: white;\n}\n\n.resourcemgr .file-selector > h1 {\n    position: relative;\n    background-color: #f3f1ef;\n}\n\n.resourcemgr .file-selector > h1 .title {\n    margin-right: 10px;\n}\n\n.resourcemgr .file-selector > h1 .upload-switcher a {\n    display: inline-block;\n}\n\n.resourcemgr .file-selector > h1 .upload-switcher .listing {\n    display: none;\n}\n\n.resourcemgr .file-selector .empty {\n    color: #666;\n    font-style: italic;\n    font-size: 18px;\n    font-size: 1.8rem;\n    text-align: center;\n}\n\n.resourcemgr .file-selector ul.files {\n    position: relative;\n    margin-bottom: 0;\n    padding: 0;\n    list-style-type: none;\n    max-height: 550px;\n}\n\n.resourcemgr .file-selector ul.files li {\n    height: 35px;\n    line-height: 35px;\n    margin-bottom: 0;\n    padding: 0 0 0 5px;\n    position: relative;\n}\n\n.resourcemgr .file-selector ul.files li:before {\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e622\";\n    font-size: 16px;\n    font-size: 1.6rem;\n    vertical-align: top;\n    line-height: 2.2;\n    position: absolute;\n    left: 8px;\n}\n\n.resourcemgr .file-selector ul.files li[data-type='image']:before {\n    content: \"\\e620\";\n}\n\n.resourcemgr .file-selector ul.files li[data-type='audio']:before {\n    content: \"\\e670\";\n}\n\n.resourcemgr .file-selector ul.files li[data-type='video']:before {\n    content: \"\\e61e\";\n}\n\n.resourcemgr .file-selector ul.files li.active, .resourcemgr .file-selector ul.files li:hover {\n    background-color: #ecf2f6;\n    cursor: pointer;\n}\n\n.resourcemgr .file-selector ul.files li .desc {\n    display: inline-block;\n    max-width: calc(100% - 130px);\n    margin-left: 25px;\n}\n\n.resourcemgr .file-selector ul.files li .actions {\n    top: 0;\n    right: 0;\n    position: absolute;\n    height: 35px;\n    width: 100px;\n}\n\n.resourcemgr .file-selector ul.files li .actions .tlb {\n    display: inline-block;\n    background: none;\n    font-size: 14px;\n    font-size: 1.4rem;\n}\n\n.resourcemgr .file-selector ul.files li .actions .tlb .tlb-top {\n    background: none !important;\n    border-width: 0 !important;\n    -ms-box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2);\n    -o-box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2);\n    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2);\n}\n\n.resourcemgr .file-selector .file-upload-container {\n    display: none;\n    padding: 0 5px;\n}\n\n/*# sourceMappingURL=resourcemgr.css.map *//*\n * MathQuill v0.10.1               http://mathquill.com\n * by Han, Jeanine, and Mary  maintainers@mathquill.com\n *\n * This Source Code Form is subject to the terms of the\n * Mozilla Public License, v. 2.0. If a copy of the MPL\n * was not distributed with this file, You can obtain\n * one at http://mozilla.org/MPL/2.0/.\n */\n@font-face {\n  font-family: Symbola;\n  src: url(font/Symbola.eot);\n  src: local(\"Symbola Regular\"), local(\"Symbola\"), url(font/Symbola.woff2) format(\"woff2\"), url(font/Symbola.woff) format(\"woff\"), url(font/Symbola.ttf) format(\"truetype\"), url(font/Symbola.otf) format(\"opentype\"), url(font/Symbola.svg#Symbola) format(\"svg\");\n}\n.mq-editable-field {\n  display: -moz-inline-box;\n  display: inline-block;\n}\n.mq-editable-field .mq-cursor {\n  border-left: 1px solid black;\n  margin-left: -1px;\n  position: relative;\n  z-index: 1;\n  padding: 0;\n  display: -moz-inline-box;\n  display: inline-block;\n}\n.mq-editable-field .mq-cursor.mq-blink {\n  visibility: hidden;\n}\n.mq-editable-field,\n.mq-math-mode .mq-editable-field {\n  border: 1px solid gray;\n}\n.mq-editable-field.mq-focused,\n.mq-math-mode .mq-editable-field.mq-focused {\n  -webkit-box-shadow: #8bd 0 0 1px 2px, inset #6ae 0 0 2px 0;\n  -moz-box-shadow: #8bd 0 0 1px 2px, inset #6ae 0 0 2px 0;\n  box-shadow: #8bd 0 0 1px 2px, inset #6ae 0 0 2px 0;\n  border-color: #709AC0;\n  border-radius: 1px;\n}\n.mq-math-mode .mq-editable-field {\n  margin: 1px;\n}\n.mq-editable-field .mq-latex-command-input {\n  color: inherit;\n  font-family: \"Courier New\", monospace;\n  border: 1px solid gray;\n  padding-right: 1px;\n  margin-right: 1px;\n  margin-left: 2px;\n}\n.mq-editable-field .mq-latex-command-input.mq-empty {\n  background: transparent;\n}\n.mq-editable-field .mq-latex-command-input.mq-hasCursor {\n  border-color: ActiveBorder;\n}\n.mq-editable-field.mq-empty:after,\n.mq-editable-field.mq-text-mode:after,\n.mq-math-mode .mq-empty:after {\n  visibility: hidden;\n  content: 'c';\n}\n.mq-editable-field .mq-cursor:only-child:after,\n.mq-editable-field .mq-textarea + .mq-cursor:last-child:after {\n  visibility: hidden;\n  content: 'c';\n}\n.mq-editable-field .mq-text-mode .mq-cursor:only-child:after {\n  content: '';\n}\n.mq-editable-field.mq-text-mode {\n  overflow-x: auto;\n  overflow-y: hidden;\n}\n.mq-root-block,\n.mq-math-mode .mq-root-block {\n  display: -moz-inline-box;\n  display: inline-block;\n  width: 100%;\n  padding: 2px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  white-space: nowrap;\n  overflow: hidden;\n  vertical-align: middle;\n}\n.mq-math-mode {\n  font-variant: normal;\n  font-weight: normal;\n  font-style: normal;\n  font-size: 115%;\n  line-height: 1;\n  display: -moz-inline-box;\n  display: inline-block;\n}\n.mq-math-mode .mq-non-leaf,\n.mq-math-mode .mq-scaled {\n  display: -moz-inline-box;\n  display: inline-block;\n}\n.mq-math-mode var,\n.mq-math-mode .mq-text-mode,\n.mq-math-mode .mq-nonSymbola {\n  font-family: \"Times New Roman\", Symbola, serif;\n  line-height: .9;\n}\n.mq-math-mode * {\n  font-size: inherit;\n  line-height: inherit;\n  margin: 0;\n  padding: 0;\n  border-color: black;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n  box-sizing: border-box;\n}\n.mq-math-mode .mq-empty {\n  background: #ccc;\n}\n.mq-math-mode .mq-empty.mq-root-block {\n  background: transparent;\n}\n.mq-math-mode.mq-empty {\n  background: transparent;\n}\n.mq-math-mode .mq-text-mode {\n  font-size: 87%;\n}\n.mq-math-mode .mq-font {\n  font: 1em \"Times New Roman\", Symbola, serif;\n}\n.mq-math-mode .mq-font * {\n  font-family: inherit;\n  font-style: inherit;\n}\n.mq-math-mode b,\n.mq-math-mode b.mq-font {\n  font-weight: bolder;\n}\n.mq-math-mode var,\n.mq-math-mode i,\n.mq-math-mode i.mq-font {\n  font-style: italic;\n}\n.mq-math-mode var.mq-f {\n  margin-right: 0.2em;\n  margin-left: 0.1em;\n}\n.mq-math-mode .mq-roman var.mq-f {\n  margin: 0;\n}\n.mq-math-mode big {\n  font-size: 125%;\n}\n.mq-math-mode .mq-roman {\n  font-style: normal;\n}\n.mq-math-mode .mq-sans-serif {\n  font-family: sans-serif, Symbola, serif;\n}\n.mq-math-mode .mq-monospace {\n  font-family: monospace, Symbola, serif;\n}\n.mq-math-mode .mq-overline {\n  border-top: 1px solid black;\n  margin-top: 1px;\n}\n.mq-math-mode .mq-underline {\n  border-bottom: 1px solid black;\n  margin-bottom: 1px;\n}\n.mq-math-mode .mq-binary-operator {\n  padding: 0 0.2em;\n  display: -moz-inline-box;\n  display: inline-block;\n}\n.mq-math-mode .mq-supsub {\n  font-size: 90%;\n  vertical-align: -0.5em;\n}\n.mq-math-mode .mq-supsub.mq-limit {\n  font-size: 80%;\n  vertical-align: -0.4em;\n}\n.mq-math-mode .mq-supsub.mq-sup-only {\n  vertical-align: .5em;\n}\n.mq-math-mode .mq-supsub.mq-sup-only .mq-sup {\n  display: inline-block;\n  vertical-align: text-bottom;\n}\n.mq-math-mode .mq-supsub .mq-sup {\n  display: block;\n}\n.mq-math-mode .mq-supsub .mq-sub {\n  display: block;\n  float: left;\n}\n.mq-math-mode .mq-supsub.mq-limit .mq-sub {\n  margin-left: -0.25em;\n}\n.mq-math-mode .mq-supsub .mq-binary-operator {\n  padding: 0 .1em;\n}\n.mq-math-mode .mq-supsub .mq-fraction {\n  font-size: 70%;\n}\n.mq-math-mode sup.mq-nthroot {\n  font-size: 80%;\n  vertical-align: 0.8em;\n  margin-right: -0.6em;\n  margin-left: .2em;\n  min-width: .5em;\n}\n.mq-math-mode .mq-paren {\n  padding: 0 .1em;\n  vertical-align: top;\n  -webkit-transform-origin: center .06em;\n  -moz-transform-origin: center .06em;\n  -ms-transform-origin: center .06em;\n  -o-transform-origin: center .06em;\n  transform-origin: center .06em;\n}\n.mq-math-mode .mq-paren.mq-ghost {\n  color: silver;\n}\n.mq-math-mode .mq-paren + span {\n  margin-top: .1em;\n  margin-bottom: .1em;\n}\n.mq-math-mode .mq-array {\n  vertical-align: middle;\n  text-align: center;\n}\n.mq-math-mode .mq-array > span {\n  display: block;\n}\n.mq-math-mode .mq-operator-name {\n  font-family: Symbola, \"Times New Roman\", serif;\n  line-height: .9;\n  font-style: normal;\n}\n.mq-math-mode var.mq-operator-name.mq-first {\n  padding-left: .2em;\n}\n.mq-math-mode var.mq-operator-name.mq-last {\n  padding-right: .2em;\n}\n.mq-math-mode .mq-fraction {\n  font-size: 90%;\n  text-align: center;\n  vertical-align: -0.4em;\n  padding: 0 .2em;\n}\n.mq-math-mode .mq-fraction,\n.mq-math-mode .mq-large-operator,\n.mq-math-mode x:-moz-any-link {\n  display: -moz-groupbox;\n}\n.mq-math-mode .mq-fraction,\n.mq-math-mode .mq-large-operator,\n.mq-math-mode x:-moz-any-link,\n.mq-math-mode x:default {\n  display: inline-block;\n}\n.mq-math-mode .mq-numerator,\n.mq-math-mode .mq-denominator {\n  display: block;\n}\n.mq-math-mode .mq-numerator {\n  padding: 0 0.1em;\n}\n.mq-math-mode .mq-denominator {\n  border-top: 1px solid;\n  float: right;\n  width: 100%;\n  padding: 0.1em;\n}\n.mq-math-mode .mq-sqrt-prefix {\n  padding-top: 0;\n  position: relative;\n  top: 0.1em;\n  vertical-align: top;\n  -webkit-transform-origin: top;\n  -moz-transform-origin: top;\n  -ms-transform-origin: top;\n  -o-transform-origin: top;\n  transform-origin: top;\n}\n.mq-math-mode .mq-sqrt-stem {\n  border-top: 1px solid;\n  margin-top: 1px;\n  padding-left: .15em;\n  padding-right: .2em;\n  margin-right: .1em;\n  padding-top: 1px;\n}\n.mq-math-mode .mq-vector-prefix {\n  display: block;\n  text-align: center;\n  line-height: .25em;\n  margin-bottom: -0.1em;\n  font-size: 0.75em;\n}\n.mq-math-mode .mq-vector-stem {\n  display: block;\n}\n.mq-math-mode .mq-large-operator {\n  text-align: center;\n}\n.mq-math-mode .mq-large-operator .mq-from,\n.mq-math-mode .mq-large-operator big,\n.mq-math-mode .mq-large-operator .mq-to {\n  display: block;\n}\n.mq-math-mode .mq-large-operator .mq-from,\n.mq-math-mode .mq-large-operator .mq-to {\n  font-size: 80%;\n}\n.mq-math-mode .mq-large-operator .mq-from {\n  float: right;\n  /* take out of normal flow to manipulate baseline */\n  width: 100%;\n}\n.mq-math-mode,\n.mq-math-mode .mq-editable-field {\n  cursor: text;\n  font-family: Symbola, \"Times New Roman\", serif;\n}\n.mq-math-mode .mq-overarrow {\n  border-top: 1px solid black;\n  margin-top: 1px;\n  padding-top: 0.2em;\n}\n.mq-math-mode .mq-overarrow:before {\n  display: block;\n  position: relative;\n  top: -0.34em;\n  font-size: 0.5em;\n  line-height: 0em;\n  content: '\\27A4';\n  text-align: right;\n}\n.mq-math-mode .mq-overarrow.mq-arrow-left:before {\n  -moz-transform: scaleX(-1);\n  -o-transform: scaleX(-1);\n  -webkit-transform: scaleX(-1);\n  transform: scaleX(-1);\n  filter: FlipH;\n  -ms-filter: \"FlipH\";\n}\n.mq-math-mode .mq-selection,\n.mq-editable-field .mq-selection,\n.mq-math-mode .mq-selection .mq-non-leaf,\n.mq-editable-field .mq-selection .mq-non-leaf,\n.mq-math-mode .mq-selection .mq-scaled,\n.mq-editable-field .mq-selection .mq-scaled {\n  background: #B4D5FE !important;\n  background: Highlight !important;\n  color: HighlightText;\n  border-color: HighlightText;\n}\n.mq-math-mode .mq-selection .mq-matrixed,\n.mq-editable-field .mq-selection .mq-matrixed {\n  background: #39F !important;\n}\n.mq-math-mode .mq-selection .mq-matrixed-container,\n.mq-editable-field .mq-selection .mq-matrixed-container {\n  filter: progid:DXImageTransform.Microsoft.Chroma(color='#3399FF') !important;\n}\n.mq-math-mode .mq-selection.mq-blur,\n.mq-editable-field .mq-selection.mq-blur,\n.mq-math-mode .mq-selection.mq-blur .mq-non-leaf,\n.mq-editable-field .mq-selection.mq-blur .mq-non-leaf,\n.mq-math-mode .mq-selection.mq-blur .mq-scaled,\n.mq-editable-field .mq-selection.mq-blur .mq-scaled,\n.mq-math-mode .mq-selection.mq-blur .mq-matrixed,\n.mq-editable-field .mq-selection.mq-blur .mq-matrixed {\n  background: #D4D4D4 !important;\n  color: black;\n  border-color: black;\n}\n.mq-math-mode .mq-selection.mq-blur .mq-matrixed-container,\n.mq-editable-field .mq-selection.mq-blur .mq-matrixed-container {\n  filter: progid:DXImageTransform.Microsoft.Chroma(color='#D4D4D4') !important;\n}\n.mq-editable-field .mq-textarea,\n.mq-math-mode .mq-textarea {\n  position: relative;\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  user-select: text;\n}\n.mq-editable-field .mq-textarea *,\n.mq-math-mode .mq-textarea *,\n.mq-editable-field .mq-selectable,\n.mq-math-mode .mq-selectable {\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  user-select: text;\n  position: absolute;\n  clip: rect(1em 1em 1em 1em);\n  -webkit-transform: scale(0);\n  -moz-transform: scale(0);\n  -ms-transform: scale(0);\n  -o-transform: scale(0);\n  transform: scale(0);\n  resize: none;\n  width: 1px;\n  height: 1px;\n}\n.mq-math-mode .mq-matrixed {\n  background: white;\n  display: -moz-inline-box;\n  display: inline-block;\n}\n.mq-math-mode .mq-matrixed-container {\n  filter: progid:DXImageTransform.Microsoft.Chroma(color='white');\n  margin-top: -0.1em;\n}\n/*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.window-component {\n    display: flex;\n    flex-direction: column;\n}\n\n.window-component .window-component-title-bar {\n    display: flex;\n    padding: 3px 8px;\n}\n\n.window-component .window-component-title-bar .window-component-title {\n    flex: 1;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n}\n\n.window-component .window-component-title-bar .window-component-controls {\n    flex: 0 1 auto;\n}\n\n.window-component .window-component-title-bar .window-component-controls button {\n    padding: 0;\n    height: auto;\n    margin-left: 8px;\n}\n\n.window-component .window-component-body {\n    flex: 1;\n    padding: 8px;\n}\n\n.window-component {\n    border: 1px solid #333333;\n}\n\n.window-component .window-component-title-bar {\n    background-color: #333333;\n    color: white;\n}\n\n.window-component .window-component-title-bar .window-component-controls button {\n    background-color: transparent;\n}\n\n.window-component .window-component-body {\n    background-color: #f3f1ef;\n}\n\n/*# sourceMappingURL=windowComponent.css.map */.media-sizer {\n    max-width: 300px;\n}\n\n.media-sizer label {\n    min-width: 80px;\n    line-height: 22px;\n}\n\n.media-sizer input[type=\"text\"] {\n    width: 68px !important;\n    min-width: 68px !important;\n    text-align: right;\n    padding-right: 24px;\n}\n\n.media-sizer .media-sizer-pixel-width,\n.media-sizer .media-sizer-pixel-height\n{\n    width: 80px;\n}\n\n.media-sizer.media-sizer-reset-off .item-editor-unit-input-box {\n    right: -22px;\n}\n\n.media-sizer.media-sizer-reset-off .media-sizer-sync {\n    right: 69px;\n}\n\n.media-sizer.media-sizer-responsivetoggle-off .media-sizer-responsive-toggle,\n.media-sizer.media-sizer-sync-off .media-sizer-sync,\n.media-sizer.media-sizer-reset-off .media-sizer-reset\n{\n    display:none;\n}\n\n.media-sizer .item-editor-unit-input-box {\n    position: relative;\n    display:-moz-box; /* fix for FF */\n    right: -3px;\n}\n\n.media-sizer .media-sizer-reset,\n.media-sizer .media-sizer-sync {\n    border: 2px solid transparent;\n    border-radius: 2px;\n    position: absolute;\n    top: 10px;\n    height: 38px;\n    width: 12px;\n    z-index: 1000;\n    opacity: .85;\n    cursor: pointer;\n}\n\n.media-sizer .media-sizer-reset:hover,\n.media-sizer .media-sizer-sync:hover {\n    color: #3e7da7;\n}\n\n.media-sizer .media-sizer-reset span,\n.media-sizer .media-sizer-sync span\n{\n    position: absolute;\n    top: 8px;\n    background: #f3f1ef;\n    padding: 3px;\n    border-radius: 8px\n}\n\n.media-sizer .media-sizer-sync {\n    border-right: none;\n    left: 70px;\n}\n\n.media-sizer .media-sizer-sync span {\n    -webkit-transform: rotate(45deg);\n    -moz-transform: rotate(45deg);\n    -o-transform: rotate(45deg);\n    left: -11px;\n}\n\n.media-sizer .media-sizer-reset {\n    border-left: none;\n    border-color: #ccc;\n    left: 160px;\n}\n\n.media-sizer .media-sizer-reset span {\n    -webkit-transform: rotate(45deg);\n    -moz-transform: rotate(45deg);\n    -o-transform: rotate(45deg);\n    right: -11px;\n}\n\n.media-sizer .media-sizer-reset.media-sizer-reset-percent {\n    border: none;\n    height: 12px;\n    top: -4px;\n}\n\n.media-sizer .unit-indicator {\n    margin: -24px;\n}\n\n.media-sizer .media-sizer-slider-box {\n    padding-top: 10px;\n    position: relative;\n}\n\n.media-sizer .media-sizer-cover {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 30px;\n    background: #f3f1ef;\n    opacity: .55;\n    display: block;\n    z-index: 15;\n}\n\n.media-sizer .media-sizer-pixel {\n    display: none;\n    position: relative;\n}\n\n.media-sizer .media-sizer-percent {\n    display: block;\n    position: relative;\n}\n\n.media-sizer.media-sizer-synced .media-sizer-cover {\n    display:none;\n}\n\n.media-sizer.media-sizer-synced .media-sizer-sync {\n    border-color: #ccc;\n    opacity: 1;\n}\n/*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.dynamic-component-container {\n    display: inline-block;\n    background: #f3f1ef;\n    padding: 5px;\n    position: absolute;\n    left: 0;\n    top: 0;\n    box-shadow: 0 0 2px 2px rgba(141, 148, 158, 0.75);\n    z-index: 15000;\n}\n\n.dynamic-component-container .dynamic-component-title-bar {\n    position: relative;\n    color: #e6e6e6;\n    background: #333333;\n    cursor: move;\n    text-shadow: none;\n    line-height: 1.4;\n    min-height: 23px;\n    font-size: 14px;\n    font-size: 1.4rem;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .reset {\n    color: #e6e6e6;\n    position: absolute;\n    top: 0;\n    right: 24px;\n    text-decoration: none;\n    padding: 2px 0 3px 5px;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .reset:before {\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\f066\";\n    margin: 0;\n    padding-right: 5px;\n    top: 1px;\n    position: relative;\n    font-size: 14px;\n    font-size: 1.4rem;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .closer {\n    color: #e6e6e6;\n    position: absolute;\n    top: 0;\n    right: 0;\n    text-decoration: none;\n    padding: 2px 2px 2px 4px;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .closer:before {\n    margin: 0;\n    padding-right: 1px;\n    top: 1px;\n    position: relative;\n    font-size: 16px;\n    font-size: 1.6rem;\n}\n\n.dynamic-component-container .dynamic-component-title-bar h3 {\n    padding: 0 5px;\n    margin: 0;\n    text-align: left;\n}\n\n.dynamic-component-container .dynamic-component-content {\n    position: relative;\n}\n\n.dynamic-component-container .dynamic-component-content .dynamic-component-layer {\n    position: absolute;\n    opacity: 0;\n    top: 0;\n    left: 0;\n}\n\n.dynamic-component-container .dynamic-component-content .dynamic-component-layer.dragging-active {\n    width: 100%;\n    height: 100%;\n}\n\n/*# sourceMappingURL=dynamicComponent.css.map */"),define("taoQtiItem/loader/taoQtiItem.bundle",function(){}),define("taoQtiItem/loader/taoQtiItem.min",["taoItems/loader/taoItems.min"],function(){});
//# sourceMappingURL=taoQtiItem.min.js.map